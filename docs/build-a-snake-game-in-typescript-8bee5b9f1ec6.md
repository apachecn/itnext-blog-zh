# ðŸç”¨ TypeScript æž„å»ºä¸€ä¸ªè´ªåƒè›‡æ¸¸æˆ

> åŽŸæ–‡ï¼š<https://itnext.io/build-a-snake-game-in-typescript-8bee5b9f1ec6?source=collection_archive---------1----------------------->

## å¦‚ä½•ç”¨ HTML5 å’Œ TypeScript æž„å»ºä¸€ä¸ªå¤å¤çš„è´ªåƒè›‡æ¸¸æˆ

![](img/fe01d3ca92da1732f47681af46741966.png)

ç”¨ HTML5 Canvas å’Œ TypeScript åˆ¶ä½œçš„å¤å¤è´ªåƒè›‡æ¸¸æˆçš„å±å¹•æˆªå›¾

## ä»‹ç»

å¦‚æžœè¯´åœ¨æˆ‘çš„æˆé•¿è¿‡ç¨‹ä¸­æœ‰ä¸€ä»¶äº‹ç»™æˆ‘ç•™ä¸‹äº†æ·±åˆ»çš„å°è±¡ï¼Œé‚£å°±æ˜¯ 80 å¹´ä»£å’Œ 90 å¹´ä»£çš„é…·æ¸¸æˆï¼Œå®ƒä»¬éžå¸¸ç®€å•ï¼Œä½†çŽ©èµ·æ¥ä¹Ÿéžå¸¸æœ‰è¶£ã€‚æˆ‘ä¹Ÿåœ¨è¿™æ®µæ—¶é—´å­¦ä¹ äº†ã€ŠT4ã€‹çš„åŸºæœ¬ç¼–ç¨‹ï¼Œæ‰€ä»¥å¾ˆè‡ªç„¶ï¼Œæ²¡è¿‡å¤šä¹…æˆ‘å°±å¼€å§‹åˆ›ä½œè‡ªå·±çš„ç®€å•æ¸¸æˆäº†ã€‚

æ—©åœ¨ 2015 å¹´ï¼Œæˆ‘åœ¨ TypeScript ä¸­åˆ›å»ºäº†è¿™ä¸ª[è€æ´¾çš„è´ªåƒè›‡æ¸¸æˆ](https://bytegames.github.io/bytes)ï¼Œä»¥æµ‹è¯• HTML5 ä¸­ **canvas** å¯¹è±¡çš„å›¾å½¢åŠŸèƒ½ï¼Œå¹¶æ„Ÿå—å¦‚ä½•ä½¿ç”¨å®ƒä»Žå¤´å¼€å§‹é‡æ–°åˆ›å»ºç»å…¸çš„ 2D æ¸¸æˆã€‚

æˆ‘é€‰æ‹©äº† [TypeScript](https://www.typescriptlang.org) ,å› ä¸ºé‚£æ—¶æˆ‘å·²ç»ç”¨å®ƒæž„å»ºäº†å‡ ä¸ª UI å’Œ UI æ¡†æž¶ï¼Œå…¶ä¸­è®¸å¤šéƒ½æ˜¯æ ¹æ®æˆ‘ä½¿ç”¨ C#å’Œ WPF çš„ç»éªŒæ¥æ¨¡ä»¿çš„ã€‚è¿™ä½¿å¾—å®ƒæˆä¸ºä»Žé›¶å¼€å§‹å¿«é€Ÿæž„å»ºå®šåˆ¶æ¸¸æˆå¼•æ“ŽåŽŸåž‹çš„ç»ä½³é€‰æ‹©ï¼Œæˆ‘æƒ³è¦å®Œç¾Žçš„æ€§èƒ½å’Œå‡ ä¹Žæ²¡æœ‰é”™è¯¯çš„è¡Œä¸º(æˆ‘ä»¬æ€»æ˜¯æƒ³è¦æ²¡æœ‰é”™è¯¯çš„è½¯ä»¶ï¼Œä½†åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä½¿ç”¨æˆ‘é€‰æ‹©çš„å·¥å…·ä»Žé›¶å¼€å§‹æž„å»ºæ•´ä¸ªæ¸¸æˆï¼Œæ‰€ä»¥æˆ‘å®žé™…ä¸Šå¾—åˆ°äº†å®ƒ)ã€‚

æ•´ä¸ªé¡¹ç›®éƒ½æ˜¯å¼€æºçš„ï¼Œåœ¨è¿™é‡Œå¯ä»¥æ‰¾åˆ°ï¼Œæ‰€ä»¥å¦‚æžœä½ å–œæ¬¢ï¼Œå°±åŽ»æ‹¿ä¸€ä»½å‰¯æœ¬ï¼Œä½“éªŒä¸€ä¸‹å§ï¼Œçœ‹çœ‹ä½ èƒ½å¾—åˆ°ä»€ä¹ˆã€‚

## é¡¹ç›®ç»“æž„

è¿™ä¸ªé¡¹ç›®éžå¸¸ç®€å•ï¼Œé™¤äº† TypeScript ç¼–è¯‘å™¨ä¹‹å¤–æ²¡æœ‰ä»»ä½•å¤–éƒ¨ä¾èµ–ã€‚è¿™ä½¿å¾—å®ƒæˆä¸ºä»Žå¤´å¼€å‘ç®€å•æ¸¸æˆå¼•æ“Žçš„ç†æƒ³çŽ¯å¢ƒã€‚ä¸‹é¢æ˜¯ **package.json** å’Œ **tsconfig.json** :

è¿™ä¸ªé¡¹ç›®ä¸­çš„ **package.json** æ–‡ä»¶æˆ–å¤šæˆ–å°‘æ˜¯ä½œä¸ºå‚è€ƒï¼Œå› ä¸ºå®žé™…ä¸Šä¸å­˜åœ¨ä¾èµ–å…³ç³»æˆ–å…¶ä»–ä»»ä½•ä¸œè¥¿ã€‚åœ¨ **tsconfig.json** ä¸­ï¼Œæœ‰æŒ‡ä»¤è®©ç¼–è¯‘å™¨å°†æ–‡ä»¶è¾“å‡ºä¸º ES6 æ¨¡å—ï¼Œå¹¶å°†å®ƒä»¬æ”¾åœ¨ **build** ç›®å½•ä¸­ï¼Œä»¥ä¾¿åœ¨æµè§ˆå™¨ä¸­åŠ è½½ã€‚

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿˜æœ‰ä¸€ä¸ª**index.html**æ–‡ä»¶ï¼Œç”¨äºŽå°†æ¸¸æˆä½œä¸ºä¸€ä¸ªé™æ€åº”ç”¨ç¨‹åº(è¿™é‡Œå·²ç»å®Œæˆäº†)å’Œä¸€ä¸ªç”¨äºŽ CSS3 é£Žæ ¼çš„ **css** æ–‡ä»¶å¤¹ã€‚

**src** çš„å†…å®¹æ˜¯ä¸»å…¥å£æ–‡ä»¶ **game.ts** ä»¥åŠä¸‰ä¸ªæ–‡ä»¶å¤¹**å¯¹è±¡**ã€**ç±»åž‹**å’Œ **uxã€**å¯¹åº”è¿™äº›å…³é”®æ¦‚å¿µ:

*   **ç‰©ä½“**:æ¸¸æˆä¸­ä½¿ç”¨çš„ç‰©ä½“ï¼Œå¦‚**è›‡**æˆ–**ç¡¬å¸**
*   **ç±»åž‹**:åŸºæœ¬æ•°æ®ç±»åž‹ï¼Œå¦‚**ä½ç½®**ã€**é€Ÿåº¦**ã€**æ–¹å‘**ã€**æ¸¸æˆé”®**
*   **ux** :å¤„ç†æ¸¸æˆæ€§å’Œæ¸²æŸ“çš„ç»„ä»¶ï¼Œæ¯”å¦‚ **Canvas**

æ¯ä¸ªæ–‡ä»¶å¤¹ä¸­éƒ½æœ‰ä¸€ä¸ª **index.ts** æ–‡ä»¶ï¼Œå®ƒåªæ˜¯å°†å…¶ä»–æ–‡ä»¶çš„å†…å®¹åˆ†ç»„å¹¶å¯¼å‡ºåˆ°æ¯ä¸ªæ–‡ä»¶çš„ä¸€ä¸ªæ¨¡å—ä¸­ã€‚è¿™åŒ…æ‹¬äº†æ–‡ä»¶å¤¹ç»“æž„å’Œé¡¹ç›®é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥æŽ¥ä¸‹æ¥æˆ‘ä»¬å°†çœ‹çœ‹ HTML5 å’Œ CSS3 ä¸­å®šä¹‰çš„æ¸¸æˆçš„è¡¨çŽ°å’Œé£Žæ ¼ã€‚

## **HTML å’Œ CSS å®šä¹‰**

è¿™ä¸ªæ¸¸æˆä¾èµ–äºŽ**ç”»å¸ƒ**æ¥å®Œæˆå¤§éƒ¨åˆ†çœŸå®žçš„å±å¹•å·¥ä½œï¼Œæ‰€ä»¥æ¸¸æˆçš„å…¶ä½™éƒ¨åˆ† UX ä¸»è¦æ˜¯åœ¨é‚£é‡Œæ”¯æŒå®ƒã€‚ä¸‹é¢æ¥çœ‹çœ‹**index.html**:

åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ª HTML æ–‡ä»¶æ²¡æœ‰å¤ªå¤šå†…å®¹:ä¸€äº›åŸºæœ¬çš„ç¤¾äº¤å›¾å…ƒæ•°æ®ï¼Œä¸€ä¸ªå¸¦æœ‰å‡ ä¸ªç®€å•çš„**æŒ‰é’®**å’Œ **div** è¯»æ•°çš„**å¤´**ï¼Œä»¥åŠå°†åœ¨å…¶ä¸­ç»˜åˆ¶æ¸¸æˆåŠ¨ä½œçš„**ç”»å¸ƒ**æœ¬èº«ã€‚

æŽ¥ä¸‹æ¥æ˜¯ CSS æ–‡ä»¶ï¼Œ **css/style.css:**

åœ¨ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œ **css/style.css** åœ¨ä¸¤ä¸ªé€‰é¡¹å¡ä¸­éƒ½æ˜¯æ‰“å¼€çš„ï¼Œåœ¨ç¬¬ä¸€ä¸ªé€‰é¡¹å¡ä¸­æ˜¾ç¤ºå‰åŠéƒ¨åˆ†ï¼Œåœ¨å³ä¾§æ˜¾ç¤ºåŽåŠéƒ¨åˆ†ã€‚æ²¡æœ‰å¤ªå¤šçš„ä¸œè¥¿ï¼Œåªæœ‰ä¸€äº›é¢œè‰²å®šä¹‰ï¼Œå±…ä¸­å†…å®¹çš„åŸºæœ¬é¡µé¢ç»“æž„ï¼Œä»¥åŠä¸€äº›æŒ‰é’®ã€é“¾æŽ¥å’Œå…¶ä»–ä¸œè¥¿çš„æ ·å¼ã€‚å¤§éƒ¨åˆ†å·¥ä½œéƒ½å‘ç”Ÿåœ¨**ç”»å¸ƒ**ä¸­ï¼Œæ‰€ä»¥è¿™å‡ ä¸ªæ ·å¼å°±è¶³å¤Ÿè®¾ç½®ä¸€ä¸ªåŸºæœ¬çš„æ¸¸æˆäº†ã€‚ç»“æž„å’Œé£Žæ ¼éƒ½ä¸åœ¨è¯ä¸‹ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ¸¸æˆé€»è¾‘å®žçŽ°ã€‚

## æ ¸å¿ƒç±»åž‹å®šä¹‰

æ–‡ä»¶å¤¹**ã€‚/types** åŒ…å«å‡ ä¸ªç±»ã€æžšä¸¾å’ŒæŽ¥å£ï¼Œå®ƒä»¬æž„æˆäº†æ¸¸æˆä¸­ä½¿ç”¨çš„åŸºæœ¬ç±»åž‹ã€‚è¿™é‡Œæ˜¯ **gameobjects.ts** :

è¿™ä¸ªæ–‡ä»¶å®šä¹‰äº†æ¸¸æˆå¯¹è±¡å’Œæ£‹ç›˜åœ¨å±å¹•ä¸Šç»˜åˆ¶å¯¹è±¡æ‰€ä½¿ç”¨çš„æŽ¥å£ã€‚

æŽ¥ä¸‹æ¥æ˜¯

![](img/45fe62340135dd2bc22ad3f307cf62f8.png)

**ç”¨ **gameobjects.ts** ã€ **position.ts** å’Œ **enums.ts** é”®å…¥**æ–‡ä»¶å¤¹

åœ¨ä¸Šé¢çš„æˆªå›¾ä¸­ï¼Œ**ç±»åž‹**ä¸­çš„å››ä¸ªæ¨¡å—æ–‡ä»¶ä¸­æœ‰ä¸‰ä¸ªæ˜¯æ‰“å¼€çš„ã€‚æ–‡ä»¶ **enums.ts** åŒ…å«å››ç§ç¬¦åˆè¿™äº›è¦æ±‚çš„æžšä¸¾ç±»åž‹:

*   **æ¸¸æˆé”®**:å‘ä¸Š*ã€*å‘ä¸‹*ã€*å‘å·¦*å’Œ*å‘å³*ç®­å¤´é”®çš„é”®å€¼*
*   **å±å¹•è¾¹ç¼˜**:ç”¨äºŽåˆ¤æ–­è›‡æ˜¯å¦ä¸Žå±å¹•è¾¹ç¼˜å‘ç”Ÿç¢°æ’ž
*   **æ–¹å‘**:çŽ©å®¶å½“å‰ç§»åŠ¨çš„æ–¹å‘(å¦‚æžœæœ‰)
*   **é€Ÿåº¦:**çŽ©å®¶å½“å‰åœ¨æ¸¸æˆæ¿ä¸Šç§»åŠ¨çš„é€Ÿåº¦

æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªç”¨äºŽ **Drawable** çš„æŽ¥å£ä»¥åŠä¸¤ä¸ªæ‰©å±•å®ƒçš„æŽ¥å£ï¼Œä¸€ä¸ªç”¨äºŽçŽ©å®¶ï¼Œä¸€ä¸ªç”¨äºŽçŽ©å®¶å¯èƒ½ä¼šç¢°åˆ°çš„æ¸¸æˆç‰©ä½“ã€‚è¿™äº›ä¸­çš„æ¯ä¸€ä¸ªéƒ½æœ‰ä¸€ä¸ª**ä½ç½®**ï¼Œå®ƒè¢«å®šä¹‰ä¸ºå…·æœ‰ä¸€ä¸ª **X** å’Œ **Y** å€¼ä»¥åŠä¸€ä¸ªå¤åˆ¶ä½ç½®çš„æ–¹ä¾¿æ–¹æ³•ã€‚

![](img/768bb91bce8ea5e5c2a946858290ff1c.png)

è¿è¡Œæ¸¸æˆæ—¶é’Ÿçš„ **src/timer.ts** ä¸­çš„ **Timer** ç±»

**ç±»åž‹**ä¸‹çš„æœ€åŽä¸€é¡¹æ˜¯**å®šæ—¶å™¨**ç±»ï¼Œä½œä¸ºæ¸¸æˆçš„ä¸»æ—¶é’Ÿã€‚æ ¹æ®éœ€è¦å¯ä»¥*å¯åŠ¨*ã€*åœæ­¢*ã€*å¤ä½*ã€‚æœ‰ä¸¤ä¸ªæœ¬åœ°å®šä¹‰çš„æžšä¸¾:**æ—¶é’Ÿç±»åž‹**ï¼Œå®ƒè¡¨ç¤ºè®¡æ—¶å™¨æ˜¯å¦æœ‰æŒç»­æ—¶é—´æˆ–æ°¸è¿œè¿è¡Œï¼Œä»¥åŠ**æ—¶é’ŸæŒ‡é’ˆ**ï¼Œå®ƒæä¾›ä¸€ä¸ªä¸»æ—¶é’Ÿâ€œè„‰å†²â€ï¼Œæ¸¸æˆçš„å…¶ä»–éƒ¨åˆ†ä½¿ç”¨å®ƒï¼Œä¾‹å¦‚ï¼Œæ ¹æ®éœ€è¦ä»¥æ­£å¸¸é€Ÿåº¦çš„ä¸€åŠ(æˆ–ä¸¤å€)ç§»åŠ¨çŽ©å®¶å¯¹è±¡ã€‚

è¿™æ¶µç›–äº†æ¸¸æˆä¸­ä½¿ç”¨çš„ä¸»è¦ç±»åž‹ã€‚è¿™äº›å°†åœ¨è®¸å¤šåœ°æ–¹è¢«å¼•ç”¨ï¼Œå¹¶æ ¹æ®éœ€è¦ç”¨äºŽåˆ›å»ºå…¶ä»–æ›´å¤æ‚çš„å¯¹è±¡ã€‚

## æ¸¸æˆå¯¹è±¡ç±»åˆ«

æˆ‘ä»¬è¦æ£€æŸ¥çš„ä¸‹ä¸€ç»„æ¨¡å—æ˜¯æ¸¸æˆ**å¯¹è±¡:**

![](img/f2a69bc3c12212257e70671f8af9bfa3.png)

**ç¡¬å¸**ç±»ä»£è¡¨ä¸€æžšç¡¬å¸ï¼Œå¯ä»¥æ¡èµ·æ¥èŽ·å¾—ç‚¹æ•°

è¿™ç»„ä¸­çš„ç¬¬ä¸€ä¸ªæ˜¯ **Coin** ç±»ï¼Œå®ƒå®žçŽ°äº† **IGameObject** æŽ¥å£ï¼Œè¿™æ„å‘³ç€å®ƒè‡³å°‘å¿…é¡»æœ‰ **handle_collision( )** å’Œ **draw()** æ–¹æ³•ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚è¿™åœ¨æž„å»ºæŸä¸ªä¸œè¥¿çš„è¿‡ç¨‹ä¸­å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºæ‚¨ä¸ä¼šå¸Œæœ›åœ¨ä¸€ç™¾ä¸ªå·¦å³çš„æ¸¸æˆå¯¹è±¡ä¸­çš„ä¸€ä¸ªä¸Šæ„å¤–åœ°é—æ¼è¿™äº›æ–¹æ³•ä¸­çš„ä¸€ä¸ªï¼Œå¯¼è‡´å®ƒè¦ä¹ˆä¸å“åº”çŽ©å®¶ï¼Œä¸åœ¨å±å¹•ä¸Šç»˜åˆ¶ï¼Œè¦ä¹ˆæœ€ç»ˆåœ¨æ£‹ç›˜ä¸Šå‡ºçŽ°ä¸€ä¸ªä¸å¯è§çš„é¡¹ç›®ï¼Œè¯¥é¡¹ç›®æ²¡æœ‰å‡ºçŽ°ï¼Œä½†ä»ä¼šå“åº”çŽ©å®¶çš„ç¢°æ’žã€‚

**Coin** ç±»æœ‰ä¸€äº›é™æ€å±žæ€§ï¼ŒåŒ…æ‹¬é»˜è®¤å€¼å’Œå½“å‰å†…å­˜ä¸­å­˜åœ¨çš„ Coin çš„æ‰€æœ‰å®žä¾‹çš„é™æ€å¼•ç”¨ã€‚è¿™ç§æ–¹æ³•ä½¿å¾—ä»Žé¡¹ç›®æœ¬èº«çš„æ¦‚å¿µå®šä¹‰ä¸­æ“çºµé¡¹ç›®ç»„å˜å¾—éžå¸¸å®¹æ˜“:ä¾‹å¦‚ï¼Œåˆ¶ä½œå¦ä¸€ä¸ªé¡¹ç›®æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œå½“æ”¶é›†åˆ°è¯¥é¡¹ç›®æ—¶ï¼Œä¼šå¯¼è‡´å±å¹•ä¸Šçš„æ‰€æœ‰ç¡¬å¸æ¶ˆå¤±ï¼Œæˆ–å¯¼è‡´æ›´å¤šçš„ç¡¬å¸è½ä¸‹ï¼Œæˆ–ä»»ä½•å…¶ä»–æ•ˆæžœã€‚

å½“**æ‰‹æŸ„ _ ç¢°æ’ž**è¢«è§¦å‘æ—¶ï¼Œæ’žä¸Šå®ƒçš„è›‡å¾—åˆ°ç¡¬å¸çš„æ€»ä»·å€¼å¹¶åŠ åˆ°å®ƒçš„çŽ©å®¶åˆ†æ•°ä¸Šï¼Œç„¶åŽè›‡çš„*æœ€å¤§é•¿åº¦*å¢žåŠ  *8* ï¼Œè¿™å…è®¸è›‡åœ¨æŽ¥ä¸‹æ¥çš„å…«ä¸ªæ—¶é’Ÿå‘¨æœŸå†…å¢žé•¿å…«æ­¥ã€‚ç„¶åŽè°ƒç”¨ **destroy()** æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†ç¡¬å¸ä»Žæ£‹ç›˜ä¸Šç§»é™¤ï¼Œå¹¶æ¸…é™¤ä»»ä½•å‰©ä½™çš„ç—•è¿¹ã€‚

![](img/5e5dca04988caa666bd608f43859095e.png)

å±•ç¤ºäº† **draw()** å’Œ **destroy()** æ–¹æ³•çš„ **Coin** ç±»

æ¯ä¸ªå¯¹è±¡éƒ½æœ‰è‡ªå·±çš„è¿™äº›æ–¹æ³•çš„å®žçŽ°ï¼Œè¿™å…è®¸æœ‰å¾ˆå¤§çš„çµæ´»æ€§ï¼ŒåŒæ—¶ä¿æŒä¸€ä¸ªç®€å•æœ‰æ•ˆçš„ä½“ç³»ç»“æž„ï¼Œä½¿æ•´ä¸ªæ¸¸æˆè®¾è®¡å¤„äºŽå¯æŽ§çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨ **handle_collision()** æˆ– **destroy()** æ–¹æ³•ä¸­åŠ å…¥ä¸€äº›ç‰¹æ®Šæ•ˆæžœï¼Œè€Œå¯¹ç³»ç»Ÿä¸­çš„å…¶ä»–éƒ¨åˆ†å‡ ä¹Žæ²¡æœ‰å½±å“ã€‚è¿™æ˜¯å¦‚ä½•åˆ©ç”¨ TypeScript çš„ä¸€äº›å¼ºå¤§çš„ [OOP](https://en.wikipedia.org/wiki/Object-oriented_programming) ç‰¹æ€§çš„ä¸€ä¸ªä¾‹å­ã€‚

æŽ¥ä¸‹æ¥æ˜¯ **FastPlayer** å’Œ **SlowPlayer** å¯¹è±¡ï¼Œåˆ†åˆ«åŠ é€Ÿå’Œå‡é€ŸçŽ©å®¶ã€‚ç”±äºŽè¿™å®žé™…ä¸Šæ˜¯åŒä¸€äº‹ç‰©çš„ä¸¤ç§å˜ä½“ï¼Œæˆ‘å°†å±•ç¤ºå…¶ä¸­çš„ä¸€ç§ï¼Œ **FastPlayerï¼Œ**ä½œä¸ºç¤ºä¾‹:

![](img/fc9ac3fa3276f16e7ec2c2b9918978e6.png)

å¿«é€ŸçŽ©å®¶èŒä¸šï¼Œå½“è¢«æ”¶é›†æ—¶ä¼šä½¿çŽ©å®¶å¿«é€Ÿç§»åŠ¨

**FastPlayer** ç±»çœ‹èµ·æ¥éžå¸¸ç±»ä¼¼äºŽä¹‹å‰çš„ **Coin** ç¤ºä¾‹ã€‚è¿™é‡Œçš„ä¸»è¦åŒºåˆ«æ˜¯ **handle_collision()** æ”¹å˜è›‡ç§»åŠ¨çš„é€Ÿåº¦ï¼Œè€Œ **draw()** äº§ç”Ÿä¸åŒçš„å›¾å½¢ã€‚æŽ¥ä¸‹æ¥æ˜¯ç»„æˆè›‡çš„ç±»ï¼Œ**è›‡æ®µ**å’Œ**è›‡:**

![](img/c80ea2c16fedb7a1c977015f247d2f4a.png)

å°†è›‡å—ç»˜åˆ¶åˆ°å±å¹•ä¸Šçš„**è›‡æ®µ**ç±»

**SnakeSegment** ç±»å®šä¹‰äº†è¦åœ¨å±å¹•ä¸Šç»˜åˆ¶çš„ä¸€æ®µè›‡ã€‚å±å¹•ä¸Šçš„æ¯æ¡è›‡éƒ½ç”±ä¸€ç»„è¿™æ ·çš„è›‡ç»„æˆï¼Œæ¯æ¡è›‡éƒ½æœ‰ä¸€ä¸ª*ä½ç½®*ç”¨äºŽå®šä½å¹¶å°†å…¶ç»˜åˆ¶åˆ°æ¿ä¸Šï¼Œè¿˜æœ‰ä¸€ä¸ª*é¢œè‰²*ï¼Œå®ƒé€šè¿‡**é¢œè‰²**å˜é‡ä¸­å®šä¹‰çš„å…«ä¸ªå€¼è‡ªåŠ¨æ—‹è½¬ã€‚ä¸€å¤©æ™šä¸Šï¼Œæˆ‘ç»™å¥³å„¿çœ‹è¿™ä¸ªæ¸¸æˆï¼Œå¥¹è§‰å¾—è¿™ä¸ªæ¸¸æˆæœ‰å½©è™¹æ•ˆæžœä¼šæ›´é…·ï¼Œå°±åƒä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„è¿·å› ï¼Œäº‹å®žå°±æ˜¯å¦‚æ­¤ã€‚

![](img/29edc05ca6225afcfad7d49d15c85e98.png)

å…·æœ‰çŽ©å®¶æŽ§åˆ¶å™¨å¯¹è±¡å„ç§å±žæ€§çš„ **Snake** ç±»

**objects** æ–‡ä»¶å¤¹ä¸­çš„æœ€åŽä¸€ä¸ªæ¨¡å—æ˜¯ **snake.ts** ä¸­çš„ **Snake** ç±»ï¼Œå®ƒæŽ§åˆ¶ç€æ’­æ”¾å™¨çš„å¯¿å‘½å’Œ Snake å¯¹è±¡æœ¬èº«çš„å®žé™…æ¸²æŸ“ã€‚åœ¨ä¸Šé¢çš„æˆªå›¾ä¸­æ˜¯ä¸€ä¸ªé™æ€çš„ *default_length* ï¼Œå®ƒå†³å®šäº†åœ¨çŽ©å®¶æ²¡æœ‰æ”¶é›†åˆ°ä»»ä½•ç¡¬å¸çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤æƒ…å†µä¸‹è›‡ä¼šå¾—åˆ°å¤šé•¿æ—¶é—´ã€‚ *jump_distance* å±žæ€§å†³å®šäº†å½“ *jump* é”®è¢«æŒ‰ä¸‹æ—¶ï¼Œè›‡ä¼šè·³å¤šè¿œï¼Œè¿™ä½¿å¾—è›‡è·³è¿‡é‚£äº›è¢«è·³è¿‡çš„ç©ºé—´ä¸­çš„éšœç¢ç‰©æˆ–ç‰©å“ã€‚

è¿˜æœ‰ç”¨äºŽ *skip_next_turn* ã€ *hit_detected* å’Œ *is_alive* çš„*å¸ƒå°”*å±žæ€§ï¼Œå®ƒä»¬æŽ§åˆ¶æ¸¸æˆåŠŸèƒ½å¹¶å…è®¸å¥å…¨æ€§æ£€æŸ¥ï¼Œå¦‚åœ¨ç»˜åˆ¶ä¹‹å‰ç¡®ä¿çŽ©å®¶ä»ç„¶æ´»ç€ç­‰ç­‰ã€‚è¿˜æœ‰*é€Ÿåº¦*ã€*æ–¹å‘*å’Œ*ä½ç½®*çš„å±žæ€§ï¼Œè¿™äº›å±žæ€§åœ¨è¿™é‡Œä¸è¨€è‡ªæ˜Žã€‚é»˜è®¤çš„é€Ÿåº¦å’Œæ–¹å‘åˆ†åˆ«æ˜¯*æ­£å¸¸*å’Œ*æ— *ï¼Œè€Œ*ä½ç½®*æœ€åˆæ˜¯æœªå®šä¹‰çš„ï¼Œå½“è›‡è¢«æ”¾ç½®åœ¨æ¸¸æˆæ¿ä¸Šæ—¶è¢«è®¾ç½®ã€‚

é™¤äº† *hi_score* ã€ *points* å’Œ*lifes*çš„æ ‡å‡†è´¹ç”¨å±žæ€§ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªåä¸º *segment* çš„ **SnakeSegment** å¯¹è±¡æ•°ç»„ï¼Œç”¨äºŽä¿å­˜æ£‹ç›˜ä¸Šè·Ÿéšå…¶åŽçš„å„ä¸ªè›‡å—ã€‚è¿˜å¯ä»¥çœ‹åˆ°**æž„é€ å‡½æ•°**å’Œ **jump()** æ–¹æ³•çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥æ–¹æ³•è®¡ç®—å‡ºçŽ©å®¶è¡Œè¿›çš„æ–¹å‘ï¼Œå¹¶å°†è›‡å¤´å‘å‰ç§»åŠ¨ *jump_distance* çš„å€¼ï¼Œä»Žè€Œå¯¼è‡´å…¶ä½™çš„æ®µä¹Ÿè·Ÿç€ç§»åŠ¨ã€‚

![](img/66e01e97198ba80de75f513e9f90da30.png)

æ›´å¤šçš„**è›‡**ç±»æ‹¥æœ‰å„ç§æ¸¸æˆæ–¹å¼

Snake ç±»ä¸­è¿˜æœ‰ä¸€äº›å¤„ç†å®žé™…æ¸¸æˆçš„æ–¹æ³•ã€‚åœ¨ä¸Šé¢çš„æˆªå›¾ä¸­ï¼Œ **on_hit_screen_edge()** æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œå› ä¸ºå®ƒæ›¾ç»è¢«è®¾ç½®ä¸ºå½“è›‡ä¸Žå¢™å£ç›¸æ’žæ—¶æ€æ­»çŽ©å®¶ï¼Œä½†æˆ‘æƒ³è®©è›‡è·³åˆ°å¦ä¸€è¾¹ï¼Œæ‰€ä»¥æˆ‘åˆ é™¤äº†è¿™æ®µä»£ç ï¼Œç•™ä¸‹äº†ä¸€ä¸ªå¸¦æœ‰ *TODO* å’Œç©º *switch* è¯­å¥çš„[æ–¹æ³•å­˜æ ¹](https://en.wikipedia.org/wiki/Method_stub)ã€‚

æˆ‘ä»¬è¿˜å‘çŽ°äº† **die()** æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°† *hit_detected* è®¾ç½®ä¸º *trueï¼Œ*è®¾ç½®å¹¶é‡ç½®é«˜åˆ†ï¼Œåœ¨å¤±åŽ»ç”Ÿå‘½æ—¶é‡ç½®æ¸¸æˆï¼Œå¹¶ä¸”è¿˜é‡ç½®è›‡çš„ä½ç½®å’Œæ–¹å‘ä»¥åœ¨ä¸‹ä¸€è½®é‡æ–°å¼€å§‹ã€‚è¿˜æœ‰ä¸€ä¸ªæ–¹æ³• **set_speed()** ï¼Œå®ƒæŽ¥å—ä¸€ä¸ª **Speed** å¯¹è±¡å¹¶ä»Žä¸­æ›´æ–°è›‡çš„é€Ÿåº¦ã€‚

![](img/ca062397d05a8fe8e182c5ffb457aa07.png)

æ›´å¤šçš„**è›‡**ç±»å¸¦æœ‰ **process_turn()** æ–¹æ³•

Snake ç±»è¿˜æœ‰ä¸€ä¸ª **process_turn()** æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ ¹æ®è›‡çš„å½“å‰é€Ÿåº¦ã€ä½ç½®å’Œæ–¹å‘ä»¥åŠå®ƒè¯•å›¾å æ®çš„ç©ºé—´ä¸­å‘ç”Ÿçš„ä»»ä½•äº‹æƒ…æ¥ç¡®å®šæŽ¥ä¸‹æ¥å°†è¦å‘ç”Ÿçš„äº‹æƒ…ã€‚é¦–å…ˆï¼Œå¦‚æžœè›‡å·²ç»æ­»äº†ï¼Œä»€ä¹ˆéƒ½ä¸è¦åšã€‚å¦‚æžœè›‡ç§»åŠ¨å¾ˆå¿«ï¼Œè·³è¿‡æ¯éš”ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸçš„å¤„ç†(è®©å®ƒæ¯è½¬ç§»åŠ¨ä¸¤æ ¼)ï¼ŒåŒæ ·ï¼Œå¦‚æžœçŽ©å®¶ç§»åŠ¨å¾ˆæ…¢ï¼Œé€šè¿‡è·³è¿‡æ¯éš”ä¸€ä¸ªå›žåˆè®©å®ƒæ‹–å‡ºæ¥ã€‚æŽ¥ä¸‹æ¥ï¼Œæ‰§è¡Œä¸€äº›æ£€æŸ¥å’Œæ›´æ–°ï¼Œä»¥æ›´æ–°è›‡*çš„ä½ç½®*å¹¶ç¡®å®šå®ƒæ˜¯å¦åœ¨ç§»åŠ¨ï¼Œç„¶åŽå¤„ç†è¯¸å¦‚å±å¹•çŽ¯ç»•å’Œä¸Žå æ®è¦è¿›å…¥çš„ç©ºé—´çš„ç‰©ä½“ç¢°æ’žçš„äº‹ä»¶:

![](img/c6224bac6b1fb76ba40799d104eccae5.png)

ç”šè‡³æ›´å¤šçš„**è›‡**ç±»çš„æ¸¸æˆæ€§å’Œå®šä½é€»è¾‘

å¦‚æžœçŽ©å®¶è¿˜æ´»ç€ï¼Œå¹¶ä¸”åœ¨æ£‹ç›˜ä¸Šèµ°æ¥èµ°åŽ»ï¼Œå°±ä¼šè°ƒç”¨ update_board()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šå°†æ¯ä¸ªå•ç‹¬çš„è›‡æ®µé‡æ–°ç»˜åˆ¶åˆ°æ£‹ç›˜ä¸Šï¼Œä½¿æ¯ä¸ªè›‡æ®µéƒ½è·Ÿéšå‰é¢çš„è›‡æ®µï¼Œæ— è®ºè›‡æ®µåœ¨å“ªé‡Œã€‚

è¿™å°±å®Œæˆäº†å¯¹ **Snake** ç±»çš„å¤„ç†ï¼Œè¯¥ç±»åŒ…å«äº†å¤„ç†å±å¹•å†…å¤–çš„è›‡çš„å¤§éƒ¨åˆ†æ¸¸æˆé€»è¾‘ã€‚è¿™å°±æ˜¯ [OOP](https://en.wikipedia.org/wiki/Object-oriented_programming) çš„æ¦‚å¿µçœŸæ­£æ´¾ä¸Šç”¨åœºçš„åœ°æ–¹ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰çš„ snake é€»è¾‘ä¿å­˜åœ¨ä¸€ä¸ªåä¸º **snake.ts** çš„æ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯åˆ†æ•£åœ¨éšæœºçš„æ–‡ä»¶ä¸­ã€‚

## æŽ§åˆ¶å’Œæ¸¸æˆæ€§

åœ¨ **ux** æ–‡ä»¶å¤¹ä¸­æ˜¯æŽ¥å—è¾“å…¥æŽ§åˆ¶å’Œæ¸²æŸ“æ¸¸æˆå›¾å½¢è¾“å‡ºçš„ç±»ã€‚æˆ‘ä»¬é¦–å…ˆè¦çœ‹çš„æ˜¯ **src/ux/board.ts** :

![](img/122a0eaee8ec402ef3153b36f53e5ce3.png)

**Board** ç±»ï¼Œæœ‰å„ç§å¤„ç†æ¸¸æˆä¸­ç‰©ä½“çš„æ–¹æ³•

**æ£‹ç›˜**ç±»åŒ…å«å¤„ç†æ¸¸æˆæ£‹ç›˜çš„å„ç§é™æ€æ–¹æ³•å’Œå±žæ€§ï¼Œè¿™æ˜¯ä¸€ä¸ªç½‘æ ¼ï¼Œå…·æœ‰*é«˜åº¦*å’Œ*å®½åº¦*ä»¥åŠ*å—å¤§å°*ï¼Œå®šä¹‰äº†æ¯ä¸ªæ¸¸æˆæ£‹ç›˜æ–¹å—çš„é«˜åº¦å’Œå®½åº¦(ä»¥åƒç´ ä¸ºå•ä½)ã€‚å®žé™…çš„æ£‹ç›˜æœ¬èº«ç”±*ç½‘æ ¼*å±žæ€§è¡¨ç¤ºï¼Œè¿™æ˜¯ä¸€ä¸ª **IDrawableã€**çš„æ•°ç»„ï¼Œå®ƒå…è®¸æŽ§åˆ¶å™¨å¾ˆå®¹æ˜“åœ°è·Ÿè¸ªåœ¨ä»»ä½•ç»™å®šæ—¶é—´æ­£åœ¨çŽ©çš„é¡¹ç›®ï¼Œå¹¶éšç€æ¸¸æˆçš„è¿›è¡Œæ›´æ–°å®ƒä»¬ã€‚

æœ‰å„ç§æ–¹æ³•å¦‚ **place_object()** å’Œ **remove_object_at()** è¿™äº›æ–¹æ³•å¤§å¤šæ˜¯è‡ªè§£é‡Šçš„ï¼Œä¸€æ¬¡åªå¤„ç†ä¸€ä¸¤ä»¶äº‹æƒ…ã€‚è¿™æ˜¯æœ‰æ„çš„ï¼Œå› ä¸ºæž¶æž„éžå¸¸æ˜Žæ˜¾ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°æ›´æ–°å’Œä¿®æ”¹ï¼Œè€Œä¸å¤ªå¯èƒ½ç ´åå…¶ä»–ä¸œè¥¿ï¼Œå› ä¸ºå°±æ¯ä¸ªå•ç‹¬çš„éƒ¨åˆ†è€Œè¨€ï¼Œå…¶ä»–æ‰€æœ‰ä¸œè¥¿ä»ç„¶æŒ‰é¢„æœŸå·¥ä½œã€‚æ¸¸æˆå¼€å‘é€šå¸¸ä»¥è¿™ç§æ–¹å¼å¾ˆå¥½åœ°é€‚åº”é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œå› ä¸ºç¨‹åºæœ‰æ•ˆåœ°å¤„ç†ç›¸äº’äº¤äº’çš„è™šæ‹Ÿå¯¹è±¡ï¼Œä»¥åŠåƒæ¸¸æˆæ£‹ç›˜è¿™æ ·çš„ä¸œè¥¿ï¼Œè€Œæ¸¸æˆæ£‹ç›˜åˆæ˜¯å¦ä¸€ä¸ªæ¸¸æˆå¯¹è±¡ã€‚

![](img/2935032b7c812dbb475fc393fd37ff13.png)

å¸¦æœ‰**generate _ random _ position()**ã€ **init()** å’Œ **draw()** æ–¹æ³•çš„**æ¿**ç±»

æˆ‘ä»¬è¿˜åœ¨ Board ç±»ä¸­æ‰¾åˆ°äº†**generate _ random _ Position()**æ–¹æ³•ï¼Œå®ƒä½¿ç”¨ä¸€äº›æ ‡å‡†çš„ *Math.floor* å’Œ *Math.random* JavaScript å‡½æ•°æ¥å¾—å‡ºä¸€ä¸ªéšæœºçš„æ¿ä½ç½®ï¼Œç„¶åŽå°†å…¶ä½œä¸º **Position** å¯¹è±¡è¿”å›žã€‚init()æ–¹æ³•é€šè¿‡å°†**ç”»å¸ƒ**çš„é«˜åº¦å’Œå®½åº¦é™¤ä»¥æ£‹ç›˜çš„ *block_sizeï¼Œ*æ¥è®¡ç®—æ£‹ç›˜çš„*é«˜åº¦*å’Œ*å®½åº¦*ï¼Œç„¶åŽç”¨ç©ºæ•°ç»„åˆå§‹åŒ–ç½‘æ ¼æœ¬èº«ã€‚ **draw()** æ–¹æ³•å……åˆ†åˆ©ç”¨äº†å¯äº’æ¢çš„å¯¹è±¡æŽ¥å£ï¼Œå®ƒéåŽ†æ£‹ç›˜ï¼Œå¹¶åœ¨å®žçŽ° **IDrawableã€**çš„å¯¹è±¡çš„æ¯ä¸ªå®žä¾‹ä¸Šè°ƒç”¨ **draw()** ï¼Œè€Œä¸ç®¡è¯¥å¯¹è±¡æ˜¯è›‡ã€ç¡¬å¸è¿˜æ˜¯å…¶ä»–å±å¹•ä¸Šçš„é¡¹ç›®ã€‚

æŽ¥ä¸‹æ¥æ˜¯ **src/ux/canvas.ts** ä¸­çš„ **Canvas** ç±»:

![](img/4aa0ca5f888a344c6d3e56683582696f.png)

ç”¨äºŽç»˜åˆ¶æ¸¸æˆå†…å®¹çš„ç²¾ç®€çš„**ç”»å¸ƒ**ç±»

canvas æ˜¯ä¸€ä¸ªéžå¸¸ç®€å•çš„æŠ½è±¡ç±»ï¼Œå®ƒæœ‰ä¸€ä¸ª*å®½åº¦*å’Œ*é«˜åº¦*ï¼Œå®ƒä»¬å·²ç»è¢«åˆå§‹åŒ–ä¸ºæ€€æ—§çš„åˆ†è¾¨çŽ‡ *640x400* ï¼Œè¿˜æœ‰ä¸€ä¸ª*ä¸Šä¸‹æ–‡*å±žæ€§ï¼Œç”¨äºŽä¿å­˜å¯¹ HTML5 å±å¹•ä¸Š Canvas ä¸Šä¸‹æ–‡çš„å¼•ç”¨ï¼Œè¯¥ä¸Šä¸‹æ–‡ç”¨äºŽåœ¨å±å¹•ä¸Šå®žé™…ç»˜åˆ¶å›¾å½¢ã€‚æœ‰ä¸€ä¸ª **init()** æ–¹æ³•ä»¥åŠä¸€äº›ç»˜åˆ¶åŸºæœ¬å½¢çŠ¶çš„æ–¹ä¾¿æ–¹æ³•ï¼Œå·®ä¸å¤šå°±æ˜¯è¿™äº›äº†ã€‚æŽ¥ä¸‹æ¥æˆ‘ä»¬å°†çœ‹çœ‹ **src/ux/console.ts** ä¸­çš„æŽ§åˆ¶å°:

![](img/01d8ec8cfa15b41851c44cb1452bedae.png)

å¸¦æœ‰å‡ ä¸ªæ ‡å‡†æŽ§åˆ¶å°æŒ‰é’®çš„**æŽ§åˆ¶å°**ç±»

**æŽ§åˆ¶å°**ç±»éžå¸¸ç®€å•ï¼Œå¼•ç”¨äº†æŽ§åˆ¶æ¸¸æˆçŠ¶æ€(å¼€å§‹ã€æš‚åœå’Œé‡ç½®)çš„ä¸‰ä¸ªæŒ‰é’®ï¼Œå¹¶å¸¦æœ‰ *onclick* äº‹ä»¶çš„å¤„ç†ç¨‹åºï¼Œè¿™äº›äº‹ä»¶è°ƒç”¨**æ¸¸æˆ**å¯¹è±¡ä¸Šçš„å„ä¸ªæ¸¸æˆå‡½æ•°ã€‚

æŽ¥ä¸‹æ¥æ˜¯ **src/ux/controls.ts** ä¸­çš„**æŽ§ä»¶**ç±»:

![](img/811f23f847e056c37b8f48fefaef5d2d.png)

**æŽ§åˆ¶**ç±»ï¼Œè¯¥ç±»å¤„ç†æ¸¸æˆçš„æŽ§åˆ¶å™¨è¾“å…¥

**æŽ§ä»¶**ç±»ä¸“é—¨ç”¨äºŽå¤„ç†ç”¨æˆ·è¾“å…¥ã€‚æœ‰ä¸€ä¸ªç”¨äºŽ *on_key_up* çš„å¤„ç†ç¨‹åº(å®ƒç”±**æ¸¸æˆ**ç±»è¿žæŽ¥ï¼Œæˆ‘ä»¬å°†åœ¨åŽé¢çœ‹åˆ°),å®ƒåªæ˜¯èŽ·å–å½“å‰äº‹ä»¶çš„å…³é”®ä»£ç å¹¶å°†å…¶å­˜å‚¨åœ¨æœ¬åœ°ã€‚è¿™æ ·ï¼ŒçŽ©å®¶å¯ä»¥åœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…æŒ‰ä¸‹å¤šä¸ªæŽ§åˆ¶é”®ï¼Œè€ŒæŽ§åˆ¶å™¨å°†åªä½¿ç”¨æœ€åŽä¸€ä¸ªæŒ‰ä¸‹çš„é”®ã€‚è¿™åœ¨æ¸¸æˆä¸­éžå¸¸æœ‰ç”¨ï¼Œå¯ä»¥çž¬é—´æ”¹å˜è›‡çš„ç§»åŠ¨æ–¹å‘ã€‚

æ¯æ¬¡è°ƒç”¨ **process_input()** æ—¶ï¼Œå³æ¯ä¸ªæ¸¸æˆæ—¶é’Ÿè„‰å†²ä¸€æ¬¡ï¼Œä»¥æ›´æ–°æ¯å›žåˆçš„æ¸¸æˆçŠ¶æ€ï¼Œéƒ½ä¼šæ‰§è¡Œä¸€ç³»åˆ—æ£€æŸ¥æ¥ç¡®å®šä¸‹ä¸€æ­¥è¦åšä»€ä¹ˆã€‚å¦‚æžœæ²¡æœ‰æä¾›ä»»ä½•è¾“å…¥ï¼Œå°±è®©ä¸€åˆ‡ä¿æŒåŽŸæ ·ã€‚è¿™å°†å¯¼è‡´ï¼Œä¾‹å¦‚ï¼Œå¦‚æžœæˆ‘ä»¬ä¸åŽ»ç®¡å®ƒï¼Œè›‡ä¼šä¸€ç›´åœ¨å±å¹•ä¸Šç§»åŠ¨ã€‚è›‡å¯ä»¥å‘é™¤äº†å®ƒæ¥çš„æ–¹å‘ä»¥å¤–çš„ä»»ä½•æ–¹å‘ç§»åŠ¨ï¼Œå› ä¸ºå®ƒä¸èƒ½ç©¿è¿‡è‡ªå·±ã€‚å¦‚æžœæœ€åŽæŒ‰ä¸‹çš„é”®æ˜¯ç©ºæ ¼é”®ï¼Œåˆ™åœ¨è›‡ä¸Šè°ƒç”¨ **jump()** æ–¹æ³•ã€‚ä¸€æ—¦ *last_key* å·²ç»è¢« Controls ç±»ä½¿ç”¨ï¼Œå®ƒå°±è¢«ä¸¢å¼ƒå¹¶è¢«è®¾ç½®å›ž *null* ï¼Œå› ä¸ºè¿™ä¸ªç±»ä¸Žæ¸¸æˆé€»è¾‘çš„å…¶ä½™éƒ¨åˆ†æ— å…³ï¼Œå®ƒåªæ˜¯è€å¿ƒåœ°ç­‰å¾…æ•èŽ·(ä¹Ÿè®¸å¤„ç†)æŽ§åˆ¶å™¨è¾“å…¥ã€‚

æŽ¥ä¸‹æ¥æ˜¯ **srx/ux/gui.ts** ä¸­çš„ **GUI** ç±»:

![](img/25f9279aeefe03bb8d0b8eefe8adb2f7.png)

å‘ˆçŽ°æ¸¸æˆæŒ‡æ ‡å’Œæ–‡æœ¬çš„ **GUI** ç±»

GUI ç±»ä¹Ÿéžå¸¸ç®€å•ï¼Œä»…ç”¨äºŽç»˜åˆ¶åˆ†æ•°å’Œå‰©ä½™ç”Ÿå‘½æ•°ã€‚å®ƒåŒ…å«ä¸€äº› DOM å…ƒç´ ï¼Œå¹¶æ ¹æ®æ¸¸æˆçŠ¶æ€çš„å„ç§å±žæ€§æ›´æ–°å®ƒä»¬çš„æ–‡æœ¬ã€‚

æ‰€æœ‰æ”¯æŒçš„ç±»å’Œç±»åž‹å®šä¹‰éƒ½å·²å®Œæˆï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹æœ€åŽä¸€ä¸ªã€‚æœ¬é¡¹ç›®ä¸­ ts æ–‡ä»¶ï¼Œ **game.ts** :

![](img/f32b26610e4abb89537ac829d9cd1cb6.png)

æ¸¸æˆçš„ä¸»å…¥å£ï¼Œ**æ¸¸æˆ**ç±»

æ¸¸æˆç±»ä½œä¸ºæ¸¸æˆçš„ä¸»è¦å…¥å£ç‚¹å’ŒæŽ§åˆ¶å™¨ã€‚é©±åŠ¨æ¸¸æˆåŠ¨ä½œæ ¸å¿ƒçš„ *clock* å’Œ *player_one* æœ‰é™æ€å±žæ€§ï¼Œè¿˜æœ‰ä»Ž *0 å¼€å§‹çš„å½“å‰ *hi_score* ã€*å’Œ *is_running* ç”¨äºŽè®¾ç½®(å¹¶æ£€æŸ¥)æ¸¸æˆæ˜¯å¦æ­£åœ¨è¿è¡Œã€‚

**init()** æ–¹æ³•åªåœ¨æ¸¸æˆç½‘ç«™åŠ è½½æ—¶è°ƒç”¨ä¸€æ¬¡ï¼Œåˆå§‹åŒ– **canvas** å¯¹è±¡ï¼Œå¹¶å¼€å§‹å°† *onkeyup* äº‹ä»¶è½¬å‘ç»™æ¸¸æˆæŽ§åˆ¶å™¨è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚å½“è¿™äº›ä»»åŠ¡å®Œæˆå¹¶ä¸”æ¯å½“æ¸¸æˆè¢«é‡ç½®æ—¶ï¼Œè°ƒç”¨ **ready()** æ–¹æ³•ï¼Œè¿™åˆé‡æ–°åˆå§‹åŒ–å„ç§å…¶ä»–æ¸¸æˆç»„ä»¶ï¼ŒåŒ…æ‹¬**æ£‹ç›˜**ã€**æ—¶é’Ÿ**å’Œ**è›‡**ã€‚

å½“ **start()** æ–¹æ³•å¯åŠ¨æ¸¸æˆæ—¶ï¼Œé¦–å…ˆè¿›è¡Œæ£€æŸ¥ä»¥ç¡®ä¿æ¸¸æˆå°šæœªè¿è¡Œæˆ–å¤„äºŽæš‚åœçŠ¶æ€ï¼Œæ­¤æ—¶æ¸¸æˆå°†æ ¹æ®æ—¶é’Ÿä¸Š *is_paused* çš„å½“å‰çŠ¶æ€ç»§ç»­æˆ–æš‚åœ/å–æ¶ˆæš‚åœã€‚ä¸€æ—¦è¿™äº›æ£€æŸ¥é€šè¿‡ï¼Œå°±å¼€å§‹è®¡æ—¶ã€‚

![](img/e5a3ed76838d61cad0e88ef4026aa523.png)

**æ¸¸æˆçš„**ç±»æœ‰**æš‚åœ()**ã€**å¤ä½()**å’Œ **on_clock_tick()** æ–¹æ³•

é™¤äº†å¯åŠ¨æ¸¸æˆï¼Œæˆ‘ä»¬è¿˜éœ€è¦èƒ½å¤Ÿæš‚åœå’Œé‡ç½®å®ƒã€‚ **pause()** æ–¹æ³•æ£€æŸ¥æ¸¸æˆæ—¶é’Ÿä¸Š *is_paused* çš„å½“å‰çŠ¶æ€ï¼Œç„¶åŽæ ¹æ®éœ€è¦æš‚åœæˆ–æ¢å¤æ¸¸æˆã€‚ **reset()** æ–¹æ³•ä¼šåœæ­¢æ¸¸æˆæ—¶é’Ÿ(å¦‚æžœå­˜åœ¨)ï¼Œå°† *is_running* è®¾ç½®ä¸º falseï¼Œç„¶åŽè°ƒç”¨ **ready()** å°†æ¸¸æˆç»†èŠ‚é‡æ–°åˆå§‹åŒ–å›žé»˜è®¤å€¼ã€‚

ç›®å‰è¿˜åœ¨å¼€å‘ä¸­çš„ **on_clock_tick()** çš„å†…å®¹æœ‰äº›æ··ä¹±ï¼Œä½†æ˜¯åŸºæœ¬æ€æƒ³åœ¨è¿™é‡Œã€‚æŽ§åˆ¶å™¨é€šè¿‡ **process_input()** æŽ¥æ”¶æ¯ä¸ªæ—¶é’Ÿè„‰å†²è¾“å…¥ã€‚æŽ¥ä¸‹æ¥ï¼Œé€šè¿‡åœ¨çŽ©å®¶çš„æ¸¸æˆæ£‹å­(è›‡)ä¸Šè°ƒç”¨ **process_turn()** æ¥å†³å®šçŽ©å®¶çš„å‘½è¿ã€‚

åœ¨å¶æ•°æ—¶é’Ÿè„‰å†²ä¸Šï¼Œé€šè¿‡åœ¨æ•´ä¸ªæ£‹ç›˜ä¸Šåˆ†æ•£ä¸€äº›ç¡¬å¸å’Œç”µæºï¼Œä¸€äº›ä¸´æ—¶çš„é¡¹ç›®éšæœºåŒ–é€»è¾‘è¢«æ‰§è¡Œä»¥ä½¿æ¸¸æˆæ›´æœ‰è¶£ã€‚è¿™ä¸ªçš„ä»£ç å¯èƒ½ä¼šåœ¨ä»¥åŽæ”¹å˜ï¼Œä»¥é€‚åº”æ›´å¤æ‚çš„æ¸¸æˆé€»è¾‘æ¥äº§ç”Ÿå’Œåˆ†é…éšæœºç‰©å“ã€‚

æˆªå›¾ä¸­æ²¡æœ‰çš„æ˜¯ **on_clock_tick()æœ€åŽçš„ ***Board.draw()*** å’Œ ***GUI.draw()*** æ–¹æ³•è°ƒç”¨ã€‚è¿™äº›åªæ˜¯è°ƒç”¨æ¯ä¸ªå¯¹è±¡çš„ç»˜åˆ¶æ–¹æ³•ï¼Œç”¨æ›´æ–°çš„å†…å®¹ç»˜åˆ¶å±å¹•ã€‚**

## ç»“è®º

æˆ‘å¸Œæœ›ä½ å–œæ¬¢è¿™ç¯‡å…³äºŽç”¨ TypeScript æž„å»ºç®€å•çš„ç»å…¸ 2D æ¸¸æˆçš„æ–‡ç« ã€‚è¿™ä¸ªåŸºæœ¬çš„æ¸¸æˆâ€œå¼•æ“Žâ€å¯ä»¥ä»¥æ— æ•°ç§æ–¹å¼è¿›è¡Œä¿®æ”¹æˆ–å‡çº§ï¼Œç”¨äºŽä»Žåœ¨çº¿è±¡æ£‹åˆ°åŸºäºŽç½‘ç»œçš„ RPG æ¸¸æˆæˆ–ä»»ä½•å…¶ä»–æ¸¸æˆï¼Œåªå—å¼€å‘è€…æƒ³è±¡åŠ›çš„é™åˆ¶ã€‚

æ„Ÿè°¢é˜…è¯»ï¼

> è‚¯å°¼æ–¯Â·é›·åˆ©( [8_bit_hacker](https://twitter.com/8_bit_hacker) )æ˜¯ [LevelUP](https://lvl-up.tech/) çš„ CTO