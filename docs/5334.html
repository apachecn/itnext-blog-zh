<html>
<head>
<title>Practical example of using K8s PV, PVC with Pods</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨K8s PVã€PVCå’Œpodçš„å®ä¾‹</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/practical-example-of-using-k8s-pv-pvc-with-pods-5471b91d2477?source=collection_archive---------0-----------------------#2021-02-12">https://itnext.io/practical-example-of-using-k8s-pv-pvc-with-pods-5471b91d2477?source=collection_archive---------0-----------------------#2021-02-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/4d6092810d200380e1f3c07953602649.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uODrVUCUfkB7bHmJvhA8bQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://www.freepik.com/vectors/technology" rel="noopener ugc nofollow" target="_blank">æ¥æº</a></figcaption></figure><p id="c662" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">åœ¨å…³äº<a class="ae kc" href="https://medium.com/swlh/k8s-volumes-claims-part2-70b6cefd9d5a" rel="noopener">K8s:Volumes&amp;Claimsâ€”part 2</a>çš„ä¸Šä¸€ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº†å…³äº<a class="ae kc" href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistent-volumes" rel="noopener ugc nofollow" target="_blank"> PersistentVolume </a>ã€<a class="ae kc" href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims" rel="noopener ugc nofollow" target="_blank"> PersistentVolumeClaim </a>æ¦‚å¿µçš„ç»†èŠ‚ã€‚åœ¨<a class="ae kc" href="https://medium.com/swlh/k8s-volumes-claims-part2-70b6cefd9d5a" rel="noopener">ä¸Šä¸€ç¯‡åšå®¢</a>ä¸­ï¼Œæˆ‘ä»¬è¿˜å­¦ä¹ äº†PODså¦‚ä½•ä½¿ç”¨PersistentVolumeClaimã€‚åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼Œç”¨ä¸‹é¢çš„ç»“æ„å°†æ‰€æœ‰è¿™äº›æ¦‚å¿µç»“åˆåœ¨ä¸€èµ·:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="5b51" class="lk ll iq lg b gy lm ln l lo lp">- Bring up a K8s cluster on local machine from scratch</span><span id="46a5" class="lk ll iq lg b gy lq ln l lo lp">- Remove one node from the cluster and configure it as an NFS-Server</span><span id="bee2" class="lk ll iq lg b gy lq ln l lo lp">- Use the NFS-Server to create a PersistentVolume</span><span id="bb3d" class="lk ll iq lg b gy lq ln l lo lp">- Create a PersistentVolumeClaim from the PersistentVolume</span><span id="528b" class="lk ll iq lg b gy lq ln l lo lp">- Have the POD use this PersistentVolumeClaim</span></pre><p id="4847" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å¼ºçƒˆå»ºè®®äº²è‡ªå°è¯•è¿™é‡Œçš„æ¦‚å¿µï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£å®ƒä»¬ã€‚è®©æˆ‘ä»¬è¯•ç€æŠŠé—®é¢˜åˆ†æˆå°å—ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€æ­¥å»ºç«‹æ¦‚å¿µã€‚</p><blockquote class="lr ls lt"><p id="b355" class="kd ke lu kf b kg kh ki kj kk kl km kn lv kp kq kr lw kt ku kv lx kx ky kz la ij bi translated"><strong class="kf ir">æ­¥éª¤1 </strong>è°ƒå‡ºK8sé›†ç¾¤</p></blockquote><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ly"><img src="../Images/9060fe79597636604a3f686b20f9d9d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dNihr1MXi75ktudZ7WWMLQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">æˆ‘ä»¬è®¡åˆ’æå‡ºçš„é›†ç¾¤</figcaption></figure><p id="4e0c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æœ‰å¤šç§æ–¹æ³•å¯ä»¥å¯åŠ¨é›†ç¾¤ã€‚åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<a class="ae kc" href="https://en.wikipedia.org/wiki/Infrastructure_as_code" rel="noopener ugc nofollow" target="_blank"> IaC </a>å“²å­¦ä»¥åŠ<a class="ae kc" href="https://www.ansible.com/" rel="noopener ugc nofollow" target="_blank"> ansible </a>å’Œ<a class="ae kc" href="https://www.vagrantup.com/" rel="noopener ugc nofollow" target="_blank">vagger</a>åœ¨æ‚¨çš„æœ¬åœ°æœºå™¨ä¸Šåˆ›å»ºä¸€ä¸ªK8sé›†ç¾¤ã€‚ä½ å¯ä»¥ä½¿ç”¨AWSã€GCPã€Azureã€Minikubeç­‰ä»»ä½•è½¯ä»¶ã€‚å¹¶è¾¾åˆ°åŒæ ·çš„ç›®çš„ã€‚</p><p id="030c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å¯¹äºæˆ‘ä»¬çš„ç¤ºä¾‹ï¼Œæˆ‘å°†ä½¿ç”¨4ä¸ªå·¥ä½œèŠ‚ç‚¹å’Œä¸€ä¸ªæ§åˆ¶å™¨èŠ‚ç‚¹æ¥æ„å»ºé›†ç¾¤ã€‚æˆ‘å°†ä½¿ç”¨<a class="ae kc" href="https://www.itwonderlab.com/en/ansible-kubernetes-vagrant-tutorial/" rel="noopener ugc nofollow" target="_blank">è¿™ä¸ªåšå®¢</a>è°ƒå‡ºé›†ç¾¤ã€‚<em class="lu"> <br/>è¦æ”¹å˜èŒå·¥èŠ‚ç‚¹çš„æ•°é‡ï¼Œç¼–è¾‘</em> <a class="ae kc" href="https://github.com/itwonderlab/ansible-vbox-vagrant-kubernetes/blob/master/Vagrantfile" rel="noopener ugc nofollow" target="_blank"> <em class="lu">æ— ä¸šæ¡£æ¡ˆ</em> </a> <em class="lu">å¹¶æ›´æ–°æ•°é‡ã€‚</em></p><p id="a4b4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ä½¿ç”¨ä»¥ä¸‹æ­¥éª¤:</p><ol class=""><li id="8bb9" class="lz ma iq kf b kg kh kk kl ko mb ks mc kw md la me mf mg mh bi translated">åœ¨è¿™é‡Œä»<a class="ae kc" href="https://github.com/itwonderlab/ansible-vbox-vagrant-kubernetes" rel="noopener ugc nofollow" target="_blank">å…‹éš†github repo</a></li><li id="0589" class="lz ma iq kf b kg mi kk mj ko mk ks ml kw mm la me mf mg mh bi translated">ç„¶åè¿è¡Œ<code class="fe mn mo mp lg b">vagrant up</code></li></ol><p id="0d10" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æ‚¨ç°åœ¨åº”è¯¥çœ‹åˆ°ä¸€ä¸ªåŒ…å«4ä¸ªèŠ‚ç‚¹å’Œä¸€ä¸ªæ§åˆ¶å™¨çš„é›†ç¾¤ã€‚</p><blockquote class="lr ls lt"><p id="a49d" class="kd ke lu kf b kg kh ki kj kk kl km kn lv kp kq kr lw kt ku kv lx kx ky kz la ij bi translated"><strong class="kf ir">ç¬¬äºŒæ­¥</strong>ç°åœ¨è®©æˆ‘ä»¬é…ç½®æˆ‘ä»¬çš„NFSæœåŠ¡å™¨</p></blockquote><p id="3cb3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è¿™ä¸ªnfså·å°†ä½œä¸ºæˆ‘ä»¬è®¡åˆ’åˆ›å»ºçš„æ°¸ä¹…å·çš„NFSæ•°æ®æºã€‚å¯¹äºæˆ‘ä»¬çš„ç®€å•è®¾ç½®ï¼Œä½¿ç”¨ä»¥ä¸‹æ­¥éª¤ä»é›†ç¾¤ä¸­åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå³<strong class="kf ir"> k8s-n-4 </strong>ï¼Œå¹¶å°†å…¶é…ç½®åˆ°NFSæœåŠ¡å™¨ä¸­:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="2174" class="lk ll iq lg b gy lm ln l lo lp"><strong class="lg ir">vagrant ssh k8s-m-1</strong></span><span id="ffa8" class="lk ll iq lg b gy lq ln l lo lp"><strong class="lg ir">kubectl drain k8s-n-4</strong></span><span id="e3d7" class="lk ll iq lg b gy lq ln l lo lp"><strong class="lg ir">kubectl delete node k8s-n-4</strong></span></pre><p id="26d1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">åœ¨è¿è¡Œä¸Šè¿°æ¯ä¸ªå‘½ä»¤ä¹‹åï¼Œæˆ‘ä»¬ç°åœ¨åœ¨K8sé›†ç¾¤ä¸­æœ‰äº†ä»¥ä¸‹èŠ‚ç‚¹ã€‚è¯·æ³¨æ„<strong class="kf ir"> k8s-n-4 </strong>ç°åœ¨ä¸æ˜¯é›†ç¾¤çš„ä¸€éƒ¨åˆ†:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="9640" class="lk ll iq lg b gy lm ln l lo lp">vagrant@k8s-m-1:~$ <strong class="lg ir">kubectl get nodes</strong><br/>NAME      STATUS   ROLES                  AGE   VERSION<br/>k8s-m-1   Ready    control-plane,master   36h   v1.20.2<br/>k8s-n-1   Ready    &lt;none&gt;                 36h   v1.20.2<br/>k8s-n-2   Ready    &lt;none&gt;                 36h   v1.20.2<br/>k8s-n-3   Ready    &lt;none&gt;                 36h   v1.20.2</span></pre><p id="5d47" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ç°åœ¨è®©æˆ‘ä»¬ç™»å½•åˆ°<strong class="kf ir"> k8s-n-4 </strong>å¹¶æŠŠå®ƒå˜æˆä¸€ä¸ªnfsæœåŠ¡å™¨:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="2e7b" class="lk ll iq lg b gy lm ln l lo lp"><strong class="lg ir">vagrant ssh k8s-n-4</strong></span></pre><p id="47ba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ä½¿ç”¨æ­¤å¤„çš„è¯´æ˜<a class="ae kc" href="https://www.tecmint.com/install-nfs-server-on-ubuntu/" rel="noopener ugc nofollow" target="_blank">å®‰è£…nfsæœåŠ¡å™¨ã€‚</a></p><p id="4ea3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ç°åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨nfsæœåŠ¡å™¨ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå¹¶å°†å…¶å…¬å¼€ä¸ºå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨çš„nfsè£…è½½ã€‚ç¡®ä¿åœ¨â€œ/etc/exportsâ€ä¸­æ·»åŠ ä»¥ä¸‹è¡Œ:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="4635" class="lk ll iq lg b gy lm ln l lo lp">vagrant@k8s-n-4:/nfsdata$ <strong class="lg ir">sudo mkdir -p --mode=777 /nfsdata</strong></span><span id="932d" class="lk ll iq lg b gy lq ln l lo lp">vagrant@k8s-n-4:/nfsdata$ cat /etc/exports | tail -1<br/>/nfsdata *(rw,sync)</span></pre><p id="61fd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ç°åœ¨éªŒè¯æŒ‚è½½ç‚¹ï¼Œå³nfsæœåŠ¡å™¨å…¬å¼€çš„nfsdata:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="c18c" class="lk ll iq lg b gy lm ln l lo lp">vagrant@k8s-n-4:$ <strong class="lg ir">showmount -e</strong><br/>Export list for k8s-n-4:<br/>/nfsdata *</span></pre><blockquote class="lr ls lt"><p id="249b" class="kd ke lu kf b kg kh ki kj kk kl km kn lv kp kq kr lw kt ku kv lx kx ky kz la ij bi translated"><strong class="kf ir">æ­¥éª¤3 </strong>åˆ›å»ºä¸€ä¸ª<a class="ae kc" href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistent-volumes" rel="noopener ugc nofollow" target="_blank">æŒä¹…å·</a></p></blockquote><p id="4828" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è¿™é‡Œå¿«é€Ÿå›é¡¾ä¸€ä¸‹æˆ‘ä»¬åœ¨<a class="ae kc" href="https://medium.com/swlh/k8s-volumes-claims-part2-70b6cefd9d5a" rel="noopener">æŒç»­å·</a>ä¸­å­¦åˆ°çš„æ¦‚å¿µï¼Œå¹¶å°†å…¶ä¸æˆ‘ä»¬æ­£åœ¨æ„å»ºçš„ç¤ºä¾‹è”ç³»èµ·æ¥:</p><p id="5923" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">pod</strong>use =&gt;<strong class="kf ir">persistent volume claim</strong>å…¶ä¸­use =&gt;<strong class="kf ir">persistent volume</strong></p><p id="31c0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">æŒä¹…å·</strong> = &gt;åœ¨<strong class="kf ir"> k8s-n-4 </strong>ä¸Šåˆ›å»ºçš„<strong class="kf ir"> nfs-server </strong>çš„æŠ˜è¡·</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="9d5e" class="lk ll iq lg b gy lm ln l lo lp">vagrant@k8s-m-1:~/kubernetes$ cat <strong class="lg ir">persistent-vol.yml</strong><br/>apiVersion: v1<br/>kind: PersistentVolume<br/>metadata:<br/>  name: nfsdata<br/>spec:<br/>  capacity:<br/>    storage: 5Gi            # <strong class="lg ir">Size of the nfs-server volume</strong><br/>  volumeMode: Filesystem<br/>  accessModes:<br/>    - ReadWriteOnce<br/>  storageClassName: slow<br/>  nfs:<br/>    path: /nfsdata          # <strong class="lg ir">path on which k8-n-4 exposes the nfs</strong> mount<br/>    server: 1xx.xxx.xx.xx   # <strong class="lg ir">nfs-server ip address</strong></span></pre><p id="1240" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ç°åœ¨è®©æˆ‘ä»¬ä½¿ç”¨ä¸Šé¢çš„yamlæ–‡ä»¶åˆ›å»ºPersistentVolumeå¹¶è¿›è¡ŒéªŒè¯ã€‚ç¡®ä¿ç”¨æ‚¨çš„<strong class="kf ir"> k8-n-4 </strong>èŠ‚ç‚¹çš„<strong class="kf ir"> ipåœ°å€</strong>æ›¿æ¢<strong class="kf ir">æœ€åä¸€è¡Œ</strong></p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="a517" class="lk ll iq lg b gy lm ln l lo lp">vagrant@k8s-m-1:~/kubernetes$ <strong class="lg ir">kubectl create -f persistent-vol.yml</strong><br/>persistentvolume/nfsdata created</span><span id="98d2" class="lk ll iq lg b gy lq ln l lo lp">vagrant@k8s-m-1:~/kubernetes$ <strong class="lg ir">kubectl get pv</strong><br/>NAME      CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE<br/>nfsdata   5Gi        RWO            Retain           Available           slow                    4s</span></pre><p id="0d8c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æ‰€ä»¥æˆ‘ä»¬ç°åœ¨å·²ç»å‡†å¤‡å¥½äº†æˆ‘ä»¬çš„æŒä¹…å·ï¼Œè€¶ï¼ï¼ï¼ğŸ™ŒğŸ½</p><blockquote class="lr ls lt"><p id="2ad1" class="kd ke lu kf b kg kh ki kj kk kl km kn lv kp kq kr lw kt ku kv lx kx ky kz la ij bi translated"><strong class="kf ir">æ­¥éª¤4 </strong>åˆ›å»ºä¸€ä¸ªPersistentVolumeClaim</p></blockquote><p id="7987" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ä½¿ç”¨ä¸‹é¢çš„yamlæ–‡ä»¶åˆ›å»º<a class="ae kc" href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims" rel="noopener ugc nofollow" target="_blank"> PersistentVolumeClaim </a>ã€‚<br/> <em class="lu">å…³äºè¿™ä¸ª</em><a class="ae kc" href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims" rel="noopener ugc nofollow" target="_blank"><em class="lu">PersistentVolumeClaim</em></a><em class="lu">æ˜¯å¦‚ä½•ä¸æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„</em><a class="ae kc" href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistent-volumes" rel="noopener ugc nofollow" target="_blank"><em class="lu">persistent volume</em></a><em class="lu">äº§ç”Ÿå…³è”çš„æœ‰ä»€ä¹ˆçŒœæµ‹å—ï¼Ÿ(çº¿ç´¢:-ä»€ä¹ˆæ˜¯æ…¢ï¼Ÿ)</em></p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="fe06" class="lk ll iq lg b gy lm ln l lo lp">vagrant@k8s-m-1:~/kubernetes$ cat <strong class="lg ir">persistentclaim.yml</strong><br/>apiVersion : v1<br/>kind: PersistentVolumeClaim<br/>metadata:<br/>  name: nfsclaim  <strong class="lg ir"># Claim name which will be used by the pod</strong><br/>spec:<br/>  accessModes:<br/>    - ReadWriteOnce<br/>  volumeMode: Filesystem<br/>  resources:<br/>    requests:<br/>      storage: 1Gi  #<strong class="lg ir">request size from claim to the PersistentVolume</strong><br/>  storageClassName: slow</span></pre><p id="b07f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºPersistentVolumeClaim</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="dc20" class="lk ll iq lg b gy lm ln l lo lp">vagrant@k8s-m-1:~/kubernetes$ <strong class="lg ir">kubectl create -f  persistentclaim.yml</strong><br/>persistentvolumeclaim/nfsclaim created</span><span id="16e6" class="lk ll iq lg b gy lq ln l lo lp">vagrant@k8s-m-1:~/kubernetes$ <strong class="lg ir">kubectl get pvc</strong><br/>NAME       STATUS   VOLUME    CAPACITY   ACCESS MODES   STORAGECLASS   AGE<br/>nfsclaim   Bound    nfsdata   5Gi        RWO            slow           4s</span></pre><p id="329a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æ‰€ä»¥æˆ‘ä»¬ç°åœ¨å·²ç»å‡†å¤‡å¥½äº†æˆ‘ä»¬çš„æŒç»­é‡å£°æ˜ï¼Œè€¶ï¼ï¼ï¼ğŸ™ŒğŸ½</p><blockquote class="lr ls lt"><p id="6dfe" class="kd ke lu kf b kg kh ki kj kk kl km kn lv kp kq kr lw kt ku kv lx kx ky kz la ij bi translated"><strong class="kf ir">æ­¥éª¤5 </strong>åˆ›å»ºä¸€ä¸ªå°†ä½¿ç”¨PersistentVolumeClaimçš„pod</p></blockquote><p id="18b6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªpodï¼Œå®ƒå°†ä½¿ç”¨åˆ›å»ºçš„PersistentVolumeClaimã€‚</p><p id="5076" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è¯·æŸ¥çœ‹ä¸‹é¢çš„è¯„è®ºï¼Œäº†è§£podä¸­çš„è·¯å¾„â€œ/var/www/htmlâ€å°†å¦‚ä½•ä½¿ç”¨æˆ‘ä»¬åˆ›å»ºçš„PersistentVolumeClaimã€‚</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="2c93" class="lk ll iq lg b gy lm ln l lo lp">vagrant@k8s-m-1:~/kubernetes$ cat podclaim.yml<br/>apiVersion: v1<br/>kind: Pod<br/>metadata:<br/>  name: nvolpod<br/>spec:<br/>  containers:<br/>    - name: test<br/>      image: nginx<br/>      volumeMounts:<br/>      - mountPath: "/var/www/html" # <strong class="lg ir">Folder in pod mounting nfsclaim </strong><br/>        name: mypd<br/>  volumes:<br/>    - name: mypd             # <strong class="lg ir">volume name the container can mount</strong><br/>      persistentVolumeClaim: # <strong class="lg ir">Source of storage</strong><br/>        claimName: nfsclaim  # <strong class="lg ir">name of pvc created</strong></span></pre><p id="a1a7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è®©æˆ‘ä»¬éªŒè¯å®ƒæ˜¯å¦å¦‚é¢„æœŸçš„é‚£æ ·å·¥ä½œã€‚æˆ‘ä»¬åœ¨ä¸‹é¢çœ‹åˆ°ï¼Œpodå·²åˆ›å»ºå¹¶ä½¿ç”¨persistentVolumeClaim:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="5a05" class="lk ll iq lg b gy lm ln l lo lp">vagrant@k8s-m-1:~/kubernetes$ <strong class="lg ir">kubectl create -f podclaim.yml</strong><br/>pod/nvolpod created</span><span id="f605" class="lk ll iq lg b gy lq ln l lo lp">vagrant@k8s-m-1:~/kubernetes$ <strong class="lg ir">kubectl get pods</strong><br/>NAME      READY   STATUS    RESTARTS   AGE<br/>nvolpod   1/1     Running   0          56s</span><span id="bd2e" class="lk ll iq lg b gy lq ln l lo lp">vagrant@k8s-m-1:~/kubernetes$ <strong class="lg ir">kubectl describe pod nvolpod | grep  Volumes -A4</strong><br/>Volumes:<br/>  mypd:<br/>    Type:       PersistentVolumeClaim (a reference to a PersistentVolumeClaim in the same namespace)<br/>    ClaimName:  nfsclaim<br/>    ReadOnly:   false</span></pre><p id="bc17" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è¿™ä¸€åˆ‡éƒ½å¾ˆå¥½ï¼Œè®©æˆ‘ä»¬é€€ä¸€æ­¥ï¼Œçœ‹çœ‹æˆ‘ä»¬æ‰“ç®—åšä»€ä¹ˆã€‚æˆ‘ä»¬è¯•å›¾å°†nfsæœåŠ¡å™¨æŒ‚è½½åˆ°PODä¸Šï¼Œå…·ä½“åœ¨å“ªé‡Œï¼Ÿè®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="ffaa" class="lk ll iq lg b gy lm ln l lo lp">vagrant@k8s-m-1:~/kubernetes$ <strong class="lg ir">kubectl exec -it nvolpod -- bash</strong></span><span id="7949" class="lk ll iq lg b gy lq ln l lo lp">root@nvolpod:/# <strong class="lg ir">cd /var/www/html/</strong></span><span id="03e4" class="lk ll iq lg b gy lq ln l lo lp">root@nvolpod:/var/www/html# <strong class="lg ir">cat index.html</strong><br/>&lt;h1&gt; this must go on shared storage &lt;/h1&gt;</span></pre><p id="4fba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æ­¤æ—¶ï¼Œç”±PODç¼–å†™çš„æ–‡ä»¶index.htmlåº”è¯¥æ˜¾ç¤ºåœ¨æˆ‘ä»¬é…ç½®çš„nfsæœåŠ¡å™¨æŒ‚è½½ä¸Šã€‚è¦éªŒè¯è¿™ä¸€ç‚¹ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="8a9c" class="lk ll iq lg b gy lm ln l lo lp">vagrant@k8s-n-4:/nfsdata$ <strong class="lg ir">cat index.html</strong><br/>&lt;h1&gt; this must go on shared storage &lt;/h1&gt;</span></pre><p id="59b1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">çœ‹èµ·æ¥æ˜¯çš„ï¼Œå“‡å“¦ï¼ï¼ï¼ğŸ’¥</p><p id="5ca1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æ€»ç»“ä¸€ä¸‹æˆ‘ä»¬ä¸Šé¢æ‰€åšçš„â€”â€”æˆ‘ä»¬é…ç½®äº†ä¸€ä¸ªå…±äº«çš„æŒä¹…å­˜å‚¨ï¼Œå®ƒå¯ä»¥è¢«ä»»ä½•podä½¿ç”¨ã€‚è¿™æ„å‘³ç€ï¼Œå³ä½¿podç”±äºå…¶çŸ­æš‚çš„æ€§è´¨è€Œå…³é—­ï¼Œå­˜å‚¨çš„æ•°æ®ä»ç„¶å­˜åœ¨äºæ°¸ä¹…å­˜å‚¨å™¨ä¸­ã€‚</p><p id="7b09" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">é™„æ³¨:æˆ‘ä»¬åœ¨è¿™é‡Œåªæ˜¯ç”¨äº†ä¸€ä¸ªNFSå­˜å‚¨çš„ä¾‹å­ã€‚ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ç§ç±»çš„å­˜å‚¨å™¨(ä½¿ç”¨è¿™äº›i <a class="ae kc" href="https://medium.com/swlh/k8s-volumes-claims-part2-70b6cefd9d5a" rel="noopener">æŒ‡ä»¤</a>)ã€‚</p><p id="a3bc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ä¸‹é¢æ˜¯åœ¨ä¸€ä¸ªåœ°æ–¹çš„å‘½ä»¤ï¼Œä»¥ä¾¿æ›´å¥½åœ°å‚è€ƒã€‚ä¸‹æ¬¡è§ï¼Œå†è§ï¼ï¼ï¼</p><p id="07cf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">é™„è¨€:æˆ‘ä¸€ç›´åœ¨æœ‰æ„è¯†åœ°é€‰æ‹©ç”¨â€œæ§åˆ¶è€…â€æ¥ä»£æ›¿æˆ‘çš„è¯æ±‡ä¸­çš„â€œä¸»äººâ€</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mq"><img src="../Images/0d5205c912bcf10f3b620d0577a525ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_fxzRZ1tJ_qDFe40_2SqDA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mr">åˆ›å»ºpvã€pvcå’Œä½¿ç”¨pvcçš„podï¼Œå³è¾¹çš„é¢æ¿æ˜¯nfsæœåŠ¡å™¨</strong></figcaption></figure></div></div>    
</body>
</html>