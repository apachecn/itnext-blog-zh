# RxJS è¿ç®—ç¬¦:è§’åº¦-å»

> åŸæ–‡ï¼š<https://itnext.io/rxjs-operators-angular-kiss-36d875d2ff7d?source=collection_archive---------3----------------------->

![](img/bf87c4fe29e3acaec4052dcac65fec62.png)

æœ¬æ–‡çš„ç›®çš„æ˜¯ä¸ºåˆå­¦è€…æä¾›ä½¿ç”¨æœ€å¸¸è§çš„ RxJS æ“ä½œç¬¦çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¹¶æœ‰æœ›æˆä¸ºæœªæ¥æ‹¥æŠ±ååº”å¼ç¼–ç¨‹çš„ç«èŠ±ã€‚æœ¬æ–‡çš„ç›®æ ‡æ˜¯ä¸ä»…æä¾› switchMapã€mergeMapã€exhaustMapã€concatMap çš„çœŸå®ç”¨ä¾‹ï¼Œè€Œä¸”æä¾›ä¸€ä¸ªå°é¡¹ç›®ä½œä¸ºèµ·ç‚¹ã€‚

åœ¨æˆ‘ç ”ç©¶è¿™äº›æ“ä½œç¬¦çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘è®¨åŒé‚£äº›çœ‹èµ·æ¥ç®€å•å®¹æ˜“ï¼Œä½†æ²¡æœ‰æ­ç¤ºæ“ä½œç¬¦çœŸæ­£ç›®çš„å’Œæ½œåŠ›çš„ä¾‹å­ã€‚æˆ‘å°†å°½æˆ‘æœ€å¤§çš„åŠªåŠ›åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­æä¾›å¯ç†è§£ã€å¯å¤åˆ¶çš„ç”¨ä¾‹ï¼Œå¹¶å¸®åŠ©ä½ è·å¾—åŸºæœ¬çš„æƒåˆ©ã€‚

## é¡¹ç›®ä¿¡æ¯å’Œç»“æ„

ä»Šå¤©çš„é¡¹ç›®æ˜¯ä¸€ä¸ªç®¡ç†å·¥å…·ï¼Œç®¡ç†å‘˜å·¥å¯¹å…¬å¸å…±äº«æ–‡ä»¶å¤¹çš„è®¿é—®ã€‚è®©æˆ‘ä»¬æ¬¢è¿ä¸€ä¸ªç©ºå‰ç»å…¸çš„åˆ†é¡µè¡¨ï¼Œå®ƒçš„å³è¾¹æœ‰ä¸€ä¸ªå°å¤é€‰æ¡†ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å°†å‘˜å·¥çš„çŠ¶æ€è®¾ç½®ä¸ºâ€œæ´»åŠ¨â€æˆ–â€œéæ´»åŠ¨â€ã€‚æˆ‘ä»¬è¿˜èƒ½å¤Ÿå¯¼å‡ºç°æœ‰å‘˜å·¥çš„æ–‡ä»¶ï¼Œå¹¶å¯¼å…¥æ–°å‘˜å·¥çš„æ–‡ä»¶ã€‚

![](img/d37151e9628b2e2c37cc063f1c9025ef.png)

æˆ‘ä»¬ç²¾ç¾çš„ç”¨æˆ·ç•Œé¢

æˆ‘ä»¬æœ‰ä¸€ä¸ªæ™ºèƒ½ç»„ä»¶æ¥æ‰˜ç®¡å…¬å¸å‘˜å·¥çš„è¡¨ã€‚ç‰¹å®šç”¨æˆ·çš„åŠ¨ä½œè§¦å‘æ¥è‡ªæ™ºèƒ½ç»„ä»¶çš„äº‹ä»¶ï¼Œå¹¶å‘ä¸€ä¸ª API(åœ¨æˆ‘ä»¬çš„ç‰¹å®šä¾‹å­ä¸­æ˜¯ in-memory-web-api)å‘å‡ºä¸€äº› HTTP è°ƒç”¨ã€‚å½“ç„¶ï¼Œä»»ä½•äººéƒ½å¯ä»¥åœ¨ç”¨æˆ·é€‰æ‹©å¦ä¸€ä¸ªé¡µé¢æˆ–å•å‡»æŒ‰é’®æ—¶è°ƒç”¨ APIï¼Œå¹¶ç”¨å“åº”å¡«å……è§†å›¾ï¼Œä½†æ˜¯ç°åœ¨æ˜¯æ—¶å€™é¢å¯¹ä¸€äº›æŒ‘æˆ˜äº†ã€‚

## æŒ‘æˆ˜#1:ç”¨æˆ·å¿«é€Ÿç‚¹å‡»åˆ†é¡µå™¨

å› æ­¤ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç”¨æˆ·ç‚¹å‡»ä¸‹ä¸€é¡µæŒ‰é’®å¦‚æ­¤ä¹‹å¿«ï¼Œä»¥è‡³äºä¸€ä¸ªæ–°çš„è¯·æ±‚åœ¨ä¸Šä¸€ä¸ªè¯·æ±‚å®Œæˆä¹‹å‰å°±å¼€å§‹äº†ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ç¦ç”¨æŒ‰é’®ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªå“åº”åˆ°è¾¾ï¼Œä½†è¿™ç§æ–¹æ³•ç ´åäº†ç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬è¿˜è¿«ä½¿ç”¨æˆ·ç­‰åˆ°æ•°æ®åˆ°è¾¾ï¼Œç„¶åå†æ¬¡å•å‡»æŒ‰é’®ã€‚ç›¸åï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿæ— å£°åœ°**å–æ¶ˆ**æŒ‚èµ·çš„è¯·æ±‚ï¼Œå¹¶å¼€å§‹ä¸€ä¸ªæ–°çš„è¯·æ±‚ï¼Œè€Œä¸ä¼šæ‰“æ–­ç”¨æˆ·ã€‚

> å½“ç”¨æˆ·ç‚¹å‡»åˆ†é¡µå™¨åŒºåŸŸå¹¶æŒæœ‰å¯¹`users$` observable çš„è®¢é˜…æ—¶ï¼Œç»„ä»¶å‘å‡ºä¸€ä¸ªäº‹ä»¶ã€‚

![](img/093b1fd3ab98dde4729750b3fd8e776c.png)

> è¯¥æœåŠ¡å°†ä¸»ä½“çš„äº‹ä»¶è½¬æ¢æˆ HTTP è°ƒç”¨ã€‚å› æ­¤ï¼Œç”±äºç»„ä»¶è®¢é˜…äº†`users$` observableï¼Œæ‰€ä»¥å½“æ•°æ®åˆ°è¾¾æ—¶ï¼Œç»„ä»¶ä¼šå¾—åˆ°é€šçŸ¥ã€‚`switchMap`æ“ä½œç¬¦ç”¨äºå–æ¶ˆå¯¹å½“å‰è®¢é˜…çš„è®¢é˜…(å¦‚æœæ²¡æœ‰å…¶ä»–è®¢é˜…è€…ï¼Œåˆ™å–æ¶ˆæœªå†³çš„ HTTP è¯·æ±‚),åªè®¢é˜…æ–°çš„å¯è§‚å¯Ÿå¯¹è±¡ã€‚

![](img/1edc48f6e7c122acb275acd5d64af287.png)

è¿™ç»å¯¹æœ‰é“ç†ã€‚å½“ç”¨æˆ·å¿«é€Ÿæ¢é¡µæ—¶ï¼Œä»–ä»¬çœŸçš„ä¸å…³å¿ƒå‰å‡ é¡µçš„ç»“æœï¼Œè€Œåªå…³å¿ƒä»–ä»¬å°†ç™»é™†çš„æœ€åä¸€é¡µã€‚è¿™ä¸`switchMap`æ“ä½œç¬¦æ˜¯ä¸€ä¸ªå®Œç¾çš„ç±»æ¯”ï¼Œè¯¥æ“ä½œç¬¦å–æ¶ˆè®¢é˜…ä¹‹å‰çš„å†…éƒ¨å¯è§‚å¯Ÿå¯¹è±¡ï¼Œå¹¶è®¢é˜…æœ€æ–°çš„ã€‚

## **æŒ‘æˆ˜ 2:ç”¨æˆ·å¿«é€Ÿç‚¹å‡»å¤é€‰æ¡†**

*åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¸Œæœ›å¿«é€Ÿç‚¹å‡»å‡ ä¸ªå¤é€‰æ¡†ã€‚åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å±å¹•ä¸­å¤®ä½¿ç”¨åŠ è½½å™¨ï¼Œç­‰å¾…å¤é€‰æ¡†çš„ HTTP è¯·æ±‚å®Œæˆï¼Œç„¶åè§¦å‘å¦ä¸€ä¸ªè¯·æ±‚æ¥åˆ·æ–°é¡µé¢çš„é›‡å‘˜ï¼Œåªæœ‰åœ¨æ›´æ–°çš„æ•°æ®åˆ°è¾¾åï¼Œéšè—åŠ è½½å™¨å¹¶å…è®¸ç”¨æˆ·ç»§ç»­ã€‚è®©æˆ‘ä»¬å…³æ³¨ç”¨æˆ·ã€‚ç”¨æˆ·å¸Œæœ›å•å‡»å‡ ä¸ªå¤é€‰æ¡†æ¥æ›´æ”¹å‘˜å·¥çš„çŠ¶æ€ï¼Œå¹¶åœ¨æ²¡æœ‰ä»»ä½•ä¸­æ–­çš„æƒ…å†µä¸‹ç­‰å¾…æ›´æ–°çš„æ•°æ®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¤„äºä¸€ç§ä¼šå‘å‡ºå‡ ä¸ªäº‹ä»¶çš„æƒ…å†µï¼Œæˆ‘ä»¬å°†åœ¨**å¹¶è¡Œ**ä¸­ç®¡ç†å®ƒä»¬ï¼Œå¹¶åœ¨ä¹‹åæ›´æ–°æ•°æ®ã€‚*

> *å½“ç”¨æˆ·ç‚¹å‡»å¤é€‰æ¡†å¹¶è®¢é˜…`user$`è§‚å¯Ÿå¯¹è±¡æ—¶ï¼Œç»„ä»¶å‘å‡ºä¸€ä¸ªäº‹ä»¶ã€‚å½“ä¸€ä¸ªé›‡å‘˜è¢«æˆåŠŸæ›´æ–°æ—¶ï¼Œä¸€ä¸ªæ–°çš„è¯·æ±‚è¢«è§¦å‘æ¥æ›´æ–°æ•°æ®ã€‚*

*![](img/b7f47ba47b8d1a0366bcc573c6b3e8b5.png)*

*è¯¥æœåŠ¡éµå¾ªä¸ä»¥å‰ç›¸åŒçš„æ¨¡å¼ï¼Œä½†æ˜¯è¿™æ¬¡ä½¿ç”¨äº†`mergeMap`æ“ä½œç¬¦ã€‚å› æ­¤ï¼Œè¯¥ç»„ä»¶ç»´æŠ¤æ‰€æœ‰æ´»åŠ¨è¯·æ±‚ä¸­çš„è®¢é˜…ï¼Œå¹¶ä¸”å½“å…¶ä¸­ä»»ä½•ä¸€ä¸ªè¯·æ±‚å®Œæˆæ—¶ï¼Œå®ƒå°†å¾—åˆ°é€šçŸ¥ã€‚*

*![](img/0171d32143c44e600fee103ff156c5a4.png)*

*ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œç”¨æˆ·èƒ½å¤Ÿéå¸¸å¿«é€Ÿåœ°ç‚¹å‡»è®¸å¤šå¤é€‰æ¡†ï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºèƒ½å¤Ÿå¹¶è¡Œå¤„ç†è¯·æ±‚ã€‚å½“ç„¶ï¼Œæœ‰æ—¶å‘ä¸€ä¸ª API å‘å‡ºå¤šä¸ªè¯·æ±‚å¹¶ä¸æ˜¯æœ€ä½³çš„è§£å†³æ–¹æ¡ˆã€‚æ›´æ–°ç°æœ‰é›‡å‘˜è®°å½•å¸ƒå°”å€¼å¯èƒ½æ²¡é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬è¯•å›¾åˆ›å»ºè®¸å¤šæ–°ç”¨æˆ·ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ*

## *æŒ‘æˆ˜ 3:ç”¨æˆ·å¯¼å…¥æ–°å‘˜å·¥çš„ JSON æ–‡ä»¶*

*å¯¹äºè¿™ä¸ªç”¨ä¾‹ï¼Œè®©æˆ‘ä»¬å‡è®¾ API æ¯æ¬¡åªèƒ½åˆ›å»ºä¸€ä¸ªé›‡å‘˜ï¼Œä½†æ˜¯æˆ‘ä»¬å¸Œæœ›å…è®¸ç”¨æˆ·æä¾›ä¸€ä¸ªåŒ…å«é›‡å‘˜åˆ—è¡¨çš„æ–‡ä»¶ï¼Œä»¥è·å¾—æ›´å¥½çš„ä½“éªŒã€‚åº”ç”¨ç¨‹åºå°†è¯»å–æ–‡ä»¶ï¼Œå¹¶ä¸ºåˆ—è¡¨ä¸­çš„æ¯ä¸ªé›‡å‘˜å‘å‡ºä¸€ä¸ª HTTP è¯·æ±‚ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬å¹¶è¡Œå‘å‡ºè¯·æ±‚ï¼Œæˆ‘ä»¬å°†ä¼šç»™åç«¯äº§ç”Ÿä¸å¿…è¦çš„è´Ÿè½½ã€‚æ­£ç¡®çš„åšæ³•æ˜¯æ¯æ¬¡ä¿æŒä¸€ä¸ªæ´»åŠ¨è¯·æ±‚ï¼Œåªæœ‰åœ¨å‰ä¸€ä¸ªè¯·æ±‚å®Œæˆåæ‰å¼€å§‹ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚å½“åˆ›å»ºäº†æ‰€æœ‰æ–°å‘˜å·¥åï¼Œæˆ‘ä»¬åº”è¯¥åˆ·æ–°æ•°æ®ã€‚*

> *è¯¥ç»„ä»¶å°†è§£æ JSON å¹¶åˆ›å»ºä¸€ä¸ªé›‡å‘˜åˆ—è¡¨ã€‚æˆ‘ä»¬ä½¿ç”¨`take`æ“ä½œç¬¦æ¥è®¢é˜…ä¸æˆ‘ä»¬æƒ³è¦åˆ›å»ºçš„é›‡å‘˜æ•°é‡ç›¸ç­‰çš„è¯·æ±‚ã€‚ä¹‹åï¼Œæˆ‘ä»¬å°†åˆ·æ–°æ•°æ®ã€‚*

*![](img/c4955e02a908d9048e5fccd197fbde4c.png)*

*è¯¥æœåŠ¡å°†ä½¿ç”¨â€œfromâ€æ“ä½œç¬¦ä¸ºæ¯ä¸ªæ–°å‘˜å·¥è®°å½•åˆ›å»ºä¸€ä¸ªæ–°çš„å¯è§‚å¯Ÿå¯¹è±¡ã€‚`concatMap`æ“ä½œå‘˜å°†ä¿ç•™ä¸€ä¸ªå¸¦æœ‰å¯è§‚å¯Ÿå€¼çš„é˜Ÿåˆ—ï¼Œå¹¶åœ¨å®Œæˆå‰ä¸€ä¸ªåè®¢é˜…æ–°çš„**ï¼Œå› æ­¤ç°åœ¨æˆ‘ä»¬èƒ½å¤ŸæŒ‰é¡ºåºå¤„ç†å®ƒä»¬ã€‚***

*![](img/9888d1d767324b8be0563eaf60870f54.png)*

## ***æŒ‘æˆ˜#4:ç”¨æˆ·å¿«é€Ÿç‚¹å‡»å¯¼å‡º CSV æŒ‰é’®***

**ç°åœ¨ï¼Œç”¨æˆ·è¯•å›¾ä¸‹è½½ä¸€ä¸ªåŒ…å«æ‰€æœ‰å¯ç”¨å‘˜å·¥çš„æ–‡ä»¶ã€‚å½“ç„¶ï¼Œè¿™ä¸ªåŠ¨ä½œéœ€è¦ä¸€äº›æ—¶é—´ï¼Œå¹¶ä¸”åç«¯èµ„æºéå¸¸ç´§å¼ ã€‚æˆ‘ä»¬åº”è¯¥ä¿æŠ¤ APIï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»**å¿½ç•¥**è¿›ä¸€æ­¥çš„äº‹ä»¶ï¼Œç›´åˆ°æ´»åŠ¨çš„ HTTP è¯·æ±‚å®Œæˆã€‚**

> **ç»„ä»¶è®¢é˜…äº†`allUsers$` observableï¼Œå¹¶ä¸ºæ¯ä¸ªæŒ‰é’®ç‚¹å‡»å‘å‡ºä¸€ä¸ªäº‹ä»¶ã€‚**

**![](img/f1612b35a8a254df015969e22421211a.png)**

> **å½“ä¸€ä¸ª CSV æ–‡ä»¶è¢«è¯·æ±‚æ—¶ï¼Œè¯¥æœåŠ¡å°†åˆ›å»ºä¸€ä¸ªæ–°çš„å¯è§‚å¯Ÿå¯¹è±¡ï¼Œä½†æ˜¯å¦‚æœæœ‰ä¸€ä¸ªå·²ç»æ¿€æ´»çš„äº‹ä»¶ï¼Œå®ƒå°†å¿½ç•¥æ‰€æœ‰å…¶ä»–äº‹ä»¶ã€‚æ‰€ä»¥ï¼Œæ‰€æœ‰è¿™äº›å¤§è§„æ¨¡ç‚¹å‡»å°†ä¸ä¼šäº§ç”Ÿä»»ä½•å½±å“ã€‚å¦‚æœè¯·æ±‚å¦ä¸€ç§æ–‡ä»¶ç±»å‹(å¦‚ JSON ), filter æ“ä½œç¬¦ç”¨äºè·³è¿‡äº‹ä»¶ã€‚**

**![](img/3b8af3b5a79ab4e245e0d3f488fe455f.png)**

## ****å¥–é‡‘****

*   **å½“ç”¨æˆ·æƒ³è¦ä¸€æ¬¡ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯ API åªæ¥å—æ¯ä¸ªè¯·æ±‚ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”æ‚¨çŸ¥é“æ–‡ä»¶å¤„ç†éœ€è¦å¤§é‡èµ„æºæ—¶ï¼Œä½¿ç”¨`concatMap`æ“ä½œç¬¦ã€‚æ‚¨å¯ä»¥åœ¨è¯·æ±‚ä¸­ä½¿ç”¨ä¸€ä¸ªç›¸å…³ idï¼Œè¿˜å¯ä»¥åŒ…æ‹¬æ–‡ä»¶çš„ç´¢å¼•ï¼Œåªè¦æ–‡ä»¶çš„æ€»æ•°ã€‚**
*   **å°½å¯èƒ½å¤šåœ°ä½¿ç”¨`asyncPipe`,è¿™æ · angular å°±å¯ä»¥é€€è®¢é‚£äº›å¯è§‚çš„ä¸œè¥¿äº†ã€‚å¯¹äºæˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨è®¢é˜…çš„æƒ…å†µï¼Œæˆ‘ä»¬åº”è¯¥ç¡®ä¿å–æ¶ˆè®¢é˜…ä»¥é¿å…å†…å­˜æ³„æ¼ã€‚ä¸€ç§ç®€å•çš„æ–¹æ³•æ˜¯åˆ©ç”¨`takeUntil`æ“ä½œç¬¦ï¼Œç»“åˆä¸€ä¸ªåœ¨ç»„ä»¶è¢«é”€æ¯æ—¶å‘å‡ºä¸€ä¸ªå€¼çš„ä¸»é¢˜ã€‚**

> **åœ¨è¿™é‡Œ *æ‰¾åˆ°è§’åº¦ä»£ç  [*ã€‚*](https://github.com/stavrosdro/rxjs-operators)***

***äº«å—*ğŸš€ğŸš€ğŸš€**