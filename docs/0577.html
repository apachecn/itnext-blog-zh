<html>
<head>
<title>Working with Firebase Functions â€” HTTP Request</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨Firebaseå‡½æ•°â€” HTTPè¯·æ±‚</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/working-with-firebase-functions-http-request-22fd1ab644d3?source=collection_archive---------0-----------------------#2018-04-04">https://itnext.io/working-with-firebase-functions-http-request-22fd1ab644d3?source=collection_archive---------0-----------------------#2018-04-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/4c161f1fc512a9a6dfbb7a64de7de297.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eGLVD4OsDN2aO8B979sh_g.png"/></div></div></figure><p id="1cab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰Firebaseå‡½æ•°ï¼Œè¯·é˜…è¯»<a class="ae kw" href="https://firebase.google.com/docs/functions/get-started" rel="noopener ugc nofollow" target="_blank">å‡½æ•°å…¥é—¨æ–‡æ¡£</a>ã€‚æˆ‘æœ‰æœºä¼šç©ä¸€ä¼šå„¿HTTPè¯·æ±‚å’ŒFirebaseå‡½æ•°ï¼Œæœ‰å‡ ä¸ªå°æŠ€å·§æˆ‘æƒ³åˆ†äº«ä¸€ä¸‹ã€‚</p><ol class=""><li id="720a" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated"><strong class="ka ir">å¦‚ä½•å¯åŠ¨HTTPè¯·æ±‚åŠŸèƒ½</strong></li></ol><p id="fa9a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">é¦–å…ˆåœ¨index.jsæ–‡ä»¶ä¸­å£°æ˜å®ƒ</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="97c0" class="lp lq iq ll b gy lr ls l lt lu">exports.request = functions.https.onRequest((request, response) =&gt; {<br/>  // ...<br/>});</span></pre><p id="97ba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">é€šè¿‡ä»æµè§ˆå™¨ã€æ–¹æ³•æˆ–ä½¿ç”¨HTTPæœåŠ¡ç›´æ¥è°ƒç”¨è¯¥å‡½æ•°æ¥è§¦å‘è¯¥å‡½æ•°ã€‚æœ‰ä¸€ç¯‡å…³äº<a class="ae kw" href="https://medium.com/google-cloud/startups-now-cronjob-your-google-firebase-functions-securely-and-externally-without-paying-for-503b0f4ca539" rel="noopener">å¦‚ä½•è°ƒåº¦HTTPè¯·æ±‚åˆ°ä½ çš„firebaseå‡½æ•°</a>çš„éå¸¸å¥½çš„æ–‡ç« å€¼å¾—ä¸€è¯»ã€‚</p><p id="4d32" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.<strong class="ka ir">å¦‚ä½•æ£€æŸ¥è¯·æ±‚æ–¹æ³•</strong></p><p id="5f1a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Firebaseå‡½æ•°æ”¯æŒGETã€POSTã€PUTã€DELETEå’ŒOPTIONSæ–¹æ³•ï¼Œå¹¶ä¸”æ‚¨å¯ä»¥æ£€æŸ¥å“ªç§æ–¹æ³•è§¦å‘äº†æ‚¨çš„å‡½æ•°ã€‚</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="ea79" class="lp lq iq ll b gy lr ls l lt lu">// Check for POST request<br/>if(request.method !== "POST"){<br/> res.status(400).send('Please send a POST request');<br/> return;<br/>}</span></pre><p id="6f43" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.<strong class="ka ir">å¦‚ä½•ä»POSTè¯·æ±‚ä¸­è·å–æ•°æ®</strong></p><p id="6887" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æ•°æ®(ä¾‹å¦‚JSONç±»å‹)å°†åœ¨è¯·æ±‚çš„å¤´ä¸­ã€‚</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="5d4c" class="lp lq iq ll b gy lr ls l lt lu">let data = request.body;</span></pre><p id="db5c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">4.<strong class="ka ir">å¦‚ä½•ä»ä½ çš„åº”ç”¨/ç½‘ç«™å‘é€å¸–å­è¯·æ±‚</strong></p><p id="89a6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è¿™æ˜¯æˆ‘çš„Angularåº”ç”¨ç¨‹åºä¸­çš„ä¸€ä¸ªä¾‹å­ï¼Œå®ƒå‘é€POSTè¯·æ±‚æ¥è§¦å‘firebaseå‡½æ•°</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="7ae8" class="lp lq iq ll b gy lr ls l lt lu">// Using Angular HttpClient to send POST request</span><span id="3f5f" class="lp lq iq ll b gy lv ls l lt lu">const httpOptions = {<br/> headers: new HttpHeaders({<br/>   'Content-Type':  'application/json',<br/>   'Authorization': 'secret-key'<br/> })<br/>};</span><span id="1adb" class="lp lq iq ll b gy lv ls l lt lu">let data = {name: 'Dale Nguyen'};</span><span id="e7d7" class="lp lq iq ll b gy lv ls l lt lu">this.http.post('https://us-central1-dale-nguyen.cloudfunctions.net/request', data, httpOptions)<br/>.subscribe(<br/> res =&gt; {<br/>   console.log(res);<br/> },<br/> err =&gt; {<br/>   console.log("Error occured");<br/> }<br/>)</span></pre><p id="a699" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">5.<strong class="ka ir">ä¸ºæ‚¨çš„åŠŸèƒ½å¢åŠ é¢å¤–å®‰å…¨æ€§çš„æ–¹æ³•</strong></p><p id="5d17" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æ„Ÿè°¢ä¸Šé¢å…³äºHTTPè¯·æ±‚æ—¶é—´è¡¨çš„å¸–å­ï¼Œè¿™æ˜¯ä¸€äº›å¯ä»¥ä¸ºä½ çš„åº”ç”¨ç¨‹åºå¢åŠ é¢å¤–å®‰å…¨æ€§çš„æ–¹æ³•ã€‚</p><p id="a698" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ä¸ºäº†å®‰å…¨èµ·è§ï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„å¯†é’¥</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="a9c6" class="lp lq iq ll b gy lr ls l lt lu">npm install -g crypto<br/>node -e "console.log(require('crypto').randomBytes(20).toString('hex'))"</span></pre><p id="3809" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç„¶åå°†å¯†é’¥æ·»åŠ åˆ°firebaseé…ç½®ä¸­</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="4f34" class="lp lq iq ll b gy lr ls l lt lu">functions:config:set app_name.key='secret-key'</span></pre><p id="a817" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ä½¿ç”¨å¯†é’¥éªŒè¯appçš„æ–¹å¼å¯ä»¥å’Œä¸Šé¢çš„æ–‡ç« ç±»ä¼¼ï¼Œç›´æ¥åœ¨firebase serverä¸Šå¯¹æ¯”å°±å¯ä»¥æ£€æŸ¥äº†ã€‚</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="9fb4" class="lp lq iq ll b gy lr ls l lt lu">// POST headers before sending to firebase server</span><span id="dd73" class="lp lq iq ll b gy lv ls l lt lu">const httpOptions = {<br/> headers: new HttpHeaders({<br/>   'Content-Type':  'application/json',<br/>   'Authorization': 'secret-key'<br/> })<br/>};</span><span id="2ce0" class="lp lq iq ll b gy lv ls l lt lu">// firebase functions check</span><span id="92da" class="lp lq iq ll b gy lv ls l lt lu">let key = functions.config().app_name.key;</span><span id="8a07" class="lp lq iq ll b gy lv ls l lt lu">let request_key = request.get('authorization');</span><span id="dec7" class="lp lq iq ll b gy lv ls l lt lu">if(key === request_key){<br/> console.log('Awesome!!!')<br/>} else {<br/> response.status(400).send('You shall not pass!!!');<br/> return;<br/>}</span></pre><p id="a7fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">6.<strong class="ka ir">å¤„ç†CORSâ€”â€˜è®¿é—®æ§åˆ¶-å…è®¸-æ¥æºâ€™</strong></p><p id="a1fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æ„Ÿè°¢<a class="ae kw" href="https://stackoverflow.com/questions/42755131/enabling-cors-in-cloud-functions-for-firebase" rel="noopener ugc nofollow" target="_blank"> StackOverFlow </a>ï¼Œè¿™å¾ˆå®¹æ˜“å¤„ç†ã€‚</p><p id="a507" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">åœ¨å¯¼å…¥CORSä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå®‰è£…å®ƒã€‚</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="d19d" class="lp lq iq ll b gy lr ls l lt lu">npm install cors // Thanks John Theo for remind this step :)</span></pre><p id="1e41" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç„¶åæŠŠå®ƒæ”¾åˆ°index.jsæ–‡ä»¶ä¸­</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="32c0" class="lp lq iq ll b gy lr ls l lt lu">// Add CORS to your index.js<br/>const cors = require('cors')({origin: true});</span><span id="9129" class="lp lq iq ll b gy lv ls l lt lu">// Put this line to your function<br/>// Automatically allow cross-origin requests<br/>cors(req, res, () =&gt; {});</span></pre><p id="b099" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 7ã€‚å‘é€å¸¦å‚æ•°çš„GETè¯·æ±‚(Angular) </strong></p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="971f" class="lp lq iq ll b gy lr ls l lt lu">/*<br/> * Send GET request with parameters from Angular<br/> * https://angular.io/api/http/RequestOptionsArgs<br/> */<br/><br/>import { Http, Headers } from '@angular/http';<br/><br/>// Prepare the header <br/>let headers: Headers = new Headers();<br/>headers.set('parameter-name' , 'parameter-value);<br/><br/>// Send request with parameters            <br/>this.http.get('url', {<br/>  headers: headers<br/>}).subscribe(res =&gt; resolve(res.json()));            </span></pre><p id="6644" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ä¸ºäº†ä»headerä¸­è·å–å‚æ•°ï¼Œæ‚¨å¯ä»¥åœ¨firebaseå‡½æ•°ä¸­ä½¿ç”¨è¿™æ®µä»£ç </p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="d18a" class="lp lq iq ll b gy lr ls l lt lu">// In order get the request value <br/>let params = req.headers['parameter-name'];</span></pre><p id="8bb5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç›®å‰å°±è¿™äº›ã€‚é‡åˆ°å¦ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜æˆ‘ä¼šæ›´æ–°ï¼›)</p><p id="0e3a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è¯·æŸ¥çœ‹æˆ‘çš„githubï¼Œäº†è§£æ›´å¤šå…³äºfirebaseå‡½æ•°çš„æœ‰è¶£ç‰‡æ®µã€‚</p><div class="lw lx gp gr ly lz"><a href="https://github.com/dalenguyen/firebase-functions-snippets" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd ir gy z fp me fr fs mf fu fw ip bi translated">GitHub-dalen guyen/firebase-Functions-snippets:ä¸å¯æ€è®®çš„Firebaseå‡½æ•°ç‰‡æ®µâ€¦</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">è¿™é‡ŒåŒ…å«äº†æˆ‘æ‰€æœ‰æ¶‰åŠåˆ°ç¼–å†™firebaseå‡½æ•°çš„ä½œå“ï¼Œä¸ºäº†ä½¿ç”¨å®ƒï¼Œä½ åº”è¯¥çŸ¥é“å¦‚ä½•â€¦</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">github.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn jw lz"/></div></div></a></div><p id="277a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://twitter.com/dale_nguyen" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">åœ¨Twitterä¸Šå…³æ³¨æˆ‘</strong> </a>è·å–Angularã€JavaScript &amp; WebDevelopmentçš„æœ€æ–°å†…å®¹ğŸ‘</p></div></div>    
</body>
</html>