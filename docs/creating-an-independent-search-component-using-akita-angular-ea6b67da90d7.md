# ä½¿ç”¨ Akita & Angular åˆ›å»ºç‹¬ç«‹çš„æœç´¢ç»„ä»¶

> åŸæ–‡ï¼š<https://itnext.io/creating-an-independent-search-component-using-akita-angular-ea6b67da90d7?source=collection_archive---------6----------------------->

æœ€è¿‘ï¼Œæˆ‘å¼€å§‹ä½¿ç”¨ [Akita](https://netbasal.com/introducing-akita-a-new-state-management-pattern-for-angular-applications-f2f0fab5a8) ä½œä¸ºæˆ‘çš„æ–°åº”ç”¨ç¨‹åºçš„çŠ¶æ€å­˜å‚¨ã€‚
å®ƒé™„å¸¦äº†ä¸€ç³»åˆ—å¾ˆå¥½çš„æ¦‚å¿µï¼Œç”¨äºåœ¨ web åº”ç”¨ç¨‹åºä¸­æ¸…ç†å•†åº—çš„ä½¿ç”¨ã€‚

*   ä½ æœ‰ä¸€ä¸ªå­˜å‚¨åœ¨æ‰€è°“çš„â€œå®ä½“åº—â€ä¸­çš„æ¨¡å‹ã€‚
*   æ‚¨å¯ä»¥ä½¿ç”¨å®ä½“ API æœåŠ¡æ¥å¡«å……â€œå®ä½“å­˜å‚¨â€ã€‚
*   ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæŸ¥è¯¢æœåŠ¡åœ¨â€œå®ä½“å­˜å‚¨â€ä¸­æŸ¥è¯¢å€¼ï¼Œè¯¥æœåŠ¡é™„å¸¦äº†ä¸€ç»„ç°æˆçš„æŸ¥è¯¢/é€‰æ‹©å™¨ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨è¿™ä¸ªå­˜å‚¨æ¥åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„æœç´¢ç»„ä»¶ï¼Œæ‚¨å¯ä»¥ç¨åå°†å®ƒåµŒå…¥åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•åœ°æ–¹ï¼Œè€Œä¸å¿…ä¸ºå®ƒçš„å·¥ä½œæ³¨å…¥å¿…è¦çš„åˆå§‹/åŠŸèƒ½æ•°æ®ã€‚

è¿™æ˜¯[æœ€åçš„ç»“æœ](https://stackblitz.com/edit/angular-m2hwu4)ã€‚

# æœç´¢ç»„ä»¶

![](img/b706e8b0a0f048a196898f90ffda7c36.png)

æœç´¢ç»„ä»¶çš„è¯¦ç»†è¯´æ˜

æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæœç´¢ç»„ä»¶ï¼Œå®ƒè·å–è‡ªå·±çš„å¿…è¦æ•°æ®(åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯ç±»åˆ«)ï¼Œä¹Ÿå¯ä»¥ä»å¤–éƒ¨é¢„è®¾(`selectedCategoryId`å’Œ`searchTerm`)ã€‚

**æ³¨æ„**æˆ‘ä»¬åªæ¥æ”¶æ¥è‡ªå¤–éƒ¨çš„`id`ï¼Œè¿™æ„å‘³ç€åŒ…è£…å™¨ç»„ä»¶ä¸éœ€è¦è·å–ä»»ä½•ç±»åˆ«æ¥ä¼ é€’æ‰€é€‰çš„ç±»åˆ«â€”â€”ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬ä» URL æŸ¥è¯¢å‚æ•°ä¸­è¯»å–æ‰€é€‰çš„ç±»åˆ«ï¼Œè¿™ä¸€ç‚¹å°¤å…¶é‡è¦ã€‚

å› æ­¤ï¼Œè®©æˆ‘ä»¬ä»åˆ›å»ºç±»åˆ«æ¨¡å‹å¹¶å­˜å‚¨ç›¸å…³æ–‡ä»¶å¼€å§‹:

å¤ªå¥½äº†ã€‚

èŠ±ç‚¹æ—¶é—´é€šè¯»ï¼Œè¿™æ ·ä½ å°±èƒ½ç†è§£æ¯ä¸€ä¸ªæ–‡ä»¶ã€‚
å¯èƒ½ä¼šæœ‰ç›¸å½“å¤šçš„äººåˆ›å»ºç±»åˆ«å•†åº—ï¼Œä½†è¿™å°±æ˜¯[å…³æ³¨ç‚¹åˆ†ç¦»](https://en.wikipedia.org/wiki/Separation_of_concerns)çš„å¦™å¤„ã€‚

ç°åœ¨è®©æˆ‘ä»¬æ„å»ºæœç´¢ç»„ä»¶(æˆ‘ä½¿ç”¨ [Angular Material](https://material.angular.io/) æ¥ä¿ƒè¿›å¼€å‘å’Œå‡å°‘ä»£ç ):

è¿™é‡Œæ²¡ä»€ä¹ˆç‰¹åˆ«çš„ï¼Œä½†æ˜¯è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ 2 ä¸ªä¸ç§‹ç”°ç›¸å…³çš„äº‹æƒ…:

1.  `fetchCategories` â€”è¯¥æ–¹æ³•è´Ÿè´£è·å–æœç´¢ç»„ä»¶æ‰€éœ€çš„æ•°æ®ï¼Œä»¥ä¾¿åœ¨é€‰æ‹©æ¡†ä¸­æ˜¾ç¤ºç±»åˆ«ã€‚æˆ‘ä»¬ä½¿ç”¨`categoryStoreService`ï¼Œå®ƒå°†ä¾æ¬¡è°ƒç”¨`categoryApiService`æ¥è·å–ç±»åˆ«ï¼Œç„¶åå°†å®ƒä»¬è®¾ç½®åœ¨å•†åº—ä¸­ã€‚
2.  é‡è¦çš„æ˜¯è¦è®°ä½ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨å•†åº—æ¥ç®¡ç†æˆ‘ä»¬çš„çŠ¶æ€ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­å¯ç”¨çš„ç±»åˆ«æ˜¯ä¸€ä¸ªçŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸åˆ†é…ä»`categoryStoreService`(å®ƒä¼ é€’æ¥è‡ª`categoryApiService`çš„å€¼)è¿”å›çš„ç±»åˆ«ï¼Œè€Œæ˜¯ä½¿ç”¨ Akita çš„`query`æ¦‚å¿µæ¥é€‰æ‹©æˆ‘ä»¬æ’å…¥åˆ°å•†åº—ä¸­çš„ç±»åˆ«ã€‚
    æˆ‘ä»¬é€šè¿‡ä½¿ç”¨`this.categories$ = this.categoryQuery.selectAll();`æ¥åšåˆ°è¿™ä¸€ç‚¹

ç°åœ¨æˆ‘ä»¬åº”è¯¥æœ‰ä¸€ä¸ªæœç´¢ç»„ä»¶æ¥å¤„ç†å®ƒçš„ä¾èµ–æ•°æ®ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥ä»å¤–éƒ¨è®¾ç½®ã€‚å®ƒæ˜¯ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ‹¿ç€å®ƒï¼Œåœ¨ä»»ä½•éœ€è¦çš„åœ°æ–¹ä½¿ç”¨å®ƒã€‚

çœ‹ä¸€çœ‹[åŠŸèƒ½æ¼”ç¤º](https://stackblitz.com/edit/angular-m2hwu4)ã€‚

## é™·é˜±

æˆ‘æœ‰ä¸€ä¸ªè°œè¯­ç»™ä½ :

å‡è®¾æˆ‘ä»¬ä»ä¸€ä¸ª URL æŸ¥è¯¢å‚æ•°ä¸­è¯»å–é€‰å®šçš„ç±»åˆ«ã€‚å½“é¡µé¢åˆšåˆšåŠ è½½æ—¶ï¼Œæˆ‘ä»¬å°†å®ƒä¼ é€’ç»™æœç´¢ç»„ä»¶ã€‚

æœç´¢ç»„ä»¶ä¸­çš„ç±»åˆ«é€‰æ‹©å™¨ä¼šè¢«è®¾ç½®ä¸ºå…·æœ‰ç›¸åº” ID çš„ç±»åˆ«å—ï¼Ÿ

æ˜¯/å¦â€”â€”è¯•ç€è§£é‡Šä½ çš„ç­”æ¡ˆã€‚

## å›ç­”

ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œè¡Œä¸é€šã€‚åŸå› å¦‚ä¸‹:

å½“é¡µé¢åŠ è½½æ—¶ï¼Œæˆ‘ä»¬è¯»å–ç±»åˆ« id å¹¶å°†å…¶ä¼ é€’ç»™æœç´¢ç»„ä»¶â€”â€”æœç´¢ç»„ä»¶æ­£åœ¨è·å–ç±»åˆ«ã€‚

ä¸æ­¤åŒæ—¶ï¼Œå®ƒæ„è¯†åˆ°æ‚¨ä¼ é€’äº†ä¸€ä¸ªç±»åˆ«`id`æ¥è®¾ç½®ç±»åˆ«é€‰æ‹©å™¨ï¼Œå¹¶è¯•å›¾å°†æ‚¨ä¼ é€’çš„ id ä¸ç»„ä»¶ä¸­å¯ç”¨ç±»åˆ«çš„ id è¿›è¡ŒåŒ¹é…ã€‚

ä½†æ˜¯ï¼Œå”‰â€”â€”æˆ‘ä»¬ä»ç„¶åœ¨è·å–æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡æœ‰ä»»ä½•ç±»åˆ«å¯ä»¥åŒ¹é…ï¼

å› æ­¤ï¼Œç»“æœæ˜¯é€‰æ‹©å™¨ä¸ä¼šæ˜¾ç¤ºä»»ä½•è¢«é€‰ä¸­çš„ç±»åˆ«ã€‚

## å›ºå®š

æœ‰ä¸€ä¸ªç®€å•çš„æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜(å°½ç®¡æˆ‘ä¸ç¡®å®šè¿™æ˜¯å¦æ˜¯ä¸€ä¸ªæœ€ä½³å®è·µï¼Œä»‹æ„åˆ†äº«ä¸€ä¸‹ä½ çš„æƒ³æ³•å—ï¼Ÿ):

æˆ‘ä»¬è½¬æ¢`getEntity`æŸ¥è¯¢ï¼Œå®ƒæ˜¯ä¸`selectEntity`åŒæ­¥çš„æ“ä½œï¼Œå®ƒåŸºæœ¬ä¸ŠåšåŒæ ·çš„äº‹æƒ…â€”â€”åªæ˜¯æœ‰ä¸€ä¸ªå¯è§‚å¯Ÿçš„ã€‚
å› æ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¼ é€’ç»™æœç´¢ç»„ä»¶çš„ç±»åˆ« id æ¥é”å®šè®¢é˜…:

```
this.categoryQuery.selectEntity(changes.selectedCategoryId.currentValue).subscribe((category) => { this.selectedCategory = category });
```

ç°åœ¨è¿™åº”è¯¥å¯ä»¥å·¥ä½œäº†(å½“ç„¶ï¼Œæ‚¨éœ€è¦å¤„ç†é€€è®¢ã€‚ä¹Ÿè®¸ä½¿ç”¨`[take](http://reactivex.io/documentation/operators/take.html)(1)`,å› ä¸ºæ‚¨åªæƒ³ä¸ºç±»åˆ«ç­‰å¾…ä¸€æ¬¡)

å¹²æ¯ã€‚ğŸ»