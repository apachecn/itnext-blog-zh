# æˆ‘å¦‚ä½•ç¼–å†™ä¸–ç•Œä¸Šæœ€å¿«çš„ååº”è®°å¿†åº“

> åŸæ–‡ï¼š<https://itnext.io/how-i-wrote-the-worlds-fastest-react-memoization-library-535f89fc4a17?source=collection_archive---------1----------------------->

![](img/23c5c0b42389c9865c2de2d6c46592ca.png)

[*ç‚¹å‡»è¿™é‡Œåœ¨ LinkedIn ä¸Šåˆ†äº«è¿™ç¯‡æ–‡ç« *](https://www.linkedin.com/cws/share?url=https%3A%2F%2Fitnext.io%2Fhow-i-wrote-the-worlds-fastest-react-memoization-library-535f89fc4a17)

äº‹å®ä¸Šï¼Œæˆ‘æ›¾ç»å°è¯•è¿‡å†™æœ€æ…¢çš„ä¸€ä¸ªï¼Œè€Œâ€œt [æœ€å¿«çš„ JavaScript è®°å¿†åº“](https://community.risingstack.com/the-worlds-fastest-javascript-memoization-library/)æ˜¯ä¸€å¹´å‰å†™çš„ã€‚ç”šè‡³æ²¡æœ‰ä¸€ä¸ªâ€”â€”æœ‰è¿™ä¹ˆå¤šçš„åº“ï¼Œä¸€ä¸ªæ¯”ä¸€ä¸ªå¿«ï¼Œå¾ˆéš¾æŠŠå®ƒä»¬éƒ½è®°ä½ã€‚

> ä¸ºä»€ä¹ˆè¦å¤šå†™ä¸€ä¸ªï¼Ÿå› ä¸ºä½ ä¸èƒ½ä½¿ç”¨æˆ–å¤„ç†ç°æœ‰çš„ã€‚

## è®°å¿†ã€‚

è¿™æ˜¯å‡å°‘æˆ–å®Œå…¨è·³è¿‡ä¸å¿…è¦è®¡ç®—çš„å¸¸è§æ¨¡å¼ã€‚å·¥ä½œéå¸¸ç®€å•â€”â€”

> ä½ æœ‰ä¸€ä¸ªå‡½æ•°ã€‚ä½ ç”¨ä¸€äº›å‚æ•°è°ƒç”¨ than å‡½æ•°ã€‚ä¸‹ä¸€æ¬¡ä½ åšåŒæ ·çš„äº‹æƒ…â€”â€”åªæ˜¯é‡å¤ä½¿ç”¨å·²çŸ¥çš„ç»“æœã€‚

æ‰€æœ‰çš„å›¾ä¹¦é¦†éƒ½è¿™ä¹ˆåšã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯å®ƒä»¬å¦‚ä½•å¤„ç†å‡½æ•° arity(å‚æ•°çš„æ•°é‡)ï¼Œå®ƒä»¬å¯ä»¥å­˜å‚¨å¤šå°‘ç»“æœï¼Œå®ƒä»¬çš„é€Ÿåº¦æœ‰å¤šå¿«ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œlodash.memoize åªâ€œçœ‹åˆ°â€ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œ fast-memoize å­—ç¬¦ä¸²åŒ–æ‰€æœ‰å‚æ•°ï¼Œå¹¶ä½¿ç”¨ JSON ä½œä¸ºç¼“å­˜é”®ã€‚

é€Ÿåº¦ä¹Ÿå¾ˆé‡è¦ã€‚Ramda æ¯”æ²¡æœ‰è®°å¿†çš„ä»£ç å¿« **100 å€**ï¼Œlodash æ¯” ramda å¿« **100 å€**ï¼Œçº³ç±³è®°å¿†æ¯” lodash å¿« **100 å€**ã€‚

> ä½†æ˜¯ä½ ä¸éœ€è¦é€Ÿåº¦ã€‚ä½ éœ€è¦è®°å¿†ã€‚

ä¸Šé¢çš„æ¯”è¾ƒæ˜¯é’ˆå¯¹æ–æ³¢é‚£å¥‘æ•°åˆ—è®¡ç®—çš„ã€‚æ‰€æœ‰è¿™äº›åº“éƒ½å¾ˆæ“…é•¿åŸºäºå‚æ•°æ¥è®°å¿†å‡½æ•°ç»“æœï¼Œæ‰“ç ´æ‰€æœ‰å†…å­˜é™åˆ¶ï¼Œå› ä¸ºé•¿ç¼“å­˜å¤§å°é€šå¸¸æ˜¯ä¸å—é™åˆ¶çš„ã€‚

å…³äºè¿™ä¸ªé—®é¢˜çš„ç¬¬ä¸€ä¸ª*è°ƒç”¨*(å¯¹æˆ‘æ¥è¯´)æ˜¯ç”±ä¸€ä¸ªåä¸º [memoize-one](https://github.com/alexreardon/memoize-one) çš„åº“å‘å‡ºçš„ï¼Œä½œè€…æ˜¯ [Alex Reardon](https://medium.com/u/ea5e41121e55?source=post_page-----535f89fc4a17--------------------------------) ã€‚ä¸»è¦æ„å›¾å¾ˆæ¸…æ¥šâ€”**å®ƒè®°å¿†ä¸€ä¸ªç»“æœ**ã€‚å› ä¸ºä½ å¯èƒ½ä¸éœ€è¦æ›´å¤šã€‚

> è¿™å…¶å®æ˜¯ React/Redux ä¸–ç•Œéœ€è¦çš„ä¸œè¥¿ã€‚åªæœ‰ä¸­æ–­æ›´æ–°çš„èƒ½åŠ›ï¼Œæ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨(åƒå†…å­˜ç¼“å­˜ä¸­çš„å†…å­˜æ³„æ¼)

> åº”è¯¥ä¸ä¼šå¾ˆå¿«ã€‚åº”è¯¥èƒ½ç”¨ã€‚

ä½†æ˜¯ï¼Œä½ çŸ¥é“ï¼Œä½ ä»ç„¶å¿…é¡»å†™ä¸€ä¸ªâ€œç‰¹æ®Šçš„â€ä»£ç æ¥æ­£ç¡®åœ°è®°å¿†ä½ éœ€è¦çš„ä¸œè¥¿ã€‚

```
const mapStateToProps = state => ({
   todos: state.todos.filter(todo => todo.active)
});
```

^:æ¯æ¬¡çŠ¶æ€æ”¹å˜æ—¶ï¼Œè¿™ä¸ªéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ todos æ•°ç»„ã€‚

```
const filterTodos = memoize(todos => todos.filter(todo => todo.active));const mapStateToProps = state => ({
   todos: filterTodos(state.todos)
});
```

^è¿™ä¸ªä¸ä¼šã€‚ç°åœ¨å®ƒåªä¼šå¯¹`state.todos`ç‰©ä½“çš„å˜åŒ–åšå‡ºååº”ã€‚

```
const filterTodos = memoize(todos => todos.filter(todo => todo.active));
const getTodos = todos => todos.map(todo => todo.text )const mapStateToProps = state => ({
   todos: getTodos(filterTodos(state.todos))
});
```

^è¿™ä¸ªä»ç„¶ä¼šå¯¹`state.todos`ç‰©ä½“çš„å˜åŒ–åšå‡ºååº”ï¼Œä½†æ˜¯åº”è¯¥åªå¯¹`todo.text`çš„å˜åŒ–åšå‡ºååº”ã€‚

æ™®é€šåº“ä¹Ÿæœ‰ä¸€ä¸ªå…±åŒçš„â€œé™åˆ¶â€ï¼Œæ¯”å¦‚ä¸€ä¸ª[é‡é€‰](https://github.com/reactjs/reselect) ( **é€‰æ‹©å™¨å’Œè®°å¿†**åº“)ï¼Œå®ƒä¹Ÿåªèƒ½å­˜å‚¨ä¸€ä¸ªâ€œæœ€åâ€ç»“æœã€‚å¹¶ä¸”ï¼Œå¦‚æœä½ æœ‰**å‡ ä¸ª**ä¸åŒçš„**è¿æ¥ç»„ä»¶**ï¼Œéƒ½ä»ä¸€ä¸ªå•†åº—é€‰æ‹©ä¸€äº›ä¸œè¥¿ï¼Œä½†æ˜¯å…·æœ‰ä¸åŒçš„é“å…·â€”â€”ä½ å°†æ€»æ˜¯ç¦ç”¨ä½ çš„è®°å¿†åŠŸèƒ½([é“¾æ¥åˆ°é—®é¢˜](https://github.com/reactjs/reselect#accessing-react-props-in-selectors)ï¼Œ[é“¾æ¥åˆ°å˜é€šåŠæ³•](https://github.com/threadheap/reselect-weakmap-memoize)ï¼Œä»¥åŠ[å¦ä¸€ä¸ªå˜é€šåŠæ³•](https://github.com/toomuchdesign/re-reselect))ã€‚**æœ‰** **å¯** **åªæœ‰ä¸€ä¸ªï¼**ä»–ä»¬åªä¼šä¸€ç›´â€œç¼“å­˜ç¼ºå¤±â€ã€‚

> ç¼–å†™ä¸€ä¸ªé€‚å½“è®°å¿†çš„ä»£ç â€”â€”å¯èƒ½æ˜¯ä¸€é¡¹è‰°å·¨çš„å·¥ä½œã€‚

ä½ å°†æœ€ç»ˆè·å¾—é‡æ–°é€‰æ‹©çº§è”å’Œéå¸¸å…·ä½“çš„è®°å¿†æŠ€æœ¯ï¼Œè¿™å°†ä½¿ä½ èƒ½å¤Ÿä¸ºä½ çš„é¡¹ç›®åˆ›å»ºä¸€ä¸ªâ€œæ›´å¥½çš„â€è®°å¿†ã€‚

> ä¸æ˜¯â€œæ›´å¿«â€ï¼Œè€Œæ˜¯â€œè¯·å°½å¯èƒ½å¤šåœ°è®°å¿†æ¡ˆä¾‹â€

## MobX

æˆ‘ä¸€ç›´å–œæ¬¢ MobX çš„ä¸€ç‚¹â€”â€”æ‡’æƒ°ã€‚æˆ‘å¯ä»¥å·æ‡’ï¼Œå†™ä¸€æ®µä»£ç ï¼Œè¿™æ®µä»£ç ä¼šè¢«å·æ‡’æ‰§è¡Œâ€¦ä»€ä¹ˆä¹Ÿä¸åšã€‚

ä½ ä¸éœ€è¦æƒ³ï¼Œâ€œå“¦ï¼Œå½“è¿™ä¸ªäº‹ä»¶è¢«è°ƒåº¦æ—¶ï¼ŒRedux å°†è§¦å‘æ‰€æœ‰çš„ ConnectedComponentsï¼ŒmapStateToProps æ‰€æœ‰çš„ä¸œè¥¿ï¼Œå¹¶ä¸”å¯èƒ½é‡æ–°ç»˜åˆ¶åº”ç”¨ç¨‹åºçš„ä¸€åŠï¼Œå› ä¸ºæˆ‘çš„ä¸€ä¸ªé€‰æ‹©å™¨æ¯æ¬¡è¿è¡Œéƒ½äº§ç”Ÿä¸€ä¸ªå”¯ä¸€çš„å€¼ã€‚

> ä¸æ˜¯å”¯ä¸€çš„ï¼Œè€Œæ˜¯ä¸å¯æ”¹å˜çš„ã€‚å°±{â€¦originalStateProp}

ä½ çŸ¥é“ï¼Œç”±äºè¿™ç§**ä½çº§ä¼˜åŒ–**ä½ ï¼Œé™¤äº†ä½ å¿…é¡»æä¾›ä»€ä¹ˆï¼Œ**ä½†æ²¡æœ‰**â€”â€”Vue å’Œ Angular å¯ä»¥æ›´å¿«å¼€ç®±ã€‚æˆ‘æ˜¯è¯´ React/Redux å¯èƒ½å¾ˆçƒ‚ã€‚MobXâ€”â€”çŸ³å¤´ï¼

## Immer.js

å“¦ã€‚Immer æ˜¯ä¸€è‚¡æ¸…æ–°çš„ç©ºæ°”ã€‚å®ƒä½¿ç”¨ç°ä»£ javascript çš„èƒ½åŠ›æ¥å¢å¼º reducersï¼Œè®©æ‚¨åªéœ€ç¼–å†™ä»£ç ã€‚è®©æ‚¨åªç¼–å†™æ‚¨éœ€è¦ç¼–å†™çš„ä»£ç ï¼Œè€Œä¸è€ƒè™‘å¦‚ä½•ç¼–å†™ä»£ç (å¹¶ä¿æŒä¸å˜æ€§)ã€‚

Immer æ¯”" not"-immer æ…¢å¾—å¤šï¼Œä½†æ˜¯ä½ ä¸éœ€è¦è¿™äº›æ¯ç§’åƒä¸‡æ¬¡çš„å‡é€Ÿå™¨ï¼Œå¦‚æœæ²¡æœ‰å®ƒä½ å¯èƒ½ä¼šæœ‰çš„ã€‚ä»…ä»…æ¯ç§’ 100 ä¸‡å°±å·²ç»ä¸é”™äº†ã€‚

# ä½†æ˜¯è®°å¿†åŒ–å‘¢ï¼Ÿ

æ‰€ä»¥æˆ‘å»ºç«‹äº†ä¸€ä¸ªå†…å­˜åŒ–åº“ï¼Œå®ƒä¸ MobX å’Œ Immer.js å…±äº«ä¸€äº›ä¸œè¥¿ã€‚å®ƒåªæ˜¯å·¥ä½œï¼Œè§£å†³ä½ çš„é—®é¢˜ã€‚ä¸çŸ¥ä½•æ•…ã€‚ç¥å¥‡åœ°ã€‚éšå½¢çš„ã€‚

æ­£å¦‚æˆ‘åœ¨å¼€å§‹æ‰€è¯´çš„â€”â€”æˆ‘å°è¯•è¿‡æ„å»ºæœ€æ…¢çš„è®°å¿†åº“ï¼Œå®ƒæ˜¯æœ€å¿«çš„è®°å¿†åº“ã€‚

æˆ‘ç§°ä¹‹ä¸ºâ€” **è®°å¿†çŠ¶æ€**ã€‚

[](https://github.com/theKashey/memoize-state) [## Kashey/memoize å›½å®¶

### memo ize-state-mapStateToProps çš„æ­£ç¡®è®°å¿†

github.com](https://github.com/theKashey/memoize-state) 

å®ƒæ˜¯**æ…¢é€Ÿ**cosâ€”â€”å®ƒä½¿ç”¨ javascript `Proxy`æ¥è§‚å¯Ÿå†…å­˜åŒ–çš„å‡½æ•°æ­£åœ¨åšä»€ä¹ˆã€‚å®ƒæ¯”æ™®é€šçš„è®°å¿†åº“å¤š 100 å€çš„ä»£ç ã€‚

å®ƒæ˜¯**å¿«é€Ÿçš„**cosâ€”â€”å½“å®ƒå¿…é¡»å†³å®šå®ƒåº”è¯¥è¿”å›è¢«è®°å¿†çš„å€¼è¿˜æ˜¯å¿…é¡»åˆ·æ–°å®ƒâ€”â€”å®ƒå¯ä»¥**åªæ¯”è¾ƒè¢«ä½¿ç”¨çš„éƒ¨åˆ†å‚æ•°**,ä½¿å®ƒæˆä¸ºâ€¦

> â€œè¯·å°½å¯èƒ½å¤šåœ°è®°ä½æ¡ˆä¾‹â€

åªè¦å®ƒâ€œç»å¸¸â€è®°å¿†ï¼Œå®ƒåœ¨è®¡ç®—ä¸ŠèŠ±è´¹çš„æ—¶é—´å°±ä¼šæ›´å°‘ï¼Œå·¥ä½œé€Ÿåº¦ä¹Ÿä¼šæ›´å¿«â€¦

æˆ‘å¯èƒ½åº”è¯¥è´´ä¸¤ä¸ªä¾‹å­ã€‚

ç¬¬ä¸€ä¸ªå¾ˆç®€å•ã€‚å®ƒåƒæ‰€æœ‰è®°å¿†åŠŸèƒ½ä¸€æ ·å·¥ä½œã€‚

ä½†æ˜¯ç¬¬äºŒä¸ªâ€¦å®ƒä¼š**å¿½ç•¥ç¬¬äºŒä¸ªå…ƒç´ ä¸­çš„å€¼å˜åŒ–**ï¼Œå› ä¸ºä½ æ²¡æœ‰è¯»å–å®ƒï¼Œç”šè‡³æ²¡æœ‰è¿”å›é‚£ä¸ªå…ƒç´ ã€‚ä½ ä¸éœ€è¦å®ƒã€‚

> Memoize-state ä¸ä¼šå¯¹å‚æ•°çš„å˜åŒ–åšå‡ºååº”ï¼Œmemoized å‡½æ•°ä¸ä¼šâ€œä½¿ç”¨â€ã€‚å› æ­¤ï¼Œå®ƒå°†è®°å¿†æ›´å¤šçš„æƒ…å†µã€‚

åªéœ€æƒ³è±¡æ›´å¸¸è§çš„æƒ…å†µâ€” redux çš„ mapStateToPropsã€‚

æ²¡æœ‰ç‰¹åˆ«çš„é€»è¾‘ã€‚æ²¡æœ‰é€‰æ‹©å™¨ã€‚æ²¡æœ‰â€œå‚æ•°çº§â€è®°å¿†ã€‚è€Œä¸”ä½ ä¸ä¼šç›¸ä¿¡æˆ‘ï¼Œ**è¿™äº›å‡½æ•°æ˜¯ç›¸ç­‰çš„**ï¼ä½ å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹åº”ç”¨å†…å­˜çŠ¶æ€ï¼å®ƒä¼šè·Ÿè¸ªä½ æä¾›çš„å‚æ•°çš„ç”¨æ³•ã€‚

> è®°å¿†çŠ¶æ€ä¸æ˜¯â€œå†…éƒ¨â€è®°å¿†ï¼Œä¸æ˜¯â€œåŠŸèƒ½â€è®°å¿†ï¼Œè€Œæ˜¯**â€œå¤–éƒ¨â€è®°å¿†**ã€‚åªè¦ç”¨ memoize-state åŒ…è£…ä»»ä½•ä¸œè¥¿å¹¶è®©å®ƒè¢«è®°å¿†ã€‚ä»»ä½•çº¯ç²¹çš„åŠŸèƒ½ï¼Œåªè¦æœ‰å¯èƒ½ï¼Œéƒ½åº”è¯¥è¢«è®°å¿†ï¼

é€šè¿‡ç›¸åŒçš„æœºåˆ¶ï¼Œå®ƒè§£å†³äº†å…·æœ‰å¤šä¸ªç»„ä»¶çš„*é‡é€‰é—®é¢˜*â€”â€”åªéœ€å°†æ•´ä¸ª mapStateToPropsâ€¦ **åŒ…è£…ä¸¤æ¬¡**ã€‚é“å…·æ²¡æœ‰åŒºåˆ«çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªäººä¸€æ¬¡ï¼Œæ¯ä¸ªç»„ä»¶ç¬¬äºŒæ¬¡ï¼Œå¦‚æœä»–ä»¬çš„é€‰æ‹©å™¨ä¸åŒã€‚æˆ‘æœ‰ä¸€ä¸ªè½¯ä»¶åŒ…ï¼Œå¯ä»¥è‡ªåŠ¨å®Œæˆã€‚

[](https://github.com/theKashey/beautiful-react-redux) [## å¡å¸Œ/ç¾ä¸½ååº”è¿˜åŸ

### ç¾ä¸½-ååº”-è¿˜åŸ-è¿˜åŸğŸš€ï¼ŒReduxğŸ¤˜ï¼ŒReduxğŸ”¥

github.com](https://github.com/theKashey/beautiful-react-redux) 

æˆ‘åœ¨è¿™é‡Œåªèƒ½è¯´å‡ºä¸å¥½çš„ä¸œè¥¿â€”â€”åªè¦ä½ ä¸èƒ½ä½¿ç”¨åƒé‡é€‰çº§è”è¿™æ ·çš„ä¸œè¥¿ï¼Œä½ å°±ä¸ä¼šä½¿ç”¨å®ƒä»¬(ç»éªŒæ³•åˆ™)ã€‚å› æ­¤ï¼Œæ‚¨ä¹Ÿå°†ä¸¢å¤±ç¼“å­˜çº§è”ã€‚ç»“æœæ˜¯â€”â€”æœ‰äº›ä¸œè¥¿ä¼šè¢«è®¡ç®—ä¸¤æ¬¡ã€‚

> æ²¡æœ‰æ±½è½¦èƒ½å–ä»£ä½ ã€‚ä½ æ˜¯æ–½å±•é­”æ³•çš„æ³•å¸ˆã€‚

## ååº”-è®°å¿†

Memoize-state å·¥ä½œèµ·æ¥éå¸¸ç®€å•ï¼Œå¯¹ç”¨æˆ·æ¥è¯´æ˜¯ä¸å¯è§çš„ï¼Œå› æ­¤æˆ‘åœ¨å¦ä¸€ä¸ªåº“ä¸­ä½¿ç”¨äº†å®ƒï¼Œå¹¶è€ƒè™‘åˆ°äº† Memoizeã€‚æ­£å¦‚ä¸¹Â·é˜¿å¸ƒæ‹‰è«å¤«æ‰€æè®®çš„ã€‚

æˆ‘æ„å»ºçš„åº“ä¸æ˜¯åŸºäºè¿™ä¸ªè§„èŒƒï¼Œåªè¦ä½ çš„è®°å¿†å‡½æ•°æ˜¯â€œå¤–éƒ¨çš„â€å°±æ²¡æœ‰å¿…è¦ã€‚

å®ƒåªæ˜¯å°†æ‰€æœ‰çš„é“å…·(é™¤äº†`compute`)ä¼ é€’ç»™`compute`å‡½æ•°ï¼Œå¹¶é€šè¿‡å­å‡½æ•°(åˆå renderProps)æ¸²æŸ“ç»“æœã€‚

ä»…æ­¤è€Œå·²ã€‚å…¶ä»–çš„éƒ½è—åœ¨å¼•æ“ç›–ä¸‹ã€‚ä½ åº”è¯¥ç›¸ä¿¡è®°å¿†çŠ¶æ€ã€‚æ£€æŸ¥ repoâ€”â€”å®ƒåŒ…å«ä¸€ä¸ªæŒ‡å‘ codesandox ç¤ºä¾‹çš„é“¾æ¥ã€‚

[](https://github.com/theKashey/react-memoize) [## è®°å¿†/ååº”-è®°å¿†

### ååº”å¼å†…å­˜ç¼“å­˜(åˆåå†…å­˜åŒ–)æ˜¯ä¸€ç§éå¸¸å¼ºå¤§çš„ä¼˜åŒ–æŠ€æœ¯

github.com](https://github.com/theKashey/react-memoize) 

## è®°å¿†çŠ¶æ€

ç¼–å†™è¿™ä¸ªåº“ä¸æ˜¯ä¸€é¡¹ç®€å•çš„ä»»åŠ¡ã€‚æˆ‘å†™äº†å®ƒï¼ŒèŠ±äº†ä¸¤å¤©æ—¶é—´ï¼Œæµ‹è¯•å®ƒï¼Œåœ¨ twitter ä¸Šå‘å¸ƒï¼Œå‘ç°è¿™ä¸ªåº“ä¸å·¥ä½œï¼Œæˆ‘çš„æ„æ€æ˜¯å®Œå…¨ä¸å·¥ä½œï¼Œå¹¶èŠ±äº†ä¸¤ä¸ªå¤šæ˜ŸæœŸåœ¨ç ”å‘ä¸Š

æˆ‘ä¿®å¥½äº†å®ƒã€‚æ¥ä¸‹æ¥æˆ‘å†™äº†è¿™ç¯‡æ–‡ç« ã€‚å‘ç°æˆ‘çŠ¯çš„é”™è¯¯è¶Šæ¥è¶Šå°‘ã€‚ä¿®å¥½å®ƒä»¬ã€‚å‘ç°æ²¡å‡ ä¸ªâ€œå®¢æˆ·â€ï¼Œä»”ç»†æ£€æŸ¥è¿™æ¬¡çœŸçš„â€œæå®šâ€äº†ã€‚

å®ƒå®é™…ä¸Šæ˜¯å¦‚ä½•å·¥ä½œçš„â€”â€”å®ƒåªæ˜¯ç”¨ä»£ç†(æ¥è‡ª [proxyequal](https://github.com/theKashey/proxyequal) åº“)åŒ…è£…æ‰€æœ‰ç»™å®šçš„å‚æ•°ï¼Œè€Œ**ç›‘è§†**ä½¿ç”¨æƒ…å†µã€‚

åœ¨ memoized å‡½æ•°æ‰§è¡Œåï¼Œmemoize-state å°†ä»æä¾›çš„å‚æ•°ä¸­çŸ¥é“æ‰€æœ‰ä½¿ç”¨çš„â€œå­é”®â€ã€‚å­é”®ï¼Œä¸å¯èƒ½æ£€æµ‹åˆ°æœ‰äººä½¿ç”¨(æˆ–æœªä½¿ç”¨)äº†é”®(å‚æ•°)æœ¬èº«ã€‚

ç„¶åï¼Œå½“è®°å¿†å‡½æ•°è¢«ç¬¬äºŒæ¬¡è°ƒç”¨æ—¶â€”â€”å®ƒå°†ä¸å¾—ä¸æ¯”è¾ƒçš„ä¸æ˜¯å¯¹è±¡æœ¬èº«ï¼Œè€Œæ˜¯æ•´ä½“çš„ä¸€å°éƒ¨åˆ†ã€‚è¿™æ˜¯æˆ‘çŠ¯çš„ç¬¬ä¸€ä¸ªé”™è¯¯ã€‚

å¦‚æœä½ ä½¿ç”¨äº†`a.b.c.d`ï¼Œä½ å¿…é¡»â€œé‡è§†â€â€”â€”åªæ¯”è¾ƒ`.d` **è®©æ‰€æœ‰å…¶ä»–è·¯å¾„éƒ½â€œçµæ´»â€**ï¼Œå¦åˆ™è¿™ç§è®°å¿†å°†ä¸èµ·ä½œç”¨ã€‚æˆ‘èŠ±äº†ä¸€å‘¨æ—¶é—´æ‰æ˜ç™½ä¸ºä»€ä¹ˆæˆ‘å†™çš„ç®€å•æ¯”è¾ƒå‡½æ•°åœ¨ç°å®ä¸­ä¸èµ·ä½œç”¨ã€‚

é”™è¿‡çš„ç‚¹â€”â€”æˆ‘ä»¬è¿˜å¿…é¡»`deproxyfy`ç»“æœï¼Œåœ¨è¢«è®°å¿†çš„å‡½æ•°å†…ç¡®å®šè·Ÿè¸ªä»£ç çš„èŒƒå›´ï¼Œä¸è¦è®©å®ƒæ³„éœ²å‡ºå»â€¦â€¦å¹¶è·Ÿè¸ªå‡½æ•°è¿”å›çš„é”®ã€‚

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œmemoize-state åº”è¯¥å¯¹`state.a.b.c`ä½œå‡ºååº”ï¼Œåªè¦è¿™æ˜¯æ‰€ä½¿ç”¨çš„â€œæœ€æ·±â€é”®ï¼Œå¹¶ä¸”åªè¦å®ƒè¢«è¿”å›ï¼Œå°±å¯¹`state.a.b`ä½œå‡ºååº”ã€‚ä½†ä¸æ˜¯`state.a`â€”â€”å®ƒåº”è¯¥ä¿æŒâ€œçµæ´»â€ã€‚

è¿˜æœ‰ä»£ç†ä¸­çš„ä»£ç†(æˆ–ä¸¤æ¬¡è®°å¿†)ï¼Œè¿™åœ¨è®°å¿†ä¸­åº”è¯¥æ˜¯éå¸¸å‡†ç¡®çš„ï¼Œä»¥é˜²æ­¢è¯¯æŠ¥ç¼“å­˜ã€‚

ç›®å‰æ‰€æœ‰è¾¹ç¼˜æƒ…å†µéƒ½å·²è§£å†³å¹¶æµ‹è¯•ï¼Œ**è®°å¿†çŠ¶æ€ç¨³å®š**ã€‚

## é€Ÿåº¦

Memoize-state å°†åŸºå‡†ä½œä¸º CI çš„ä¸€éƒ¨åˆ†ã€‚å¾ˆéš¾ç†è§£è¿™ä¸ªåº“çš„æ€§èƒ½â€”â€”å®ƒæ€»æ˜¯åœ¨è®°å¿†åŠŸèƒ½çš„â€œæˆæœ¬â€å’Œè®°å¿†ç³–çš„â€œæˆæœ¬â€ä¹‹é—´å–å¾—å¹³è¡¡ã€‚

ä½†æ˜¯è®©æˆ‘ä»¬è¯•è¯•ã€‚

1.  â€œæ ‡å‡†â€è®°å¿†ã€‚3 ä¸ªæ•´æ•°å‚æ•°çš„å‡½æ•°ã€‚æ²¡æœ‰å˜åŒ–ã€‚

> memoize-one x 6703353 æ“ä½œ/ç§’
> lodash.memoize x 3095017 æ“ä½œ/ç§’
> fast-memoize x 1013601 æ“ä½œ/ç§’
> memoize-state x 4007493 æ“ä½œ/ç§’

ä¸åã€‚æ¯” lodash æ›´å¥½ã€‚Fast-memoize æœ‰ç‚¹ç³Ÿç³•ï¼Œå› ä¸ºå°† 3 ä¸ªæ—§çš„æ™®é€šç±»å‹(int)è½¬æ¢æˆ JSON æ¥å­˜å‚¨è¿™äº›ä¸œè¥¿â€”â€”æˆæœ¬å¾ˆé«˜ã€‚

*è¿™æ˜¯ä¸€ä¸ªæ‚¬è€Œæœªå†³çš„é—®é¢˜ï¼Œcos lodash åšåŒæ ·çš„è½¬æ¢ã€‚*

2.â€œæ ‡å‡†â€è®°å¿†ã€‚3 ä¸ªæ•´æ•°å‚æ•°çš„å‡½æ•°ã€‚æ‰€æœ‰å˜åŒ–ã€‚

> memoize-one x 21573 æ“ä½œ/ç§’
> lodash.memoize x 35272 æ“ä½œ/ç§’
> fast-memoize x 19195 æ“ä½œ/ç§’
> memoize-state x 19436 æ“ä½œ/ç§’

ä¸æ˜¯æœ€å¥½çš„ã€‚ä½†æ˜¯è¿™æ˜¯è¾¹ç¼˜æƒ…å†µï¼Œå½“ä½ ä¸éœ€è¦ä»»ä½•è®°å¿†çš„æ—¶å€™ã€‚

3.â€œå›½å®¶â€æ¡ˆã€‚éšæœºæ”¹å˜ç±»ä¼¼çŠ¶æ€çš„ç‰©ä½“ã€‚

> memo ize-one x 9921
> lodash . memo ize x 93547
> fast-memo ize x 90966
> memo ize-state x 1301700

~ 13 ä¸‡ vs ~9000ã€‚å®ƒåªæ˜¯å¿½ç•¥äº†å¤§éƒ¨åˆ†çš„éšæœºçŠ¶æ€å˜åŒ–ï¼Œå› ä¸ºé•¿è®°å¿†å‡½æ•°åªä½¿ç”¨äº†ä¸€ä¸ªå­é›†ã€‚

4.â€œå¤§å·â€æ¡ˆã€‚åªæ˜¯æä¾›å¤§çš„çŠ¶æ€ã€‚

> memo ize-one x 10523
> lodash . memo ize x 258
> å¿«é€Ÿè®°å¿† x 255
> è®°å¿†çŠ¶æ€ x 81181

80000 å¯¹ 300ã€‚

lodash memoize å’Œ fast-meoize å°†çŠ¶æ€è½¬æ¢ä¸º jsonã€‚åä¸»æ„ã€‚memo ize-ä¸€ä¸ªåšæµ…ç›¸ç­‰ï¼Œä½†å¾ˆå¤šå€¼ã€‚è®°å¿†-çŠ¶æ€æ‰§è¡Œç‹™å‡»æ‰‹æ¯”è¾ƒã€‚

## ç¼“å­˜å‘½ä¸­

åŸå§‹æ€§èƒ½æµ‹è¯•ä¸ä»…åŒ…å«æ¯ç§’æ“ä½œæ•°ï¼Œè¿˜åŒ…å«â€œç¼“å­˜å‘½ä¸­â€å‚æ•°ã€‚è¿™å¯èƒ½æ›´é‡è¦ã€‚

> ä½ çš„è®°å¿†åŠŸèƒ½å¯ä»¥å¾ˆæ…¢ï¼Œåªè¦å®ƒæ¯”â€œé”™è¿‡çš„â€è®°å¿†å’Œæ ‘æ¸²æŸ“å¯¼è‡´çš„ react/redux/redraw å¿«ã€‚

æ­£ç¡®çš„é‡é€‰çº§è”å¯ä»¥æœ‰ 100%çš„ç¼“å­˜å‘½ä¸­ç‡ï¼Œä½†æ˜¯å¾ˆéš¾ç¼–å†™æ­£ç¡®çš„çº§è”ï¼Œè°ƒè¯•å®ƒï¼Œä½¿å®ƒä¿æŒæœ€æ–°ã€‚å—¯ï¼Œåªæ˜¯éœ€è¦æ—¶é—´ã€‚

memoize-one çš„â€œç¼“å­˜å‘½ä¸­â€æ¥è¿‘ç†æƒ³çŠ¶æ€ã€‚å®ƒå°†å°½å¯èƒ½å¤šåœ°è®°å¿†æ¡ˆä¾‹ã€‚

å®ƒæ¯”æ™®é€šçš„è®°å¿†åº“å¤§ 10 å€ï¼Œæ¯”æ™®é€šçš„è®°å¿†åº“æ…¢ 10 å€ï¼Œä½†æ˜¯ï¼Œä½ çŸ¥é“ï¼Œä½ çš„åº”ç”¨ç¨‹åºä¼šåŒæ ·å¿« 10 å€ã€‚æ²¡æœ‰ä»»ä½•æ—¶é—´èŠ±åœ¨ä¼˜åŒ–ä¸Šã€‚

> è¿™å°±æ˜¯ç›®æ ‡ã€‚æ²¡æœ‰ä»€ä¹ˆâ€œç‰¹æ®Šâ€çš„äº‹æƒ…éœ€è¦ä½ å»åšã€‚

## æµè§ˆå™¨æ”¯æŒ

Memoize-state å’Œæ‰€æœ‰åŸºäºå®ƒçš„åº“éƒ½éœ€è¦ ES6 ä»£ç†ã€‚IE11 å’Œ React-Native éƒ½ä¸æ”¯æŒï¼Œä½ å¾—å¤šå¡«ã€‚ä¸æ˜¯é—®é¢˜ã€‚

[](https://github.com/tvcutsem/harmony-reflect) [## tvcutsem/å’Œå£°-åå°„

### ç”¨äº ES6 åå°„å’Œä»£ç†å¯¹è±¡çš„ harmony-reflect - ES5 shim

github.com](https://github.com/tvcutsem/harmony-reflect) 

## ç»“è®º

è®°å¿†çŠ¶æ€ä¸èƒ½ä»£æ›¿â€œæ™®é€šçš„â€è®°å¿†å‡½æ•°ï¼Œå¯¹äºâ€œæ™®é€šçš„æ—§ç±»å‹â€â€”â€”å­—ç¬¦ä¸²å’Œæ•´æ•°ä½œä¸ºå‚æ•°çš„æƒ…å†µï¼Œåªè¦å®ƒéå¸¸å¤æ‚ã€‚è¯·éšæ„ä½¿ç”¨ä»»ä½•å…¶ä»–ä½çº§åº“ã€‚

å¦‚æœä½ ä¼ é€’ä¸€ä¸ªå¯¹è±¡â€”â€”çŠ¶æ€ã€é“å…·ï¼Œæˆ–è€…åªæ˜¯æŠŠä½ æ‰€æœ‰çš„å˜é‡æ”¾å…¥å¯¹è±¡ä¸­å¹¶ä¼ é€’é‚£ä¸ªå¯¹è±¡ï¼Œå®ƒå°±ä¼šå‘å…‰ã€‚é—ªäº®äº®ï¼

> const easy win = memoizeState(your function)

è¿™ç§â€œä¸å¯è§çš„è®°å¿†åŒ–â€å¸®åŠ©æˆ‘æ„å»ºäº†ä¸¤ä¸ªéå¸¸æœ‰ç”¨çš„åº“ï¼Œå¹¶åœ¨å¼€å‘å‘¨æœŸå’Œè¿è¡Œæ—¶èŠ‚çœäº†å¤§é‡æ—¶é—´ã€‚).

ä½ èƒ½ç”¨å®ƒå»ºé€ ä»€ä¹ˆï¼Ÿ

[](https://github.com/theKashey/memoize-state) [## Kashey/memoize å›½å®¶

### memo ize-state-mapStateToProps çš„æ­£ç¡®è®°å¿†

github.com](https://github.com/theKashey/memoize-state)