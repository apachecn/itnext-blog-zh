# å°† ExpressJS(èŠ‚ç‚¹)web åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° Heroku

> åŸæ–‡ï¼š<https://itnext.io/deploying-an-expressjs-node-web-application-to-heroku-c0f36e5671fd?source=collection_archive---------2----------------------->

## Heroku PaaS

## åœ¨æœ¬è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ ExpressJs åˆ›å»ºä¸€ä¸ªç¤ºä¾‹å›¾åƒå¤„ç† web åº”ç”¨ç¨‹åºï¼Œå¹¶å°†å…¶æ‰˜ç®¡åœ¨ Heroku ä¸Šã€‚

![](img/ed5c992dea5fd3e7f3bc4bd2d0ee2d27.png)

(æ¥æº:ã€unsplash.comã€‘**)**

**[**Heroku**](https://heroku.com/) æ˜¯ PaaS ( *å¹³å°å³æœåŠ¡*)æä¾›å•†ã€‚ä½¿ç”¨ Herokuï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å‡ ç§’é’Ÿå†…åœ¨äº‘ä¸Šéƒ¨ç½²åº”ç”¨ç¨‹åºã€‚æ”¯æŒ Javaã€Node.jsã€Pythonã€PHPã€Go ç­‰å¤šç§ç¼–ç¨‹è¯­è¨€ã€‚**

**Heroku ä¸ AWSã€Google Cloud æˆ– Azure ç­‰å…¶ä»–å¹³å°çš„ä¸åŒä¹‹å¤„åœ¨äºå°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°äº‘çš„ä¾¿åˆ©æ€§ã€‚å°½ç®¡ Heroku æä¾›äº†ä¼ä¸šçº§ç‰¹æ€§ï¼Œä½†å®ƒæ˜¯å¿«é€Ÿéƒ¨ç½²å’Œæµ‹è¯•åº”ç”¨ç¨‹åºçš„æœ€ç®€å•çš„å¹³å°ä¹‹ä¸€ã€‚**

**ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³è¦éƒ¨ç½²åä¸º`my-project`çš„å¼€æºé¡¹ç›®çš„æ–‡æ¡£(*ä½œä¸ºç½‘ç«™*)ï¼Œæ‚¨å¯ä»¥ç®€å•åœ°åˆ›å»ºä¸€ä¸ª Heroku åº”ç”¨ç¨‹åºï¼Œå°†å­˜å‚¨åº“ä»£ç æ¨é€åˆ° Herokuï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºå°†åœ¨`[http://my-project.herokuapp.com](http://my-project.herokuapp.com.)`éƒ¨ç½²ã€‚å°±è¿™ä¹ˆç®€å•ã€‚**

**æœ€æ£’çš„æ˜¯ï¼Œä½ å¯ä»¥åœ¨æœ‰ä¸€äº›é™åˆ¶çš„æƒ…å†µä¸‹å…è´¹å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° Heroku **ã€‚è¿™äº›é™åˆ¶å°†åº”ç”¨äºåº”ç”¨ç¨‹åºçš„æ­£å¸¸è¿è¡Œæ—¶é—´ã€å®ƒæ¥æ”¶çš„æµé‡ã€åˆ†é…ç»™æ¯ä¸ªåº”ç”¨ç¨‹åºçš„å†…å­˜ä»¥åŠå…¶ä»–æ¬¡è¦çš„äº‹æƒ…ã€‚è¦äº†è§£æ›´å¤šæœ‰å…³è¿™äº›é™åˆ¶çš„ä¿¡æ¯ï¼Œè¯·é˜…è¯»æœ¬** æ–‡æ¡£ã€‚æˆ–è€…ä½ å¯ä»¥è·å¾—ä¸€ä»½ [**ä¿è´¹è®¡åˆ’**](https://www.heroku.com/pricing) ã€‚**

## **Heroku æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ**

**Heroku æ˜¯ä¸€ä¸ªåŸºäºå®¹å™¨çš„å¹³å°ã€‚æ¯ä¸ª Heroku åº”ç”¨ç¨‹åºéƒ½å°†è¢«éƒ¨ç½²ä¸ºä¸€ä¸ªå®¹å™¨ï¼Œæ‚¨å¯ä»¥åœ¨æ¯ä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å¤šä¸ªè¿™æ ·çš„å®¹å™¨æ¥æ‰©å±•æ‚¨çš„åº”ç”¨ç¨‹åºã€‚å°½ç®¡ Heroku æä¾› Docker é›†æˆï¼Œä½† Heroku é»˜è®¤ä½¿ç”¨ **Dynos** æ¥è¿è¡Œåº”ç”¨ç¨‹åºã€‚**

**ä¸€ä¸ª [**dyno**](https://www.heroku.com/dynos) æ˜¯ä¸€ä¸ªéš”ç¦»çš„ã€è™šæ‹ŸåŒ–çš„ [Linux å®¹å™¨](https://www.redhat.com/en/topics/containers/whats-a-linux-container)è¿è¡Œä½ çš„åº”ç”¨ç¨‹åºä»£ç ã€‚è¿™ä¸ª dyno å°±åƒä¸€ä¸ªè™šæ‹Ÿæœºï¼Œå…·æœ‰è¿è¡Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ‰€éœ€çš„ä¾èµ–å…³ç³»ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬çš„æºä»£ç åŒ…å«ä¸€ä¸ª`package.json`ï¼Œé‚£ä¹ˆ Heroku ç”¨ Node.js å®‰è£…åˆ›å»ºä¸€ä¸ª dynoã€‚**

**Heroku ä¸ºè¯­è¨€ç‰¹æ€§å’Œå·¥å…·ä½¿ç”¨äº†ä¸€ä¸ª**æ„å»ºåŒ…**ã€‚æ„å»ºåŒ…ä¸ºæ„å»ºå’Œè¿è¡Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæä¾›äº†å¿…è¦çš„ä¾èµ–ã€‚å¯¹äº Node.js åº”ç”¨ç¨‹åºï¼ŒHeroku ä½¿ç”¨äº†`heroku/nodejs`æ„å»ºåŒ…ã€‚æœ‰å…³è¯¥ä¸»é¢˜çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·é˜…è¯» [**è¯¥**](https://devcenter.heroku.com/articles/buildpacks) æ–‡æ¡£ã€‚**

> ***ğŸ’¡*å¦‚æœä½ æƒ³è¿è¡Œä¸€ä¸ªç”¨ Heroku ä¸æ”¯æŒçš„è¯­è¨€ç¼–å†™çš„åº”ç”¨ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ª[ç¬¬ä¸‰æ–¹æ„å»ºåŒ…](https://devcenter.heroku.com/articles/buildpacks#using-a-third-party-buildpack)ã€‚å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºéœ€è¦å¤šä¸ª buildpacks(å¯¹äºä¸€ä¸ªç”¨å¤šç§ç¼–ç¨‹è¯­è¨€ç¼–å†™çš„åº”ç”¨ç¨‹åº)ï¼Œè¯·éµå¾ª [**è¿™ä¸ª**](https://devcenter.heroku.com/articles/using-multiple-buildpacks-for-an-app) æ–‡æ¡£ã€‚**

**ä¸€ä¸ª **web dyno** æ˜¯ä¸€ä¸ªè¿è¡Œä½ çš„ web åº”ç”¨å¹¶æ¥æ”¶æµé‡çš„ dynoã€‚åœ¨è¿™ä¸ª dyno ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œæ¯”å¦‚ Express applicationï¼Œæ¥æ¥æ”¶è¯·æ±‚å’Œæä¾› web å†…å®¹ã€‚worker dyno æ˜¯ä¸€ä¸ªåœ¨åå°è¿è¡Œçš„å®¹å™¨ï¼Œå®ƒå¯¹äºè¿è¡Œåå°ä»»åŠ¡å¾ˆæœ‰ç”¨ã€‚è¦äº†è§£æ›´å¤š Heroku æ”¯æŒçš„ dyno ç±»å‹ï¼Œè¯·é˜…è¯»æœ¬ æ–‡æ¡£ã€‚**

**ä¸€ä¸ª Heroku åº”ç”¨ç¨‹åºåŒ…å«äº†æˆ‘ä»¬æƒ³è¦åœ¨ web dyno ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºçš„æºä»£ç ã€‚å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡åˆ›å»ºåº”ç”¨ç¨‹åºæ—¶ï¼ŒHeroku åªè·å¾— dyno çš„æºä»£ç å’Œé…ç½®ã€‚æˆ‘ä»¬éœ€è¦é€šè¿‡ç¼©æ”¾ **web dyno** çš„æ•°é‡æ¥æ‰‹åŠ¨ç¼©æ”¾åº”ç”¨ç¨‹åºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ•°å­—æ˜¯`1`å’Œè‡ªç”±å±‚å¸æˆ·ç»™æˆ‘ä»¬ä¸€ä¸ªæœ€å¤§çš„`1`ç½‘é¡µåŠ¨æ€ã€‚**

**å°½ç®¡è¿™äº›ä¿¡æ¯å¬èµ·æ¥è®©äººä¸çŸ¥æ‰€æªï¼Œä½†æˆ‘ä»¬çœŸçš„ä¸éœ€è¦æ¯å¤©éƒ½å¤„ç†è¿™äº›ä¿¡æ¯ã€‚Heroku æä¾›äº†ä¸€ä¸ª CLI ( **å‘½ä»¤è¡Œç•Œé¢**)æ¥è½»æ¾åˆ›å»ºã€æµ‹è¯•ã€éƒ¨ç½²å’Œæ‰©å±•åº”ç”¨ç¨‹åºã€‚**

# **åˆ›å»º Heroku åº”ç”¨ç¨‹åº**

**é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª Heroku è´¦æˆ·ã€‚è¦åˆ›å»ºå…è´¹å¸æˆ·ï¼Œè¯·ä½¿ç”¨`[signup.heroku.com](https://signup.heroku.com/)` URL å¹¶å¡«å†™å¿…è¦çš„è¯¦ç»†ä¿¡æ¯ã€‚è¯·ç¡®ä¿ä½¿ç”¨æœ‰æ•ˆçš„ç”µå­é‚®ä»¶åœ°å€ä½œä¸ºæ‚¨çš„ç”¨æˆ·åã€‚å¦‚æœæ‚¨å·²ç»æœ‰ä¸€ä¸ªå¸æˆ·ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä½¿ç”¨`[id.heroku.com/login](https://id.heroku.com/login)` URL ç™»å½•ä»ªè¡¨æ¿ã€‚**

**![](img/9317c5c2179bd1a0eb89b1a8104f54be.png)**

**([https://dashboard.heroku.com/apps](https://dashboard.heroku.com/apps))**

**ç™»å½•åï¼Œæ‚¨å°†è¢«é‡å®šå‘åˆ°ä»ªè¡¨æ¿é¡µé¢ã€‚è¿™æ˜¯æ‚¨å°†çœ‹åˆ° Heroku åº”ç”¨ç¨‹åºçš„åœ°æ–¹ã€‚ä½ å¯ä»¥ç‚¹å‡»`Create new app`æŒ‰é’®æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ Heroku åº”ç”¨ç¨‹åºå¹¶è¿æ¥åˆ° GitHub åº“ï¼Œä½†æ˜¯æˆ‘ä»¬å°†éµå¾ªå¦ä¸€ç§éƒ¨ç½² Heroku åº”ç”¨ç¨‹åºçš„æ–¹æ³•ã€‚**

## **åº”ç”¨ç¨‹åºç»“æ„**

**æˆ‘ä»¬å°†ä½¿ç”¨ Node æ„å»ºä¸€ä¸ªç®€å•çš„å›¾åƒå¤§å°è°ƒæ•´åº”ç”¨ç¨‹åºã€‚å¯¹äºå›¾åƒå¤§å°è°ƒæ•´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`[sharp](https://sharp.pixelplumbing.com/)`åŒ…ã€‚æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª [**Express**](http://expressjs.com/) æœåŠ¡å™¨ï¼Œå®ƒæ¥å—`/resize`ç«¯ç‚¹ä¸Šçš„è¯·æ±‚å¹¶è¿”å›ä¸€ä¸ªè°ƒæ•´è¿‡å¤§å°çš„æµ‹è¯• PNG å›¾åƒã€‚é»˜è®¤çš„`/`ç«¯ç‚¹è¿”å›`index.html`ï¼Œå®ƒåŒ…å«ä¸€äº›å…³äº`/resize`ç«¯ç‚¹ä½¿ç”¨çš„ä¿¡æ¯ã€‚**

**è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º`heroku-image-resize`çš„é¡¹ç›®ç›®å½•ï¼Œå¹¶è¿è¡Œ`$ npm ini -y`å‘½ä»¤æ¥åˆå§‹åŒ–`package.json`æ–‡ä»¶ã€‚ç„¶åæˆ‘ä»¬éœ€è¦å®‰è£…ç”¨äºè°ƒæ•´å›¾åƒå¤§å°çš„`[sharp](https://github.com/lovell/sharp)`åŒ…å’Œ`[express](https://www.npmjs.com/package/express)`åŒ…ã€‚**

```
$ npm install --save sharp express
```

**ä¸€æ—¦å®‰è£…äº†ä¸Šè¿°ä¾èµ–é¡¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ Express HTTP æœåŠ¡å™¨ä¸Šå·¥ä½œäº†ã€‚è®©æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­åˆ›å»º`server.js`æ–‡ä»¶ï¼Œå¹¶ç¼–å†™ä¸€ä¸ªé€»è¾‘æ¥å¤„ç†`/`å’Œ`/resize`ç«¯ç‚¹ã€‚å¯¹äºæµ‹è¯•å›¾åƒï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ [**Lenna**](https://en.wikipedia.org/wiki/Lenna#/media/File:Lenna_(test_image).png) ã€‚è®©æˆ‘ä»¬ä¸‹è½½è¿™ä¸ªå›¾åƒï¼Œå¹¶åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­å°†å…¶ä¿å­˜ä¸º`lenna.png`ã€‚**

```
**heroku-image-resize/**
â”œâ”€â”€ .gitignore
â”œâ”€â”€ LICENSE
â”œâ”€â”€ README.md
â”œâ”€â”€ lenna.png
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ Procfile
â”œâ”€â”€ server.js
â””â”€â”€ www
   â”œâ”€â”€ index.html
   â”œâ”€â”€ main.js
   â””â”€â”€ style.css
```

> ***ğŸ’¡*ä½ å¯ä»¥åœ¨ [**è¿™ä¸ª**](https://github.com/course-one/heroku-image-resize) GitHub ä»“åº“é‡Œæ‰¾åˆ°ä¸Šé¢çš„æ–‡ä»¶ã€‚**

**æˆ‘ç¨åä¼šè°ˆåˆ°`Procfile`æ–‡ä»¶ï¼Œå› ä¸ºå®ƒæ˜¯ Heroku ä½¿ç”¨çš„ã€‚`www`ç›®å½•åŒ…å«æˆ‘ä»¬çš„ web åº”ç”¨ç¨‹åºçš„èµ„äº§ï¼Œå°½ç®¡ç°åœ¨æ‚¨å¯ä»¥å¿½ç•¥`main.js`å’Œ`style.css`ä¸­çš„å†…å®¹ã€‚`index.html`ä»`<img>`å…ƒç´ å†…çš„`/resize`ç«¯ç‚¹å‘ˆç°æ ·æœ¬å›¾åƒã€‚**

**(server . js/source:[gist.github.com](https://gist.github.com/thatisuday/005c495b65489c6edbcdc9812a068353))**

**åœ¨ä¸Šé¢çš„`server.js`æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬åœ¨`/`ç«¯ç‚¹ä¸Šå‘é€`index.html`æ–‡ä»¶ï¼Œè€Œ`/www`ç«¯ç‚¹ä»`www/`ç›®å½•å‘é€èµ„äº§ï¼Œå¦‚`style.css`å’Œ`main.js`ã€‚`/resize`ç«¯ç‚¹æ¥æ”¶`:size`å‚æ•°ï¼Œè¯¥å‚æ•°ä¸ºè¦è°ƒæ•´å¤§å°çš„å›¾åƒæä¾›å°ºå¯¸ã€‚**

**HTTP æœåŠ¡å™¨åœ¨ç«¯å£`80`ä¸Šå¯åŠ¨ï¼Œé™¤éé€šè¿‡`PORT`ç¯å¢ƒå˜é‡æä¾›ç«¯å£ã€‚è¿™æ˜¯å¿…è¦çš„ï¼Œå› ä¸º Heroku ä¸ºåº”ç”¨ç¨‹åºæä¾›äº†ä¸€ä¸ªç«¯å£ï¼Œå®ƒå°†åœ¨è¿™ä¸ªç«¯å£ä¸Šé€šè¿‡`PORT`ç¯å¢ƒå˜é‡æ¥æ”¶ web æµé‡ã€‚è®©æˆ‘ä»¬é€šè¿‡è¿è¡Œ`$ node server.js`å‘½ä»¤æ¥å¯åŠ¨è¿™ä¸ªæœåŠ¡å™¨ï¼Œè¿™ä¸ªå‘½ä»¤å°†ä¸ºç«¯å£`80`ä¸Šçš„åº”ç”¨ç¨‹åºæä¾›æœåŠ¡ã€‚**

**![](img/4aebc8c6009387b5905f064045c7e9b5.png)**

**( [http://localhost](http://localhost) )**

**ä¸€æ—¦æœåŠ¡å™¨å¯åŠ¨å¹¶è¿è¡Œï¼Œæ‚¨å°±å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è®¿é—®`[http://localhost](http://localhost)` URLã€‚è¿™å°†è·å–å¹¶å‘ˆç°`index.html`,å®ƒæ˜¾ç¤ºä¸€ä¸ªè°ƒæ•´è¿‡å¤§å°çš„å›¾åƒå’Œä¸€ä¸ªæä¾›å›¾åƒå¤§å°çš„è¾“å…¥ã€‚å½“æˆ‘ä»¬ç‚¹å‡»`SUBMIT`æŒ‰é’®æ—¶ï¼Œ`main.js`å†…éƒ¨çš„ä¸€ä¸ªå‡½æ•°ç”¨`/resize/200x200`å€¼( *URL* )æ›¿æ¢`<img>`å…ƒç´ çš„`src`å±æ€§ã€‚**

## **åˆ›å»ºå’Œéƒ¨ç½² Heroku åº”ç”¨ç¨‹åº**

**é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®‰è£… Heroku CLIã€‚è¦å®‰è£…æ­¤ CLIï¼Œæ‚¨å¯ä»¥æŒ‰ç…§è¿™äº›å’Œè¯´æ˜è¿›è¡Œæ“ä½œã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ macOSï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä½¿ç”¨`$ brew install heroku/brew/heroku`å‘½ä»¤æ¥å®‰è£…å®ƒã€‚**

**![](img/53dddc7ae7ef41a7ab7c9b5f808d5f75.png)**

**$ heroku -ç‰ˆæœ¬**

**ä¸€æ—¦å®‰è£…äº† CLIï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`$ heroku --version`å‘½ä»¤æ¥æ£€æŸ¥ Heroku CLI ç‰ˆæœ¬ã€‚æ‚¨è¿˜éœ€è¦å®‰è£… [**Git**](https://git-scm.com/) ï¼Œå› ä¸º Heroku CLI ä½¿ç”¨ Git å°†åº”ç”¨ç¨‹åºä»£ç æ¨é€åˆ° Heroku æœåŠ¡å™¨ã€‚å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºç›®å½•ä¸æ˜¯ Git å­˜å‚¨åº“ï¼Œè¿è¡Œ`$ git init`å‘½ä»¤å°†æ‚¨çš„é¡¹ç›®è½¬æ¢æˆ Git å­˜å‚¨åº“ã€‚**

**é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä»ç»ˆç«¯ç™»å½• Herokuã€‚å› ä¸ºæˆ‘ä»¬æ­£åœ¨åˆ›å»ºå’Œæ¨é€ä¸€ä¸ª Heroku åº”ç”¨ç¨‹åºï¼ŒHeroku éœ€è¦çŸ¥é“æˆ‘ä»¬æ˜¯è°ã€‚æ‰€ä»¥ä½¿ç”¨`$ heroku login`å‘½ä»¤å¹¶æä¾›æ‚¨çš„å‡­è¯ã€‚**

**![](img/a8a0d6f4f2ffe1acc72fddaefc1af5f4.png)**

**$ heroku ç™»å½•**

**è¯¥å‘½ä»¤å°†æ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨çª—å£ï¼Œæ‚¨éœ€è¦åœ¨å…¶ä¸­æä¾›æ‚¨çš„ Heroku å¸æˆ·å‡­è¯ã€‚ä¸€æ—¦æ‚¨ç™»å½•ï¼Œç»ˆç«¯å°†é€€å‡ºå¹¶æ‰“å°æ‚¨å¸æˆ·çš„ç”µå­é‚®ä»¶åœ°å€ã€‚**

**è¦åˆ›å»ºä¸€ä¸ª Heroku åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦ä»é¡¹ç›®ç›®å½•è¿è¡Œ`$ heroku create`å‘½ä»¤ã€‚ä½†æ˜¯è¿™ä¸ªå‘½ä»¤åˆ›å»ºäº†ä¸€ä¸ªåä¸º Heroku çš„é¡¹ç›®ï¼Œè¿™ä¸ªåå­—å¹¶ä¸ç†æƒ³ã€‚è¦æä¾›è‡ªå®šä¹‰åº”ç”¨ç¨‹åºåç§°ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ã€‚**

**![](img/830764dc63faea4c6bd6ad26c1132a5c.png)**

**$ heroku åº”ç”¨ç¨‹åº:åˆ›å»º**

**`$ heroku apps:create --region eu thatisuday-image-resize`å‘½ä»¤åˆ›å»ºä¸€ä¸ªåä¸º`thatisuday-image-resize`çš„ Heroku åº”ç”¨ç¨‹åºã€‚å®ƒè¿˜ç”Ÿæˆä¸€ä¸ª Git **remote** ( *å®ƒå°†è¢«æ¨é€åˆ°é‚£é‡Œ*)å’Œä¸€ä¸ªå­åŸŸã€‚**

> ***ğŸ’¡*`--region`æ ‡å¿—è®¾ç½®åº”ç”¨éƒ¨ç½²çš„åŒºåŸŸã€‚ä½ åº”è¯¥é€‰æ‹©ä¸€ä¸ªç¦»ä½ è¿‘çš„åœ°åŒºã€‚è¦æŸ¥æ‰¾ Heroku çš„åŒºåŸŸï¼Œä½¿ç”¨`$ heroku regions`å‘½ä»¤ã€‚**

**![](img/f2279d3f02d2101c04c98f36905f9cbb.png)**

**(Heroku ä»ªè¡¨æ¿)**

**ç°åœ¨ï¼Œå¦‚æœæ‚¨è®¿é—® Heroku ä»ªè¡¨æ¿ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºã€‚ç„¶è€Œï¼Œå¦‚æœä½ è®¿é—®`[https://thatisuday-image-resize.herokuapp.com](https://thatisuday-image-resize.herokuapp.com)`ç½‘å€ï¼Œä½ å°†çœ‹ä¸åˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰å°†åº”ç”¨ç¨‹åºä»£ç æ¨é€åˆ°`[https://git.heroku.com/thatisuday-image-resize.git](https://git.heroku.com/thatisuday-image-resize.git)`åº“ã€‚**

**![](img/28a668b51050a055885815118054796f.png)**

**$ git remote -v**

**å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª Heroku åº”ç”¨ç¨‹åºæ—¶ï¼ŒHeroku å°†`heroku` remote æ·»åŠ åˆ°æŒ‡å‘`https://git.heroku.com/<app-name>.git`çš„ Git å­˜å‚¨åº“ä¸­ã€‚å› ä¸ºæˆ‘åœ¨åš GitHub åº“ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿæœ‰ä¸€ä¸ª`origin`é¥æ§å™¨ã€‚**

**å¦‚æœæ‚¨æ²¡æœ‰çœ‹åˆ°`heroku` remoteï¼Œæˆ–è€…æ‚¨æƒ³è¦å°† Heroku åº”ç”¨ç¨‹åºè¿œç¨‹æ·»åŠ åˆ°æ‚¨çš„æœ¬åœ°å­˜å‚¨åº“ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`$ git remote [add](https://git-scm.com/docs/git-remote#Documentation/git-remote.txt-emaddem) heroku <app-remote-url>`å‘½ä»¤ã€‚ä½†æ˜¯æˆ‘æ¨èä½¿ç”¨`$ heroku git:remote -a <app-name>`å‘½ä»¤ï¼Œå®ƒä»åº”ç”¨ç¨‹åºåç§°è§£æè¿œç¨‹ URLã€‚ä½ å¯ä»¥ä» Heroku ä»ªè¡¨ç›˜ä¸Šå¾—åˆ°`app-name`ã€‚**

**å½“æˆ‘ä»¬éƒ¨ç½²åº”ç”¨ç¨‹åºæ—¶ï¼ŒHeroku éœ€è¦çŸ¥é“åœ¨ **web dyno** ä¸­è¿è¡Œå“ªä¸ªå‘½ä»¤ã€‚æˆ‘ä»¬åœ¨ **Procfile** ä¸­æŒ‡å®š web dyno ( *å’Œå…¶ä»– dyno*)çš„é…ç½®ã€‚`Procfile`æ˜¯åŒ…å«è¿›ç¨‹ä¿¡æ¯çš„æ–‡æœ¬æ–‡ä»¶( *dynos* )ã€‚å®ƒçš„ç®€å•å½¢å¼å¦‚ä¸‹æ‰€ç¤ºã€‚**

```
<process-name>: <command>
```

**å¯¹äºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨`web`è¿›ç¨‹ä¸­è¿è¡Œ`node server.js`å‘½ä»¤( *dyno* )æ¥å¯åŠ¨ä¸€ä¸ª web æœåŠ¡å™¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„`Procfile`å¦‚ä¸‹æ‰€ç¤ºã€‚å¦‚æœæ‚¨éœ€è¦å…³äº`Procfile`çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·éµå¾ª [**æœ¬**](https://devcenter.heroku.com/articles/procfile) æ–‡æ¡£ã€‚**

```
web: node server.js
```

**å½“æˆ‘ä»¬éƒ¨ç½²åº”ç”¨ç¨‹åºæ—¶ï¼ŒåŸºäºåº”ç”¨ç¨‹åºå­˜å‚¨åº“ä¸­çš„`package.json`æ–‡ä»¶å’Œ Heroku ä½¿ç”¨çš„å…¶ä»– buildpack æ£€æµ‹æ–¹æ³•ï¼ŒHeroku ä½¿ç”¨å¯ç”¨çš„ Node.js çš„**æœ€æ–°**[**LTS**](https://nodejs.org/en/)**å®‰è£…åœ¨ web dyno ä¸­è¿è¡Œ`node server.js`å‘½ä»¤ã€‚****

**ä½†æ˜¯ï¼Œæˆ‘å»ºè®®è®¾ç½®ä¸€ä¸ªè‡ªå®šä¹‰ç‰ˆæœ¬çš„ Node.js æ¥è¿è¡Œåº”ç”¨ç¨‹åºã€‚è¿™æ ·ï¼Œå¦‚æœæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸ Node.js çš„æŸä¸ªç‰ˆæœ¬æœ‰ä¸å…¼å®¹é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœ¬åœ°æœºå™¨ä¸Šæ£€æµ‹åˆ°å®ƒã€‚è¦æä¾› Node.js ç‰ˆæœ¬ï¼Œè¯·ä½¿ç”¨`package.json`æ–‡ä»¶çš„`engines`å±æ€§ã€‚**

```
{
  "name": "myapp",
  "engines": {
    "node": "**12.16.2**"
  }
}
```

**æˆ‘åœ¨è¿™ä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ Node.js ç‰ˆæœ¬`12.16.2`,å› ä¸ºå®ƒæ˜¯æˆ‘å®‰è£…åœ¨æœ¬åœ°æœºå™¨ä¸Šçš„ç‰ˆæœ¬ã€‚æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨`12.x`å€¼ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ Heroku å°†é€‰æ‹© Node.js çš„æœ€æ–°æ¬¡è¦ç‰ˆæœ¬ã€‚æ‚¨è¿˜å¯ä»¥æŒ‡å®š **NPM** æˆ–**çº±**ç‰ˆæœ¬ï¼Œå¦‚è¿™é‡Œçš„[](https://devcenter.heroku.com/articles/nodejs-support#specifying-a-node-js-version)**æ‰€è¿°ã€‚****

****åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œæˆ‘ä»¬æƒ³çŸ¥é“æˆ‘ä»¬çš„æœ¬åœ° Heroku è®¾ç½®æ˜¯å¦æ­£å¸¸ã€‚ä½¿ç”¨`$ heroku local <process>`å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥ä»`Procfile`æœ¬åœ°å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ã€‚è®©æˆ‘ä»¬é€šè¿‡è¿è¡Œ`$ heroku local web`å‘½ä»¤æ¥å¯åŠ¨`web`è¿›ç¨‹ã€‚****

****![](img/921a86a6ed0161c420d56b9e97b40dbe.png)****

****$ heroku æœ¬åœ°ç½‘ç«™****

****è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬æ²¡æœ‰è¿è¡Œ`$ node server.js`å‘½ä»¤æ¥å¯åŠ¨ web æœåŠ¡å™¨ï¼Œè€Œæ˜¯è®© Heroku ä»`Procfile`è¿è¡Œ`web`è¿›ç¨‹çš„å‘½ä»¤ã€‚ç°åœ¨ï¼Œå¦‚æœæ‚¨åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€`[http://localhost:5000](http://localhost:5000)` URLï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°åº”ç”¨ç¨‹åºæ­£åœ¨é‚£é‡Œè¿è¡Œã€‚ç«¯å£`5000`ç”± Heroku é€‰æ‹©ï¼Œå®ƒå°†é€šè¿‡`PORT`ç¯å¢ƒå˜é‡æä¾›è¯¥ç«¯å£ï¼Œæˆ‘ä»¬åœ¨`server.js`ä¸­ä½¿ç”¨çš„ç¯å¢ƒå˜é‡æ˜¯å¯ç”¨çš„ã€‚****

****ç°åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè¿è¡Œè‰¯å¥½ï¼ŒHeroku çš„è®¾ç½®ä¹Ÿå®Œæˆäº†ï¼Œæ˜¯æ—¶å€™å‘å¸ƒåº”ç”¨ç¨‹åºäº†ã€‚å¦‚ä½ æ‰€çŸ¥ï¼Œ**æˆ‘ä»¬å·²ç»å‘å¸ƒäº†ç”³è¯·**ã€‚æˆ‘ä»¬éœ€è¦åšçš„æ˜¯å°†åº”ç”¨ç¨‹åºä»£ç æ¨é€åˆ°åº”ç”¨ç¨‹åºçš„ Git å­˜å‚¨åº“ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæäº¤ï¼Œå¹¶å°†è¿™äº›æäº¤æ¨é€åˆ°`heroku`é¥æ§å™¨ã€‚****

> *****ğŸ’¡*ç¡®ä¿æ‚¨å·²ç»å°†`node_modules`æ·»åŠ åˆ°`.gitignore`ä¸­ã€‚æ‚¨åº”è¯¥é¿å…å°†åº”ç”¨ç¨‹åºä¸éœ€è¦çš„ä»»ä½•æ–‡ä»¶æ¨é€åˆ°åº”ç”¨ç¨‹åºå­˜å‚¨åº“ã€‚heroku/nodejs buildpack é€šè¿‡è‡ªåŠ¨è¿è¡Œ`$ npm install -y`å‘½ä»¤å®‰è£… NPM æ¨¡å—ã€‚****

****(æ¥æº:[**gist.github.com**](https://gist.github.com/thatisuday/5a78a93904d5e4f592ba247b612583d8))****

****æˆ‘ä»¬åº”è¯¥ä½¿ç”¨`heroku`é¥æ§å™¨çš„`main`æˆ–`master`åˆ†æ”¯æ¥æ¨é€åº”ç”¨ç¨‹åºä»£ç (*æäº¤*)ã€‚å½“ Heroku æ¥æ”¶åˆ°è¿™äº›æäº¤(è¿è¡Œ `*$ git push heroku main*` *å‘½ä»¤*åçš„*)æ—¶ï¼Œå®ƒè¯†åˆ«åº”ç”¨ç±»å‹( *buildpack* )ã€‚å¯ä»¥çœ‹åˆ°ä¸Šé¢æ—¥å¿—ä¸­çš„`Node.js app detected`è¡Œã€‚*****

****ç„¶å Heroku å®‰è£… Node.js å’Œ NPM ( *æˆ– Yarn*)(`*package.json*`ä¸­å®šä¹‰çš„ç‰ˆæœ¬çš„*)å¹¶å®‰è£…`package.json`ä¸­æåˆ°çš„æ‰€æœ‰ä¾èµ–é¡¹ã€‚ä¸€æ—¦å®‰è£…äº†è¿™äº›ä¾èµ–é¡¹ï¼Œå®ƒä¼šå°†æ‰€æœ‰å†…å®¹å‹ç¼©åˆ°ä¸€ä¸ª [**slug**](https://devcenter.heroku.com/articles/slug-compiler) ä¸­ï¼Œå¹¶å°†å…¶éƒ¨ç½²åˆ° web dyno ä¸­ã€‚*****

> *****ğŸ’¡æœ‰æ—¶ï¼ŒHeroku [æ£€æµ‹ä¸åˆ°](https://devcenter.heroku.com/articles/buildpacks#detection-failure)build packã€‚åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç»ˆç«¯ä¸­å¾—åˆ°`failed to detect set buildpack heroku/nodejs`é”™è¯¯ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨`$ heroku buildpacks:set heroku/nodejs`å‘½ä»¤æ‰‹åŠ¨è®¾ç½® buildpackï¼Œå¦‚è¿™é‡Œçš„[](https://devcenter.heroku.com/articles/buildpacks#setting-a-buildpack-on-an-application)**æ‰€è¿°ã€‚*******

******![](img/2495ddc287b327bb58e202fbb269563d.png)******

******([https://thatisuday-image-resize.herokuapp.com](https://thatisuday-image-resize.herokuapp.com))******

******ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è®¿é—®`[https://thatisuday-image-resize.herokuapp.com](https://thatisuday-image-resize.herokuapp.com)` URLã€‚æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºç°åœ¨è¿è¡Œåœ¨ Heroku cloud ä¸Šã€‚è¦æ£€æŸ¥åº”ç”¨ç¨‹åºå†å²è®°å½•ã€æ´»åŠ¨æˆ–åˆ é™¤åº”ç”¨ç¨‹åºï¼Œè¯·ä½¿ç”¨ Heroku ä»ªè¡¨æ¿ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨`$ heroku ps`å‘½ä»¤æ£€æŸ¥ Heroku åº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚******

******![](img/197fac7ce21d6c03672531c022af79b1.png)******

******$ heroku ps******

******è¿™ä¸ªå‘½ä»¤æ˜¾ç¤ºå‰©ä½™çš„ç©ºé—²é…é¢ä»¥åŠ Heroku åº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚å¦‚æ‚¨æ‰€è§ï¼Œ`web` dyno ( *è¿›ç¨‹*)å·²ç»å¯åŠ¨å¹¶æ­£åœ¨è¿è¡Œã€‚å¦‚æœä¸€ä¸ªå…è´¹çš„ dyno åœ¨ 30 åˆ†é’Ÿå†…æ²¡æœ‰æ”¶åˆ°æµé‡ï¼Œå®ƒå°†è¿›å…¥ç¡çœ çŠ¶æ€ä»¥ä¿å­˜èµ„æºï¼Œä½†æ˜¯ä¸€æ—¦æ”¶åˆ°è¯·æ±‚ï¼Œå®ƒå°†ç«‹å³é†’æ¥ã€‚******

******å¯¹äºå…è´¹å±‚å¸æˆ·ï¼Œæ‚¨ä¸èƒ½æ‰©å±•åº”ç”¨ç¨‹åºã€‚è¿™æ„å‘³ç€æ‚¨çš„åº”ç”¨ç¨‹åºåªèƒ½åœ¨ 1 dyno ä¸Šå·¥ä½œ(*è¿™è¿˜ä¸é”™*)ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥ç¼©å°åº”ç”¨ç¨‹åºçš„è§„æ¨¡ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`$ heroku ps:scale <process>=<size>`å‘½ä»¤å°†åŠ¨æ€ç¼–å·è®¾ç½®ä¸º`0`ã€‚******

******![](img/452038916c46cd56d2a09fef5cd535f5.png)******

******$ heroku ps:scale web=0******

******ç°åœ¨ï¼Œå¦‚æœæ‚¨å†æ¬¡è®¿é—®`[https://thatisuday-image-resize.herokuapp.com](https://thatisuday-image-resize.herokuapp.com)` URLï¼Œå®ƒå°†æ˜¾ç¤ºä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼Œå› ä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸å†è¿è¡Œã€‚ä¸ºäº†å†æ¬¡æ”¾å¤§ dynosï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸ dyno size `1`ç›¸åŒçš„å‘½ä»¤ã€‚******

******![](img/9a855e2aa33a739e33ca964bec8c79b3.png)******

## ******æ›´æ–°åº”ç”¨ç¨‹åº(é‡æ–°éƒ¨ç½²)******

******å½“æˆ‘ä»¬æƒ³è¦ä¿®æ”¹æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¹¶å†æ¬¡éƒ¨ç½²åº”ç”¨ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ›å»ºä¸€ä¸ª Git commit å¹¶å°†å…¶æ¨é€åˆ°`heroku` remote çš„`main`åˆ†æ”¯ã€‚è¦äº†è§£æ›´å¤šå…³äºä½¿ç”¨ Git éƒ¨ç½²çš„ä¿¡æ¯ï¼Œè¯·é˜…è¯»æœ¬ æ–‡æ¡£ã€‚******

******![](img/424a2fa7ddd0428d06b59ff94b297782.png)******

******$ git push heroku main******

******![](img/054000a4f1c4d31969462290e3c61650.png)******

******([https://thatisuday-image-resize.herokuapp.com](https://thatisuday-image-resize.herokuapp.com))******

******![](img/e3da3bf1cee07cd997d46904bbbf70b4.png)******

******([**thatisuday.com**](http://thatisuday.com)/[/**GitHub**](https://github.com/thatisuday)/[**Twitter**](https://twitter.com/thatisuday)/**stack overflow****/[**insta gram**](https://www.instagram.com/thatisuday/))********