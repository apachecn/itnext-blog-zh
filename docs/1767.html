<html>
<head>
<title>How to run IPv6-enabled Docker containers on AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•åœ¨AWSä¸Šè¿è¡Œæ”¯æŒIPv6çš„Dockerå®¹å™¨</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/how-to-run-ipv6-enabled-docker-containers-on-aws-87e090ab0397?source=collection_archive---------4-----------------------#2019-01-22">https://itnext.io/how-to-run-ipv6-enabled-docker-containers-on-aws-87e090ab0397?source=collection_archive---------4-----------------------#2019-01-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="dfe5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ‚¨æƒ³å¿˜è®°NATå¹¶è¿è¡Œå®¹å™¨è€Œä¸å¿…è½¬æ¢IPåœ°å€å—ï¼Ÿç„¶åä½ éœ€è¦å…¬å…±IPåœ°å€ï¼Œå¾ˆå¤šã€‚ä¸å¹¸çš„æ˜¯ï¼Œæ¯ä¸ªIPv4åœ°å€<a class="ae kl" href="http://www.circleid.com/posts/20181024_the_2018_ipv4_market_third_quarter_report/" rel="noopener ugc nofollow" target="_blank">çš„ä»·æ ¼è¶…è¿‡äº†20ç¾å…ƒ</a>ï¼Œæ‰€ä»¥ä½ ä¸ä¼šå¾—åˆ°ä½ çš„æ¯ä¸ªé›†è£…ç®±ä¸€ä¸ªã€‚å¦ä¸€æ–¹é¢ï¼ŒIPv6åœ°å€å¹¶ä¸ç¼ºä¹ï¼Œæ‰€ä»¥ç†è®ºä¸Šï¼Œæ‚¨å¯ä»¥ä¸ºä»»æ„å¤šä¸ªå®¹å™¨åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„IPv6åœ°å€ã€‚</p><p id="4791" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ—©åœ¨1981å¹´<a class="ae kl" href="https://tools.ietf.org/html/rfc791" rel="noopener ugc nofollow" target="_blank"/>å°±å®šä¹‰äº†æœ‰åŠ©äºå°†åšå®¢æ–‡ç« å‘é€åˆ°ä½ çš„è®¾å¤‡çš„äº’è”ç½‘åè®®(<strong class="jp ir"> IP </strong>)æ—¶ï¼Œè¯†åˆ«æºå’Œç›®çš„åœ°çš„äº’è”ç½‘åœ°å€è¢«æŒ‡å®šä¸ºå›ºå®šé•¿åº¦çš„å››ä¸ªå…«ä½å­—èŠ‚(<strong class="jp ir"> 32ä½</strong>)ã€‚è¿™å®é™…ä¸Šæ˜¯åè®®çš„ç¬¬å››ä¸ªç‰ˆæœ¬ï¼Œå› æ­¤æˆ‘ä»¬å°†è¿™äº›åœ°å€ç§°ä¸ºIPç‰ˆæœ¬4 ( <strong class="jp ir"> IPv4 </strong>)åœ°å€ã€‚</p><p id="2d94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¤§çº¦10å¹´åçš„1992å¹´<a class="ae kl" href="https://tools.ietf.org/html/rfc1338" rel="noopener ugc nofollow" target="_blank"/>ï¼Œå¾ˆæ˜æ˜¾æˆ‘ä»¬æœ€ç»ˆä¼šç”¨å®Œ32ä½IPv4åœ°å€ï¼Œæ‰€ä»¥åœ¨1994å¹´3æœˆ<a class="ae kl" href="https://tools.ietf.org/html/rfc1597" rel="noopener ugc nofollow" target="_blank"/>ä¸­ï¼Œä¸ºäº†ä¿ç•™IPåœ°å€ç©ºé—´ï¼Œå®šä¹‰äº†å¯é‡å¤ä½¿ç”¨çš„<strong class="jp ir">ç§æœ‰IP </strong>åœ°å€ã€‚æ‚¨å¯ä»¥ä½¿ç”¨è¿™äº›æ¥è¯†åˆ«ä¼ä¸šä¸“ç”¨çš„ä¸»æœºã€‚å¦‚æœè¿™äº›ä¸»æœºä¸­çš„ä»»ä½•ä¸€å°éœ€è¦è¿æ¥åˆ°å¤–éƒ¨ä¸»æœºï¼Œå…¶åœ°å€éœ€è¦è½¬æ¢ä¸º<strong class="jp ir">a-å…¬å…±</strong> â€” <strong class="jp ir"> IP </strong>åœ°å€ï¼Œè¯¥åœ°å€æ˜¯å…¨å±€å”¯ä¸€çš„ã€‚è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºç½‘ç»œåœ°å€è½¬æ¢(<strong class="jp ir"> NAT </strong>)ï¼Œå‡ ä¸ªæœˆå<a class="ae kl" href="https://tools.ietf.org/html/rfc1631" rel="noopener ugc nofollow" target="_blank">è¢«å®šä¹‰ä¸º</a>ã€‚</p><p id="c905" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¤§çº¦ä¸€å¹´å(1995å¹´)å‡ºç°äº†æ–°ç‰ˆæœ¬çš„äº’è”ç½‘åè®®ï¼Œæä¾›äº†æ‰©å±•çš„å¯»å€èƒ½åŠ›ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸º<strong class="jp ir"> IPv6 </strong>ï¼Œå®ƒå°†IPåœ°å€çš„å¤§å°ä»32ä½å¢åŠ åˆ°<strong class="jp ir"> 128ä½</strong>ã€‚</p><blockquote class="km kn ko"><p id="350d" class="jn jo kp jp b jq jr js jt ju jv jw jx kq jz ka kb kr kd ke kf ks kh ki kj kk ij bi translated">é—®é¢˜æ˜¯ä»€ä¹ˆï¼ŸIPv6ä¸IPv4ä¸å‘åå…¼å®¹ï¼Œå› æ­¤è¿‡æ¸¡éå¸¸éå¸¸ç¼“æ…¢â€¦â€¦20å¤šå¹´æ¥ï¼Œå½“å‰çš„<a class="ae kl" href="https://www.google.com/intl/en/ipv6/statistics.html" rel="noopener ugc nofollow" target="_blank">é‡‡ç”¨äº†å¤§çº¦22% </a>ã€‚</p></blockquote><p id="f267" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ— è®ºå¦‚ä½•ï¼Œè¿™ç¯‡æ–‡ç« çš„ç›®çš„æ˜¯æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨IPv6åœ¨äº‘æä¾›å•†(AWS)ä¸Šè¿è¡Œå®¹å™¨ã€‚è¿™æ˜¯æˆ‘ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æœªè§£å†³çš„é—®é¢˜:<a class="ae kl" href="https://medium.com/@nleiva/kubernetes-multi-cluster-networking-made-simple-c8f26827813" rel="noopener"> Kubernetesä½¿å¤šé›†ç¾¤ç½‘ç»œå˜å¾—ç®€å•</a>ã€‚ç›®æ ‡æ‹“æ‰‘å¦‚ä¸‹ã€‚</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi kt"><img src="../Images/0762f0a757ddf04fd5da08628c1dd321.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E3u4QZGhjH8VH_X3fzMWfQ.png"/></div></div></figure><p id="d34c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è™½ç„¶æˆ‘ä»¬ç›®å‰ä¸èƒ½åˆ†è§£åˆ†é…ç»™<code class="fe lf lg lh li b">VPC</code> ( <code class="fe lf lg lh li b">/56</code>)çš„IPv6åœ°å€å—ï¼Œä»¥ä¾¿åœ¨AWSä¸­å°†æ›´å°çš„å­ç½‘(<code class="fe lf lg lh li b">/64</code>)åˆ†é…ç»™å®ä¾‹ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¼¹æ€§ç½‘ç»œæ¥å£(<a class="ae kl" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html" rel="noopener ugc nofollow" target="_blank"/>)å°†è¿ç»­çš„IPv6åœ°å€å—å…³è”åˆ°ä¸€ä¸ªå®ä¾‹ã€‚è¿™å°†ç”Ÿæˆä¸€ä¸ªå¤§äº<code class="fe lf lg lh li b">/64</code>(åœ¨æœ¬ä¾‹ä¸­ä¸º<code class="fe lf lg lh li b">/126</code>)çš„IPv6å‰ç¼€é•¿åº¦ï¼Œè¿™åœ¨å±€åŸŸç½‘ä¸­ä¸æ˜¯ä¸€ä¸ªæœ€ä½³å®è·µï¼Œæ‰€ä»¥å¯¹æ­¤è¦æœ‰æ‰€ä¿ç•™ã€‚</p><p id="b794" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç®€è€Œè¨€ä¹‹ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å°†è¦åšçš„:</p><ol class=""><li id="650d" class="lj lk iq jp b jq jr ju jv jy ll kc lm kg ln kk lo lp lq lr bi translated">åˆ›å»ºé™„åŠ æœ‰<a class="ae kl" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html" rel="noopener ugc nofollow" target="_blank"> ENI </a>çš„<a class="ae kl" href="https://aws.amazon.com/ec2/" rel="noopener ugc nofollow" target="_blank"> EC2 </a>å®ä¾‹ã€‚</li><li id="eaaa" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">åœ¨å®ä¾‹ä¸Šé‡æ–°é…ç½®IPv6å¯»å€å¹¶å®‰è£…Dockerã€‚</li><li id="cce9" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">ä»…ä½¿ç”¨IPv6è¿è¡Œå‡ ä¸ªå®¹å™¨ã€‚</li></ol><h1 id="c20c" class="lx ly iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">åˆ›å»ºé™„åŠ äº†ENIçš„EC2ä¾‹ç¨‹</h1><p id="66a0" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">æˆ‘ä»¬å°†ä½¿ç”¨AWS<a class="ae kl" href="https://aws.amazon.com/cli/" rel="noopener ugc nofollow" target="_blank">CLI</a><a class="ae kl" href="https://docs.aws.amazon.com/cli/latest/reference/ec2/create-network-interface.html" rel="noopener ugc nofollow" target="_blank">create-network-interface</a>ä¸ºæˆ‘ä»¬çš„æ¯ä¸ªå®ä¾‹åˆ›å»ºä¸€ä¸ª<a class="ae kl" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html" rel="noopener ugc nofollow" target="_blank"> ENI </a>ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªä¸»IPv6åœ°å€å’Œä¸€ä¸ªè¿ç»­çš„IPv6åœ°å€å—ã€‚è¿™äº›åœ°å€å°†æ¥è‡ªä¸€ä¸ªå·²çŸ¥çš„<code class="fe lf lg lh li b">Subnet</code>ã€‚æˆ‘ä»¬è¿˜å°†å¯¹æˆ‘ä»¬çš„<a class="ae kl" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html" rel="noopener ugc nofollow" target="_blank"> ENI </a>åº”ç”¨ä¸€ä¸ª<code class="fe lf lg lh li b">Security Group</code>ã€‚</p><h2 id="3876" class="na ly iq bd lz nb nc dn md nd ne dp mh jy nf ng ml kc nh ni mp kg nj nk mt nl bi translated">å­ç½‘ã€å®‰å…¨ç»„å’ŒENI</h2><p id="9b39" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">å¦‚æœä½ è¿˜æ²¡æœ‰ä¸€ä¸ªæ”¯æŒIPv6çš„<code class="fe lf lg lh li b">VPC</code>ï¼Œè¯·çœ‹çœ‹<a class="ae kl" href="https://docs.aws.amazon.com/vpc/latest/userguide/get-started-ipv6.html" rel="noopener ugc nofollow" target="_blank">äºšé©¬é€ŠVPC IPv6å…¥é—¨</a>ï¼Œè¿™æ ·ä½ å°±å¯ä»¥åœ¨å˜é‡<code class="fe lf lg lh li b">subnetId</code>å’Œ<code class="fe lf lg lh li b">sgId</code>ä¸­å­˜å‚¨<code class="fe lf lg lh li b">Subnet</code>å’Œ<code class="fe lf lg lh li b">Security Group</code>çš„IDã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="4018" class="na ly iq li b gy nq nr l ns nt">subnetId=subnet-09a931730fa9exxxx<br/>sgId=sg-0eaf439572982yyyy</span></pre><p id="eff5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¯¹äº<code class="fe lf lg lh li b">instance-1</code>ï¼Œæˆ‘ä»¬å°†ä¿ç•™åœ°å€<code class="fe lf lg lh li b">::1:1</code>ã€<code class="fe lf lg lh li b">::8</code>ã€<code class="fe lf lg lh li b">::9</code>ã€<code class="fe lf lg lh li b">::a</code>å’Œ<code class="fe lf lg lh li b">::b</code>ã€‚ä¸ºäº†ä¾¿äºé˜…è¯»ï¼Œæˆ‘å»æ‰äº†å­ç½‘å‰ç¼€ã€‚ç¬¬ä¸€ä¸ªåœ°å€å°†ç”¨äºå®ä¾‹ï¼Œå…¶ä»–å››ä¸ªåœ°å€å°†æ„æˆå®¹å™¨å°†è¿æ¥åˆ°çš„linuxæ¡¥æ‰€éœ€çš„<code class="fe lf lg lh li b">/126</code>ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="5cbb" class="na ly iq li b gy nq nr l ns nt">2600:1f18:47b:ca03::1:1<br/>2600:1f18:47b:ca03::8<br/>2600:1f18:47b:ca03::9<br/>2600:1f18:47b:ca03::a<br/>2600:1f18:47b:ca03::b</span></pre><p id="2716" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¯¹äºæˆ‘ä»¬çš„<code class="fe lf lg lh li b">instance-2</code>ï¼Œæˆ‘ä»¬å°†ä¿ç•™åœ°å€<code class="fe lf lg lh li b">::2:2</code>ã€<code class="fe lf lg lh li b">::c</code>ã€<code class="fe lf lg lh li b">::d</code>ã€<code class="fe lf lg lh li b">::e</code>å’Œ<code class="fe lf lg lh li b">::f</code>ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="4a55" class="na ly iq li b gy nq nr l ns nt">2600:1f18:47b:ca03::2:2<br/>2600:1f18:47b:ca03::c<br/>2600:1f18:47b:ca03::d<br/>2600:1f18:47b:ca03::e<br/>2600:1f18:47b:ca03::f</span></pre><p id="4407" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬æ‰§è¡Œ<a class="ae kl" href="https://docs.aws.amazon.com/cli/latest/reference/ec2/create-network-interface.html" rel="noopener ugc nofollow" target="_blank">create-network-interface</a>å‘½ä»¤ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å­˜å‚¨<a class="ae kl" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html" rel="noopener ugc nofollow" target="_blank"> ENI </a>çš„IDç”¨äºåé¢çš„æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬<code class="fe lf lg lh li b">query</code> <code class="fe lf lg lh li b">NetworkInterface.NetworkInterfaceId</code>å¹¶å°†è¿”å›å€¼å­˜å‚¨åœ¨<code class="fe lf lg lh li b">eni1</code>ä¸­ç”¨äº<code class="fe lf lg lh li b">instance-1</code>ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="3685" class="na ly iq li b gy nq nr l ns nt"><strong class="li ir">eni1</strong>=`aws ec2 create-network-interface \<br/>  --subnet-id <strong class="li ir">$subnetId</strong> \<br/>  --description "My IPv6 ENI 1" \<br/>  --groups <strong class="li ir">$sgId</strong> \<br/>  --ipv6-addresses \<br/>  Ipv6Address=2600:1f18:47b:ca03<strong class="li ir">::1:1</strong> \<br/>  Ipv6Address=2600:1f18:47b:ca03<strong class="li ir">::8</strong> \<br/>  Ipv6Address=2600:1f18:47b:ca03<strong class="li ir">::9</strong> \<br/>  Ipv6Address=2600:1f18:47b:ca03<strong class="li ir">::a</strong> \<br/>  Ipv6Address=2600:1f18:47b:ca03<strong class="li ir">::b</strong> \<br/>  --query <strong class="li ir">'NetworkInterface.NetworkInterfaceId'</strong> \<br/>  --output text`</span></pre><p id="4e46" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ‚¨å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼æ£€æŸ¥è¿”å›å€¼ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="3147" class="na ly iq li b gy nq nr l ns nt">$ echo $eni1<br/>eni-08ba7c2f50a22a160</span></pre><p id="153e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¯¹ç¬¬äºŒä¸ª<a class="ae kl" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html" rel="noopener ugc nofollow" target="_blank"> ENI </a>é‡å¤ä¸Šè¿°æ­¥éª¤ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="de55" class="na ly iq li b gy nq nr l ns nt"><strong class="li ir">eni2</strong>=`aws ec2 create-network-interface \<br/>  --subnet-id <strong class="li ir">$subnetId</strong> \<br/>  --description "My IPv6 ENI 2" \<br/>  --groups <strong class="li ir">$sgId</strong> \<br/>  --ipv6-addresses \<br/>  Ipv6Address=2600:1f18:47b:ca03<strong class="li ir">::2:2</strong> \<br/>  Ipv6Address=2600:1f18:47b:ca03<strong class="li ir">::c</strong> \<br/>  Ipv6Address=2600:1f18:47b:ca03<strong class="li ir">::d</strong> \<br/>  Ipv6Address=2600:1f18:47b:ca03<strong class="li ir">::e</strong> \<br/>  Ipv6Address=2600:1f18:47b:ca03<strong class="li ir">::f</strong> \<br/>  --query <strong class="li ir">'NetworkInterface.NetworkInterfaceId'</strong> \<br/>  --output text`</span></pre><h2 id="9b59" class="na ly iq bd lz nb nc dn md nd ne dp mh jy nf ng ml kc nh ni mp kg nj nk mt nl bi translated">å¯åŠ¨é™„åŠ äº†ENIçš„å®ä¾‹</h2><p id="f3bd" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">Amazon EC2ä½¿ç”¨å…¬é’¥åŠ å¯†æ¥åŠ å¯†å’Œè§£å¯†ç™»å½•ä¿¡æ¯[ <a class="ae kl" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-key-pairs.html" rel="noopener ugc nofollow" target="_blank"> Amazon EC2å¯†é’¥å¯¹</a> ]ï¼Œå› æ­¤æ‚¨éœ€è¦ä¸€ä¸ªå…¬é’¥å’Œä¸€ä¸ªç§é’¥æ¥è¿æ¥åˆ°å®ä¾‹ã€‚</p><p id="cb32" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ‚¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç°æœ‰çš„æ–‡ä»¶ï¼Œæˆ–è€…åˆ›å»ºä¸€ä¸ªï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå…¶ä¸­<code class="fe lf lg lh li b">~/.ssh/id_rsa.pub</code>æ˜¯æ‚¨çš„å…¬é’¥æ–‡ä»¶çš„ä½ç½®ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="2c9b" class="na ly iq li b gy nq nr l ns nt">aws ec2 import-key-pair \<br/>  --key-name <strong class="li ir">&lt;name&gt;</strong> \<br/>  --public-key-material <strong class="li ir">file://~/.ssh/id_rsa.pub</strong></span></pre><p id="2d1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬å°†å¯†é’¥å¯¹çš„åç§°å­˜å‚¨åœ¨ä¸€ä¸ªåä¸º<code class="fe lf lg lh li b">AWS_SSH_KEY</code>çš„å˜é‡ä¸­ã€‚æ‚¨å¯ä»¥æ‰‹åŠ¨åˆ†é…åç§°ï¼Œå°±åƒæ‚¨åˆšæ‰é€‰æ‹©å®ƒä¸€æ ·ï¼Œæˆ–è€…ä½¿ç”¨<code class="fe lf lg lh li b">describe-key-pairs</code>ä»AWSä¸­æ£€ç´¢å®ƒã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="f477" class="na ly iq li b gy nq nr l ns nt">AWS_SSH_KEY=$(aws ec2 describe-key-pairs --query KeyPairs[0].KeyName --output text)</span></pre><p id="d9fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç°åœ¨æ˜¯åˆ›å»ºå®ä¾‹çš„æ—¶å€™äº†ã€‚æˆ‘ä»¬å°†ä½¿ç”¨<a class="ae kl" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html" rel="noopener ugc nofollow" target="_blank"> AMI </a> ID <code class="fe lf lg lh li b">ami-0ac019f4fcb7cb7e6</code>ï¼Œä¹Ÿå°±æ˜¯<code class="fe lf lg lh li b">Ubuntu Server 18.04 LTS</code>ï¼Œå®ä¾‹ç±»å‹<code class="fe lf lg lh li b">r5d.large</code>ã€‚</p><p id="228d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ‚¨å¯ä»¥åˆ†é…ç»™ä¸€ä¸ªå®ä¾‹çš„IPåœ°å€æ•°é‡å—åˆ°å…¶ç±»å‹çš„é™åˆ¶ï¼Œå› æ­¤å¯¹äº<code class="fe lf lg lh li b">r5d.large</code>æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†é…å¤šè¾¾10ä¸ªIPv6åœ°å€ï¼Œè¿™å¯¹äºè¿™ä¸ªå°å‹çš„æ¦‚å¿µéªŒè¯æ¥è¯´å·²ç»è¶³å¤Ÿäº†ã€‚å‚è§<a class="ae kl" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html#AvailableIpPerENI" rel="noopener ugc nofollow" target="_blank">æ¯ä¸ªå®ä¾‹ç±»å‹çš„æ¯ä¸ªç½‘ç»œæ¥å£çš„IPåœ°å€</a>ä¸­å®ä¾‹ç±»å‹çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><p id="d503" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬è¿˜æƒ³é™„åŠ æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„<a class="ae kl" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html" rel="noopener ugc nofollow" target="_blank"> ENI </a>ï¼Œå®ƒçš„IDå­˜å‚¨åœ¨<code class="fe lf lg lh li b">eni1</code>ä¸­ã€‚æˆ‘ä»¬å°†ä»AWSæ”¶åˆ°çš„å®ä¾‹IDä¿å­˜åœ¨<code class="fe lf lg lh li b">vm1</code>ä¸­(æˆ‘ä»¬æ­£åœ¨æŸ¥è¯¢<code class="fe lf lg lh li b">Instances[0].InstanceId</code>)ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="1e3f" class="na ly iq li b gy nq nr l ns nt"><strong class="li ir">vm1</strong>=`aws ec2 run-instances \<br/>  --key-name <strong class="li ir">$AWS_SSH_KEY</strong> \<br/>  --image-id <strong class="li ir">ami-0ac019f4fcb7cb7e6</strong> \<br/>  --instance-type <strong class="li ir">r5d.large</strong> \<br/>  --network-interfaces <strong class="li ir">DeviceIndex=0,NetworkInterfaceId=$eni1</strong> \<br/>  --query <strong class="li ir">'Instances[0].InstanceId'</strong> \<br/>  --output text`</span></pre><p id="3687" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¯¹äº<code class="fe lf lg lh li b">instance-2</code>ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="f55d" class="na ly iq li b gy nq nr l ns nt"><strong class="li ir">vm2</strong>=`aws ec2 run-instances \<br/>  --key-name <strong class="li ir">$AWS_SSH_KEY</strong> \<br/>  --image-id <strong class="li ir">ami-0ac019f4fcb7cb7e6</strong> \<br/>  --instance-type <strong class="li ir">r5d.large</strong> \<br/>  --network-interfaces <strong class="li ir">DeviceIndex=0,NetworkInterfaceId=$eni2</strong> \<br/>  --query <strong class="li ir">'Instances[0].InstanceId'</strong> \<br/>  --output text`</span></pre><p id="3355" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è·å–<code class="fe lf lg lh li b">instance-1</code>çš„ç¬¬ä¸€ä¸ªå…¬æœ‰IPv6åœ°å€ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨<code class="fe lf lg lh li b">ip1</code>ä¸­ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="144e" class="na ly iq li b gy nq nr l ns nt"><strong class="li ir">ip1</strong>=`aws ec2 describe-instances \<br/>  --filter Name=<strong class="li ir">instance-id</strong>,Values=<strong class="li ir">$vm1</strong> \<br/>  --output text \<br/>  --query 'Reservations[].Instances[].NetworkInterfaces[].\<br/><strong class="li ir">Ipv6Addresses[0].Ipv6Address</strong>'`</span></pre><p id="a168" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨<code class="fe lf lg lh li b">ssh -i &lt;private key file&gt; ubuntu@${ip1}</code>è®¿é—®<code class="fe lf lg lh li b">instance-1</code>ã€‚ç±»ä¼¼åœ°ï¼Œå¯¹äº<code class="fe lf lg lh li b">instance-2</code>ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€ç´¢ç¬¬ä¸€ä¸ªå…¬å…±IPv6åœ°å€:</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="b316" class="na ly iq li b gy nq nr l ns nt"><strong class="li ir">ip2</strong>=`aws ec2 describe-instances \<br/>  --filter Name=<strong class="li ir">instance-id</strong>,Values=<strong class="li ir">$vm2</strong> \<br/>  --output text \<br/>  --query 'Reservations[].Instances[].NetworkInterfaces[].\<br/><strong class="li ir">Ipv6Addresses[0].Ipv6Address</strong>'`</span></pre><p id="1a46" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ‰€ä»¥ä½ å¯ä»¥ç”¨<code class="fe lf lg lh li b">ssh -i &lt;private key file&gt; ubuntu@${ip2}</code>æ¥è®¿é—®å®ƒã€‚</p><h2 id="6b0a" class="na ly iq bd lz nb nc dn md nd ne dp mh jy nf ng ml kc nh ni mp kg nj nk mt nl bi translated">ä½¿å®ä¾‹æ”¯æŒIPv6</h2><p id="297d" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">æˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬çš„å®ä¾‹ä¸­å®‰è£…è½¯ä»¶ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸å¯èƒ½é©¬ä¸Šå®ç°ï¼Œå› ä¸ºæˆ‘ä»¬çš„<code class="fe lf lg lh li b">sources.list</code>æ–‡ä»¶å¸¦æœ‰åˆ°<code class="fe lf lg lh li b"><a class="ae kl" href="http://us-east-1.ec2.archive.ubuntu.com/ubuntu/" rel="noopener ugc nofollow" target="_blank">us-east-1.ec2.archive.ubuntu.com</a></code>çš„é“¾æ¥ï¼Œè¿™äº›é“¾æ¥ä¸èƒ½è§£æä¸ºIPv6åœ°å€ã€‚ğŸ‘æˆ‘ä»¬éœ€è¦æ›¿æ¢è¿™äº›æ¥ä½¿ç”¨æ­£ç¡®æ”¯æŒIPv6çš„<code class="fe lf lg lh li b"><a class="ae kl" href="http://us-east-1.ec2.archive.ubuntu.com/ubuntu/" rel="noopener ugc nofollow" target="_blank">archive.ubuntu.com</a></code>ã€‚ä½ å¯ä»¥ç”¨<code class="fe lf lg lh li b">sed</code>åšåˆ°è¿™ä¸€ç‚¹ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="7ae5" class="na ly iq li b gy nq nr l ns nt">sudo sed -i 's/us-east-1\.ec2\.//g' /etc/apt/sources.list</span></pre><p id="3014" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç°åœ¨æ‚¨å¯ä»¥å°†<code class="fe lf lg lh li b">apt-get</code>ä¸é€‰é¡¹<code class="fe lf lg lh li b">Acquire::ForceIPv6=true</code>ä¸€èµ·ä½¿ç”¨ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="9bc2" class="na ly iq li b gy nq nr l ns nt">$ <strong class="li ir">sudo apt-get -o Acquire::ForceIPv6=true update</strong><br/>Get:1 <a class="ae kl" href="http://archive.ubuntu.com/ubuntu" rel="noopener ugc nofollow" target="_blank">http://archive.ubuntu.com/ubuntu</a> bionic InRelease [242 kB]<br/>Get:2 <a class="ae kl" href="http://security.ubuntu.com/ubuntu" rel="noopener ugc nofollow" target="_blank">http://security.ubuntu.com/ubuntu</a> bionic-security InRelease [83.2 kB]<br/>Get:3 <a class="ae kl" href="http://archive.ubuntu.com/ubuntu" rel="noopener ugc nofollow" target="_blank">http://archive.ubuntu.com/ubuntu</a> bionic-updates InRelease [88.7 kB]<br/>...<br/>Get:38 <a class="ae kl" href="http://archive.ubuntu.com/ubuntu" rel="noopener ugc nofollow" target="_blank">http://archive.ubuntu.com/ubuntu</a> bionic-backports/universe Sources [2068 B]<br/>Get:39 <a class="ae kl" href="http://archive.ubuntu.com/ubuntu" rel="noopener ugc nofollow" target="_blank">http://archive.ubuntu.com/ubuntu</a> bionic-backports/universe amd64 Packages [3468 B]<br/>Get:40 <a class="ae kl" href="http://archive.ubuntu.com/ubuntu" rel="noopener ugc nofollow" target="_blank">http://archive.ubuntu.com/ubuntu</a> bionic-backports/universe Translation-en [1604 B]<br/>Fetched 28.4 MB in 5s (5363 kB/s)<br/>Reading package lists... Done</span></pre><h1 id="cd4b" class="lx ly iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">åœ¨å®ä¾‹ä¸Šé‡æ–°é…ç½®IPv6å¯»å€å¹¶å®‰è£…Docker</h1><p id="61e4" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">ç°åœ¨ï¼Œæˆ‘ä»¬çš„å®ä¾‹æœ‰ä¸€ä¸ªå¸¦æœ‰å¤šä¸ªIPv6åœ°å€çš„æ¥å£ã€‚<code class="fe lf lg lh li b">instance-1</code>æ˜¾ç¤ºäº”ä¸ª<code class="fe lf lg lh li b">/128</code> IPv6åœ°å€ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="d596" class="na ly iq li b gy nq nr l ns nt">$ <strong class="li ir">ip add</strong><br/>...<br/>2: ens5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9001 qdisc mq state UP group default qlen 1000<br/>...<br/>    inet6 <strong class="li ir">2600:1f18:47b:ca03::1:1</strong>/128 scope global dynamic noprefixroute<br/>       valid_lft 385sec preferred_lft 85sec<br/>    inet6 <strong class="li ir">2600:1f18:47b:ca03::8</strong>/128 scope global dynamic noprefixroute<br/>       valid_lft 385sec preferred_lft 85sec<br/>    inet6 <strong class="li ir">2600:1f18:47b:ca03::9</strong>/128 scope global dynamic noprefixroute<br/>       valid_lft 385sec preferred_lft 85sec<br/>    inet6 <strong class="li ir">2600:1f18:47b:ca03::a</strong>/128 scope global dynamic noprefixroute<br/>       valid_lft 385sec preferred_lft 85sec<br/>    inet6 <strong class="li ir">2600:1f18:47b:ca03::b</strong>/128 scope global dynamic noprefixroute<br/>       valid_lft 385sec preferred_lft 85sec</span></pre><h2 id="0c82" class="na ly iq bd lz nb nc dn md nd ne dp mh jy nf ng ml kc nh ni mp kg nj nk mt nl bi translated">æ–°IPv6åœ°å€åˆ†é…</h2><p id="b528" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">æˆ‘ä»¬åªå¸Œæœ›ä¸»æ¥å£ä¸­æœ‰ä¸€ä¸ª(<code class="fe lf lg lh li b">/64</code>)å’Œlinuxæ¡¥(docker0)ä¸­çš„ä¸€ä¸ª<code class="fe lf lg lh li b">/126</code>æ¥åˆ†é…è¿™ä¸ªèŒƒå›´å†…çš„å®¹å™¨åœ°å€ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åœ¨<code class="fe lf lg lh li b">/etc/netplan/50-cloud-init.yaml</code>ç¼–è¾‘<a class="ae kl" href="https://netplan.io/" rel="noopener ugc nofollow" target="_blank">ç½‘ç»œè®¡åˆ’</a>çš„é…ç½®æ–‡ä»¶ã€‚å®ƒæœ€åˆçœ‹èµ·æ¥åƒè¿™æ ·:</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="ec7e" class="na ly iq li b gy nq nr l ns nt">network:<br/>  version: 2<br/>  ethernets:<br/>    ens5:<br/>      dhcp4: true<br/>      <strong class="li ir">dhcp6: true</strong><br/>      match:<br/>        macaddress: 12:fb:b4:8b:15:f8<br/>      set-name: ens5</span></pre><p id="836e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬åªä»ä¸­åˆ é™¤äº†<code class="fe lf lg lh li b">dhcp6</code>è¯­å¥ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="9514" class="na ly iq li b gy nq nr l ns nt">network:<br/>  version: 2<br/>  ethernets:<br/>    ens5:<br/>      dhcp4: true<br/>      match:<br/>        macaddress: 12:fb:b4:8b:15:f8<br/>      set-name: ens5</span></pre><p id="8f72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">é¡ºä¾¿æä¸€ä¸‹ï¼Œå¹¶ä¸”å®Œå…¨<strong class="jp ir">å¯é€‰</strong>ï¼Œå®ä¾‹çš„<code class="fe lf lg lh li b">MAC</code>åœ°å€å’Œä¸ä¹‹å…³è”çš„IPv6åœ°å€å¯ä»¥éšæ—¶ä»<a class="ae kl" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html#instancedata-data-retrieval" rel="noopener ugc nofollow" target="_blank">å®ä¾‹å…ƒæ•°æ®</a>ä¸­æ£€ç´¢ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="f1e7" class="na ly iq li b gy nq nr l ns nt">$ <strong class="li ir">curl http://169.254.169.254/latest/meta-data/network/interfaces/macs/</strong><br/>12:fb:b4:8b:15:f8</span></pre><p id="5a7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¹¶ä¸”:</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="d175" class="na ly iq li b gy nq nr l ns nt">$ <strong class="li ir">curl http://169.254.169.254/latest/meta-data/network/interfaces/macs/12:fb:b4:8b:15:f8/ipv6s/</strong><br/>2600:1f18:47b:ca03:0:0:0:8<br/>2600:1f18:47b:ca03:0:0:0:9<br/>2600:1f18:47b:ca03:0:0:0:a<br/>2600:1f18:47b:ca03:0:0:0:b<br/>2600:1f18:47b:ca03:0:0:1:1</span></pre><blockquote class="km kn ko"><p id="cc9e" class="jn jo kp jp b jq jr js jt ju jv jw jx kq jz ka kb kr kd ke kf ks kh ki kj kk ij bi translated">âš ï¸:æ˜¯çš„ï¼Œ<a class="ae kl" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html#instancedata-data-retrieval" rel="noopener ugc nofollow" target="_blank">å®ä¾‹å…ƒæ•°æ®</a>æ˜¯ä¸€é¡¹ä»…æ”¯æŒIPv4çš„æœåŠ¡ğŸ‘ã€‚å¥½æ¶ˆæ¯æ˜¯ä½ ä¸éœ€è¦ä¸€ä¸ªå…¬å…±IPv4åœ°å€æ¥è®¿é—®å®ƒã€‚</p></blockquote><p id="8efb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç»§ç»­å®ä¾‹çš„æ¥å£é…ç½®ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨<code class="fe lf lg lh li b">/etc/netplan/60-ipv6-static.yaml</code>ä¸ºIPv6é…ç½®åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="cf05" class="na ly iq li b gy nq nr l ns nt">network:<br/>  version: 2<br/>  ethernets:<br/>    ens5:<br/>      <strong class="li ir">dhcp6: no</strong><br/>      <strong class="li ir">accept-ra: no</strong><br/>      addresses:<br/>      - <strong class="li ir">2600:1f18:47b:ca03::1:1/64</strong><br/>      gateway6: <strong class="li ir">fe80::1066:30ff:feb8:c008</strong></span></pre><p id="3523" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬ç¦ç”¨äº†DHCPv6 ( <code class="fe lf lg lh li b">dhcp6: no</code>)å¹¶ä¸¢å¼ƒäº†IPv6è·¯ç”±å™¨å¹¿å‘Š(<code class="fe lf lg lh li b">accept-ra: no</code>)ã€‚ç½‘å…³ä¿¡æ¯(<code class="fe lf lg lh li b">fe80::1066:30ff:feb8:c008</code>)æ¥è‡ª<code class="fe lf lg lh li b">iproute2</code>å‘½ä»¤(ä¼¼ä¹åœ¨EC2ä¸­æ€»æ˜¯ç›¸åŒçš„)ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="734b" class="na ly iq li b gy nq nr l ns nt">$ <strong class="li ir">ip -6 route | grep default</strong><br/>default via <strong class="li ir">fe80::1066:30ff:feb8:c008</strong> dev ens5 proto ra metric 100 pref medium</span></pre><p id="433b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æœ€åï¼Œç”¨<code class="fe lf lg lh li b">netplan apply</code>åº”ç”¨æˆ‘ä»¬çš„é…ç½®æ›´æ”¹ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="a36e" class="na ly iq li b gy nq nr l ns nt">sudo netplan --debug apply</span></pre><p id="2ee1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬ç”¨ç›¸åº”çš„åœ°å€å¯¹<code class="fe lf lg lh li b">instance-2</code>é‡å¤ã€‚</p><h2 id="9147" class="na ly iq bd lz nb nc dn md nd ne dp mh jy nf ng ml kc nh ni mp kg nj nk mt nl bi translated">å®‰è£…Docker</h2><p id="4d0e" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">ä½ å¯ä»¥æŒ‰ç…§<a class="ae kl" href="https://docs.docker.com/install/linux/docker-ce/ubuntu/#install-docker-ce" rel="noopener ugc nofollow" target="_blank">å®˜æ–¹å®‰è£…æŒ‡å—</a>æˆ–è€…åªè¿è¡Œä»¥ä¸‹å‘½ä»¤ã€‚æ³¨æ„<code class="fe lf lg lh li b">apt-get</code>çš„é€‰é¡¹<code class="fe lf lg lh li b">Acquire::ForceIPv6=true</code>ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="e80f" class="na ly iq li b gy nq nr l ns nt">curl -fsSL <a class="ae kl" href="https://download.docker.com/linux/ubuntu/gpg" rel="noopener ugc nofollow" target="_blank">https://download.docker.com/linux/ubuntu/gpg</a> | sudo apt-key add -<br/>sudo add-apt-repository "deb [arch=amd64] <a class="ae kl" href="https://download.docker.com/linux/ubuntu" rel="noopener ugc nofollow" target="_blank">https://download.docker.com/linux/ubuntu</a> $(lsb_release -cs) stable"<br/>sudo apt-get <strong class="li ir">-o Acquire::ForceIPv6=true </strong>update<br/>sudo apt-get <strong class="li ir">-o Acquire::ForceIPv6=true </strong>install -y docker-ce<br/>sudo usermod -aG docker ${USER}</span></pre><p id="234b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ‚¨éœ€è¦æ³¨é”€å¹¶é‡æ–°ç™»å½•ï¼Œä»¥ä½¿ç”¨æˆ·æ›´æ”¹ç”Ÿæ•ˆã€‚</p><p id="fda9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬å°†åœ¨<code class="fe lf lg lh li b">/etc/docker/daemon.json</code>ç¼–è¾‘/åˆ›å»ºä¸€ä¸ªDockeré…ç½®æ–‡ä»¶ï¼Œå¼€å§‹ä¸ºæˆ‘ä»¬çš„å®¹å™¨åˆ†é…IPv6åœ°å€ã€‚å¯¹äº<code class="fe lf lg lh li b">instance-1</code>åº”è¯¥æ˜¯è¿™æ ·çš„ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="d2c4" class="na ly iq li b gy nq nr l ns nt">{<br/>  "ipv6": true,<br/>  "fixed-cidr-v6": "2600:1f18:47b:ca03::8/126"<br/>}</span></pre><p id="2e8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç„¶åé‡æ–°å¯åŠ¨å®ˆæŠ¤ç¨‹åºä»¥åº”ç”¨æ›´æ”¹ï¼›<code class="fe lf lg lh li b">sudo systemctl restart docker</code>ã€‚æˆ‘ä»¬ç°åœ¨å·²ç»æˆåŠŸåœ°åœ¨ä¸»æ¥å£å’ŒDockerç½‘æ¡¥ä¹‹é—´åˆ†å‰²äº†ENI IPv6åœ°å€åˆ†é…ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="f4ef" class="na ly iq li b gy nq nr l ns nt">$ <strong class="li ir">ip add</strong><br/>...<br/>2: <strong class="li ir">ens5</strong>: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9001 qdisc mq state UP group default qlen 1000<br/>...<br/>    inet6 <strong class="li ir">2600:1f18:47b:ca03::1:1/64</strong> scope global<br/>       valid_lft forever preferred_lft forever<br/>...<br/>3: <strong class="li ir">docker0</strong>: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default<br/>...<br/>    inet6 <strong class="li ir">2600:1f18:47b:ca03::9/126</strong> scope global tentative<br/>       valid_lft forever preferred_lft forever<br/>...</span></pre><p id="509c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¯¹<code class="fe lf lg lh li b">instance-2</code>åšåŒæ ·çš„æ“ä½œï¼Œç”¨<code class="fe lf lg lh li b">fixed-cidr-v6</code> = <code class="fe lf lg lh li b">::c/126</code>ã€‚</p><h1 id="160a" class="lx ly iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">ä»…ä½¿ç”¨IPv6è¿è¡Œå‡ ä¸ªå®¹å™¨</h1><p id="6713" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">æˆ‘ä»¬å‡†å¤‡è¿è¡Œå®¹å™¨ã€‚æˆ–è€…è‡³å°‘æˆ‘æ˜¯è¿™ä¹ˆæƒ³çš„ã€‚åŸæ¥<code class="fe lf lg lh li b">registry-1.docker.io</code>å’Œ<code class="fe lf lg lh li b">hub.docker.com</code>ä¸æ”¯æŒIPv6ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•ä»ä¸­è·å–Dockeré•œåƒã€‚ğŸ‘</p><h2 id="7b18" class="na ly iq bd lz nb nc dn md nd ne dp mh jy nf ng ml kc nh ni mp kg nj nk mt nl bi translated">è¿è¡Œæ˜ åƒ</h2><p id="136f" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">æˆ‘ä»¬æ˜¯ä¸æ˜¯èµ°è¿›äº†æ­»èƒ¡åŒï¼Ÿä¸ï¼Œè°·æ­Œå®¹å™¨æ³¨å†Œæ¥æ‹¯æ•‘æˆ‘ä»¬ï¼â†’ <code class="fe lf lg lh li b">gcr.io/gcp-runtimes/ubuntu_18_0_4:latest</code>ã€‚è®©æˆ‘ä»¬åœ¨æ¯ä¸ªå®ä¾‹ä¸Šè¿è¡Œè¿™ä¸ªã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="de64" class="na ly iq li b gy nq nr l ns nt">docker run -it --rm gcr.io/gcp-runtimes/ubuntu_18_0_4:latest bash</span></pre><p id="b7ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">åœ¨æ¯ä¸ªå®¹å™¨ä¸­å®‰è£…<code class="fe lf lg lh li b">ping</code>å’Œ<code class="fe lf lg lh li b">iproute2</code>è¿›è¡Œä¸€äº›è¿é€šæ€§æµ‹è¯•å¹¶æ£€æŸ¥è·¯ç”±è¡¨ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="6575" class="na ly iq li b gy nq nr l ns nt">apt-get <strong class="li ir">-o Acquire::ForceIPv6=true </strong>update<br/>apt-get <strong class="li ir">-o Acquire::ForceIPv6=true </strong>install iputils-ping iproute2 -y</span></pre><p id="139d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ­¤æ—¶ï¼Œæˆ‘ä»¬å·²ç»éªŒè¯äº†å®ä¾‹å¯ä»¥é€šè¿‡IPv6è®¿é—®äº’è”ç½‘(é€šè¿‡<code class="fe lf lg lh li b">apt-get</code>)ã€‚è®©æˆ‘ä»¬çœ‹çœ‹åˆ†é…çš„IPåœ°å€ï¼›æˆ‘ä»¬åœ¨<code class="fe lf lg lh li b">instance-1</code> ( <code class="fe lf lg lh li b">container-1</code>)çš„å®¹å™¨ä¸­å¾—åˆ°<code class="fe lf lg lh li b">::a </code>ã€‚ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬åœ¨è¿è¡Œäº<code class="fe lf lg lh li b">instance-2</code> ( <code class="fe lf lg lh li b">container-2</code>)çš„å®¹å™¨ä¸­å¾—åˆ°<code class="fe lf lg lh li b">::e</code>ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="6555" class="na ly iq li b gy nq nr l ns nt">root@d7c9480161f9:/# <strong class="li ir">ip add</strong><br/>...<br/>4: eth0@if5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default<br/>...<br/>    inet6 <strong class="li ir">2600:1f18:47b:ca03::a/126</strong> scope global nodad<br/>       valid_lft forever preferred_lft forever<br/>...</span></pre><p id="664c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä¸ºäº†æ›´æ¸…æ¥šåœ°è¯´æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡IPv6 pingäº’è”ç½‘ä¸­çš„ä¸»æœºã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="75e3" class="na ly iq li b gy nq nr l ns nt">root@d7c9480161f9:/# <strong class="li ir">ping6 ipv6-test.com -c 1</strong><br/>PING ipv6-test.com(agaric.t0x.net (2001:41d0:8:e8ad::1)) 56 data bytes<br/>64 bytes from agaric.t0x.net (2001:41d0:8:e8ad::1): icmp_seq=1 ttl=46 time=78.7 ms</span><span id="a655" class="na ly iq li b gy nu nr l ns nt">--- ipv6-test.com ping statistics ---<br/>1 packets transmitted, 1 received, <strong class="li ir">0% packet loss</strong>, time 0ms<br/>rtt min/avg/max/mdev = 78.788/78.788/78.788/0.000 ms</span></pre><p id="14da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¥½äº†ï¼Œç°åœ¨è®©æˆ‘ä»¬ä»<code class="fe lf lg lh li b">container-1</code>(<code class="fe lf lg lh li b">5312fff41595</code>)ping<code class="fe lf lg lh li b">container-2</code>(<code class="fe lf lg lh li b">d7c9480161f9</code>)ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="8351" class="na ly iq li b gy nq nr l ns nt">root@d7c9480161f9:/# <strong class="li ir">ping6 2600:1f18:47b:ca03::e -c 1</strong><br/>PING 2600:1f18:47b:ca03::e(2600:1f18:47b:ca03::e) 56 data bytes<br/>64 bytes from 2600:1f18:47b:ca03::e: icmp_seq=1 ttl=62 time=0.250 ms</span><span id="5b5e" class="na ly iq li b gy nu nr l ns nt">--- 2600:1f18:47b:ca03::e ping statistics ---<br/>1 packets transmitted, 1 received, <strong class="li ir">0% packet loss</strong>, time 0ms<br/>rtt min/avg/max/mdev = 0.250/0.250/0.250/0.000 ms</span></pre><p id="450f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">åè¿‡æ¥(<code class="fe lf lg lh li b">container-2</code>åˆ°<code class="fe lf lg lh li b">container-1)</code>ï¼Œä»¥é˜²ä¸‡ä¸€ã€‚ä¸€åˆ‡æ­£å¸¸ã€‚ğŸ˜</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="1dcd" class="na ly iq li b gy nq nr l ns nt">root@5312fff41595:/#  <strong class="li ir">ping6 2600:1f18:47b:ca03::a -c 1</strong><br/>PING 2600:1f18:47b:ca03::a(2600:1f18:47b:ca03::a) 56 data bytes<br/>64 bytes from 2600:1f18:47b:ca03::a: icmp_seq=1 ttl=62 time=0.263 ms</span><span id="66b4" class="na ly iq li b gy nu nr l ns nt">--- 2600:1f18:47b:ca03::a ping statistics ---<br/>1 packets transmitted, 1 received, <strong class="li ir">0% packet loss</strong>, time 0ms<br/>rtt min/avg/max/mdev = 0.263/0.263/0.263/0.000 ms</span></pre><p id="d17f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¦‚æœè¿™å¯¹æ‚¨ä¸èµ·ä½œç”¨ï¼Œè¯·ç¡®ä¿åº”ç”¨äº<a class="ae kl" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html" rel="noopener ugc nofollow" target="_blank"> ENI </a>çš„<code class="fe lf lg lh li b">Security Group</code>å…è®¸æ¥è‡ªæ‚¨çš„å®ä¾‹çš„IPv6 ICMPã€‚æˆ‘ä¸“é—¨åˆ›å»ºäº†ä¸€ä¸ªå…¥ç«™<code class="fe lf lg lh li b">Custom ICMP Rule â€” IPv6</code>ï¼Œå®ƒå…·æœ‰ä¸æºç›¸åŒçš„<code class="fe lf lg lh li b">Security Group</code> IDï¼Œä»¥ä½¿è¿™ä¸ªä¾‹å­èƒ½å¤Ÿå·¥ä½œã€‚</p><h2 id="c0b7" class="na ly iq bd lz nb nc dn md nd ne dp mh jy nf ng ml kc nh ni mp kg nj nk mt nl bi translated">è·¯ç”±è¡¨</h2><p id="9b9b" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">è®©æˆ‘ä»¬æ¥æ¢ç©¶ä¸€ä¸‹<code class="fe lf lg lh li b">container-1</code>ä¸­çš„è·¯ç”±è¡¨ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="96cc" class="na ly iq li b gy nq nr l ns nt">root@d7c9480161f9:/# <strong class="li ir">ip -6 route</strong><br/>2600:1f18:47b:ca03<strong class="li ir">::8</strong>/126 dev <strong class="li ir">eth0</strong> proto kernel metric 256 pref medium<br/>fe80::/64 dev eth0 proto kernel metric 256 pref medium<br/><strong class="li ir">default</strong> via 2600:1f18:47b:ca03<strong class="li ir">::9</strong> dev eth0 metric 1024 pref medium</span></pre><p id="dfe1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe lf lg lh li b">::9</code>æ˜¯åœ¨å‰é¢çš„ç»ˆç«¯è¾“å‡ºä¸­çœ‹åˆ°çš„<code class="fe lf lg lh li b">docker0</code>ä¸­çš„IPã€‚<code class="fe lf lg lh li b">instance-1</code>è·¯ç”±çš„è¡¨å‘¢ï¼Ÿ</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="36e8" class="na ly iq li b gy nq nr l ns nt">$ <strong class="li ir">ip -6 route</strong><br/>2600:1f18:47b:ca03::8/126 dev docker0 proto kernel metric 256 pref medium<br/>2600:1f18:47b:ca03::8/126 dev docker0 metric 1024 pref medium<br/>2600:1f18:47b:ca03::/64 dev ens5 proto kernel metric 256 pref medium<br/>...<br/>default via fe80::1066:30ff:feb8:c008 dev ens5 proto static metric 1024 pref medium</span></pre><h2 id="8ea5" class="na ly iq bd lz nb nc dn md nd ne dp mh jy nf ng ml kc nh ni mp kg nj nk mt nl bi translated">ä¸€å¥å¿ å‘Š</h2><p id="cf74" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">Docker å»ºè®®æˆ‘ä»¬åœ¨Linuxä¸Šå¯ç”¨IPv6è·¯ç”±ï¼Œé€šè¿‡æ‰§è¡Œä¸‹é¢ä¸¤è¡Œä»£ç æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="e89a" class="na ly iq li b gy nq nr l ns nt">sudo sysctl net.ipv6.conf.default.forwarding=1<br/>sudo sysctl net.ipv6.conf.all.forwarding=1</span></pre><p id="3c30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä¸å¿…è¿™æ ·åšï¼Œå› ä¸ºEC2å®ä¾‹å·²ç»æœ‰äº†è¿™ä¸ªè®¾ç½®ã€‚ä»–ä»¬ä¹Ÿä¸æ¨èå°äº<code class="fe lf lg lh li b">/80</code>çš„IPv6å­ç½‘ã€‚</p><blockquote class="km kn ko"><p id="f8c8" class="jn jo kp jp b jq jr js jt ju jv jw jx kq jz ka kb kr kd ke kf ks kh ki kj kk ij bi translated">âš ï¸â€œDockerå®¹å™¨çš„å­ç½‘å¤§å°åº”è¯¥è‡³å°‘ä¸º/80ï¼Œè¿™æ ·IPv6åœ°å€å¯ä»¥ä»¥å®¹å™¨çš„MACåœ°å€ç»“æŸï¼Œå¹¶ä¸”å¯ä»¥é˜²æ­¢dockerå±‚çš„NDPé‚»å±…ç¼“å­˜å¤±æ•ˆé—®é¢˜â€<a class="ae kl" href="https://docs.docker.com/v17.09/engine/userguide/networking/default_network/ipv6/#how-ipv6-works-on-docker" rel="noopener ugc nofollow" target="_blank">docker</a></p></blockquote><p id="ed0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æœ€åï¼Œä½†åŒæ ·é‡è¦çš„æ˜¯ï¼Œæˆ‘é‡åˆ°äº†ä¸€ä¸ª<a class="ae kl" href="https://github.com/containernetworking/cni/issues/531" rel="noopener ugc nofollow" target="_blank">è®¨è®º</a>ï¼Œå…¶ä¸­ä»–ä»¬å£°æ˜IPv6åœ¨æŸäº›Dockerç‰ˆæœ¬çš„å®¹å™¨ä¸Šæ˜¯ç¦ç”¨çš„ã€‚æˆ‘åœ¨è·‘<code class="fe lf lg lh li b">18.09.0</code>ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="40ca" class="na ly iq li b gy nq nr l ns nt">$ <strong class="li ir">docker info  -f '{{.ServerVersion}}'</strong><br/>18.09.0</span></pre><p id="c03f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä»¥ä¸‹æ˜¯å®¹å™¨å†…<code class="fe lf lg lh li b"> disable_ipv6</code>çš„ç½‘ç»œå†…æ ¸è®¾ç½®ã€‚</p><pre class="ku kv kw kx gt nm li nn no aw np bi"><span id="13e9" class="na ly iq li b gy nq nr l ns nt">root@d7c9480161f9:/# sysctl -a | grep disable_ipv6<br/>net.ipv6.conf.all.disable_ipv6 = 1<br/>net.ipv6.conf.default.disable_ipv6 = 1<br/>net.ipv6.conf.<strong class="li ir">eth0.disable_ipv6 = 0</strong><br/>net.ipv6.conf.<strong class="li ir">lo.disable_ipv6 = 0</strong></span></pre><h1 id="c772" class="lx ly iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">ç»“è®º</h1><p id="b889" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">è™½ç„¶è¿™å¹¶ä¸æ˜¯æœ€ç»ˆç›®æ ‡ï¼Œä½†æœ‰è¶£çš„æ˜¯æˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨äº‘ä¸­è¿è¡Œä»…æ”¯æŒIPv6çš„å®¹å™¨ã€‚âœ…</p><p id="b2e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘å°†å°è¯•æ‰©å±•å®ƒï¼Œåœ¨ä¸€ä¸ªäº‘æä¾›å•†ä¸Šè¿è¡Œåªæ”¯æŒIPv6çš„Kubernetesæˆ–è€…å…ˆçœ‹çœ‹ä¸åŒäº‘æä¾›å•†å¯¹IPv6çš„æ”¯æŒã€‚</p></div></div>    
</body>
</html>