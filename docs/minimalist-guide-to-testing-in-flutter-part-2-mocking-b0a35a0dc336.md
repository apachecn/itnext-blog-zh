# é¢¤æŒ¯è¯•éªŒçš„æœ€ä½é™åº¦æŒ‡å—â€”â€”ç¬¬äºŒéƒ¨åˆ†å˜²å¼„

> åŸæ–‡ï¼š<https://itnext.io/minimalist-guide-to-testing-in-flutter-part-2-mocking-b0a35a0dc336?source=collection_archive---------0----------------------->

![](img/11f393f86219f77ffefda8b8a67226f3.png)

## ç¬¬ 2 éƒ¨åˆ†â€”â€”mock tailâ€”â€”æµ‹è¯•ä¸­çš„å˜²è®½æ˜¯ä»€ä¹ˆï¼Ÿ

## åœ¨æˆ‘ä»¬å¼€å§‹å†™æµ‹è¯•ä¹‹å‰ï¼Œæˆ‘è®¤ä¸ºï¼Œæˆ‘ä»¬éœ€è¦å­¦ä¹ å¦‚ä½•æ¨¡æ‹Ÿå®ƒä»¬ï¼Œè¿™æ˜¯ä¸€ä¸ªæˆ‘ä»¬éœ€è¦ç»å¸¸ä½¿ç”¨çš„é‡è¦è¯é¢˜ï¼

[](/minimalist-guide-to-testing-in-flutter-e9c885c7e35c) [## é¢¤æŒ¯è¯•éªŒçš„ç®€æ˜æŒ‡å—-ç¬¬ä¸€éƒ¨åˆ†ä»€ä¹ˆæ˜¯è¯•éªŒï¼Ÿ

### è¿™ä¸€æ¬¡ï¼Œæˆ‘å°†å¼€å§‹æ·±å…¥ä»‹ç» Flutter ä¸­çš„æµ‹è¯•ï¼

itnext.io](/minimalist-guide-to-testing-in-flutter-e9c885c7e35c) 

## åŸºæœ¬ä¸Šï¼Œæˆ‘ä»¬åœ¨ Flutter ä¸­æœ‰ä¸¤ç§ä¸»è¦çš„å°è£…é€‰æ‹©

1.  è«å¥‡æ‰˜
2.  è«å…‹æ³°å°”

è¿™ä¸¤ä¸ªåŒ…éƒ½å¾ˆæ£’ï¼Œä½†æˆ‘ä¼šé€‰æ‹© [mocktail](https://pub.dev/packages/mocktail)

## ä¸ºä»€ä¹ˆæˆ‘é€‰æ‹©äº† Mocktailï¼Ÿ

åˆ«è¯¯ä¼šï¼Œ[è«å…‹æ‰˜](https://pub.dev/packages/mockito)ä¹Ÿå¾ˆæ£’ï¼Œæ˜¯ dart å›¢é˜Ÿè‡ªå·±ç ”å‘çš„ï¼ä½†æ˜¯æˆ‘å°±æ˜¯å–œæ¬¢è«å…‹æ³°å°”çš„æ–¹æ³•ï¼å› ä¸ºï¼›

*   æ›´ç®€å•çš„ API
*   ä¸ç”Ÿæˆä»£ç 
*   ç±»å‹å®‰å…¨

å°±é‚£æ ·ï¼

## ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦åŒ…ï¼Œæ²¡æœ‰åŒ…å°±ä¸èƒ½å†™å—ï¼Ÿ

äº‹å®ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ï¼Œä½†æˆ‘è®¤ä¸ºè¿™å¼ å›¾ç‰‡ä¼šå¾ˆå¥½åœ°å‘ä½ è§£é‡Šè¿™ç§æƒ…å†µã€‚

## åŠ¨æœº

å³ä½¿åœ¨è¿™ä¸ªåŸºæœ¬çš„ä¾‹å­ä¸­ä½ æ¸…æ¥šåœ°çœ‹åˆ°äº†åŒºåˆ«ï¼

![](img/8c1544ada0279aa5f8fe32714bff07cf.png)

æ— åŒ… vs mocktail

é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸ºæ‰€æœ‰åœºæ™¯ç¼–å†™æ‰€æœ‰è¿™äº›ä»£ç ï¼æƒ³æƒ³é‚£ä¸ªæ ·æ¿æ–‡ä»¶ï¼

æ— è®ºå¦‚ä½•

## ä»€ä¹ˆæ˜¯å˜²è®½ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ

*â€œå•å…ƒæµ‹è¯•èƒŒåçš„ä¸»è¦æ€æƒ³æ˜¯éš”ç¦»å¹¶å…³æ³¨æˆ‘ä»¬æ­£åœ¨æµ‹è¯•çš„å½“å‰å•å…ƒï¼Œè€Œä¸æ˜¯å¤–éƒ¨ä¾èµ–çš„è¡Œä¸ºã€‚ä½†åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä¾èµ–å¤–éƒ¨ä¾èµ–ï¼Œå¦‚æ•°æ®åº“ã€web æœåŠ¡å™¨ã€å¹³å° APIã€å¤–éƒ¨è®¾å¤‡ç­‰ã€‚*

è®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬å½“å‰çš„å•å…ƒä¾èµ–äºä¸€ä¸ª web APIã€‚å½“æœåŠ¡å™¨è¿è¡Œæ—¶ï¼Œæµ‹è¯•è¿è¡Œç¼“æ…¢ä½†å¾ˆå¥½ã€‚ä½†æ˜¯å½“æœåŠ¡å™¨ç¦»çº¿æ—¶ï¼Œå•å…ƒæµ‹è¯•å°±ä¼šå¤±è´¥ã€‚è¿™ä½¿å¾—å•å…ƒæµ‹è¯•ä¸å¯é¢„æµ‹ã€‚å› ä¸ºç½‘ç»œæœåŠ¡å™¨ä¸åœ¨æˆ‘ä»¬çš„æ§åˆ¶ä¹‹ä¸‹ã€‚å½“ç½‘ç»œæœåŠ¡å™¨å…³é—­æ—¶ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬çš„é”™ã€‚è¿™å°±æ˜¯å˜²è®½çš„ç”±æ¥ã€‚â€

(æˆ‘ç›´æ¥ä»[è¿™ç¯‡ç‰›é€¼çš„æ–‡ç« ](https://betterprogramming.pub/flutter-unit-testing-the-beginners-guide-35105164722e)é‡ŒæŠ„äº†è¿™ 2 æ®µã€‚å› ä¸ºæˆ‘æ— æ³•æ›´å¥½åœ°è§£é‡Šå®ƒï¼è¯·æ£€æŸ¥è¿™ç¯‡æ–‡ç« ï¼Œå¹¶ç»™ä»–ä¸€äº›æŒå£°ï¼)

å› æ­¤ï¼Œæˆ‘ä»¬åªæ˜¯åˆ›å»ºå‡çš„æœåŠ¡æ¥å°†æˆ‘ä»¬çš„æµ‹è¯•ä¸å…¶ä»–ä¾èµ–é¡¹éš”ç¦»å¼€æ¥ï¼Œå¹¶ä¸”æˆ‘ä»¬å‡è®¾æ‰€æœ‰çš„å¤–éƒ¨ä¾èµ–é¡¹éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼

> ä½ å¯èƒ½è®¤ä¸ºåŸºæœ¬ä¸Šã€‚ç”¨åŸå§‹æ–‡ä»¶æ›¿æ¢/ä¼ªé€ ä¾èµ–å…³ç³»

![](img/f1923d7fa2d6d8718637c5f5b7486831.png)

-å¡”è¾¾æ–¯Â·ä½©ç‰¹æ‹‰

## ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ç§°ä»–ä»¬ä¸ºå‡è£…è€Œä¸æ˜¯å˜²ç¬‘å‘¢ï¼Ÿ

äº‹å®ä¸Šï¼Œæˆ‘ä¸çŸ¥é“ä¸»è¦åŸå› ï¼Œä½†æˆ‘æƒ³ï¼Œå‡æœåŠ¡æ˜¯æŒ‡ä¸åŒçš„äº‹æƒ…ã€‚(æ¯”å¦‚åœ¨å‡ç¯å¢ƒä¸‹å·¥ä½œ)ä½†æ˜¯å¦‚æœæˆ‘ä»¬ç”¨ä½œä¼ªä»£æ›¿å˜²è®½ã€‚æœ¯è¯­ä¼šæ··æ·†ï¼IMHOã€‚åæ­£é‚£å°±ç®—äº†ä¹Ÿæ— æ‰€è°“ï¼

æ­¤å¤–ï¼Œåœ¨æµ‹è¯•åº”ç”¨ç¨‹åºæ—¶ï¼Œä½ ä¼šçœ‹åˆ°å¾ˆå¤šâ€œå­˜æ ¹â€æœ¯è¯­ï¼

## ä»€ä¹ˆæ˜¯å­˜æ ¹ï¼Ÿ

> Stub æ˜¯ä¸€æ®µä»£ç ï¼Œç”¨æ¥ä»£æ›¿å…¶ä»–ä¸€äº›ç¼–ç¨‹åŠŸèƒ½ã€‚å­˜æ ¹å¯ä»¥æ¨¡æ‹Ÿç°æœ‰ä»£ç çš„è¡Œä¸º

åŸºæœ¬ä¸Šï¼Œæˆ‘ä»¬å¾—åˆ°è¿™ä¸ªç±»ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªçœ‹èµ·æ¥ä¸€æ ·ä½†åŠŸèƒ½ä¸åŒçš„å‡ç±»ï¼

![](img/862419ec8b573597ff3a43c65ff3117c.png)

```
class **Horse** {}class **Trojan** extends **Mock** implements **Horse** {}
```

## å¤Ÿäº†å—ï¼Ÿ

ç„¶åï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬éšè—çš„åŠ›é‡ï¼ï¼

## é€»è¾‘å¾ˆç®€å•ï¼

â€œå‘Šè¯‰ä½ çš„ç‰¹æ´›ä¼Šäººåœ¨ä»»ä½•æƒ…å†µä¸‹è¯¥æ€ä¹ˆåšï¼è®©å®ƒå‘ç”Ÿï¼å¹¶æ§åˆ¶å®ƒæ˜¯å¦æ°å½“åœ°å®Œæˆäº†ä½ çš„å·¥ä½œï¼â€

```
*// Stub the `sound` method.*
**when(() => trojan.sound()).thenReturn('horse sound');***// Verify no interactions have occurred.*
**verifyNever(() => trojan.sound());***// Interact with the mock trojan instance.*
**trojan.sound();***// Verify the interaction occurred.*
**verify(() => trojan.sound()).called(1);***// Interact with the mock instance again.*
**trojan.sound();***// Verify the interaction occurred twice.*
**verify(() => trojan.sound()).called(2);**
```

å®é™…ä¸Šï¼Œæˆ‘ä»¬åœ¨æµ‹è¯•æ—¶æœ‰ 3 ä¸ªä¸»è¦æ­¥éª¤ï¼

(æš‚æ—¶å¿˜è®°`init`å’Œ`dispose`æ­¥éª¤ï¼)

## 1.å®‰æ’â€”å†³å®šè¡Œä¸ºï¼

æˆ‘ä»¬çš„å’’è¯­æ˜¯`when`

"å½“é‚£ä¸ªæ–¹æ³•è¿è¡Œæ—¶ï¼Œå°±è¿™æ ·åšï¼"

```
// Sync Methods
**when**(() => service.**syncMethod**()).**thenReturn**('ehe');// Async Methods **when**(() => service.**asyncMethod**()).**thenAnswer**((e) **async** => 'ehe');// Error Handling
**when**(() => service.**brokenMethod**()).**thenThrow**(**Exception**('ehe'));
```

## 2.è¡ŒåŠ¨â€”â€”è¯•è¯•çœ‹ï¼

è¿™é‡Œæ²¡æœ‰ç‰¹ä¾‹ï¼Œæˆ‘ä»¬åªæ˜¯è¿è¡Œæ–¹æ³•ï¼å¦‚æœæˆ‘ä»¬éœ€è¦çš„è¯ï¼

```
final res = service.**syncMethod**();final res2 = await service.**asyncMethod**();final res3 = service.**brokenMethod**();
```

## 3.æ–­è¨€â€”ç¡®è®¤å®ƒï¼

æœ€åï¼Œæˆ‘ä»¬ç¡®ä¿å·¥ä½œæ­£å¸¸ï¼æ‰€ä»¥æˆ‘ä»¬å®šä¹‰æˆ‘ä»¬çš„æœŸæœ›ï¼Œå¹¶ä¸ç»“æœè¿›è¡Œæ¯”è¾ƒï¼

```
// We make ensure that method never runned before! **verifyNever**(() => service.**syncMethod**());// we call it once and ask the app is it called only once? **verify**(() => service.**syncMethod**()).**called**(1);// we expect we run it but is it return this value? **expect**(service.**syncMethod**(), 'ehe');// I know it'll throw an expection but it's really throw it? **expect**(() => service.**brokenMethod**(), **throwsA**(**isA**<**Exception**>()));
```

## æ‚¨è¿˜å¯ä»¥éšæ—¶è½»æ¾é‡ç½®æ‚¨çš„æœåŠ¡ï¼

è½»æ¾å¼€å§‹ä¸‹ä¸€æ¬¡æµ‹è¯•ï¼

```
**reset**(service);
```

## å°å¿ƒï¼

å¦‚æœä½ æƒ³åœ¨å‚æ•°åŒ¹é…å™¨ä¸­ä½¿ç”¨ä½ çš„è‡ªå®šä¹‰ç±»å‹ï¼Œä½ éœ€è¦åœ¨å¼€å§‹çš„æ—¶å€™æ³¨å†Œä½ çš„ç±»å‹ï¼å› ä¸º Mocktail åªæ”¯æŒå¼€ç®±å³ç”¨çš„åŸè¯­ç±»å‹ï¼ä½†æ˜¯ä¸ç”¨æ‹…å¿ƒï¼Œè¿™å¾ˆå®¹æ˜“åšåˆ°ï¼

```
**class** **Food** {...}**class** **Cat** {
  bool likes(**Food** food) {...}
}...**class** **MockCat** **extends** **Mock** **implements** **Cat** {}**class** **FakeFood** **extends** **Fake** **implements** **Food** {}test('...', () {
  **registerFallbackValue**(**FakeFood**()); **final** cat = **MockCat**();
  when(() => cat.**likes**(**any<FakeFood>**()).thenReturn(**true**);
  ...
});
```

## ä¸ºä»€ä¹ˆæˆ‘ä¸èƒ½æ­£ç¡®åœ°å­˜æ ¹/éªŒè¯æ‰©å±•æ–¹æ³•ï¼Ÿ

æˆ‘è¿˜ç›´æ¥ä»[å¤åˆ¶äº†æ–‡æ¡£](https://pub.dev/packages/mocktail#faqs)ï¼Œå› ä¸ºå®ƒå¾ˆå¥½åœ°è§£é‡Šäº†æƒ…å†µï¼

*"æ‰©å±•æ–¹æ³•ä¸èƒ½è¢«å­˜æ ¹åŒ–/éªŒè¯ï¼Œå› ä¸ºå®ƒä»¬è¢«è§†ä¸ºé™æ€æ–¹æ³•ã€‚è¿™æ„å‘³ç€è°ƒç”¨ç›´æ¥æŒ‡å‘æ‰©å±•æ–¹æ³•ï¼Œè€Œä¸å…³å¿ƒå®ä¾‹ã€‚å› æ­¤ï¼Œå¯¹æ‰©å±•çš„ stubs å’Œ verify è°ƒç”¨æ€»æ˜¯ä¼šå¯¼è‡´è°ƒç”¨çœŸæ­£çš„æ‰©å±•æ–¹æ³•ã€‚*

*ä¸å…¶ç›´æ¥å­˜æ ¹/éªŒè¯æ‰©å±•æ–¹æ³•ï¼Œä¸å¦‚å­˜æ ¹/éªŒè¯æ‰©å±•æ–¹æ³•ä¸ä¹‹äº¤äº’çš„å®ä¾‹ä¸Šçš„å…¬å…±æˆå‘˜*ã€‚"

```
class **MyClass** {}**extension** on **MyClass** {
  void **foo**() {}
}class **MockMyClass** extends **Mock** implements **MyClass** {}
```

*â€åœ¨ä¸Šé¢çš„åœºæ™¯ä¸­ï¼Œåœ¨* `*MockMyClass*` *ä¸Šè°ƒç”¨* `*foo*` *å°†æ€»æ˜¯è°ƒç”¨çœŸæ­£çš„* `*foo()*` *(ä¸æ˜¯å­˜æ ¹)ã€‚å› æ­¤ï¼Œä¸å¯èƒ½å­˜æ ¹/éªŒè¯ä½œä¸ºæ‰©å±•çš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒä»¬æ€»æ˜¯ä¼šå¯¼è‡´çœŸæ­£çš„æ‰©å±•è¢«è°ƒç”¨ã€‚â€*

è¿™å°±æ˜¯æˆ‘æƒ³è¯´çš„å…³äºæ¨¡æ‹Ÿæµ‹è¯•çš„ä¸€åˆ‡ï¼

ä¸‹å‘¨ï¼Œæˆ‘å°†å¼€å§‹è°ˆè®ºå•å…ƒæµ‹è¯•ï¼Œå¹¶äº²è‡ªåŠ¨æ‰‹ï¼

## ç¬¬ 1 éƒ¨åˆ†â€”ä»€ä¹ˆæ˜¯æµ‹è¯•ï¼Ÿ

[](/minimalist-guide-to-testing-in-flutter-e9c885c7e35c) [## é¢¤æŒ¯è¯•éªŒçš„æœ€ä½é™åº¦æŒ‡å—

### è¿™ä¸€æ¬¡ï¼Œæˆ‘å°†å¼€å§‹æ·±å…¥ä»‹ç» Flutter ä¸­çš„æµ‹è¯•ï¼

itnext.io](/minimalist-guide-to-testing-in-flutter-e9c885c7e35c) 

## ç¬¬äºŒéƒ¨åˆ†â€”â€”ä»€ä¹ˆæ˜¯å˜²è®½ï¼Ÿâ€”å½“å‰ï¼

## ç¬¬ 3 éƒ¨åˆ†â€”è‡ªåŠ¨åŒ–æµ‹è¯•

[](/minimalist-guide-to-testing-in-flutter-part-3-automated-testing-f47e857f4e88) [## é¢¤æŒ¯è¯•éªŒçš„æœ€ä½é™åº¦æŒ‡å—ç¬¬ä¸‰éƒ¨åˆ†è‡ªåŠ¨è¯•éªŒ

### å•å…ƒæµ‹è¯•ã€å°éƒ¨ä»¶æµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æµ‹è¯•è¦†ç›–ç­‰ç­‰ï¼Œæ‰€æœ‰è¿™äº›åœ¨è¿™ç¯‡æ–‡ç« ä¸­éƒ½æœ‰ä¸€ä¸ªå¯ç†è§£çš„â€¦

itnext.io](/minimalist-guide-to-testing-in-flutter-part-3-automated-testing-f47e857f4e88) 

## ç¬¬ 4 éƒ¨åˆ†â€”ä¸€äº›æœ‰ç”¨çš„æµ‹è¯•åŒ…

[](/minimalist-guide-to-testing-in-flutter-part-4-useful-packages-92e1b4eecdd8) [## é¢¤æŒ¯è¯•éªŒçš„æœ€ä½é™åº¦æŒ‡å—â€”â€”ç¬¬ 4 éƒ¨åˆ†æœ‰ç”¨çš„åŒ…

### å¸®åŠ©ä½ å»ºç«‹æ›´å¿«æ›´å¥½çš„æµ‹è¯•çš„æœ‰ç”¨çš„åŒ…ï¼

itnext.io](/minimalist-guide-to-testing-in-flutter-part-4-useful-packages-92e1b4eecdd8) 

## å‚è€ƒ

[](https://betterprogramming.pub/flutter-unit-testing-the-beginners-guide-35105164722e) [## é¢¤æŒ¯å•å…ƒè¯•éªŒâ€”â€”åˆå­¦è€…æŒ‡å—

### å•å…ƒæµ‹è¯•æ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æµ‹è¯•å°çš„ä»£ç å•å…ƒ

better ç¼–ç¨‹. pub](https://betterprogramming.pub/flutter-unit-testing-the-beginners-guide-35105164722e) 

# æ„Ÿè°¢æ‚¨çš„é˜…è¯»ï¼

æˆ‘è¯•å›¾åˆ›é€ å°½å¯èƒ½ç®€å•çš„ä¾‹å­ã€‚å¸Œæœ›ä½ å–œæ¬¢ã€‚

å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·ç‚¹å‡»ğŸ‘æŒ‰é’®(ä½ çŸ¥é“ä½ å¯ä»¥å‡åˆ° 50 å—ï¼Ÿ)