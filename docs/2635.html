<html>
<head>
<title>ğŸŒ Creating React usePosition() hook for getting browserâ€™s geolocation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ğŸŒåˆ›å»ºReact usePosition()æŒ‚é’©ä»¥è·å–æµè§ˆå™¨çš„åœ°ç†ä½ç½®</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/creating-react-useposition-hook-for-getting-browsers-geolocation-2f27fc1d96de?source=collection_archive---------0-----------------------#2019-06-30">https://itnext.io/creating-react-useposition-hook-for-getting-browsers-geolocation-2f27fc1d96de?source=collection_archive---------0-----------------------#2019-06-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c4d05ca421aea15921359e1c52c4401e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ja821leVLCOgq3qtdwyg9g.jpeg"/></div></div></figure><h2 id="4822" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">TLï¼›é€Ÿåº¦ä¸‰è§’å½¢å®šä½æ³•(dead reckoning)</h2><p id="f0f5" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªReact <em class="lp"> usePosition() </em>é’©å­æ¥è·å–å¹¶è·Ÿè¸ªæµè§ˆå™¨çš„ä½ç½®ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å…¨å±€å¯¹è±¡<em class="lp"> navigator.geolocation </em>æä¾›çš„<a class="ae lq" href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation/getCurrentPosition" rel="noopener ugc nofollow" target="_blank"><em class="lp">getCurrentPosition</em></a>å’Œ<a class="ae lq" href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation/watchPosition" rel="noopener ugc nofollow" target="_blank"> <em class="lp"> watchPosition </em> </a>å‡½æ•°ã€‚<em class="lp"> usePosition() </em>é’©å­çš„æœ€ç»ˆç‰ˆæœ¬æ˜¯<a class="ae lq" href="https://github.com/trekhleb/use-position" rel="noopener ugc nofollow" target="_blank"> <strong class="kw ir"> <em class="lp">å‘å¸ƒåœ¨GitHub </em> </strong> </a>å’Œ<a class="ae lq" href="https://www.npmjs.com/package/use-position" rel="noopener ugc nofollow" target="_blank"><strong class="kw ir"><em class="lp">ã€NPMã€‘</em></strong></a>ä¸Šï¼Œå‡†å¤‡å¥½è¢«ä½ çš„åº”ç”¨æ¶ˆè´¹ã€‚</p><h2 id="234f" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯èƒ½éœ€è¦usePosition()é’©å­</h2><p id="20bf" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated"><a class="ae lq" href="https://reactjs.org/docs/hooks-intro.html" rel="noopener ugc nofollow" target="_blank">ååº”é’©å­</a>çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯<em class="lp">èƒ½å¤Ÿåˆ†ç¦»å…³æ³¨ç‚¹</em>ã€‚æˆ‘ä»¬å¯ä»¥å®Œå…¨é¿å…ä½¿ç”¨çŠ¶æ€ï¼Œè€Œåªä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„é’©å­æ¥ä¸ºæˆ‘ä»¬å¤„ç†çŠ¶æ€ç®¡ç†ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä¸€ä¸ªå¸¦æœ‰åœ°ç†ä½ç½®<strong class="kw ir">å’Œ</strong>å¥—æ¥å­—è¿æ¥çš„çŠ¶æ€å¯¹è±¡ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªé€»è¾‘åˆ†æˆä¸¤ä¸ªç‹¬ç«‹çš„é’©å­ï¼Œè€Œä¸æ˜¯åœ¨åŒä¸€ä¸ª<em class="lp">componentidmount()</em>å›è°ƒä¸­å¯åŠ¨æµè§ˆå™¨ä½ç½®ç›‘è§†å™¨<strong class="kw ir">å’Œ</strong>æ‰“å¼€å¥—æ¥å­—è¿æ¥ã€‚è¿™ç»™äº†æˆ‘ä»¬æ›´å¹²å‡€å’Œæ›´æ˜“ç»´æŠ¤çš„ä»£ç ã€‚</p><h2 id="6eb2" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">æˆ‘ä»¬å°†å¦‚ä½•ä½¿ç”¨Position()é’©å­</h2><p id="6ffd" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">è®©æˆ‘ä»¬åšä¸€äº›é€†å‘å·¥ç¨‹ï¼Œæƒ³è±¡æˆ‘ä»¬å·²ç»å®ç°äº†ä¸€ä¸ª<em class="lp"> usePosition() </em>é’©å­ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬å¯èƒ½æƒ³è¦ä½¿ç”¨å®ƒçš„æ–¹å¼:</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="804b" class="jy jz iq lw b gy ma mb l mc md">import React from 'react';<br/>import {usePosition} from './usePosition';</span><span id="a370" class="jy jz iq lw b gy me mb l mc md">export const UsePositionDemo = () =&gt; {<br/>  const {latitude, longitude, error} = usePosition();</span><span id="ed8b" class="jy jz iq lw b gy me mb l mc md">  return (<br/>    &lt;code&gt;<br/>      latitude: {latitude}&lt;br/&gt;<br/>      longitude: {longitude}&lt;br/&gt;<br/>      error: {error}<br/>    &lt;/code&gt;<br/>  );<br/>};</span></pre><p id="51b2" class="pw-post-body-paragraph ku kv iq kw b kx mf kz la lb mg ld le kh mh lg lh kl mi lj lk kp mj lm ln lo ij bi translated">ä½ çœ‹ï¼Œç”¨<em class="lp"> usePosition() </em>é’©å­åªæœ‰ä¸€è¡Œï¼Œä½ å·²ç»æœ‰æ•°æ®äº†(<em class="lp">çº¬åº¦</em>å’Œ<em class="lp">ç»åº¦</em>)ã€‚æˆ‘ä»¬è¿™é‡Œç”šè‡³ä¸ç”¨<em class="lp"> useState() </em>å’Œ<em class="lp"> useEffect() </em>ã€‚ä½ç½®è®¢é˜…å’Œè§‚å¯Ÿå™¨æ¸…ç†å°è£…åœ¨<em class="lp"> usePosition() </em>é’©å­ä¸­ã€‚ç°åœ¨ï¼ŒReactå°†ä¸ºæˆ‘ä»¬å¤„ç†é‡ç»˜ç»„ä»¶é­”æœ¯ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°<em class="lp"> &lt;ä»£ç &gt;â€¦&lt;/ä»£ç &gt; </em>å—ä¸æ–­æ›´æ–°æµè§ˆå™¨çš„æœ€æ–°ä½ç½®å€¼ã€‚çœ‹èµ·æ¥å¾ˆæ•´æ´å¹²å‡€ã€‚</p><h2 id="62f0" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">usePosition()é’©å­å®ç°</h2><p id="ec51" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">æˆ‘ä»¬è‡ªå®šä¹‰çš„<em class="lp"> usePosition() </em> hookåªæ˜¯ä¸€ä¸ªJavaScriptå‡½æ•°ï¼Œå®ƒä½¿ç”¨äº†å…¶ä»–ç±»ä¼¼<a class="ae lq" href="https://reactjs.org/docs/hooks-state.html" rel="noopener ugc nofollow" target="_blank"> <em class="lp"> useState() </em> </a>å’Œ<a class="ae lq" href="https://reactjs.org/docs/hooks-effect.html" rel="noopener ugc nofollow" target="_blank"> <em class="lp"> useEffect() </em> </a>çš„é’©å­ã€‚å®ƒçœ‹èµ·æ¥ä¼šåƒè¿™æ ·:</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="c067" class="jy jz iq lw b gy ma mb l mc md">// imports go here...</span><span id="3492" class="jy jz iq lw b gy me mb l mc md">export const usePosition = () =&gt; {<br/>  // code goes here...<br/>}</span></pre><p id="be22" class="pw-post-body-paragraph ku kv iq kw b kx mf kz la lb mg ld le kh mh lg lh kl mi lj lk kp mj lm ln lo ij bi translated">æˆ‘ä»¬å°†ä½¿ç”¨<em class="lp"> useEffect() </em>é’©å­æ¥é’©ä½ç»„ä»¶(å°†ä½¿ç”¨æˆ‘ä»¬çš„é’©å­)è¢«æ¸²æŸ“çš„æ—¶åˆ»ï¼Œå¹¶è®¢é˜…åœ°ç†ä½ç½®çš„å˜åŒ–ã€‚æˆ‘ä»¬è¿˜å°†ä½¿ç”¨<em class="lp"> useState() </em>é’©å­æ¥å­˜å‚¨<em class="lp">çº¬åº¦</em>ã€<em class="lp">ç»åº¦</em>å’Œ<em class="lp">é”™è¯¯</em>æ¶ˆæ¯(ä»¥é˜²ç”¨æˆ·ä¸å…è®¸æµè§ˆå™¨å…±äº«å…¶ä½ç½®)ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦é¦–å…ˆå¯¼å…¥è¿™äº›é’©å­:</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="9363" class="jy jz iq lw b gy ma mb l mc md">import {useState, useEffect} from 'react';</span><span id="0f1d" class="jy jz iq lw b gy me mb l mc md">export const usePosition = () =&gt; {<br/>  // code goes here...<br/>}</span></pre><p id="9bed" class="pw-post-body-paragraph ku kv iq kw b kx mf kz la lb mg ld le kh mh lg lh kl mi lj lk kp mj lm ln lo ij bi translated">è®©æˆ‘ä»¬ä¸ºä½ç½®å’Œé”™è¯¯åˆå§‹åŒ–ä¸€ä¸ªå­˜å‚¨:</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="7e17" class="jy jz iq lw b gy ma mb l mc md">import {useState, useEffect} from 'react';</span><span id="9a9c" class="jy jz iq lw b gy me mb l mc md">export const usePosition = () =&gt; {<br/>  const [position, setPosition] = useState({});<br/>  const [error, setError] = useState(null);<br/>  <br/>  // other code goes here...<br/>}</span></pre><p id="263c" class="pw-post-body-paragraph ku kv iq kw b kx mf kz la lb mg ld le kh mh lg lh kl mi lj lk kp mj lm ln lo ij bi translated">è®©æˆ‘ä»¬ä»å‡½æ•°ä¸­è¿”å›ä¸€ä¸ªç†æƒ³å€¼ã€‚æˆ‘ä»¬è¿˜æ²¡æœ‰å®ƒä»¬ï¼Œä½†æ˜¯è®©æˆ‘ä»¬è¿”å›åˆ°ç›®å‰ä¸ºæ­¢çš„åˆå§‹å€¼ï¼Œä»¥åå†å¡«å……å®ƒä»¬:</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="5e0a" class="jy jz iq lw b gy ma mb l mc md">import {useState, useEffect} from 'react';</span><span id="ab99" class="jy jz iq lw b gy me mb l mc md">export const usePosition = () =&gt; {<br/>  const [position, setPosition] = useState({});<br/>  const [error, setError] = useState(null);<br/>  <br/>  // other code goes here...</span><span id="b89d" class="jy jz iq lw b gy me mb l mc md">  return {...position, error};<br/>}</span></pre><p id="e6e9" class="pw-post-body-paragraph ku kv iq kw b kx mf kz la lb mg ld le kh mh lg lh kl mi lj lk kp mj lm ln lo ij bi translated">è¿™æ˜¯æˆ‘ä»¬é’©å­çš„ä¸€ä¸ªå…³é”®éƒ¨åˆ†â€”â€”è·å–æµè§ˆå™¨çš„ä½ç½®ã€‚æˆ‘ä»¬å°†åœ¨ç»„ä»¶æ¸²æŸ“åæ‰§è¡Œæå–é€»è¾‘(useEffect hook)ã€‚</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="e2d3" class="jy jz iq lw b gy ma mb l mc md">import {useState, useEffect} from 'react';</span><span id="0ceb" class="jy jz iq lw b gy me mb l mc md">export const usePosition = () =&gt; {<br/>  const [position, setPosition] = useState({});<br/>  const [error, setError] = useState(null);<br/>  <br/>  // callbacks will go here...</span><span id="deba" class="jy jz iq lw b gy me mb l mc md">  useEffect(() =&gt; {<br/>    const geo = navigator.geolocation;<br/>    if (!geo) {<br/>      setError('Geolocation is not supported');<br/>      return;<br/>    }</span><span id="cab9" class="jy jz iq lw b gy me mb l mc md">    watcher = geo.watchPosition(onChange, onError);</span><span id="a066" class="jy jz iq lw b gy me mb l mc md">    return () =&gt; geo.clearWatch(watcher);<br/>  }, []);</span><span id="74f0" class="jy jz iq lw b gy me mb l mc md">  return {...position, error};<br/>}</span></pre><p id="a596" class="pw-post-body-paragraph ku kv iq kw b kx mf kz la lb mg ld le kh mh lg lh kl mi lj lk kp mj lm ln lo ij bi translated">åœ¨useEffect() hookä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåšä¸€äº›æ£€æŸ¥ï¼Œçœ‹çœ‹æµè§ˆå™¨æ˜¯å¦æ”¯æŒ<em class="lp"> navigator.geolocation </em>ã€‚å¦‚æœä¸æ”¯æŒåœ°ç†å®šä½ï¼Œæˆ‘ä»¬å°†è®¾ç½®ä¸€ä¸ªé”™è¯¯å¹¶ä»æ•ˆæœä¸­è¿”å›ã€‚å¦‚æœæ”¯æŒ<em class="lp"> navigator.geolocation </em>ï¼Œæˆ‘ä»¬å°†é€šè¿‡æä¾›<em class="lp"> onChange() </em>å’Œ<em class="lp"> onError() </em>å›è°ƒæ¥è®¢é˜…ä½ç½®æ›´æ”¹(æˆ‘ä»¬ç¨åå°†æ·»åŠ å®ƒä»¬)ã€‚æ³¨æ„ï¼Œæˆ‘ä»¬ä»<em class="lp"> useEffect() </em>è¿”å›äº†ä¸€ä¸ªlambdaå‡½æ•°ã€‚åœ¨lambdaå‡½æ•°ä¸­ï¼Œä¸€æ—¦ç»„ä»¶è¢«å¸è½½ï¼Œæˆ‘ä»¬å°±æ¸…é™¤è§‚å¯Ÿå™¨ã€‚å› æ­¤ï¼Œè¿™ä¸ªè®¢é˜…/å–æ¶ˆè®¢é˜…é€»è¾‘å°†ç”±æˆ‘ä»¬çš„<em class="lp"> usePosition() </em>é’©å­åœ¨å†…éƒ¨å¤„ç†ï¼Œæ¶ˆè´¹è€…ä¸å¿…æ‹…å¿ƒã€‚</p><p id="52de" class="pw-post-body-paragraph ku kv iq kw b kx mf kz la lb mg ld le kh mh lg lh kl mi lj lk kp mj lm ln lo ij bi translated">ç°åœ¨è®©æˆ‘ä»¬æ·»åŠ ç¼ºå¤±çš„å›è°ƒ:</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="f324" class="jy jz iq lw b gy ma mb l mc md">import {useState, useEffect} from 'react';</span><span id="6d33" class="jy jz iq lw b gy me mb l mc md">export const usePosition = () =&gt; {<br/>  const [position, setPosition] = useState({});<br/>  const [error, setError] = useState(null);<br/>  <br/>  const onChange = ({coords}) =&gt; {<br/>    setPosition({<br/>      latitude: coords.latitude,<br/>      longitude: coords.longitude,<br/>    });<br/>  };</span><span id="127e" class="jy jz iq lw b gy me mb l mc md">  const onError = (error) =&gt; {<br/>    setError(error.message);<br/>  };</span><span id="be00" class="jy jz iq lw b gy me mb l mc md">  useEffect(() =&gt; {<br/>    const geo = navigator.geolocation;<br/>    if (!geo) {<br/>      setError('Geolocation is not supported');<br/>      return;<br/>    }</span><span id="4556" class="jy jz iq lw b gy me mb l mc md">    watcher = geo.watchPosition(onChange, onError);</span><span id="09a8" class="jy jz iq lw b gy me mb l mc md">    return () =&gt; geo.clearWatch(watcher);<br/>  }, []);</span><span id="cb89" class="jy jz iq lw b gy me mb l mc md">  return {...position, error};<br/>}</span></pre><p id="587e" class="pw-post-body-paragraph ku kv iq kw b kx mf kz la lb mg ld le kh mh lg lh kl mi lj lk kp mj lm ln lo ij bi translated">æˆ‘ä»¬ç»“æŸäº†ã€‚é’©å­<em class="lp"> usePosition() </em>å¯ä»¥è¢«ä½¿ç”¨ï¼Œå®ƒåªå°è£…åœ°ç†ä½ç½®ç›¸å…³çš„é€»è¾‘ã€‚</p><h2 id="b517" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">ç¼–åè®°</h2><p id="c636" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">ä½ å¯èƒ½ä¼šåœ¨GitHub  ä¸Šæ‰¾åˆ°ä¸€ä¸ª<a class="ae lq" href="https://trekhleb.github.io/use-position/" rel="noopener ugc nofollow" target="_blank"> <strong class="kw ir">æ¼”ç¤º</strong> </a>å’Œæ›´è¯¦ç»†çš„<a class="ae lq" href="https://github.com/trekhleb/use-position" rel="noopener ugc nofollow" target="_blank"> <strong class="kw ir"> usePosition()é’©å­å®ç°ã€‚æˆ‘å¸Œæœ›è¿™ä¸ªä¾‹å­å¯¹ä½ æœ‰æ‰€å¯å‘ã€‚ç¼–ç å¿«ä¹ï¼</strong></a></p></div></div>    
</body>
</html>