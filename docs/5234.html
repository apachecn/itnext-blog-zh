<html>
<head>
<title>.NET Decimal DataType in gRPC</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ã€‚gRPCä¸­çš„. NETåè¿›åˆ¶æ•°æ®ç±»å‹</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/net-decimal-datatype-in-grpc-51c2ddb1c153?source=collection_archive---------3-----------------------#2021-01-18">https://itnext.io/net-decimal-datatype-in-grpc-51c2ddb1c153?source=collection_archive---------3-----------------------#2021-01-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="499c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">ä¸­çš„åè¿›åˆ¶æ•°æ®ç±»å‹çš„å®Œæ•´å·¥ä½œç¤ºä¾‹çš„åˆ†æ­¥æŒ‡å—ã€‚ç½‘ç»œgRPC</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a73f807515bee8c8a7534360e07407f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y3yY8DDEAKnwcew9G3jaNw.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">å›¾ç‰‡ç”±<a class="ae ky" href="https://pixabay.com/users/geralt-9301/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=5594879" rel="noopener ugc nofollow" target="_blank">æ ¼å°”å¾·Â·å¥¥ç‰¹æ›¼</a>æ¥è‡ª<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=5594879" rel="noopener ugc nofollow" target="_blank">çš®å…‹æ–¯æ‹œ</a></figcaption></figure><p id="72b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å¦‚æœä½ æŸ¥çœ‹åè®®ç¼“å†²åŒº(protobuf) <a class="ae ky" href="https://developers.google.com/protocol-buffers/docs/proto#scalar" rel="noopener ugc nofollow" target="_blank">è¯­è¨€æŒ‡å—ï¼Œ</a>ä½ ä¼šçœ‹åˆ°å®ƒåªæ”¯æŒ<strong class="lb iu">æµ®ç‚¹å‹</strong>å’Œ<strong class="lb iu">åŒç²¾åº¦å‹</strong>å®æ•°å‹<a class="ae ky" href="https://en.wikipedia.org/wiki/Real_number" rel="noopener ugc nofollow" target="_blank">ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä»–ä»¬æ˜¯å¥½çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨çš„éƒ¨åˆ†æ•°æ®åŒ…å«è´§å¸å€¼ï¼Œå®ƒä»¬å°±ä¸æ˜¯ç†æƒ³çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒä»¬ä¸ç²¾ç¡®ã€‚</a></p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8ca7" class="ma mb it lw b gy mc md l me mf">&gt; 3.99d * 5<br/>19.950000000000003</span></pre><p id="c210" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘ä»¬é¢„è®¡æ˜¯19.95ï¼Œä½†ç»è¿‡è®¡ç®—åæ˜¯19.950000000000003ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒä»¬å¯¹è´§å¸ä»·å€¼æ²¡æœ‰å¥½å¤„ã€‚</p><blockquote class="mg mh mi"><p id="1db1" class="kz la mj lb b lc ld ju le lf lg jx lh mk lj lk ll ml ln lo lp mm lr ls lt lu im bi translated"><strong class="lb iu">ä¸ºä»€ä¹ˆæˆ‘çš„æ•°å­—ï¼Œæ¯”å¦‚0.1 + 0.2ï¼ŒåŠ èµ·æ¥ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ•´æ•°0.3ï¼Œè€Œæ˜¯æˆ‘å¾—åˆ°ä¸€ä¸ªå¥‡æ€ªçš„ç»“æœï¼Œæ¯”å¦‚0.3000000000000004ï¼Ÿ</strong></p><p id="0690" class="kz la mj lb b lc ld ju le lf lg jx lh mk lj lk ll ml ln lo lp mm lr ls lt lu im bi translated">å› ä¸ºåœ¨å†…éƒ¨ï¼Œè®¡ç®—æœºä½¿ç”¨çš„æ˜¯ä¸€ç§æ ¼å¼(<a class="ae ky" href="https://floating-point-gui.de/formats/binary/" rel="noopener ugc nofollow" target="_blank">äºŒè¿›åˆ¶</a> <a class="ae ky" href="https://floating-point-gui.de/formats/fp/" rel="noopener ugc nofollow" target="_blank">æµ®ç‚¹</a>)ï¼Œæ ¹æœ¬æ— æ³•å‡†ç¡®è¡¨ç¤º0.1ã€0.2æˆ–è€…0.3 <em class="it">è¿™æ ·çš„æ•°å­—</em>ã€‚</p><p id="bc02" class="kz la mj lb b lc ld ju le lf lg jx lh mk lj lk ll ml ln lo lp mm lr ls lt lu im bi translated">å½“ä»£ç è¢«ç¼–è¯‘æˆ–è§£é‡Šæ—¶ï¼Œä½ çš„â€œ0.1â€å·²ç»è¢«èˆå…¥åˆ°è¯¥æ ¼å¼ä¸­æœ€æ¥è¿‘çš„æ•°å­—ï¼Œè¿™å¯¼è‡´ä¸€ä¸ªå°çš„<a class="ae ky" href="https://floating-point-gui.de/errors/rounding/" rel="noopener ugc nofollow" target="_blank">èˆå…¥è¯¯å·®</a>ï¼Œç”šè‡³åœ¨è®¡ç®—å‘ç”Ÿä¹‹å‰ã€‚<br/>â€”â€”<a class="ae ky" href="https://floating-point-gui.de/basic/" rel="noopener ugc nofollow" target="_blank">https://floating-point-gui.de/basic/</a></p></blockquote><p id="952f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">C#åè¿›åˆ¶æ•°æ®ç±»å‹<a class="ae ky" href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/floating-point-numeric-types#characteristics-of-the-floating-point-types" rel="noopener ugc nofollow" target="_blank">æä¾›28â€“29ä½æ•°ç²¾åº¦</a>ã€‚ä½œä¸ºç¤ºä¾‹ï¼Œè¯·çœ‹ä¸‹é¢çš„ä»£ç :</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="05f2" class="ma mb it lw b gy mc md l me mf">&gt; decimal d1 = 3.99M;<br/>&gt; d1 * 5<br/>19.95</span></pre></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="6978" class="ma mb it bd mu mv mw dn mx my mz dp na li nb nc nd lm ne nf ng lq nh ni nj nk bi translated">åœ¨gRPCä¸­ä¸ºå®ç°åè¿›åˆ¶ã€‚ç½‘</h2><p id="af92" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">Protobufä¸æ”¯æŒä»»ä½•ç±»ä¼¼decimalçš„ä¸œè¥¿ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä¸ºå®ƒå®ç°è‡ªå®šä¹‰ç±»å‹ï¼</p><blockquote class="mg mh mi"><p id="de30" class="kz la mj lb b lc ld ju le lf lg jx lh mk lj lk ll ml ln lo lp mm lr ls lt lu im bi translated"><em class="it">ğŸ’¡å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œæˆ‘åœ¨ä¸­ä½¿ç”¨grpcçš„æ¨¡æ¿é¡¹ç›®ã€‚å‡€5ã€‚æ‚¨å¯ä»¥é€šè¿‡åœ¨æ‚¨æƒ³è¦çš„ç»ˆç«¯/å‘½ä»¤è¡Œä¸­æ‰§è¡Œ</em> <code class="fe nq nr ns lw b"><em class="it">dotnet new grpc</em></code> <em class="it">æ¥åˆ›å»ºæ¨¡æ¿é¡¹ç›®ã€‚</em></p></blockquote><p id="afc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åˆ›å»ºä¸€ä¸ªæ–°çš„<code class="fe nq nr ns lw b">protobuf</code>æ–‡ä»¶ï¼Œåœ¨æ‚¨çš„Protosç›®å½•ä¸­å°†å…¶å‘½åä¸º<code class="fe nq nr ns lw b">customTypes.proto</code>,å¹¶å°†ä»¥ä¸‹ä»£ç æ”¾å…¥å…¶ä¸­ã€‚</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="050e" class="ma mb it lw b gy mc md l me mf">syntax = "proto3";<br/><br/>option csharp_namespace = "YourNameSpace";<br/><br/>package customTypes;<br/><br/>// Example: 12345.6789 -&gt; { units = 12345, nanos = 678900000 }<br/>message DecimalValue {<br/><br/>  // Whole units part of the amount<br/>  int64 units = 1;<br/><br/>  // Nano units of the amount (10^-9)<br/>  // Must be same sign as units<br/>  sfixed32 nanos = 2;<br/>}</span></pre><p id="de44" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ‰“å¼€é¡¹ç›®çš„<code class="fe nq nr ns lw b">csproj</code>æ–‡ä»¶ï¼Œç¡®ä¿åˆ›å»ºçš„æ–‡ä»¶é…ç½®å¦‚ä¸‹:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="a059" class="ma mb it lw b gy mc md l me mf">&lt;ItemGroup&gt;<br/>    &lt;Protobuf Include="Protos\greet.proto" GrpcServices="Server"  ProtoRoot="Protos\"/&gt;<br/>  &lt;/ItemGroup&gt;<br/><br/>  &lt;ItemGroup&gt;<br/>    &lt;Protobuf Include="Protos\customTypes.proto" GrpcServices="Both" ProtoRoot="Protos\"/&gt;<br/>  &lt;/ItemGroup&gt;</span></pre><ul class=""><li id="766f" class="nt nu it lb b lc ld lf lg li nv lm nw lq nx lu ny nz oa ob bi translated">ğŸ’¡è¿™å®é™…ä¸Šè¯´æ˜äº†ã€‚NETç¼–è¯‘å’Œç”Ÿæˆã€‚NETä»£ç ä»æ‚¨çš„Protobufæ–‡ä»¶ã€‚</li><li id="c59f" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated">å±æ€§å¾ˆé‡è¦ï¼Œç¡®ä¿å®ƒæŒ‡å‘ä½ ä¿å­˜åŸå‹æ–‡ä»¶çš„åœ°æ–¹ã€‚</li></ul><p id="0a5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç°åœ¨ï¼Œåœ¨æ‚¨æƒ³è¦ä½¿ç”¨åè¿›åˆ¶å€¼çš„æœåŠ¡åŸå‹æ–‡ä»¶ä¸­ï¼Œå¯¼å…¥<code class="fe nq nr ns lw b">customTypes.proto</code>å¹¶ä½¿ç”¨å¦‚ä¸‹çš„<code class="fe nq nr ns lw b">DecimalValue</code>ç±»å‹:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f7ec" class="ma mb it lw b gy mc md l me mf">syntax = "proto3";<br/><br/>option csharp_namespace = "YourNameSpace";<br/><br/>package greet;<br/><br/>import "customTypes.proto";<br/><br/>// The greeting service definition.<br/>service Greeter {<br/>  // Sends a greeting<br/>  rpc SayHello (HelloRequest) returns (HelloReply);<br/>}<br/><br/>// The request message containing the user's name.<br/>message HelloRequest {<br/>  string name = 1;<br/>}<br/><br/>// The response message containing the greetings.<br/>message HelloReply {<br/>  string message = 1;<br/>  customTypes.DecimalValue Value = 2;<br/>}</span></pre><p id="8961" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä¹‹å‰æˆ‘è¯´è¿‡ã€‚NET Buildä¼šæŠŠä½ çš„åŸå‹æ–‡ä»¶ç¼–è¯‘æˆã€‚NETä»£ç ã€‚è¿™ä¸ªç¼–è¯‘å™¨çš„å¥½å¤„æ˜¯å®ƒä¸ºå®ƒç”Ÿæˆäº†ä¸€ä¸ªåˆ†éƒ¨ç±»<a class="ae ky" href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/partial-classes-and-methods" rel="noopener ugc nofollow" target="_blank">,æ­£å› ä¸ºå¦‚æ­¤ï¼Œå¾ˆå®¹æ˜“æ‰©å±•è¿™ä¸ªç±»å‹ã€‚</a></p><p id="05b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ‚¨å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°éƒ¨åˆ†ç”Ÿæˆçš„ä»£ç :</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">ä»Protobufç”Ÿæˆçš„ä»£ç </figcaption></figure><p id="6cfb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æœ€åï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªåˆ†éƒ¨ç±»ï¼Œå¹¶å°†å…¶å‘½åä¸ºæˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„CustomType:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="830f" class="ma mb it lw b gy mc md l me mf">namespace YourNameSpace<br/>{<br/>    public partial class DecimalValue<br/>    {<br/>        private const decimal NanoFactor = 1_000_000_000;<br/>        public DecimalValue(long units, int nanos)<br/>        {<br/>            Units = units;<br/>            Nanos = nanos;<br/>        }<br/><br/>        public static implicit operator decimal(DecimalValue grpcDecimal)<br/>        {<br/>            return grpcDecimal.Units + grpcDecimal.Nanos / NanoFactor;<br/>        }<br/><br/>        public static implicit operator DecimalValue(decimal value)<br/>        {<br/>            var units = decimal.ToInt64(value);<br/>            var nanos = decimal.ToInt32((value - units) * NanoFactor);<br/>            return new DecimalValue(units, nanos);<br/>        }<br/>    }<br/>}</span></pre><p id="fd99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç”¨è¿™ä¸ªç±»ä¸­å®šä¹‰çš„<code class="fe nq nr ns lw b">implicit</code>è¿ç®—ç¬¦ï¼Œã€‚NETä¼šè‡ªåŠ¨å°†<code class="fe nq nr ns lw b">DecimalValue</code>è½¬æ¢ä¸º<code class="fe nq nr ns lw b">Decimal</code>å’Œwise-verseã€‚ä¾‹å¦‚ï¼Œåœ¨è¿™ä¸ªå®ä¾‹ä¸­ï¼Œ<code class="fe nq nr ns lw b">3.99M * 5</code>çš„åè¿›åˆ¶å€¼è¢«åˆ†é…ç»™ä¸€ä¸ª<code class="fe nq nr ns lw b">DecimalValue</code>å±æ€§ã€‚</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/fa06c0725b47bcbfe5c2b82eb8dbc9e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*cFOS4yYGmSSHpcRMkmc9Iw.gif"/></div></div></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="0416" class="ma mb it bd mu mv mw dn mx my mz dp na li nb nc nd lm ne nf ng lq nh ni nj nk bi translated">ç»“è®º</h2><p id="5a43" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">gRPCå’Œprotbufåœ¨æ€§èƒ½å’ŒåŠŸèƒ½æ–¹é¢éƒ½éå¸¸å‡ºè‰²ï¼Œå¹¶ä¸”å…·æœ‰ä¸å¯æ€è®®çš„ã€‚NETæ”¯æŒï¼Œæ‚¨å¯ä»¥æ›´çµæ´»åœ°æ ¹æ®è‡ªå·±çš„éœ€è¦æ‰©å±•æœåŠ¡ã€‚</p><p id="87d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å¦‚æœä½ æƒ³è¦è¿™ä¸ªé¡¹ç›®çš„å®Œæ•´å·¥ä½œç¤ºä¾‹ï¼Œè¯·éšæ„å…‹éš†æˆ‘çš„å›è´­ä¸ä»¥ä¸‹åœ°å€:</p><p id="30a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://github.com/0x414c49/dotnet-grpc-decimal-example" rel="noopener ugc nofollow" target="_blank">https://github.com/0x414c49/dotnet-grpc-decimal-example</a></p></div></div>    
</body>
</html>