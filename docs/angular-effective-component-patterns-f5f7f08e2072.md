# è§’åº¦:æœ‰æ•ˆç»„ä»¶æ¨¡å¼

> åŸæ–‡ï¼š<https://itnext.io/angular-effective-component-patterns-f5f7f08e2072?source=collection_archive---------0----------------------->

## åœ¨ç»„ä»¶ä¹‹é—´å…±äº«æ•°æ®

æˆ‘æ„å»ºäº†ä¸€ä¸ªç¤ºä¾‹ Angular åº”ç”¨ç¨‹åºï¼Œæ˜¾ç¤ºäº†å››ç§ç»„ä»¶æ¨¡å¼ã€‚è¿™äº›æ¨¡å¼å¯¹äºåœ¨ç»„ä»¶ä¹‹é—´å…±äº«æ•°æ®æ—¢ç®€å•åˆæœ‰æ•ˆã€‚æˆ‘ä»¬å°†ä½¿ç”¨è¿™äº›æ¨¡å¼çš„å…·ä½“ä¾‹å­æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚

[åœ¨ Github ä¸Šä¸‹è½½æºä»£ç ğŸš€](https://github.com/Everduin94/component-communication-patterns)

[åœ¨ Stackblitz ç°åœºæµ‹è¯•ğŸš€](https://stackblitz.com/edit/erxk-component-communication)

æˆ‘ä»¬å°†æ¶µç›–:

*   å°†æ•°æ®ä»çˆ¶ç»„ä»¶ä¼ é€’åˆ°å­ç»„ä»¶
*   åœ¨åŒçº§ç»„ä»¶ä¹‹é—´ä¼ é€’æ•°æ®
*   å°†æ•°æ®ä»ä¸€ä¸ªç»„ä»¶ä¼ é€’åˆ°ä¸€ä¸ªä¸ç›¸å…³çš„ç»„ä»¶ã€‚
*   çˆ¶ç»„ä»¶å’Œå­ç»„ä»¶ä¹‹é—´çš„å¤šå‘æ•°æ®ä¼ é€’

# çˆ¶å­æ¨¡å¼

æˆ‘ä»¬å¯ä»¥æ ¹æ®ç»„ä»¶åœ¨ DOM ä¸­çš„ä½ç½®å®ç°ä¸åŒçš„æ¨¡å¼ã€‚æ¯å½“æˆ‘ä»¬éœ€è¦ä¿ƒè¿›ä¸¤ä¸ªç»„ä»¶ä¹‹é—´çš„é€šä¿¡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å®ƒä»¬ä¹‹é—´çš„å…³ç³»æ¥å®ç°å…¶ä¸­ä¸€ä¸ªæ¨¡å¼ã€‚

å½“ä¸€ä¸ªå…ƒç´ (å­å…ƒç´ )ä½äºå¦ä¸€ä¸ªå…ƒç´ (çˆ¶å…ƒç´ )å†…éƒ¨æ—¶ï¼Œå°±å­˜åœ¨çˆ¶å­å…³ç³»ã€‚æˆ‘ä»¬çš„çˆ¶åˆ°å­ç¤ºä¾‹å°†æ˜¯ä¸€ä¸ªâ€œæœåŠ¡æ¡æ¬¾â€å¤é€‰æ¡†ï¼Œå®ƒå°†åœ¨æ‚¬åœæ—¶æ˜¾ç¤ºå·¥å…·æç¤ºã€‚é€‰ä¸­è¯¥æ¡†åï¼Œå·¥å…·æç¤ºçš„æ¶ˆæ¯å°†ä¼šæ”¹å˜ã€‚

![](img/4b39ea4bef994182b1556eccbf836d62.png)

## ä¸»ä½“å’Œå¯è§‚å¯Ÿçš„â€”â€”ç»´æŠ¤å’Œå‘å‡ºçŠ¶æ€å˜åŒ–

æˆ‘ä»¬æ‰€æœ‰çš„æ¨¡å¼éƒ½å°†åˆ©ç”¨ä» BehaviorSubject åˆ›å»ºçš„ä¸€ä¸ª`BehaviorSubject/state`å’Œä¸€ä¸ª`Observable/eventStream$`ã€‚è¿™å…è®¸æˆ‘ä»¬åœ¨è¡Œä¸ºä¸»ä½“ä¸­ä¿æŒçŠ¶æ€ï¼Œå¹¶é€šè¿‡å¯è§‚å¯Ÿå¯¹è±¡å‘å‡ºå¯¹è¯¥çŠ¶æ€çš„æ”¹å˜ã€‚[ã€1.1ã€‘](http://reactivex.io/rxjs/manual/overview.html#observable)[ã€1.2ã€‘](http://reactivex.io/rxjs/manual/overview.html#behaviorsubject)

æç¤º:åˆ©ç”¨ä¸€ä¸ª**ç§æœ‰è¡Œä¸ºä¸»ä½“**å’Œä¸€ä¸ª**å…¬å…±å¯è§‚å¯Ÿå¯¹è±¡**å…è®¸æˆ‘ä»¬**é”å®šå¯¹æˆ‘ä»¬çŠ¶æ€çš„è®¿é—®å¹¶é˜²æ­¢è¿‡åº¦ä¿®æ”¹**ã€‚

parent.component.ts | ToS å¤é€‰æ¡†â˜‘

ç°åœ¨æˆ‘ä»¬å¯ä»¥**åˆ©ç”¨ä¸ RxJS çš„è§’åº¦äº‹ä»¶ç»‘å®šæ¥è§¦å‘å¯¹æˆ‘ä»¬çš„çŠ¶æ€/æ•°æ®çš„æ›´æ–°**ã€‚æ¯å½“çˆ¶èŠ‚ç‚¹çš„è¾“å…¥è¢«æ”¹å˜æˆ–ä¸é¼ æ ‡äº¤äº’æ—¶ï¼Œçˆ¶èŠ‚ç‚¹çŠ¶æ€å°†è¢«æ›´æ–°ã€‚[ã€2ã€‘](https://angular.io/guide/user-input)

æˆ‘ä»¬æ‰€æœ‰çš„æ¨¡å¼éƒ½å°†åˆ©ç”¨è§’åº¦äº‹ä»¶ç»‘å®šå’Œç±»ä¼¼çš„ RxJSã€‚å…³é”®çš„åŒºåˆ«åœ¨äºç»„ä»¶å¦‚ä½•æ¥æ”¶å¯è§‚å¯Ÿå€¼ï¼Œæˆ–è€…å®ƒä»¬å¦‚ä½•ç›¸äº’ä¼ é€’çŠ¶æ€å˜åŒ–ã€‚

parent.component.html | tos å¤é€‰æ¡†â˜‘

## @Input â€”æ¥æ”¶å­ç»„ä»¶ä¸­çš„æ›´æ”¹

åœ¨åˆå§‹åŒ–æ—¶ï¼Œæˆ‘ä»¬çš„çˆ¶èŠ‚ç‚¹å°†ä½¿ç”¨`@Input`æŠŠå®ƒçš„å¯è§‚å¯Ÿå€¼ä¼ é€’ç»™æˆ‘ä»¬çš„å­èŠ‚ç‚¹ã€‚ä¸€æ—¦è¾“å…¥è¢«åˆå§‹åŒ–ï¼Œ**å­è¿›ç¨‹å°†é€šè¿‡æˆ‘ä»¬çš„å¼‚æ­¥ç®¡é“è®¢é˜…æ¥æ”¶çˆ¶è¿›ç¨‹çŠ¶æ€çš„ä»»ä½•å˜åŒ–ã€‚**[ã€3ã€‘](https://angular.io/api/core/Input)

åˆ©ç”¨è¿™ç§æ¨¡å¼ï¼Œæˆ‘ä»¬çš„ç»„ä»¶ç°åœ¨å®Œå…¨æ˜¯ååº”å¼çš„ã€‚è¿™ç®€åŒ–äº†åœ¨è°ƒè¯•æˆ–å°†æ¥è¿›è¡Œä¿®æ”¹æ—¶ä½¿ç”¨ç»„ä»¶çš„å·¥ä½œã€‚

child.component.html |å·¥å…·æç¤º

## å¯è§‚å¯Ÿå€¼å’Œ@Input çš„äº¤æ›¿ä½¿ç”¨

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¼‚æ­¥ç®¡é“å°†å€¼ä»çˆ¶å¯¹è±¡ä¼ é€’ç»™å­å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¼ é€’æ•´ä¸ªå¯è§‚å¯Ÿå¯¹è±¡ã€‚ä½¿ç”¨â€”â€”åŸºäºåå¥½ï¼Œæˆ–è€…ä¸€ä¸ªæ¯”å¦ä¸€ä¸ªæ›´é€‚åˆç‰¹å®šéœ€æ±‚ã€‚**

parent.component.html

child.component.html

# å…„å¼Ÿæ¨¡å¼

å½“å¤šä¸ªå…ƒç´ å…±äº«ä¸€ä¸ªå…¬å…±çˆ¶å…ƒç´ æ—¶ï¼Œå°±å­˜åœ¨å…„å¼Ÿå…³ç³»ã€‚æˆ‘ä»¬çš„å…„å¼Ÿç»„ä»¶ç¤ºä¾‹å°†æ˜¯ä¸€ä¸ªæ”¹å˜æ˜¾ç¤ºé¢œè‰²çš„é¢œè‰²é€‰æ‹©å™¨ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåªæœ‰æˆ‘ä»¬çš„é¢œè‰²é€‰æ‹©å™¨ä¼šæ›´æ–°çŠ¶æ€ã€‚ç„¶è€Œï¼Œåˆ©ç”¨è¿™ç§æ¨¡å¼ï¼Œä»»ä½•æ•°é‡çš„å…„å¼Ÿéƒ½å¯ä»¥æ›´æ–°çŠ¶æ€ã€‚

![](img/2237358126af953ad84a9b8f0f860641.png)

## å®¹å™¨å’ŒæŒ‡ä»¤â€”â€”ä¿ƒè¿›æ²Ÿé€š

åœ¨å…„å¼Ÿç»„ä»¶ä¹‹é—´ä¼ é€’æ•°æ®ï¼›æˆ‘ä»¬å°†æŠŠå®ƒä»¬åŒ…è£…åœ¨ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œæ¯”å¦‚ div æˆ– ng-containerï¼Œå¹¶å¯¹å®¹å™¨åº”ç”¨è§’åº¦æŒ‡ä»¤ã€‚**è¯¥æŒ‡ä»¤å°†ä½œä¸ºå…„å¼Ÿä¹‹é—´çš„çˆ¶æŒ‡ä»¤æˆ–ä¸­ä»‹**,ç”¨äºç›¸äº’ä¼ é€’çŠ¶æ€/æ•°æ®ã€‚

ç±»ä¼¼äºæˆ‘ä»¬çš„äº²å­æ¨¡å¼ï¼Œæˆ‘ä»¬ä»ç„¶ä½¿ç”¨ç§æœ‰è¡Œä¸ºä¸»ä½“ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å°†å‘å…„å¼ŸèŠ‚ç‚¹å…¬å¼€æ›´æ–°çŠ¶æ€çš„æ–¹æ³•ã€‚è¿™å…è®¸å…„å¼Ÿå§å¦¹å‘æˆ‘ä»¬çš„è¡Œä¸ºä¸»ä½“å‘é€æ–°æ•°æ®ï¼Œè€Œæ— éœ€ç›´æ¥è®¿é—®å®ƒã€‚

parent.directive.ts

## æ³¨å…¥æŒ‡ä»¤â€”è®¿é—®çŠ¶æ€

æˆ‘ä»¬çš„å…„å¼Ÿç»„ä»¶æ³¨å…¥çˆ¶æŒ‡ä»¤[ã€4ã€‘](https://angular.io/guide/dependency-injection)ã€‚è¿™ç»™äº†ä»–ä»¬å¼•ç”¨æˆ‘ä»¬æŒ‡ä»¤çš„å¯è§‚å¯Ÿå€¼`color$`çš„èƒ½åŠ›ã€‚ä¸ºäº†è®¿é—®ä»`color$`å‘å‡ºçš„å€¼ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨å¼‚æ­¥ç®¡é“ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œåªè¦é€‚ç”¨ï¼Œæˆ‘ä»¬éƒ½å¸Œæœ›ä½¿ç”¨å¼‚æ­¥ç®¡é“ã€‚[ã€5ã€‘(æˆ‘çš„æ–‡ç« :å¼‚æ­¥ç®¡é“æ·±æ½œ)](https://medium.com/better-programming/angular-rxjs-async-pipe-deep-dive-2510b56f793a)

å„¿ç«¥-ä¸¤ä¸ª.ç»„ä»¶. ts | child-two.component.html |é¢œè‰²é€‰æ‹©å™¨

æˆ‘ä»¬å¯ä»¥æ·»åŠ ä»»æ„å¤šçš„å…„å¼Ÿå§å¦¹ã€‚æˆ‘ä»¬åªéœ€å°†å…„å¼Ÿå…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼Œå®ƒå°†èƒ½å¤Ÿå‘é€å’Œæ¥æ”¶æ¥è‡ªå…¶ä»–ç»„ä»¶çš„æ•°æ®ã€‚

app.component.html

# æ— å…³æ¨¡å¼

æ²¡æœ‰å…±åŒçˆ¶å…ƒç´ çš„å…ƒç´ è¢«è®¤ä¸ºæ˜¯ä¸ç›¸å…³çš„ã€‚æˆ‘ä»¬çš„ä¾‹å­æ˜¯ä¸€ä¸ªæŒ‰é’®å’Œä¸€ä¸ª toast æ¶ˆæ¯ï¼Œå®ƒä»¬ä¸å…±äº«ä¸€ä¸ªå…¬å…±çš„çˆ¶ç±»æˆ–åŒ…è£…å™¨ã€‚æˆ‘ä»¬å°†åˆ©ç”¨è§’åº¦æœåŠ¡æ¥ä¿ƒè¿›ä¸¤ä¸ªç»„ä»¶ä¹‹é—´çš„æ•°æ®å…±äº«ã€‚

![](img/870e680492e06a4e2aae5fb7b6e2fb99.png)

## æ³¨å…¥æœåŠ¡è®¿é—®çŠ¶æ€

è¿™ç§æ¨¡å¼ç±»ä¼¼äºå…„å¼Ÿæ¨¡å¼ã€‚å…³é”®çš„åŒºåˆ«åœ¨äºï¼Œæˆ‘ä»¬ä½¿ç”¨äº†è§’åº¦æœåŠ¡ï¼Œè€Œä¸æ˜¯è§’åº¦æŒ‡ä»¤ã€‚è¯¥æœåŠ¡çš„ä¼˜åŠ¿åœ¨äºæˆ‘ä»¬ä¸å†éœ€è¦åœ¨åŒä¸€ä¸ªå®¹å™¨ä¸­åŒ…å«ä¸¤ä¸ªç»„ä»¶ã€‚

ä¸æŒ‡ä»¤ç›¸æ¯”ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æœåŠ¡çš„å¤šä¸ªå®ä¾‹ï¼ŒæœåŠ¡çš„ä¸€ä¸ªæ½œåœ¨ç¼ºç‚¹æ˜¯å¢åŠ äº†å¤æ‚æ€§ã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦æœåŠ¡çš„ä¸€ä¸ªå®ä¾‹ã€‚

toast.service.ts

æ¯å½“`ActivatorComponent`å¯¹`ToastService`è¿›è¡Œæ›´æ–°æ—¶ï¼Œ`ToastComponent`å°†é€šè¿‡æœåŠ¡æ¥æ”¶æ›´æ–°ã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸­ä¸éœ€è¦@Inputï¼Œå› ä¸ºä¸€åˆ‡éƒ½æ˜¯é€šè¿‡æœåŠ¡å®ç°çš„ã€‚

activator.component.ts | Button

toast.component.ts | Toast

# å¤šæ–¹å‘æ•°æ®

æˆ‘ä»¬çš„æœ€åä¸€ä¸ªæ¨¡å¼å°†ä»¥ä¸€ä¸ªå¸¦æœ‰å¤šä¸ªå­å…ƒç´ çš„çˆ¶å…ƒç´ ä¸ºç‰¹è‰²ã€‚çˆ¶èŠ‚ç‚¹å°†èƒ½å¤Ÿå°†çŠ¶æ€/æ•°æ®å‘ä¸‹ä¼ é€’ç»™å­èŠ‚ç‚¹ï¼Œå­èŠ‚ç‚¹å°†èƒ½å¤Ÿå°†çŠ¶æ€/æ•°æ®å‘ä¸Šä¼ é€’å›çˆ¶èŠ‚ç‚¹ã€‚

![](img/1019b0babe0962b0974c460dd5c13b2c.png)

## ä¸»ä½“å’Œå¯è§‚å¯Ÿçš„â€”â€”ç»´æŠ¤å’Œå‘å‡ºçŠ¶æ€å˜åŒ–

ç±»ä¼¼äºçˆ¶-å­æ¨¡å¼ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨ä¸€ä¸ªç§æœ‰è¡Œä¸ºä¸»ä½“å’Œä¸€ä¸ªå…¬å…±å¯è§‚å¯Ÿå¯¹è±¡æ¥ç»´æŠ¤çŠ¶æ€å¹¶å°†å˜åŒ–å‘é€ç»™å­å¯¹è±¡ã€‚

å¤šçˆ¶ç»„ä»¶

## @Output â€”æ¥æ”¶çˆ¶ç»„ä»¶ä¸­çš„æ›´æ”¹

è¿™æ˜¯ä½¿æˆ‘ä»¬çš„æ¨¡å¼å…·æœ‰å¤šå‘æ€§çš„å…³é”®åŒºåˆ«ã€‚

**æˆ‘ä»¬åˆ©ç”¨@Output æ¥å…è®¸æˆ‘ä»¬çš„å­ç»„ä»¶å‘æˆ‘ä»¬çš„çˆ¶ç»„ä»¶å‘å‡ºäº‹ä»¶/çŠ¶æ€ã€‚**[ã€6ã€‘](https://angular.io/api/core/Output)

åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å°†ç”¨ä¸€ä¸ª`EventEmitter`æ¥ä»£æ›¿æˆ‘ä»¬çš„å¯è§‚å¯Ÿå¯¹è±¡ã€‚å°† EventEmitter ä¸@Output ä¸€èµ·ä½¿ç”¨æ˜¯ä¸€ç§å¸¸è§çš„åšæ³•ï¼Œå¹¶å¾—åˆ°æ–‡æ¡£çš„æ”¯æŒã€‚

multi-parent.component.html | multi-child.component.html

å½“æˆ‘ä»¬çš„ EventEmitter å‘å‡ºä¸€ä¸ªå€¼æ—¶ï¼Œå°±ä¼šè°ƒç”¨`done($event)`æ–¹æ³•ã€‚`$event`å°†åŒ…å«ä» EventEmitter å‘å‡ºçš„ä»»ä½•çŠ¶æ€/æ•°æ®ã€‚

ä¸ºäº†ç»´æŠ¤çŠ¶æ€å¹¶åœ¨å­å¯¹è±¡å’Œçˆ¶å¯¹è±¡ä¸­ä½¿ç”¨è¯¥å€¼ï¼Œæˆ‘ä»¬å‘ BehaviorSubject å‘å‡ºå…³äºæ›´æ”¹çš„äº‹ä»¶ã€‚å¦‚æœæˆ‘ä»¬ä¸éœ€è¦ç»´æŠ¤çŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥çœç•¥ BehaviorSubjectï¼Œåªä½¿ç”¨ EventEmitterã€‚**

å¤šå­ç»„ä»¶

# æ‘˜è¦

*   **çˆ¶åˆ°å­æ¨¡å¼:**åˆ©ç”¨çˆ¶ä¸­çš„ Subject å’Œ Observable ä»¥åŠå­ä¸­çš„@Input æ¥ä¿ƒè¿›ä»çˆ¶å‘å­å‘é€æ•°æ®
*   **å…„å¼Ÿæ¨¡å¼:**ä¸»ä½“å’Œå¯è§‚å¯Ÿå¯¹è±¡å­˜åœ¨äºä¸€ä¸ªæŒ‡ä»¤ä¸­ï¼Œè¯¥æŒ‡ä»¤å……å½“å…„å¼Ÿä¹‹é—´å‘é€å’Œæ¥æ”¶æ•°æ®çš„ä¸­ä»‹
*   **ä¸ç›¸å…³æ¨¡å¼:**ä¸»ä½“å’Œå¯è§‚å¯Ÿå¯¹è±¡ç”Ÿæ´»åœ¨æœåŠ¡ä¸­ï¼Œç»„ä»¶ä¸å¿…å…±äº«çˆ¶ç»„ä»¶æˆ–å®¹å™¨
*   **å¤šå‘çˆ¶å­æ¨¡å¼:**ä¸çˆ¶å­æ¨¡å¼ç›¸åŒã€‚å°†@Output æ·»åŠ åˆ°å­ç»„ä»¶ï¼Œä»¥ä¾¿å°†çŠ¶æ€/äº‹ä»¶å‘é€å›çˆ¶ç»„ä»¶ã€‚

> â˜ï¸[flotes](https://flotes.app)â€”â€”å°è¯•æ¼”ç¤ºï¼Œä¸éœ€è¦ç™»å½•ã€‚æˆ–è€…å…è´¹æŠ¥åã€‚Flotes æ˜¯æˆ‘è®°ç¬”è®°å’Œé«˜æ•ˆå­¦ä¹ çš„æ–¹å¼ï¼Œå³ä½¿åœ¨æˆ‘å¾ˆå¿™çš„æ—¶å€™ã€‚

![](img/8e468f6e74135bbbc2ecbfce7e2db2bf.png)

[Flotes](https://flotes.app)

# èµ„æº/å‚è€ƒèµ„æ–™

[1.1][http://reactivex.io/rxjs/manual/overview.html#observable](http://reactivex.io/rxjs/manual/overview.html#observable)

ã€1.2ã€‘[http://react vex . io/rxjs/manual/overview . html # behavior subject](http://reactivex.io/rxjs/manual/overview.html#behaviorsubject)

[https://angular.io/guide/user-input](https://angular.io/guide/user-input)

[3][https://angular.io/api/core/Input](https://angular.io/api/core/Input)

[https://angular.io/guide/dependency-injection](https://angular.io/guide/dependency-injection)

[5]æˆ‘çš„æ–‡ç« :[https://medium . com/better-programming/angular-rxjs-async-pipe-deep-dive-2510 b 56 f 793 a](https://medium.com/better-programming/angular-rxjs-async-pipe-deep-dive-2510b56f793a)

[https://angular.io/api/core/Output](https://angular.io/api/core/Output)

* â€”ç»„ä»¶/å…ƒç´ å¯äº’æ¢ä½¿ç”¨ã€‚å½“å¼•ç”¨ DOM: element ä¸­çš„å…³ç³»æˆ–ä½ç½®æ—¶ã€‚å½“æåˆ°æ•°æ®ä½¿ç”¨æˆ–ä»£ç æ—¶:ç»„ä»¶
** â€”æ„Ÿè°¢é‚£äº›æä¾›åé¦ˆçš„äºº