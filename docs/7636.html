<html>
<head>
<title>Collections State Management Service for Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angularçš„é›†åˆçŠ¶æ€ç®¡ç†æœåŠ¡</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/collection-service-for-angular-d0b64bae9c20?source=collection_archive---------1-----------------------#2022-12-04">https://itnext.io/collection-service-for-angular-d0b64bae9c20?source=collection_archive---------1-----------------------#2022-12-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="94ff" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><em class="kf">åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å‘ä½ å±•ç¤ºå¦‚ä½•ä½¿ç”¨</em><a class="ae kg" href="https://github.com/e-oz/ngx-collection" rel="noopener ugc nofollow" target="_blank"><em class="kf">ngx-collection</em></a><em class="kf">åº“ï¼Œä»¥åŠä¸ºä»€ä¹ˆä½ å¯èƒ½æƒ³è¦è¿™æ ·åšã€‚</em></h2></div><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="gh gi kh"><img src="../Images/43ffb75971f687fbeaa5854da84ecc16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LfajOtlLGbzdRdfB"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">ã€Šæœ—å§†é…’è¡—ã€‹ï¼Œå¼—é›·å¾·é‡Œå…‹Â·è´¾å¾·Â·æ²ƒï¼Œ1922å¹´</figcaption></figure><h1 id="fd30" class="kx ky iq bd kz la lb lc ld le lf lg lh jw li jx lj jz lk ka ll kc lm kd ln lo bi translated">ç›®çš„</h1><p id="374c" class="pw-post-body-paragraph lp lq iq lr b ls lt jr lu lv lw ju lx ly lz ma mb mc md me mf mg mh mi mj mk ij bi translated">æ¯ä¸ªwebåº”ç”¨ç¨‹åºéƒ½æœ‰ä¸€äº›åˆ—è¡¨ï¼Œæˆ–è€…åœ¨å†…éƒ¨ä½¿ç”¨ä¸€äº›å®ä½“/é¡¹ç›®åˆ—è¡¨ã€‚å› æ­¤ï¼Œå¯¹äºä¸åŒçš„webæ¡†æ¶ï¼Œæœ‰å¤šä¸ªåº“å¯ä»¥æä¾›å¸®åŠ©ã€‚ä¸ngx-collectionç›¸æ¯”ï¼Œå®ƒä»¬æ—¢æœ‰åŒºåˆ«åˆæœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œè¯·é€‰æ‹©æ‚¨è®¤ä¸ºæ›´é€‚åˆå’Œæ›´èˆ’é€‚çš„äº§å“:)</p><p id="9f7a" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">é›†åˆæœåŠ¡å°†å¸®åŠ©æ‚¨æ“ä½œé›†åˆ:åˆ›å»ºä¸€ä¸ªé¡¹ç›®é›†åˆï¼Œå¹¶å®‰å…¨åœ°æ›´æ–°ä¸€ä¸ªæˆ–å¤šä¸ªé¡¹ç›®(ä¸æ”¹å˜å®ƒä»¬)ã€‚</p><p id="adf4" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">æ­¤å¤–ï¼Œæ‚¨å°†è·å¾—ä¸€ä¸ªè§†å›¾æ¨¡å‹ï¼Œå¯ç”¨äºç›‘æ§æ”¶é›†çŠ¶æ€:</p><ul class=""><li id="8ee1" class="mq mr iq lr b ls ml lv mm ly ms mc mt mg mu mk mv mw mx my bi translated"><strong class="lr ir">æ­£åœ¨è¯»å–</strong>(å½“å‰æ­£åœ¨è¿è¡ŒæŸä¸ªè¯·æ±‚ä»¥æ›¿æ¢é›†åˆä¸­çš„æ‰€æœ‰é¡¹ç›®)</li><li id="1320" class="mq mr iq lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated"><strong class="lr ir">æ­£åœ¨åˆ›å»º</strong>(æ­£åœ¨è¿è¡Œå‘é›†åˆæ·»åŠ æ–°é¡¹ç›®çš„è¯·æ±‚)</li><li id="333d" class="mq mr iq lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated"><strong class="lr ir">æ­£åœ¨æ›´æ–°</strong></li><li id="761d" class="mq mr iq lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated"><strong class="lr ir">æ­£åœ¨åˆ é™¤</strong></li><li id="a3f2" class="mq mr iq lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated"><strong class="lr ir">æ­£åœ¨æ›´æ”¹</strong>(æŸäº›é¡¹ç›®å½“å‰æ­£åœ¨æ›´æ–°æˆ–åˆ é™¤)</li><li id="78e5" class="mq mr iq lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated"><strong class="lr ir">æ­£åœ¨ä¿å­˜</strong>(å½“å‰æ­£åœ¨æ›´æ–°æˆ–åˆ›å»ºä¸€äº›é¡¹ç›®)</li><li id="03ee" class="mq mr iq lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated"><strong class="lr ir">æ­£åœ¨å¤„ç†</strong>(è‡³å°‘æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„è¯·æ±‚)</li></ul><p id="48c0" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">æ­¤å¤–ï¼Œè¿™ä¸ªè§†å›¾è¿˜æœ‰ä¸€ä¸ªé¡¹ç›®åˆ—è¡¨ã€å®ƒä»¬çš„çŠ¶æ€ä»¥åŠä¸€äº›å…¶ä»–æœ‰ç”¨çš„ä¿¡æ¯ã€‚</p><p id="6421" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">ä½¿ç”¨è¿™ä¸ªè§†å›¾æ¨¡å‹å’Œ<strong class="lr ir">å¼‚æ­¥</strong>ç®¡é“ï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°ä¿®æ”¹æ‚¨çš„è§†å›¾ï¼Œä»¥åæ˜ ä¸é›†åˆç›¸å…³çš„æ‰€æœ‰è¿‡ç¨‹â€”â€”å¾®è°ƒå™¨ã€æŒ‰é’®çš„â€œç¦ç”¨â€çŠ¶æ€ã€å¡ç‰‡çš„â€œå±•å¼€â€/â€œæŠ˜å â€çŠ¶æ€ã€é¡¹ç›®çš„â€œèšç„¦â€/â€œé€‰å®šâ€çŠ¶æ€ã€‚</p><h1 id="2630" class="kx ky iq bd kz la lb lc ld le lf lg lh jw li jx lj jz lk ka ll kc lm kd ln lo bi translated">åˆ©ç›Š</h1><p id="5472" class="pw-post-body-paragraph lp lq iq lr b ls lt jr lu lv lw ju lx ly lz ma mb mc md me mf mg mh mi mj mk ij bi translated">âœ…çš„æ¯ä¸€æ¬¡çªå˜éƒ½æ˜¯å¼‚æ­¥çš„:</p><ul class=""><li id="5170" class="mq mr iq lr b ls ml lv mm ly ms mc mt mg mu mk mv mw mx my bi translated">ä½¿ç”¨OnPushç­–ç•¥å¤„ç†ååº”å¼åº”ç”¨ç¨‹åºï¼›</li><li id="ee91" class="mq mr iq lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated">åœ¨å…·æœ‰é»˜è®¤æ›´æ”¹æ£€æµ‹ç­–ç•¥çš„ç»„ä»¶ä¸­å·¥ä½œï¼›</li><li id="b931" class="mq mr iq lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated">å¯ä»¥ä»…ä¸â€œå¼‚æ­¥â€ç®¡é“å’Œsubscribe()ä¸€èµ·ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä¸æŸäº›å­˜å‚¨ä¸€èµ·ä½¿ç”¨ã€‚</li></ul><p id="9be5" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">âœ…æœåŠ¡å…¬å¸å¹¶ä¸å›ºæ‰§å·±è§:</p><ul class=""><li id="9548" class="mq mr iq lr b ls ml lv mm ly ms mc mt mg mu mk mv mw mx my bi translated">å®ƒä¸ä¼šè§„å®šæ‚¨åº”è¯¥å¦‚ä½•ä¸æ‚¨çš„APIæˆ–å…¶ä»–æ•°æ®æºè¿›è¡Œé€šä¿¡ï¼›</li><li id="1a3a" class="mq mr iq lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated">æ‚¨å†³å®šå¦‚ä½•è¿è¡Œå’Œå–æ¶ˆæ‚¨çš„è¯·æ±‚:æ¯ä¸ªå˜å¼‚æ–¹æ³•éƒ½è¿”å›ä¸€ä¸ªå¯è§‚å¯Ÿå€¼ï¼Œå› æ­¤æ‚¨å¯ä»¥å†³å®šå¦‚ä½•ç¼–æ’å®ƒä»¬:switchMapã€mergeMapã€concatMapã€forkJoinæˆ–å…¶ä»–ï¼›</li><li id="3a9d" class="mq mr iq lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated">æ•°æ®æºå¯ä»¥æ˜¯åŒæ­¥çš„(ç”¨â€œrxjs/ofâ€å°±è¡Œ)ã€‚</li></ul><p id="6a99" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">âœ…å®‰å…¨ä¿è¯:</p><ul class=""><li id="52d1" class="mq mr iq lr b ls ml lv mm ly ms mc mt mg mu mk mv mw mx my bi translated">100%ä¸å¯å˜ï¼›</li><li id="39bb" class="mq mr iq lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated">é˜²æ­¢é‡å¤ï¼›</li><li id="c079" class="mq mr iq lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated">é”™è¯¯å’Œå¼‚å¸¸å°†è¢«æ­£ç¡®å¤„ç†ï¼›</li><li id="79cb" class="mq mr iq lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated">ä¸¥æ ¼ç±»å‹åŒ–â€”é«˜çº§ç±»å‹æ£€æŸ¥å’Œä»£ç å®Œæˆï¼›</li></ul><h1 id="6918" class="kx ky iq bd kz la lb lc ld le lf lg lh jw li jx lj jz lk ka ll kc lm kd ln lo bi translated">æ”¶è—å“</h1><p id="ca40" class="pw-post-body-paragraph lp lq iq lr b ls lt jr lu lv lw ju lx ly lz ma mb mc md me mf mg mh mi mj mk ij bi translated">å‡è®¾ä½ æ˜¯ä¸€ä¸ªè‰ºæœ¯æ”¶è—å®¶ï¼Œä½ éœ€è¦ä¸€ä¸ªappç»™ä½ å–œæ¬¢çš„ç”»ä½œæ‰“åˆ†ã€‚</p><p id="720b" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·åˆ›é€ ä¸€ä¸ªæ–°ç³»åˆ—:</p><pre class="ki kj kk kl gt ne nf ng bn nh ni bi"><span id="e380" class="nj ky iq nf b be nk nl l nm nn"><br/>const paintingsCollection = inject(CollectionService&lt;Painting&gt;({<br/>   comparatorFields: ['url']<br/>});</span></pre><p id="9cfc" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥æ³¨æ„åˆ°æ”¶é›†æœåŠ¡æœ€é‡è¦çš„äº‹æƒ…:å®ƒéœ€è¦çŸ¥é“å¯ç”¨äºæ¯”è¾ƒå¯¹è±¡å¹¶å£°æ˜å®ƒä»¬ç›¸ç­‰çš„å­—æ®µã€‚</p><p id="4f94" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">å› ä¸ºåœ¨æ¯ä¸€æ¬¡å˜å¼‚ä¸­ï¼Œæˆ‘ä»¬éƒ½åœ¨é‡æ–°åˆ›å»ºåˆ—è¡¨(ä¸ºäº†æœ‰ä¸€ä¸ªä¸å¯å˜çš„é›†åˆ)ï¼Œé€šå¸¸çš„' === '(é€šè¿‡å¼•ç”¨æ¯”è¾ƒå¯¹è±¡)æ˜¯ä¸å¤Ÿçš„ã€‚</p><p id="26cf" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">å†…ç½®çš„æ¯”è¾ƒå™¨å°†å…è®¸æ‚¨ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µã€å¤åˆå­—æ®µæˆ–åµŒå¥—å­—æ®µã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥å®šä¹‰æ‚¨çš„å‡½æ•°æˆ–ç±»ï¼Œå¹¶å°†å…¶ç”¨ä½œæ¯”è¾ƒå™¨ã€‚</p><h1 id="55b9" class="kx ky iq bd kz la lb lc ld le lf lg lh jw li jx lj jz lk ka ll kc lm kd ln lo bi translated">æ•°æ®æº</h1><p id="ac45" class="pw-post-body-paragraph lp lq iq lr b ls lt jr lu lv lw ju lx ly lz ma mb mc md me mf mg mh mi mj mk ij bi translated">é›†åˆæœåŠ¡åªæœ‰ä¸€ä¸ªèŒè´£:æ“ä½œé›†åˆè€Œä¸ä¿®æ”¹é¡¹ç›®æœ¬èº«ã€‚</p><p id="15dd" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">ä¸ºäº†æä¾›è¿™äº›é¡¹ç›®ï¼Œæ‚¨éœ€è¦ä¸€äº›æœåŠ¡â€”â€”å¯ä»¥æ˜¯ä½¿ç”¨Angular HttpClientçš„å°å‹æœåŠ¡ï¼Œæˆ–è€…æ˜¯ä¸€äº›å…·æœ‰ç¼“å­˜ã€å¤±æ•ˆã€äº¤å‰æ›´æ–°å’Œå…¶ä»–åŠŸèƒ½çš„å¤æ‚APIå®¢æˆ·ç«¯â€”â€”æ”¶é›†æœåŠ¡å°†ä½¿ç”¨å®ƒä»¬æä¾›çš„å¯è§‚å¯Ÿå¯¹è±¡ã€‚Collection Serviceä¸­æ²¡æœ‰ç”¨äºä¸æ•°æ®æä¾›è€…é€šä¿¡çš„å†…ç½®å·¥å…·ï¼Œå®ƒä¸ºæ‚¨æä¾›äº†å®ç°çš„ç»å¯¹è‡ªç”±å’Œç»„åˆä¸åŒå·¥å…·çš„å……åˆ†çµæ´»æ€§ã€‚</p><p id="ca8b" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªæ¨¡æ‹ŸAPIå®¢æˆ·ç«¯è¡Œä¸ºçš„ç®€å•æœåŠ¡:</p><pre class="ki kj kk kl gt ne nf ng bn nh ni bi"><span id="48f1" class="nj ky iq nf b be nk nl l nm nn">export class PaintingsService {<br/><br/>  getPaintings(): Observable&lt;Painting[]&gt; {<br/>    return timer(1000).pipe(<br/>      map(() =&gt;<br/>        [<br/>          {<br/>            url: '...',<br/>            title: 'A Walk at Twilight',<br/>            artist: 'Vincent van Gogh',<br/>            date: '1889-1890',<br/>          },<br/>          {<br/>            url: '...',<br/>            title: 'Siesta',<br/>            artist: 'JoaquÃ­n Sorolla',<br/>            date: '1911',<br/>          },<br/>  // ...<br/>        ]  // shuffle<br/>          .map((value) =&gt; ({ value, sort: Math.random() }))<br/>          .sort((a, b) =&gt; a.sort - b.sort)<br/>          .map(({ value }) =&gt; value)<br/>      )<br/>    );<br/>  }<br/><br/>  ratePainting(painting: Painting, rate: number): Observable&lt;Painting&gt; {<br/>    return timer(2000).pipe(<br/>      map(() =&gt; ({<br/>        ...painting,<br/>        rate,<br/>      }))<br/>    );<br/>  }<br/>}</span></pre><p id="127d" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">å…¶ä¸­<code class="fe no np nq nf b">Painting</code>æ¨¡å‹å…·æœ‰è¿™æ ·çš„ç»“æ„:</p><pre class="ki kj kk kl gt ne nf ng bn nh ni bi"><span id="9096" class="nj ky iq nf b be nk nl l nm nn">export type Painting = {<br/>  readonly url: string;<br/>  readonly title: string;<br/>  readonly artist: string;<br/>  readonly date: string;<br/>  readonly rate?: number;<br/>};</span></pre><p id="d65c" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">æ‰€æœ‰çš„å­—æ®µéƒ½æ˜¯<code class="fe no np nq nf b">readonly</code>ä»¥ç¡®ä¿æˆ‘ä»¬ä¸ä¼šæ„å¤–åœ°æ”¹å˜æˆ‘ä»¬çš„æ¡ç›®ã€‚</p><h1 id="1adf" class="kx ky iq bd kz la lb lc ld le lf lg lh jw li jx lj jz lk ka ll kc lm kd ln lo bi translated">æˆåˆ†</h1><p id="875f" class="pw-post-body-paragraph lp lq iq lr b ls lt jr lu lv lw ju lx ly lz ma mb mc md me mf mg mh mi mj mk ij bi translated">ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æˆ‘ä»¬çš„é›†åˆ:ç»„ä»¶ï¼Œè´Ÿè´£å‘ˆç°å’Œæ›´æ–°é¡¹ç›®ã€‚</p><p id="2568" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">åœ¨è¿™ä¸ªå®ç°ä¸­ï¼Œæˆ‘ä½¿ç”¨NgRxç»„ä»¶å­˜å‚¨ä½œä¸ºæ‰€æœ‰ç»„ä»¶é€»è¾‘çš„ä½ç½®ã€‚è¿™ä¸æ˜¯å¿…éœ€çš„â€”â€”æ‚¨å¯ä»¥ä½¿ç”¨å¸¸è§„è®¢é˜…æ¥ä»£æ›¿ï¼Œä½†è¿™æ˜¯æˆ‘æ¨èçš„åšæ³•ã€‚è®©æˆ‘ä»¬ä¸è¦è½¬ç§»æ³¨æ„åŠ›å»è®¨è®ºè¿™èƒŒåçš„æ¨ç†ï¼›)</p><pre class="ki kj kk kl gt ne nf ng bn nh ni bi"><span id="ade0" class="nj ky iq nf b be nk nl l nm nn">export interface PaintingsListState {}<br/><br/>@Injectable()<br/>export class PaintingsListStore extends ComponentStore&lt;PaintingsListState&gt; {<br/>  readonly collection = inject(PaintingsCollection);<br/><br/>  constructor(private readonly api: PaintingsService) {<br/>    super({});<br/>    this.load();<br/>  }<br/><br/>  private readonly load = this.effect((_) =&gt; _.pipe(<br/>      switchMap(() =&gt; this.collection.read({<br/>          request: this.api.getPaintings(),<br/>        })<br/>      )<br/>    )<br/>  );<br/><br/>  readonly rate = this.effect&lt;{ painting: Painting; rate: number }&gt;((_) =&gt;<br/>    _.pipe(<br/>      switchMap(({ painting, rate }) =&gt;<br/>        this.collection.update({<br/>          request: this.api.ratePainting(painting, rate),<br/>          item: painting,<br/>        })<br/>      )<br/>    )<br/>  );<br/><br/>  readonly remove = this.effect&lt;Painting&gt;((_) =&gt;_.pipe(<br/>      mergeMap((painting) =&gt;<br/>        this.collection.delete({<br/>          request: timer(1000),<br/>          item: painting,<br/>        })<br/>      )<br/>    )<br/>  );<br/>}</span></pre><p id="7b2e" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬çš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚<br/>é¦–å…ˆæ˜¯<code class="fe no np nq nf b">load</code>:</p><pre class="ki kj kk kl gt ne nf ng bn nh ni bi"><span id="fbba" class="nj ky iq nf b be nk nl l nm nn">load = this.effect((_) =&gt; _.pipe(<br/>      switchMap(() =&gt; this.collection.read({<br/>          request: this.api.getPaintings(),<br/>      })<br/>)));</span></pre><p id="a48b" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">å½“<code class="fe no np nq nf b">load</code>äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬å°†è°ƒç”¨<code class="fe no np nq nf b">collection.read()</code>å¹¶ä½¿ç”¨<code class="fe no np nq nf b">api.getPaintings()</code>è¯·æ±‚ã€‚</p><p id="8cd7" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">ç„¶åæ˜¯<code class="fe no np nq nf b">rate</code>:</p><pre class="ki kj kk kl gt ne nf ng bn nh ni bi"><span id="c61a" class="nj ky iq nf b be nk nl l nm nn">rate = this.effect&lt;{ painting: Painting; rate: number }&gt;((_) =&gt;_.pipe(<br/>      switchMap(({ painting, rate }) =&gt;<br/>        this.collection.update({<br/>          request: this.api.ratePainting(painting, rate),<br/>          item: painting,<br/>      })<br/>)));</span></pre><p id="0c3e" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨è¾“å…¥å‚æ•°ï¼Œ<code class="fe no np nq nf b">painting</code>å’Œ<code class="fe no np nq nf b">rate</code>ã€‚å½“ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬è°ƒç”¨<code class="fe no np nq nf b">collection.update()</code>ï¼Œè¯·æ±‚æ˜¯<code class="fe no np nq nf b">api.ratePainting()</code>ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦å¦ä¸€ä¸ªå‚æ•°:<code class="fe no np nq nf b">item</code>ã€‚<br/>å®ƒåº”è¯¥æ˜¯æˆ‘ä»¬æƒ³è¦æ›´æ–°çš„é¡¹ç›®(æˆ–è€…åªæ˜¯å…·æœ‰ç›¸åŒä¸»é”®çš„ä»»ä½•å¯¹è±¡)ã€‚</p><p id="69bd" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">é€šè¿‡ä½¿ç”¨<code class="fe no np nq nf b">switchMap</code>ï¼Œæˆ‘ä»¬å°†å–æ¶ˆå½“å‰æ­£åœ¨è¿è¡Œçš„<code class="fe no np nq nf b">rate</code>è¯·æ±‚(å¦‚æœç°åœ¨æœ‰æ­£åœ¨è¿è¡Œçš„è¯·æ±‚)ï¼Œå› æ­¤åªæœ‰æœ€åä¸€ä¸ª<code class="fe no np nq nf b">rate</code>å°†è¢«åº”ç”¨ã€‚æ”¶é›†æœåŠ¡å°†æ­£ç¡®å¤„ç†å®ƒï¼Œå› ä¸ºæ¯ä¸ªåŠ¨ä½œéƒ½æ˜¯å¼‚æ­¥çš„ã€‚</p><p id="33bf" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">è¿™é‡Œæœ€åä¸€ä¸ªæ˜¯<code class="fe no np nq nf b">remove</code>:</p><pre class="ki kj kk kl gt ne nf ng bn nh ni bi"><span id="1993" class="nj ky iq nf b be nk nl l nm nn">remove = this.effect&lt;Painting&gt;((_) =&gt;_.pipe(<br/>      mergeMap((painting) =&gt;<br/>        this.collection.delete({<br/>          request: timer(1000),<br/>          item: painting,<br/>      })<br/>)));</span></pre><p id="312f" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">å’Œ<code class="fe no np nq nf b">rate</code>åªæœ‰ä¸¤ç‚¹ä¸åŒ:<br/> 1ã€‚æˆ‘ä»¬ä½¿ç”¨<code class="fe no np nq nf b">mergeMap</code>æ˜¯å› ä¸ºæˆ‘ä»¬å…è®¸å¹¶è¡Œåˆ é™¤é¡¹ç›®ã€‚<br/> 2ã€‚æˆ‘ä»¬ä½¿ç”¨<code class="fe no np nq nf b">timer</code>ä½œä¸º<code class="fe no np nq nf b">request</code>ï¼Œå› ä¸ºæˆ‘ä»¬çš„APIå®¢æˆ·ç«¯æ²¡æœ‰åˆ é™¤é¡¹ç›®çš„æ–¹æ³•(æ¯•ç«Ÿè¿™åªæ˜¯ä¸€ä¸ªæ¨¡ä»¿)ã€‚</p><p id="a76f" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">æˆ‘ä»¬çš„ç»„ä»¶æœ¬èº«å°†ä¼šå¾ˆå°:</p><pre class="ki kj kk kl gt ne nf ng bn nh ni bi"><span id="a301" class="nj ky iq nf b be nk nl l nm nn">@Component({<br/>  selector: 'paintings-list',<br/>  templateUrl: './paintings-list.component.html',<br/>  styleUrls: ['./paintings-list.component.scss'],<br/>  changeDetection: ChangeDetectionStrategy.OnPush,<br/>  standalone: true,<br/>  imports: [<br/>    CommonModule,<br/>    // ...<br/>  ],<br/>  providers: [PaintingsListStore],<br/>})<br/>export class PaintingsListComponent {<br/>  protected readonly store = inject(PaintingsListStore);<br/><br/>  protected readonly vm$ = this.store.collection.getViewModel();<br/>}</span></pre><p id="1ff6" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">å°±æ˜¯è¿™æ ·ï¼<br/>åªæœ‰ä¸¤ä¸ªå­—æ®µ:å•†åº—å’Œè§†å›¾æ¨¡å‹ã€‚</p><p id="308c" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">åœ¨æ¨¡æ¿ä¸­ï¼Œæˆ‘ä»¬å°†å‘ˆç°ä¸€ä¸ªåˆ—è¡¨ã€ä¸€ä¸ªæ—‹è½¬å™¨ã€ä¸€å¹…ç”»ã€æ˜Ÿçº§å’Œä¸€ä¸ªâ€œåˆ é™¤â€æŒ‰é’®ã€‚ä¸ºäº†ç®€æ´èµ·è§ï¼Œå»æ‰äº†ä¸€äº›ç»†èŠ‚ã€‚</p><pre class="ki kj kk kl gt ne nf ng bn nh ni bi"><span id="cd6b" class="nj ky iq nf b be nk nl l nm nn">&lt;ng-container *ngIf="vm$ | async as $"&gt;<br/><br/>  &lt;mat-card class="spinner" *ngIf="$.isReading"&gt;<br/>    &lt;mat-spinner&gt;&lt;/mat-spinner&gt;<br/>  &lt;/mat-card&gt;<br/><br/>  &lt;mat-accordion&gt;<br/>    &lt;mat-expansion-panel<br/>      *ngFor="<br/>        let item of $.items;<br/>        trackBy: store.collection.getTrackByFieldFn('url')<br/>      "<br/>    &gt;<br/>      &lt;mat-expansion-panel-header&gt;<br/>        &lt;mat-panel-title&gt;{{ item.title }}&lt;/mat-panel-title&gt;<br/>      &lt;/mat-expansion-panel-header&gt;<br/><br/>      &lt;ng-template matExpansionPanelContent&gt;<br/>        &lt;mat-card&gt;<br/>          &lt;mat-card-header&gt;<br/>            &lt;mat-card-title&gt;{{ item.artist }}&lt;/mat-card-title&gt;<br/>            &lt;mat-card-subtitle&gt;{{ item.date }}&lt;/mat-card-subtitle&gt;<br/>          &lt;/mat-card-header&gt;<br/><br/>          &lt;img mat-card-image <br/>               [src]="item.url" <br/>               class="frame" <br/>               [ngClass]="{'mutating': $.isMutating}"/&gt;<br/>        &lt;/mat-card&gt;<br/><br/>      &lt;/ng-template&gt;<br/><br/>      &lt;mat-action-row class="actions"&gt;<br/>        &lt;div class="stars" <br/>             [ngClass]="{'spin': $.isUpdating}"<br/>         &gt;        <br/>          &lt;mat-icon (click)="store.rate({ painting: item, rate: 1 })"&gt;<br/>            {{<br/>             item.rate ? 'star' : 'star_border'<br/>            }}<br/>          &lt;/mat-icon&gt;<br/>        &lt;/div&gt;<br/><br/>        &lt;button <br/>          mat-mini-fab <br/>          color="warn" <br/>          [disabled]="$.isDeleting"<br/>          (click)="store.remove(item)"<br/>        &gt;<br/>            &lt;mat-icon&gt;delete&lt;/mat-icon&gt;<br/>        &lt;/button&gt;<br/>      &lt;/mat-action-row&gt;<br/>    &lt;/mat-expansion-panel&gt;<br/>  &lt;/mat-accordion&gt;<br/>&lt;/ng-container&gt;</span></pre><p id="d5fd" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">æ·»åŠ ä¸€äº›æ ·å¼ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°±å‡†å¤‡å¥½äº†:<a class="ae kg" href="https://stackblitz.com/edit/ngx-collection-example?file=src%2Fapp%2Fcollections%2Fpaintings.collection.ts" rel="noopener ugc nofollow" target="_blank"> StackBlitz </a> ğŸ–¼ï¸</p><p id="0f2d" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">ä½ å¯ä»¥æ³¨æ„åˆ°çªå‡ºåŠ¨ä½œçš„è§†è§‰æ•ˆæœã€‚<br/>â€œåˆ é™¤â€æŒ‰é’®å¯ä»¥è°ƒç”¨ä¸€æ¬¡ï¼Œå› æ­¤åœ¨é¡¹ç›®è¢«åˆ é™¤æ—¶ï¼Œè¯¥æŒ‰é’®è¢«æ˜¾ç¤ºä¸ºâ€œç¦ç”¨â€ã€‚<br/>å¯ä»¥æ— é™åˆ¶åœ°ç‚¹å‡»æ˜Ÿæ˜Ÿï¼Œå› æ­¤æ˜Ÿæ˜Ÿä¸ä¼šè¢«ç¦ç”¨â€”â€”åªä¼šä¿å­˜æœ€åä¸€ä¸ªè¯„çº§ï¼Œè€Œä¹‹å‰çš„è¯·æ±‚å°†è¢«å–æ¶ˆã€‚</p><h1 id="4830" class="kx ky iq bd kz la lb lc ld le lf lg lh jw li jx lj jz lk ka ll kc lm kd ln lo bi translated">å…±äº«æ”¶è—</h1><p id="8a6e" class="pw-post-body-paragraph lp lq iq lr b ls lt jr lu lv lw ju lx ly lz ma mb mc md me mf mg mh mi mj mk ij bi translated">è¿™ä¸ªåº“çš„è®¾è®¡åŸåˆ™ä¹‹ä¸€æ˜¯:ä½¿ç”¨é›†åˆæœåŠ¡åº”è¯¥å¾ˆå®¹æ˜“åˆ›å»ºç®€å•çš„åº”ç”¨ç¨‹åºå’Œç»„ä»¶ï¼Œä½†å®ƒä¹Ÿåº”è¯¥å¯ä»¥ç”¨äºä»»ä½•å¤æ‚ç¨‹åº¦çš„åº”ç”¨ç¨‹åºå’Œç»„ä»¶ã€‚</p><p id="646f" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">ä½¿ç”¨<a class="ae kg" href="https://github.com/e-oz/ngx-collection" rel="noopener ugc nofollow" target="_blank"> ngx-collection </a>ï¼Œæ‚¨å¯ä»¥åˆ›å»ºå…±äº«é›†åˆâ€”â€”å¦‚æœæ‚¨çš„ä¸€ä¸ªç»„ä»¶å°†æ›´æ–°ä¸€ä¸ªé¡¹ç›®ï¼Œæ‰€æœ‰å…¶ä»–ç»„ä»¶å°†ç«‹å³åœ¨é¡µé¢ä¸Šåæ˜ å®ƒã€‚ä¸ºæ­¤ï¼Œæ‚¨åªéœ€è¦ä¿®æ”¹â€œå¯æ³¨å…¥çš„â€è£…é¥°å‚æ•°:</p><pre class="ki kj kk kl gt ne nf ng bn nh ni bi"><span id="b968" class="nj ky iq nf b be nk nl l nm nn">@Injectable({ providedIn: 'root' })<br/>export class PaintingsCollection extends CollectionService&lt;Painting&gt; {<br/>  constructor() {<br/>    super({<br/>      comparatorFields: ['url'],<br/>    });<br/>  }<br/>}</span></pre><h1 id="a82c" class="kx ky iq bd kz la lb lc ld le lf lg lh jw li jx lj jz lk ka ll kc lm kd ln lo bi translated">æ–‡æ¡£å’ŒAPI</h1><p id="ebdc" class="pw-post-body-paragraph lp lq iq lr b ls lt jr lu lv lw ju lx ly lz ma mb mc md me mf mg mh mi mj mk ij bi translated">æ”¶é›†æœåŠ¡æœ‰å¤šç§æ–¹æ³•ï¼Œä½†è¦å¼€å§‹ä½¿ç”¨å®ƒï¼Œæ‚¨åªéœ€è¦çŸ¥é“å…¶ä¸­çš„4ç§æ–¹æ³•:</p><ul class=""><li id="2609" class="mq mr iq lr b ls ml lv mm ly ms mc mt mg mu mk mv mw mx my bi translated">åˆ›é€ </li><li id="6b41" class="mq mr iq lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated">é˜…è¯»</li><li id="c616" class="mq mr iq lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated">æ›´æ–°</li><li id="935c" class="mq mr iq lr b ls mz lv na ly nb mc nc mg nd mk mv mw mx my bi translated">åˆ é™¤</li></ul><p id="3294" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">å°±æ˜¯è¿™æ ·ï¼</p><p id="7732" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">å…¶ä»–æ–¹æ³•åœ¨è¿™é‡Œåªæ˜¯ä½œä¸ºé™„åŠ çš„å®ç”¨ç¨‹åºå’ŒåŠ©æ‰‹ã€‚<br/>å®Œæ•´çš„APIæ–‡æ¡£å¯ä»¥åœ¨èµ„æºåº“(GitHub) ä¸­æ‰¾åˆ°<a class="ae kg" href="https://github.com/e-oz/ngx-collection#readme" rel="noopener ugc nofollow" target="_blank">â€”â€”å®ƒåº”è¯¥å›ç­”ä½ æ‰€æœ‰å…³äºç»†èŠ‚çš„é—®é¢˜ï¼Œæœ¬æ–‡ä¸­æ²¡æœ‰è§£é‡Šã€‚</a></p><h1 id="1d1b" class="kx ky iq bd kz la lb lc ld le lf lg lh jw li jx lj jz lk ka ll kc lm kd ln lo bi translated">å·¥å…·</h1><p id="5a12" class="pw-post-body-paragraph lp lq iq lr b ls lt jr lu lv lw ju lx ly lz ma mb mc md me mf mg mh mi mj mk ij bi translated">ä½œä¸ºé¢å¤–çš„å¥–åŠ±(ä¸è¦æ±‚ä½ ä½¿ç”¨æˆ–å­¦ä¹ )ï¼Œä½ å¯ä»¥æ‰¾åˆ°ç®¡é“å’ŒåŠ©æ‰‹ï¼Œå¦‚<code class="fe no np nq nf b">getTrackByFieldFn</code>æˆ–<code class="fe no np nq nf b">|itemStatus</code>ç®¡é“ã€‚</p><blockquote class="nr"><p id="34b9" class="ns nt iq bd nu nv nw nx ny nz oa mk dk translated">å¦‚æœè¿™ä¸ªåº“å¯¹ä½ æœ‰ç”¨ï¼Œæˆ‘ä¼šå¾ˆé«˜å…´çš„ï¼</p></blockquote></div></div>    
</body>
</html>