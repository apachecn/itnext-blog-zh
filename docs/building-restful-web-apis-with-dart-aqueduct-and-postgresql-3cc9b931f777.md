# ç”¨ Dartã€Aqueduct å’Œ PostgreSQL æ„å»º RESTful Web APIs ç¬¬ 1 éƒ¨åˆ†

> åŸæ–‡ï¼š<https://itnext.io/building-restful-web-apis-with-dart-aqueduct-and-postgresql-3cc9b931f777?source=collection_archive---------0----------------------->

![](img/06e8bbde0c96f1f6bf784142ca15afc5.png)

***è¯·æ³¨æ„:ä» Dart 2 å¼€å§‹ï¼Œå¯¼æ°´ç®¡çš„ API å‘ç”Ÿäº†å˜åŒ–ï¼Œå¯¼è‡´äº†é‡å¤§å˜åŒ–ã€‚æœ¬æ–‡åŸºäº Dart v1 çš„ Aqueduct 2.5.0ã€‚***

ã€http://bit.ly/aqueduct-tutorialã€‘[***æˆ‘å·²ç»æ›´æ–°äº†è¿™ä¸ªä½œä¸ºæ–°çš„è§†é¢‘ç³»åˆ—***](http://bit.ly/aqueduct-tutorial)

åœ¨è¿™ä¸ªå…³äºå¦ä¸€ä¸ª restful api æ•™ç¨‹(# yetanotherrat)çš„æ–°ç³»åˆ—ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢ Dart å¹³å°åŠå…¶åœ¨æ„å»ºæœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºæ–¹é¢çš„è´¡çŒ®ã€‚

ç»§æˆ‘ä¸Šä¸€ç¯‡æ¢ç´¢ Dart è¯­è¨€çš„æ–‡ç« ä¹‹åï¼Œæˆ‘è¿˜ç ”ç©¶äº†å¦‚ä½•ç”¨ Dart æ„å»º RESTful web æœåŠ¡ã€‚è¿›ä¸€æ­¥æŒ–æ˜ï¼Œæˆ‘å¶ç„¶å‘ç°äº† [**å¯¼æ°´ç®¡**](https://aqueduct.io) æ—çš„ç¨³ä»ã€‚æˆ‘ç¬¬ä¸€çœ¼çœ‹åˆ°å®ƒå·²ç»é€šè¿‡äº†ç¬¬ 2 ç‰ˆæ—¶å°è±¡æ·±åˆ»ï¼Œä¸€æ—¦æˆ‘å‘ç°æ–‡æ¡£å¾ˆå…¨é¢ï¼Œæœ‰æ˜“äºéµå¾ªçš„ç¤ºä¾‹ï¼Œæˆ‘å°±ç¡®ä¿¡è¦è¿›ä¸€æ­¥æ¢ç´¢ã€‚

åœ¨ç»å†äº†å¦‚æ­¤å¤šäº§å’Œä»¤äººè€³ç›®ä¸€æ–°çš„æ—¶é—´æ¥æµè§ˆå®ƒçš„æ–‡æ¡£å’Œè·Ÿéšä»–ä»¬çš„ä¾‹å­ä¹‹åï¼Œæˆ‘ç°åœ¨å¾ˆé«˜å…´å¸¦ä½ å’Œæˆ‘ä¸€èµ·è¸ä¸Šæ„å»ºä¸€ä¸ªä»å¤´åˆ°å°¾éƒ½å¯ä»¥å·¥ä½œçš„ api çš„æ—…ç¨‹ï¼

# é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯å¯¼æ°´ç®¡ï¼Ÿ

è¿™æ˜¯ä¸€ä¸ªå¼€æºæ¡†æ¶ï¼Œç”¨äºåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºå’Œéƒ¨ç½² RESTful web apisã€‚å®ƒä¸*å¿«è½¦*å’Œ*å“ˆæ¯”ç¥*ç”šè‡³*æœ‰ç€ç›¸ä¼¼çš„å‘³é“ã€‚NET Web APIï¼Œ*æä¾›äº†ä¸€ä¸ªå…·æœ‰å…¨é¢ç‰¹æ€§åˆ—è¡¨çš„å…¥å£ç‚¹ã€‚

æˆ‘æœ€å–œæ¬¢çš„æ˜¯:

1.  æµä½“ï¼Œå¯é“¾æ¥**è·¯çº¿**ã€‚*ç»„æˆä½ çš„è·¯çº¿çš„å‡½æ•°é£æ ¼åŠå…¶å¤„ç†æ–¹æ³•*
2.  ä¸€ä¸ª **CLI** å·¥å…·ã€‚*è¿™å…è®¸ä½ é€šè¿‡å‘å¸ƒå‘½ä»¤æ¥æ­å»ºä½ çš„ä¸‹ä¸€ä¸ªé¡¹ç›®*
3.  **å¼€ç®±å¤šçº¿ç¨‹**ã€‚*é€šè¿‡ Dart çš„â€œéš”ç¦»â€åŠ é€Ÿåº”ç”¨ç¨‹åºçš„å¤šä¸ªå®ä¾‹ï¼Œåœ¨æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰ CPU å†…æ ¸é—´æ‰©å±•ã€‚*
4.  å…·æœ‰å†…ç½®çš„**è¡¨å•**ã€‚å¦‚æœä½ ä½¿ç”¨å…³ç³»æ•°æ®åº“ï¼Œè¿™æ˜¯å¿…å¤‡çš„ï¼è¿˜æ”¯æŒæ•°æ®åº“è¿ç§»ã€‚
5.  æœ‰ä¸€ä¸ª**é›†æˆæµ‹è¯•**åº“ã€‚*å› ä¸ºä½ éœ€è¦æµ‹è¯•æ‰€æœ‰çš„ä¸œè¥¿ï¼ä¸ TravisCI ç­‰å·¥å…·é…åˆè‰¯å¥½ã€‚*

åœ¨æœ¬ç³»åˆ—ä¸­ï¼Œæˆ‘ä»¬å°†ä¸ºä¸ªäººé˜…è¯»åˆ—è¡¨(*å§‘ä¸”ç§°ä¹‹ä¸º* ***æ”¶è—å¤¹*** )æ„å»ºä¸€ä¸ª apiğŸ“š *)* ï¼Œæ¶µç›–è¿™äº›è¯é¢˜:

*   **ç¬¬ 1 éƒ¨åˆ†:è®¾ç½®å¹¶è¿è¡Œç¤ºä¾‹** ( *æˆ‘ä»¬åˆ°äº†*)
*   [**ç¬¬ 2 éƒ¨åˆ†:ç”¨ CRUD æ“ä½œå®ç°è·¯ç”±**](/building-restful-web-apis-with-dart-aqueduct-and-postgresql-part-2-routing-with-crud-operations-629fe58114fa)
*   [**ç¬¬ 3 éƒ¨åˆ†:å°† Web APIs è¿æ¥åˆ° PostgreSQL æ•°æ®åº“**](https://medium.com/@98d967ac6f3a/90ff70742675)
*   [**ç¬¬ 4 éƒ¨åˆ†:ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•**](/building-restful-web-apis-with-dart-aqueduct-and-postgresql-part-4-testing-de3618515639)
*   [***å¥–é‡‘å†…å®¹*** DB è¿ç§»å’Œæ¨¡å‹å…³ç³»](/building-restful-web-apis-with-dart-aqueduct-and-postgresql-bonus-content-2fc086b7259a)

![](img/72474ef0c1d3e1e4d68c20b48be28b55.png)

é€šè¿‡ [Giphy](https://giphy.com/gifs/door-wife-candles-GSrZUFaPs7yCs/fullscreen)

# è®¾ç½®å’Œè¿è¡Œç¤ºä¾‹

å¦‚æœä½ è¿˜æ²¡æœ‰ï¼Œæˆ‘å»ºè®®ä½ å®‰è£… Dart SDKã€‚æœ‰ Windowsï¼ŒMacï¼ŒLinux çš„ä½¿ç”¨è¯´æ˜ã€‚

æ‚¨å¯ä»¥é€šè¿‡æ£€æŸ¥ç»ˆç«¯æ¥ç¡®è®¤ Dart æ­£åœ¨è¿è¡Œ:

```
dart --version
```

Dart é™„å¸¦äº†ä¸€ä¸ªåä¸º **pub** çš„å·¥å…·æ¥ç®¡ç†å®ƒçš„åŒ…ã€‚è®©æˆ‘ä»¬ç”¨è¿™ä¸ªå·¥å…·æ¥å®‰è£…å¯¼æ°´ç®¡:

```
pub global activate aqueduct
```

è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿè®¿é—®å¯æ‰§è¡Œæ–‡ä»¶`aqueduct`ã€‚è½¬åˆ°æ‚¨çš„å·¥ä½œç›®å½•ï¼Œè®©æˆ‘ä»¬åˆ›å»ºæˆ‘ä»¬çš„é¡¹ç›®:

```
aqueduct create fave_reads && cd fave_reads
```

ç°åœ¨ï¼Œæ‚¨åº”è¯¥ä½äºåŒ…å«æ‰€æœ‰é¡¹ç›®æ–‡ä»¶çš„`fave_reads`ç›®å½•ä¸­ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨:

```
bin/
  main.dart
lib/
  fave_reads_sink.dart
pubspec.yaml
```

*   **bin/main.dart** *åˆ›å»ºæˆ‘ä»¬çš„æœåŠ¡å™¨å¹¶å¯åŠ¨ app*
*   **lib/fave _ reads _ sink . dart**s*ç”¨å®ƒçš„é…ç½®è®¾ç½®ä½ çš„åº”ç”¨*
*   **pubspec.yaml** *åŒ…å«å…³äºé¡¹ç›®çš„å…ƒæ•°æ®ã€‚ç±»ä¼¼äºæœ‰ä¸€ä¸ª package.json ç”¨äº Node.js å¼€å‘*

è®©æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯åŠ¨åº”ç”¨ç¨‹åº:

```
aqueduct serve # or `dart bin/main.dart`
```

æˆ‘ä»¬å¼€å§‹å§:

![](img/34ea00f7ebde803978ee260e9cd0a976.png)

æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªè¿è¡Œåœ¨`http://localhost:8081`çš„æœåŠ¡å™¨ï¼Œ`/example`æ˜¯å”¯ä¸€åˆ›å»ºçš„è·¯ç”±ã€‚è®¿é—®`http://localhost:8081/example`å°†è¿”å›å¦‚ä¸‹å“åº”:

```
{ "key": "value" }
```

åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œå€¼å¾—ä¸€æçš„æ˜¯ï¼ŒAqueduct æœ‰ä¸€ä¸ª RequestSink çš„æ¦‚å¿µï¼Œæ ¹æ®æ–‡æ¡£:

> å¤„ç†åº”ç”¨ç¨‹åºçš„åˆå§‹åŒ–ï¼ŒåŒ…æ‹¬è®¾ç½®è·¯ç”±ã€æˆæƒå’Œæ•°æ®åº“è¿æ¥ã€‚

åº”ç”¨ç¨‹åºéœ€è¦ä¸€ä¸ª`RequestSink`å­ç±»æ¥æ¥æ”¶è¯·æ±‚ã€‚æˆ‘ä»¬çš„ä¾‹å­æœ‰ä¸€ä¸ªæ‰©å±•åŸºç±»`RequestSink`çš„`FaveReadsSink`ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿç”¨è‡ªå·±çš„å®ç°è¦†ç›–å®ƒçš„æ–¹æ³•ã€‚å…·ä½“æ–¹æ³•æœ‰`setupRouter`å’Œ`willOpen`ã€‚ç¬¬ä¸€ç§æ–¹æ³•å°†å…è®¸æˆ‘ä»¬å®šä¹‰ä¸ç›¸å…³æ§åˆ¶å™¨å’Œå…¶ä»–ä¸­é—´ä»¶çš„è·¯ç”±ï¼Œè€Œåè€…å…è®¸æˆ‘ä»¬åœ¨è·¯ç”±å»ºç«‹ä¹‹åå’Œåº”ç”¨ç¨‹åºæ¥æ”¶è¯·æ±‚ä¹‹å‰æ‰§è¡Œä»»ä½•å¼‚æ­¥åˆå§‹åŒ–ã€‚

å¯¹äºå½“å‰è¯·æ±‚ï¼Œé»˜è®¤å“åº”ç±»å‹è®¾ç½®ä¸º JSONã€‚ç„¶è€Œï¼Œè¿™å¯ä»¥è¢«è®¾ç½®ä¸ºé€‚åˆæ»¡è¶³æˆ‘ä»¬éœ€æ±‚çš„ä»»ä½•å†…å®¹ç±»å‹ã€‚

è®©æˆ‘ä»¬é€šè¿‡åœ¨ setupRouter æ–¹æ³•ä¸­åˆ›å»ºç¬¬äºŒä¸ªè·¯ç”±æ¥æ¼”ç¤ºè¿™ä¸€ç‚¹:

```
router.route('/').listen((request) async {
  return new Response.ok('Hello world')
    ..**contentType = ContentType.TEXT**;
});
```

ä½¿ç”¨æ–¹æ³•çº§è”ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå°† contentType å±æ€§è®¾ç½®ä¸º`text/plain`ã€‚`ContentType`å·¥å…·è‡ªå¸¦[é£é•–](https://api.dartlang.org/stable/1.24.3/dart-io/ContentType-class.html)ï¼Œå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼ä½¿ç”¨:

```
new ContentType(primaryType, subType, {String charset, Map parameters});
```

å®ƒå·²ç»æœ‰äº† HTMLã€JSON å’Œ TEXT çš„å¸¸é‡ï¼Œæ‰€ä»¥åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä½ åº”è¯¥ä½¿ç”¨å®ƒä»¬ã€‚

ç°åœ¨ï¼Œé€šè¿‡ç»ˆæ­¢å½“å‰è¿›ç¨‹å¹¶å†æ¬¡è¿è¡Œ`aqueduct serve`æ¥é‡å¯æœåŠ¡å™¨ã€‚è®¿é—®æ ¹è·¯å¾„åº”è¯¥ä¼šå¾—åˆ°ä»¥ä¸‹ç»“æœ:

![](img/ccce58444016a4ae9eb4350eef853a73.png)

ç­”å¯¹äº†ã€‚

åœ¨æ€»ç»“ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å°†åº”ç”¨å®ä¾‹æ‰©å±•åˆ°æˆ‘ä»¬æ‹¥æœ‰çš„å†…æ ¸æ•°é‡ã€‚åœ¨ **bin/main.dart** ä¸­ï¼Œå½“`app.start`è¢«è°ƒç”¨æ—¶ï¼Œå½“å‰è®¾ç½®ä¸º 2:

```
await app.start(numberOfInstances: **2**);
```

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†ä»â€œdart:ioâ€åº“ä¸­å¯¼å…¥ Dart çš„ [**å¹³å°**](https://api.dartlang.org/stable/1.24.3/dart-io/Platform-class.html) ç±»ï¼Œå¹¶å°† **main.dart** ä¿®æ”¹å¦‚ä¸‹:

```
import **'dart:io'** show **Platform**;Future main() async {
  ...
  ...
  await app.start(numberOfInstances: **Platform.numberOfProcessors**);
  ...
}
```

# VS ä»£ç çš„ä¸€äº›å¼€å‘æŠ€å·§ğŸ‘ˆ

é¦–å…ˆï¼Œç¡®ä¿é€šè¿‡ Dart ä»£ç å®‰è£… [**Dart**](https://marketplace.visualstudio.com/items?itemName=Dart-Code.dart-code) æ‰©å±•ï¼Œä»¥å¯ç”¨ Dart å’Œé¢¤æŒ¯æ”¯æŒã€‚

å…¶æ¬¡ï¼Œä½¿ç”¨ä»¥ä¸‹è®¾ç½®ä¸º Dart æ·»åŠ å¯åŠ¨é…ç½®:

```
{
  "name": "Dart",
  "type": "dart",
  "request": "launch",
  "program": "${workspaceFolder}/bin/main.dart"
}
```

è¿™å°†å…è®¸æ‚¨é€šè¿‡ VS ä»£ç è¿è¡Œåº”ç”¨ç¨‹åºï¼Œå¹¶èƒ½å¤Ÿæ·»åŠ æ–­ç‚¹æ¥å¸®åŠ©è°ƒè¯•:

![](img/31b604ea820b41afe914a4754a5d1463.png)

æœ¬ç³»åˆ—çš„ç¬¬ 1 éƒ¨åˆ†åˆ°æ­¤ç»“æŸã€‚æºä»£ç [åœ¨ github](https://github.com/graphicbeacon/favereads) ä¸Šå¯ç”¨ï¼Œè€Œ [Part 2](/building-restful-web-apis-with-dart-aqueduct-and-postgresql-part-2-routing-with-crud-operations-629fe58114fa) ç°åœ¨ä¹Ÿå¯ç”¨ã€‚**å¦‚æœæ‚¨å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·å–œæ¬¢å¹¶å…³æ³¨æˆ‘**äº†è§£æ›´å¤šå…³äº Dart çš„å†…å®¹ã€‚

# è¿›ä¸€æ­¥é˜…è¯»

1.  [æ¸¡æ§½æ–‡ä»¶](https://aqueduct.io/docs/)
2.  [å¼€å§‹ä½¿ç”¨ Pub](https://www.dartlang.org/tools/pub/get-started)
3.  [Joe Conway åœ¨ 2016 å¹´ Dart å¼€å‘è€…å³°ä¼šä¸Šçš„æ¼”è®²](https://www.youtube.com/watch?v=twr3cDFCeo4)