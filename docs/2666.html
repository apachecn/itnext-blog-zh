<html>
<head>
<title>Deploying a Vue + AdonisJS monorepo to Heroku via Gitlab CI/CD</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">é€šè¿‡Gitlab CI/CDå°†Vue + AdonisJS monorepoéƒ¨ç½²åˆ°Heroku</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/deploying-a-vue-adonisjs-monorepo-to-heroku-via-gitlab-ci-cd-a4d87b31c20?source=collection_archive---------3-----------------------#2019-07-07">https://itnext.io/deploying-a-vue-adonisjs-monorepo-to-heroku-via-gitlab-ci-cd-a4d87b31c20?source=collection_archive---------3-----------------------#2019-07-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="650b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¿™ä¹ˆé•¿çš„æ ‡é¢˜å§ï¼Ÿå¾ˆéš¾ç”¨å‡ å¥è¯æ¥è¡¨è¾¾è¿™ä¸€åˆ‡ï¼</p><h1 id="eb52" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">ä¸ºä»€ä¹ˆæ˜¯monorepoï¼Ÿ</h1><p id="6d17" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">æˆ‘ä»¬åœ¨æˆ‘çš„å·¥ä½œåœºæ‰€ç»å¸¸ä½¿ç”¨monoreposã€‚å¦‚æœä½ ä½¿ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œä¿æŒæ‰€æœ‰çš„é¡¹ç›®éƒ½æ˜¯æœ€æ–°çš„ä¼šæ›´å®¹æ˜“ã€‚å®ƒä»¬é€šå¸¸ä¸dockeræ†ç»‘åœ¨ä¸€èµ·ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“è¿è¡Œï¼Œä½ ä¹Ÿä¸å¿…æ‹…å¿ƒä¸‹è½½å’Œæ€»æ˜¯æ”¶åˆ°æ–°çš„å›å¤ã€‚æˆ‘çš„ä¸ªäººmonorepoè¿˜æ²¡åˆ°é‚£ä¸€æ­¥(æˆ‘æ˜¯Docker noobï¼Œæˆ–è€…ä¸€èˆ¬æ¥è¯´æ˜¯DevOps noob)ï¼Œæ‰€ä»¥æˆ‘æœ‰ä¸¤ä¸ªé¡¹ç›®åœ¨é‡Œé¢ã€‚</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="9a1a" class="lz km iq bd kn ma mb dn kr mc md dp kv jy me mf kz kc mg mh ld kg mi mj lh mk bi translated">é€æ­¥åœ°</h2><p id="bc14" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">æˆ‘çš„å­˜å‚¨åº“ç»“æ„å¦‚ä¸‹æ‰€ç¤º</p><pre class="ml mm mn mo gt mp lr mq mr aw ms bi"><span id="0d04" class="lz km iq lr b gy mt mu l mv mw">/my-app<br/>  .gitlab-ci.yml</span><span id="0c36" class="lz km iq lr b gy mx mu l mv mw">  /frontend<br/>    .gitlab-ci.yml</span><span id="faf0" class="lz km iq lr b gy mx mu l mv mw">  /api<br/>    .gitlab-ci.yml</span></pre><p id="fa3e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å…¶ä¸­â€œmy-appâ€æ˜¯æ ¹æ–‡ä»¶å¤¹ï¼Œâ€œfrontendâ€æ–‡ä»¶å¤¹æ˜¯ç”¨<a class="ae my" href="https://cli.vuejs.org/" rel="noopener ugc nofollow" target="_blank"> Vue CLI </a>ç”Ÿæˆçš„Vue.js appï¼Œâ€œapiâ€æ–‡ä»¶å¤¹æ˜¯ç”¨<a class="ae my" href="https://github.com/adonisjs/adonis-cli" rel="noopener ugc nofollow" target="_blank"> AdonisJS CLI </a>ç”Ÿæˆçš„AdonisJS (Node.js) appã€‚æˆ‘å°†å‘æ‚¨å±•ç¤ºä¸‹é¢æ‰€æœ‰å¿…éœ€æ–‡ä»¶ä¸­çš„ä»£ç ã€‚</p><p id="fc1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å°è¯•monorepoæ–¹æ³•å’Œç¼–å†™CI/CDæ–‡ä»¶ï¼Œæ‰€ä»¥è®©æˆ‘æé†’æ‚¨:<strong class="jp ir">é…ç½®çš„ç¼–å†™æ–¹å¼å¯èƒ½ä¸æ˜¯æœ€ä½³å®è·µã€‚æˆ‘ä»å„ç§èµ„æºä¸­æ”¶é›†ä¿¡æ¯ï¼Œä¸€æ­¥ä¸€æ­¥åœ°å°è¯•è®©ä¸€åˆ‡éƒ½å·¥ä½œèµ·æ¥ã€‚</strong></p><p id="a4e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">åœ¨æˆ‘å‘æ‚¨ä»‹ç»æˆ‘çš„<code class="fe lo lp lq lr b">.gitlab-ci.yml</code>é…ç½®ä¹‹å‰ï¼Œæˆ‘æƒ³æä¸€ä¸‹è®©æˆ‘èµ°åˆ°ä»Šå¤©è¿™ä¸€æ­¥çš„æ‰€æœ‰æ¥æº:</p><ul class=""><li id="d416" class="mz na iq jp b jq jr ju jv jy nb kc nc kg nd kk ne nf ng nh bi translated"><a class="ae my" href="https://medium.com/netscape/deploying-a-vue-js-2-x-app-to-heroku-in-5-steps-tutorial-a69845ace489" rel="noopener">é€šè¿‡5ä¸ªæ­¥éª¤è½»æ¾å°†Vue + Webpackåº”ç”¨éƒ¨ç½²åˆ°Herokuã€æ•™ç¨‹ã€‘</a>å°¼å…‹Â·æ›¼å®</li><li id="5a60" class="mz na iq jp b jq ni ju nj jy nk kc nl kg nm kk ne nf ng nh bi translated"><a class="ae my" href="https://scotch.io/tutorials/deploying-adonisjs-apps-to-heroku" rel="noopener ugc nofollow" target="_blank">å°†AdonisJSåº”ç”¨éƒ¨ç½²åˆ°Heroku</a>Chimezie Enyinnaya</li><li id="3caa" class="mz na iq jp b jq ni ju nj jy nk kc nl kg nm kk ne nf ng nh bi translated"><a class="ae my" href="https://medium.com/@ben_40478/auto-deploy-a-web-app-vue-js-app-with-gitlab-to-heroku-541490f853b0" rel="noopener">ä½¿ç”¨Gitlabå°†Web-App / Vue.jsåº”ç”¨ç¨‹åºè‡ªåŠ¨éƒ¨ç½²åˆ°Heroku </a>ç”±Ben Dengerå¼€å‘</li><li id="ea6e" class="mz na iq jp b jq ni ju nj jy nk kc nl kg nm kk ne nf ng nh bi translated"><a class="ae my" href="https://medium.com/@seulkiro/deploy-node-js-app-with-gitlab-ci-cd-214d12bfeeb5" rel="noopener">ä½¿ç”¨Seulkiro Parkçš„GitLab CI/CD </a>éƒ¨ç½²Node.jsåº”ç”¨ç¨‹åº</li></ul><p id="752f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¯¹äºé‚£äº›ä¸çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆçš„äºº(å¾ˆåƒæˆ‘)æ¥è¯´ï¼Œé˜…è¯»è¿™äº›å¯èƒ½æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹ğŸ˜).æˆ‘ä»¬éƒ½å¾—ä»æŸä¸ªåœ°æ–¹å¼€å§‹ï¼Œå¯¹å—ï¼Ÿ</p><figure class="ml mm mn mo gt no gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/161c65b446fc51dc54bc24a2d9be455c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*Zk0vgA0svfsR-Ev--N1Row.jpeg"/></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated"><a class="ae my" href="https://memegenerator.net/instance/45801509/chemistry-dog-2-i-have-no-idea-what-im-doing" rel="noopener ugc nofollow" target="_blank">https://meme generator . net/instance/45801509/chemistry-dog-2-I-have-no-idea-im-do</a></figcaption></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="b45b" class="kl km iq bd kn ko nv kq kr ks nw ku kv kw nx ky kz la ny lc ld le nz lg lh li bi translated">æ ¹<code class="fe lo lp lq lr b">.gitlab-ci.yml</code></h1><p id="3ba5" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">æˆ‘æŠŠæˆ‘çš„app rootå«åš<code class="fe lo lp lq lr b">my-app</code>ã€‚è¿™ä¹Ÿæ˜¯æˆ‘åœ¨é‡Œé¢è¿è¡Œ<code class="fe lo lp lq lr b">git init</code>å¹¶æ¨é€åˆ°æˆ‘çš„Gitlabè´¦æˆ·çš„æ–‡ä»¶å¤¹ã€‚</p><p id="4e57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘çš„æ ¹æ–‡ä»¶çœ‹èµ·æ¥åƒè¿™æ ·</p><pre class="ml mm mn mo gt mp lr mq mr aw ms bi"><span id="71f9" class="lz km iq lr b gy mt mu l mv mw"><strong class="lr ir">stages</strong>:<br/>  - dependencies<br/>  - build<br/>  - deploy<br/><br/><strong class="lr ir">include</strong>:<br/>  - <strong class="lr ir">'/frontend/.gitlab-ci.yml'<br/>  </strong>- <strong class="lr ir">'/api/.gitlab-ci.yml'</strong></span></pre><p id="2c20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¾ˆç®€å•ï¼Œå¯¹å§ï¼Ÿ</p><p id="d2f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬åœ¨è¿™é‡Œè¯´çš„æ˜¯:â€œå˜¿ï¼Œæˆ‘ä»¬å°†è¿™æ ·åš:æˆ‘ä»¬å°†å®‰è£…<strong class="jp ir">ä¾èµ–é¡¹</strong>ï¼Œæˆ‘ä»¬å°†è¿è¡Œ<strong class="jp ir">æ„å»º</strong>ï¼Œç„¶åæˆ‘ä»¬å°†<strong class="jp ir">éƒ¨ç½²</strong>å‰©ä¸‹çš„éƒ¨åˆ†â€ã€‚è¿™äº›æ˜¯å…¶ä»–é“¾æ¥æ–‡ä»¶å°†è¿è¡Œçš„é˜¶æ®µã€‚</p><p id="eef2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬ä¹Ÿåœ¨è¯´:â€œä½ è¿˜æ²¡æœ‰å®Œæˆï¼çœ‹çœ‹<code class="fe lo lp lq lr b">/frontend/.gitlab-ci.yml</code>å’Œ<code class="fe lo lp lq lr b">/api/.gitlab-ci.yml</code></p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="fae9" class="kl km iq bd kn ko nv kq kr ks nw ku kv kw nx ky kz la ny lc ld le nz lg lh li bi translated">/å‰ç«¯<code class="fe lo lp lq lr b">.gitlab-ci.yml</code></h1><pre class="ml mm mn mo gt mp lr mq mr aw ms bi"><span id="5507" class="lz km iq lr b gy mt mu l mv mw"><strong class="lr ir">'UI dependencies'</strong>:<br/>  <strong class="lr ir">image</strong>: node:8.15-alpine<br/>  <strong class="lr ir">stage</strong>: dependencies<br/>  <strong class="lr ir">only</strong>:<br/>    <strong class="lr ir">changes</strong>:<br/>      - frontend/**/*<br/>      - .gitlab-ci.yml<br/>  <strong class="lr ir">artifacts</strong>:<br/>    <strong class="lr ir">paths</strong>:<br/>      - frontend/node_modules/<br/>  <strong class="lr ir">dependencies</strong>: []<br/>  <strong class="lr ir">script</strong>:<br/>    - cd frontend<br/>    - npm install<br/><br/><strong class="lr ir">'UI build'</strong>:<br/>  <strong class="lr ir">image</strong>: node:8.15-alpine<br/>  <strong class="lr ir">stage</strong>: build<br/>  <strong class="lr ir">only</strong>:<br/>    <strong class="lr ir">changes</strong>:<br/>      - frontend/**/*<br/>      - .gitlab-ci.yml<br/>  <strong class="lr ir">artifacts</strong>:<br/>    <strong class="lr ir">paths</strong>:<br/>      - frontend/dist/<br/>  <strong class="lr ir">dependencies</strong>:<br/>    - <strong class="lr ir">'UI dependencies'<br/>  script</strong>:<br/>    - cd frontend<br/>    - npm run build<br/><br/><strong class="lr ir">'UI deploy'</strong>:<br/>  <strong class="lr ir">stage</strong>: deploy<br/>  <strong class="lr ir">image</strong>: <strong class="lr ir">"ruby:2.5"<br/>  script</strong>:<br/>    - apt-get update -qy<br/>    - apt-get install rubygems ruby-dev -y<br/>    - gem install dpl<br/>    - cd frontend<br/>    - dpl --provider=heroku --app=$HEROKU_FRONTEND --api-key=$HEROKU_API_KEY --skip_cleanup<br/>  <strong class="lr ir">only</strong>:<br/>    <strong class="lr ir">changes</strong>:<br/>      - frontend/**/*<br/>      - .gitlab-ci.yml</span></pre><p id="fcf7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¿™ä¸ªç¨å¾®é•¿ä¸€ç‚¹ã€‚æˆ‘ä»¬æ­£åœ¨åˆ©ç”¨æˆ‘ä»¬å®šä¹‰çš„æ‰€æœ‰3ä¸ªé˜¶æ®µ:ä¾èµ–ã€æ„å»ºå’Œéƒ¨ç½²ã€‚</p><ul class=""><li id="d921" class="mz na iq jp b jq jr ju jv jy nb kc nc kg nd kk ne nf ng nh bi translated">åœ¨<strong class="jp ir"> <em class="oa">ä¾èµ–</em> </strong>çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šæ˜¯è¿è¡Œ<code class="fe lo lp lq lr b">npm install</code>ã€‚æˆ‘ä»¬è¿˜å®šä¹‰äº†ä½•æ—¶è§¦å‘æ‰€è¿°é˜¶æ®µ(â€œå˜æ›´â€éƒ¨åˆ†)ã€‚æ³¨æ„<code class="fe lo lp lq lr b">cd frontend</code>ã€‚å› ä¸ºæˆ‘ä»¬ä¸æ˜¯åœ¨å¤„ç†ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»éå¸¸å°å¿ƒåœ°æ­£ç¡®è®¾ç½®è·¯å¾„ã€‚</li><li id="4ab2" class="mz na iq jp b jq ni ju nj jy nk kc nl kg nm kk ne nf ng nh bi translated">åœ¨<strong class="jp ir"> <em class="oa">æ„å»º</em> </strong>éƒ¨åˆ†ï¼Œæˆ‘ä»¬å‡ ä¹åœ¨åšåŒæ ·çš„äº‹æƒ…ï¼Œä½†æ˜¯æˆ‘ä»¬è¿è¡Œçš„æ˜¯<code class="fe lo lp lq lr b">npm run build</code>ã€‚æˆ‘ä»¬å¿…é¡»å†æ¬¡<code class="fe lo lp lq lr b">cd</code>è®©æˆ‘ä»¬çš„è„šæœ¬å·¥ä½œã€‚è¯·æ³¨æ„<strong class="jp ir">å·¥ä»¶</strong>éƒ¨åˆ†ï¼Œè¿™å¯¹æˆ‘æ¥è¯´æœ‰ç‚¹ç¥å¥‡â€”â€”æ­£å¦‚æˆ‘æ‰€è¯´ï¼Œæˆ‘å…³æ³¨çš„æ˜¯åœ¨è¿™æ–¹é¢å¾ˆå¯èƒ½æ¯”æˆ‘æ›´æœ‰ç»éªŒçš„äººçš„æ–‡ç« ã€‚å®ƒå‘Šè¯‰é…ç½®æˆ‘ä»¬(æ„å»ºçš„)åº”ç”¨ç¨‹åºçš„ç¡®åˆ‡ä½ç½®ã€‚</li><li id="f332" class="mz na iq jp b jq ni ju nj jy nk kc nl kg nm kk ne nf ng nh bi translated">æœ€åä¸€éƒ¨åˆ†æ˜¯<strong class="jp ir"> <em class="oa">éƒ¨ç½²</em> </strong>ã€‚å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘ä»¬æ­£åœ¨è¿›è¡Œå®é™…çš„herokuéƒ¨ç½²ï¼Œè¿™å–å†³äºä¸¤ä¸ªå¤–éƒ¨å˜é‡â€” <code class="fe lo lp lq lr b">$HEROKU_FRONTEND</code>å’Œ<code class="fe lo lp lq lr b">$HEROKU_API_KEY</code>ã€‚</li></ul><p id="0a7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe lo lp lq lr b">$HEROKU_FRONTEND</code>æ˜¯æˆ‘çš„Herokuåº”ç”¨ç¨‹åºçš„åç§°ï¼Œæˆ‘åœ¨å…¶ä¸­æä¾›å‰ç«¯åº”ç”¨ç¨‹åºã€‚å˜é‡å€¼åœ¨æˆ‘çš„<strong class="jp ir"> Gitlab - &gt;è®¾ç½®- &gt; CI/CD - &gt;å˜é‡</strong>ä¸­å®šä¹‰ã€‚æˆ‘çš„<code class="fe lo lp lq lr b">$HEROKU_API_KEY</code>ä¹Ÿæ˜¯ã€‚</p><figure class="ml mm mn mo gt no gh gi paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><div class="gh gi ob"><img src="../Images/71d807d34e66f6030a279b952dafe36c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w27ISJk4HwPHpGeawe4R4A.png"/></div></div></figure><p id="b68f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¯·æ³¨æ„ï¼Œè¿™äº›æ­¥éª¤çš„è°ƒç”¨æ–¹å¼ä¹Ÿå¾ˆå¥½ï¼Œæ¯”å¦‚â€œUIä¾èµ–â€æˆ–â€œUIæ„å»ºâ€ã€‚è¿™æ ·æˆ‘ä»¬å°±èƒ½æ¸…æ¥šåœ°çœ‹åˆ°Gitlabä¸­å‘ç”Ÿäº†ä»€ä¹ˆ:</p><figure class="ml mm mn mo gt no gh gi paragraph-image"><div class="gh gi og"><img src="../Images/5bc5c7619d37cdb49875730b7f183214.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*ncEJwWw_5eOZQtU2Omk44g.png"/></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated">äººä»¬å¾€å¾€çœ‹ä¸åˆ°1æ¬¡æˆåŠŸèƒŒåçš„100æ¬¡å¤±è´¥</figcaption></figure><p id="3a0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä¸ºäº†ç»™åº”ç”¨ç¨‹åºæä¾›æœåŠ¡ï¼Œæˆ‘åœ¨æˆ‘çš„<code class="fe lo lp lq lr b">/frontend</code>ç›®å½•çš„æ ¹ç›®å½•ä¸‹è¿˜æœ‰ä¸€ä¸ª<code class="fe lo lp lq lr b">server.js</code>æ–‡ä»¶ï¼Œçœ‹èµ·æ¥åƒè¿™ä¸ª<em class="oa">(ä½ å¯ä»¥åœ¨æè¿°å¦‚ä½•å°†Vueåº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°Herokuçš„æ–‡ç« ä¸­äº†è§£æ›´å¤šç»†èŠ‚)</em>ã€‚æ®æˆ‘æ‰€çŸ¥ï¼Œè¿™ä¸ª(server.js)å°±æ˜¯Herokuåœ¨ä½¿ç”¨Nodeæ—¶è‡ªåŠ¨å¯»æ‰¾çš„æ–‡ä»¶ã€‚</p><pre class="ml mm mn mo gt mp lr mq mr aw ms bi"><span id="dccc" class="lz km iq lr b gy mt mu l mv mw"><strong class="lr ir">const express </strong>= <em class="oa">require</em>(<strong class="lr ir">'express'</strong>)<br/><strong class="lr ir">const </strong>serveStatic = <em class="oa">require</em>(<strong class="lr ir">'serve-static'</strong>)<br/><strong class="lr ir">const </strong>path = <em class="oa">require</em>(<strong class="lr ir">'path'</strong>)<br/><br/><strong class="lr ir">const </strong>app = <strong class="lr ir">express</strong>()<br/>app.use(<strong class="lr ir">'/'</strong>, serveStatic(path.<em class="oa">join</em>(<strong class="lr ir"><em class="oa">__dirname</em></strong>, <strong class="lr ir">'/dist'</strong>)))<br/><br/><strong class="lr ir">const </strong>port = <strong class="lr ir"><em class="oa">process</em></strong>.<strong class="lr ir">env</strong>.<strong class="lr ir">PORT </strong>|| 5000<br/>app.listen(port)<br/><br/><strong class="lr ir"><em class="oa">console</em></strong>.log(<strong class="lr ir">'Server started on port ' </strong>+ port)</span></pre><p id="9606" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä½ éœ€è¦<code class="fe lo lp lq lr b">server.js</code>å’Œ<code class="fe lo lp lq lr b">.gitlab-ci.yml</code>ä¸¤ä¸ªæ–‡ä»¶æ¥è¿è¡Œä½ çš„Vue.jsåº”ç”¨ã€‚</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="99c2" class="kl km iq bd kn ko nv kq kr ks nw ku kv kw nx ky kz la ny lc ld le nz lg lh li bi translated">/api <code class="fe lo lp lq lr b">.gitlab-ci.yml</code></h1><p id="c34f" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">è¿™ä¸ªæ²¡é‚£ä¹ˆå¯æ€•:</p><pre class="ml mm mn mo gt mp lr mq mr aw ms bi"><span id="c280" class="lz km iq lr b gy mt mu l mv mw"><strong class="lr ir">'API deploy'</strong>:<br/>  <strong class="lr ir">stage</strong>: deploy<br/>  <strong class="lr ir">image</strong>: <strong class="lr ir">"ruby:2.5"<br/>  script</strong>:<br/>    - apt-get update -qy<br/>    - apt-get install rubygems ruby-dev -y<br/>    - gem install dpl<br/>    - cd api<br/>    - dpl --provider=heroku --app=$HEROKU_API --api-key=$HEROKU_API_KEY --skip_cleanup<br/>  <strong class="lr ir">only</strong>:<br/>    <strong class="lr ir">changes</strong>:<br/>      - api/**/*<br/>      - .gitlab-ci.yml</span></pre><p id="a9d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¿™é‡Œæˆ‘ä»¬éœ€è¦è¿è¡Œçš„å”¯ä¸€é˜¶æ®µæ˜¯<strong class="jp ir">éƒ¨ç½²</strong>é˜¶æ®µã€‚æˆ‘çš„ç†è§£æ˜¯Herokuè‡ªå·±åš<code class="fe lo lp lq lr b">npm install</code>å¹¶å¯»æ‰¾<code class="fe lo lp lq lr b">server.js</code>æ–‡ä»¶(æˆ‘å¯èƒ½æ˜¯é”™çš„ï¼Œå› ä¸ºæˆ‘è¯´è¿‡è®©å®ƒå·¥ä½œæ›´å¤šçš„æ˜¯å®éªŒè€Œä¸æ˜¯çŸ¥è¯†ğŸ˜…)</p><p id="01b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å†æ¬¡æ³¨æ„<code class="fe lo lp lq lr b">cd api</code>ã€‚æˆ‘ä»¬å¿…é¡»ç¡®ä¿æˆ‘ä»¬åœ¨æ­£ç¡®çš„æ–‡ä»¶å¤¹ä¸­ã€‚</p><p id="af3e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬è¿˜ä½¿ç”¨äº†å¦ä¸€ä¸ªåä¸º<code class="fe lo lp lq lr b">$HEROKU_API</code>çš„å˜é‡ï¼Œå®ƒä¹Ÿåœ¨æˆ‘çš„<strong class="jp ir"> Gitlab - &gt;è®¾ç½®- &gt; CI/CD - &gt;å˜é‡</strong>ä¸­è¿›è¡Œäº†å®šä¹‰ã€‚è¿™æ˜¯ç‹¬ç«‹äºå‰ç«¯åº”ç”¨ç¨‹åºçš„APIåº”ç”¨ç¨‹åºåç§°ã€‚</p><p id="22d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">My <code class="fe lo lp lq lr b">server.js</code>æ˜¯AdonisJS CLIç”Ÿæˆçš„ä¼ ç»Ÿæ–‡ä»¶ï¼Œå¢åŠ äº†WebSocketsã€‚è¿™åº”è¯¥ä¼šè‡ªåŠ¨ä½äºæ‚¨çš„ç›®å½•ä¸­ã€‚</p><pre class="ml mm mn mo gt mp lr mq mr aw ms bi"><span id="59d1" class="lz km iq lr b gy mt mu l mv mw"><strong class="lr ir">'use strict'<br/><br/>const </strong>{ Ignitor } = require(<strong class="lr ir">'@adonisjs/ignitor'</strong>)<br/><br/><strong class="lr ir">new </strong>Ignitor(require(<strong class="lr ir">'@adonisjs/fold'</strong>))<br/>  .appRoot(__dirname)<br/>  .wsServer()<br/>  .fireHttpServer()<br/>  .catch(<strong class="lr ir"><em class="oa">console</em></strong>.error)</span></pre><p id="9bb4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘çš„<code class="fe lo lp lq lr b">/api</code>æ–‡ä»¶å¤¹é‡Œè¿˜æœ‰ä¸€ä¸ª<code class="fe lo lp lq lr b">Procfile</code>ï¼Œå†…å®¹å¦‚ä¸‹:</p><pre class="ml mm mn mo gt mp lr mq mr aw ms bi"><span id="7bff" class="lz km iq lr b gy mt mu l mv mw">// Procfile<br/><br/>release: ENV_SILENT=true node ace migration:run --force<br/>web: ENV_SILENT=true npm start</span></pre><p id="63ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ‚¨å¯ä»¥åœ¨å°†AdonisJSåº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°Herokuæ–‡ç« ä¸­äº†è§£æ›´å¤šä¿¡æ¯ã€‚</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="8bb8" class="kl km iq bd kn ko nv kq kr ks nw ku kv kw nx ky kz la ny lc ld le nz lg lh li bi translated">æ”¶åœºç™½</h1><p id="7249" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">å¦‚æœä¸æ¸…æ¥šçš„è¯ï¼Œæˆ‘è¿è¡Œä¸¤ä¸ªHerokuåº”ç”¨ç¨‹åºâ€”â€”ä¸€ä¸ªç”¨äºAPIï¼Œä¸€ä¸ªç”¨äºå‰ç«¯ã€‚å®ƒä»¬çš„åå­—æ˜¯å˜é‡<code class="fe lo lp lq lr b">$HEROKU_FRONTEND</code>å’Œ<code class="fe lo lp lq lr b">$HEROKU_API</code>ã€‚ä½ å¯ä»¥åœ¨ä½ çš„Heroku <strong class="jp ir">è´¦å·- &gt;è®¾ç½®- &gt; API key </strong>ä¸­æ‰¾åˆ°<code class="fe lo lp lq lr b">$HEROKU_API_KEY</code>ã€‚ç”±äºè¿™æ˜¯æ¯ä¸ªå¸æˆ·å”¯ä¸€çš„ï¼Œå¦‚æœä½ çš„åº”ç”¨ç¨‹åºåœ¨åŒä¸€ä¸ªå¸æˆ·ä¸‹ï¼Œä½ ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ã€‚</p><p id="b5e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ‚¨å¯ä»¥åœ¨<a class="ae my" href="https://gitlab.com/djanoskova/my-app" rel="noopener ugc nofollow" target="_blank">https://gitlab.com/djanoskova/my-app</a>æ‰¾åˆ°æ†ç»‘çš„é…ç½®ã€‚</p><p id="c94d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è®¾ç½®è¿™æ ·çš„ä¸œè¥¿éœ€è¦åšå¤§é‡çš„å·¥ä½œï¼Œå¹¶ä¸”éœ€è¦ç­‰å¾…ç®¡é“æˆåŠŸ(æˆ–è€…å¤±è´¥ï¼Ÿ).å¦‚æœä½ æœ‰ä¸€ä¸ªmonorepoå’Œæˆ‘çš„å †æ ˆç±»ä¼¼ï¼Œå¹¶ä¸”ä½ ä¹Ÿæ˜¯ä¸€ä¸ªåˆå­¦è€…ï¼Œæˆ‘å¸Œæœ›æˆ‘èƒ½å‡è½»ä½ çš„è´Ÿæ‹…ã€‚</p><p id="be2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¦‚æœæœ‰ä»€ä¹ˆäº‹æƒ…å¯¹ä½ ä¸èµ·ä½œç”¨ï¼Œä¸è¦çŠ¹è±«ï¼Œé—®æˆ‘ï¼Œæˆ‘ä¼šå°½åŠ›å¸®åŠ©ä½ ã€‚é€šè¯»è¿™äº›æ–‡ç« ä¹Ÿèƒ½è®©ä½ æ€è·¯æ¸…æ™°ã€‚æœ€åï¼Œä¸è¦å¿˜è®°å¯¹ä½ æ‰€é˜…è¯»çš„å†…å®¹è¿›è¡Œç¼–ç â€”â€”åŠ¨æ‰‹ä½“éªŒæ˜¯æœ€é‡è¦çš„ã€‚</p></div></div>    
</body>
</html>