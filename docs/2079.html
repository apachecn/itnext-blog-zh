<html>
<head>
<title>React Hooks â€” designing a simple forms API â€” part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Reacté’©å­â€”â€”è®¾è®¡ç®€å•çš„è¡¨å•APIâ€”â€”ç¬¬2éƒ¨åˆ†</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/react-hooks-designing-a-simple-forms-api-part-2-1fe5d12f23d9?source=collection_archive---------3-----------------------#2019-03-27">https://itnext.io/react-hooks-designing-a-simple-forms-api-part-2-1fe5d12f23d9?source=collection_archive---------3-----------------------#2019-03-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="8164" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨æœ¬ç³»åˆ—çš„ç¬¬1éƒ¨åˆ†<a class="ae ko" href="https://medium.com/@shanplourde/react-hooks-designing-a-simple-forms-api-part-1-307b04bc6007" rel="noopener">ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº†å¦‚ä½•ä½¿ç”¨Reacté’©å­æ¥è®¾è®¡ä¸€ä¸ª<code class="fe kp kq kr ks b">useForm</code> Reactè¡¨å•åº“ã€‚ç¬¬1éƒ¨åˆ†ä»‹ç»äº†è¿™ä¸ªåº“çš„åŠ¨æœºå’Œä¸€äº›æ€»ä½“è®¾è®¡ç›®æ ‡ã€‚</a></p><p id="b83f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨ç¬¬2éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª<code class="fe kp kq kr ks b">useInput</code>é’©å­ï¼Œå›é¡¾çŠ¶æ€ç®¡ç†ï¼Œåˆå¹¶ä¸€äº›é¢å¤–çš„æµ‹è¯•ï¼Œæ›´è¯¦ç»†åœ°å›é¡¾æµ‹è¯•ç­–ç•¥ï¼Œå¹¶æ‰©å±•æˆ‘ä»¬ä»ç¬¬1éƒ¨åˆ†å¼€å§‹çš„è§£å†³æ–¹æ¡ˆã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼</p><p id="46ce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¯¹äº†ï¼Œ<a class="ae ko" rel="noopener ugc nofollow" target="_blank" href="/react-hooks-designing-a-simple-forms-api-part-3-validation-and-a-running-example-18b835a3b817"> part 3 </a>å’Œ<a class="ae ko" rel="noopener ugc nofollow" target="_blank" href="/react-hooks-designing-a-simple-forms-api-part-4-scaling-to-other-input-types-e738db0a3fc3"> part 4 </a>ä¸Šçº¿äº†ğŸ’ªã€‚</p><h1 id="6f6f" class="kt ku it bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">ä¸º<code class="fe kp kq kr ks b">useInput</code>è®¾è®¡å…¬å…±API</h1><p id="9537" class="pw-post-body-paragraph jq jr it js b jt lr jv jw jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn im bi translated">æˆ‘å‘ç°è®¾è®¡hooks APIsçš„æœ€ä½³èµ·ç‚¹æ˜¯é¦–å…ˆç†è§£ä½ å¸Œæœ›å®ƒåšä»€ä¹ˆï¼Œç„¶åä½ å°†å¦‚ä½•ä½¿ç”¨å®ƒã€‚åœ¨ç¬¬1éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†<code class="fe kp kq kr ks b">useForm</code>é’©å­ï¼Œä½†æ˜¯å®ƒæœ¬èº«æ˜¯æ²¡æœ‰ç”¨çš„ã€‚è¾“å…¥æ§ä»¶ä¹Ÿéœ€è¦å¾—åˆ°æ”¯æŒï¼Œä»¥ä¾¿æ¶ˆè´¹è€…èƒ½å¤Ÿè¿æ¥ä¸€ä¸ªå®Œæ•´çš„HTMLè¡¨å•ã€‚</p><h2 id="0d75" class="lw ku it bd kv lx ly dn kz lz ma dp ld kb mb mc lh kf md me ll kj mf mg lp mh bi translated">æˆ‘ä»¬å¸Œæœ›useInputåšä»€ä¹ˆ</h2><ul class=""><li id="c50b" class="mi mj it js b jt lr jx ls kb mk kf ml kj mm kn mn mo mp mq bi translated"><code class="fe kp kq kr ks b">useInput</code>é’©å­å°†æ˜¯HTMLè¾“å…¥çš„çŠ¶æ€ç®¡ç†é’©å­ã€‚å®ƒå°†è·Ÿè¸ªè¾“å…¥åˆ°è¾“å…¥ä¸­çš„å€¼ï¼Œå¹¶å°†è·Ÿè¸ªå…³äºç»™å®šè¾“å…¥çš„ä¸€äº›é™„åŠ çŠ¶æ€å±æ€§</li><li id="b74c" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated"><code class="fe kp kq kr ks b">useInput</code>é’©å­åº”è¯¥è·Ÿè¸ªç”¨æˆ·æ˜¯å¦å·²ç»â€œè®¿é—®â€äº†è¾“å…¥å­—æ®µ</li><li id="5ebd" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated"><code class="fe kp kq kr ks b">useInput</code>é’©å­åº”è¯¥è·Ÿè¸ªè¾“å…¥çš„å€¼æ˜¯å¦ä¸åŒäºå®ƒçš„åŸå§‹å€¼</li></ul><h2 id="3288" class="lw ku it bd kv lx ly dn kz lz ma dp ld kb mb mc lh kf md me ll kj mf mg lp mh bi translated">æˆ‘ä»¬å¸Œæœ›æ¶ˆè´¹è€…å¦‚ä½•ä½¿ç”¨useInputï¼Ÿ</h2><p id="f909" class="pw-post-body-paragraph jq jr it js b jt lr jv jw jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn im bi translated">å¯¹äºæˆ‘ä»¬çš„æ–°<code class="fe kp kq kr ks b">useInput</code>é’©å­ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘å¦‚ä½•ç®¡ç†è¿™ä¸ªæ–°é’©å­ã€‚æˆ‘ä»¬å¸Œæœ›è¡¨å•åº“çš„æœ€ç»ˆç”¨æˆ·ç›´æ¥ä½¿ç”¨<code class="fe kp kq kr ks b">useInput</code>é’©å­å—ï¼Ÿè¿˜æ˜¯åº”è¯¥ä¸æœ€ç»ˆç”¨æˆ·éš”ç¦»å¼€æ¥ï¼Ÿå¯¹æˆ‘æ¥è¯´ï¼Œè¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åº”è¯¥è€ƒè™‘å¦‚ä½•ç®¡ç†è¡¨å•ä¸Šæ‰€æœ‰è¾“å…¥çš„çŠ¶æ€ã€‚</p><figure class="mx my mz na gt nb gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi mw"><img src="../Images/f701d14ea5d1aec735df0adcb13d0801.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ikxCEPA5SK2whp02FBYcIw.png"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">å›¾1-ä½¿ç”¨è¡¨å•å’Œä½¿ç”¨è¾“å…¥çŠ¶æ€ç®¡ç†å’ŒAPIä½¿ç”¨</figcaption></figure><p id="6afa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¦‚å›¾1æ‰€ç¤ºï¼Œæˆ‘å¸Œæœ›è¡¨å•æ¶ˆè´¹è€…ç›´æ¥ä½¿ç”¨<code class="fe kp kq kr ks b">useForm</code>é’©å­ï¼Œè®©<code class="fe kp kq kr ks b">useForm</code>ç›´æ¥ç®¡ç†æ‰€æœ‰çš„<code class="fe kp kq kr ks b">useInput</code>é’©å­ã€‚æˆ‘æ›´å¸Œæœ›æ¶ˆè´¹è€…ä¸å¿…è‡ªå·±å¤„ç†ç®¡ç†æ‰€æœ‰çš„<code class="fe kp kq kr ks b">useInput</code>æŒ‚é’©ã€‚åŸå› æ˜¯:</p><ul class=""><li id="f106" class="mi mj it js b jt ju jx jy kb nm kf nn kj no kn mn mo mp mq bi translated"><code class="fe kp kq kr ks b">useForm</code>ä½œä¸ºæ•´ä½“çª—ä½“çš„é’©å­åº”è¯¥å¯¹ä¸€ä¸ªçª—ä½“çš„æ•´ä½“çŠ¶æ€è´Ÿè´£ã€‚å¦åˆ™ï¼Œå¦‚æœæ¶ˆè´¹è€…ç›´æ¥ä½¿ç”¨<code class="fe kp kq kr ks b">useInput</code>é’©å­ï¼Œè¡¨å•çš„çŠ¶æ€ç®¡ç†å¯èƒ½ä¼šä»¤äººå›°æƒ‘</li><li id="700a" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">æˆ‘æƒ³ä¿æŒä½¿ç”¨æ¨¡å¼ç®€å•å’Œä¸€è‡´</li><li id="bc6f" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">å¦‚æœéœ€è¦çš„è¯ï¼Œé€šè¿‡æ‰©å±•<code class="fe kp kq kr ks b">useForm</code>é’©å­APIï¼Œå°†æ¥å¯ä»¥å¾ˆå®¹æ˜“åœ°æ‰©å±•<code class="fe kp kq kr ks b">useForm</code>ä»¥æ”¯æŒå®šåˆ¶è¾“å…¥</li></ul><h2 id="4a68" class="lw ku it bd kv lx ly dn kz lz ma dp ld kb mb mc lh kf md me ll kj mf mg lp mh bi translated">çŠ¶æ€ç®¡ç†</h2><p id="8916" class="pw-post-body-paragraph jq jr it js b jt lr jv jw jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn im bi translated">å¦‚å›¾1æ‰€ç¤ºï¼Œ<code class="fe kp kq kr ks b">useForm</code>å’Œ<code class="fe kp kq kr ks b">useInput</code>éƒ½ç®¡ç†è‡ªå·±çš„çŠ¶æ€ã€‚<code class="fe kp kq kr ks b">useInput</code>å°†ä¿æŒä»£è¡¨è¾“å…¥å€¼çš„å†…éƒ¨çŠ¶æ€ï¼Œä»¥åŠè¾“å…¥æ˜¯å¦è¢«è®¿é—®è¿‡ï¼Œä»¥åŠè¾“å…¥å€¼æ˜¯å¦å·²ç»æ”¹å˜ã€‚<code class="fe kp kq kr ks b">useForm</code>å°†å†—ä½™åœ°å­˜å‚¨å®ƒæ­£åœ¨è·Ÿè¸ªçš„æ‰€æœ‰è¾“å…¥ã€‚ä»è¿™ä¸ªæ„ä¹‰ä¸Šè¯´ï¼Œ<code class="fe kp kq kr ks b">useForm</code>å°†æ˜¯è·Ÿè¸ªè¡¨å•ä¸Šæ‰€æœ‰è¾“å…¥å€¼çš„ä¸»è¦ä½ç½®ã€‚è¿™å°†ä½¿APIçš„æœ€ç»ˆæ¶ˆè´¹è€…æ›´å®¹æ˜“å¤„ç†è¡¨å•å€¼ï¼Œå› ä¸º<code class="fe kp kq kr ks b">useForm</code>å°†èƒ½å¤Ÿä»¥ä¸€ç§æ˜“äºæ¶ˆè´¹è€…ä½¿ç”¨çš„æ–¹å¼å‘ˆç°è¡¨å•å€¼ã€‚</p><p id="8eae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¾“å…¥è¡¨å•å°†é€šè¿‡<code class="fe kp kq kr ks b">useForm</code>é’©å­æ¥æ”¶æ‰€æœ‰çš„è¡¨å•çŠ¶æ€ã€‚</p><h2 id="ea80" class="lw ku it bd kv lx ly dn kz lz ma dp ld kb mb mc lh kf md me ll kj mf mg lp mh bi translated">ä½¿ç”¨è¾“å…¥æŒ‚é’©æºä»£ç å’Œè¯´æ˜</h2><p id="8927" class="pw-post-body-paragraph jq jr it js b jt lr jv jw jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn im bi translated">åœ¨æˆ‘ä»¬çš„<code class="fe kp kq kr ks b">useInput</code>é’©å­çš„ç¬¬ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬è·Ÿè¸ªçŠ¶æ€ä¸­çš„3ä¸ªäº‹ç‰©ã€‚å½“å‰è¾“å…¥å€¼â€” <code class="fe kp kq kr ks b">inputValue</code>ã€<code class="fe kp kq kr ks b">originalValue</code>è·Ÿè¸ªè¾“å…¥æ˜¯å¦è¢«æ›´æ–°ï¼Œæœ€å<code class="fe kp kq kr ks b">visited</code>è·Ÿè¸ªç”¨æˆ·æ˜¯å¦è®¿é—®äº†è¾“å…¥å­—æ®µã€‚</p><p id="3d19" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">é’©å­è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å…·æœ‰è¡¨ç¤ºè¾“å…¥çŠ¶æ€çš„å±æ€§å’Œä¸€äº›APIå‡½æ•°ï¼Œé’©å­çš„ä½¿ç”¨è€…å¯ä»¥ä½¿ç”¨è¿™äº›å‡½æ•°æ¥æ”¹å˜è¾“å…¥çš„çŠ¶æ€ã€‚</p><p id="5628" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘ä»¬å‘ä»é’©å­è¿”å›çš„å¯¹è±¡æ·»åŠ ä¸€ä¸ª<code class="fe kp kq kr ks b">pristine</code>æ´¾ç”Ÿå±æ€§ï¼Œå®ƒå°†åŸå§‹å€¼ä¸è¾“å…¥å€¼è¿›è¡Œæ¯”è¾ƒã€‚</p><pre class="mx my mz na gt np ks nq nr aw ns bi"><span id="3ad2" class="lw ku it ks b gy nt nu l nv nw">import { useState } from "react";</span><span id="a987" class="lw ku it ks b gy nx nu l nv nw">export const useInput = ({ name, value, props = {} }) =&gt; {<br/>  const [inputValue, setInputValue] = useState(value);<br/>  const [originalValue] = useState(value);<br/>  const [visited, setVisited] = useState(false);</span><span id="82a1" class="lw ku it ks b gy nx nu l nv nw">const getInputProps = () =&gt; ({<br/>    id: name,<br/>    value: inputValue,<br/>    ...props,<br/>    onChange: event =&gt; {<br/>      const val = event.target.value;<br/>      setInputValue(val);<br/>      props.onChange &amp;&amp; props.onChange(name, val);<br/>    },<br/>    onFocus: evt =&gt; {<br/>      setVisited(true);<br/>    }<br/>  });</span><span id="b3e5" class="lw ku it ks b gy nx nu l nv nw">return {<br/>    id: name,<br/>    value: inputValue,<br/>    api: {<br/>      setValue: val =&gt; {<br/>        setInputValue(val);<br/>      }<br/>    },<br/>    uiState: {<br/>      visited,<br/>      pristine: inputValue === originalValue<br/>    },<br/>    getInputProps<br/>  };<br/>};</span></pre><h2 id="872c" class="lw ku it bd kv lx ly dn kz lz ma dp ld kb mb mc lh kf md me ll kj mf mg lp mh bi translated">æ·»åŠ åˆ°<code class="fe kp kq kr ks b">useForm</code>ä»¥æ”¯æŒå‘è¡¨å•æ·»åŠ æ–°è¾“å…¥</h2><p id="cec6" class="pw-post-body-paragraph jq jr it js b jt lr jv jw jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn im bi translated">ç”±äº<code class="fe kp kq kr ks b">useForm</code>å°†æ˜¯ä½¿ç”¨<code class="fe kp kq kr ks b">useInput</code>é’©å­çš„ä¸»è¦å…¥å£ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ å…¥å£ç‚¹ï¼Œå¹¶æ›´æ–°<code class="fe kp kq kr ks b">useForm</code>é’©å­æ¥è·Ÿè¸ªè¾“å…¥çŠ¶æ€ã€‚ä¸‹é¢æ˜¾ç¤ºäº†<code class="fe kp kq kr ks b">useForm</code>é’©å­çš„æºä»£ç ï¼Œä¸<code class="fe kp kq kr ks b">useInput</code>ç›¸å…³çš„ä»£ç ä»¥ç²—ä½“æ˜¾ç¤ºã€‚</p><p id="c864" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe kp kq kr ks b">useForm</code>é€šè¿‡<code class="fe kp kq kr ks b">onInputChange</code>åŠŸèƒ½è·Ÿè¸ªè¾“å…¥çš„å˜åŒ–ã€‚è¿™ä¸ªå‡½æ•°è®¾ç½®<code class="fe kp kq kr ks b">formValues</code>å±æ€§ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„é”®å€¼å¯¹å¯¹è±¡ï¼Œå…¶ä¸­é”®æ˜¯è¾“å…¥åç§°ï¼Œå€¼æ˜¯è¾“å…¥å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªè¡¨å•æœ‰è¾“å…¥å­—æ®µ<code class="fe kp kq kr ks b">firstName</code>å’Œ<code class="fe kp kq kr ks b">lastName</code>ï¼Œ<code class="fe kp kq kr ks b">formValues</code>å°†å¦‚ä¸‹æ‰€ç¤º:</p><pre class="mx my mz na gt np ks nq nr aw ns bi"><span id="eaf1" class="lw ku it ks b gy nt nu l nv nw">{ firstName: 'firstNameValue', lastName: 'lastNameValue' } </span></pre><p id="120b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe kp kq kr ks b">formValues</code>è¢«<code class="fe kp kq kr ks b">useForm</code>çš„æ¶ˆè´¹è€…ç”¨æ¥è½»æ¾æ¥æ”¶è¡¨å•å€¼çš„é”®/å€¼å¯¹åˆ—è¡¨ã€‚</p><p id="cb58" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ‚¨ä¼šæ³¨æ„åˆ°æˆ‘ä»¬æ²¡æœ‰ä¸º<code class="fe kp kq kr ks b">formValues</code>ä½¿ç”¨useStateçš„setå±æ€§ã€‚å¦‚æœæˆ‘ä»¬è¿™æ ·åšï¼ŒReactå°†ä¼šé‡åˆ°ä¸€ä¸ªå¾ªç¯æ›´æ–°é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬æ”¹å˜äº†<code class="fe kp kq kr ks b">formValues</code>çš„å€¼ã€‚æˆ‘æ›´å€¾å‘äºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿™æ ·å°±ä¸éœ€è¦çªå˜ï¼Œå¦‚æœä½ ä»¬ä¸­çš„ä»»ä½•äººå¯¹æ­¤æœ‰ä»»ä½•å»ºè®®ï¼Œæˆ‘å°†ä¸èƒœæ„Ÿæ¿€ã€‚</p><p id="686d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe kp kq kr ks b">addInput</code>æ˜¯æ¶ˆè´¹è€…ç”¨æ¥å‘è¡¨å•æ·»åŠ è¾“å…¥çš„APIã€‚<code class="fe kp kq kr ks b">addInput</code>å‡½æ•°çš„åˆå§‹ç‰ˆæœ¬æ¥æ”¶è¾“å…¥åç§°å’Œå€¼ã€‚åœ¨å†…éƒ¨ï¼Œ<code class="fe kp kq kr ks b">useForm</code>é’©å­è°ƒç”¨<code class="fe kp kq kr ks b">useInput</code>é’©å­åˆå§‹åŒ–è¾“å…¥ã€‚æ­¤å¤–ï¼Œ<code class="fe kp kq kr ks b">useForm</code>ç„¶åæ›´æ–°å®ƒçš„å†…éƒ¨è¾“å…¥é›†åˆå’Œè¡¨å•å€¼ã€‚</p><pre class="mx my mz na gt np ks nq nr aw ns bi"><span id="b07c" class="lw ku it ks b gy nt nu l nv nw">import { useState } from "react";<br/>import { useInput } from "./use-input";</span><span id="6bc2" class="lw ku it ks b gy nx nu l nv nw">export const defaultFormProps = {<br/>  autoComplete: "on"<br/>};<br/>export const useForm = (name, initialState = {}) =&gt; {<br/>  const [formValues] = useState({<br/>    ...initialState<br/>  });<br/>  const [uiState, setUiState] = useState({<br/>    isSubmitting: false<br/>  });<br/><strong class="ks iu">  const [inputs] = useState({});</strong></span><span id="a193" class="lw ku it ks b gy nx nu l nv nw">const getFormProps = (props = {}) =&gt; ({<br/>    ...defaultFormProps,<br/>    ...props,<br/>    onSubmit: async evt =&gt; {<br/>      evt.preventDefault();<br/>      try {<br/>        setUiState({ isSubmitting: true });<br/>        props.onSubmit &amp;&amp; (await props.onSubmit({ evt, formValues }));<br/>      } finally {<br/>        setUiState({ isSubmitting: false });<br/>      }<br/>    }<br/>  });</span><span id="74a7" class="lw ku it ks b gy nx nu l nv nw"><strong class="ks iu">const onInputChange = (name, value) =&gt; {<br/>    formValues[name] = value;<br/>  };</strong></span><span id="4265" class="lw ku it ks b gy nx nu l nv nw"><strong class="ks iu">const addInput = ({ name, value }) =&gt; {<br/>    const input = useInput({<br/>      name,<br/>      value,<br/>      props: { onChange: onInputChange }<br/>    });<br/>    inputs[name] = input;<br/>    formValues[name] = value;<br/>    return input;<br/>  };</strong></span><span id="33f1" class="lw ku it ks b gy nx nu l nv nw">return {<br/>    getFormProps,<br/>    formValues,<br/>    uiState,<br/>    inputs,<br/><strong class="ks iu">    api: {<br/>      addInput<br/>    }<br/></strong>  };<br/>};</span></pre><h1 id="2f11" class="kt ku it bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">æµ‹è¯•ç­–ç•¥</h1><p id="f99a" class="pw-post-body-paragraph jq jr it js b jt lr jv jw jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn im bi translated">åœ¨å¼€å‘çš„è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬çš„åº“æœ¬è´¨ä¸Šä»ç„¶æ˜¯React hooksã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œæˆ‘ä»¬å°†ç»§ç»­ä½¿ç”¨Jestå’Œ<a class="ae ko" href="https://www.npmjs.com/package/react-hooks-testing-library" rel="noopener ugc nofollow" target="_blank">react-hooks-testing-library</a>ã€‚åº“æ˜¯ç”¨æ¥æµ‹è¯•é’©å­çš„ã€‚å®ƒä¸ºå•å…ƒæµ‹è¯•æŒ‚é’©æä¾›äº†ä¸€ä¸ªç®€å•çš„ç»„ä»¶åŒ…è£…å™¨å’Œå®ç”¨å·¥å…·ã€‚</p><p id="a052" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç„¶è€Œï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥ç”¨æ ·æœ¬è¡¨å•æµ‹è¯•é’©å­ã€‚åœ¨APIçš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„è¡¨å•æ¥éªŒè¯é’©å­ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›å°½å¿«å¼€å§‹æµ‹è¯•æ ·æœ¬è¡¨å•ï¼Œä»¥ä¾¿å¯¹<code class="fe kp kq kr ks b">useForm</code>æ„å»ºçš„è¾“å…¥è¡¨å•è¿›è¡Œç«¯åˆ°ç«¯éªŒè¯ã€‚å¯¹äºè¿™ç§æµ‹è¯•ï¼Œæˆ‘å¯èƒ½ä¼šé€‰æ‹©<a class="ae ko" href="https://github.com/kentcdodds/react-testing-library" rel="noopener ugc nofollow" target="_blank">ååº”æµ‹è¯•åº“</a>ã€‚</p><p id="ee21" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º<code class="fe kp kq kr ks b">useInput</code>é’©å­æ·»åŠ æµ‹è¯•ï¼Œå¹¶æ›´æ–°<code class="fe kp kq kr ks b">useForm</code>æµ‹è¯•ã€‚</p><h2 id="d475" class="lw ku it bd kv lx ly dn kz lz ma dp ld kb mb mc lh kf md me ll kj mf mg lp mh bi translated">ä½¿ç”¨è¾“å…¥å•å…ƒæµ‹è¯•</h2><p id="980a" class="pw-post-body-paragraph jq jr it js b jt lr jv jw jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn im bi translated">æˆ‘æµ‹è¯•<code class="fe kp kq kr ks b">useInput</code>çš„ç›®æ ‡æ˜¯è¯•å›¾ä»é»‘ç›’çš„è§’åº¦æµ‹è¯•APIçš„æ‰€æœ‰æ–¹é¢ï¼Œä»¥åŠå®ƒè·Ÿè¸ªçš„çŠ¶æ€ã€‚æµ‹è¯•ä¹Ÿå¾ˆå¥½åœ°è§£è¯»äº†<code class="fe kp kq kr ks b">useInput</code>æ‰“ç®—æä¾›çš„ç‰¹æ€§ã€‚</p><pre class="mx my mz na gt np ks nq nr aw ns bi"><span id="8441" class="lw ku it ks b gy nt nu l nv nw">import { renderHook, cleanup, act } from "react-hooks-testing-library";<br/>import { useInput } from "./use-input";</span><span id="195c" class="lw ku it ks b gy nx nu l nv nw">describe("useInput tests", () =&gt; {<br/>  afterEach(cleanup);</span><span id="2a86" class="lw ku it ks b gy nx nu l nv nw">it("should initialize an input", () =&gt; {<br/>    const { result } = renderHook(() =&gt;<br/>      useInput({ name: "test", value: "123" })<br/>    );<br/>    const { id, value, api, uiState, getInputProps } = result.current;<br/>    expect(id).toEqual("test");<br/>    expect(value).toEqual("123");<br/>    expect(api).toBeDefined();<br/>    expect(uiState).toBeDefined();<br/>    expect(getInputProps).toBeDefined();<br/>  });</span><span id="f1b0" class="lw ku it ks b gy nx nu l nv nw">it("should support reset", () =&gt; {<br/>    const { result } = renderHook(() =&gt;<br/>      useInput({ name: "test", value: "123" })<br/>    );<br/>    expect(result.current.value).toEqual("123");<br/>    act(() =&gt; {<br/>      result.current.api.setValue("");<br/>    });<br/>    expect(result.current.value).toEqual("");<br/>  });</span><span id="6b94" class="lw ku it ks b gy nx nu l nv nw">it("should support custom input props", () =&gt; {<br/>    const { result } = renderHook(() =&gt;<br/>      useInput({ name: "test", value: "123" })<br/>    );<br/>    expect(result.current.value).toEqual("123");<br/>    act(() =&gt; {<br/>      result.current.api.setValue("");<br/>    });<br/>    expect(result.current.value).toEqual("");<br/>  });</span><span id="4678" class="lw ku it ks b gy nx nu l nv nw">it("should change visited state on focus", () =&gt; {<br/>    const { result } = renderHook(() =&gt;<br/>      useInput({ name: "test", value: "123" })<br/>    );<br/>    expect(result.current.uiState.visited).toEqual(false);<br/>    act(() =&gt; {<br/>      result.current.getInputProps().onFocus();<br/>    });<br/>    expect(result.current.uiState.visited).toEqual(true);<br/>  });</span><span id="c312" class="lw ku it ks b gy nx nu l nv nw">it("should change pristine after API setValue", () =&gt; {<br/>    const { result } = renderHook(() =&gt;<br/>      useInput({ name: "test", value: "123" })<br/>    );<br/>    expect(result.current.uiState.pristine).toEqual(true);<br/>    act(() =&gt; {<br/>      result.current.api.setValue("234");<br/>    });<br/>    expect(result.current.uiState.pristine).toEqual(false);<br/>    act(() =&gt; {<br/>      result.current.api.setValue("123");<br/>    });<br/>    expect(result.current.uiState.pristine).toEqual(true);<br/>  });</span><span id="d11c" class="lw ku it ks b gy nx nu l nv nw">it("should change pristine and value when onChange event is triggered", () =&gt; {<br/>    const { result } = renderHook(() =&gt;<br/>      useInput({ name: "test", value: "123" })<br/>    );<br/>    act(() =&gt; {<br/>      result.current.getInputProps().onChange({<br/>        target: { value: "234" }<br/>      });<br/>    });<br/>    expect(result.current.uiState.pristine).toEqual(false);<br/>    expect(result.current.value).toEqual("234");</span><span id="24dd" class="lw ku it ks b gy nx nu l nv nw">act(() =&gt; {<br/>      result.current.getInputProps().onChange({<br/>        target: { value: "123" }<br/>      });<br/>    });<br/>    expect(result.current.uiState.pristine).toEqual(true);<br/>    expect(result.current.value).toEqual("123");<br/>  });<br/>});</span></pre><h2 id="6b42" class="lw ku it bd kv lx ly dn kz lz ma dp ld kb mb mc lh kf md me ll kj mf mg lp mh bi translated">ä½¿ç”¨è¡¨å•å•å…ƒæµ‹è¯•æ›´æ–°</h2><p id="7d6d" class="pw-post-body-paragraph jq jr it js b jt lr jv jw jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn im bi translated"><code class="fe kp kq kr ks b">useForm</code>ç°åœ¨æœ‰äº†ç”¨äºè¾“å…¥çš„APIï¼ŒuseFormçš„APIä¸ç¬¬1éƒ¨åˆ†ç›¸æ¯”ç•¥æœ‰å˜åŒ–ï¼Œåªæ˜¯ç¨å¾®æ¸…ç†äº†ä¸€ä¸‹APIã€‚å› æ­¤ï¼Œæ­¤æ—¶çš„å…¨å¥—æµ‹è¯•å¦‚ä¸‹:</p><pre class="mx my mz na gt np ks nq nr aw ns bi"><span id="108e" class="lw ku it ks b gy nt nu l nv nw">import { renderHook, cleanup, act } from "react-hooks-testing-library";<br/>import { useForm } from "./use-form";</span><span id="1728" class="lw ku it ks b gy nx nu l nv nw">const noop = () =&gt; {};</span><span id="9a80" class="lw ku it ks b gy nx nu l nv nw">jest.useFakeTimers();</span><span id="eb82" class="lw ku it ks b gy nx nu l nv nw">describe("useForm tests", () =&gt; {<br/>  afterEach(cleanup);</span><span id="7042" class="lw ku it ks b gy nx nu l nv nw">it("should return empty form props and form state", () =&gt; {<br/>    const { result } = renderHook(() =&gt; useForm());<br/>    const { getFormProps, formValues } = result.current;<br/>    expect(getFormProps).toBeDefined();<br/>    expect(formValues).toEqual({});<br/>  });</span><span id="8c31" class="lw ku it ks b gy nx nu l nv nw">it("should return an initial uiState", () =&gt; {<br/>    const { result } = renderHook(() =&gt; useForm());<br/>    const { uiState } = result.current;<br/>    expect(uiState).toEqual({<br/>      isSubmitting: false<br/>    });<br/>  });</span><span id="7de7" class="lw ku it ks b gy nx nu l nv nw">it("should support custom form props", () =&gt; {<br/>    const { result } = renderHook(() =&gt; useForm());<br/>    const { getFormProps } = result.current;<br/>    const formProps = getFormProps({ foo: "bar" });<br/>    expect(formProps.foo).toEqual("bar");<br/>  });</span><span id="6852" class="lw ku it ks b gy nx nu l nv nw">it("should support custom onSubmit", async () =&gt; {<br/>    const { result } = renderHook(() =&gt; useForm());<br/>    const { getFormProps, uiState } = result.current;</span><span id="66d9" class="lw ku it ks b gy nx nu l nv nw">const onSubmit = jest.fn();</span><span id="4afc" class="lw ku it ks b gy nx nu l nv nw">const formProps = getFormProps({ onSubmit });<br/>    expect(formProps.onSubmit).toBeDefined();</span><span id="5a9d" class="lw ku it ks b gy nx nu l nv nw">// Could be some weirdness right now due to<br/>    // <a class="ae ko" href="https://github.com/facebook/react/issues/14769" rel="noopener ugc nofollow" target="_blank">https://github.com/facebook/react/issues/14769</a><br/>    act(() =&gt; {<br/>      formProps.onSubmit({ preventDefault: noop });<br/>    });<br/>    expect(uiState).toEqual({<br/>      isSubmitting: false<br/>    });<br/>    expect(onSubmit).toHaveBeenCalledTimes(1);<br/>  });</span><span id="e697" class="lw ku it ks b gy nx nu l nv nw">it("should support async onSubmit", async () =&gt; {<br/>    const { waitForNextUpdate, result } = renderHook(() =&gt; useForm());<br/>    const { getFormProps, uiState } = result.current;</span><span id="14d8" class="lw ku it ks b gy nx nu l nv nw">const onSubmit = evt =&gt;<br/>      new Promise(r =&gt; {<br/>        setTimeout(() =&gt; {<br/>          r();<br/>        }, 1000);<br/>      });</span><span id="fdda" class="lw ku it ks b gy nx nu l nv nw">const formProps = getFormProps({ onSubmit });<br/>    expect(formProps.onSubmit).toBeDefined();</span><span id="ebf3" class="lw ku it ks b gy nx nu l nv nw">// Could be some weirdness right now due to<br/>    // <a class="ae ko" href="https://github.com/facebook/react/issues/14769" rel="noopener ugc nofollow" target="_blank">https://github.com/facebook/react/issues/14769</a><br/>    act(() =&gt; {<br/>      formProps.onSubmit({ preventDefault: noop });<br/>    });<br/>    jest.runAllTimers();<br/>    expect(result.current.uiState).toEqual({<br/>      isSubmitting: true<br/>    });<br/>    await waitForNextUpdate();<br/>    expect(uiState).toEqual({<br/>      isSubmitting: false<br/>    });<br/>  });</span><span id="47e9" class="lw ku it ks b gy nx nu l nv nw">it("should gracefully handle onSubmit errors", async () =&gt; {<br/>    const { result } = renderHook(() =&gt; useForm());<br/>    const { getFormProps, uiState } = result.current;</span><span id="7d85" class="lw ku it ks b gy nx nu l nv nw">const onSubmit = evt =&gt; new Error();</span><span id="ea90" class="lw ku it ks b gy nx nu l nv nw">const formProps = getFormProps({ onSubmit });<br/>    expect(formProps.onSubmit).toBeDefined();</span><span id="c478" class="lw ku it ks b gy nx nu l nv nw">// Could be some weirdness right now due to<br/>    // <a class="ae ko" href="https://github.com/facebook/react/issues/14769" rel="noopener ugc nofollow" target="_blank">https://github.com/facebook/react/issues/14769</a><br/>    act(() =&gt; {<br/>      formProps.onSubmit({ preventDefault: noop });<br/>    });<br/>    expect(uiState).toEqual({<br/>      isSubmitting: false<br/>    });<br/>  });</span><span id="35dc" class="lw ku it ks b gy nx nu l nv nw">it("should gracefully handle async onSubmit errors", async () =&gt; {<br/>    const { waitForNextUpdate, result } = renderHook(() =&gt; useForm());<br/>    const { getFormProps, uiState } = result.current;</span><span id="c348" class="lw ku it ks b gy nx nu l nv nw">const onSubmit = evt =&gt;<br/>      new Promise((resolve, reject) =&gt; {<br/>        setTimeout(() =&gt; {<br/>          reject();<br/>        }, 1000);<br/>      });</span><span id="8214" class="lw ku it ks b gy nx nu l nv nw">const formProps = getFormProps({ onSubmit });<br/>    expect(formProps.onSubmit).toBeDefined();</span><span id="95f3" class="lw ku it ks b gy nx nu l nv nw">// Could be some weirdness right now due to<br/>    // <a class="ae ko" href="https://github.com/facebook/react/issues/14769" rel="noopener ugc nofollow" target="_blank">https://github.com/facebook/react/issues/14769</a><br/>    act(() =&gt; {<br/>      formProps.onSubmit({ preventDefault: noop });<br/>    });<br/>    jest.runAllTimers();<br/>    expect(result.current.uiState).toEqual({<br/>      isSubmitting: true<br/>    });<br/>    await waitForNextUpdate();<br/>    expect(uiState).toEqual({<br/>      isSubmitting: false<br/>    });<br/>  });</span><span id="e646" class="lw ku it ks b gy nx nu l nv nw">it("should be able to add inputs", () =&gt; {<br/>    const { result } = renderHook(() =&gt; useForm());<br/>    const { api } = result.current;<br/>    expect(api).toBeDefined();</span><span id="09fa" class="lw ku it ks b gy nx nu l nv nw">renderHook(() =&gt; api.addInput({ name: "test", value: "123" }));<br/>    expect(result.current.formValues).toEqual({ test: "123" });<br/>    expect(result.current.inputs.test).toBeDefined();<br/>    let inputProps = result.current.inputs.test.getInputProps();<br/>    expect(inputProps.id).toEqual("test");<br/>    expect(inputProps.value).toEqual("123");</span><span id="f0dc" class="lw ku it ks b gy nx nu l nv nw">renderHook(() =&gt; api.addInput({ name: "secondtest", value: "234" }));<br/>    expect(result.current.formValues).toEqual({<br/>      test: "123",<br/>      secondtest: "234"<br/>    });<br/>    expect(result.current.inputs.test).toBeDefined();<br/>    inputProps = result.current.inputs.secondtest.getInputProps();<br/>    expect(inputProps.id).toEqual("secondtest");<br/>    expect(inputProps.value).toEqual("234");<br/>  });<br/>});</span></pre><h2 id="7ede" class="lw ku it bd kv lx ly dn kz lz ma dp ld kb mb mc lh kf md me ll kj mf mg lp mh bi translated">ä½¿ç”¨ç¤ºä¾‹è¡¨å•è¿›è¡Œæµ‹è¯•</h2><p id="ac51" class="pw-post-body-paragraph jq jr it js b jt lr jv jw jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn im bi translated">æœ€åï¼Œè¿™æ˜¯ä½¿ç”¨ç¤ºä¾‹è¡¨å•è¿›è¡Œæµ‹è¯•çš„å½“å‰ä»£ç ã€‚</p><pre class="mx my mz na gt np ks nq nr aw ns bi"><span id="daab" class="lw ku it ks b gy nt nu l nv nw">import React from "react";<br/>import { useForm } from "../../components/form/use-form";<br/>import { sleep } from "../../utils/async";</span><span id="7ab4" class="lw ku it ks b gy nx nu l nv nw">function SampleForm(props) {<br/>  const { getFormProps, formValues, uiState, api } = useForm("settingsForm", {<br/>    firstName: "George",<br/>    lastName: "OfTheJungle",<br/>    email: "<a class="ae ko" href="mailto:george@thejungle.com" rel="noopener ugc nofollow" target="_blank">george@thejungle.com</a>"<br/>  });<br/>  const firstName = api.addInput({<br/>    name: "firstName",<br/>    value: formValues.firstName<br/>  });<br/>  const lastName = api.addInput({<br/>    name: "lastName",<br/>    value: formValues.lastName<br/>  });<br/>  const email = api.addInput({<br/>    name: "email",<br/>    value: formValues.email<br/>  });</span><span id="1339" class="lw ku it ks b gy nx nu l nv nw">const onSubmit = async ({ evt, formValues }) =&gt; {<br/>    evt.preventDefault();<br/>    await sleep(2000);<br/>    console.log("sample-form onSubmit", formValues);<br/>  };</span><span id="e515" class="lw ku it ks b gy nx nu l nv nw">return (<br/>    &lt;div&gt;<br/>      &lt;h2&gt;Settings&lt;/h2&gt;<br/>      {uiState.isSubmitting &amp;&amp; &lt;div&gt;Submitting&lt;/div&gt;}<br/>      &lt;form {...getFormProps({ onSubmit })}&gt;<br/>        &lt;div&gt;<br/>          &lt;label htmlFor={firstName.id}&gt;<br/>            First name {JSON.stringify(firstName.uiState)} *<br/>          &lt;/label&gt;<br/>          &lt;input type="text" {...firstName.getInputProps()} /&gt;<br/>        &lt;/div&gt;</span><span id="731c" class="lw ku it ks b gy nx nu l nv nw">&lt;div&gt;<br/>          &lt;label htmlFor={lastName.id}&gt;<br/>            Last name {JSON.stringify(lastName.uiState)} *<br/>          &lt;/label&gt;<br/>          &lt;input type="text" {...lastName.getInputProps()} /&gt;<br/>        &lt;/div&gt;</span><span id="5141" class="lw ku it ks b gy nx nu l nv nw">&lt;div&gt;<br/>          &lt;label htmlFor={email.id}&gt;<br/>            Email address {JSON.stringify(email.uiState)}*<br/>          &lt;/label&gt;<br/>          &lt;input type="text" {...email.getInputProps()} /&gt;<br/>        &lt;/div&gt;</span><span id="ce69" class="lw ku it ks b gy nx nu l nv nw">&lt;div&gt;* - Indicates required field&lt;/div&gt;</span><span id="6c7e" class="lw ku it ks b gy nx nu l nv nw">&lt;div&gt;<br/>          &lt;button type="submit"&gt;Save&lt;/button&gt;<br/>        &lt;/div&gt;<br/>      &lt;/form&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="fd87" class="lw ku it ks b gy nx nu l nv nw">export { SampleForm };</span></pre><h1 id="88dd" class="kt ku it bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">æ‘˜è¦</h1><p id="f5bb" class="pw-post-body-paragraph jq jr it js b jt lr jv jw jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn im bi translated">åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®¾è®¡äº†<code class="fe kp kq kr ks b">useInput</code>é’©å­ï¼Œä¿®æ”¹äº†<code class="fe kp kq kr ks b">useForm</code>é’©å­æ¥æ”¯æŒå®ƒï¼Œåœ¨useFormä¸­åˆ›å»ºäº†ä¸€ä¸ªAPIä¾›è¡¨å•åˆ›å»ºè€…ä½¿ç”¨ï¼Œå¹¶å†³å®šäº†åœ¨è§£å†³æ–¹æ¡ˆä¸­ç®¡ç†çš„çŠ¶æ€ã€‚æˆ‘ä»¬è¿˜ç¼–å†™äº†å‡ ä¸ªå•å…ƒæµ‹è¯•ï¼Œä»¥ç¡®ä¿åœ¨å¼€å‘è¿‡ç¨‹ä¸­å°½å¯èƒ½å¤šåœ°è¿›è¡Œæµ‹è¯•ï¼Œå¹¶ä¸”æ›´æ–°äº†ç¤ºä¾‹é¡µé¢ã€‚</p><p id="0a2b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨ç¬¬3éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºéªŒè¯ã€å¼‚æ­¥éªŒè¯å’Œå¼‚æ­¥è¡¨å•æäº¤ã€‚åœ¨åé¢çš„éƒ¨åˆ†ä¸­ï¼Œæˆ‘è®¡åˆ’æ·±å…¥ç ”ç©¶Reactè§£å†³æ–¹æ¡ˆçš„æ€§èƒ½å«ä¹‰ï¼Œä»¥åŠè®¾è®¡ä¼˜åŒ–ç­‰ã€‚</p><p id="6d3b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜ã€åé¦ˆæˆ–å»ºè®®ï¼Œæˆ–è€…æ‚¨å¸Œæœ›æˆ‘ä»‹ç»æœ¬ç³»åˆ—ä¸­çš„å…¶ä»–å†…å®¹ï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚</p></div></div>    
</body>
</html>