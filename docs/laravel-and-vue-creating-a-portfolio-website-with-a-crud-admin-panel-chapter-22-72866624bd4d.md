# Laravel å’Œ Vue:ç”¨ CRUD ç®¡ç†é¢æ¿åˆ›å»ºä½œå“é›†ç½‘ç«™â€”â€”ç¬¬ 22 ç« 

> åŸæ–‡ï¼š<https://itnext.io/laravel-and-vue-creating-a-portfolio-website-with-a-crud-admin-panel-chapter-22-72866624bd4d?source=collection_archive---------0----------------------->

## ç®¡ç†ä¸»é¡µå’Œç™»å½•ç³»ç»Ÿ

æˆ‘ä»¬çš„ç®¡ç†å‘˜ä¸»é¡µåº”è¯¥æ˜¯è¿™æ ·çš„:

admin/home.vueğŸ‘‡

```
<template>
    <div *id*="admin-home">
        <ProfileEditor/>
        <PortfolioEditor/>
        <AboutEditor/>
        <social-media-links-editor/>
    </div>
</template>

<script>
    *import* ProfileEditor *from* "./sections/ProfileEditor";
    *import* PortfolioEditor *from* "./sections/PortfolioEditor";
    *import* AboutEditor *from* "./sections/AboutEditor";
    *import* SocialMediaLinksEditor *from* "./sections/socialMediaLinksEditor";

    *export default* {
        name: "AdminHome",
        components: {
            SocialMediaLinksEditor,
            AboutEditor,
            PortfolioEditor,
            ProfileEditor
        },
    }
</script>
```

è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹ç™»å½•ç³»ç»Ÿã€‚

![](img/10648ea059866c3b08368b4e5a4fba93.png)

ã€https://unsplash.com/@robschreckhise 

## ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç™»å½•ç³»ç»Ÿï¼Ÿ

æˆ‘ä»¬éœ€è¦å®ƒï¼Œå› ä¸ºæœ‰ä¸€äº›**å‡½æ•°/api è·¯å¾„**æˆ‘ä»¬ä¸æƒ³å¯¹å…¬ä¼—å¼€æ”¾ã€‚æˆ‘ä»¬åªå¸Œæœ›ä»–ä»¬ç”±ç®¡ç†å‘˜è¿è¡Œã€‚

## è¿™äº›å‡½æ•°/api è·¯å¾„åœ¨å“ªé‡Œï¼Ÿ

ç®¡ç†åŠŸèƒ½åœ¨**api.php**è·¯çº¿æ–‡ä»¶ä¸­ã€‚æˆ‘ä»¬éœ€è¦ä¿æŠ¤è¿™äº›è·¯çº¿ã€‚

## æˆ‘ä»¬å¦‚ä½•ä¿æŠ¤è·¯çº¿ï¼Ÿ

æˆ‘ä»¬å¯ä»¥é€šè¿‡å®‰è£…å’Œä½¿ç”¨ **santum ä¸­é—´ä»¶**æ¥ä¿æŠ¤ api è·¯ç”±ã€‚

åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†:

1.  å®‰è£…åœ£æ‰€ä¸­é—´ä»¶
2.  åˆ†é… santum ä¸­é—´ä»¶
3.  é˜»æ­¢æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·è®¿é—®ç®¡ç†ç»„ä»¶
4.  åˆ›å»ºç™»å½•ç»„ä»¶
5.  åˆ›å»ºç”¨æˆ·
6.  é‡å®šå‘ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·

# å®‰è£…åœ£æ‰€ä¸­é—´ä»¶

æˆ‘ä»¬åº”è¯¥è½¬åˆ° terminal/cmd å¹¶é”®å…¥ä»¥ä¸‹å†…å®¹:

```
**composer require laravel/sanctum**
```

> æ•…éšœæ’é™¤:ç»“è®ºä¸è¦å®‰è£…

å¦‚æœä½ å¾—åˆ°ä¸€ä¸ªç±»ä¼¼äº**çš„é”™è¯¯â€”â€”ç»“è®º:ä¸è¦åœ¨æ§åˆ¶å°ä¸­å®‰è£…â€¦**thisï¼Œé€šè¿‡åœ¨ç»ˆç«¯ä¸­è¿è¡Œ`**composer update**` æ¥æ›´æ–° composerã€‚

å¹¶åœ¨ composer æ›´æ–°å®Œæˆåè¿è¡Œ`**composer require laravel/sanctum**` ã€‚

N extï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ç»ˆç«¯è¿è¡Œä»¥ä¸‹å‘½ä»¤:

```
**php artisan vendor:publish --provider="Laravel\Sanctum\SanctumServiceProvider"**
```

è¿™å°†ç»™æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶å¤¹ä¸­çš„**sanctum.php**ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨**vendor/laravel/sanctum/src/Http/Middleware**ä¸­æœ‰ä¸€ä¸ªåä¸º**EnsureFrontendRequestsAreStateful.php**çš„æ–‡ä»¶

æˆ‘ä»¬å¿…é¡»é€šè¿‡æ·»åŠ ä¸‹é¢çš„**ä½¿ç”¨è¡Œ**åœ¨ **app/Http/Kernal.php** ä¸­ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶

`**use Laravel\Sanctum\Http\Middleware\EnsureFrontendRequestsAreStateful;**`

æˆ‘ä»¬éœ€è¦å°†å®ƒæ’å…¥å†…æ ¸çš„å—ä¿æŠ¤ä¸­é—´ä»¶çš„ **api æ•°ç»„**

```
'api' => [
    EnsureFrontendRequestsAreStateful::class,
    ...
],
```

ç°åœ¨æˆ‘ä»¬åº”è¯¥å»æˆ‘ä»¬çš„ã€‚env æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹:

```
*SANCTUM_STATEFUL_DOMAINS*=domain.example
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥è¯´åœ£æ‰€å®‰è£…ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡å°†ä¸­é—´ä»¶åˆ†é…ç»™ä¸€äº›è·¯ç”±æ¥ä½¿ç”¨å®ƒã€‚

## åˆ†é…åœ£æ‰€ä¸­é—´ä»¶

è¦å°†ä¸­é—´ä»¶åˆ†é…ç»™ä¸€æ¡è·¯çº¿ï¼Œå¿…é¡»æ·»åŠ `**->middleware('INSERT NAME OF MIDDLEWARE')**` **ã€‚**

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„ä¸­é—´ä»¶æ˜¯ **auth:sanctum** ï¼Œå› æ­¤æˆ‘ä»¬å°†ä¿æŠ¤ **/profile** post è·¯ç”±ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
Route::*post*('/profile','ProfileController@store')->middleware('auth:sanctum');
```

æˆ‘ä»¬ ***å¯ä»¥*** å°†ä»£ç `**->middleware('auth:sanctum')**` æ·»åŠ åˆ°æˆ‘ä»¬æƒ³è¦å—å¯†å®¤ä¿æŠ¤çš„æ¯æ¡è·¯çº¿ã€‚è¿™å¾ˆå¥½ï¼Œä½†æ˜¯å¾ˆè´¹æ—¶é—´ã€‚

å¦‚æœæ‚¨ä¸æƒ³å°†ç›¸åŒçš„ä»£ç é”®å…¥æˆ–å¤åˆ¶ç²˜è´´åˆ°ä¸åŒçš„è·¯ç”±ä¸­ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥å°†ä¸­é—´ä»¶åº”ç”¨åˆ°ä¸€ç»„è·¯ç”±ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
Route::*middleware*('**auth:sanctum**')->group(*function* () {
    // INSERT ROUTES HERE
});
```

è®©æˆ‘ä»¬å»**api.php**åˆ›å»ºä¸€ä¸ªä¸­é—´ä»¶è·¯ç”±ç»„ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
Route::*middleware*('**auth:sanctum**')->group(*function* () {
    Route::*post*('/profile', 'ProfileController@store');
    ...
});
```

ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬å‘å¸ƒåˆ° **api/profileï¼Œ**å®ƒå°†é€šè¿‡ sanctum ä¸­é—´ä»¶ï¼Œå¹¶åœ¨æ‚¨æœªç™»å½•çš„æƒ…å†µä¸‹ï¼Œåœ¨ç½‘ç»œé€‰é¡¹å¡ä¸­æ˜¾ç¤º 401 é”™è¯¯ã€‚

![](img/4fb74576cecb2cb7476cbbcec0365afd.png)

æ­¤æ—¶:

*   æœªç»è®¤è¯çš„ç”¨æˆ·ä¸èƒ½ä½¿ç”¨*ç®¡ç†ç»„ä»¶ğŸ˜ƒğŸ‘*
*   *æœªç»è®¤è¯çš„ç”¨æˆ·å¯ä»¥ ***è®¿é—®*** ç®¡ç†ç»„ä»¶ğŸ™ğŸ‘*

> *æ˜¯æ—¶å€™æŠŠçœ‰å¤´æ‹§ä¸‹æ¥äº†*
> 
> *è®©æˆ‘ä»¬é˜»æ­¢æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·è®¿é—®ç®¡ç†ç»„ä»¶ã€‚*

## *é˜»æ­¢æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·è®¿é—®ç®¡ç†ç»„ä»¶*

*æˆ‘ä»¬éœ€è¦å» **router.js** åŠ ä¸€ä¸ª**å¯¼èˆªå«å£«ã€‚***

## *å¯¼èˆªé˜²æŠ¤è£…ç½®*

*å¯¼èˆªå®ˆå«æ˜¯ Vue.js çš„ä¸€é¡¹åŠŸèƒ½ï¼Œå¦‚æœä¸æ»¡è¶³æ¡ä»¶ï¼Œå®ƒå¯ä»¥å¸®åŠ©æ‚¨é‡å®šå‘æˆ–å–æ¶ˆå¯¹æŸæ¡è·¯çº¿çš„è®¿é—®ã€‚*

*![](img/27cb6bc9272bc6b00e9d1f5dd615d766.png)*

*æˆ‘ä»¬è¦ç”¨çš„å¯¼èˆªæŠ¤æ¿æ˜¯ **beforeEnterã€‚***

*æˆ‘ä»¬å¿…é¡»ç¼–è¾‘è·¯ç”±å™¨çš„ç®¡ç†è·¯å¾„å¯¹è±¡ï¼Œä»¥åŒ…å« beforeEnter ä¿æŠ¤:*

```
*{
    path: '/admin',
    component: AdminHome,
    **beforeEnter: INSERT FUNCTION NAME HERE**
},*
```

*æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒå°†:*

*   *æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœªç»èº«ä»½éªŒè¯*
*   *å¦‚æœæœªç»è®¤è¯ï¼Œè¯·è½¬åˆ°**/ç™»å½•è·¯å¾„***
*   *å¦‚æœé€šè¿‡éªŒè¯ï¼Œåˆ™è½¬åˆ°æ‰€éœ€çš„è·¯çº¿*

*è®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•æ„å»ºè¿™æ ·ä¸€ä¸ªå‡½æ•°:*

```
**function* requireAuth (to, from, next) {
    *if* (USER IS UNAUTHENTICATED) {
        next({
            path: '/login',
        })
    } *else* {
        next()
    }
}*
```

*ä¸ºäº†è®©è¿™æ ·çš„å‡½æ•°å·¥ä½œï¼Œæ•°æ®å¿…é¡»ä» Laravel ä¼ é€’åˆ° Vueã€‚æˆ‘ä»¬éœ€è¦åˆ°**welcome.blade.php**å¹¶åœ¨< head > < /head >å…ƒç´ ä¸­æ’å…¥ä»¥ä¸‹è„šæœ¬ã€‚*

```
*<script>
    window.AuthCheck = "{{ Auth::*check*() ? 1 : 0}}"
</script>*
```

*Laravel å°†æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œå¹¶è¿”å› 1 æˆ– 0ã€‚æˆ‘ä»¬å¯ä»¥è®¿é—®æµè§ˆå™¨æ§åˆ¶å°ï¼Œçœ‹åˆ°å¦‚æœæˆ‘ä»¬é”®å…¥`**window.AuthCheck**` ï¼Œæˆ‘ä»¬è¦ä¹ˆå¾—åˆ° 1ï¼Œè¦ä¹ˆå¾—åˆ° 0ã€‚*

*![](img/d43f8be1484915891303059d37252e10.png)*

*æˆ‘ä»¬æ­£åœ¨æ„å»ºçš„å‡½æ•°ç°åœ¨å¯ä»¥æ›´æ”¹å¦‚ä¸‹:*

```
**function* requireAuth (to, from, next) {
    *let* AuthCheck = window.AuthCheck;
    *if* (AuthCheck === "0") {
        next({
            path: '/login',
        })
    } *else* {
        next()
    }
}*
```

*åœ¨è¿›å…¥ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒç”¨ä½œ**å¯¼èˆªæŠ¤æ ã€‚***

```
*{
    path: '/admin',
    component: AdminHome,
    **beforeEnter: requireAuth**
},*
```

*å¦‚æœæˆ‘ä»¬è½¬åˆ°ç®¡ç†è·¯å¾„ï¼Œæˆ‘ä»¬å°†è¢«é‡å®šå‘åˆ°ç™»å½•è·¯å¾„ã€‚*

*æ­¤æ—¶:*

*   *æœªç»è®¤è¯çš„ç”¨æˆ·æ— æ³•ä½¿ç”¨*Admin ç»„ä»¶ğŸ˜ƒğŸ‘**
*   **æœªç»è®¤è¯çš„ç”¨æˆ·æ— æ³• ***è®¿é—®*** ç®¡ç†ç»„ä»¶ğŸ˜ƒğŸ‘**

**æˆ‘ä»¬ç°åœ¨é¢ä¸´çš„é—®é¢˜æ˜¯ç¼ºå°‘ç™»å½•ç»„ä»¶ã€‚æˆ‘ä»¬è¢«é‡å®šå‘åˆ°ç™»å½•è·¯ç”±ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨è¯¥è·¯ç”±ä¸Šæ²¡æœ‰çœ‹åˆ°ä»»ä½•ç»„ä»¶ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç™»å½•ç»„ä»¶ã€‚**

# **ç™»å½•ç»„ä»¶**

**æˆ‘ä»¬ä»ç»‘å®šåˆ°æ•°æ®è¿”å›å¯¹è±¡çš„ç®€å•ç™»å½•è¡¨å•å¼€å§‹ã€‚**

**æˆ‘ä»¬ç°åœ¨éœ€è¦é€šè¿‡æ·»åŠ ç™»å½•å‡½æ•°/æ–¹æ³•æ¥ä½¿å®ƒèµ·ä½œç”¨ã€‚**

**å½“ä½¿ç”¨ sanctum ä¸­é—´ä»¶æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯å¯¹ **/sanctum/csrf-cookie** æ‰§è¡Œä¸€ä¸ª get è¯·æ±‚ï¼Œåœ¨ then å—ä¸­æˆ‘ä»¬å¯ä»¥ç¼–å†™è®©ç”¨æˆ·ç™»å½•çš„ä»£ç ã€‚**

```
**methods: {
    login() {
        **axios.get('/sanctum/csrf-cookie').then(response => {

        })**
    }
}**
```

**åœ¨æˆ‘ä»¬æ‰§è¡Œ get è¯·æ±‚ä¹‹åï¼Œæˆ‘ä»¬**å°†**å‘é€åˆ° **api/login****

```
**login() {
    axios.get('/sanctum/csrf-cookie').then(response => {
        **axios.post('/api/login', {
            email: *this*.email,
            password: *this*.password,
        })**
    })
},**
```

**åœ¨ api.php çš„ç›¸åº”è·¯çº¿åº”è¯¥æ˜¯:**

```
**Route::*post*('/login', 'Auth\LoginController@login');**
```

**ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªç™»å½•ç»„ä»¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç”¨æˆ·ã€‚**

## **åˆ›å»ºç”¨æˆ·**

**åˆ›å»ºç”¨æˆ·å°†é€šè¿‡ tinker å®Œæˆã€‚æˆ‘ä»¬åº”è¯¥ä»ç»ˆç«¯é”®å…¥`php artisan tinker`å¼€å§‹ä¿®è¡¥ã€‚**

****é‡è¦â€”å¯†ç å¿…é¡»ç»è¿‡å“ˆå¸Œå¤„ç†****

```
**Hash::make(â€˜INSERT PASSWORD HEREâ€™)**
```

**![](img/09a62469452d608a48673ec94fb8e194.png)**

**æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç”¨æˆ·é€šè¿‡èº«ä»½éªŒè¯åå°†ä»–ä»¬é‡å®šå‘åˆ°ç®¡ç†ç»„ä»¶ã€‚**

## **é‡å®šå‘ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·**

**è¿™é‡Œï¼Œæˆ‘ä»¬åº”è¯¥æ·»åŠ ä¸€ä¸ª`**then block**`æ¥ç¼–ç¨‹ç”¨æˆ·ç™»å½•åä¼šå‘ç”Ÿä»€ä¹ˆã€‚**

**![](img/8964261e02297d930a90f6f3c4a2d83c.png)**

**ç”¨æˆ·ç™»å½•åï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨`**this.$router.push({path: â€˜/adminâ€™})**` ï¼Œè¿™æ ·ç»è¿‡éªŒè¯çš„ç”¨æˆ·å°±ä¼šè¢«é‡å®šå‘åˆ° **/admin****

```
**login() {
    axios.get('/sanctum/csrf-cookie').then(response => {
        axios.post('/api/login', {
            email: *this*.email,
            password: *this*.password,
        })
            .then(response => {
                **this.$router.push({path: â€˜/adminâ€™})**
            })
    })
},**
```

**å¦‚æœæˆ‘ä»¬æ’å…¥æ­£ç¡®çš„ç”µå­é‚®ä»¶å’Œå¯†ç ï¼ŒVue ä¼šå°†æˆ‘ä»¬é‡å®šå‘åˆ° **/admin** è·¯å¾„ï¼Œä½†æˆ‘ä»¬ä¼šé‡åˆ°ä¸€ä¸ªå¯¼èˆªå®ˆå«(**before enter:require auth)**ã€‚**

**![](img/8a0e381663b98b058e9581ec82aca1fd.png)**

**å¯¼èˆªå«å£«å°†æˆ‘ä»¬é‡å®šå‘å›ç™»å½•ç»„ä»¶ï¼Œå› ä¸º**welcome.blade.php**ä¸­çš„`**window.AuthCheck**`**T22 çš„å€¼ä»ç„¶ä¸º 0ã€‚****

**![](img/6390137d5400a99e80edd87b213bab0d.png)**

**å½“æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­åŠ è½½åˆ€ç‰‡æ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°è¿™ä¸ªå€¼ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬è¦ä¹ˆéœ€è¦åœ¨ç™»å½•æ—¶**é‡æ–°åŠ è½½+é‡å®šå‘ç«™ç‚¹**ï¼Œè¦ä¹ˆåœ¨ç™»å½•æ—¶**æ›´æ”¹å€¼**ã€‚**

## **é‡æ–°åŠ è½½+é‡å®šå‘ä¸æ›´æ”¹å€¼**

**é‡æ–°åŠ è½½+é‡å®šå‘ç½‘ç«™å¹¶è½¬åˆ°ç®¡ç†è·¯å¾„çš„ä»£ç æ˜¯`window.location.href = "/admin";`**

**![](img/e575efaf1421854bc0e886da11ea8655.png)**

**è¿™æ˜¯å¯è¡Œçš„ï¼Œä½†æ•ˆç‡ä¸é«˜ã€‚æˆ‘ä»¬å¸Œæœ›é¿å…ç½‘ç«™é‡æ–°åŠ è½½ï¼Œå› æ­¤æ”¹å˜çª—å£çš„ä»·å€¼ã€‚æ‰‹åŠ¨æˆæƒæ›´å¥½ã€‚**

**æˆ‘ä»¬çš„ç™»å½•æ–¹æ³•åº”è¯¥æ˜¯è¿™æ ·çš„:**

**ç°åœ¨ï¼Œå¯¼èˆªå‘˜ä¼šçœ‹ç€çª—æˆ·ã€‚AuthCheck å¹¶å‘ç°å®ƒçš„å€¼ä¸º 1ï¼Œè®©ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·è½¬åˆ° admin è·¯å¾„ã€‚**

**å®Œæˆåï¼Œæˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ä¸ªæŠ•èµ„ç»„åˆç½‘ç«™ï¼Œä½¿ç”¨ Laravel å’Œ Vue åˆ›å»ºäº†ä¸€ä¸ª CRUD ç®¡ç†é¢æ¿ã€‚**

**ä»¥ä¸‹æ˜¯è¯¥ç½‘ç«™æ´»åŠ¨ç‰ˆæœ¬çš„é“¾æ¥:**

**[umar.app/portfolio](https://umar.app/portfolio/)**

**[umar.app/portfolio/admin](https://umar.app/portfolio/admin)**

> **è°¢è°¢ä½ **