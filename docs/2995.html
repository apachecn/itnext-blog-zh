<html>
<head>
<title>How to get your Kubernetes cluster service principal and use it to access other Azure services?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•è·å–ä½ çš„Kubernetesé›†ç¾¤æœåŠ¡ä¸»ä½“ï¼Œå¹¶ä½¿ç”¨å®ƒè®¿é—®å…¶ä»–AzureæœåŠ¡ï¼Ÿ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/how-to-get-your-kubernetes-cluster-service-principal-and-use-it-to-access-other-azure-services-637f185a5112?source=collection_archive---------0-----------------------#2019-09-13">https://itnext.io/how-to-get-your-kubernetes-cluster-service-principal-and-use-it-to-access-other-azure-services-637f185a5112?source=collection_archive---------0-----------------------#2019-09-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/c3fa427f3be4f8b44c7ba4bd744d378d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RyIo6zl5GEI7h8kXZ_JFEw.jpeg"/></div></div></figure><div class=""/><p id="696e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æ‰€ä»¥ï¼Œä½ åœ¨Azureä¸Šæœ‰ä¸€ä¸ª<a class="ae kw" href="https://docs.microsoft.com/azure/aks/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> Kubernetesé›†ç¾¤(AKS) </a>éœ€è¦è®¿é—®å…¶ä»–AzureæœåŠ¡ï¼Œæ¯”å¦‚<a class="ae kw" href="https://azure.microsoft.com/services/container-registry/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">Azure Container Registry(ACR)</a>ï¼Ÿä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨AKSç¾¤é›†æœåŠ¡ä¸»ä½“ã€‚</p><p id="aaca" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ä½ æ‰€éœ€è¦åšçš„å°±æ˜¯å°†å¯¹æ‰€éœ€Azureèµ„æºçš„è®¿é—®å§”æ‰˜ç»™æœåŠ¡ä¸»ä½“ã€‚åªéœ€ä½¿ç”¨<code class="fe kx ky kz la b"><a class="ae kw" href="https://docs.microsoft.com/cli/azure/role/assignment?view=azure-cli-latest&amp;WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">az role assignment create</a></code>åˆ›å»ºä¸€ä¸ªè§’è‰²åˆ†é…ï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œ:</p><ul class=""><li id="e554" class="lb lc jb ka b kb kc kf kg kj ld kn le kr lf kv lg lh li lj bi translated">æŒ‡å®šç‰¹å®šèŒƒå›´ï¼Œå¦‚èµ„æºç»„</li><li id="bd53" class="lb lc jb ka b kb lk kf ll kj lm kn ln kr lo kv lg lh li lj bi translated">ç„¶ååˆ†é…ä¸€ä¸ªè§’è‰²ï¼Œè¯¥è§’è‰²å®šä¹‰æœåŠ¡ä¸»ä½“å¯¹èµ„æºæ‹¥æœ‰çš„æƒé™</li></ul><p id="9cac" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å®ƒçœ‹èµ·æ¥åƒè¿™æ ·:</p><pre class="lp lq lr ls gt lt la lu lv aw lw bi"><span id="1fd5" class="lx ly jb la b gy lz ma l mb mc">az role assignment create --assignee $AKS_SERVICE_PRINCIPAL_APPID --scope $ACR_RESOURCE_ID --role $SERVICE_ROLE</span></pre><blockquote class="md me mf"><p id="ffd7" class="jy jz mg ka b kb kc kd ke kf kg kh ki mh kk kl km mi ko kp kq mj ks kt ku kv ij bi translated"><em class="jb">è¯·æ³¨æ„ï¼Œè¿™é‡Œçš„</em> <code class="fe kx ky kz la b"><em class="jb">--assignee</em></code> <em class="jb">åªä¸è¿‡æ˜¯æœåŠ¡ä¸»ä½“ï¼Œæ‚¨å°†éœ€è¦å®ƒã€‚</em></p></blockquote><p id="f1cf" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å½“ä½ <a class="ae kw" href="https://docs.microsoft.com/azure/aks/kubernetes-walkthrough-portal?view=azure-cli-latest&amp;WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">åœ¨Azureé—¨æˆ·</a>ä¸­åˆ›å»ºä¸€ä¸ªAKSé›†ç¾¤ï¼Œæˆ–è€…ä»Azure CLI ä¸­ä½¿ç”¨<code class="fe kx ky kz la b"><a class="ae kw" href="https://docs.microsoft.com/cli/azure/aks?view=azure-cli-latest&amp;WT.mc_id=medium-blog-abhishgu#az-aks-create" rel="noopener ugc nofollow" target="_blank">az aks create</a></code>å‘½ä»¤ï¼ŒAzureå¯ä»¥è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæœåŠ¡ä¸»ä½“ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code class="fe kx ky kz la b"><a class="ae kw" href="https://docs.microsoft.com/cli/azure/ad/sp?view=azure-cli-latest&amp;WT.mc_id=medium-blog-abhishgu#az-ad-sp-create-for-rbac" rel="noopener ugc nofollow" target="_blank">az ad sp create-for-rbac --skip-assignment</a></code>è‡ªå·±åˆ›å»ºä¸€ä¸ªï¼Œç„¶åä½¿ç”¨<code class="fe kx ky kz la b">--service-principal</code>ä¸­çš„æœåŠ¡ä¸»ä½“<code class="fe kx ky kz la b">appId</code>å’Œ<code class="fe kx ky kz la b">az aks create</code>å‘½ä»¤ä¸­çš„<code class="fe kx ky kz la b">--client-secret</code>(å¯†ç )å‚æ•°ã€‚</p><p id="e3ea" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æ‚¨å¯ä»¥åœ¨<code class="fe kx ky kz la b"><a class="ae kw" href="https://docs.microsoft.com/cli/azure/aks?view=azure-cli-latest&amp;WT.mc_id=medium-blog-abhishgu#az-aks-show" rel="noopener ugc nofollow" target="_blank">az aks show</a></code>å‘½ä»¤ä¸­ä½¿ç”¨ä¸€ä¸ªæ–¹ä¾¿çš„å°æŸ¥è¯¢æ¥å¿«é€Ÿå®šä½æœåŠ¡ä¸»ä½“ï¼</p><pre class="lp lq lr ls gt lt la lu lv aw lw bi"><span id="49b6" class="lx ly jb la b gy lz ma l mb mc">az aks show --name $AKS_CLUSTER_NAME --resource-group $AKS_CLUSTER_RESOURCE_GROUP --query servicePrincipalProfile.clientId -o tsv</span></pre><p id="c175" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è¿™å°†æœåŠ¡æ ¡é•¿<code class="fe kx ky kz la b">appId</code>ï¼æ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥æˆäºˆæƒé™ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å¸Œæœ›AKSä¸ACRåˆä½œï¼Œæ‚¨å¯ä»¥æˆäºˆ<code class="fe kx ky kz la b">acrpull</code>è§’è‰²:</p><pre class="lp lq lr ls gt lt la lu lv aw lw bi"><span id="b51b" class="lx ly jb la b gy lz ma l mb mc">az role assignment create --assignee $AKS_SERVICE_PRINCIPAL_APPID --scope $ACR_RESOURCE_ID --role acrpull</span></pre><h2 id="bdd6" class="lx ly jb bd mk ml mm dn mn mo mp dp mq kj mr ms mt kn mu mv mw kr mx my mz na bi translated">ä»¥ä¸‹æ˜¯ä¾›æ‚¨å‚è€ƒçš„å‘½ä»¤åˆ—è¡¨:</h2><ul class=""><li id="1c4e" class="lb lc jb ka b kb nb kf nc kj nd kn ne kr nf kv lg lh li lj bi translated"><code class="fe kx ky kz la b"><a class="ae kw" href="https://docs.microsoft.com/cli/azure/aks?view=azure-cli-latest&amp;WT.mc_id=medium-blog-abhishgu#az-aks-create" rel="noopener ugc nofollow" target="_blank">az aks create</a></code>åˆ›å»ºAKSé›†ç¾¤</li><li id="a5f8" class="lb lc jb ka b kb lk kf ll kj lm kn ln kr lo kv lg lh li lj bi translated"><code class="fe kx ky kz la b"><a class="ae kw" href="https://docs.microsoft.com/cli/azure/role/assignment?view=azure-cli-latest&amp;WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">az role assignment create</a></code>å°†æœåŠ¡ç‰¹å®šçš„è§’è‰²åˆ†é…ç»™æœåŠ¡ä¸»ä½“</li><li id="ce3d" class="lb lc jb ka b kb lk kf ll kj lm kn ln kr lo kv lg lh li lj bi translated"><code class="fe kx ky kz la b"><a class="ae kw" href="https://docs.microsoft.com/cli/azure/aks?view=azure-cli-latest&amp;WT.mc_id=medium-blog-abhishgu#az-aks-show" rel="noopener ugc nofollow" target="_blank">az aks show</a></code>è·å–æœ‰å…³æ‚¨çš„AKSé›†ç¾¤çš„ä¿¡æ¯</li></ul><p id="e5ef" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰å¸®åŠ©ï¼Œè¯·å–œæ¬¢å¹¶å…³æ³¨ï¼å¾ˆé«˜å…´é€šè¿‡Twitterè·å¾—åé¦ˆæˆ–å‘è¡¨è¯„è®º:-)</p><div class="ip iq gp gr ir ng"><a href="https://twitter.com/abhi_tweeter" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd jc gy z fp nl fr fs nm fu fw ja bi translated">é˜¿å¸ƒèˆå…‹</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">Abhishekçš„æœ€æ–°æ¨æ–‡(@abhi_tweeter)ã€‚äº‘å¼€å‘è€…ğŸ¥‘@Microsoft @azureadvocates |â€¦</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">twitter.com</p></div></div><div class="np l"><div class="nq l nr ns nt np nu ix ng"/></div></div></a></div></div></div>    
</body>
</html>