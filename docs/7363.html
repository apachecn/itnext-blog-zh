<html>
<head>
<title>Having fun deconstructing the localstorage in TypeScript ğŸ¤™</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">äº«å—åœ¨TypeScriptä¸­è§£æ„æœ¬åœ°å­˜å‚¨çš„ä¹è¶£ğŸ¤™</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/having-fun-deconstructing-the-localstorage-in-typescript-e5e99d95aa13?source=collection_archive---------2-----------------------#2022-09-01">https://itnext.io/having-fun-deconstructing-the-localstorage-in-typescript-e5e99d95aa13?source=collection_archive---------2-----------------------#2022-09-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/f4048c31e79b22164af097a165b87dd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lvgsaU8SeMInv0Rb"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">ç…§ç‰‡ç”±<a class="ae kf" href="https://unsplash.com/@katya?utm_source=Papyrs&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Katya Ross </a>åœ¨<a class="ae kf" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šæ‹æ‘„</figcaption></figure><p id="d43f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æˆ‘æœ€è¿‘ç”¨<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" rel="noopener ugc nofollow" target="_blank"> localstorage </a>å®ç°äº†ä¸€äº›ç‰¹æ€§ã€‚è™½ç„¶æˆ‘æ€»æ˜¯ä½¿ç”¨æ¥å£çš„<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Web/API/Storage/getItem" rel="noopener ugc nofollow" target="_blank"> getItem() </a>æ–¹æ³•è¯»å–å€¼ï¼Œä½†åœ¨æˆ‘æœ€è¿‘çš„å·¥ä½œä¸­ï¼Œæˆ‘ç”¨å­˜å‚¨å¯¹è±¡çš„è§£æ„ä»£æ›¿äº†è¿™ç§æ–¹æ³•ã€‚</p><p id="ba1b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æ²¡æœ‰ç‰¹åˆ«çš„åŸå› ã€‚æˆ‘åªæ˜¯å–œæ¬¢è§£æ„äº‹ç‰©ï¼Œéå¸¸å–œæ¬¢ğŸ˜„ã€‚</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="8677" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">å®ˆæ—§æ´¾</h1><p id="50e6" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">å›åˆ°è¿‡å»â€”â€”ç›´åˆ°æœ€è¿‘å‡ å‘¨ğŸ˜‰â€”æˆ‘å¯èƒ½ä¼šå®ç°ä¸€ä¸ªå‡½æ•°æ¥ä»å­˜å‚¨ä¸­è¯»å–ä¸€ä¸ªå­—ç¬¦ä¸²åŒ–çš„<code class="fe mo mp mq mr b">object</code>,å¦‚ä¸‹æ‰€ç¤º:</p><pre class="ms mt mu mv gt mw mr mx my aw mz bi"><span id="1443" class="na lm it mr b gy nb nc l nd ne">type MyType = unknown;<br/><br/>const isValid = (value: string | null): value is string =&gt; [null, undefined, ""].includes(value)<br/><br/>const oldSchool = (): MyType | undefined =&gt; {<br/>  const value: string | null = localStorage.getItem("my_key");<br/><br/>  if (!isValid(value)) {<br/>    return undefined;<br/>  }<br/><br/>  return JSON.parse(value);<br/>};</span></pre><p id="40f8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä»”ç»†æ£€æŸ¥å…¶æœ‰æ•ˆæ€§å¹¶è§£æå›ä¸€ä¸ªå¯¹è±¡ä¹‹å‰ï¼Œæˆ‘å°†é¦–å…ˆä½¿ç”¨<code class="fe mo mp mq mr b">getItem()</code>è·å¾—<code class="fe mo mp mq mr b">string</code>å€¼(æˆ‘å°†ä¿å­˜åœ¨å­˜å‚¨å™¨ä¸­çš„å¯¹è±¡çš„å­—ç¬¦ä¸²åŒ–<code class="fe mo mp mq mr b">JSON.stringify()</code>è¡¨ç¤º)ã€‚</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="3529" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">æ–°å­¦æ ¡</h1><p id="b5c2" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">è™½ç„¶æˆ‘ç°åœ¨ç»§ç»­éµå¾ªä»¥å‰çš„é€»è¾‘(â€œè¯»å–ã€æ£€æŸ¥æœ‰æ•ˆæ€§å’Œè§£æâ€)ï¼Œä½†æˆ‘ç°åœ¨æ­£åœ¨è§£æ„å­˜å‚¨ä»¥è¯»å–å€¼ã€‚</p><pre class="ms mt mu mv gt mw mr mx my aw mz bi"><span id="586d" class="na lm it mr b gy nb nc l nd ne">const newSchool = (): MyType | undefined =&gt; {<br/>  const { my_key: value }: Storage = localStorage;<br/><br/>  if (!isValid(value)) {<br/>    return undefined;<br/>  }<br/><br/>  return JSON.parse(value);<br/>};</span></pre><p id="9870" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">åŒæ ·ï¼Œæ²¡æœ‰ç‰¹åˆ«çš„åŸå› ï¼Œä½†æ˜¯ï¼Œå®ƒä¸æ˜¯æ›´é—ªäº®å—ï¼ŸğŸ‘¨â€ğŸ¨</p><p id="ee86" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">è¿™ç§æ–¹æ³•åœ¨TypeScriptä¸­æ˜¯å¯è¡Œçš„ï¼Œå› ä¸ºå­˜å‚¨æ¥å£â€”â€”è¡¨ç¤º<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API" rel="noopener ugc nofollow" target="_blank">å­˜å‚¨API</a>â€”â€”å®é™…ä¸Šè¢«å£°æ˜ä¸º<code class="fe mo mp mq mr b">any</code>ç±»å‹çš„é”®æ˜ å°„ã€‚</p><pre class="ms mt mu mv gt mw mr mx my aw mz bi"><span id="a7b2" class="na lm it mr b gy nb nc l nd ne">interface Storage {<br/>    readonly length: number;<br/>    clear(): void;<br/>    getItem(key: string): string | null;<br/>    key(index: number): string | null;<br/>    removeItem(key: string): void;<br/>    setItem(key: string, value: string): void;<br/>    // HERE ğŸ˜ƒ [name: string]: any;<br/>    [name: string]: any;<br/>}</span></pre></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="725d" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">SSRå’Œé¢„æ¸²æŸ“</h1><p id="ba11" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated"><code class="fe mo mp mq mr b">localstorage</code>æ˜¯<code class="fe mo mp mq mr b">window</code>ç•Œé¢çš„åªè¯»å±æ€§ï¼Œå³å®ƒåªå­˜åœ¨äºæµè§ˆå™¨ä¸­ã€‚ä¸ºäº†é˜²æ­¢æˆ‘çš„SvelteKitçš„é™æ€æ„å»ºåœ¨ä½¿ç”¨æ—¶å´©æºƒï¼Œæˆ‘ä¸ºNodeJSä¸Šä¸‹æ–‡è®¾ç½®äº†ä¸€ä¸ª<code class="fe mo mp mq mr b">undefined</code>å›é€€å€¼ã€‚</p><p id="029d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æ­¤å¤–ï¼Œé™¤äº†è§£æ„æ¨¡å¼ä¹‹å¤–ï¼Œæˆ‘è¿˜å–œæ¬¢å°†æ‰€æœ‰å†…å®¹(ğŸ˜„).æ‰€ä»¥ï¼Œæˆ‘æƒ³å‡ºäº†ä¸‹é¢çš„ä»£ç ç‰‡æ®µæ¥è§£å†³æˆ‘çš„çµæ„Ÿ:</p><pre class="ms mt mu mv gt mw mr mx my aw mz bi"><span id="144d" class="na lm it mr b gy nb nc l nd ne">import { browser } from "$app/env";<br/><br/>const newSchool = (): MyType | undefined =&gt; {<br/>  const { my_key: value }: Storage = browser<br/>    ? localStorage<br/>    : ({ my_key: undefined } as unknown as Storage);<br/><br/>  if (!isValid(value)) {<br/>    return undefined;<br/>  }<br/><br/>  return JSON.parse(value);<br/>};</span></pre></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="e7f7" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">ä¸€èˆ¬çš„</h1><p id="0a4e" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä½ å¯èƒ½ä¼šè¯´â€œæ˜¯çš„ï¼Œå¤§å«ï¼Œå¾ˆå¥½ï¼Œè¿™å¾ˆé…·ï¼Œä½†æ˜¯ï¼Œå¯é‡ç”¨æ€§å‘¢ï¼Ÿâ€ã€‚å¯¹æ­¤ï¼Œæˆ‘ä¼šå›ç­”â€œæ‹¿ç€æˆ‘çš„å•¤é…’ï¼Œä½ å¯ä»¥åŠ¨æ€è§£æ„å¯¹è±¡â€ğŸ˜‰ã€‚</p><pre class="ms mt mu mv gt mw mr mx my aw mz bi"><span id="7150" class="na lm it mr b gy nb nc l nd ne">const newSchool = &lt;T&gt;(key: string): T | undefined =&gt; {<br/>  const { [key]: value }: Storage = browser<br/>    ? localStorage<br/>    : ({ [key]: undefined } as unknown as Storage);<br/><br/>  if (!isValid(value)) {<br/>    return undefined;<br/>  }<br/><br/>  return JSON.parse(value);<br/>};</span></pre></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="d49d" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">æ‘˜è¦</h1><p id="0bd0" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">è¿”å›<code class="fe mo mp mq mr b">undefined</code>å¯¹äºæ¼”ç¤ºæ¥è¯´å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯åœ¨å®é™…å®ç°ä¸­â€”â€”æ¯”å¦‚æˆ‘ä»Šå¤©æ—©ä¸Šåœ¨<a class="ae kf" href="https://papy.rs/" rel="noopener ugc nofollow" target="_blank"> Papyrs </a>(ä¸€ä¸ªweb3åšå®¢å¹³å°)ä¸­å‘å¸ƒçš„â€”â€”ä½¿ç”¨é»˜è®¤çš„å›é€€å€¼å¯èƒ½æ›´æœ‰ç”¨ã€‚</p><p id="0716" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å› æ­¤ï¼Œè¿™æ˜¯æˆ‘çš„æ³›å‹å‡½æ•°çš„æœ€ç»ˆå½¢å¼ï¼Œä½¿ç”¨æœ‰è¶£çš„ä¸œè¥¿ï¼Œå¦‚è§£æ„å¯¹è±¡ã€æ–­è¨€å’Œæ³›å‹ï¼Œè¯»å–ä¿å­˜åœ¨TypeScriptçš„<code class="fe mo mp mq mr b">localstorage</code>ä¸­çš„é¡¹ç›®ã€‚</p><pre class="ms mt mu mv gt mw mr mx my aw mz bi"><span id="3b53" class="na lm it mr b gy nb nc l nd ne">import { browser } from "$app/env";<br/><br/>const isValid = (value: string | null): value is string =&gt;<br/>  [null, undefined, ""].includes(value);<br/><br/>const getStorageItem = &lt;T&gt;({<br/>  key,<br/>  defaultValue,<br/>}: {<br/>  key: string;<br/>  defaultValue: T;<br/>}): T =&gt; {<br/>  const { [key]: value }: Storage = browser<br/>    ? localStorage<br/>    : ({ [key]: undefined } as unknown as Storage);<br/><br/>  if (!isValid(value)) {<br/>    return defaultValue;<br/>  }<br/><br/>  return JSON.parse(value);<br/>};</span></pre><p id="76a9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æ— é™å’Œè¶…è¶Š<br/>å¤§å«</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="35a9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æ›´å¤šå†’é™©ï¼Œè¯·åœ¨ğŸ––æ¨ç‰¹ä¸Šå…³æ³¨æˆ‘</p></div></div>    
</body>
</html>