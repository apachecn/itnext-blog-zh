<html>
<head>
<title>Using Rook On A K3s Cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">åœ¨K3sé›†ç¾¤ä¸Šä½¿ç”¨è½¦</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/using-rook-on-a-k3s-cluster-8a97a75ba25e?source=collection_archive---------0-----------------------#2021-03-19">https://itnext.io/using-rook-on-a-k3s-cluster-8a97a75ba25e?source=collection_archive---------0-----------------------#2021-03-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8a78" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">åœ¨æœ¬åœ°æœºå™¨ä¸Šå‘ç°å’Œç©è½¦çš„ç®€å•æ–¹æ³•</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/69f1f54898635f09d6a094e689d9c049.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9v95gn_opSu8U_HISAtCsw.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">ç…§ç‰‡ç”±<a class="ae ky" href="/s/photos/storage?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šçš„<a class="ae ky" href="https://unsplash.com/@jannerboy62?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">å°¼å…‹Â·è´¹å› æ–¯</a>æ‹æ‘„</figcaption></figure><p id="7533" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åœ¨<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/deploy-a-ceph-cluster-on-kubernetes-with-rook-d75a20c3f5b1">çš„ä¸Šä¸€ç¯‡æ–‡ç« </a>ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†<a class="ae ky" href="https://rook.io" rel="noopener ugc nofollow" target="_blank">è½¦</a>ï¼Œå¹¶ä½¿ç”¨å®ƒå»ºç«‹äº†ä¸€ä¸ªHA Cephé›†ç¾¤ã€‚åœ¨è¿™ç¯‡æ–°æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨å•èŠ‚ç‚¹<a class="ae ky" href="https://k3s.io" rel="noopener ugc nofollow" target="_blank"> K3s </a>é›†ç¾¤ä¸Šå®‰è£…Rookï¼Œå› ä¸ºè¿™æ˜¯å¼€å§‹è¿™ä¸ªä¼Ÿå¤§çš„<a class="ae ky" href="https://cncf.io" rel="noopener ugc nofollow" target="_blank"> CNCF </a>é¡¹ç›®çš„å¥½æ–¹æ³•ã€‚</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="6cfa" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated"><strong class="ak">k3sé›†ç¾¤çš„è®¾ç½®</strong></h2><p id="1aac" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">å‡ºäºæœ¬æ–‡çš„ç›®çš„ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åœ¨<a class="ae ky" href="https://virtualbox.org" rel="noopener ugc nofollow" target="_blank"> VirtualBox </a>ä¸Šé€šè¿‡<a class="ae ky" href="https://vagrantup.com" rel="noopener ugc nofollow" target="_blank">vagger</a>æä¾›çš„æœ¬åœ°è™šæ‹Ÿæœºã€‚ä¸‹é¢çš„æµæµªè€…æ–‡ä»¶å®šä¹‰äº†:</p><ul class=""><li id="e402" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">å°†è¦åˆ›å»ºçš„è™šæ‹Ÿæœºçš„é…ç½®:ä½¿ç”¨çš„Linuxå‘è¡Œç‰ˆã€å…¶IPåœ°å€(192.168.33.10)ã€RAMçš„æ•°é‡(2G)ã€æ·»åŠ ä¸€ä¸ªå®¹é‡ä¸º10Gçš„ç£ç›˜</li><li id="a3a8" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">è®¾ç½®K3så¹¶æ¢å¤ç›¸å…³çš„kubeconfigæ–‡ä»¶</li></ul><p id="2653" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ğŸ”¥é‡è¦çš„æ˜¯å°†ä¸€ä¸ªæœªæ ¼å¼åŒ–çš„ç£ç›˜(åŸå§‹è®¾å¤‡)è¿æ¥åˆ°å°†è¦åˆ›å»ºçš„è™šæ‹Ÿæœºã€‚ä¸‹é¢æˆ‘ä»¬å°†å‘Šè¯‰Rookä½¿ç”¨è¿™ä¸ªç£ç›˜æ¥ä¿å­˜Cephé›†ç¾¤çš„æ•°æ®ã€‚</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="0c83" class="mc md it np b gy nt nu l nv nw"># -*- mode: ruby -*-<br/># vi: set ft=ruby :<br/><br/>Vagrant.configure("2") do |config|<br/>  config.vm.box = "hashicorp/bionic64"<br/>  config.vm.network "private_network", ip: "192.168.33.10"<br/>  config.vm.disk :disk, size: "10GB", name: "osd"<br/>  config.vm.provider "virtualbox" do |vb|<br/>    vb.memory = "2048"<br/>  end<br/>  config.vm.provision "shell", inline: &lt;&lt;-SHELL<br/>    curl https://get.k3s.io | sh<br/>    sudo cp /etc/rancher/k3s/k3s.yaml /vagrant/kubeconfig.k3s<br/>    sed -i "s/127.0.0.1/192.168.33.10/" /vagrant/kubeconfig.k3s<br/>  SHELL<br/>end</span></pre><p id="0eee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ğŸ”¥config.vm.diskæŒ‡ä»¤æ˜¯ä¸€ä¸ªå®éªŒæ€§çš„ç‰¹æ€§ï¼Œéœ€è¦ä½¿ç”¨ç¯å¢ƒå˜é‡lavour _ EXPERIMENTALæ¥åˆ›å»ºè¿™ä¸ªè™šæ‹Ÿæœº:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="47e3" class="mc md it np b gy nt nu l nv nw">$ VAGRANT_EXPERIMENTAL="disks" vagrant up</span></pre><p id="175f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä¸€æ—¦åˆ›å»ºäº†VMså¹¶è®¾ç½®äº†é›†ç¾¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨åœ¨æœ¬åœ°æ–‡ä»¶å¤¹ä¸­åˆ›å»ºçš„kubeconfig.k3sæ–‡ä»¶æ¥é…ç½®æœ¬åœ°kubectläºŒè¿›åˆ¶æ–‡ä»¶:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="0c42" class="mc md it np b gy nt nu l nv nw">$ export KUBECONFIG=$PWD/kubeconfig.k3s</span></pre><p id="7e2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç¾¤é›†é€šä¿¡å¹¶åˆ—å‡ºå…¶èŠ‚ç‚¹(åœ¨æœ¬ä¾‹ä¸­åªæœ‰ä¸€ä¸ª):</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="4cc9" class="mc md it np b gy nt nu l nv nw">$ kubectl get nodes<br/>NAME      STATUS   ROLES                  AGE   VERSION<br/>vagrant   Ready    control-plane,master   31s   v1.20.4+k3s1</span></pre><p id="1e59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åŒæ—¶ï¼Œæˆ‘ä»¬ç¡®ä¿10Gç£ç›˜å·²ç»è¿æ¥åˆ°è™šæ‹Ÿæœºã€‚è¯¥ç£ç›˜åº”è¯¥æ˜¾ç¤ºä¸ºdevice /dev/sdbï¼Œå¦‚ä»¥ä¸‹å‘½ä»¤æ‰€ç¤º:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="40a8" class="mc md it np b gy nt nu l nv nw">$ vagrant ssh -- sudo fdisk -l | grep 'Disk /dev/sd*'<br/>Disk /dev/sda: 64 GiB, 68719476736 bytes, 134217728 sectors<br/>Disk /dev/sdb: 10 GiB, 10737418240 bytes, 20971520 sectors</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="f5d1" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated"><strong class="ak">è½¦å®‰è£…</strong></h2><p id="93ad" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">é¦–å…ˆï¼Œéœ€è¦æ£€ç´¢GitHubä¸ŠRooké¡¹ç›®æœ€åä¸€ä¸ªæ ‡ç­¾å¯¹åº”çš„åˆ†æ”¯ï¼Œå¹¶å¯¼èˆªåˆ°<em class="nx">Rook/cluster/examples/kubernetes/ceph</em>ç›®å½•:</p><p id="f7e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ³¨:Rookç›®å‰çš„æœ€æ–°ç‰ˆæœ¬æ˜¯v 1 . 5 . 8(2021å¹´3æœˆ)</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="c3de" class="mc md it np b gy nt nu l nv nw">$ git clone --branch v1.5.8 <a class="ae ky" href="https://github.com/rook/rook.git" rel="noopener ugc nofollow" target="_blank">https://github.com/rook/rook.git</a></span><span id="9f51" class="mc md it np b gy ny nu l nv nw">$ cd rook/cluster/examples/kubernetes/ceph</span></pre><p id="87ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç„¶åï¼Œæˆ‘ä»¬éƒ¨ç½²ä¸“é—¨ç”¨äºè®¾ç½®Cephé›†ç¾¤çš„æ“ä½œå™¨ä»¥åŠå®ƒæ‰€ä¾èµ–çš„èµ„æº:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="db73" class="mc md it np b gy nt nu l nv nw">kubectl apply -f crds.yaml -f common.yaml</span><span id="6a47" class="mc md it np b gy ny nu l nv nw">kubectl apply -f operator.yaml</span></pre><blockquote class="nz oa ob"><p id="19ae" class="kz la nx lb b lc ld ju le lf lg jx lh oc lj lk ll od ln lo lp oe lr ls lt lu im bi translated">æ³¨æ„:operatoræ˜¯ä¸€ä¸ªåœ¨Podä¸­è¿è¡Œçš„è¿›ç¨‹ï¼Œå®ƒå°†è´Ÿè´£æ ¹æ®ç¨åæä¾›çš„è§„èŒƒé…ç½®Cephé›†ç¾¤</p></blockquote><p id="4232" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç„¶åï¼Œæˆ‘ä»¬ç¡®ä¿æ“ä½œå‘˜çš„Podå¤„äº<strong class="lb iu">è¿è¡Œ</strong>çŠ¶æ€:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="80b5" class="mc md it np b gy nt nu l nv nw">$ kubectl get pod -n rook-ceph<br/>NAME                                 READY  STATUS  RESTARTS   AGE<br/>rook-ceph-operator-6b8b9958c5-2xf5z  1/1    Running 0          48s</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="39ff" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated"><strong class="ak"> Cephé›†ç¾¤åˆ›å»º</strong></h2><p id="8f90" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">æˆ‘ä»¬ç°åœ¨å°†åˆ›å»ºä¸€ä¸ªç±»å‹ä¸º<strong class="lb iu"> CephCluster </strong>çš„èµ„æºã€‚æˆ‘ä»¬ä¹‹å‰éƒ¨ç½²çš„æ“ä½œç¬¦å°†è‡ªåŠ¨æ£€æµ‹è¿™ä¸ªèµ„æºï¼Œå¹¶ä»ä¸­åˆ›å»ºä¸€ä¸ªCephé›†ç¾¤ã€‚å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ä½¿ç”¨<em class="nx"> cluster-test.yaml </em>ä¸­å¯ç”¨çš„è§„èŒƒæ¥åˆ›å»º<strong class="lb iu"> CephCluster </strong>èµ„æº:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="0342" class="mc md it np b gy nt nu l nv nw">$ kubectl apply -f cluster-test.yaml</span></pre><blockquote class="nz oa ob"><p id="c6c3" class="kz la nx lb b lc ld ju le lf lg jx lh oc lj lk ll od ln lo lp oe lr ls lt lu im bi translated">æ³¨:cluster-test.yamlä¸­æŒ‡å®šçš„èµ„æºç”¨äºåœ¨æµ‹è¯•ç¯å¢ƒä¸­å»ºç«‹ä¸€ä¸ªCephé›†ç¾¤ã€‚å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œæˆ‘ä»¬å°†ä½¿ç”¨cluster.yamlæ–‡ä»¶ä»¥åŠå¤šèŠ‚ç‚¹Kubernetesé›†ç¾¤</p></blockquote><p id="e0eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å‡ åˆ†é’Ÿåï¼Œè´Ÿè´£Cephå­˜å‚¨çš„åŠèˆ±å°†è¢«éƒ¨ç½²ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥å®ƒä»¬æ˜¯å¦è¿è¡Œæ­£å¸¸:</p><blockquote class="nz oa ob"><p id="c25e" class="kz la nx lb b lc ld ju le lf lg jx lh oc lj lk ll od ln lo lp oe lr ls lt lu im bi translated">æ³¨æ„:æ‰€æœ‰ä¸Cephç›¸å…³çš„å…ƒç´ éƒ½æ˜¯åœ¨åç§°ç©ºé—´rook-cephä¸­åˆ›å»ºçš„</p></blockquote><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="24ad" class="mc md it np b gy nt nu l nv nw">$ kubectl get pod -n rook-ceph<br/>NAME                                 READY  STATUS   RESTARTS   AGE<br/>rook-ceph-operator-6b8b9958c5-2xf5z  1/1    Running   0          12m<br/>rook-ceph-mon-a-6d6fd795f6-bqqj2     1/1    Running   0          71s<br/>rook-ceph-mgr-a-67fd7cdf4-vggs7      1/1    Running   0          59s<br/>rook-ceph-osd-prepare-vagrant-kh44x  0/1    Completed 0          57s<br/>rook-ceph-osd-0-84f59c9898-wkk8l     1/1    Running   0          33s<br/>csi-cephfsplugin-dwptn               3/3    Running   0          20s<br/>csi-rbdplugin-vj7zt                  3/3    Running   0          21s<br/>csi-rbdplugin-provisioner-6b...      6/6    Running   0          20s<br/>csi-cephfsplugin-provisioner-86...   6/6    Running   0          19s</span></pre><p id="29aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ğŸ”¥åœ¨å®‰è£…è¿‡ç¨‹ä¸­ï¼ŒRookèƒ½å¤Ÿæ£€æµ‹åˆ°è¿æ¥åˆ°è™šæ‹Ÿæœºçš„æœªæ ¼å¼åŒ–é©±åŠ¨å™¨ã€‚å®ƒè‡ªåŠ¨ä½¿ç”¨è¿™ä¸ªç£ç›˜ä½œä¸ºCephé›†ç¾¤çš„å­˜å‚¨ä»‹è´¨ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹Podæ—¥å¿—æ¥ç¡®è®¤è¿™ä¸€ç‚¹ã€‚</p><p id="8fc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åœ¨å‡ ä¸ªå‘½ä»¤è¡Œä¸­ï¼Œæˆ‘ä»¬éƒ¨ç½²äº†ä¸€ä¸ªRookæ“ä½œç¬¦ï¼Œå¹¶ä½¿ç”¨å®ƒåœ¨K3sä¸­å»ºç«‹äº†ä¸€ä¸ªCephé›†ç¾¤ï¼å¾ˆé…·ï¼Œå¯¹å§ï¼Ÿ</p><p id="dd9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Cephæ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œæä¾›ä¸åŒç±»å‹çš„å­˜å‚¨:</p><ul class=""><li id="2c40" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">åˆ†æ—¶ç”¨å¤–å­˜å‚¨å™¨ç³»ç»Ÿ</li><li id="031d" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">å­˜å‚¨å¯¹è±¡</li><li id="5f24" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">å—å­˜å‚¨å™¨</li></ul><p id="defb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åœ¨ä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å—å­˜å‚¨ä¸ºä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºä¿å­˜æ•°æ®ã€‚</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="6e93" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated"><strong class="ak">å­˜å‚¨ç±»</strong></h2><p id="64d7" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">ä¸ºäº†èƒ½å¤Ÿè‡ªåŠ¨è°ƒé…å—å­˜å‚¨ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªStorageClassã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨åœ¨<em class="nx">cluster/examples/kubernetes/ceph/CSI/rbd/storage class . YAML-test</em>ä¸­å®šä¹‰çš„è§„èŒƒ:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="5451" class="mc md it np b gy nt nu l nv nw"><strong class="np iu">$ kubectl apply -f ./csi/rbd/storageclass-test.yaml<br/></strong>cephblockpool.ceph.rook.io/replicapool created<br/>storageclass.storage.k8s.io/rook-ceph-block created</span></pre><blockquote class="nz oa ob"><p id="e30f" class="kz la nx lb b lc ld ju le lf lg jx lh oc lj lk ll od ln lo lp oe lr ls lt lu im bi translated">æ³¨æ„:é¡¾åæ€ä¹‰ï¼Œstorageclass-test.yamlæ–‡ä»¶é€‚ç”¨äºæµ‹è¯•ç¯å¢ƒã€‚ä¸åº”åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å®ƒï¼Œå› ä¸ºæ­¤é…ç½®ä¸å…è®¸æ•°æ®å¤åˆ¶ã€‚æ–‡ä»¶storageclass.yamlä¸“ç”¨äºä¸ºç”Ÿäº§è®¾ç½®storageclassï¼Œå³å…è®¸ä¸åŒèŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®å¤åˆ¶</p></blockquote><p id="88e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç°åœ¨ï¼Œæˆ‘ä»¬çš„é›†ç¾¤ä¸­å®šä¹‰äº†ä¸¤ä¸ªå­˜å‚¨ç±»:</p><ul class=""><li id="9798" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">local-path:è¿™æ˜¯åœ¨k3så®‰è£…æœŸé—´åˆ›å»ºçš„ï¼Œå¦‚æœåœ¨PersistentVolumeClaimä¸­æ²¡æœ‰æŒ‡å®šStorageClassï¼Œåˆ™é»˜è®¤ä½¿ç”¨å®ƒ</li><li id="0cf5" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">rook-ceph-block:è¿™ä¸ªæ˜¯åˆšåˆšåˆ›å»ºçš„</li></ul><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="fcb6" class="mc md it np b gy nt nu l nv nw">$ kubectl get sc<br/>NAME                   PROVISIONER ...<br/>local-path <strong class="np iu">(default)</strong>   rancher.io/local-path<br/>rook-ceph-block        rook-ceph.rbd.csi.ceph.com</span></pre><p id="5862" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼Œæˆ‘ä»¬å°†ä½¿<strong class="lb iu"> rook-ceph-block </strong>æˆä¸ºé»˜è®¤çš„å­˜å‚¨ç±»ï¼Œè€Œä¸æ˜¯æœ¬åœ°è·¯å¾„ã€‚è¿™åªæ˜¯åœ¨æ¯ä¸ªèµ„æºä¸­ä¿®æ”¹æ³¨é‡Šçš„é—®é¢˜:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="8c2a" class="mc md it np b gy nt nu l nv nw">$ kubectl patch storageclass local-path -p '{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"false"}}}'</span><span id="c7fe" class="mc md it np b gy ny nu l nv nw">$ kubectl patch storageclass rook-ceph-block -p '{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}'</span></pre><p id="0462" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥æ˜¯å¦è¿›è¡Œäº†æ›´æ”¹:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="39a0" class="mc md it np b gy nt nu l nv nw">$ kubectl get sc<br/>NAME                        PROVISIONER ...<br/>local-path                  rancher.io/local-path<br/>rook-ceph-block <strong class="np iu">(default)</strong>   rook-ceph.rbd.csi.ceph.com</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="3d7c" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">æµ‹è¯•åº”ç”¨</h2><p id="08f1" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">æˆ‘ä»¬ç°åœ¨å°†åŸºäºGhostéƒ¨ç½²ä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºï¼ŒGhostæ˜¯ä¸€ä¸ªå¼€æºçš„åšå®¢å¹³å°ã€‚è¯¥åº”ç”¨ç¨‹åºç”±ä»¥ä¸‹3ç§èµ„æºç»„æˆ:</p><ul class=""><li id="949f" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">åŸºäºGhostæ˜ åƒçš„éƒ¨ç½²</li><li id="8197" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">NodePortç±»å‹çš„æœåŠ¡ï¼Œåœ¨ç«¯å£31005ä¸Šå…¬å¼€åº”ç”¨ç¨‹åº</li><li id="278e" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">ä½¿ç”¨é»˜è®¤å­˜å‚¨ç±»è¯·æ±‚1Gå­˜å‚¨çš„PersistentVolumeClaim</li></ul><p id="8f39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¯¥åº”ç”¨çš„è§„æ ¼å®šä¹‰å¦‚ä¸‹ã€‚åœ¨ghostéƒ¨ç½²ä¸­ä½¿ç”¨äº†PersistentVolumeClaim<em class="nx">ghost-PV-claim</em>:ä¸æ­¤PVCå…³è”çš„å­˜å‚¨å°†æŒ‚è½½åœ¨ghostå®¹å™¨ä¸­çš„<em class="nx"> /var/lib/ghost/content </em>ä¸­ï¼Œè¿™æ˜¯Ghostä¿å­˜å…¶æ•°æ®çš„ç›®å½•ã€‚</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="1519" class="mc md it np b gy nt nu l nv nw">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: ghost<br/>spec:<br/>  selector:<br/>    matchLabels:<br/>      app: ghost<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: ghost<br/>    spec:<br/>      containers:<br/>      - name: ghost<br/>        image: ghost<br/>        ports:<br/>        - containerPort: 2368<br/>        volumeMounts:<br/>        - name: ghost-data<br/>          mountPath: /var/lib/ghost/content<br/>      volumes:<br/>      - name: ghost-data<br/>        persistentVolumeClaim:<br/>          claimName: ghost-pv-claim<br/>---<br/>apiVersion: v1<br/>kind: PersistentVolumeClaim<br/>metadata:<br/>  name: ghost-pv-claim<br/>spec:<br/>  accessModes:<br/>    - ReadWriteOnce<br/>  resources:<br/>    requests:<br/>      storage: 1Gi<br/>---<br/>apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: ghost<br/>spec:<br/>  selector:<br/>    app: ghost<br/>  type: NodePort<br/>  ports:<br/>  - port: 80<br/>    targetPort: 2368<br/>    nodePort: 31005</span></pre><p id="3b9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…åº”ç”¨ç¨‹åº:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="c2f0" class="mc md it np b gy nt nu l nv nw"><strong class="np iu">$ kubectl apply -f https://luc.run/ghost-with-pvc.yaml<br/></strong>deployment.apps/ghost created<br/>persistentvolumeclaim/ghost-pv-claim created<br/>service/ghost created</span></pre><p id="1007" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å‡ ç§’é’Ÿåï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å·²ç»åˆ›å»ºäº†ä¸€ä¸ªPersistentVolumeï¼Œå¹¶å°†å…¶ä¸ä¹‹å‰åˆ›å»ºçš„PersistentVolumeClaimç›¸å…³è”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/92a863d9e03933fbdd5e3cd83b72ed73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ipWKOfS0yCZfCq9PKGZp_Q.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">ä¸€ä¸ªæ–°çš„PVè¢«åˆ›å»ºå¹¶ç»‘å®šåˆ°PVC</figcaption></figure><p id="4f13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Ghoståº”ç”¨ç¨‹åºåœ¨ç«¯å£31005ä¸Šå¯ç”¨:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/0599e4cbf660e14f1dec3b43dc88bf14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*poGnSgVcFkJM8cDjhYzHEg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Ghostç•Œé¢</figcaption></figure><p id="dfbc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ‰€æœ‰ghost Podæ•°æ®éƒ½å­˜å‚¨åœ¨è¿æ¥åˆ°é›†ç¾¤èŠ‚ç‚¹çš„é™„åŠ ç£ç›˜ä¸­ã€‚</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="8b9b" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">Cephä»ªè¡¨æ¿å’Œè½¦å·¥å…·ç®±</h2><p id="88a2" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">Cephçš„å®‰è£…è¿˜è®¾ç½®äº†ä¸€ä¸ªwebç®¡ç†ç•Œé¢ã€‚å¯ä»¥é’ˆå¯¹<em class="nx"> rook-ceph-mgr-dashboard </em>æœåŠ¡ä½¿ç”¨<strong class="lb iu"> port-forward </strong>å‘½ä»¤æ¥è®¿é—®å®ƒ:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="df46" class="mc md it np b gy nt nu l nv nw">$ kubectl port-forward svc/rook-ceph-mgr-dashboard 7000:7000 -n rook-ceph</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/df4a89797e37af98fdab4bd9ebc2f243.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KyPeK2n3cIz6Z6BBSql5NA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Cephä»ªè¡¨æ¿</figcaption></figure><p id="501e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç”¨æˆ·åæ˜¯<strong class="lb iu"> adminï¼Œ</strong>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€ç´¢å¯†ç :</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="4e44" class="mc md it np b gy nt nu l nv nw">$ kubectl -n rook-ceph get secret rook-ceph-dashboard-password \<br/>  -o jsonpath="{['data']['password']}" | base64 --decode &amp;&amp; echo</span></pre><p id="4b01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">é€šè¿‡è¯¥ç•Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸è¯¦ç»†åœ°äº†è§£å­˜å‚¨é›†ç¾¤ï¼Œå¦‚ä¸‹é¢çš„å±å¹•æˆªå›¾æ‰€ç¤ºã€‚ä¸è¦çŠ¹è±«å¯¼èˆªï¼Œè¿™æ˜¯ä¸€ä¸ªä¼Ÿå¤§çš„ä¿¡æ¯æ¥æºã€‚</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/9ba3110b735dd7d6ea5e54c0fcf4e7d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*awmyGVvOGYGIiIAlBwAAUQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Cephé›†ç¾¤çš„è¯¦ç»†è§†å›¾</figcaption></figure><p id="3407" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Rookè¿˜æä¾›äº†ä¸€ä¸ªå·¥å…·ç®±ï¼Œå…è®¸æ‚¨ä»å‘½ä»¤è¡Œä¸Cephé›†ç¾¤è¿›è¡Œäº¤äº’ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…è¯¥å·¥å…·ç®±:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="e742" class="mc md it np b gy nt nu l nv nw">$ kubectl apply -f <a class="ae ky" href="https://luc.run/rook/toolbox.yaml" rel="noopener ugc nofollow" target="_blank">https://luc.run/rook/toolbox.yaml</a></span></pre><p id="e0a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ­£ç¡®åˆ›å»ºPodåï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­å¯åŠ¨shell:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="a4bc" class="mc md it np b gy nt nu l nv nw">$ kubectl -n rook-ceph exec -it deploy/rook-ceph-tools -- bash</span></pre><p id="31b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åœ¨Cephé›†ç¾¤ä¸­å¯ä»¥ä½¿ç”¨è®¸å¤šå‘½ä»¤ï¼Œä¾‹å¦‚:</p><ul class=""><li id="7c8c" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">cephçŠ¶æ€</li><li id="cf8d" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">ceph osdçŠ¶æ€</li><li id="44fe" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">ceph df</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="8fc5" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated"><strong class="ak">å…³é”®è¦ç‚¹</strong></h2><p id="3827" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">Rookä½¿å¾—åœ¨æˆ‘ä»¬çš„Kubernetesé›†ç¾¤ä¸­å»ºç«‹Cephé›†ç¾¤åªéœ€è¦å‡ åˆ†é’Ÿçš„æ—¶é—´ã€‚æˆ‘ä»¬è¿˜èƒ½å¤Ÿä½¿ç”¨å—å­˜å‚¨æ¥ä¿å­˜æ¥è‡ªGhoståº”ç”¨ç¨‹åºçš„æ•°æ®ã€‚</p><p id="2222" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªèŠ‚ç‚¹æ¥è¯´æ˜Rookçš„è®¾ç½®ã€‚ä½†æ˜¯ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ‰å¿…è¦ä½¿ç”¨å‡ ä¸ªèŠ‚ç‚¹æ¥ç¡®ä¿å®ƒä»¬ä¹‹é—´çš„æ•°æ®å¤åˆ¶ã€‚</p><p id="6b5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Rookå…è®¸åè°ƒä¸åŒçš„å‚¨ç‰©è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬:</p><ul class=""><li id="c629" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">Ceph(ç¨³å®š)</li><li id="7070" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">å¡æ¡‘å¾·æ‹‰(é˜¿å°”æ³•)</li><li id="4751" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">NFS(é˜¿å°”æ³•)</li></ul><p id="5383" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¿™æ˜¯CNCFçš„æ¯•ä¸šé¡¹ç›®ï¼Œè¯·ä¸è¦çŠ¹è±«ï¼Œç”¨æä¾›çš„å…¶ä»–å­˜å‚¨è§£å†³æ–¹æ¡ˆä¹‹ä¸€æ¥æµ‹è¯•å®ƒã€‚</p></div></div>    
</body>
</html>