<html>
<head>
<title>Creating a Helm repo on Google Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">åœ¨è°·æ­Œäº‘ä¸Šåˆ›å»ºHelm repo</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/creating-a-helm-repo-on-google-cloud-d970cccb60c9?source=collection_archive---------2-----------------------#2020-04-16">https://itnext.io/creating-a-helm-repo-on-google-cloud-d970cccb60c9?source=collection_archive---------2-----------------------#2020-04-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/291d9119b72f0a7349b9998638970c08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*xF00TwYS9MOqQRA3RjTVXg.png"/></div></figure><h1 id="cdf7" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">é—®é¢˜é™ˆè¿°</h1><p id="a783" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">è¿™é¡¹å·¥ä½œçš„é—®é¢˜é™ˆè¿°å¦‚ä¸‹:</p><p id="ad3a" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated"><strong class="ku ir">ä½œä¸ºä¸€å</strong>å¹³å°å·¥ç¨‹å¸ˆ<br/> <strong class="ku ir">æˆ‘å¸Œæœ›</strong>æ–°çš„å›¾è¡¨ç‰ˆæœ¬èƒ½å¤Ÿå°½å¿«åœ¨æ‰€æœ‰envä¸Šå‘å¸ƒã€‚<br/> <strong class="ku ir">ä»¥ä¾¿</strong> HelmReleasesåœ¨å¯åŠ¨æ—¶ä¸ä¼šå› ä¸ºç‰ˆæœ¬ä¸å­˜åœ¨è€Œå¤±è´¥ã€‚<br/> <strong class="ku ir">å’Œ</strong>å¯¹HelmReleasesçš„ä¾èµ–ä¿æŒåœ¨é›†ç¾¤ä¹‹å¤–ã€‚</p><h1 id="d807" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">å½“å‰å®æ–½</h1><p id="e315" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">åœ¨è¿™é¡¹å·¥ä½œå¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬æ›¾ç»æ„å»ºäº†ä¸€ä¸ªèˆµæ³¨å†Œå®¹å™¨ï¼Œä½œä¸ºå°†èˆµå›¾å˜æ›´åˆå¹¶åˆ°<code class="fe lv lw lx ly b">k8s-helm-charts</code>çš„<code class="fe lv lw lx ly b">master</code>åˆ†æ”¯çš„ä¸€éƒ¨åˆ†ã€‚</p><p id="425c" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">ç„¶åï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ªé›†ç¾¤å†…è¿›è¡Œäº†éƒ¨ç½²ï¼Œåº”ç”¨äº†ä»¥ä¸‹fluxæ³¨é‡Š:</p><pre class="lz ma mb mc gt md ly me mf aw mg bi"><span id="3518" class="mh jv iq ly b gy mi mj l mk ml">annotations:<br/>    flux.weave.works/automated: "true"<br/>    flux.weave.works/tag.k8s-helm-charts: semver:~2.0</span></pre><p id="1cc5" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">æ³¨æ„:å½“æˆ‘ä»¬ä½¿ç”¨Helm v2æ—¶ï¼Œå›¾åƒæ ‡ç­¾æ˜¯<code class="fe lv lw lx ly b">2.0.x</code>ã€‚</p><p id="e6b6" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•å­˜åœ¨è®¸å¤šé—®é¢˜:</p><ul class=""><li id="cc44" class="mm mn iq ku b kv lq kz lr ld mo lh mp ll mq lp mr ms mt mu bi translated">æ–°æ˜ åƒéƒ¨ç½²åˆ°æˆ‘ä»¬é›†ç¾¤çš„é€Ÿåº¦</li><li id="02f1" class="mm mn iq ku b kv mv kz mw ld mx lh my ll mz lp mr ms mt mu bi translated">ç¼ºä¹å¯è§æ€§ï¼Œæ— æ³•è½»æ˜“çŸ¥é“å“ªäº›å›¾è¡¨ç‰ˆæœ¬å¯ç”¨</li><li id="39c0" class="mm mn iq ku b kv mv kz mw ld mx lh my ll mz lp mr ms mt mu bi translated">æˆ‘ä»¬æ‰€æœ‰çš„å®šåˆ¶<code class="fe lv lw lx ly b">HelmReleases</code>éƒ½ä¾èµ–äºæœåŠ¡çš„è¿è¡Œ</li></ul><h1 id="72db" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">å¯èƒ½çš„é€‰æ‹©</h1><p id="fa63" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">å½“å¼€å§‹ä»»ä½•ä¸€é¡¹å·¥ä½œæ—¶ï¼Œæœ€å¥½çœ‹ä¸€ä¸‹æˆ‘ä»¬èƒ½å¤„ç†çš„æ‰€æœ‰å¯èƒ½çš„é€‰æ‹©ã€‚</p><h2 id="376b" class="mh jv iq bd jw na nb dn ka nc nd dp ke ld ne nf ki lh ng nh km ll ni nj kq nk bi translated">å›¾è¡¨åšç‰©é¦†</h2><p id="caa2" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">å›¾è¡¨åšç‰©é¦†(<a class="ae nl" href="https://github.com/helm/chartmuseum" rel="noopener ugc nofollow" target="_blank">https://github.com/helm/chartmuseum</a>)æ˜¯ä¸»è¦çš„å¤‡é€‰æ–¹æ¡ˆï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™ä¸æ˜¯ä¸€ä¸ªå¯è¡Œçš„æ–¹æ¡ˆï¼ŒåŸå› å¦‚ä¸‹:</p><ul class=""><li id="f6cd" class="mm mn iq ku b kv lq kz lr ld mo lh mp ll mq lp mr ms mt mu bi translated">å› ä¸ºæˆ‘ä»¬å¸Œæœ›ä¿æŒæ‰€æœ‰ç¯å¢ƒä¹‹é—´çš„â€œç©ºéš™â€,æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ¯ä¸ªç¯å¢ƒéƒ½æœ‰ä¸€ä¸ªS3å­˜å‚¨æ¡¶ï¼Œè¿™å°†ä½¿CIæˆä¸ºæ›´æ–°æ‰€æœ‰ç¯å¢ƒçš„å™©æ¢¦ã€‚æ­¤å¤–ï¼Œå½“å‡çº§åœ¨æŸäº›ç¯å¢ƒä¸‹æœ‰æ•ˆï¼Œè€Œåœ¨å…¶ä»–ç¯å¢ƒä¸‹æ— æ•ˆæ—¶ï¼Œæ‚¨å¦‚ä½•å¤„ç†è¿™ç§æƒ…å†µã€‚</li><li id="ef92" class="mm mn iq ku b kv mv kz mw ld mx lh my ll mz lp mr ms mt mu bi translated">çœŸæ­£çš„éšœç¢æ˜¯chartmuseumæœ¬èº«éœ€è¦åœ¨é›†ç¾¤ä¸­è¿è¡Œï¼Œæ‰€ä»¥ä»å¼•å¯¼çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬ç°åœ¨æ¯”ä»¥å‰æ›´å¥½ã€‚</li></ul><h1 id="00a8" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">è¢«é€‰ä¸­çš„äºº</h1><p id="bf73" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">è¯¥å›¢é˜Ÿå†³å®šé€‰æ‹©ä»è°·æ­Œäº‘å¹³å°(GCP)çš„å­˜å‚¨æ¡¶ä¸­è¿è¡ŒHelmå­˜å‚¨åº“ã€‚é‡‡å–è¿™ç§æ–¹æ³•çš„åŸå› æ˜¯:</p><ul class=""><li id="26b0" class="mm mn iq ku b kv lq kz lr ld mo lh mp ll mq lp mr ms mt mu bi translated">ä»CIçš„è§’åº¦æ¥çœ‹ï¼Œå®ƒæ˜¯â€œä¸€åŠ³æ°¸é€¸çš„â€,ä¸€æ—¦äº§å“åŒ…æ”¾å…¥å­˜å‚¨æ¡¶ä¸­ï¼Œå°±å¯ä»¥ç«‹å³ä»æ‰€æœ‰ç¯å¢ƒä¸­åˆ©ç”¨å®ƒä»¬ã€‚</li><li id="c759" class="mm mn iq ku b kv mv kz mw ld mx lh my ll mz lp mr ms mt mu bi translated">é»˜è®¤æƒ…å†µä¸‹ï¼ŒBucketsæœ‰è‡ªå·±çš„DNSè®°å½•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨æˆ‘ä»¬çš„HelmReleasesä¸­ä½¿ç”¨å®ƒã€‚<br/> <code class="fe lv lw lx ly b"><a class="ae nl" href="https://kubernetes-charts.storage.googleapis.com/" rel="noopener ugc nofollow" target="_blank">https://&lt;bucket name&gt;.storage.googleapis.com</a></code></li><li id="00a2" class="mm mn iq ku b kv mv kz mw ld mx lh my ll mz lp mr ms mt mu bi translated">å­˜å‚¨æ¡¶å¸¦æœ‰ä¸€ä¸ªæ–°çš„ç”¨æˆ·ç•Œé¢ï¼Œä½¿æµè§ˆå®ƒä»¬å’Œæœç´¢å¯¹è±¡å˜å¾—è¶…çº§å®¹æ˜“ï¼Œè¿™æ˜¯å·¥ç¨‹å¸ˆçš„ç†æƒ³é€‰æ‹©ã€‚</li><li id="1d8c" class="mm mn iq ku b kv mv kz mw ld mx lh my ll mz lp mr ms mt mu bi translated">å°†æˆ‘ä»¬çš„é›†ç¾¤æ”¾åœ¨GCPçš„AWSå’ŒHelm Repositoryä¸­æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å…³æ³¨ç‚¹åˆ†ç¦»ï¼Œå¹¶å‡å°‘äº†æˆ‘ä»¬ç°æœ‰åŸºç¡€æ¶æ„å †æ ˆçš„çˆ†ç‚¸åŠå¾„ã€‚</li></ul><h1 id="7e43" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">å±¥è¡Œ</h1><p id="718f" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">æˆ‘ä»¬åœ¨Mettleçš„æ‰€æœ‰åŸºç¡€è®¾æ–½éƒ½ç”±Terraformç®¡ç†ï¼Œå³ä½¿æˆ‘ä»¬éƒ¨ç½²åˆ°GCPï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆä¸åŒã€‚</p><p id="f9be" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">åˆ›å»ºæ­¤æ¡¶å’Œç›¸åº”æœåŠ¡å¸æˆ·çš„Terraformä»£ç å¦‚ä¸‹æ‰€ç¤º:</p><pre class="lz ma mb mc gt md ly me mf aw mg bi"><span id="7cbe" class="mh jv iq ly b gy mi mj l mk ml">data "google_iam_policy" "admin" {<br/>  binding {<br/>    role = "roles/storage.admin"<br/>    members = [<br/>      "serviceAccount:terraform-helm-registry@terraform-helm-registry.iam.gserviceaccount.com",<br/>    ]<br/>  }<br/><br/>  binding {<br/>    role = "roles/storage.objectViewer"<br/>    members = [<br/>      "allUsers",<br/>    ]<br/>  }<br/><br/>}<br/><br/>resource "google_service_account" "helm_registry_service_account" {<br/>  account_id   = "terraform-helm-registry"<br/>  display_name = "CircleCI Service Account for Helm Registry"<br/>  project      = var.project_id<br/>}<br/><br/>resource "google_service_account_key" "mykey" {<br/>  service_account_id = google_service_account.helm_registry_service_account.name<br/>  public_key_type    = "TYPE_X509_PEM_FILE"<br/>}<br/><br/>resource "google_storage_bucket" "this" {<br/>  name               = "&lt;redacted&gt;"<br/>  project            = var.project_id<br/>  location           = var.location<br/>  force_destroy      = var.force_destroy<br/>  bucket_policy_only = var.bucket_policy_only<br/>  versioning {<br/>    enabled = var.bucket_versioning<br/>  }<br/>}<br/><br/>resource "google_storage_bucket_iam_policy" "policy" {<br/>  bucket      = google_storage_bucket.this.name<br/>  policy_data = data.google_iam_policy.admin.policy_data<br/>}</span></pre><p id="ba53" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªbucketå’ŒæœåŠ¡å¸æˆ·ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°CIé…ç½®ï¼Œä»¥å®‰å…¨çš„æ–¹å¼å°†å¿…è¦çš„å¯¹è±¡æ¨é€åˆ°bucketä¸­ã€‚</p><h1 id="03ee" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">CIå˜æ›´</h1><p id="ac5f" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">é¦–å…ˆè¦è€ƒè™‘çš„æ˜¯æˆ‘ä»¬éœ€è¦æ„å»ºçš„è„šæœ¬ï¼Œä»¥å°†å¿…è¦çš„å¯¹è±¡æ¨é€åˆ°æ¡¶æœ¬èº«ã€‚è¿™ä¸ªè„šæœ¬å¯ä»¥åœ¨ä¸‹é¢æ‰¾åˆ°ï¼Œå®ƒæ··åˆä½¿ç”¨äº†<code class="fe lv lw lx ly b">helm package</code>å’Œ<code class="fe lv lw lx ly b">gsutil</code>(è°·æ­Œäº‘å·¥å…·)æ¥æ„å»º<code class="fe lv lw lx ly b">.tgz</code>æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬æ¨é€åˆ°æˆ‘ä»¬åœ¨GCPçš„æ¡¶ä¸­ã€‚</p><pre class="lz ma mb mc gt md ly me mf aw mg bi"><span id="a838" class="mh jv iq ly b gy mi mj l mk ml"><strong class="ly ir">#! /usr/bin/env bash<br/><br/></strong>set -o errexit<br/>set -o nounset<br/>set -o pipefail<br/><br/>readonly HELM_URL=https://storage.googleapis.com/kubernetes-helm<br/>readonly HELM_TARBALL=helm-v2.16.5-linux-amd64.tar.gz<br/>readonly REPO_URL=https://redacted-charts.storage.googleapis.com/<br/>readonly GCS_BUCKET=gs://redacted-charts<br/><br/>main() {<br/>  setup_helm_client<br/><br/>  if ! sync_repo charts "$GCS_BUCKET" "$REPO_URL"; then<br/>      log_error "Not all charts could be packaged and synced!"<br/>  fi<br/>}<br/><br/>setup_helm_client() {<br/>  echo "Setting up Helm client..."<br/><br/>  curl --user-agent curl-ci-sync -sSL -o "$HELM_TARBALL" "$HELM_URL/$HELM_TARBALL"<br/>  tar xzfv "$HELM_TARBALL"<br/><br/>  PATH="$(pwd)/linux-amd64/:$PATH"<br/><br/>  helm init --client-only<br/>}<br/><br/>sync_repo() {<br/>  local repo_dir="${1?Specify repo dir}"<br/>  local bucket="${2?Specify repo bucket}"<br/>  local repo_url="${3?Specify repo url}"<br/>  local sync_dir="${repo_dir}-sync"<br/>  local index_dir="${repo_dir}-index"<br/><br/>  echo "Syncing repo '$repo_dir'..."<br/><br/>  mkdir -p "$sync_dir"<br/>  mkdir -p "$index_dir"<br/><br/>  # Copy the index.yaml file from the bucket.<br/>  if ! gsutil cp "$bucket/index.yaml" "$index_dir/index.yaml"; then<br/>    log_error "Exiting because unable to copy index locally. Not safe to proceed."<br/>    exit 1<br/>  fi<br/><br/>  local return_value=0<br/><br/>  # Loop around each chart and package.<br/>  for dir in "$repo_dir"/*; do<br/>    if helm dependency build "$dir"; then<br/>      helm package --destination "$sync_dir" "$dir"<br/>    else<br/>      log_error "Problem building dependencies. Skipping packaging of '$dir'."<br/>      return_value=1<br/>    fi<br/>  done<br/><br/>  if helm repo index --url "$repo_url" --merge "$index_dir/index.yaml" "$sync_dir"; then<br/><br/>    # Move updated index.yaml to sync folder so we don't push the old one again<br/>    mv -f "$sync_dir/index.yaml" "$index_dir/index.yaml"<br/><br/>    # Push all the local chart tarballs to the bucket.<br/>    gsutil -m rsync "$sync_dir" "$bucket"<br/><br/>    # Make sure index.yaml is synced last<br/>    gsutil cp "$index_dir/index.yaml" "$bucket"<br/><br/>  else<br/>    log_error "Exiting because unable to update index. Not safe to push update."<br/>    exit 1<br/>  fi<br/><br/>  ls -l "$sync_dir"<br/><br/>  return "$return_value"<br/>}<br/><br/><br/>log_error() {<br/>    printf '\e[31mERROR: %s\n\e[39m' "$1" <em class="nm">&gt;&amp;</em>2<br/>}<br/><br/>main</span></pre><p id="b609" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">ä¸ºäº†å°†æ­¤ä¸Circle CIæŒ‚é’©ï¼Œæˆ‘ä»¬æ›´æ–°äº†æˆ‘ä»¬çš„<code class="fe lv lw lx ly b">.circleci/config.yml</code>æ–‡ä»¶ï¼Œä»¥åŒ…æ‹¬ä»¥ä¸‹å†…å®¹:</p><pre class="lz ma mb mc gt md ly me mf aw mg bi"><span id="aaa9" class="mh jv iq ly b gy mi mj l mk ml">publish:<br/>  docker:<br/>    - image: google/cloud-sdk<br/>  steps:<br/>    - checkout<br/>    - setup_remote_docker<br/>    - run:<br/>        name: sync<br/>        command: |<br/>          echo $GCLOUD_SERVICE_KEY | gcloud auth activate-service-account --key-file=-<br/>          gcloud --quiet config set project ${GOOGLE_PROJECT_ID}<br/>          gcloud --quiet config set compute/zone ${GOOGLE_COMPUTE_ZONE}<br/>          bin/sync-repo.sh</span></pre><p id="a1df" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated"><code class="fe lv lw lx ly b">GCLOUD_SERVICE_KEY</code>æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œæ˜¯åœ¨Terraformä¸­æ„å»ºçš„JSONæœåŠ¡å¸æˆ·å¯†é’¥ã€‚</p><p id="6cf6" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">åœ¨è¿æ¥ä¸Šå®ƒä¹‹åï¼Œæˆ‘ä»¬çš„æ¡¶é‡Œè£…æ»¡äº†æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„<code class="fe lv lw lx ly b">HelmReleases</code>ä¸­æ¯«æ— é—®é¢˜åœ°ä½¿ç”¨å®ƒã€‚</p><p id="eafa" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated"><strong class="ku ir">ä»»åŠ¡å®Œæˆâ€¦å—¯ï¼Œè¿˜æ²¡å®Œæˆï¼</strong></p><h1 id="f61e" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">ç¼ºå°‘å›¾è¡¨ç‰ˆæœ¬é—®é¢˜</h1><p id="581c" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">å³ä½¿åœ¨å®Œæˆè¿™æ¬¡è¿ç§»åï¼Œæˆ‘ä»¬çš„ä¸€äº›HelmReleasesä»ç„¶æ˜¾ç¤º<code class="fe lv lw lx ly b">chart version X.Y.Z not could in repository â€¦</code>,å°½ç®¡å›¾è¡¨ç‰ˆæœ¬æ˜æ˜¾å­˜åœ¨äºæ¡¶ä¸­ã€‚</p><p id="77e0" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">åœ¨ç½‘ä¸Šåšäº†ä¸€äº›è°ƒæŸ¥åï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸‹é¢çš„ç‰‡æ®µ:</p><blockquote class="nn no np"><p id="f384" class="ks kt nm ku b kv lq kx ky kz lr lb lc nq ls lf lg nr lt lj lk ns lu ln lo lp ij bi translated">ç¼“å­˜æ§åˆ¶ã€‚åœ¨å¯¹è±¡ä¸ŠæŒ‡å®š<code class="fe lv lw lx ly b"><a class="ae nl" href="https://cloud.google.com/storage/docs/metadata#cache-control" rel="noopener ugc nofollow" target="_blank">Cache-Control</a></code> <a class="ae nl" href="https://cloud.google.com/storage/docs/metadata#cache-control" rel="noopener ugc nofollow" target="_blank">å…ƒæ•°æ®</a>å°†æœ‰åˆ©äºçƒ­å¯¹è±¡æˆ–é¢‘ç¹è®¿é—®çš„å¯¹è±¡çš„è¯»å–å»¶è¿Ÿã€‚å…³äº<code class="fe lv lw lx ly b">Cache-Control</code>ç­‰å¯¹è±¡å…ƒæ•°æ®çš„è®¾ç½®è¯´æ˜ï¼Œè¯·å‚è§<a class="ae nl" href="https://cloud.google.com/storage/docs/viewing-editing-metadata#edit" rel="noopener ugc nofollow" target="_blank">æŸ¥çœ‹å’Œç¼–è¾‘å…ƒæ•°æ®</a>ã€‚</p></blockquote><p id="3b59" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">å› æ­¤ï¼Œæˆ‘ä»¬å†³å®šæ›´æ–°æˆ‘ä»¬çš„è„šæœ¬ï¼Œåœ¨æˆ‘ä»¬æ‰€æœ‰çš„å¯¹è±¡ä¸Šè®¾ç½®<code class="fe lv lw lx ly b">no-cache </code>ã€‚</p><pre class="lz ma mb mc gt md ly me mf aw mg bi"><span id="b749" class="mh jv iq ly b gy mi mj l mk ml">gsutil -m setmeta -h "Cache-Control:no-cache" "$bucket"/*.tgz<br/>gsutil -m setmeta -h "Cache-Control:no-cache" "$bucket"/index.yaml</span></pre><p id="42f8" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">åœ¨åº”ç”¨äº†è¿™äº›è®¾ç½®åï¼ŒFluxç°åœ¨å‡ ä¹å¯ä»¥ç«‹å³çœ‹åˆ°æ–°çš„å›¾è¡¨ç‰ˆæœ¬ï¼Œè¿™ä¸ªé—®é¢˜å·²ç»è§£å†³äº†ã€‚</p><p id="1520" class="pw-post-body-paragraph ks kt iq ku b kv lq kx ky kz lr lb lc ld ls lf lg lh lt lj lk ll lu ln lo lp ij bi translated">å…³äº<code class="fe lv lw lx ly b"> Cache-Control</code>å…ƒæ•°æ®çš„æ›´å¤šä¿¡æ¯ï¼Œæˆ‘å¼ºçƒˆæ¨è<a class="ae nl" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control" rel="noopener ugc nofollow" target="_blank">https://developer . Mozilla . org/en-US/docs/Web/HTTP/Headers/Cache-Control</a>ã€‚</p><h1 id="7f76" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">æ‘˜è¦</h1><p id="66f8" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">æ€»ä¹‹ï¼Œä»ç¼–å†™Terraformä»£ç åˆ°æ›´æ”¹æ‰€æœ‰çš„HelmReleasesä»¥ä½¿ç”¨æ–°çš„å­˜å‚¨åº“ï¼Œè¿™é¡¹å·¥ä½œèŠ±äº†å¤§çº¦ä¸€å¤©æ—¶é—´æ‰å…¨éƒ¨å®Œæˆã€‚å°±æˆæœ¬è€Œè¨€ï¼Œç›®å‰æ‰˜ç®¡æˆ‘ä»¬çš„å›¾è¡¨æ¯æœˆçº¦1ç¾å…ƒï¼Œå¯¹äºå®ƒä¸ºæˆ‘ä»¬çš„å·¥ä½œæµç¨‹æä¾›çš„ä¼˜åŠ¿è€Œè¨€ï¼Œè¿™æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œæˆ‘ä»¬åªæ˜¯å¸Œæœ›æˆ‘ä»¬èƒ½æ—©ç‚¹è¿™æ ·åšğŸ˜</p></div></div>    
</body>
</html>