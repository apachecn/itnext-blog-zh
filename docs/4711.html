<html>
<head>
<title>How to Elastic SIEM (part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•å¼¹æ€§åŒ–SIEM(ç¬¬äºŒéƒ¨åˆ†)</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/how-to-elastic-siem-part-2-bf0940f745e5?source=collection_archive---------0-----------------------#2020-08-29">https://itnext.io/how-to-elastic-siem-part-2-bf0940f745e5?source=collection_archive---------0-----------------------#2020-08-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/9221b594f6306a3e426a395af380e373.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*88hCyuonN53ipu4d.jpg"/></div></div></figure><div class=""/><p id="e50b" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">è¿™æ˜¯ä¸Šä¸€ä¸ªæ•…äº‹<a class="ae kz" rel="noopener ugc nofollow" target="_blank" href="/how-to-elastic-siem-part-1-a39167b8bd23">çš„å»¶ç»­ã€‚è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬å°†æŸ¥çœ‹å¼¹æ€§SIEMä¸­çš„â€œæ£€æµ‹â€é€‰é¡¹å¡ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä½¿ç”¨æˆç†Ÿçš„è§„åˆ™è‡ªåŠ¨æ£€æµ‹IOCã€‚æé†’ä¸€ä¸‹:æˆ‘ä»¬åœ¨å…¶ä¸­ä¸€ä¸ªè™šæ‹Ÿæœºä¸Šå®‰è£…äº†Elasticsearch + Kibanaã€‚æˆ‘ä»¬ç›‘æ§ä¸€ä¸ªUbuntu (Auditbeatï¼ŒFilebeatï¼ŒPacketbeat)å’ŒWindows 10 VM (Winlogbeat)ï¼Œè™½ç„¶åœ¨è¿™ä¸ªæ•…äº‹ä¸­æˆ‘ä»¬å°†é‡ç‚¹æ”¾åœ¨Windowsä¸Šã€‚</a></p><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi la"><img src="../Images/e8c37cc6e56a5fb30a5c2392da67ba0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Sk9TyMmeoU2TZeKX.png"/></div></div></figure><h1 id="e219" class="lf lg je bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">å¦‚ä½•è§£é”å¼¹æ€§SIEMä¸­çš„æ£€æµ‹ï¼Ÿ</h1><p id="579a" class="pw-post-body-paragraph kb kc je kd b ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku mh kw kx ky im bi translated">æˆ‘ä»¬å¿…é¡»:</p><ul class=""><li id="f18b" class="mi mj je kd b ke kf ki kj km mk kq ml ku mm ky mn mo mp mq bi translated">é€šè¿‡TLSæä¾›elastic search-Kibané€šä¿¡</li><li id="94cd" class="mi mj je kd b ke mr ki ms km mt kq mu ku mv ky mn mo mp mq bi translated">åœ¨Elasticsearchä¸­å¯ç”¨xpack.security</li><li id="cec5" class="mi mj je kd b ke mr ki ms km mt kq mu ku mv ky mn mo mp mq bi translated">åœ¨Kibanaä¸­è®¾ç½®xpack . encryptedsavedobjects . encryption key</li></ul><h2 id="d97b" class="mw lg je bd lh mx my dn ll mz na dp lp km nb nc lt kq nd ne lx ku nf ng mb nh bi translated">ä¿æŠ¤å¼¹æ€§æœç´¢</h2><p id="9d99" class="pw-post-body-paragraph kb kc je kd b ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku mh kw kx ky im bi translated">åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå•èŠ‚ç‚¹çš„Elasticsearché›†ç¾¤ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯åœ¨<code class="fe ni nj nk nl b">/etc/elasticsearch/elasticsearch.yml</code>è¡Œçš„æœ«å°¾æ·»åŠ ä¸€è¡Œ</p><pre class="lb lc ld le gt nm nl nn no aw np bi"><span id="5e2d" class="mw lg je nl b gy nq nr l ns nt">xpack.security.enabled:<!-- --> <!-- -->true</span></pre><p id="c222" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">å¹¶é‡æ–°å¯åŠ¨ElasticsearchæœåŠ¡</p><pre class="lb lc ld le gt nm nl nn no aw np bi"><span id="e678" class="mw lg je nl b gy nq nr l ns nt">service elasticsearch restart</span></pre><blockquote class="nu nv nw"><p id="7296" class="kb kc nx kd b ke kf kg kh ki kj kk kl ny kn ko kp nz kr ks kt oa kv kw kx ky im bi translated"><strong class="kd jf">æ³¨æ„</strong>:å¯¹äºæ™®é€šé›†ç¾¤æ¥è¯´ï¼Œè¿™å¹¶ä¸å®¹æ˜“ã€‚æ‚¨éœ€è¦ä¿æŠ¤èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ã€‚<a class="ae kz" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/configuring-tls.html" rel="noopener ugc nofollow" target="_blank">åœ¨è¿™é‡Œä½ å¯ä»¥æ‰¾åˆ°è¯¦ç»†ä¿¡æ¯ã€‚</a></p></blockquote><p id="983e" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æˆ‘ä»¬åˆšåˆšç ´åäº†æ•´ä¸ªæ—¥å¿—ç³»ç»Ÿï¼Œå› ä¸ºä»ç°åœ¨å¼€å§‹éœ€è¦è®¤è¯ğŸ˜‰ã€‚</p><pre class="lb lc ld le gt nm nl nn no aw np bi"><span id="8662" class="mw lg je nl b gy nq nr l ns nt">root@ELK:/etc/elasticsearch# curl localhost:9200?pretty<br/>{<br/>  "error" : {<br/>    "root_cause" : [<br/>      {<br/>        "type" : "security_exception",<br/>        "reason" : "missing authentication credentials for REST request [/?pretty]",<br/>        "header" : {<br/>          "WWW-Authenticate" : "Basic realm=\"security\" charset=\"UTF-8\""<br/>        }<br/>      }<br/>    ],<br/>    "type" : "security_exception",<br/>    "reason" : "missing authentication credentials for REST request [/?pretty]",<br/>    "header" : {<br/>      "WWW-Authenticate" : "Basic realm=\"security\" charset=\"UTF-8\""<br/>    }<br/>  },<br/>  "status" : 401<br/>}</span></pre><p id="062b" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æˆ‘ä»¬éœ€è¦ç”Ÿæˆé»˜è®¤å¸æˆ·å’Œå¯†ç ã€‚ä¸ºæ­¤ä½¿ç”¨äº†ä¸€ä¸ªç‰¹æ®Šçš„<code class="fe ni nj nk nl b">elasticsearch-setup-passwords</code>å·¥å…·ï¼Œä½äºElasticsearchç›®å½•ä¸‹ï¼Œå³<code class="fe ni nj nk nl b">/usr/share/elasticsearch/bin/</code>ã€‚æˆ‘åœ¨ä»»ä½•åœ°æ–¹éƒ½ä½¿ç”¨ç›¸åŒçš„å¯†ç (<em class="nx">å¼¹æ€§</em>)ã€‚è¯·ä¸è¦é‡å¤é‚£ä¸ªğŸ˜Šã€‚</p><pre class="lb lc ld le gt nm nl nn no aw np bi"><span id="ed6d" class="mw lg je nl b gy nq nr l ns nt">root@ELK:/etc/elasticsearch# cd /usr/share/elasticsearch/<br/>root@ELK:/usr/share/elasticsearch# bin/elasticsearch-setup-passwords interactive<br/>Initiating the setup of passwords for reserved users elastic,apm_system,kibana,kibana_system,logstash_system,beats_system,remote_monitoring_user.<br/>You will be prompted to enter passwords as the process progresses.<br/>Please confirm that you would like to continue [y/N]y<br/> <br/> <br/>Enter password for [elastic]:<br/>Reenter password for [elastic]:<br/>Enter password for [apm_system]:<br/>Reenter password for [apm_system]:<br/>Enter password for [kibana_system]:<br/>Reenter password for [kibana_system]:<br/>Enter password for [logstash_system]:<br/>Reenter password for [logstash_system]:<br/>Enter password for [beats_system]:<br/>Reenter password for [beats_system]:<br/>Enter password for [remote_monitoring_user]:<br/>Reenter password for [remote_monitoring_user]:<br/>Changed password for user [apm_system]<br/>Changed password for user [kibana_system]<br/>Changed password for user [kibana]<br/>Changed password for user [logstash_system]<br/>Changed password for user [beats_system]<br/>Changed password for user [remote_monitoring_user]<br/>Changed password for user [elastic]</span></pre><p id="bd87" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ç°åœ¨Elasticsearchä¼šåœ¨æˆ‘ä»¬æä¾›ç™»å½•åå’Œå¯†ç åå›å¤ã€‚</p><pre class="lb lc ld le gt nm nl nn no aw np bi"><span id="4792" class="mw lg je nl b gy nq nr l ns nt">root@ELK:/usr/share/elasticsearch# curl -u elastic:elastic localhost:9200?pretty <br/>{                                                                                <br/>  "name" : "ELK",                                                                <br/>  "cluster_name" : "siem",                                                       <br/>  "cluster_uuid" : "u6FDeHNsTmWJcnf-jYUH7Q",                                     <br/>  "version" : {                                                                  <br/>    "number" : "7.8.1",                                                          <br/>    "build_flavor" : "default",                                                  <br/>    "build_type" : "deb",                                                        <br/>    "build_hash" : "b5ca9c58fb664ca8bf9e4057fc229b3396bf3a89",                   <br/>    "build_date" : "2020-07-21T16:40:44.668009Z",                                <br/>    "build_snapshot" : false,                                                    <br/>    "lucene_version" : "8.5.1",                                                  <br/>    "minimum_wire_compatibility_version" : "6.8.0",                              <br/>    "minimum_index_compatibility_version" : "6.0.0-beta1"                       <br/>  },                                                                             <br/>  "tagline" : "You Know, for Search"                                            <br/>}</span></pre><p id="938b" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æˆ‘ä»¬è¿˜éœ€è¦é€šè¿‡å°†ç™»å½•åå’Œå¯†ç æ·»åŠ åˆ°<code class="fe ni nj nk nl b">/etc/kibana/kibana.yml</code>æ¥â€œä¿®å¤â€Kibana</p><pre class="lb lc ld le gt nm nl nn no aw np bi"><span id="a38a" class="mw lg je nl b gy nq nr l ns nt">...<br/>elasticsearch.username: "kibana_system"<br/>elasticsearch.password: "elastic"<br/>...</span></pre><h2 id="8026" class="mw lg je bd lh mx my dn ll mz na dp lp km nb nc lt kq nd ne lx ku nf ng mb nh bi translated">Elasticsearchå’ŒKibanaä¹‹é—´çš„TLS</h2><p id="75d8" class="pw-post-body-paragraph kb kc je kd b ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku mh kw kx ky im bi translated">è¦é…ç½®TLSï¼Œæˆ‘ä»¬éœ€è¦CAå’Œè¯ä¹¦ã€‚å¦‚æœä½ æœ‰PKIâ€”â€”å¾ˆå¥½â€”â€”å¦‚æœæ²¡æœ‰ï¼Œä½ éœ€è¦ç”ŸæˆCAã€‚Elasticsearchæœ‰ä¸€ä¸ªå«åš<code class="fe ni nj nk nl b">elasticsearch-certutil</code>çš„ç‰¹æ®Šå·¥å…·ï¼Œå®ƒä¼šç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚</p><pre class="lb lc ld le gt nm nl nn no aw np bi"><span id="6001" class="mw lg je nl b gy nq nr l ns nt">root@ELK:/usr/share/elasticsearch# ./bin/elasticsearch-certutil ca<br/>This tool assists you in the generation of X.509 certificates and certificate<br/>signing requests for use with SSL/TLS in the Elastic stack.<br/> <br/>The 'ca' mode generates a new 'certificate authority'<br/>This will create a new X.509 certificate and private key that can be used<br/>to sign certificate when running in 'cert' mode.<br/> <br/>Use the 'ca-dn' option if you wish to configure the 'distinguished name'<br/>of the certificate authority<br/> <br/>By default the 'ca' mode produces a single PKCS#12 output file which holds:<br/>    * The CA certificate<br/>    * The CA's private key<br/> <br/>If you elect to generate PEM format certificates (the -pem option), then the output will<br/>be a zip file containing individual files for the CA certificate and private key<br/> <br/>Please enter the desired output file [elastic-stack-ca.p12]:<br/>Enter password for elastic-stack-ca.p12 :</span></pre><p id="6f07" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ç”ŸæˆCA ( <code class="fe ni nj nk nl b">elastic-stack-ca.p12</code>)åï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªè¯ä¹¦ã€‚</p><pre class="lb lc ld le gt nm nl nn no aw np bi"><span id="ee44" class="mw lg je nl b gy nq nr l ns nt">./bin/elasticsearch-certutil cert --ca elastic-stack-ca.p./bin/elasticsearch-certutil cert \<br/>&gt; --ca elastic-stack-ca.p12 \<br/>&gt; --dns localhost \<br/>&gt; --ip 127.0.0.1 \<br/>&gt; --out http.p12</span></pre><p id="ed86" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ç”Ÿæˆçš„http.12æ”¾åœ¨<code class="fe ni nj nk nl b">/etc/elasticsearch/certs/</code>ä¸­ï¼Œå¹¶è®¾ç½®äº†å¯¹è¯¥æ–‡ä»¶å¤¹çš„æƒé™ã€‚</p><pre class="lb lc ld le gt nm nl nn no aw np bi"><span id="83b9" class="mw lg je nl b gy nq nr l ns nt">mkdir /etc/elasticsearch/certs<br/>cp elastic-stack-ca.p12 /etc/elasticsearch/certs/<br/>cp http.p12 /etc/elasticsearch/certs/<br/>chown -R elasticsearch:elasticsearch /etc/elasticsearch/certs/</span></pre><p id="7571" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ç°åœ¨ï¼Œåœ¨<code class="fe ni nj nk nl b">/etc/elasticsearch/elasticsearch.yml</code>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ åˆ›å»ºçš„è¯ä¹¦ã€‚å¦‚æœæ‚¨ä¸å–œæ¬¢åœ¨é…ç½®æ–‡ä»¶ä¸­æ˜ç¡®è¾“å…¥æ‚¨çš„å¯†ç ï¼Œè¿˜æœ‰ä¸€ä¸ªå¸¦æœ‰å¯†é’¥åº“çš„é€‰é¡¹ã€‚</p><pre class="lb lc ld le gt nm nl nn no aw np bi"><span id="89f7" class="mw lg je nl b gy nq nr l ns nt">...<br/>xpack.security.http.ssl.enabled: true<br/>xpack.security.http.ssl.keystore.path: "./certs/http.p12"<br/>xpack.security.http.ssl.keystore.password: "elastic"</span></pre><p id="17cb" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">é‡æ–°å¯åŠ¨æœåŠ¡åï¼Œæˆ‘ä»¬å¯ä»¥å‘é›†ç¾¤å‘é€è¯·æ±‚ã€‚</p><pre class="lb lc ld le gt nm nl nn no aw np bi"><span id="1491" class="mw lg je nl b gy nq nr l ns nt">root@ELK:/etc/elasticsearch# curl -u elastic:elastic localhost:9200?pretty<br/>curl: (52) Empty reply from server</span></pre><p id="2d88" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æˆ‘ä»¬éœ€è¦å°†urlæ”¹ä¸º<code class="fe ni nj nk nl b"><a class="ae kz" href="https://" rel="noopener ugc nofollow" target="_blank">https://</a>...</code>ï¼Œä½†æ˜¯ä¸å¯ä¿¡çš„CAä¼šæœ‰é—®é¢˜ã€‚</p><pre class="lb lc ld le gt nm nl nn no aw np bi"><span id="0e58" class="mw lg je nl b gy nq nr l ns nt">root@ELK:/etc/elasticsearch# curl -u elastic:elastic <a class="ae kz" href="https://localhost:9200?pretty" rel="noopener ugc nofollow" target="_blank">https://localhost:9200?pretty</a><br/>curl: (60) SSL certificate problem: self signed certificate in certificate chain<br/>More details here: <a class="ae kz" href="https://curl.haxx.se/docs/sslcerts.html" rel="noopener ugc nofollow" target="_blank">https://curl.haxx.se/docs/sslcerts.html</a><br/> <br/>curl failed to verify the legitimacy of the server and therefore could not<br/>establish a secure connection to it. To learn more about this situation and<br/>how to fix it, please visit the web page mentioned above.</span></pre><p id="9e10" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">â€¦æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code class="fe ni nj nk nl b">--insecure</code>å¿½ç•¥å®ƒğŸ˜ã€‚</p><pre class="lb lc ld le gt nm nl nn no aw np bi"><span id="87f8" class="mw lg je nl b gy nq nr l ns nt">root@ELK:/etc/elasticsearch# curl -u elastic:elastic --insecure <a class="ae kz" href="https://localhost:9200?pretty" rel="noopener ugc nofollow" target="_blank">https://localhost:9200?pretty</a> <br/>{                                   <br/>  "name" : "ELK",                   <br/>  "cluster_name" : "siem",          <br/>  "cluster_uuid" : "u6FDeHNsTmWJcnf-<br/>  "version" : {                     <br/>    "number" : "7.8.1",             <br/>    "build_flavor" : "default",     <br/>    "build_type" : "deb",           <br/>    "build_hash" : "b5ca9c58fb664ca8<br/>    "build_date" : "2020-07-21T16:40<br/>    "build_snapshot" : false,       <br/>    "lucene_version" : "8.5.1",     <br/>    "minimum_wire_compatibility_vers<br/>    "minimum_index_compatibility_ver<br/>  },                                <br/>  "tagline" : "You Know, for Search"<br/>}</span></pre><h2 id="097e" class="mw lg je bd lh mx my dn ll mz na dp lp km nb nc lt kq nd ne lx ku nf ng mb nh bi translated">åŸºå·´çº³çš„ä¿®å¤â€”â€”åœ¨æˆ‘ä»¬ä¿¡ä»»çš„åŠ å·</h2><p id="4323" class="pw-post-body-paragraph kb kc je kd b ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku mh kw kx ky im bi translated">æˆ‘ä»¬è¿˜å¾—ä¿®ç†åŸºå·´çº³ã€‚ä»£æ›¿PKCS12ï¼Œæˆ‘ä»¬å°†ä»¥PEMæ–‡ä»¶çš„å½¢å¼è·å–CAï¼Œå¹¶å°†å…¶æ”¾å…¥Kibana configç›®å½•ã€‚</p><pre class="lb lc ld le gt nm nl nn no aw np bi"><span id="814f" class="mw lg je nl b gy nq nr l ns nt">openssl pkcs12 -in elastic-stack-ca.p12 -out ca.pem -clcerts -noke ys<br/>cp cert.pem /etc/kibana<br/>chown kibana:kibana /etc/kibana/ca.pem</span></pre><p id="4d74" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ç°åœ¨æˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯å°†æ¡ç›®æ·»åŠ åˆ°<code class="fe ni nj nk nl b">/etc/kibana/kibana.yml</code>å¹¶é‡å¯KibanaæœåŠ¡ã€‚</p><pre class="lb lc ld le gt nm nl nn no aw np bi"><span id="aba2" class="mw lg je nl b gy nq nr l ns nt">...<br/>elasticsearch.hosts: ["<a class="ae kz" href="https://localhost:9200" rel="noopener ugc nofollow" target="_blank">https://localhost:9200</a>"]<br/>elasticsearch.ssl.certificateAuthorities: ["/etc/kibana/ca.pem"]<br/>...<br/>xpack.encryptedSavedObjects.encryptionKey: 'fhjskloppd678ehkdfdlliverpoolfcr'</span></pre><figure class="lb lc ld le gt iv gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/6312afaf42b3a0a8d8117e7991144c56.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/0*Za9WbF0NeabPeOGG.png"/></div></figure><h2 id="6fa3" class="mw lg je bd lh mx my dn ll mz na dp lp km nb nc lt kq nd ne lx ku nf ng mb nh bi translated">Beatsä¿®å¤</h2><p id="585b" class="pw-post-body-paragraph kb kc je kd b ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku mh kw kx ky im bi translated">ä½ å¯èƒ½ä»¥ä¸ºä¸€åˆ‡éƒ½ç»“æŸäº†ã€‚æƒŠå–œï¼ğŸ˜‰Elasticsearchç°åœ¨éœ€è¦è®¤è¯ã€‚æˆ‘ä»¬å°†<strong class="kd jf">ç®€åŒ–</strong>ä¿®å¤:ä½¿ç”¨è¶…çº§ç”¨æˆ·å¸å·å¹¶å¿½ç•¥CAéªŒè¯ã€‚<strong class="kd jf">ä¸è¦åœ¨ç”Ÿäº§ä¸­è¿™æ ·åšï¼</strong></p><p id="060a" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ä¿®å¤åŒ…æ‹¬æ­£ç¡®é…ç½®è¾“å‡ºã€‚å¼¹æ€§æœç´¢éƒ¨åˆ†ã€‚</p><pre class="lb lc ld le gt nm nl nn no aw np bi"><span id="6443" class="mw lg je nl b gy nq nr l ns nt">...<br/>output.elasticsearch:<br/>  # Array of hosts to connect to.<br/>  hosts: ["10.0.0.4:9200"]<br/> <br/>  # Protocol - either `http` (default) or `https`.<br/>  protocol: "https"<br/>  ssl.verification_mode: "none"<br/> <br/>  # Authentication credentials - either API key or username/password.<br/>  #api_key: "id:api_key"<br/>  username: "elastic"<br/>  password: "elastic"</span></pre><p id="bfca" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Winlogbeaté…ç½®æ–‡ä»¶å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°:<code class="fe ni nj nk nl b"><em class="nx">C:\ProgramData\Elastic\Beats\winlogbeat\winlogbeat.yml</em></code> <em class="nx">ã€‚</em>æ‚¨å¯ä»¥é€šè¿‡åœ¨PowerShellä¸­é”®å…¥ä»¥ä¸‹å‘½ä»¤æ¥é‡æ–°å¯åŠ¨WinlogbeatæœåŠ¡ã€‚</p><pre class="lb lc ld le gt nm nl nn no aw np bi"><span id="8109" class="mw lg je nl b gy nq nr l ns nt">Restart-Service<!-- --> <!-- -->winlogbeat</span></pre><h1 id="664a" class="lf lg je bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">åŠ è½½é»˜è®¤æ£€æµ‹è§„åˆ™å¼¹æ€§SIEM</h1><p id="0612" class="pw-post-body-paragraph kb kc je kd b ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku mh kw kx ky im bi translated">æœ€åï¼Œæˆ‘ä»¬å¯ä»¥è¿›å…¥æ¢æµ‹èˆ±ã€‚æˆ‘ä»¬å¯ä»¥åŠ è½½é¢„å…ˆæ„å»ºçš„è§„åˆ™ã€‚</p><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oc"><img src="../Images/3bc58108c87720683fc66259109da599.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*D7-KqMt3HoBzincS.png"/></div></div></figure><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi od"><img src="../Images/1beb23f87c401c7d77a49933be5fafa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8YLZtwAjMiOM5bNC.png"/></div></div></figure><p id="8712" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">é»˜è®¤è§„åˆ™çš„åˆ—è¡¨ç›¸å½“å¤§ã€‚ä¸ºäº†æµ‹è¯•ï¼Œæˆ‘å·²ç»æŠŠå®ƒä»¬éƒ½æ¿€æ´»äº†ã€‚</p><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oe"><img src="../Images/6e7983322c4ba2cfe266285b197a0a54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wcoHvqx1R1ZPqIQD.png"/></div></div></figure><p id="bbc5" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æ¯ä¸ªè§„åˆ™éƒ½æœ‰æè¿°å’Œä¾èµ–å…³ç³»ã€‚å…¶ä¸­ä¸€äº›éœ€è¦æœºå™¨å­¦ä¹ åŠŸèƒ½(é˜…è¯»:ä¸æ˜¯å…è´¹çš„)ã€‚</p><figure class="lb lc ld le gt iv gh gi paragraph-image"><div class="gh gi of"><img src="../Images/e894c39ade14c899b679b221ed845929.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/0*99PnAimRxl5KERhq.png"/></div></figure><p id="99fc" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">åœ¨å…è´¹ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½å‘é€æ£€æµ‹é€šçŸ¥ã€‚</p><h1 id="e597" class="lf lg je bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">æ£€æµ‹æœºåˆ¶çš„éªŒè¯</h1><h2 id="8b8d" class="mw lg je bd lh mx my dn ll mz na dp lp km nb nc lt kq nd ne lx ku nf ng mb nh bi translated">aptæ¨¡æ‹Ÿå™¨</h2><p id="d0e1" class="pw-post-body-paragraph kb kc je kd b ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku mh kw kx ky im bi translated">æˆ‘ä»¬å°†ä½¿ç”¨è£…æœ‰Windows 10çš„æœºå™¨ã€‚<a class="ae kz" href="https://github.com/NextronSystems/APTSimulator" rel="noopener ugc nofollow" target="_blank"> APTSimulator </a>å°†å¸®åŠ©æˆ‘ä»¬åšåˆ°è¿™ä¸€ç‚¹ã€‚ä¸‹è½½åï¼Œåªéœ€è§£å‹å¹¶å¯åŠ¨<code class="fe ni nj nk nl b">APTSimulator.bat</code>ã€‚</p><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi og"><img src="../Images/9098b10df6a2aac37442735e36654066.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*p2LqkSCSwM--zvAz.png"/></div></div><figcaption class="oh oi gj gh gi oj ok bd b be z dk translated">é€‰æ‹©è¿è¡Œæ¯ä¸ªæµ‹è¯•</figcaption></figure><p id="b6ec" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ç°åœ¨æ˜¯ä¸€ä¸ªæƒŠå–œã€‚æœªæ£€æµ‹åˆ°ç”Ÿæˆçš„æ”»å‡»ã€‚</p><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ol"><img src="../Images/035dbde2f0b38ff0c18fe560b470bc95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*X7CDr67iNlhhOMMi.png"/></div></div></figure><h2 id="6a27" class="mw lg je bd lh mx my dn ll mz na dp lp km nb nc lt kq nd ne lx ku nf ng mb nh bi translated">Sysmoné…ç½®</h2><p id="f4eb" class="pw-post-body-paragraph kb kc je kd b ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku mh kw kx ky im bi translated">Winlogbeatæ”¶é›†æ“ä½œç³»ç»Ÿæä¾›çš„å°½å¯èƒ½å¤šçš„æ•°æ®ã€‚æˆ‘ä»¬éœ€è¦å¢åŠ æˆ‘ä»¬æ”¶é›†çš„äº‹ä»¶ç±»å‹ã€‚<a class="ae kz" href="https://technet.microsoft.com/en-us/sysinternals/sysmon" rel="noopener ugc nofollow" target="_blank"> Sysmon </a>æ˜¯ä¸€ä¸ªWindowså†…éƒ¨æ´»åŠ¨ç›‘è§†å™¨ã€‚å®ƒæ˜¯ä¸€ä¸ªç³»ç»ŸæœåŠ¡ï¼Œè·Ÿè¸ªæ–‡ä»¶ç³»ç»Ÿã€æ³¨å†Œè¡¨ã€ç½‘ç»œå’Œæ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºçš„æ´»åŠ¨ã€‚</p><p id="56b5" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ä¸‹è½½åï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­å®‰è£…</p><pre class="lb lc ld le gt nm nl nn no aw np bi"><span id="1c5a" class="mw lg je nl b gy nq nr l ns nt">Sysmon64.exe<!-- --> <!-- -->-i<!-- --> <!-- -->-accepteula<!-- --> <!-- -->-h<!-- --> <!-- -->md5,sha256,imphash<!-- --> <!-- -->-l<!-- --> <!-- -->-n</span></pre><p id="4f59" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†å¸Œæœ›æ”¶é›†ä¸€åˆ‡ã€‚åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬åº”è¯¥æ€è€ƒå“ªäº›äº‹ä»¶å¯¹æˆ‘ä»¬æ¥è¯´æ˜¯é‡è¦çš„ã€‚æˆ‘ä»¬å°†ä½¿ç”¨æ¥è‡ª<a class="ae kz" href="https://github.com/Cyb3rWard0g/HELK" rel="noopener ugc nofollow" target="_blank"> HELK </a>é¡¹ç›®çš„é…ç½®ã€‚è¿™é‡Œæœ‰ä¸€ä¸ª<a class="ae kz" href="https://gist.github.com/Cyb3rWard0g/136481552d8845e52962534d1a4b8664#file-startlogging-xml" rel="noopener ugc nofollow" target="_blank">é“¾æ¥</a>åˆ°é…ç½®ã€‚</p><pre class="lb lc ld le gt nm nl nn no aw np bi"><span id="18de" class="mw lg je nl b gy nq nr l ns nt">Sysmon64.exe -c config.xml</span></pre><h1 id="41ad" class="lf lg je bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">å¨èƒæ£€æµ‹</h1><p id="fe1b" class="pw-post-body-paragraph kb kc je kd b ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku mh kw kx ky im bi translated">é‡æ–°å¯åŠ¨APTSimulatoråï¼Œæ‚¨å·²ç»å¯ä»¥çœ‹åˆ°æ•ˆæœäº†ã€‚é™¤äº†äº‹ä»¶æœ¬èº«ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°é£é™©æ°´å¹³å’Œä¿¡æ¯æ¥æºã€‚</p><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi og"><img src="../Images/88c5378a890d3c5b58c2fc65737682fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oOgJMRSeNGw9NDS6.png"/></div></div></figure><p id="4bfd" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ä»æ£€æµ‹åˆ°çš„è§„åˆ™è§†å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„æ—¶é—´è¡¨å¹¶å¼€å§‹è°ƒæŸ¥ã€‚</p><h1 id="c08b" class="lf lg je bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">ç»“è®º</h1><p id="1356" class="pw-post-body-paragraph kb kc je kd b ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku mh kw kx ky im bi translated">æˆ‘ä»¬çœ‹åˆ°<strong class="kd jf"> SIEM </strong>åœ¨<strong class="kd jf">å…è´¹ç‰ˆ</strong>ä¸­å·²ç»åšå¾—ç›¸å½“ä¸é”™äº†<strong class="kd jf"> </strong>ã€‚æœ‰è®¸å¤šå†…ç½®è§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ è‡ªå·±çš„è§„åˆ™ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬å°†æ— æ³•ä½¿ç”¨æœºå™¨å­¦ä¹ åŠŸèƒ½ã€‚ç¼ºå°‘å‘é€æ£€æµ‹é€šçŸ¥çš„å¯èƒ½æ€§ä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå°½ç®¡æˆ‘è§‰å¾—ä½ å¯ä»¥ç”¨<strong class="kd jf"> ElastAlert </strong>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘çŒœè¿™äº›æ£€æµ‹åªæ˜¯ååœ¨ä¸€äº›å†…éƒ¨ç´¢å¼•çš„æŸä¸ªåœ°æ–¹ã€‚</p><h1 id="be29" class="lf lg je bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">å˜¿ï¼</h1><p id="4d9d" class="pw-post-body-paragraph kb kc je kd b ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku mh kw kx ky im bi translated">è¯·è®°ä½ï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ä¿æŠ¤èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡(å› ä¸ºè¿™æ˜¯ä¸€ä¸ªå•èŠ‚ç‚¹é›†ç¾¤)ï¼Œä¹Ÿæ²¡æœ‰ä¿æŠ¤Kibanaä¸å®¢æˆ·ç«¯çš„HTTPé€šä¿¡ã€‚ä½ ä¹Ÿåº”è¯¥é¿å…ä½¿ç”¨è¶…çº§ç”¨æˆ·è´¦å·åœ¨Beatsä¸­ä¸Elasticsearchäº¤æµã€‚</p><h1 id="9c3d" class="lf lg je bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">æ¥ä¸‹æ¥å‘¢ï¼Ÿ</h1><p id="8b87" class="pw-post-body-paragraph kb kc je kd b ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku mh kw kx ky im bi translated">æˆ‘åœ¨æƒ³<a class="ae kz" href="https://github.com/Yelp/elastalert" rel="noopener ugc nofollow" target="_blank"><strong class="kd jf">ElastAlert</strong></a><strong class="kd jf">å’Œ</strong> <a class="ae kz" href="https://github.com/Neo23x0/sigma" rel="noopener ugc nofollow" target="_blank"> <strong class="kd jf">é€‚é©¬</strong> </a>ã€‚è®©æˆ‘çŸ¥é“ä½ å¯¹å®ƒçš„æƒ³æ³•ã€‚ä¹Ÿè®¸ä½ çŸ¥é“äº›ä»€ä¹ˆï¼Ÿæ¬¢è¿éšæ—¶åœ¨Twitteræˆ–Linkedinä¸Šç»™æˆ‘å‘çŸ­ä¿¡ã€‚</p></div></div>    
</body>
</html>