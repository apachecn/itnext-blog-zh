<html>
<head>
<title>Cookies with React, Express and Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¸¦Reactã€Expresså’ŒDockerçš„Cookies</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/cookies-with-react-express-and-docker-15296fac20fb?source=collection_archive---------1-----------------------#2019-07-02">https://itnext.io/cookies-with-react-express-and-docker-15296fac20fb?source=collection_archive---------1-----------------------#2019-07-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="e4ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æœ€è¿‘ï¼Œæˆ‘ä¸å¾—ä¸å°†JWTè½¬ç§»åˆ°cookiesï¼Œä»¥ä¾¿åœ¨Dockerå¾®æœåŠ¡ä¹‹é—´æ— ç¼ä½¿ç”¨å®ƒã€‚æˆ‘ä»¬åœ¨å•ç‹¬çš„urlå‰ç¼€ä¸Šè¿è¡Œæ¯ä¸ªå®¹å™¨ï¼Œè¿™å¾ˆéš¾ææ¸…æ¥šï¼Œå› ä¸ºå½“urlæ”¹å˜æ—¶cookieså¿…é¡»åœ¨é‚£é‡Œã€‚æˆ‘æ‰¾ä¸åˆ°ä»»ä½•ç›´æ¥çš„è§£å†³æ–¹æ¡ˆï¼Œæ‰€ä»¥æˆ‘å†³å®šå†™è¿™ç¯‡æ–‡ç« ï¼Œå®ƒå¯èƒ½å¯¹æŸäººæœ‰ç”¨ï¼Œç”šè‡³å¯¹æœªæ¥çš„æˆ‘æœ‰ç”¨ã€‚</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/aa1f591c15bb44a1f0de89d248a52eb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k87q1EVhYNPZ6Li_dcwV4g.jpeg"/></div></div></figure><p id="5313" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘åªæ˜¯å‡è®¾ä½ æœ‰å·¥ä½œçš„å‰ç«¯å’Œåç«¯å®¹å™¨ï¼Œä¸€åˆ‡è¿è¡Œè‰¯å¥½ã€‚æˆ‘ä¸ä¼šè§£é‡Šä»€ä¹ˆæ˜¯cookiesï¼Œå› ä¸ºæœ‰å¾ˆå¤šå…³äºè¿™ä¸ªä¸»é¢˜çš„æ›´å¥½çš„æ–‡ç« ã€‚</p><h2 id="a2e2" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">åŸºæœ¬è®¾ç½®</h2><p id="23fc" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">è®©æˆ‘ä»¬ä»¥ç®€å•å¿«æ·æœåŠ¡å™¨ä¸ºä¾‹æ¥è¯´æ˜å¦‚ä½•å‘é€cookiesã€‚</p><pre class="km kn ko kp gt lv lw lx ly aw lz bi"><span id="4ef6" class="kx ky iq lw b gy ma mb l mc md">// index.js</span><span id="0ff1" class="kx ky iq lw b gy me mb l mc md">const express = require("express")<br/>const session = require("express-session");</span><span id="ff9d" class="kx ky iq lw b gy me mb l mc md">const app = express()</span><span id="b3c3" class="kx ky iq lw b gy me mb l mc md">app.use(<br/>  session({<br/>    secret: process.env.LOGIN_SERVER_SECRET,<br/>    saveUninitialized: true,<br/>    resave: true,<br/>    cookie: {<br/>      httpOnly: false,<br/>      secure: false,<br/>    },<br/>  }),<br/>);</span><span id="fc1e" class="kx ky iq lw b gy me mb l mc md">app.get("/cookie", (req, res) =&gt; {<br/>  const options = {<br/>    secure: <!-- -->false<!-- -->,<br/>    httpOnly: <!-- -->false<!-- -->,<br/>    domain: ".your.domain.com"<br/>  }</span><span id="cda4" class="kx ky iq lw b gy me mb l mc md">  return res<br/>    .cookie("cookieName", "cookieValue", options)<br/>    .status(200)<br/>    .send("cookie sent")<br/>})<br/><br/>app.listen(8080)</span></pre><p id="6068" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯å½“æˆ‘ä»¬å‘<em class="mf"> localhost:8080/cookie </em>å‘é€è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨éƒ½ä¼šç”¨Set-Cookieå¤´è¿›è¡Œå“åº”ã€‚å½“ä½ ç›´æ¥åœ¨æµè§ˆå™¨æˆ–ç±»ä¼¼Postmançš„åº”ç”¨ç¨‹åºä¸­è¾“å…¥æ—¶ï¼Œæ•ˆæœå¾ˆå¥½ã€‚å½“ä½ åœ¨client.your.domain.comçš„T2è¿è¡Œå®¢æˆ·ç«¯ï¼Œåœ¨server.your.domain.comçš„T4è¿è¡ŒæœåŠ¡å™¨æ—¶ï¼Œé—®é¢˜å°±å‡ºç°äº†ã€‚æˆ‘ä»¬å¼€å§‹é‡åˆ°CORSé—®é¢˜ã€‚</p><p id="df40" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºçš„åŸºæœ¬è®¾ç½®ã€‚æˆ‘ä½¿ç”¨create-react-appï¼Œå¹¶é€šè¿‡æ·»åŠ <a class="ae mg" href="https://www.npmjs.com/package/superagent" rel="noopener ugc nofollow" target="_blank"> superagent </a>(ç”¨äºè¯·æ±‚çš„ä¼Ÿå¤§åº“)å’Œæ¯å½“æˆ‘ç‚¹å‡»é“¾æ¥æ—¶å‘é€è¯·æ±‚æ¥ä¿®æ”¹å®ƒã€‚</p><pre class="km kn ko kp gt lv lw lx ly aw lz bi"><span id="cbe4" class="kx ky iq lw b gy ma mb l mc md">// App.js</span><span id="c880" class="kx ky iq lw b gy me mb l mc md">import React from "react";<br/>import superagent from "superagent";<br/>import logo from "./logo.svg";<br/>import "./App.css";</span><span id="ea8d" class="kx ky iq lw b gy me mb l mc md">function App() {</span><span id="aecd" class="kx ky iq lw b gy me mb l mc md">  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;header className="App-header"&gt;<br/>        &lt;img src={logo} className="App-logo" alt="logo" /&gt;<br/>        &lt;p&gt;<br/>          Edit &lt;code&gt;src/App.js&lt;/code&gt; and save to reload.<br/>        &lt;/p&gt;<br/>        &lt;a<br/>          className="App-link"<br/>          onClick={() =&gt;<br/>            superagent<br/>              .get("http://localhost:<!-- -->8080<!-- -->/cookie")<br/>              .then(response =&gt; {<br/>                console.log(response);<br/>              })<br/>          }<br/>        &gt;<br/>          Get Cookie<br/>        &lt;/a&gt;<br/>      &lt;/header&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="d241" class="kx ky iq lw b gy me mb l mc md">export default App;</span></pre><h2 id="869e" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">å…‹-å¥¥äºŒæ°åˆ†çº§é‡è¡¨</h2><p id="fa77" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">å› ä¸ºæˆ‘ä»¬ä»ä¸åŒçš„å‘èµ·è€…å‘é€è¯·æ±‚ï¼Œæˆ‘ä»¬å¾—åˆ°CORSé—®é¢˜ã€‚ç®€å•çš„è§£å†³æ–¹æ³•æ˜¯å®‰è£…<a class="ae mg" href="https://www.npmjs.com/package/cors" rel="noopener ugc nofollow" target="_blank"> cors </a>åŒ…ï¼Œå¹¶é€šè¿‡ç®€å•çš„ä¾‹å­å°†å…¶æ·»åŠ åˆ°æ–‡æ¡£ä¸­ã€‚</p><p id="48ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">åŒæ ·ï¼Œå¸¦æœ‰é€šé…ç¬¦(*/*)çš„ç®€å•corsä¸èµ·ä½œç”¨ã€‚æˆ‘ä»¬å¿…é¡»ä¸ºcorsè®¾ç½®ä¸€äº›è‡ªå®šä¹‰é…ç½®ï¼Œå¹¶è¿›è¡Œé£è¡Œå‰é€‰é¡¹æ£€æŸ¥ã€‚</p><pre class="km kn ko kp gt lv lw lx ly aw lz bi"><span id="038e" class="kx ky iq lw b gy ma mb l mc md">// index.js</span><span id="a192" class="kx ky iq lw b gy me mb l mc md">const express = require("express")<br/>const session = require("express-session");<br/>const cors <strong class="lw ir">=</strong> require("cors")</span><span id="4ced" class="kx ky iq lw b gy me mb l mc md">const app = express()</span><span id="8972" class="kx ky iq lw b gy me mb l mc md">app.use(<br/>  session({<br/>    secret: process.env.LOGIN_SERVER_SECRET,<br/>    saveUninitialized: true,<br/>    resave: true,<br/>    cookie: {<br/>      httpOnly: false,<br/>      secure: false,<br/>    },<br/>  }),<br/>);</span><span id="bb0d" class="kx ky iq lw b gy me mb l mc md">const corsOptions <strong class="lw ir">=</strong> {<br/>  origin: /\.your.domain\.com$/,    <em class="mf">// reqexp will match all prefixes<br/>  </em>methods: "GET,HEAD,POST,PATCH,DELETE,OPTIONS",<br/>  credentials: true,                // required to pass<br/>  allowedHeaders: "Content-Type, Authorization, X-Requested-With",<br/>}</span><span id="9204" class="kx ky iq lw b gy me mb l mc md"><em class="mf">// intercept pre-flight check for all routes<br/></em>app.options('*', cors(corsOptions))</span><span id="f549" class="kx ky iq lw b gy me mb l mc md"><em class="mf">// add cors middleware to route </em><br/>app.get("/cookie", <!-- -->cors(corsOptions),<!-- --> (req, res) =&gt; {<br/>  const options = {<br/>    secure: <!-- -->false<!-- -->,<br/>    httpOnly: <!-- -->false<!-- -->,<br/>    domain: ".your.domain.com"<br/>  }</span><span id="a0fd" class="kx ky iq lw b gy me mb l mc md">return res<br/>    .cookie("cookieName", "cookieValue", options)<br/>    .status(200)<br/>    .send("cookie sent")<br/>})<br/><br/>app.listen(8080)</span></pre><p id="0363" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å‰ç«¯è¿˜æœ‰ä¸€ä¸ªå˜åŒ–ã€‚å› ä¸ºæˆ‘ä»¬çš„æœåŠ¡å™¨ç°åœ¨æ¥å—å¸¦æœ‰å‡­è¯çš„è¯·æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å‘é€ä¸€ä¸ªå‡­è¯æ¥ä¼ é€’cookieã€‚è¿™å®é™…ä¸Šæ˜¯å¤šäº†ä¸€è¡Œ</p><pre class="km kn ko kp gt lv lw lx ly aw lz bi"><span id="a799" class="kx ky iq lw b gy ma mb l mc md">// App.js</span><span id="9407" class="kx ky iq lw b gy me mb l mc md">import React from "react";<br/>import superagent from "superagent";<br/>import logo from "./logo.svg";<br/>import "./App.css";</span><span id="833f" class="kx ky iq lw b gy me mb l mc md">function App() {</span><span id="7fbd" class="kx ky iq lw b gy me mb l mc md">return (<br/>    &lt;div className="App"&gt;<br/>      &lt;header className="App-header"&gt;<br/>        &lt;img src={logo} className="App-logo" alt="logo" /&gt;<br/>        &lt;p&gt;<br/>          Edit &lt;code&gt;src/App.js&lt;/code&gt; and save to reload.<br/>        &lt;/p&gt;<br/>        &lt;a<br/>          className="App-link"<br/>          onClick={() =&gt;<br/>            superagent<br/>              .get("http://localhost:<!-- -->8080<!-- -->/cookie")<br/>              .<!-- -->withCredentials()           <em class="mf">// it's simple as that</em><br/>              <!-- -->.then(response =&gt; {<br/>                console.log(response);<br/>              })<br/>          }<br/>        &gt;<br/>          Get Cookie<br/>        &lt;/a&gt;<br/>      &lt;/header&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="079a" class="kx ky iq lw b gy me mb l mc md">export default App;</span></pre><h2 id="751b" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">å®‰å…¨cookies</h2><p id="9470" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œæˆ‘åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ä½¿ç”¨äº†ä¸å®‰å…¨çš„cookiesã€‚è¿™ä»…ç”¨äºå¼€å‘/æœ¬åœ°ç›®çš„ã€‚å¦‚æœä½ æƒ³åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨å®ƒï¼Œä½ å¿…é¡»è€ƒè™‘å®‰å…¨æ€§ã€‚å®‰å…¨cookiesåªèƒ½åœ¨httpsä¸Šå·¥ä½œï¼Œæ‰€ä»¥ä½ ä¹Ÿå¿…é¡»æ³¨æ„è¿™ä¸€ç‚¹ã€‚ä¸€ä¸ªå¥½ä¸»æ„æ˜¯å°†cookiesçš„å®‰å…¨æ€§è®¾ç½®ä¸ºä¾èµ–äºNODE_ENVï¼Œè¿™æ ·æˆ‘ä»¬åœ¨å¼€å‘å’Œéƒ¨ç½²åˆ°prodæ—¶å°±ä¸å¿…è®°ä½å®ƒã€‚</p><pre class="km kn ko kp gt lv lw lx ly aw lz bi"><span id="062a" class="kx ky iq lw b gy ma mb l mc md">// index.js</span><span id="68fc" class="kx ky iq lw b gy me mb l mc md">===</span><span id="421c" class="kx ky iq lw b gy me mb l mc md">app.use(<br/>  session({<br/>    secret: process.env.LOGIN_SERVER_SECRET,<br/>    saveUninitialized: true,<br/>    resave: true,<br/>    cookie: {<br/>      httpOnly: true,            <em class="mf">// change both to true</em><br/>      secure: true,<br/>    },<br/>  }),<br/>);</span><span id="6c9b" class="kx ky iq lw b gy me mb l mc md">===</span><span id="f778" class="kx ky iq lw b gy me mb l mc md"><em class="mf">// dynamic change</em><br/>const isCookieSecure = <br/>  process.env.NODE_ENV === "production" ? true : false;</span><span id="2331" class="kx ky iq lw b gy me mb l mc md"><em class="mf">// add cors middleware to route </em><br/>app.get("/cookie", <!-- -->cors(corsOptions),<!-- --> (req, res) =&gt; {<br/>  const options = {<br/>    secure: <!-- -->isCookieSecure<!-- -->,<br/>    httpOnly: <!-- -->isCookieSecure<!-- -->,<br/>    domain: ".your.domain.com"<br/>  }</span><span id="b284" class="kx ky iq lw b gy me mb l mc md">return res<br/>    .cookie("cookieName", "cookieValue", options)<br/>    .status(200)<br/>    .send("cookie sent")<br/>})</span></pre><p id="0d4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">åŸºæœ¬å°±æ˜¯è¿™æ ·ã€‚ä½ å¯ä»¥æ·»åŠ ä»»æ„å¤šçš„åº”ç”¨ç¨‹åºå’ŒæœåŠ¡å™¨åˆ°ä½ çš„dockerä¸­ï¼Œå¹¶åœ¨ä»»ä½•åœ°æ–¹äº«å—cookiesã€‚å®ƒä»¬å°†åœ¨è¯·æ±‚å’Œå“åº”å¤´ä¸­è‡ªåŠ¨ä¼ é€’ã€‚æ„Ÿè°¢å¤§å®¶èµ°åˆ°è¿™ä¸€æ­¥ï¼Œå¸Œæœ›è¿™å¯¹æŸäº›äººæœ‰ç”¨:)</p><p id="f6ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">åœ¨MDNä¸Šé˜…è¯»æ›´å¤šå…³äº<a class="ae mg" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="noopener ugc nofollow" target="_blank"> CORS </a>ã€<a class="ae mg" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/OPTIONS" rel="noopener ugc nofollow" target="_blank">é€‰é¡¹</a>å’Œ<a class="ae mg" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies" rel="noopener ugc nofollow" target="_blank">é¥¼å¹²</a>çš„ä¿¡æ¯ã€‚å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–åé¦ˆï¼Œè¯·å‘è¡¨è¯„è®ºã€‚è°¢è°¢ğŸ™</p></div></div>    
</body>
</html>