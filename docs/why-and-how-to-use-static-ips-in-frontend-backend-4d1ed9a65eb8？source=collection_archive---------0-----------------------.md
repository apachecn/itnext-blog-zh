# ä¸ºä»€ä¹ˆä»¥åŠå¦‚ä½•åœ¨å‰ç«¯å’Œåç«¯ä½¿ç”¨é™æ€ IP

> åŸæ–‡ï¼š<https://itnext.io/why-and-how-to-use-static-ips-in-frontend-backend-4d1ed9a65eb8?source=collection_archive---------0----------------------->

![](img/8eefb39a53f54e7e187c165a2489bfd0.png)

å®‰å¨œæ–¯å¡”è¥¿å¨…Â·æœå°”å‰å°”åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šçš„ç…§ç‰‡

ä¸€ä½æµ‹è¯•ç‰ˆå®¢æˆ·æ›¾ç»æ‰¾è¿‡æˆ‘ä»¬ï¼Œå› ä¸ºä»–æ— æ³•ç™»å½•æˆ‘ä»¬çš„ Angular web åº”ç”¨ç¨‹åºã€‚é¡µé¢æ­£åœ¨åŠ è½½ï¼Œä½†æ˜¯å¯¹æˆ‘ä»¬ API çš„ä»»ä½• HTTP è¯·æ±‚éƒ½å¤±è´¥äº†ã€‚åœ¨ä¸å®¢æˆ·äº¤è°ˆåï¼Œæˆ‘ä»¬å‘ç°ä»–ä»¬çš„å…¬å¸æ­£åœ¨ä½¿ç”¨ IP é™åˆ¶ã€‚å› æ­¤ï¼Œä»–æƒ³çŸ¥é“æˆ‘ä»¬æ˜¯å¦å¯ä»¥æä¾›é™æ€ IPï¼Œä»–ä»¬å¯ä»¥å°†è¿™äº› IP æ·»åŠ åˆ°ä»–ä»¬çš„äº§å“ä¸­ï¼Œä»¥ä¾¿åœ¨ä»–ä»¬çš„å…¬å¸ä¸­ä½¿ç”¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚

ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬é€‰æ‹©çš„äº‘å¹³å°([æ¸²æŸ“](https://render.com))å½“æ—¶è¿˜æ²¡æœ‰ç›´æ¥æ”¯æŒè¿™ä¸ªç‰¹æ€§ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ— æ³•æä¾›ä¸€ä¸ªç»å¯¹ä¸ä¼šæ”¹å˜çš„ IP åˆ—è¡¨ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¿…é¡»å¯»æ‰¾ä¸€ç§å¯ä»¥æä¾›é™æ€ IP çš„äº§å“ã€‚æ”¹å˜æˆ‘ä»¬çš„äº‘å¹³å°æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºç›´åˆ°ä»Šå¤©æˆ‘ä»¬å¯¹å®ƒè¿˜æ˜¯å¾ˆæ»¡æ„çš„ã€‚ç”±äºè¿™æ˜¯ç¬¬ä¸€ä¸ªæå‡ºè¦æ±‚çš„å®¢æˆ·ï¼Œæˆ‘ä»¬ç°åœ¨ä¹Ÿä¸æƒ³ä¸ºæ­¤èŠ±å¤ªå¤šé’±ã€‚

å¹¸è¿çš„æ˜¯ï¼Œæˆ‘å¶ç„¶å‘ç°äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œå®ƒä¼¼ä¹æä¾›äº†æˆ‘ç°åœ¨éœ€è¦çš„ä¸€åˆ‡ã€‚ [QuotaGuard](https://www.quotaguard.com) æ˜¯ä¸€é¡¹æœåŠ¡ï¼Œå®ƒè‡ªç§°ä¸ºâ€œ*å…¨çƒé¢†å…ˆçš„åˆ†å¸ƒå¼ç½‘ç»œå’ŒåŸºäºäº‘çš„åº”ç”¨çš„é™æ€ IP è§£å†³æ–¹æ¡ˆæä¾›å•†*â€ã€‚ä»–ä»¬æ”¯æŒå¤šç§äº‘å¹³å°ï¼ŒåŒ…æ‹¬æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„å¹³å°ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œä»·æ ¼æ˜¯å…¬å¹³çš„ã€‚

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªå…è®¸æˆ‘ä»¬ä»é™æ€ IP è®¿é—®åº”ç”¨ç¨‹åºçš„å…¥ç«™ä»£ç†ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›é€šè¿‡é™æ€ IP å°†æµé‡ä»æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè·¯ç”±åˆ°å¤–éƒ¨æœåŠ¡ï¼Œé‚£ä¹ˆå‡ºç«™æ˜¯å¿…è¦çš„ã€‚

è¯·è®°ä½ï¼Œé™¤äº†å¸æˆ·æ³¨å†Œä¹‹å¤–ï¼Œä¸‹é¢çš„æ­¥éª¤ç›¸å½“ä¸€èˆ¬ï¼Œå› æ­¤å®ƒä»¬ä¹Ÿåº”è¯¥ä¸æ›¿ä»£è§£å†³æ–¹æ¡ˆä¸€èµ·ä½¿ç”¨ã€‚

## å¦‚ä½•åˆ›å»ºå…¥ç«™ä»£ç†ä»¥ä½¿ç”¨å¸¦æœ‰ QuotaGuard Static çš„é™æ€ IPs

1.  åˆ›å»ºä¸€ä¸ªå¸æˆ·
2.  åˆ›å»ºå…¥ç«™ä»£ç†ã€‚è¿™éœ€è¦æ‚¨æä¾› API çš„ URLã€‚
3.  ç¡®ä¿å…è®¸æ‚¨çš„åº”ç”¨ç¨‹åºä½¿ç”¨å…¥ç«™ä»£ç†
4.  ç¡®ä¿ä½¿ç”¨åŸŸ URLï¼Œè€Œä¸æ˜¯ç›´æ¥è°ƒç”¨ API
5.  å‘æ‚¨çš„å®¢æˆ·æä¾›æ‰€æœ‰é™æ€ IP
6.  å¯é€‰:ä»…å¯¹æŸäº›è¯·æ±‚æˆ–å®¢æˆ·ä½¿ç”¨å…¥ç«™ä»£ç†ï¼Œä»¥ä¸è¶…è¿‡æ‚¨çš„é…é¢ğŸ¤“

åˆ›å»ºå…¥ç«™ä»£ç†åï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°é™æ€ IP å’ŒåŸŸ URLã€‚æˆ‘ä»¬åº”è¯¥å‘æ„Ÿå…´è¶£çš„å®¢æˆ·æä¾›æˆ‘ä»¬åœ¨è¿™é‡Œçœ‹åˆ°çš„é™æ€ IPã€‚

![](img/54c01d0a3d72d87988c56c1aa45fe8a6.png)

åˆ›å»ºå…¥ç«™ä»£ç†

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çš„ Angular web åº”ç”¨ç¨‹åºä½¿ç”¨ [JWT](/how-to-send-jwt-automatically-in-angular-http-requests-31c1fd060871) è¿›è¡Œè®¤è¯ã€‚æ³¨æ„`whitelistedDomains`ï¼Œå®ƒåŒ…å«äº†æˆ‘ä»¬çš„å…¥ç«™ä»£ç†çš„æ–°åŸŸå URLã€‚

```
// called on every request to retrieve the token
export function jwtOptionsFactory(tokenService: MyTokenService) {
  return {
    tokenGetter: () => tokenService.getToken(),
    whitelistedDomains: ['some-api.com', 'some-api.gestatica.com']
  };
}
// the actual module imports (simplified)
@NgModule({
  ...,
  imports: [JwtModule.forRoot({
      jwtOptionsProvider: {
        provide: JWT_OPTIONS,
        useFactory: jwtOptionsFactory,
        deps: [MyTokenService]
      }
    }),
  ...
}
```

å‰©ä¸‹å”¯ä¸€è¦åšçš„äº‹æƒ…æ˜¯:ä¸º HTTP è¯·æ±‚ä½¿ç”¨æ­£ç¡®çš„ URLã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¸ºæ­¤åˆ›å»ºäº†ä¸€ä¸ªç‰¹æ€§æ ‡å¿—ã€‚å› æ­¤ï¼Œåªæœ‰éœ€è¦è¿™ä¸ªç‰¹æ€§çš„å®¢æˆ·æ‰ä¼šä½¿ç”¨å…¥ç«™ä»£ç†ï¼Œè€Œå…¶ä»–äººä¼šåƒå¾€å¸¸ä¸€æ ·ç›´æ¥ä½¿ç”¨ APIã€‚ç„¶è€Œï¼Œåœ¨ç”¨æˆ·ç™»å½•ä¹‹å‰æˆ‘ä»¬ä¸çŸ¥é“è¿™äº›ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬æ€»æ˜¯ä½¿ç”¨ä»£ç†æ¥å¤„ç†ç™»å½•è¯·æ±‚ã€‚

```
getApiUrl(route: string, useStaticIps: boolean): string {
  if (!environment.production) {
   return 'https://some-api.com';
  } else {
   return useStaticIps || route.includes('authentication/login') ?
    'https://some-api.gestatica.com' :
    'https://some-api.com';
  }
 }
```

## ç»“è®º

æ„Ÿè°¢æ‚¨é˜…è¯»è¿™ç¯‡å…³äºä½¿ç”¨ QuotaGuard ä½œä¸ºé™æ€ IPs è§£å†³æ–¹æ¡ˆçš„çŸ­æ–‡ã€‚å¦‚æ‚¨æ‰€è§ï¼Œè®¾ç½®åœ¨å‡ åˆ†é’Ÿå†…å®Œæˆï¼Œæ¯ä¸ªäººéƒ½å¯ä»¥å†æ¬¡è®¿é—®æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚å¦‚ä½•åœ¨æ‚¨çš„äº§å“ä¸­ä½¿ç”¨é™æ€ IPï¼Ÿè¯·åœ¨è¯„è®ºä¸­å‘Šè¯‰æˆ‘ã€‚