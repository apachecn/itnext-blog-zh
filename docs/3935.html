<html>
<head>
<title>Tip: Connecting to Azure Cosmos DB MongoDB API using the MongoDB Go driver</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">æç¤º:ä½¿ç”¨MongoDB Goé©±åŠ¨ç¨‹åºè¿æ¥åˆ°Azure Cosmos DB MongoDB API</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/tip-connecting-to-azure-cosmos-db-mongodb-api-using-the-mongodb-go-driver-a9ca1230a1c7?source=collection_archive---------6-----------------------#2020-03-27">https://itnext.io/tip-connecting-to-azure-cosmos-db-mongodb-api-using-the-mongodb-go-driver-a9ca1230a1c7?source=collection_archive---------6-----------------------#2020-03-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0f6b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://docs.microsoft.com/azure/cosmos-db/mongodb-introduction?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> Azure Cosmos DBæä¾›MongoDB APIæ”¯æŒ</a>ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥ä½¿ç”¨ç‰¹å®šè¯­è¨€çš„é©±åŠ¨ç¨‹åºæ¥æœ¬åœ°è¿æ¥åˆ°Cosmos DBã€‚</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/df66a03c2426c934ebb8fb5a3eab8be8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4WNkIFJ3TYlYldEHI3WKNw.png"/></div></div></figure><blockquote class="ky kz la"><p id="86a0" class="jn jo lb jp b jq jr js jt ju jv jw jx lc jz ka kb ld kd ke kf le kh ki kj kk ij bi translated"><em class="iq">æ–‡æ¡£ä¸­æœ‰å¾ˆå¤šèµ„æºï¼Œä¾‹å¦‚</em> <a class="ae kl" href="https://docs.microsoft.com/azure/cosmos-db/create-mongodb-java?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> <em class="iq">ä¸€ä¸ªJavaå¿«é€Ÿå…¥é—¨</em> </a> <em class="iq">ï¼Œ</em> <a class="ae kl" href="https://docs.microsoft.com/azure/cosmos-db/tutorial-develop-mongodb-react?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> <em class="iq"> Node.js + Reactæ•™ç¨‹</em> </a> <em class="iq">ç­‰ã€‚</em></p></blockquote><p id="bd72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä½†æ˜¯<a class="ae kl" href="http://golang.org/" rel="noopener ugc nofollow" target="_blank"> Golang </a>å‘¢ï¼Œå…·ä½“æ¥è¯´ï¼Œå®˜æ–¹<a class="ae kl" href="https://github.com/mongodb/mongo-go-driver" rel="noopener ugc nofollow" target="_blank"> MongoDBé©±åŠ¨</a>å‘¢ï¼Ÿæˆ‘æœŸæœ›å®ƒâ€œæ­£å¸¸å·¥ä½œâ€ï¼Œä½†æ˜¯æˆ‘é¢ä¸´ä¸€ä¸ªå°é—®é¢˜ã€‚åœ¨ç³Ÿç³•çš„ä¸€å¤©ï¼Œæˆ‘å¯èƒ½ä¼šèŠ±ä¸Šå‡ ä¸ªå°æ—¶ï¼Œç„¶å(å¯èƒ½)æ”¾å¼ƒã€‚å¹¸è¿çš„æ˜¯ï¼Œäº‹å®å¹¶éå¦‚æ­¤ï¼å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®ä½ èŠ‚çœä¸€äº›æ—¶é—´ï¼Œä»¥é˜²ä½ é‡åˆ°è¿™ç§æƒ…å†µğŸ˜‰</p><p id="5000" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘é¦–å…ˆä¸ºMongoDBç‰ˆæœ¬<code class="fe lf lg lh li b">3.6</code> ( <a class="ae kl" href="https://docs.microsoft.com/azure/cosmos-db/mongodb-feature-support?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">å¦ä¸€ä¸ªæ”¯æŒçš„ç‰ˆæœ¬æ˜¯</a> <code class="fe lf lg lh li b"><a class="ae kl" href="https://docs.microsoft.com/azure/cosmos-db/mongodb-feature-support?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">3.2</a></code>)åˆ›å»ºäº†ä¸€ä¸ªAzure Cosmos DBå¸æˆ·ï¼Œå¹¶ä»é—¨æˆ·è·å–äº†<a class="ae kl" href="https://docs.microsoft.com/azure/cosmos-db/connect-mongodb-account?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">è¿æ¥å­—ç¬¦ä¸²ã€‚æ ¼å¼å¦‚ä¸‹:</a></p><pre class="kn ko kp kq gt lj li lk ll aw lm bi"><span id="c321" class="ln lo iq li b gy lp lq l lr ls">mongodb://[COSMOSDB_ACCOUNT_NAME]:[PRIMARY_PASSWORD]@[COSMOSDB_ACCOUNT_NAME].mongo.cosmos.azure.com:10255/?ssl=true&amp;replicaSet=globaldb&amp;retrywrites=false&amp;maxIdleTimeMS=120000&amp;appName=@[COSMOSDB_ACCOUNT_NAME]@</span></pre><blockquote class="ky kz la"><p id="1a18" class="jn jo lb jp b jq jr js jt ju jv jw jx lc jz ka kb ld kd ke kf le kh ki kj kk ij bi translated"><em class="iq">æ³¨æ„ï¼Œåœ¨ç¼–å†™çš„æ—¶å€™ï¼Œä½ åªèƒ½ä½¿ç”¨Azure portal</em><a class="ae kl" href="https://docs.microsoft.com/azure/cosmos-db/cli-samples-mongodb?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"><em class="iq">åˆ›å»ºMongoDBç‰ˆæœ¬</em> </a> <code class="fe lf lg lh li b"><a class="ae kl" href="https://docs.microsoft.com/azure/cosmos-db/cli-samples-mongodb?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"><em class="iq">3.6</em></a></code> <a class="ae kl" href="https://docs.microsoft.com/azure/cosmos-db/cli-samples-mongodb?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> <em class="iq">(ä¸æ˜¯Azure CLI) </em> </a></p></blockquote><p id="58fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä½¿ç”¨è¿™ä¸ªç®€å•çš„ç¨‹åºåªæ˜¯ä¸ºäº†æµ‹è¯•è¿é€šæ€§</p><pre class="kn ko kp kq gt lj li lk ll aw lm bi"><span id="5998" class="ln lo iq li b gy lp lq l lr ls">package main</span><span id="1cb8" class="ln lo iq li b gy lt lq l lr ls">import (<br/>	"context"<br/>	"fmt"<br/>	"log"<br/>	"os"<br/>	"time"</span><span id="3bdf" class="ln lo iq li b gy lt lq l lr ls">	"go.mongodb.org/mongo-driver/mongo"<br/>	"go.mongodb.org/mongo-driver/mongo/options"<br/>)</span><span id="a1b3" class="ln lo iq li b gy lt lq l lr ls">var connectionStr string</span><span id="0cc8" class="ln lo iq li b gy lt lq l lr ls">func init() {<br/>	connectionStr = os.Getenv("MONGODB_CONNECTION_STRING")<br/>	if connectionStr == "" {<br/>		log.Fatal("Missing enviornment variable MONGODB_CONNECTION_STRING")<br/>	}<br/>}</span><span id="6863" class="ln lo iq li b gy lt lq l lr ls">func main() {</span><span id="971c" class="ln lo iq li b gy lt lq l lr ls">	ctx, cancel := context.WithTimeout(context.Background(), time.Second*10)<br/>	defer cancel()</span><span id="2e4c" class="ln lo iq li b gy lt lq l lr ls">	fmt.Println("connecting...")<br/>	clientOptions := options.Client().ApplyURI(connectionStr)<br/>	c, err := mongo.NewClient(clientOptions)</span><span id="da86" class="ln lo iq li b gy lt lq l lr ls">	err = c.Connect(ctx)</span><span id="aa1c" class="ln lo iq li b gy lt lq l lr ls">	if err != nil {<br/>		log.Fatalf("unable to connect %v", err)<br/>	}<br/>	err = c.Ping(ctx, nil)<br/>	if err != nil {<br/>		log.Fatalf("unable to ping Cosmos DB %v", err)<br/>	}</span><span id="d578" class="ln lo iq li b gy lt lq l lr ls">	fmt.Println("connected!")<br/>}</span></pre><p id="509e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¦è¿›è¡Œæµ‹è¯•ï¼Œåªéœ€è®¾ç½®è¿æ¥å­—ç¬¦ä¸²å¹¶è¿è¡Œç¨‹åº</p><pre class="kn ko kp kq gt lj li lk ll aw lm bi"><span id="6048" class="ln lo iq li b gy lp lq l lr ls">export MONGODB_CONNECTION_STRING=&lt;copy-paste from azure portal&gt;</span><span id="be68" class="ln lo iq li b gy lt lq l lr ls">go run main.go</span></pre><p id="7b3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘æœ¬ä»¥ä¸ºä¼šçœ‹åˆ°<code class="fe lf lg lh li b">connected!</code>ï¼Œä½†ç»“æœå´æ˜¯è¿™æ ·:</p><pre class="kn ko kp kq gt lj li lk ll aw lm bi"><span id="a0c6" class="ln lo iq li b gy lp lq l lr ls">unable to Ping: connection(cdb-ms-prod-southeastasia1-cm1.documents.azure.com:10255[-5]) connection is closed</span></pre><p id="6fbf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘æ ¹æ®â€œæœ‰æ ¹æ®çš„çŒœæµ‹â€å¼€å§‹è°ƒè¯•ã€‚Azure Cosmos DBé€šè¿‡<a class="ae kl" href="https://docs.microsoft.com/azure/cosmos-db/mongodb-introduction?WT.mc_id=medium-blog-abhishgu#wire-protocol-compatibility" rel="noopener ugc nofollow" target="_blank">æœ‰çº¿åè®®å…¼å®¹æ€§</a>æä¾›MongoDBæ”¯æŒï¼Œå¹¶å…è®¸æ‚¨ä½¿ç”¨å•ä¸ªç«¯ç‚¹è¿›è¡Œè¿æ¥(å‚è§è¿æ¥å­—ç¬¦ä¸²)ã€‚è¿™æ„å‘³ç€æ‚¨ä¸å¿…æ‹…å¿ƒåº•å±‚çš„æ•°æ®åº“é›†ç¾¤æ‹“æ‰‘ã€‚</p><p id="40ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä¹Ÿè®¸å¸æœºæƒ³åœ¨è¿™ç‚¹ä¸Šâ€œèªæ˜ä¸€ç‚¹â€ï¼Ÿæˆ‘å¼€å§‹æ›´ä»”ç»†åœ°ç ”ç©¶Mongoé©±åŠ¨ç¨‹åº<code class="fe lf lg lh li b"><a class="ae kl" href="https://godoc.org/go.mongodb.org/mongo-driver/mongo/options#ClientOptions" rel="noopener ugc nofollow" target="_blank">ClientOptions</a></code>åŠå…¶å¯ç”¨æ–¹æ³•ï¼Œç»“æœå‘ç°:<code class="fe lf lg lh li b"><a class="ae kl" href="https://godoc.org/go.mongodb.org/mongo-driver/mongo/options#ClientOptions.SetDirect" rel="noopener ugc nofollow" target="_blank">SetDirect</a></code>æ–¹æ³•ï¼</p><p id="eec0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¿™æ˜¯Godoc:</p><pre class="kn ko kp kq gt lj li lk ll aw lm bi"><span id="542d" class="ln lo iq li b gy lp lq l lr ls">SetDirect specifies whether or not a direct connect should be made. To use this option, a URI with a single host must be specified through ApplyURI. If set to true, the driver will only connect to the host provided in the URI and will not discover other hosts in the cluster. This can also be set through the "connect" URI option with the following values:</span><span id="0e90" class="ln lo iq li b gy lt lq l lr ls">1. "connect=direct" for direct connections</span><span id="c870" class="ln lo iq li b gy lt lq l lr ls">2. "connect=automatic" for automatic discovery.</span><span id="7d54" class="ln lo iq li b gy lt lq l lr ls">The default is false ("automatic" in the connection string).</span></pre><p id="1167" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘æ‰€è¦åšçš„å°±æ˜¯æ›´æ–°<code class="fe lf lg lh li b">ClientOptions</code></p><pre class="kn ko kp kq gt lj li lk ll aw lm bi"><span id="42c0" class="ln lo iq li b gy lp lq l lr ls">clientOptions := options.Client().ApplyURI(connectionStr).<strong class="li ir">SetDirect(true)</strong></span></pre><blockquote class="ky kz la"><p id="1a62" class="jn jo lb jp b jq jr js jt ju jv jw jx lc jz ka kb ld kd ke kf le kh ki kj kk ij bi translated"><em class="iq">ä½ ä¹Ÿå¯ä»¥é€šè¿‡æ·»åŠ </em> <code class="fe lf lg lh li b"><em class="iq">connect=direct</em></code> <em class="iq">(æ ¹æ®Godoc)å°†å®ƒæ·»åŠ åˆ°è¿æ¥å­—ç¬¦ä¸²æœ¬èº«ï¼Œæˆ‘å¯ä»¥ç¡®è®¤å®ƒä¹Ÿèƒ½å·¥ä½œ</em></p></blockquote><p id="7b89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å°±æ˜¯è¿™æ ·ã€‚ç°åœ¨æˆ‘èƒ½å¤Ÿè¿æ¥åˆ°Azure Cosmos DB MongoDB APIäº†ğŸ™Œè¯·ç»§ç»­å…³æ³¨å³å°†å‘å¸ƒçš„åšå®¢æ–‡ç« ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å€ŸåŠ©ä¸€ä¸ªå®é™…çš„ä¾‹å­æ·±å…¥ç ”ç©¶Azure Cosmos DB + Goä¸Šçš„MongoDBï¼</p></div></div>    
</body>
</html>