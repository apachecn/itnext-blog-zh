<html>
<head>
<title>Going epic with Redux Observable tests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨Reduxå¯è§‚å¯Ÿæµ‹è¯•è¿›è¡Œå²è¯—çº§æµ‹è¯•</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/going-epic-with-redux-observable-tests-dd42b80ee4f8?source=collection_archive---------0-----------------------#2018-01-26">https://itnext.io/going-epic-with-redux-observable-tests-dd42b80ee4f8?source=collection_archive---------0-----------------------#2018-01-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="49c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fitnext.io%2Fgoing-epic-with-redux-observable-tests-dd42b80ee4f8" rel="noopener ugc nofollow" target="_blank"> <em class="km">ç‚¹å‡»è¿™é‡Œåœ¨LinkedIn </em>ä¸Šåˆ†äº«è¿™ç¯‡æ–‡ç« </a></p><p id="cdd1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘å¼€å‘çš„æœ€åå‡ ä¸ªReacté¡¹ç›®æ˜¯åœ¨<strong class="jp ir"> Redux Observable </strong>åº“çš„å¤§é‡å¸®åŠ©ä¸‹æ„å»ºçš„ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å°†ä¸šåŠ¡é€»è¾‘ä»ç»„ä»¶ä¸­åˆ†ç¦»å‡ºæ¥çš„åº“ï¼Œä½†æ˜¯æ­£ç¡®çš„æµ‹è¯•æ–¹æ³•ä»ç„¶æ˜¯ä»–ä»¬éœ€è¦æ‰¾åˆ°çš„ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†åˆ†äº«æˆ‘å¯¹è¿™ä¸ªè¯é¢˜çš„æƒ³æ³•ã€‚</p><h1 id="b6c7" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">é‚£ä¹ˆè¿™ä¸ªReduxå¯è§‚æµ‹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</h1><p id="9f45" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">å¯¹äºé‚£äº›ä¸äº†è§£è¿™ä¸ªåº“çš„äººï¼Œæˆ‘æ¨èä½ å»çœ‹çœ‹<a class="ae kl" href="https://www.youtube.com/watch?v=AslncyG8whg" rel="noopener ugc nofollow" target="_blank"> RxJS + Redux + React = Amazingï¼æ°ä¼ŠÂ·è²å°”æ™®æ–¯çš„è°ˆè¯ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸é¼“èˆäººå¿ƒçš„æ¼”è®²ï¼Œè®²è¿°äº†ç½‘é£å¦‚ä½•ä½¿ç”¨ä¸€äº›å¸¸è§çš„JSæ¨¡å¼ç»“åˆ</a><a class="ae kl" href="https://www.robinvdvleuten.nl/blog/going-epic-with-redux-observable-tests/(https://github.com/Reactive-Extensions/RxJS" rel="noopener ugc nofollow" target="_blank"> RxJS </a>çš„åŠŸèƒ½æ¥ç®¡ç†Reactåº”ç”¨ç¨‹åºä¸­çš„ä¸šåŠ¡é€»è¾‘ã€‚ä»–ä»¬ä»ç½‘é£æå–äº†æ ¸å¿ƒï¼Œå¹¶åœ¨Githubä¸Šä½œä¸ºå¼€æºåº“<a class="ae kl" href="https://github.com/redux-observable/redux-observable/" rel="noopener ugc nofollow" target="_blank">å…±äº«ã€‚</a></p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/c69df2bb168993c1078ec29e48d1fed1.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/1*iyup_llTYsmHINX5wnTI1Q.gif"/></div></figure><p id="6685" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä»–ä»¬çš„<a class="ae kl" href="https://redux-observable.js.org/" rel="noopener ugc nofollow" target="_blank">æ–‡æ¡£</a>éå¸¸ä¼˜ç§€ï¼ŒåŒ…å«äº†è®¸å¤šå°çš„è¿è¡Œç¤ºä¾‹æ¥å¸®åŠ©ä½ å¼€å§‹ã€‚æ•´ä¸ªå›¾ä¹¦é¦†æœ¬èº«å°±å€¼å¾—å†™ä¸€ç¯‡æ–‡ç« ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé‡è¦çš„æ–¹é¢ä»ç„¶æ²¡æœ‰å¾—åˆ°å……åˆ†çš„å±•ç¤ºã€‚äº‹å®ä¸Šï¼Œä»–ä»¬è‡ªå·±è¿˜åœ¨ä¸ºæœ€ä½³é€”å¾„è€ŒæŒ£æ‰ï¼›</p><blockquote class="ly lz ma"><p id="c957" class="jn jo km jp b jq jr js jt ju jv jw jx mb jz ka kb mc kd ke kf md kh ki kj kk ij bi translated">æµ‹è¯•ä¼šäº§ç”Ÿå‰¯ä½œç”¨çš„å¼‚æ­¥ä»£ç å¹¶ä¸å®¹æ˜“ã€‚æˆ‘ä»¬ä»åœ¨å­¦ä¹ æµ‹è¯•å²è¯—çš„æœ€ä½³æ–¹æ³•ã€‚å¦‚æœä½ æ‰¾åˆ°äº†å®Œç¾çš„æ–¹æ³•ï¼Œè¯·åˆ†äº«ï¼â€<br/> â€”  <a class="ae kl" href="https://redux-observable.js.org/docs/recipes/WritingTests.html" rel="noopener ugc nofollow" target="_blank"> <em class="iq"> Reduxå¯è§‚å¯Ÿæ–‡æ¡£</em> </a></p></blockquote><p id="05e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">åœ¨ä¸å‡ ä¸ªé¡¹ç›®ä¸Šçš„å¯è§‚å¯Ÿæµ‹è¯•è¿›è¡Œæ–—äº‰ä¹‹åï¼Œæˆ‘æƒ³åœ¨æœ¬æ–‡ä¸­å°±è¿™ä¸ªä¸»é¢˜å‘è¡¨æˆ‘çš„ä¸¤ç‚¹æ„è§ã€‚</p><h1 id="4670" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">æˆ‘ä»¬è¦æµ‹è¯•ä»€ä¹ˆå²è¯—ï¼Ÿ</h1><p id="b84e" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">ä¸ºäº†æ›´å¥½åœ°å±•ç¤ºå¦‚ä½•æµ‹è¯•å¼‚æ­¥ä¸šåŠ¡é€»è¾‘ï¼Œæˆ‘æƒ³åˆ°äº†ä»¥ä¸‹æ–¹æ³•:</p><pre class="lr ls lt lu gt me mf mg mh aw mi bi"><span id="bcaa" class="mj ko iq mf b gy mk ml l mm mn">export const authenticateUserEpic = (action$, store, { client }) =&gt; {<br/>  // Only act on actions of a given type,<br/>  // in this case "USER_AUTHENTICATE_REQUEST".<br/>  return action$.ofType('USER_AUTHENTICATE_REQUEST')<br/>    // Map the received action to a new action "observable".<br/>    .switchMap(action =&gt; {<br/>      // Authenticate with the dispatched credentials in the action,<br/>      // using the injected client instance.<br/>      return client.authenticate(action.username, action.password)<br/>        .then(response =&gt; {<br/>          if (!response.isSuccessful) {<br/>            // Map the response to a "failed" action with the error.<br/>            return {<br/>              type: 'USER_AUTHENTICATE_FAILURE',<br/>              error: 'Something went wrong while authenticating',<br/>            };<br/>          }</span><span id="1b27" class="mj ko iq mf b gy mo ml l mm mn">          return {<br/>            // Map the response to a "successful" action with a JWT token.<br/>            type: 'USER_AUTHENTICATE_SUCCESS',<br/>            idToken: response.idToken,<br/>          };<br/>        });<br/>    });<br/>}</span></pre><p id="c8c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œè¿™æ˜¯ä¸€éƒ¨å…³äºä½¿ç”¨å‘é€çš„å‡­è¯å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯çš„å²è¯—ã€‚æˆ‘å¯ä»¥æƒ³è±¡æˆ‘ä¼šæ´¾é£è¿™æ ·çš„è¡ŒåŠ¨ï¼›</p><pre class="lr ls lt lu gt me mf mg mh aw mi bi"><span id="7f99" class="mj ko iq mf b gy mk ml l mm mn">export const authenticate = (username, password) {<br/>  return { type: 'USER_AUTHENTICATE_REQUEST', username, password };<br/>}</span><span id="d18a" class="mj ko iq mf b gy mo ml l mm mn">dispatch(authenticate('johndoe', 'mysupersecretpassword'));</span></pre><p id="a0f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä½ å¯èƒ½ä¹Ÿæ³¨æ„åˆ°äº†ï¼Œæˆ‘å·²ç»å°†å®¢æˆ·ç«¯ä¾èµ–å…³ç³»æ³¨å…¥åˆ°æˆ‘çš„epicä¸­ã€‚æ‚¨å¯ä»¥é€šè¿‡<em class="km"> require </em>æˆ–<em class="km"> import </em>è¯­å¥è·å¾—ä¸€ä¸ªå®¢æˆ·ç«¯å®ä¾‹ã€‚ä½†æ˜¯é€šè¿‡ä½¿ç”¨<em class="km">ä¾èµ–æ³¨å…¥</em>ï¼Œå®ƒä½¿å¾—å®¢æˆ·ç«¯æ–¹å¼æ›´å®¹æ˜“è¢«æ¨¡ä»¿ï¼Œè€Œä½ çš„epicæ–¹å¼æ›´å®¹æ˜“è¢«æµ‹è¯•ã€‚</p><h1 id="d3d8" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">ç”¨Jeståˆ›å»ºæµ‹è¯•</h1><p id="95cf" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">å¤§å¤šæ•°Reacté¡¹ç›®ä¼¼ä¹éƒ½åœ¨ä½¿ç”¨<a class="ae kl" href="https://facebook.github.io/jest/" rel="noopener ugc nofollow" target="_blank"> Jest </a>ï¼Œæ‰€ä»¥æˆ‘åªåœ¨ç¤ºä¾‹æµ‹è¯•ä¸­ä½¿ç”¨å®ƒã€‚</p><p id="c4b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘æµ‹è¯•ä¸Šè¿°epicçš„æ–¹æ³•æ˜¯ï¼Œå½“epicæ¥æ”¶åˆ°<em class="km">åˆ†æ´¾çš„</em>åŠ¨ä½œæ—¶ï¼Œå¾—åˆ°<em class="km">é¢„æœŸçš„</em>åŠ¨ä½œã€‚å› æ­¤ï¼Œå¯¹epicçš„å¿«é€Ÿæµè§ˆå‘Šè¯‰æˆ‘ä»¬ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ä¸ªæµ‹è¯•ï¼›ä¸€ä¸ªæ˜¯æˆ‘ä»¬æœŸæœ›çš„å¸¦æœ‰JWTä»¤ç‰Œçš„â€œç”¨æˆ·éªŒè¯æˆåŠŸâ€,å¦ä¸€ä¸ªæ˜¯æˆ‘ä»¬æœŸæœ›çš„å¸¦æœ‰é”™è¯¯çš„â€œç”¨æˆ·éªŒè¯å¤±è´¥â€ã€‚è¦å°†å®ƒä»¬å®šä¹‰ä¸ºJestæµ‹è¯•ï¼Œå¯ä»¥è¿™æ ·å®šä¹‰å®ƒä»¬:</p><pre class="lr ls lt lu gt me mf mg mh aw mi bi"><span id="2be5" class="mj ko iq mf b gy mk ml l mm mn">describe('authenticateUserEpic', () =&gt; {<br/>  it('should dispatch a JWT token when authenticating is successful', () =&gt; {<br/>    // ...<br/>  })</span><span id="e0d4" class="mj ko iq mf b gy mo ml l mm mn">  it('should dispatch an error when authenticating has failed', () =&gt; {<br/>    // ...<br/>  })<br/>});</span></pre><p id="ffc2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ‰€ä»¥ç°åœ¨è®©æˆ‘ä»¬æŠŠæ³¨æ„åŠ›é›†ä¸­åœ¨ç¬¬ä¸€ä¸ªæµ‹è¯•ä¸Šã€‚æˆ‘ä»¬éœ€è¦å‘epicä¼ é€’<em class="km">è°ƒåº¦</em>åŠ¨ä½œï¼Œå¹¶åœ¨RxJSè§‚å¯Ÿå®Œæˆæ—¶è·å¾—ç»“æœåŠ¨ä½œã€‚æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥ç¼–å†™è¿™æ ·çš„ä»£ç ï¼Œä½†æ˜¯ä¸‹é¢çš„æ–¹æ³•æœ€é€‚åˆæˆ‘ï¼›</p><pre class="lr ls lt lu gt me mf mg mh aw mi bi"><span id="2b31" class="mj ko iq mf b gy mk ml l mm mn">import { ActionsObservable } from 'redux-observable';<br/>import authenticateUserEpic from './epics';</span><span id="3299" class="mj ko iq mf b gy mo ml l mm mn">// ...</span><span id="3c54" class="mj ko iq mf b gy mo ml l mm mn">it('should dispatch a JWT token when authenticating is successful', async () =&gt; {<br/>  // The response object we expect to receive from the server.<br/>  const response = {<br/>    isSuccessful: true,<br/>    idToken: 'a-random-generated-jwt',<br/>  };</span><span id="13f9" class="mj ko iq mf b gy mo ml l mm mn">  // Create a fake client instance which will return<br/>  const client = { authenticate: jest.fn() };<br/>  client.authenticate.mockReturnValue(Promise.resolve(response));</span><span id="ead8" class="mj ko iq mf b gy mo ml l mm mn">  // Create an Observable stream of the dispatching action.<br/>  const action$ = ActonsObservable.of({<br/>    type: 'USER_AUTHENTICATE_REQUEST',<br/>    username: 'johndoe',<br/>    password: 'mysupersecretpassword',<br/>  });</span><span id="b781" class="mj ko iq mf b gy mo ml l mm mn">  // Pass the Observable action to our action and inject the<br/>  // mocked client instance.<br/>  const epic$ = authenticateUserEpic(action$, store, { client });</span><span id="4a1d" class="mj ko iq mf b gy mo ml l mm mn">  // Get the resulting actions by using async/await.<br/>  const result = await epic$.toArray().toPromise();</span><span id="7aa7" class="mj ko iq mf b gy mo ml l mm mn">  // Test if we've received the expected action as result.<br/>  expect(result).toEqual([<br/>    { type: 'USER_AUTHENTICATE_SUCCESS', idToken: 'a-random-generated-jwt' }<br/>  ])<br/>});</span></pre><p id="ba43" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ²¡é‚£ä¹ˆéš¾å§ã€‚ä½ é¦–å…ˆéœ€è¦äº†è§£RxJSã€‚ä½†æ˜¯åœ¨è¿™ä¹‹åï¼Œæ‚¨å°†åœ¨Reactåº”ç”¨ç¨‹åºä¸­å¾ˆå¥½åœ°åˆ†ç¦»å…³æ³¨ç‚¹ã€‚ä¸ºäº†ä½¿ç¤ºä¾‹å®Œæ•´ï¼Œä¸‹é¢çš„æµ‹è¯•å°†å¤„ç†å¤±è´¥çš„å“åº”ï¼›</p><pre class="lr ls lt lu gt me mf mg mh aw mi bi"><span id="c828" class="mj ko iq mf b gy mk ml l mm mn">it('should dispatch an error when authenticating has failed', async () =&gt; {<br/>  // The response object we expect to receive from the server.<br/>  const response = {<br/>    isSuccessful: false,<br/>  };</span><span id="e626" class="mj ko iq mf b gy mo ml l mm mn">  // Create a fake client instance which will return<br/>  const client = { authenticate: jest.fn() };<br/>  client.authenticate.mockReturnValue(Promise.resolve(response));</span><span id="1f9d" class="mj ko iq mf b gy mo ml l mm mn">  // Create an Observable stream of the dispatching action.<br/>  const action$ = ActonsObservable.of({<br/>    type: 'USER_AUTHENTICATE_REQUEST',<br/>    username: 'johndoe',<br/>    password: 'mysupersecretpassword',<br/>  });</span><span id="be6f" class="mj ko iq mf b gy mo ml l mm mn">  // Pass the Observable action to our action and inject the<br/>  // mocked client instance.<br/>  const epic$ = authenticateUserEpic(action$, store, { client });</span><span id="85e4" class="mj ko iq mf b gy mo ml l mm mn">  // Get the resulting actions by using async/await.<br/>  const result = await epic$.toArray().toPromise();</span><span id="e5a7" class="mj ko iq mf b gy mo ml l mm mn">  // Test if we've received the expected action as result.<br/>  expect(result).toEqual([<br/>    { type: 'USER_AUTHENTICATE_FAILURE', error: 'Something went wrong while authenticating' }<br/>  ])<br/>});</span></pre><p id="a1d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä¸€è·¯ä¸Šæˆ‘æœ‰æ²¡æœ‰å¤´ç–¼ï¼Ÿåœ¨å¯¹RxJSæœ‰ä¸€ä¸ªåŸºæœ¬çš„äº†è§£ä¹‹å‰æˆ‘è‚¯å®šæ˜¯å¾—äº†<a class="ae kl" href="https://stackoverflow.com/questions/42276419/invoking-epics-from-within-other-epics" rel="noopener ugc nofollow" target="_blank">ä¸€äº›</a> <a class="ae kl" href="https://stackoverflow.com/questions/47037119/testing-observable-epic-which-invokes-other-epic" rel="noopener ugc nofollow" target="_blank">é¢˜</a>ï¼ä½†å¹¸è¿çš„æ˜¯ï¼ŒRedux Observableéå¸¸æœ‰ç”¨ã€‚ç°åœ¨æˆ‘æœ‰äº†ä¸€ä¸ªéå¸¸æœ‰ä»·å€¼çš„æ–°å·¥å…·æ¥æ„å»ºæˆ‘çš„Reactåº”ç”¨ç¨‹åºğŸ‘Œ</p><pre class="lr ls lt lu gt me mf mg mh aw mi bi"><span id="df12" class="mj ko iq mf b gy mk ml l mm mn">Originally published at <a class="ae kl" href="https://www.robinvdvleuten.nl/blog/going-epic-with-redux-observable-tests/?utm_source=medium&amp;utm_medium=article" rel="noopener ugc nofollow" target="_blank">www.robinvdvleuten.nl</a></span></pre></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="dc60" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="km">å¸Œæœ›å®ƒå¸®åŠ©ä½ ç”¨Reactå’ŒRxJSæ„å»ºäº†ä¸€äº›ä»¤äººæƒŠå¥‡çš„ä¸œè¥¿ã€‚è¯·åœ¨ä¸‹æ–¹æŒ‰</em> <strong class="jp ir"> <em class="km">æ¨è</em> </strong> <em class="km">å±•ç¤ºä¸€äº›æ¬£èµæˆ–åœ¨è¯„è®ºä¸­åˆ†äº«ä½ çš„æƒ³æ³•ã€‚</em></p><p id="6085" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¦‚æœä½ æ­£åœ¨åšç±»ä¼¼çš„äº‹æƒ…ï¼Œå¹¶ä¸”æœ‰ä»»ä½•ä½ è®¤ä¸ºæˆ‘å¯ä»¥å¸®å¿™çš„é—®é¢˜ï¼Œæˆ‘æ˜¯æ¨ç‰¹ä¸Šçš„<a class="ae kl" href="https://twitter.com/robinvdvleuten" rel="noopener ugc nofollow" target="_blank"><em class="km">@ robinvdvleuten</em></a><em class="km">ï¼</em></p></div></div>    
</body>
</html>