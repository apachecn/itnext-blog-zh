# ç°ä»£èŠ‚ç‚¹ç¬¬ 1 éƒ¨åˆ†â€”â€”æ¶æ„å’Œæ­å»º TypeScript & Express API

> åŸæ–‡ï¼š<https://itnext.io/modern-node-part-1-architecting-and-scaffolding-a-typescript-express-api-22e87fee054c?source=collection_archive---------0----------------------->

![](img/5b7e8c91006ef9e73aff13b4e2bbfe36.png)

çº½çº¦çš„èˆ¹

# ä»‹ç»

åœ¨è¿‡å»ä¸€å¹´å·¦å³çš„æ—¶é—´é‡Œï¼Œæˆ‘å·²ç»ä»ä¸»è¦ä»äº‹åº”ç”¨ç¨‹åºä»£ç å’Œè¾ƒä½çº§åˆ«çš„ä¸šåŠ¡é€»è¾‘è½¬å‘ä»äº‹æ¶æ„ã€åŸºç¡€è®¾æ–½å’Œæ‰€æœ‰æœ‰åŠ©äºæ¶æ„ã€åˆ›å»ºã€éƒ¨ç½²å’Œä¿æŒç”Ÿäº§çº§åº”ç”¨ç¨‹åºè¿è¡Œçš„ä¸åŒéƒ¨åˆ†ã€‚è€Œä¸”ï¼Œä½œä¸ºä¸€ä¸ªè‡ªå­¦æˆæ‰çš„è½¯ä»¶å·¥ç¨‹å¸ˆï¼Œæˆ‘å®Œå…¨çŸ¥é“ä»å¤´åˆ°å°¾æœç´¢ä¸€ä¸ªçœŸæ­£å®Œæ•´çš„æ•™ç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œè¿™ä¸ªæ•™ç¨‹å°†åœ¨ç”Ÿäº§ä¸­å®é™…å·¥ä½œï¼Œå¹¶ä¸”æ²¡æœ‰ç»“æœã€‚

æ—¢ç„¶æˆ‘è‡ªå·±ä¹Ÿç»å†è¿‡è¿™ç§æƒ…å†µï¼Œå¹¶ä¸”å¿…é¡»åœ¨çŸ­æ—¶é—´å†…å¸æ”¶å¤§é‡çŸ¥è¯†ï¼Œé‚£ä¹ˆåœ¨æœ¬ç³»åˆ—ä¸­ï¼Œæˆ‘æƒ³ä¸¾ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ï¼Œè¿™æ˜¯æˆ‘åœ¨å­¦ä¹ è¯€çªæ—¶æ‰€å¸Œæœ›çš„ã€‚ä»å¼€å‘æˆ‘è‡ªå·±çš„åº”ç”¨ç¨‹åºï¼Œåˆ°ä¸€å®¶ä¸­å‹å…¬å¸æ”¹é€ ä»–ä»¬çš„æŠ€æœ¯å †æ ˆï¼Œåˆ°ä¸€å®¶ä¼ä¸šå…¬å¸ä¸Šå¸‚ï¼Œå†åˆ°ç°åœ¨ä¸€å®¶ä»é›¶å®šåˆ¶åŸºç¡€è®¾æ–½èµ·æ­¥çš„åˆ›ä¸šå…¬å¸ï¼Œæˆ‘æ³¨æ„åˆ°äº†æˆ‘æ‰€å¼€å‘çš„æ¯ä¸€ä¸ªåº”ç”¨ç¨‹åºæˆ–å¹³å°çš„è¶‹åŠ¿å’Œå…±åŒç‚¹ã€‚

æˆ‘ä¸€ç›´è‡´åŠ›äºæ”¹è¿›æ„å»ºç”Ÿäº§å°±ç»ªå‹åº”ç”¨ç¨‹åºçš„è¿‡ç¨‹ï¼ŒåŒæ—¶åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ä»äº‹è¾…åŠ©é¡¹ç›®ï¼Œå¹¶ä½¿ç”¨æˆ‘å°†åœ¨æœ¬æ–‡ä¸­æè¿°çš„è¿‡ç¨‹æ¥åˆ›å»ºä½¿ç”¨è¡Œä¸šæœ€ä½³å®è·µéƒ¨ç½²åœ¨äº‘ä¸­çš„å…¨åŠŸèƒ½ã€å¤šç¯å¢ƒåº”ç”¨ç¨‹åºã€‚

ç°åœ¨ï¼Œæˆ‘æƒ³æŠŠè¿™äº›è¶£é—»ç§¯ç´¯æˆä¸€äº›æœ‰ç”¨çš„ä¸œè¥¿ï¼Œå¹¶æŠŠå®ƒä»¬ä¼ é€’ç»™æ‰€æœ‰å…¨æ–°çš„ï¼Œç”šè‡³æ˜¯æœ‰ç»éªŒçš„è½¯ä»¶å·¥ç¨‹å¸ˆï¼Œä»–ä»¬å¯èƒ½æ­£åœ¨å¯»æ‰¾è‡ªå·±åº”ç”¨ç¨‹åºçš„æœ€ä½³å®è·µï¼Œåœ¨å·¥ä½œä¸­å¸®åŠ©ä¸€ä¸ªé¡¹ç›®ï¼Œæˆ–è€…çœŸçš„è¦å¦‚ä½•å¤„ç†ä»»ä½•å…¨æ ˆåº”ç”¨ç¨‹åºã€‚

**TLï¼›DR:è¿™å°†æ˜¯ä¸€ä¸ªå…³äºæ„å»ºç”Ÿäº§å°±ç»ªã€å®Œå…¨éƒ¨ç½²çš„åº”ç”¨ç¨‹åºçš„ç³»åˆ—ï¼Œè¯¥åº”ç”¨ç¨‹åºå…·æœ‰ç”¨äº API å±‚çš„ Next.js å‰ç«¯å’Œ Node.js å¾®æœåŠ¡ã€‚æˆ‘ä»¬å°†ä»é›¶ä»£ç ä¸€ç›´åˆ°åœ¨ AWS ä¸Šéƒ¨ç½²åˆ°å¤šä¸ªç¯å¢ƒã€‚**

## æˆ‘ä»¬å°†å»ºé€ ä»€ä¹ˆï¼Ÿ

æˆ‘ä»¬å°†ä¸ºæœ€è¿‘çš„ä¸€ç±»åº”ç”¨å¼€å‘ä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼Œç”¨å®ƒä»¬ç³Ÿç³•çš„ UX æˆ–ç¼ºä¹åŠŸèƒ½æ¥æŒ«è´¥æˆ‘:ä¸ªäººç†è´¢åº”ç”¨ï¼å¯¹æˆ‘æ¥è¯´ï¼Œè¿™æ˜¯å¦æ˜¯ä¸€ä¸ªå•ç”¨æˆ·åº”ç”¨ç¨‹åºå¹¶ä¸é‡è¦ï¼Œå› ä¸ºå®ƒå°†å®Œå…¨æŒ‰ç…§æˆ‘çš„è¦æ±‚è·Ÿè¸ªæˆ‘è‡ªå·±çš„è´¢åŠ¡çŠ¶å†µï¼Œå¹¶å°†å¾ˆå¥½åœ°è¯´æ˜æ„å»ºä»»ä½•ç”Ÿäº§å°±ç»ªåº”ç”¨ç¨‹åºçš„è¿‡ç¨‹ã€‚

å¯¹äºè¯­è¨€å’Œæ¡†æ¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ç§æˆ‘è§è¿‡çš„æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼å¯ä»¥ç”¨äºç”Ÿäº§ä¸­çš„å¤§å¤šæ•°åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”åªéœ€è¦è¾ƒæ–°çš„å·¥ç¨‹å¸ˆå­¦ä¹ ä¸€ç§è¯­è¨€:ä¸€ä¸ªé¢å‘åº”ç”¨çš„ API å’Œä½œä¸šè¿è¡ŒæœåŠ¡çš„ [Node.jsï¼Œä¸€ä¸ªç”¨](https://nodejs.org/en/) [Chakra UI](https://chakra-ui.com/) å’Œ [React Query](https://react-query.tanstack.com/) ã€é¢å‘ç”¨æˆ·çš„æœç´¢çš„ [ElasticSearch](https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html) ã€ä¼šè¯ç®¡ç†çš„ [Redis](https://redis.io/) å’Œ Docker[æ„å»ºçš„ Next.js React åº”ç”¨](https://www.docker.com/)

ç„¶åï¼Œæˆ‘ä»¬å°†æŠŠè¿™ä¸ªå †æ ˆéƒ¨ç½²åˆ°ä¸¤ä¸ªç‹¬ç«‹çš„æœåŠ¡ä¸­ï¼Œè¿™æ—¢ç¬¦åˆæˆ‘ä½œä¸ºå¼€å‘äººå‘˜çš„åå¥½ï¼Œä¹Ÿä¸ºè¯»è€…æä¾›äº†ä¸€ä¸ªéƒ¨ç½²åˆ°å¤šä¸ªç‰¹å®šäº‘æä¾›å•†çš„ç¤ºä¾‹ã€‚æˆ‘ä»¬å°†åœ¨äºšé©¬é€Šç½‘ç»œæœåŠ¡[ä¸Šæ‰˜ç®¡é™¤](https://aws.amazon.com/) [Next.js](https://nextjs.org/) åº”ç”¨ä¹‹å¤–çš„æ‰€æœ‰åº”ç”¨ï¼Œå¹¶åœ¨ Vercel çš„[å¹³å°](https://vercel.com/)ä¸Šæ‰˜ç®¡ Next.js åº”ç”¨ï¼Œè¿™åœ¨æœ€è¿‘çš„è¿‡å»è¢«è¯æ˜éå¸¸æœ‰ç”¨ä¸”æ˜“äºä½¿ç”¨(æˆ‘æœ€å–œæ¬¢çš„ä»–ä»¬çš„åŠŸèƒ½æ˜¯ branch preview deployï¼Œå®ƒä½¿åœ¨ç´§å¯†çš„åé¦ˆå¾ªç¯ä¸­ä¸äº§å“ç»ç†å’Œè®¾è®¡å¸ˆåˆä½œå˜å¾—ç»å¯¹å®¹æ˜“)ã€‚æ€»çš„æ¥è¯´ï¼Œè¿™å°±æ˜¯æˆ‘å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¤„äºé¡¹ç›®é˜¶æ®µçš„åº”ç”¨ç¨‹åºï¼Œä½†æˆ‘ä»¬å¸Œæœ›åœ¨æ²¡æœ‰é‡å¤§æ¨¡å¼è½¬å˜çš„æƒ…å†µä¸‹ï¼Œéšæ—¶å‡†å¤‡æ— é™æ‰©å¤§è§„æ¨¡ã€‚æˆ‘ä»¬è¿˜å°†ä½¿ç”¨ [Terraform](https://www.terraform.io/docs/index.html) å®Œæˆæ‰€æœ‰è¿™äº› AWS åŸºç¡€è®¾æ–½ç®¡ç†ï¼Œæˆ‘ä¹Ÿå¼ºçƒˆæ¨èè¿™æ¬¾äº§å“ã€‚æˆ‘å·¥ä½œè¿‡çš„æ‰€æœ‰å…¬å¸è¦ä¹ˆå·²ç»æœ‰äº†å®ƒï¼Œè¦ä¹ˆå› ä¸ºå®ƒçš„æœ‰ç”¨æ€§æˆ‘å·²ç»æŠŠå®ƒçº³å…¥äº†æŠ€æœ¯å †æ ˆã€‚

**TLï¼›DR:æˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªä¸ªäººé‡‘èåº”ç”¨ç¨‹åºï¼Œä¸ç”¨æˆ·çš„é“¶è¡Œè´¦æˆ·åŒæ­¥ï¼Œé€šè¿‡ sessions å’Œ Redis å®Œå…¨è®¤è¯ï¼Œä»å¤´å¼€å§‹ä½¿ç”¨ ElasticSearchï¼ŒDocker ç”¨äºæœ¬åœ°å¼€å‘å’Œä¸å¯çŸ¥éƒ¨ç½²ï¼ŒTerraform ç”¨äºåŸºç¡€è®¾æ–½ç®¡ç†**

## æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¼šåšä»€ä¹ˆï¼Ÿ

åœ¨ä½¿ç”¨äº†å„ç§ä¸åŒçš„ä¸ªäººè´¢åŠ¡å’Œé¢„ç®—åº”ç”¨ç¨‹åºåï¼Œæˆ‘å‘ç°ç”µå­è¡¨æ ¼å¯¹æˆ‘æ¥è¯´æ›´ç®€å•äº†ã€‚ç„¶è€Œï¼Œæœ‰å¾ˆå¤šäº‹æƒ…ä½ ä¸èƒ½ç”¨åº”ç”¨ç¨‹åºä¸­çš„ç”µå­è¡¨æ ¼æ¥åšï¼Œæ¯”å¦‚è‡ªåŠ¨ä¸ä½ çš„é“¶è¡Œè´¦æˆ·åŒæ­¥ï¼Œè‡ªåŠ¨å¯¹è´¹ç”¨è¿›è¡Œåˆ†ç±»ï¼Œåˆ¶ä½œæœ‰ç”¨çš„å¯è§†åŒ–å·¥å…·æ¥æ£€æŸ¥ä½ çš„é¢„ç®—æˆ–å‚¨è“„ç›®æ ‡ï¼Œå½“çœ‹ç€é¢å‰çš„ç”¨æˆ·ç•Œé¢æ—¶ä¸ä¼šå‘•åï¼Œç­‰ç­‰ã€‚

æœ¬è´¨ä¸Šï¼Œæˆ‘ä»¬å°†ä¸ºæ ¸å¿ƒåŠŸèƒ½æ„å»ºè¿™ä¸ª:

*   ä¸€ä¸ªä»ªè¡¨æ¿ï¼Œåœ¨è¿™é‡Œä½ å¯ä»¥æ‰¾åˆ°å…³äºä½ çš„èŠ±è´¹ã€é¢„ç®—ä½¿ç”¨ã€å‚¨è“„ç›®æ ‡ç­‰ä½ éœ€è¦çš„å¤§éƒ¨åˆ†ä¸œè¥¿ã€‚
*   ä¸€ä¸ªé¢„ç®—é¡µé¢ï¼Œå®é™…ä¸Šå»ºç«‹ä½ è‡ªå·±çš„æ¯ä¸ªç±»åˆ«çš„é¢„ç®—
*   æœç´¢è´¹ç”¨
*   ä¸€ä¸ªè´¹ç”¨é¡µé¢æ¥è®°å½•ä½ çš„æ”¯å‡º
*   å‡€å€¼å’Œå‚¨è“„ç›®æ ‡/è´¢åŠ¡è§„åˆ’é¡µé¢
*   æ·»åŠ æˆ–ç®¡ç†æ‚¨çš„å·²è¿æ¥å¸æˆ·çš„é¡µé¢
*   è´¹ç”¨ã€é¢„ç®—ç±»åˆ«ç­‰çš„è¯¦ç»†é¡µé¢ã€‚

## æˆ‘ä»¬çš„æŠ€æœ¯å †æ ˆå°†ä½¿ç”¨ä»€ä¹ˆï¼Ÿ

æœ€åï¼Œåœ¨è¿™ä¸ªé¡¹ç›®ä¸­æˆ‘ä»¬å°†ä¸»è¦ä½¿ç”¨ä»€ä¹ˆå·¥å…·å’Œåº“ï¼Ÿè¯·è®°ä½ï¼Œæˆ‘ä»¬ä¸ä¼šåœ¨æœ¬æ–‡ä¸­ä½¿ç”¨æ‰€æœ‰è¿™äº›ï¼Œè€Œæ˜¯åœ¨æ•´ä¸ªç³»åˆ—ä¸­ä½¿ç”¨ä¸€å°éƒ¨åˆ†ã€‚

*   Next.js
*   èŠ‚ç‚¹. js
*   è¡¨è¾¾
*   é›·è¿ªæ–¯
*   å¼¹æ€§æœç´¢
*   ç å¤´å·¥äºº
*   docker-æ’°å†™
*   åº“ä¼¯å†…ç‰¹æ–¯
*   ç§ç±»
*   æ ¼å­å›¾æ¡ˆ
*   è‡ªåŠ¨è­¦æŠ¥ç³»ç»Ÿ

*æ³¨æ„:åœ¨æœ¬ç³»åˆ—ä¸­ï¼Œæˆ‘ä¸æ‰“ç®—æ·±å…¥ç ”ç©¶è¿™äº›å·¥å…·ã€‚æœ¬å†…å®¹å°†å‡è®¾æ‚¨è‡³å°‘å¯¹è¿™äº›å·¥å…·æœ‰åˆæ­¥çš„äº†è§£ï¼å¦‚æœæ²¡æœ‰ï¼Œæˆ‘å°†é“¾æ¥åˆ°ä»–ä»¬çš„æ–‡æ¡£ï¼Œè¿™æ ·æ‚¨å¯ä»¥åœ¨æˆ‘ä»¬å¼€å§‹ä½¿ç”¨å®ƒä»¬ä¹‹å‰è·å¾—ä¸€äº›ä¸Šä¸‹æ–‡ã€‚*

äº‹ä¸å®œè¿Ÿï¼Œè®©æˆ‘ä»¬å¼€å§‹æ„å»ºä»»ä½•ç”Ÿäº§åº”ç”¨ç¨‹åºçš„ç¬¬ä¸€éƒ¨åˆ†:

# ä½“ç³»ç»“æ„

## æ¶æ„è®¾è®¡çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ

è€å®è¯´ï¼Œåœ¨ä¸ªäººé¡¹ç›®ä¸Šï¼Œæˆ‘è·³è¿‡äº†è¿™ä¸ªé˜¶æ®µï¼Œå› ä¸ºæˆ‘åªæƒ³å¼€å§‹å»ºè®¾ã€‚æœ‰æ—¶ä¼šæˆåŠŸï¼Œä½†æœ‰æ—¶ä¼šè®©æˆ‘éš¾å ªã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³èµ°å¾—å¿«ï¼Œè¿˜èƒ½èµ°å¾—è¿œï¼Œä½ éœ€è¦åœ¨è€ƒè™‘è·ç¦»çš„æƒ…å†µä¸‹è¿›è¡Œå»ºè®¾ã€‚

æ¶æ„å¯¹äºåƒè¿™æ ·çš„ç”Ÿäº§çº§åº”ç”¨ç¨‹åºéå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒå°†ä¿æŠ¤æ‚¨åœ¨æµé‡çªç„¶å¢åŠ æ—¶ä¸ä¼šçªç„¶å´©æºƒï¼Œå¹¶å°†ä¿æŒæ‚¨çš„ä½æˆæœ¬ï¼Œå› ä¸ºæ‚¨æ²¡æœ‰æ‚¬ç©ºçš„åŸºç¡€æ¶æ„ï¼Œæ‚¨è¦ä¹ˆåœ¨é™é€Ÿæ—¶å¿˜è®°ï¼Œè¦ä¹ˆè®©æ‚¨å‘æˆ‘ä»¬çš„æ‰˜ç®¡å¹³å°æ‰€æœ‰è€…æ”¯ä»˜é¢å¤–è´¹ç”¨(ä¸å®¢æ°”ï¼ŒJeff)ã€‚

å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬è¿™é‡Œè¦ä½¿ç”¨çš„æ˜¯ Terraformï¼Œè¿™æ˜¯æˆ‘æœ€å–œæ¬¢çš„ï¼Œä¹Ÿæ˜¯æˆ‘è§è¿‡çš„ä½¿ç”¨æœ€å¹¿æ³›çš„åŸºç¡€è®¾æ–½å³ä»£ç æ¡†æ¶ã€‚

æˆ‘ä»¬æ­£åœ¨æ„å»ºçš„éå¸¸ç®€å•ï¼Œä½†è¿™æ˜¯æˆ‘åœ¨å„ç§è§„æ¨¡çš„å…¬å¸ä¸­è§è¿‡çš„å¯æ‰©å±•æ¨¡å¼:åœ¨ä»»ä½•å®¹å™¨ç¼–æ’ç³»ç»Ÿä¸Šçš„å¾®æœåŠ¡ï¼Œä½†åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Docker Compose å’Œ Kubernetesã€‚æˆ‘ä»¬å°†èƒ½å¤Ÿè½»æ¾åœ°åœ¨æœ¬åœ°è¿è¡Œï¼Œå¹¶ç›¸å¯¹æ— é™åœ°æ‰©å¤§è§„æ¨¡ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œåªéœ€å¯¹åŸºç¡€æ¶æ„è¿›è¡Œå¾®å°çš„æ›´æ”¹ã€‚

Vercel æœ¬èº«åœ¨è‡ªåŠ¨ç¼©æ”¾æ–¹é¢åšå¾—éå¸¸å¥½ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³åšæŒä½¿ç”¨æ‰€æœ‰ AWS å¹¶å°† Next.js åº”ç”¨ç¨‹åºæ”¾åœ¨å¦ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¹Ÿä¸ä¼šæœ‰é—®é¢˜ã€‚

## é‚£ä¹ˆï¼Œè¿™ä¸ª app ä¼šæ˜¯ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿ

æ¦‚æ‹¬åœ°è¯´ï¼Œå®ƒå°†å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](img/ead883f162ef630254229b30eca414d7.png)

åº”ç”¨æ¶æ„

æˆ‘ä»¬å°†æœ‰ä¸¤ä¸ª API çº§åˆ«çš„æœåŠ¡:ä¸€ä¸ªæ˜¯ç”¨æˆ·æœåŠ¡(ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œåªæ˜¯ä¸ºäº†ç®€å•èµ·è§ï¼Œå› ä¸ºå®ƒå¯ä»¥åœ¨ä»¥åç›¸å¯¹å®¹æ˜“åœ°åˆ†è§£æˆæœåŠ¡)ï¼Œå¦ä¸€ä¸ªæ˜¯æ•°å­¦æœåŠ¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†éœ€è¦ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹æ¥å¤„ç†æ›´å¤šçš„é˜»å¡åŠŸèƒ½(CPU å¯†é›†å‹ä»»åŠ¡ï¼Œå¦‚è¿è¡Œå¤æ‚çš„è¿è¡Œæ—¶è®¡ç®—æˆ–ä½œä¸š)ï¼Œå› ä¸º[èŠ‚ç‚¹æ˜¯å•çº¿ç¨‹çš„](https://medium.com/swlh/is-node-js-single-threaded-the-architecture-of-node-js-69f8c0d59b00)ã€‚

æˆ‘ä»¬å°†ä½¿ç”¨ PostgreSQL æ•°æ®åº“å’Œä½œä¸º ORM çš„ [Objection.js](https://vincit.github.io/objection.js/) ,å› ä¸º Objection.js åœ¨è¿‡å»å·²ç»è¢«è¯æ˜éå¸¸é€‚åˆä½¿ç”¨ã€‚å¦‚æœæ‚¨éœ€è¦ä¼˜åŒ–æˆ–è€…ä¸èƒ½ä½¿ç”¨ API è¿›è¡ŒæŸ¥è¯¢ï¼Œé‚£ä¹ˆå…è®¸åŸå§‹ SQL å°±è¶³å¤Ÿäº†ï¼Œä½†æ˜¯æˆ‘è¿‡å»ä»æœªä½¿ç”¨è¿‡åŸå§‹ SQLã€‚æˆ‘ä»¬ç®¡ç†å»ºæ¨¡ã€è¿ç§»å’Œ it æ•´ä½“çµæ´»æ€§çš„æ–¹å¼éå¸¸é€‚åˆæˆ‘ä»¬çš„ç”¨ä¾‹ã€‚

å¥½äº†ï¼Œæˆ‘ä»¬å¼€å§‹å§ã€‚

# è„šæ‰‹æ¶

ä¸ºäº†ä¾¿äºç»„ç»‡ï¼Œæˆ‘ä»¬å°†ä»ä¸€å¼€å§‹å°±å¯åŠ¨æ‰€æœ‰ç›®å½•ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªé’ˆå¯¹æ‰€æœ‰ç›®å½•çš„ä»¥ CLI ä¸ºä¸­å¿ƒçš„è¿‡ç¨‹ã€‚

è®©æˆ‘ä»¬ç”¨`create-next-app`å¯åŠ¨æˆ‘ä»¬çš„`app`ï¼Œä¹Ÿå°±æ˜¯ Next.js å‰ç«¯ï¼Œç”¨`yarn init`å¯åŠ¨æˆ‘ä»¬çš„åç«¯æœåŠ¡

```
> yarn create next-app app --ts
> mkdir services && cd services
> mkdir users-service && mkdir math-service
> cd users-service
> yarn init -y
> cd ../math-service
> yarn init -y
```

æ‚¨æœ€ç»ˆåº”è¯¥å¾—åˆ°è¿™æ ·çš„æ–‡ä»¶ç»“æ„:

![](img/240e9785b67a66d673b2e6a43dc6741b.png)

æˆ‘åœ¨ç”¨`[homebrew](https://brew.sh/) library's [tree](https://formulae.brew.sh/formula/tree)`

åœ¨è®¾ç½®åŸºæœ¬ Express æœåŠ¡å™¨æ—¶ï¼Œè®©æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„ä¸¤ä¸ªæœåŠ¡æ‰§è¡Œç›¸åŒçš„è¿‡ç¨‹ã€‚æˆ‘å°†åªè®¨è®ºå…¶ä¸­ä¸€ä¸ª(ç”¨æˆ·æœåŠ¡)ï¼Œä½†æ˜¯ç»§ç»­åœ¨ä¸¤ä¸ªä¸­åˆ›å»ºç›¸åŒçš„ç»“æ„ã€‚

```
yarn add -D typescript ts-node @types/node @types/express nodemon tslint dotenvyarn add expressmkdir srctouch .env .env.sample tslint.json tsconfig.json nodemon.json .gitignore .editorconfig src/server.ts src/index.ts
```

è®©æˆ‘ä»¬æŠŠæ— èŠçš„ä¸œè¥¿æ‹¿å‡ºæ¥:å°±å®é™…é…ç½®è€Œè¨€ï¼Œé…ç½®æ–‡ä»¶ç¡®å®å–å†³äºä¸ªäººåå¥½ã€‚æˆ‘å°†ç”¨ä¸€äº›æˆ‘å–œæ¬¢ä½¿ç”¨çš„å¸¸è§é…ç½®æ¥å¼•å¯¼è¿™äº›ï¼Œä½†ä¸ä¼šæ·±å…¥è®¨è®ºä»»ä½•ç‰¹å®šçš„é…ç½®ã€‚å¦‚æœä½ è§‰å¾—åˆé€‚ï¼Œå¯ä»¥éšæ„è°ƒæ•´ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘æŒ‡çš„æ˜¯`.gitignore`ï¼Œ

```
node_modules/
build/
lib/
docs/.DS_Store
coverage
*.log
.env
```

`tslint.json`ï¼Œ

```
{
 "extends": "tslint:recommended",
 "rules": {
   "max-line-length": {
     "options": [120]
   },
   "new-parens": true,
   "no-arg": true,
   "no-bitwise": true,
   "no-conditional-assignment": true,
   "no-consecutive-blank-lines": false,
   "no-console": {
     "severity": "warning",
     "options": ["debug", "info", "log", "time", "timeEnd", "trace"]
   }
 },
 "jsRules": {
   "max-line-length": {
     "options": [120]
   }
 }
}
```

`.editorconfig`(ç”¨äºæ ‡å‡†åŒ–è‡ªåŠ¨å¥—ç”¨æ ¼å¼ï¼Œå¾ˆåƒ Prettier å’Œ`.prettierrc`ï¼Œä½†æ›´ä¸å¯çŸ¥)

```
root = true[*]
charset = utf-8
end_of_line = lf
indent_size = 2
indent_style = tab
insert_final_newline = true
trim_trailing_whitespace = true[*.md]
max_line_length = 0
trim_trailing_whitespace = true
```

å¹¶ä¸º`tsconfig.json`æ’å…¥ä»¥ä¸‹å†…å®¹ã€‚è¿™å¯èƒ½çœ‹èµ·æ¥æœ‰äº›è¿‡åˆ†ï¼Œä½†æ˜¯è¯·è®°ä½ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œè¦åšçš„æ˜¯ä¸€ä¸ªç”Ÿäº§çº§çš„åº”ç”¨ã€‚ä¸è¦åœ¨å°äº‹ä¸Šåå•¬ã€‚

```
{
  "compilerOptions": {
    "target": "es6",
    "module": "commonjs",
    "moduleResolution": "node",
    "declaration": true,
    "strict": true,
    "noImplicitAny": true /* Raise error on expressions and declarations with an implied 'any' type. */,
    "strictNullChecks": true /* Enable strict null checks. */,
    "strictFunctionTypes": true /* Enable strict checking of function types. */,
    "noUnusedLocals": true /* Report errors on unused locals. */,
    "noUnusedParameters": true /* Report errors on unused parameters. */,
    "noImplicitReturns": true /* Report error when not all code paths in function return a value. */,
    "noFallthroughCasesInSwitch": true /* Report errors for fallthrough cases in switch statement. */,
    "importHelpers": true,
    "skipLibCheck": true,
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "experimentalDecorators": true,
    "sourceMap": true,
    "outDir": "./dist/tsc/",
    "types": [
      "node",
      "jest"
    ],
    "lib": [
      "ES6",
      "DOM"
    ]
  },
  "include": [
    "src/**/*.ts"
  ],
  "exclude": [
    "node_modules",
    "**/*.test.ts"
  ]
}
```

ä»¥åŠä¸€ä¸ª [nodemon](https://nodemon.io/) é…ç½®æ–‡ä»¶`nodemon.json`ã€‚æˆ‘è¿‡å»ä½¿ç”¨è¿‡è¿™ç§é…ç½®ï¼Œå®ƒè¢«è¯æ˜éå¸¸æœ‰ç”¨ã€‚

```
{
  "restartable": "rs",
  "ignore": [".git", "node_modules/", "build/", "coverage/"],
  "watch": ["src/"],
  "execMap": {
    "ts": "node -r ts-node/register"
  },
  "env": {
    "NODE_ENV": "development"
  },
  "ext": "js,json,ts"
}
```

è®©æˆ‘ä»¬ä¹Ÿç»™æˆ‘ä»¬çš„`package.json`æ·»åŠ è„šæœ¬ã€‚åœ¨æ·»åŠ äº†åŸºæœ¬çš„ä¾èµ–é¡¹å’Œè¿™äº›è„šæœ¬ä¹‹åï¼Œæˆ‘ä»¬åº”è¯¥ä¼šçœ‹åˆ°:

```
{
  "name": "users-service",
  "version": "1.0.0",
  "main": "index.ts",
  "repository": "[<https://github.com/ryanoillataguerre/pfapp/tree/master/services/users-service>](https://github.com/ryanoillataguerre/pfapp/tree/master/services/users-service)",
  "author": "Ryan Oillataguerre",
  "license": "MIT",
  "scripts": {
    "start": "node build/src/index.ts",
    "build": "tsc",
    "dev": "nodemon --config nodemon.json src/index.ts"
  },
  "devDependencies": {
    "@types/express": "^4.17.13",
    "@types/node": "^16.0.0",
    "dotenv": "^10.0.0",
    "nodemon": "^2.0.7",
    "ts-node": "^10.0.0",
    "typescript": "^4.3.5",
    "tslint": "^6.1.3"
  },
  "dependencies": {
    "express": "^4.17.1"
  }
}
```

ä¸€æ—¦æˆ‘ä»¬æƒ³æŠŠæˆ‘ä»¬çš„åº”ç”¨åˆ†å‘ç»™äº‘æä¾›å•†ï¼Œ`build`å’Œ`start`å°†ä¼šå¾ˆæœ‰å¸®åŠ©ï¼Œè€Œ`dev`å°†å…è®¸æˆ‘ä»¬æœ‰æ•ˆåœ°ä½¿ç”¨`nodemon`å¹¶åœ¨å¼€å‘ä¸­ä¿æŒæˆ‘ä»¬çš„åº”ç”¨çƒ­é‡è£…ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¿›å…¥å®é™…çš„ä»£ç ã€‚åœ¨`src/server.ts`å’Œ`src/index.ts`åˆ›å»ºæˆ‘ä»¬çš„æœåŠ¡å™¨

`index.ts`

```
import dotenv from 'dotenv';
import server from './server';dotenv.config();
const port = process.env.PORT || 8080;
server().listen(port);
```

æˆ‘å–œæ¬¢è¿™ç§æ¨¡å¼ï¼Œå› ä¸ºå®ƒä¸ºé˜…è¯»ä»£ç çš„äººæ ‡è®°äº†ä¸€ä¸ªæ¸…æ™°çš„å…¥å£ç‚¹ï¼Œå¹¶ä¸”ä¸ä¼šç«‹å³ç”¨æœ€ç»ˆå°†è¿›å…¥è¿™ä¸ª`server.ts`çš„æ‰€æœ‰ä¸­é—´ä»¶å’Œé…ç½®æ·¹æ²¡ä»–ä»¬ã€‚

`server.ts`

```
import express, { Request, Response } from 'express';
import http from 'http';const app = () => {
  const app = express(); app.use((_: Request, res: Response, next) => {
    res.header(
      'Access-Control-Allow-Headers',
      'Origin, X-Requested-With, Content-Type, Accept, Credentials, Set-Cookie',
    );
    res.header('Access-Control-Allow-Credentials', 'true');
    res.header(
      'Access-Control-Allow-Headers',
      'Content-Type, Accept, Access-Control-Allow-Credentials, Cross-Origin',
    );
    res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE');
    next();
  }); app.use(express.json()); // Routes
  app.get('/health', (_, res) => res.status(200).send({ success: true }));
  // All non-specified routes return 404
  app.get('*', (_, res) => res.status(404).send('Not Found')); const server = http.createServer(app); server.on('listening', () => {
    console.info(`Users service listening on port ${process.env.PORT}...`);
  }); return server;
};export default app;
```

å¥½äº†ï¼Œåœ¨è¿™é‡Œæ‰“å¼€åŒ…è£…è¿˜çœŸä¸å®¹æ˜“ã€‚

ä¸Šé¢çš„ headers éƒ¨åˆ†æ˜¯æˆ‘ä»¬åœ¨å“åº”ä¸­è®¾ç½®å®ƒä»¬çš„åœ°æ–¹ï¼Œå®ƒå°†å¸®åŠ©æˆ‘ä»¬ä»¥ååœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´æ¥å›å‘é€ä¼šè¯ cookies æ—¶ä¸å¿…å¤„ç†è¿™ä¹ˆå¤šé—®é¢˜ã€‚

æˆ‘ä»¬ä½¿ç”¨`express.json()` API æ¥ä»£æ›¿ä»¥å‰ç”¨äºè§£æ JSON POST è¯·æ±‚çš„`bodyParser()`ã€‚ç„¶åï¼Œæˆ‘ä»¬å£°æ˜æˆ‘ä»¬å¸Œæœ› Express åº”ç”¨ç¨‹åºä½¿ç”¨çš„è·¯çº¿ã€‚è¿™å°†å¾ˆå¿«åŒ…æ‹¬æˆ‘ä»¬å®šåˆ¶çš„åŸºäºæ¨¡å—çš„è·¯ç”±ï¼Œæˆ‘ä»¬å°†åœ¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­çœ‹åˆ°å¦‚ä½•æ„å»ºè¿™äº›è·¯ç”±ã€‚

ç„¶åæˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„`http`æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨å¹¶è¿”å›å®ƒï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨`index.js`ä¸­`listen`å®ƒã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª`.env`æ–‡ä»¶ï¼Œç”±ä¸Šé¢çš„`dotenv.config()`å‘½ä»¤è¯»å–ã€‚è¿™å°†å…·ä½“åœ°åé¦ˆåˆ°æˆ‘ä»¬çš„æœåŠ¡ç¯å¢ƒä¸­ã€‚

```
PORT=8080
```

æœ€åï¼Œè®©æˆ‘ä»¬å¯åŠ¨æœåŠ¡å™¨:

![](img/9b8373a335e4b2c93b6f7b379d010c21.png)

å¯åŠ¨å¹¶è¿è¡Œï¼ğŸ‰ğŸ‰ğŸ‰

å¦‚æœæœ‰äº›ä¸œè¥¿ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œå®ƒå¯èƒ½æ˜¯ä¸€ä¸ªä¸¢å¤±çš„æ–‡ä»¶æˆ–ä¸€äº›ä¸åŒ¹é…çš„å¤åˆ¶ç²˜è´´ã€‚å‰å¾€æœ¬ç« åˆ†æ”¯çš„ [Github repo æŸ¥çœ‹æºä»£ç ï¼](https://github.com/ryanoillataguerre/pfapp/tree/Chapter_1-Scaffolding)

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬åˆšåˆšå°†ä¸€ä¸ªåº”ç”¨ä»é›¶ä»£ç å‡çº§åˆ°ä¸€ä¸ªæ­£å¸¸å·¥ä½œçš„èŠ‚ç‚¹æœåŠ¡ï¼Œè¿™å°†åœ¨æœ¬ç³»åˆ—æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­æ„å»ºã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­æ·»åŠ è·¯ç”±ã€æœåŠ¡ã€ä¸€äº›å®ç”¨ç¨‹åºç­‰ç­‰ã€‚

***å°†æ‰€æœ‰ä»£ç ä¿®æ”¹æ‰“åŒ…æˆä¸€ç« åï¼Œæˆ‘éœ€è¦ä¸€äº›æ—¶é—´æ¥å†™ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³åœ¨æˆ‘å‘å¸ƒå®ƒæ—¶ä¿æŒæ›´æ–°ï¼Œè¯·åœ¨åª’ä½“ä¸Šå…³æ³¨æˆ‘*** [***è¿™é‡Œ***](https://medium.com/@ryanoillataguerre) ï¼Œ ***æˆ–è€…åœ¨ Twitter ä¸Š*** [***è¿™é‡Œ***](https://twitter.com/roillataguerre) ***ï¼***

è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œæ‰€ä»¥å¦‚æœä½ å–œæ¬¢å®ƒï¼Œæˆ‘çœŸçš„å¾ˆæ„Ÿè°¢é¼“æŒï¼Œå¦‚æœä½ æœ‰è¿™é‡Œæåˆ°çš„ä»»ä½•å–œæ¬¢çš„å·¥å…·ï¼Œä¸€èˆ¬è¯„è®ºï¼Œçƒ˜çƒ¤ï¼Œæˆ–å»ºè®®ï¼Œè¯·åœ¨ä¸‹é¢è¯„è®ºï¼