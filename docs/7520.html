<html>
<head>
<title>Few things to know before launching a SvelteKit app in prod</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">åœ¨prodä¸­å¯åŠ¨SvelteKitåº”ç”¨ç¨‹åºä¹‹å‰éœ€è¦çŸ¥é“çš„å‡ ä»¶äº‹</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/few-things-to-know-before-launching-a-sveltekit-app-in-prod-754c5f84ac61?source=collection_archive---------3-----------------------#2022-10-19">https://itnext.io/few-things-to-know-before-launching-a-sveltekit-app-in-prod-754c5f84ac61?source=collection_archive---------3-----------------------#2022-10-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/81b153810f1076f8b5eae9433fa3f75b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_95nJBkOTJfNugcX"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">ç…§ç‰‡ç”±<a class="ae kf" href="https://unsplash.com/@kolamdigital?utm_source=Papyrs&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">å®‰è¿ªÂ·èµ«å°”æ›¼ä¸‡</a>åœ¨<a class="ae kf" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šæ‹æ‘„</figcaption></figure></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><p id="7bb5" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">ä¸Šå‘¨ï¼Œæ–°ç‰ˆæœ¬çš„<a class="ae kf" href="https://internetcomputer.org/nns" rel="noopener ugc nofollow" target="_blank">NNS-dapp</a>(NNSçš„dappï¼Œä¸–ç•Œä¸Šæœ€å¤§çš„daopä¹‹ä¸€ï¼Œç®¡ç†ç€<a class="ae kf" href="https://internetcomputer.org/" rel="noopener ugc nofollow" target="_blank">äº’è”ç½‘è®¡ç®—æœº</a>)å¼•å…¥äº†ä¸€ä¸ªåä¸ºâ€œStake Maturityâ€çš„æ–°ç‰¹æ€§ï¼Œå¯¹å…¶æ¨¡å‹è¿›è¡Œäº†è½»å¾®çš„è®¾è®¡æ›´æ–°ï¼Œå¹¶æ”¹å˜äº†å…¶æ„å»ºç³»ç»Ÿã€‚</p><p id="3bf0" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">äº‹å®ä¸Šï¼Œè™½ç„¶å‰ç«¯åº”ç”¨ç¨‹åºæ›¾ç»åœ¨å”¯ä¸€çš„<a class="ae kf" href="https://rollupjs.org/" rel="noopener ugc nofollow" target="_blank"> Rollup </a> bundlerçš„å¸®åŠ©ä¸‹æ‰“åŒ…ï¼Œä½†å®ƒè¢«è¿ç§»åˆ°äº†åŒæ—¶ä½¿ç”¨<a class="ae kf" href="https://vitejs.dev/" rel="noopener ugc nofollow" target="_blank"> Vite </a>ã€<a class="ae kf" href="https://esbuild.github.io/" rel="noopener ugc nofollow" target="_blank"> esbuild </a>å’ŒRollupçš„<a class="ae kf" href="https://kit.svelte.dev/" rel="noopener ugc nofollow" target="_blank"> SvelteKit </a> *ä¸Šã€‚<em class="ll"> </em></p><p id="8a70" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">ä»¥ä¸‹æ˜¯æˆ‘ä¸€è·¯èµ°æ¥å­¦åˆ°çš„ä¸‰ä»¶äº‹ã€‚æˆ‘å¸Œæœ›å®ƒä»¬å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œè¿™æ ·æ‚¨ä¹Ÿå¯ä»¥åœ¨ç”Ÿäº§ä¸­å®‰å…¨åœ°éƒ¨ç½²æ‚¨çš„åº”ç”¨ç¨‹åºã€‚</p><p id="5ac4" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated"><em class="ll"> *è·¯ç”±æ–¹é¢æ²¡æœ‰ä»»ä½•å˜åŒ–ï¼Œä½†</em></p></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><h1 id="effa" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">â€‹1.CSPç ´è§£Firefoxä¸­çš„åº”ç”¨</h1><p id="b998" class="pw-post-body-paragraph kn ko it kp b kq mk ks kt ku ml kw kx ky mm la lb lc mn le lf lg mo li lj lk im bi translated">å†…å®¹å®‰å…¨ç­–ç•¥(CSP)æ˜¯ä¸€ä¸ªé™„åŠ çš„å®‰å…¨å±‚ï¼Œæœ‰åŠ©äºæ£€æµ‹å’Œç¼“è§£æŸäº›ç±»å‹çš„æ”»å‡»ï¼ŒåŒ…æ‹¬è·¨ç«™ç‚¹è„šæœ¬(XSS)å’Œæ•°æ®æ³¨å…¥æ”»å‡»(æ¥æº<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP" rel="noopener ugc nofollow" target="_blank"> MDN </a>)ã€‚</p><p id="eec9" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">å› ä¸ºæˆ‘ä»¬å…³å¿ƒå®‰å…¨æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å½“ç„¶å®æ–½äº†è¿™ç±»è§„åˆ™ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ç­–ç•¥<code class="fe mp mq mr ms b">script-src</code>å°†<code class="fe mp mq mr ms b">index.html</code>é¡µé¢çš„è„šæœ¬æ ‡ç­¾åˆ—å…¥ç™½åå•â€”â€”ä½¿ç”¨å®ƒä»¬çš„<code class="fe mp mq mr ms b">sha256</code>è„šæœ¬æ•£åˆ—â€”â€”è€Œ<code class="fe mp mq mr ms b">'script-dynamic'</code>ç”¨äºåŠ è½½åœ¨æµè§ˆå™¨ä¸­è¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰ä»£ç å—ã€‚</p><p id="cb19" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">è™½ç„¶è¿™åœ¨ä»¥å‰çš„bundlerä¸­è¡Œå¾—é€šï¼Œä½†æˆ‘ä»¬å®é™…ä¸ŠæƒŠè®¶åœ°å‘ç°ï¼ŒSvelteKit(2022å¹´10æœˆ)å¹¶ä¸çœŸæ­£æ”¯æŒè¿™ç§æ”¿ç­–ç»„åˆ(è§ç¬¬<a class="ae kf" href="https://github.com/sveltejs/kit/issues/3558" rel="noopener ugc nofollow" target="_blank"> #3558 </a>æœŸ)ã€‚å®ƒå¯ä»¥åœ¨Chromeå’ŒSafariä¸­è¿è¡Œï¼Œä½†æ˜¯åœ¨Firefoxä¸­ä¼šä¸­æ–­ï¼Œæˆ‘è¯´çš„â€œä¸­æ–­â€æ˜¯æŒ‡allåº”ç”¨ç¨‹åºæ ¹æœ¬ä¸ä¼šè¢«æ¸²æŸ“ã€‚</p><p id="1455" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†ä»¥ä¸‹è§£å†³æ–¹æ³•:æ·»åŠ ä¸€ä¸ªæ„å»ºåè„šæœ¬ï¼Œå°†SvelteKitæ³¨å…¥HTMLé¡µé¢çš„ä»£ç æå–åˆ°ä¸€ä¸ªå•ç‹¬çš„JSæ–‡ä»¶ä¸­ï¼Œç„¶åæ³¨å…¥æˆ‘ä»¬è‡ªå·±çš„è„šæœ¬åŠ è½½å™¨ğŸ¤ªã€‚</p><p id="094d" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">è¿™å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°:</p><p id="30bf" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">â€‹1.å°†ä¸€ä¸ªç©ºçš„<code class="fe mp mq mr ms b">main.js</code>æ·»åŠ åˆ°<code class="fe mp mq mr ms b">static</code>æ–‡ä»¶å¤¹ä¸­(è¿™æœ‰åŠ©äºé¿å…åœ¨æœ¬åœ°å¼€å‘æ—¶å‡ºç°é—®é¢˜)ã€‚</p><p id="82c1" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">â€‹2.åœ¨htmlæ ¹é¡µé¢çš„<code class="fe mp mq mr ms b">&lt;head /&gt;</code>ä¸­æ·»åŠ ä¸€ä¸ªè„šæœ¬åŠ è½½å™¨ï¼Œå³åœ¨<code class="fe mp mq mr ms b">src/app.html</code>é¡µé¢ä¸­ã€‚</p><pre class="mt mu mv mw gt mx ms my mz aw na bi"><span id="98ec" class="nb ln it ms b gy nc nd l ne nf">&lt;script&gt;<br/>    const loader = document.createElement("script");<br/>    loader.type = "module";<br/>    loader.src = "./main.js";<br/>    document.head.appendChild(loader);<br/>&lt;/script&gt;</span></pre><p id="3d4b" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">â€‹3.åˆ›å»ºä¸€ä¸ªåæœŸæ„å»ºè„šæœ¬â€”ä¾‹å¦‚<code class="fe mp mq mr ms b">./scripts/build.csp.mjs</code>ã€‚</p><pre class="mt mu mv mw gt mx ms my mz aw na bi"><span id="2bbb" class="nb ln it ms b gy nc nd l ne nf">#!/usr/bin/env node<br/><br/>import { readFileSync, writeFileSync } from "fs";<br/>import { join } from "path";<br/><br/>const publicIndexHTML = join(process.cwd(), "public", "index.html");<br/><br/>const buildCsp = () =&gt; {<br/>  const indexHTMLWithoutStartScript = extractStartScript();<br/>  writeFileSync(publicIndexHTML, indexHTMLWithoutStartScript);<br/>};<br/><br/>/**<br/> * Using a CSP with 'strict-dynamic' with SvelteKit breaks in Firefox.<br/> * Issue: https://github.com/sveltejs/kit/issues/3558<br/> *<br/> * As workaround:<br/> * 1. we extract the start script that is injected by SvelteKit in index.html into a separate main.js<br/> * 2. we remove the script content from index.html but, let the script tag as anchor<br/> * 3. we use our custom script loader to load the main.js script<br/> */<br/>const extractStartScript = () =&gt; {<br/>  const indexHtml = readFileSync(publicIndexHTML, "utf-8");<br/><br/>  const svelteKitStartScript =<br/>    /(&lt;script type=\"module\" data-sveltekit-hydrate[\s\S]*?&gt;)([\s\S]*?)(&lt;\/script&gt;)/gm;<br/><br/>  // 1. extract SvelteKit start script to a separate main.js file<br/>  const [_script, _scriptStartTag, content, _scriptEndTag] =<br/>    svelteKitStartScript.exec(indexHtml);<br/>  const inlineScript = content.replace(/^\s*/gm, "");<br/><br/>  writeFileSync(<br/>    join(process.cwd(), "public", "main.js"),<br/>    inlineScript,<br/>    "utf-8"<br/>  );<br/><br/>  // 2. replace SvelteKit script tag content with empty<br/>  return indexHtml.replace(svelteKitStartScript, "$1$3");<br/>};<br/><br/>buildCsp();</span></pre><p id="104c" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">â€‹4.åœ¨<code class="fe mp mq mr ms b">package.json</code>è¿é”å‰§æœ¬ã€‚</p><pre class="mt mu mv mw gt mx ms my mz aw na bi"><span id="21ab" class="nb ln it ms b gy nc nd l ne nf">{<br/>    "scripts": {<br/>        "build:csp": "node scripts/build.csp.mjs",<br/>        "build": "vite build &amp;&amp; npm run build:csp"<br/>    }<br/>}</span></pre></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><h1 id="b550" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">â€‹2.æ„å»ºå†ç°æ€§</h1><p id="8cf4" class="pw-post-body-paragraph kn ko it kp b kq mk ks kt ku ml kw kx ky mm la lb lc mn le lf lg mo li lj lk im bi translated">å¯å¤åˆ¶æ„å»ºæ˜¯ä¸€ä¸ªç¼–è¯‘è½¯ä»¶çš„è¿‡ç¨‹ï¼Œå®ƒç¡®ä¿ç”Ÿæˆçš„äºŒè¿›åˆ¶ä»£ç å¯ä»¥è¢«å¤åˆ¶(æ¥æº<a class="ae kf" href="https://en.wikipedia.org/wiki/Reproducible_builds" rel="noopener ugc nofollow" target="_blank">ç»´åŸºç™¾ç§‘</a>)ã€‚æˆ‘ä»¬å…³å¿ƒç¡®å®šæ€§ç¼–è¯‘ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›å…è®¸éªŒè¯åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­æ²¡æœ‰å¼•å…¥æ¼æ´æˆ–åé—¨ã€‚</p><p id="db50" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">è¿™ä¸€ç›´éƒ½å¾ˆç®¡ç”¨ã€‚ç„¶è€Œï¼Œåœ¨è¿ç§»ä¹‹åï¼Œæˆ‘ä»¬æ— æ³•å†åœ¨å¤šå°è®¡ç®—æœºä¸Šä¸ºæ†ç»‘çš„wasmè®¡ç®—ç›¸åŒçš„shaã€‚</p><p id="f9ab" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">ç»è¿‡ä¸€äº›è°ƒè¯•ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†é—®é¢˜çš„ä¸¤ä¸ªæ ¹æœ¬åŸå› ã€‚</p><p id="a1bb" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">â€‹1.å¦‚æœæ²¡æœ‰ç‰¹å®šçš„<a class="ae kf" href="https://kit.svelte.dev/docs/configuration#version" rel="noopener ugc nofollow" target="_blank">ç‰ˆæœ¬</a>æä¾›ç»™SvelteKitï¼Œå®ƒå°†ç”Ÿæˆä¸€ä¸ªæ—¶é—´æˆ³æ¥æ ‡è¯†å½“å‰çš„åº”ç”¨ç¨‹åºç‰ˆæœ¬â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ²¡æœ‰æä¾›ç‰ˆæœ¬ï¼ŒSvelteKitä¼šåœ¨ç»‘å®šçš„JSä»£ç ä¸­æ³¨å…¥ä¸€ä¸ªæ—¶é—´æˆ³ã€‚æ¯æ¬¡æ„å»ºï¼Œæ¯æ¬¡éƒ½æœ‰ä¸€ä¸ªæ–°çš„æ—¶é—´æˆ³ã€‚</p><p id="73b4" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åœ¨<code class="fe mp mq mr ms b">package.json</code>ä¸­è¯»å–ç‰ˆæœ¬å·ï¼Œå¹¶åœ¨<code class="fe mp mq mr ms b">svelte.config.js</code>ä¸­å°†å…¶æä¾›ç»™å¥—ä»¶ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œåªè¦æˆ‘ä»¬ä¸æ”¹å˜è¯­ä¹‰æ•°å­—ï¼Œæ¯ä¸ªæ„å»ºç‰ˆæœ¬éƒ½æ˜¯é™æ€çš„ã€‚</p><pre class="mt mu mv mw gt mx ms my mz aw na bi"><span id="3c17" class="nb ln it ms b gy nc nd l ne nf">import adapter from "@sveltejs/adapter-static";<br/>import autoprefixer from "autoprefixer";<br/>import { readFileSync } from "fs";<br/>import preprocess from "svelte-preprocess";<br/>import { fileURLToPath } from "url";<br/><br/>const file = fileURLToPath(new URL("package.json", import.meta.url));<br/>const json = readFileSync(file, "utf8");<br/>const { version } = JSON.parse(json);<br/><br/>const config = {<br/>  preprocess: preprocess({<br/>    postcss: {<br/>      plugins: [autoprefixer],<br/>    },<br/>  }),<br/><br/>  kit: {<br/>    adapter: adapter({<br/>      pages: "public",<br/>      assets: "public",<br/>      fallback: "index.html",<br/>      precompress: false,<br/>    }),<br/>    serviceWorker: {<br/>      register: false,<br/>    },<br/>    version: {<br/>      name: version, // &lt;---- here provide version<br/>    },<br/>    trailingSlash: "always",<br/>  },<br/>};<br/><br/>export default config;</span></pre><p id="2b7c" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">â€‹2.SvelteKitâ€”â€”æˆ–Viteâ€”â€”æ·»åŠ ä¸€ä¸ª<code class="fe mp mq mr ms b">public/vite-manifest.json</code>æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«åº”ç”¨ç¨‹åºæ‰€æœ‰ç”Ÿæˆçš„ä¸å¯å˜èµ„äº§çš„åˆ—è¡¨ã€‚å¾ˆé—æ†¾ï¼Œæ­¤æ–‡ä»¶å½“å‰æœªè¢«æ’åºã€‚å› æ­¤ï¼Œä½œä¸ºä¸€ä¸ªå¿«é€Ÿè§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªbashè„šæœ¬æ¥å®Œæˆè¿™é¡¹å·¥ä½œã€‚</p><pre class="mt mu mv mw gt mx ms my mz aw na bi"><span id="545d" class="nb ln it ms b gy nc nd l ne nf">#!/usr/bin/env bash<br/>set -euxo pipefail<br/>cd "$(dirname "$(realpath "$0")")/.."<br/># shellcheck disable=SC2094 # This reads the entire file into memory and then writes it out, so is correct.<br/>cat &lt;&lt;&lt;"$(jq --sort-keys . public/vite-manifest.json)" &gt;public/vite-manifest.json</span></pre><p id="d6dc" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">æˆ‘ä»¬åœ¨<code class="fe mp mq mr ms b">package.json</code>ä¸­ä¹Ÿé“¾æ¥äº†Bashè„šæœ¬ã€‚</p><pre class="mt mu mv mw gt mx ms my mz aw na bi"><span id="5d56" class="nb ln it ms b gy nc nd l ne nf">{<br/>    "scripts": {<br/>        "build:csp": "node scripts/build.csp.mjs",<br/>        "build": "vite build &amp;&amp; npm run build:csp &amp;&amp; ./scripts/make-reproducible"<br/>    }<br/>}</span></pre></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><h1 id="5fc7" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">3.å¤šå¡«å……ç¼“å†²å‰‚</h1><p id="82f5" class="pw-post-body-paragraph kn ko it kp b kq mk ks kt ku ml kw kx ky mm la lb lc mn le lf lg mo li lj lk im bi translated">æˆ‘ä¸€ç›´ä½¿ç”¨Chovyçš„<a class="ae kf" href="https://stackoverflow.com/a/72220289/5404186" rel="noopener ugc nofollow" target="_blank"> SOè§£å†³æ–¹æ¡ˆ</a>ä¸ºICä¸Šçš„å‰ç«¯dappså¡«å……ç¼“å†²APIï¼Œä½†å®ƒä¸å†å®Œå…¨æœ‰æ•ˆã€‚è™½ç„¶åœ¨<code class="fe mp mq mr ms b">vite.config.js</code>ä¸­å°†<code class="fe mp mq mr ms b">global</code>é‡æ–°å®šä¹‰ä¸º<code class="fe mp mq mr ms b">globalThis</code>ä»ç„¶æœ‰æ•ˆï¼Œä½†æ˜¯æ²¡æœ‰ä¸ºâ€œç¼“å†²åŒºâ€åº”ç”¨èšåˆå¡«å……ã€‚</p><p id="20fb" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨å®‰è£…äº†(<code class="fe mp mq mr ms b">npm i buffer</code>)æµè§ˆå™¨çš„<a class="ae kf" href="https://www.npmjs.com/package/buffer" rel="noopener ugc nofollow" target="_blank">ç¼“å†²åŒº</a>æ¨¡å—ä¾èµ–ä¹‹åï¼Œåœ¨æ ¹<code class="fe mp mq mr ms b">+layout.ts</code>ä¸­æ·»åŠ äº†ä¸€ä¸ªâ€œæ‰‹åŠ¨â€polyfillã€‚</p><pre class="mt mu mv mw gt mx ms my mz aw na bi"><span id="7250" class="nb ln it ms b gy nc nd l ne nf">import { Buffer } from "buffer";<br/>globalThis.Buffer = Buffer;</span></pre><p id="add7" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">ç„¶è€Œï¼Œæˆ‘ä»¬å‘ç°è¿™åœ¨å¼€å‘æˆ–ç”Ÿäº§ç‰ˆæœ¬ä¸­å¯ä»¥åœ¨æœ¬åœ°æ­£å¸¸å·¥ä½œï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ä¸­å¯èƒ½ä¼šæˆä¸ºä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºä¸èƒ½ä¿è¯è·å–<code class="fe mp mq mr ms b">+layout.js</code>æ–‡ä»¶çš„é€Ÿåº¦ä¼šæ¯”ä½¿ç”¨å®ƒçš„é¡µé¢æ›´å¿«ã€‚</p><p id="8794" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">è¿™å°±æ˜¯ä¸ºä»€ä¹ˆé™¤äº†ä¸Šé¢çš„é™„åŠ ç»„ä»¶ä¹‹å¤–ï¼Œåœ¨æ†ç»‘çš„ç”Ÿäº§JSä»£ç ä¸­æ³¨å…¥polyfiedç¼“å†²åŒºæ˜¯å€¼å¾—çš„ã€‚è¿™å¯ä»¥åœ¨ä¸€ä¸ªæ±‡æ€»æ’ä»¶(<code class="fe mp mq mr ms b">npm i @rollup/plugin-inject -D</code>)çš„å¸®åŠ©ä¸‹å®Œæˆã€‚</p><pre class="mt mu mv mw gt mx ms my mz aw na bi"><span id="4c3b" class="nb ln it ms b gy nc nd l ne nf">import inject from "@rollup/plugin-inject";<br/>import { sveltekit } from "@sveltejs/kit/vite";<br/>import type { UserConfig } from "vite";<br/><br/>const config: UserConfig = {<br/>  plugins: [sveltekit()],<br/>  build: {<br/>    target: "es2020",<br/>    rollupOptions: {<br/>      // Polyfill Buffer for production build. <br/>      // The hardware wallet needs Buffer.<br/>      plugins: [<br/>        inject({<br/>          include: ["node_modules/@ledgerhq/**"],<br/>          modules: { Buffer: ["buffer", "Buffer"] },<br/>        }),<br/>      ],<br/>    },<br/>  },<br/>  optimizeDeps: {<br/>    esbuildOptions: {<br/>      // Node.js global to browser globalThis<br/>      define: {<br/>        global: "globalThis",<br/>      },<br/>    },<br/>  },<br/>};<br/><br/>export default config;</span></pre><p id="035c" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">æ³¨æ„äº‹é¡¹:</p><ul class=""><li id="1b18" class="ng nh it kp b kq kr ku kv ky ni lc nj lg nk lk nl nm nn no bi translated">æˆ‘ä»¬éœ€è¦ä¸Šè¿°ç¡¬ä»¶é’±åŒ…ç›¸å…³åŠŸèƒ½çš„polyfillã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå½“æˆ‘ä»¬ä½¿ç”¨Rollupæ’ä»¶æ—¶ï¼Œæˆ‘ä»¬å°†å®ƒçš„èŒƒå›´æ‰©å¤§åˆ°<code class="fe mp mq mr ms b">ledgerhq</code>åº“ã€‚</li><li id="333a" class="ng nh it kp b kq np ku nq ky nr lc ns lg nt lk nl nm nn no bi translated">è¿™ä¸ªè§£å†³æ–¹æ¡ˆè¿˜ä¸æ˜¯æœ€ä½³çš„ï¼Œå› ä¸ºæˆ‘ä»¬åº”ç”¨äº†ä¸¤æ¬¡polyfillä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å®é™…ä¸Šåœ¨äº§å“æ„å»ºä¸­åŠ è½½äº†å¤ªå¤šçš„JavaScriptä»£ç ã€‚æˆ‘ä¸å¤ªç¡®å®šæˆ‘æ˜¯å¦åŒæ„ï¼Œä½†è¿™ä»ç„¶å¯ä»¥æ”¹è¿›ã€‚</li><li id="a580" class="ng nh it kp b kq np ku nq ky nr lc ns lg nt lk nl nm nn no bi translated">web workerä»£ç æ— æ³•ä½¿ç”¨ä¸Šè¿°è§£å†³æ–¹æ¡ˆè¿›è¡Œèšåˆã€‚å¦‚æœä½ éœ€è¦è¿™æ ·åšï¼Œä½ å¯èƒ½éœ€è¦è¿›ä¸€æ­¥è°ƒæŸ¥ã€‚</li></ul></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><h1 id="62dd" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">ç»“è®º</h1><p id="9425" class="pw-post-body-paragraph kn ko it kp b kq mk ks kt ku ml kw kx ky mm la lb lc mn le lf lg mo li lj lk im bi translated">è¿™æ˜¯æ‰€æœ‰çš„ä¹è¶£å’Œæ¸¸æˆï¼Œç›´åˆ°ä½ å‘ç°çš„é—®é¢˜å¹¶ä¸å­˜åœ¨ï¼Œå½“ä½ åœ¨å½“åœ°å‘å±•ğŸ˜ã€‚æˆ‘å¾ˆé«˜å…´æˆ‘ä»¬è§£å†³äº†æ‰€æœ‰è¿™äº›é—®é¢˜ï¼Œå¹¶èƒ½å¤Ÿè¿ç§»ã€‚ä½¿ç”¨ViteJSç®€åŒ–å¼€å‘äººå‘˜çš„ä½“éªŒï¼Œå¹¶å°†dappç§»æ¤åˆ°SvelteKitæ‰“å¼€äº†æ–°çš„å¯èƒ½æ€§ï¼Œç‰¹åˆ«æ˜¯æˆ‘ä»¬å…³äºè·¯ç”±çš„ä¸€äº›æƒ³æ³•ï¼Œä½†æ˜¯ï¼Œæˆ‘å¯èƒ½ä¼šåœ¨å¦ä¸€ç¯‡åšå®¢æ–‡ç« ä¸­è®²è¿°æ›´å¤šğŸ˜‰ã€‚</p><p id="8456" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">åˆ°æ— é™è¿œå¤„<br/>å¤§å«</p></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><p id="f949" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">æ›´å¤šå†’é™©ï¼Œè¯·åœ¨ğŸ––æ¨ç‰¹ä¸Šå…³æ³¨æˆ‘</p></div></div>    
</body>
</html>