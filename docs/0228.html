<html>
<head>
<title>Downloading files from Ajax POST Requests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä»Ajax POSTè¯·æ±‚ä¸‹è½½æ–‡ä»¶</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/downloading-files-from-ajax-post-requests-26babc7661d4?source=collection_archive---------1-----------------------#2018-01-13">https://itnext.io/downloading-files-from-ajax-post-requests-26babc7661d4?source=collection_archive---------1-----------------------#2018-01-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a8adb7ceebe0e7292b1d38e2ab03727f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rb7-YTwRtKnIH29UHCT9vg.png"/></div></div></figure><p id="5cb5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¶å°”ï¼Œæˆ‘å¶ç„¶å‘ç°éœ€è¦ä»POSTè¯·æ±‚ä¸­ä¸‹è½½æ–‡ä»¶ã€‚ä¸€ä¸ªä¾‹å­æ˜¯ç”ŸæˆPDFæ–‡ä»¶ï¼Œå…¶ä¸­PDFå†…å®¹ä¾èµ–äºè¯·æ±‚ã€‚æœ‰è¶£çš„æ˜¯ï¼Œè¿™å¹¶ä¸åƒä½ æƒ³è±¡çš„é‚£ä¹ˆç®€å•ï¼Œä½†ä¹Ÿå¹¶ä¸éš¾ã€‚</p><h1 id="ad8c" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">ç®€å•çš„æœåŠ¡å™¨</h1><p id="b22d" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">æˆ‘ä»¬å°†å®ç°ä¸€ä¸ª<em class="lz">éå¸¸ç®€å•çš„</em>æœåŠ¡å™¨ï¼Œå®ƒä»POSTè¯·æ±‚ç”Ÿæˆpdf:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="e233" class="mj kx iq mf b gy mk ml l mm mn">require_once 'vendor/autoload.php';</span><span id="a3a7" class="mj kx iq mf b gy mo ml l mm mn">if($_SERVER['REQUEST_METHOD'] === 'POST') {<br/>    header('Content-type: application/pdf');<br/>    http_response_code(200);</span><span id="1ccf" class="mj kx iq mf b gy mo ml l mm mn">// Contents<br/>    $pdfContent = !empty($_POST['content']) ? $_POST['content'] : 'no content specified';<br/>    <br/>    // Generate the PDOF<br/>    $pdf = new FPDF();<br/>    $pdf-&gt;AddPage();<br/>    $pdf-&gt;SetFont('Arial','B',16);<br/>    $pdf-&gt;Cell(40,10, $pdfContent);<br/>    <br/>    return $pdf-&gt;Output(null, 'foobar-' . time() . '.pdf');<br/>}</span><span id="1a2d" class="mj kx iq mf b gy mo ml l mm mn">// Bad method<br/>http_response_code(405);<br/>exit();</span></pre><p id="65ed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="lz">æ³¨æ„</em>:è¿™æ®µä»£ç ä½¿ç”¨<a class="ae mp" href="https://github.com/Setasign/FPDF" rel="noopener ugc nofollow" target="_blank"> FPDF </a>åº“æ¥ç”ŸæˆPDFæ–‡ä»¶ã€‚å‡ºäºæ¼”ç¤ºç›®çš„ï¼Œpdfä¸­å¡«å……äº†æ¥è‡ª<code class="fe mq mr ms mf b">$_POST['content']</code>çš„å†…å®¹ã€‚</p><p id="1af4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">FPDFè‡ªåŠ¨è´Ÿè´£å°†<a class="ae mp" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition" rel="noopener ugc nofollow" target="_blank">å†…å®¹å¤„ç†</a>è®¾ç½®ä¸º<code class="fe mq mr ms mf b">attachment</code>ã€‚å¦‚æœæ‚¨ä¸ä½¿ç”¨FPDFï¼Œéœ€è¦æ‰‹åŠ¨è®¾ç½®ï¼Œåªéœ€åœ¨è¾“å‡ºå‰æ·»åŠ ä»¥ä¸‹å†…å®¹:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="edef" class="mj kx iq mf b gy mk ml l mm mn">header('Content-Disposition: attachment; filename="filename.ext"');</span></pre><h1 id="8603" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">ä¸‹è½½æ–‡ä»¶</h1><p id="4129" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">æ›´æœ‰è¶£çš„æ˜¯ï¼Œåœ¨å‘é€HTTPè¯·æ±‚åï¼Œæ–‡ä»¶æ˜¯å¦‚ä½•ä¸‹è½½çš„ã€‚è®©æˆ‘ä»¬ç›´å…¥ä¸»é¢˜:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="6f3f" class="mj kx iq mf b gy mk ml l mm mn">&lt;!doctype html&gt;<br/>&lt;html&gt;<br/>&lt;head&gt;<br/>  &lt;meta charset="utf-8"&gt;<br/>  &lt;title&gt;Download POST Request&lt;/title&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>Enter a text and click the button: &lt;input type="text" id="content" value="Text for the generated pdf"&gt;<br/>&lt;button id="download"&gt;Send AJAX Request and download file&lt;/button&gt;</span><span id="3fd5" class="mj kx iq mf b gy mo ml l mm mn">&lt;script&gt;<br/>  document.getElementById('download').addEventListener('click', function () {<br/>    var content = document.getElementById('content').value;<br/>    var request = new XMLHttpRequest();<br/>    request.open('POST', '../server/', true);<br/>    request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');<br/>    request.responseType = 'blob';</span><span id="4e3d" class="mj kx iq mf b gy mo ml l mm mn">request.onload = function() {<br/>      // Only handle status code 200<br/>      if(request.status === 200) {<br/>        // Try to find out the filename from the content disposition `filename` value<br/>        var disposition = request.getResponseHeader('content-disposition');<br/>        var matches = /"([^"]*)"/.exec(disposition);<br/>        var filename = (matches != null &amp;&amp; matches[1] ? matches[1] : 'file.pdf');</span><span id="497d" class="mj kx iq mf b gy mo ml l mm mn">// The actual download<br/>        var blob = new Blob([request.response], { type: 'application/pdf' });<br/>        var link = document.createElement('a');<br/>        link.href = window.URL.createObjectURL(blob);<br/>        link.download = filename;</span><span id="5b60" class="mj kx iq mf b gy mo ml l mm mn">document.body.appendChild(link);</span><span id="6883" class="mj kx iq mf b gy mo ml l mm mn">link.click();</span><span id="d01d" class="mj kx iq mf b gy mo ml l mm mn">document.body.removeChild(link);<br/>      }<br/>      <br/>      // some error handling should be done here...<br/>    };</span><span id="e97b" class="mj kx iq mf b gy mo ml l mm mn">request.send('content=' + content);<br/>  });<br/>&lt;/script&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="742b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="lz">æ·±å‘¼å¸â€¦ </em></p><p id="f770" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å®é™…çš„ä¸‹è½½æ˜¯é€šè¿‡åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ¥å®Œæˆçš„ï¼Œè¯¥å¯¹è±¡ç”¨äºä¸€ä¸ªæ–°åˆ›å»ºçš„<code class="fe mq mr ms mf b">a</code>æ ‡ç­¾ï¼Œè¯¥æ ‡ç­¾å¸¦æœ‰ä¸€ä¸ªåˆ°æ‰€åˆ›å»ºçš„<code class="fe mq mr ms mf b">Blob</code>å¯¹è±¡çš„é“¾æ¥ï¼Œè¯¥é“¾æ¥è¢«è‡ªåŠ¨ç‚¹å‡»ï¼Œæœ€ç»ˆæ‰“å¼€â€œä¿å­˜æ–‡ä»¶â€å¯¹è¯æ¡†ã€‚æ­¤å¤–ï¼Œå®ƒè¢«é™„åŠ åˆ°<code class="fe mq mr ms mf b">body</code>(è¿™æ˜¯å¯¹Firefoxçš„ä¸€ä¸ªä¿®å¤)ä¹‹åä»ä¸»ä½“ä¸­ç§»é™¤(æˆ‘ä»¬ä¸å¸Œæœ›æˆ‘ä»¬çš„ä¸»ä½“ä¸Šæœ‰å¤§é‡ä¸å¯è§çš„<code class="fe mq mr ms mf b">a</code>æ ‡ç­¾)ã€‚</p><p id="7d0d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å—¯ï¼Œ<em class="lz">å’Œdivs </em>ä¸­çš„å†…å®¹å‚ç›´å±…ä¸­ä¸€æ ·ç®€å•ï¼(<em class="lz"> Flexboxä½œå¼Šï¼</em>)</p><p id="a2eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è¯·è®°ä½ï¼Œè¿™ä¸ªå®ç°ä½¿ç”¨æ™®é€šçš„JavaScript(ä½¿æ¯ä¸ªäººéƒ½æ›´å®¹æ˜“ç†è§£è¿™ä¸ªä¾‹å­)ï¼Œä½†æ˜¯å®é™…çš„ä¸‹è½½å¯¹äºå¤§å¤šæ•°æ¡†æ¶(jQueryã€Vueã€Angularç­‰ç­‰)éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><p id="39db" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å½“ç„¶ï¼Œä½ å¯ä»¥åœ¨GitHub ä¸Šæ‰¾åˆ°å®Œæ•´çš„å®ç°ã€‚</p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><p id="5887" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·ç•™ä¸‹ğŸ‘ï¼Œå…³æ³¨æˆ‘ä¸Š <a class="ae mp" href="https://twitter.com/nehalist" rel="noopener ugc nofollow" target="_blank"> <em class="lz">æ¨ç‰¹</em> </a> <em class="lz">å¹¶è®¢é˜…</em> <a class="ae mp" href="https://nehalist.io/newsletter/" rel="noopener ugc nofollow" target="_blank"> <em class="lz">æˆ‘çš„å¿«è®¯</em> </a> <em class="lz">ã€‚åŸè½½äº2018å¹´1æœˆ13æ—¥</em><a class="ae mp" href="https://nehalist.io/downloading-files-from-post-requests/" rel="noopener ugc nofollow" target="_blank"><em class="lz">https://nehalist . io</em></a><em class="lz">ã€‚</em></p></div></div>    
</body>
</html>