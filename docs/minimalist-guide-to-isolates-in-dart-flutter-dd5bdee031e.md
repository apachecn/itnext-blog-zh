# Dart/Flutter ä¸­éš”ç¦»ç‰©çš„æœ€ç®€æŒ‡å—

> åŸæ–‡ï¼š<https://itnext.io/minimalist-guide-to-isolates-in-dart-flutter-dd5bdee031e?source=collection_archive---------4----------------------->

![](img/739cd7de5bae277b7e7cdb25dc17d513.png)

æŠ±æ­‰ï¼Œå°é¢å¤ªä¸‘äº†ï¼Œä½†æˆ‘å°±æ˜¯æ§åˆ¶ä¸ä½è‡ªå·±å»åš

## è®©æˆ‘ä»¬æ·±å…¥æ¢è®¨ Dart/Flutter ä¸­çš„å¤šçº¿ç¨‹ï¼

## ä¼—æ‰€å‘¨çŸ¥

Dart/Flutter æ˜¯å•çº¿ç¨‹çš„ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰ Dart ä»£ç éƒ½åœ¨ä¸€ä¸ªéš”ç¦»ä¸­è¿è¡Œ

## ä½†è¿™åˆ°åº•æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿ

å½“æˆ‘ä»¬è¿è¡Œ`main()`åŠŸèƒ½æ—¶ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬è´Ÿè´£ä¸»è¦éš”ç¦»ã€‚

ä¸»éš”ç¦»çš„è´£ä»»æ˜¯å¯¹äº‹ä»¶ä½œå‡ºååº”ã€‚

æ‰€ä»¥æ¯ä¸ªä»»åŠ¡éƒ½æ˜¯åˆ†åˆ«è¿è¡Œçš„ï¼Œè€Œä¸æ˜¯å¹¶è¡Œçš„

![](img/9195c1a96b2981fcc8a707a5da9f85a0.png)

å¦‚æœä¸»éš”ç¦»æ‰§è¡Œç¹é‡çš„ä»»åŠ¡ã€‚ä¸»éš”ç¦»åŒºå°†è¢«å°é”ã€‚

å®ƒä¸åº”è¯¥è¢«é˜»æ­¢ï¼Œå› ä¸ºå¦‚æœå®ƒè¢«é˜»æ­¢ï¼Œç”¨æˆ·ç•Œé¢å°†ä¼šæ»åå’Œå†»ç»“ï¼Œç”¨æˆ·ä¼šæŠ±æ€¨å®ƒï¼Œä½ ä¼šå—åˆ°ä¸å¥½çš„è¯„è®ºï¼Œæ¯å¤©æ™šä¸Šéƒ½ä¼šåœ¨åºŠä¸Šå“­æ³£ï¼Œå¹¶é—®è‡ªå·±ä¸ºä»€ä¹ˆæ‰€æœ‰è¿™äº›éƒ½å‘ç”Ÿåœ¨ä½ èº«ä¸Šï¼Ÿï¼ï¼

æ‰€ä»¥å¦‚æœä½ ä¸æƒ³è¦é‚£ç§åœºæ™¯ï¼Œè¯·è€ƒè™‘ä½¿ç”¨éš”ç¦»æ¥å®Œæˆç¹é‡çš„ä»»åŠ¡ã€‚è¿™æ ·æ¯ä¸ªäººéƒ½ä¼šå¼€å¿ƒã€‚

![](img/8382fc754c2cc5a48b2246e4b882aa1b.png)

å¦‚æœæˆ‘ä»¬åˆ°äº†å­¤ç«‹ç‚¹ï¼Œè®©æˆ‘ä»¬å¼€å§‹é—®ç­”

## ä»€ä¹ˆæ˜¯å­¤ç«‹ï¼Ÿ

![](img/57c91051fd0bc5f05d6f75e73c1e7960.png)

*   éš”ç¦»ä½¿ä½ çš„ä»£ç å¹¶è¡Œ(åŒæ—¶)è¿è¡Œã€‚æ²¡æœ‰åˆ†åˆ«

## æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ

*   ä¸ºäº†é˜²æ­¢ä¸»éš”ç¦»çš„ç“¶é¢ˆ

## ä½•æ—¶ä½¿ç”¨éš”ç¦»ç‰©ï¼Ÿ

*   æ‰§è¡Œç¹é‡çš„ä»»åŠ¡ï¼Œå¦‚å›¾åƒå¤„ç†ç­‰ã€‚

## ä¸ºä»€ä¹ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºéš”ç¦»è€Œä¸æ˜¯çº¿ç¨‹ï¼Ÿ

*   ä¸»è¦åŒºåˆ«æ˜¯éš”ç¦»ä¸åƒçº¿ç¨‹é‚£æ ·å…±äº«å†…å­˜ã€‚

## éš”ç¦»å’Œå¼‚æ­¥æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

![](img/6887131a707dd7ab525e6157766c42af.png)

[https://stack overflow . com/questions/59139242/STD async-do-not-see-to-really-implement-single-threaded-asynchronous-beha](https://stackoverflow.com/questions/59139242/stdasync-does-not-seem-to-really-implement-single-threaded-asynchronous-beha)

*   Async åªæ˜¯å°†ä¸€ä¸ªé•¿çš„åŒæ­¥ä»»åŠ¡åˆ†å‰²æˆè¾ƒå°çš„ä»»åŠ¡ï¼Œè¿™æœ‰åŠ©äºä¿æŒ 60 FPSï¼Œè€Œä¸æ˜¯åƒéš”ç¦»é‚£æ ·å¹¶è¡Œè¿è¡Œ

![](img/6a4fc22f91fbf15aee0c6115291f0f12.png)

å¼‚æ­¥ËŒéåŒæ­¥(asynchronous)

![](img/293f1ed57e951cebcc67a059b95db0be.png)

å­¤ç«‹çš„

## ä¸ºä»€ä¹ˆ Dart ä¸åœ¨éš”ç¦»åŒºä¹‹é—´å…±äº«å†…å­˜ï¼Ÿ

*   *å¤§å¤šæ•°ç°ä»£è®¾å¤‡éƒ½æœ‰å¤šæ ¸ CPUã€‚ä¸ºäº†åˆ©ç”¨æ‰€æœ‰è¿™äº›å†…æ ¸ï¼Œå¼€å‘äººå‘˜æœ‰æ—¶ä¼šä½¿ç”¨å¹¶å‘è¿è¡Œçš„å…±äº«å†…å­˜çº¿ç¨‹ã€‚ç„¶è€Œï¼Œå…±äº«çŠ¶æ€å¹¶å‘æ˜¯* [*æ˜“é”™çš„*](https://en.wikipedia.org/wiki/Race_condition#In_software) *å¹¶ä¸”ä¼šå¯¼è‡´å¤æ‚çš„ä»£ç ã€‚*
*   *æ‰€æœ‰ Dart ä»£ç éƒ½åœ¨éš”ç¦»åŒºå†…è¿è¡Œï¼Œè€Œä¸æ˜¯çº¿ç¨‹ã€‚æ¯ä¸ªéš”ç¦»éƒ½æœ‰è‡ªå·±çš„å†…å­˜å †ï¼Œç¡®ä¿ä»»ä½•å…¶ä»–éš”ç¦»éƒ½æ— æ³•è®¿é—®æŸä¸ªéš”ç¦»ä¸­çš„ä»»ä½•çŠ¶æ€ã€‚å› ä¸ºæ²¡æœ‰å…±äº«å†…å­˜ï¼Œä½ ä¸å¿…æ‹…å¿ƒ* [*äº’æ–¥æˆ–é”*](https://en.wikipedia.org/wiki/Lock_(computer_science)) *ã€‚*
*   *å·¥äººéš”ç¦»å¯ä»¥æ‰§è¡Œ I/O(ä¾‹å¦‚ï¼Œè¯»å†™æ–‡ä»¶)ã€è®¾ç½®å®šæ—¶å™¨ç­‰ç­‰ã€‚å®ƒæœ‰è‡ªå·±çš„å†…å­˜ï¼Œä¸ä¸ä¸»éš”ç¦»å…±äº«ä»»ä½•çŠ¶æ€ã€‚å·¥ä½œéš”ç¦»å¯ä»¥é˜»æ­¢ï¼Œè€Œä¸ä¼šå½±å“å…¶ä»–éš”ç¦»ã€‚*

> æè¿°æ¥è‡ª:[https://dart.dev/guides/language/concurrency](https://dart.dev/guides/language/concurrency)

# è¯´å¤Ÿäº†å—ï¼Ÿé‚£æˆ‘ä»¬ç¼–ç å§ï¼

## ä½†æ˜¯åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä¸€äº›ä½¿ç”¨è§„åˆ™

*   è¯¥å‡½æ•°å¿…é¡»æ˜¯é¡¶çº§å‡½æ•°æˆ–é™æ€æ–¹æ³•
*   æ‚¨åªèƒ½å°†ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™ä¸€ä¸ªéš”ç¦»å¯¹è±¡(ä½†æ˜¯ä¸è¦æ‹…å¿ƒï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ map å‘é€ä»»æ„å¤šçš„æ•°æ®)

## æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ä½¿ç”¨éš”ç¦»

ä»–ä»¬åšç€å‡ ä¹ç›¸åŒçš„äº‹æƒ…ã€‚åªæ˜¯ç”¨æ³•æœ‰ç‚¹ä¸åŒ

*   `compute()`:ç®€å•çš„æ–¹æ³•
*   `Isolate.spawn()`:é«˜çº§æ–¹å¼

ç°åœ¨è®©æˆ‘ä»¬å¼€å§‹å§ï¼

## è®¡ç®—

ç”Ÿæˆä¸€ä¸ªéš”ç¦»å¹¶åœ¨è¯¥éš”ç¦»ä¸Šè¿è¡Œå›è°ƒçš„å‡½æ•°ã€‚

## éš”ç¦».äº§åµ

![](img/2f34ae133f9fe1e2aba481dcc9b39ce6.png)

-å›¾ç‰‡æ¥è‡ªå¡”è¾¾æ–¯ä½©ç‰¹æ‹‰

`spawn`ç»™äº†æˆ‘ä»¬æ¯”`compute`æ›´å¤šçš„çµæ´»æ€§ã€‚

æˆ‘ä»¬éœ€è¦åˆ›é€ ä¸€ä¸ª`ReceivePort()`æ¥ä¸å…¶ä»–éš”ç¦»ç‰©äº¤æµã€‚

ä¸[å‘é€ç«¯å£](https://api.dart.dev/stable/2.16.1/dart-isolate/SendPort-class.html)ä¸€èµ·ï¼Œå¤„ç†éš”ç¦»ä¹‹é—´çš„æ‰€æœ‰é€šä¿¡ã€‚

> ä¸€ä¸ª[æ¥æ”¶ç«¯å£](https://api.dart.dev/stable/2.16.1/dart-isolate/ReceivePort-class.html)å¯èƒ½æœ‰å¤šä¸ª[å‘é€ç«¯å£](https://api.dart.dev/stable/2.16.1/dart-isolate/SendPort-class.html)ã€‚

1.  åˆ›å»ºæ¥æ”¶æŠ¥å‘Š
2.  äº§ç”Ÿä¸€ä¸ªéš”ç¦»å‘é€æ•°æ®å’Œç«¯å£ã€‚
3.  è®¡ç®—ä¸€é¡¹ç¹é‡çš„ä»»åŠ¡
4.  ä½¿ç”¨å‘é€ç«¯å£å‘é€è®¡ç®—çš„æ•°æ®
5.  ä½¿ç”¨ç«¯å£è¯»å–è®¡ç®—çš„æ•°æ®ï¼Œå¹¶ç»§ç»­æ‚¨çš„å·¥ä½œ

# ä¸€äº›å€¼å¾—æ³¨æ„çš„ä¿¡æ¯

![](img/1b82007ff8d872abbb160a605bcd7ee2.png)

[https://www.youtube.com/watch?v=SXT7nir1B48](https://www.youtube.com/watch?v=SXT7nir1B48)

*   ç¹æ®–ä¸€ç§éš”ç¦»ç‰©éœ€è¦å¤§çº¦ 50-150 æ¯«ç§’
*   é‡å¤ä½¿ç”¨éš”ç¦»ä»¥é™ä½å¯åŠ¨æˆæœ¬
*   æ¯ä¸ªéš”ç¦»åŒºå ç”¨å¤§çº¦ 2MB
*   ä»éš”ç¦»åŒºä¼ é€’çš„æ¯ä¸ªæ¶ˆæ¯éƒ½éœ€è¦æ¶ˆæ¯å¤§å°* 2 çš„å†…å­˜ï¼Œå› ä¸ºéš”ç¦»åŒºä¸å…±äº«å†…å­˜ï¼Œæ‰€ä»¥åœ¨ç³»ç»Ÿä¸Šå°†æœ‰ä¸¤ä¸ªå‰¯æœ¬ï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨æœ‰ 1 GB çš„æ–‡ä»¶ï¼Œå¹¶ä¸”æƒ³è¦ä»ä¸€ä¸ªéš”ç¦»åŒºä¼ é€’åˆ°ç¬¬äºŒä¸ªéš”ç¦»åŒºï¼Œåˆ™éœ€è¦è®¾å¤‡ä¸Š 2Gb çš„å†…å­˜

# å‚è€ƒ

[](https://dev.to/alphamikle/why-should-you-use-isolates-in-flutter-1k5o) [## ä¸ºä»€ä¹ˆè¦åœ¨é¢¤æŒ¯ä¸­ä½¿ç”¨éš”ç¦»ç‰©ï¼Ÿ

### åœ¨ Flutter ä¸­æœ‰è®¸å¤šç®¡ç†çŠ¶æ€çš„æ–¹æ³•ï¼Œä½†æ˜¯å¤§å¤šæ•°éƒ½æ˜¯ä»¥è¿™æ ·ä¸€ç§æ–¹å¼æ„å»ºçš„ï¼Œå³æ‰€æœ‰çš„é€»è¾‘éƒ½è¢«æ‰§è¡Œâ€¦

å¼€å‘åˆ°](https://dev.to/alphamikle/why-should-you-use-isolates-in-flutter-1k5o) [](https://dart.dev/guides/language/concurrency) [## Dart ä¸­çš„å¹¶å‘æ€§

### Dart æ”¯æŒä½¿ç”¨ async-awaitã€isolates å’Œç±»(å¦‚ Future å’Œ Stream)è¿›è¡Œå¹¶å‘ç¼–ç¨‹ã€‚æœ¬é¡µç»™å‡ºäº†â€¦

dart.dev](https://dart.dev/guides/language/concurrency)  [## éš”ç¦»ç±»-Dart:éš”ç¦»åº“ Dart API

### ç‹¬ç«‹çš„ Dart æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚æ‰€æœ‰çš„ Dart ä»£ç éƒ½åœ¨ä¸€ä¸ªéš”ç¦»ä¸­è¿è¡Œï¼Œä»£ç åªèƒ½ä»â€¦

api.flutter.dev](https://api.flutter.dev/flutter/dart-isolate/Isolate-class.html) 

## æ„Ÿè°¢æ‚¨çš„é˜…è¯»ï¼

æˆ‘è¯•å›¾å°½å¯èƒ½ç®€å•åœ°è§£é‡Šã€‚å¸Œæœ›ä½ å–œæ¬¢ã€‚

å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·ç‚¹å‡»ğŸ‘æŒ‰é’®(ä½ çŸ¥é“ä½ å¯ä»¥å‡åˆ° 50 å—ï¼Ÿ)