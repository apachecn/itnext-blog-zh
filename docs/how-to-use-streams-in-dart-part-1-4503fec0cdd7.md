# å¦‚ä½•åœ¨ Dart ä¸­ä½¿ç”¨æµ(ç¬¬ 1 éƒ¨åˆ†)

> åŸæ–‡ï¼š<https://itnext.io/how-to-use-streams-in-dart-part-1-4503fec0cdd7?source=collection_archive---------1----------------------->

## åˆ©ç”¨ Dart ç±»å¤„ç†æµæ•°æ®

![](img/9c9993fe7391b7838eb070ef44a5e400.png)

*ç…§ç‰‡ç”±* [*æ°ç½—å§† Prax*](https://unsplash.com/photos/U_m-mPOZzMI?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) *ä¸Š*[*Unsplash*](https://unsplash.com/search/photos/stream?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

å¯¹äºå¤§å¤šæ•°é’»ç ” Dart ( *æˆ–ä»»ä½•å…¶ä»–è¯­è¨€)çš„ç¨‹åºå‘˜æ¥è¯´ï¼Œæµçš„æ¦‚å¿µå·²ç»è¢«è¯æ˜æ˜¯ä¸€ä¸ªå¾ˆéš¾ç†è§£çš„è¯é¢˜ï¼Œéƒ¨åˆ†åŸå› æ˜¯å®ƒéœ€è¦é€šè¿‡å‡ æ¬¡å°è¯•å’Œä¾‹å­æ¥æŒæ¡ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è¯•å›¾æ­å¼€ Dart ä¸­æµçš„ä½¿ç”¨çš„ç¥ç§˜é¢çº±ï¼ŒåŒæ—¶ç”¨æˆ‘ä»¬åœ¨æœ¬ç³»åˆ—ä¸­è¿›ä¸€æ­¥å­¦åˆ°çš„çŸ¥è¯†æ„å»ºä¸€äº›æœ‰å½¢çš„ä¸œè¥¿ã€‚*

# ä»€ä¹ˆæ˜¯æµï¼Ÿ

æŸ¥çœ‹ Dart æ–‡æ¡£ï¼Œå…¶å®šä¹‰ä¸º:

> å¼‚æ­¥æ•°æ®äº‹ä»¶çš„æ¥æºã€‚æµæä¾›äº†ä¸€ç§æ¥æ”¶äº‹ä»¶åºåˆ—çš„æ–¹å¼ã€‚æ¯ä¸ªäº‹ä»¶è¦ä¹ˆæ˜¯ä¸€ä¸ªæ•°æ®äº‹ä»¶ï¼Œä¹Ÿç§°ä¸ºæµçš„ä¸€ä¸ªå…ƒç´ ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ªé”™è¯¯äº‹ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªé€šçŸ¥ï¼Œè¡¨æ˜æŸäº›äº‹æƒ…å·²ç»å¤±è´¥ã€‚å½“ä¸€ä¸ªæµå‘å‡ºå®ƒçš„æ‰€æœ‰äº‹ä»¶æ—¶ï¼Œä¸€ä¸ªå•ç‹¬çš„â€œdoneâ€äº‹ä»¶å°†é€šçŸ¥ä¾¦å¬å™¨å·²ç»åˆ°è¾¾ç»“å°¾ã€‚
> 
> **api.dartlang.org**

ä½œä¸ºä¸€ä¸ªæ¦‚å¿µï¼ŒæµæŒ‡çš„æ˜¯*é€šé“*ï¼Œæ•°æ®é€šè¿‡è¯¥é€šé“ä» A ç‚¹æµå‘ b ç‚¹ã€‚åœ¨è¯¥é€šé“ä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¯¹åˆ°è¾¾ b ç‚¹ä¹‹å‰â€œè¯»å…¥â€çš„æ•°æ®æ‰§è¡Œå„ç§è½¬æ¢ã€‚å½“ä»¥*å—*çš„å½¢å¼ä¼ è¾“æ•°æ®è€Œä¸æ˜¯ä¸€æ¬¡ä¼ è¾“å…¨éƒ¨æ•°æ®æ—¶ï¼Œè¯¥*é€šé“*éå¸¸æœ‰ç”¨ã€‚

åœ¨ Dart ä¸­ä½¿ç”¨æµçš„æ–¹å¼æ˜¯é€šè¿‡ SDK æä¾›çš„ä¸€ç»„åŠ©æ‰‹ç±»ã€‚è¿™äº›åŠ©æ‰‹ç±»æä¾›äº†å®ç”¨æ–¹æ³•ï¼Œå°†æ•°æ®æ¨é€åˆ°æµä¸­ï¼Œå¹¶é€šçŸ¥æµçš„ä¾¦å¬å™¨æ•è·ä»»ä½•æ·»åŠ çš„æ•°æ®ã€‚

ä»£è¡¨æµçš„æœ€é€šç”¨çš„ç±»å«åš`Stream<T>`ã€‚é€šå¸¸æˆ‘ä»¬ä¸ç›´æ¥ä½¿ç”¨è¿™ä¸ªç±»ï¼Œå› ä¸ºå®ƒè¢« Dart åº“ä¸­çš„å…¶ä»–ç±»æš´éœ²äº†ã€‚å°†æ­¤è§†ä¸ºä¸æ•°æ®æµç»çš„*é€šé“*äº¤äº’çš„æ¥å£ã€‚

# æµæ§åˆ¶å™¨çš„åŸºæœ¬ç¤ºä¾‹

ä¸€ä¸ª`StreamController<T>`åŒ…å«ä¸€ä¸ªæµï¼Œå®ƒå…è®¸æ¶ˆè´¹è€…å‘å®ƒå‘é€æ•°æ®ã€å®Œæˆå’Œé”™è¯¯äº‹ä»¶ã€‚æˆ‘ä»¬å°†é€šè¿‡æ‰§è¡Œ`streamController.stream`æ¥è®¿é—®è¿™ä¸ªæµï¼Œå…è®¸æˆ‘ä»¬è°ƒç”¨åœ¨å®ƒçš„[æ–‡æ¡£](https://api.dartlang.org/stable/2.1.1/dart-async/Stream-class.html)ä¸­å®šä¹‰çš„ä»»ä½•æ–¹æ³•ã€‚

è¿™é‡Œæœ‰ä¸€ä¸ªå…³äº`StreamController<T>`ç±»çš„ä¾‹å­:

```
var streamController = **StreamController**();// Accessing the stream and listening for data event
streamController.**stream**.**listen**((**data**) {
  print('Got eem! $**data**');
});
```

ä¸Šé¢çš„ä»£ç ç‰‡æ®µå…è®¸æˆ‘ä»¬è§‚å¯Ÿæµ*é€šé“*ä¸­ä¼ å…¥çš„æ•°æ®å—ã€‚ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡å°†æ•°æ®æ‰“å°åˆ°æ§åˆ¶å°æ¥å“åº”è¿™äº›æ•°æ®ã€‚

æ‰€ä»¥æˆ‘çŒœæ¥ä¸‹æ¥çš„**é—®é¢˜**æ˜¯:*æˆ‘ä»¬å¦‚ä½•è§¦å‘æ•°æ®ç›‘å¬å™¨äº‹ä»¶ï¼Ÿ* **ç­”æ¡ˆ:** *é€šè¿‡ç»™æµå–‚æ•°æ®ï¼è¿™æ˜¯é€šè¿‡å¦ä¸€ä¸ªåä¸º`EventSink<T>`çš„ç±»å®ç°çš„ã€‚è¿™ä¸ªå¯¹è±¡åŒ…å«ä¸€ä¸ª`add()`æ–¹æ³•ï¼Œç”¨äºå‘æµæä¾›æ•°æ®:*

```
streamController.**sink**.**add**('Added this string');// Result
// Got eem! Added this string
```

æµä¸Šçš„`listen()`æ–¹æ³•ä¹Ÿå¯ä»¥æ•æ‰é”™è¯¯æ¶ˆæ¯ã€‚è¿™æ˜¯å› ä¸ºæ¯å½“æ‚¨ä¾¦å¬æµæ—¶ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ª`StreamSubscription<T>`å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡æ˜¯**èƒ½å¤Ÿå¤„ç†å„ç§äº‹ä»¶**çš„åŸå› ï¼Œä¾‹å¦‚æ•°æ®ã€é”™è¯¯å’Œå®Œæˆ(å½“åœ¨æµä¸Šè°ƒç”¨ close()æ–¹æ³•æ—¶*)ã€‚*

ä¸‹é¢æ˜¯`listen()`æ–¹æ³•çš„å®Œæ•´å®šä¹‰:

```
**StreamSubscription<T>** listen (
  void **onData**(**T** event), 
  {
    Function **onError**,
    void **onDone**(), // Invoked when the stream is closed
    bool **cancelOnError** // Kills the stream when an error occurs
  });
```

ä¸‹é¢æ˜¯æˆ‘ä»¬å¦‚ä½•è°ƒç”¨â€œé”™è¯¯â€å’Œâ€œå®Œæˆâ€äº‹ä»¶:

```
streamController.**sink**.**addError**('Houston, we have a problem!'); // Got an error! Houston, we have a problem!streamController.**sink**.**close**(); // Mission complete!
```

â†’ [**åœ¨é•–é¶ä¸Šè¯•è¯•è¿™ä¸ª**](https://dartpad.dartlang.org/3baf3a9c229dcfa962878905e478a1a7)

# é€šè¿‡åº“å…¬å¼€çš„æµ

è™½ç„¶`StreamController<T>`å…è®¸æˆ‘ä»¬å¯¹è‡ªå·±å®ä¾‹åŒ–çš„æµè¿›è¡Œç»†ç²’åº¦çš„æ§åˆ¶ï¼Œä½†æ˜¯æœ‰å†…ç½®çš„ dart åº“åœ¨å¹•åä½¿ç”¨æµã€‚ä¾‹å¦‚ï¼Œçœ‹çœ‹è¿™ä¸ªè®¾ç½®æœåŠ¡å™¨çš„ä»£ç ç‰‡æ®µ:

```
import 'dart:io';void main() async {
  var **server** = await **HttpServer.bind**('localhost', 8080); // HttpServer exposes a Stream<T> interface
  **server**.**listen**((HttpRequest **request**) {
    request.response.write('Hello, World!');
    request.response.close();
  });
}
```

ä¸Šé¢çš„ä»£ç ç‰‡æ®µå®ä¾‹åŒ–äº†ä¸€ä¸ªç”¨äºåˆ›å»º web æœåŠ¡å™¨çš„`HttpServer`ã€‚è¿™ä¸ªç±»å…¬å¼€äº†ä¸€ä¸ª`Stream<T>`æ¥å£ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ç°åœ¨å¯ä»¥ç›‘å¬è¿™ä¸ªæµï¼Œå®ƒå°†åŒ…å«å½“ç”¨æˆ·è®¿é—®æˆ‘ä»¬çš„æœåŠ¡å™¨æ—¶äº§ç”Ÿçš„è¯·æ±‚å¯¹è±¡ã€‚

ä¸‹é¢æ˜¯ web æµè§ˆå™¨ä¸­æ˜¾ç¤ºçš„å¦ä¸€ä¸ªæµç¤ºä¾‹:

```
import 'dart:html';void main() {
  var **button** = querySelector('button');

  // `onClick` is a Stream<T> instance that receives user click data events
  button.**onClick**.**listen**((_) => print('Button clicked!'));
}
```

åœ¨æµè§ˆå™¨ä¸­å‘ç”Ÿçš„ç”¨æˆ·äº¤äº’ï¼Œå¦‚*ç‚¹å‡»*ã€*æ»šåŠ¨*ã€*è¾“å…¥*ç­‰ï¼Œè¢«ä½œä¸ºæµä¸­æ•è·çš„â€œæ•°æ®â€äº‹ä»¶å‘å‡ºã€‚æ¢å¥è¯è¯´ï¼ŒHTML å…ƒç´ ä¹Ÿå…¬å¼€äº†ä¸€ä¸ª`Stream<T>`æ¥å£ï¼Œç”¨äºå¤„ç†é¡µé¢ä¸Šçš„ç”¨æˆ·äº¤äº’ã€‚

è¿˜æœ‰å¾ˆå¤šä½¿ç”¨æµçš„ç±»ï¼Œè¿™é‡Œçš„è¦ç‚¹æ˜¯ï¼Œé€šå¸¸ä½ ä¸ä¼šç›´æ¥å®ä¾‹åŒ–`Stream<T>`å¯¹è±¡ï¼Œè€Œæ˜¯é€šè¿‡ SDK ä¸­çš„å„ç§åº“ç±»ä¸ºä½ å®ä¾‹åŒ–ã€‚

# ç»“è®º

æµæä¾›äº†ä¸€ç§å¤„ç†å¤§å—æ•°æ®çš„å¼ºå¤§æ–¹å¼ã€‚å› ä¸ºè¿™æ˜¯ä»¥å¼‚æ­¥æ–¹å¼è¿è¡Œçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è·å¾—äº†ä»¥éé˜»å¡æ–¹å¼è¿è¡Œä»£ç çš„å¥½å¤„ã€‚æˆ‘å»ºè®®é€šè¯»æ–‡æ¡£ï¼Œç‰¹åˆ«æ˜¯åŒ…å«å¼‚æ­¥ç¼–ç¨‹ç±»çš„ **dart:async** åº“ï¼Œæ¯”å¦‚ Streams å’Œ Futuresã€‚

åœ¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶å¦‚ä½•åœ¨æµä¸Šæ‰§è¡Œè½¬æ¢ï¼Œä»¥åŠæ¼”ç¤ºä¸€ä¸ªä»¥ä½¿ç”¨æµğŸ§±ä¸ºä¸­å¿ƒçš„é€šç”¨è®¾è®¡æ¨¡å¼

# ç»§ç»­é˜…è¯»

â†’ [**å¦‚ä½•åœ¨ Dart ä¸­ä½¿ç”¨ Streams(ç¬¬äºŒéƒ¨)**](https://creativebracket.com/how-to-use-streams-in-dart-2/)

# è¿›ä¸€æ­¥é˜…è¯»

*   [dart:å¼‚æ­¥åº“æ–‡æ¡£](https://api.dartlang.org/stable/2.1.1/dart-async/dart-async-library.html)
*   [**egghead . io ä¸Šå…è´¹é£é•–è¯¾**](https://egghead.io/instructors/jermaine-oppong)

# åˆ†äº«æ˜¯å…³æ€€ğŸ¤—

å¦‚æœä½ å–œæ¬¢è¯»è¿™ç¯‡æ–‡ç« ï¼Œè¯·é€šè¿‡å„ç§ç¤¾äº¤æ¸ é“åˆ†äº«ã€‚æ­¤å¤–ï¼Œæ£€æŸ¥å¹¶ [**è®¢é˜…æˆ‘çš„ YouTube é¢‘é“**](https://youtube.com/c/CreativeBracket) ( *ä¹Ÿç‚¹å‡»é“ƒé“›å›¾æ ‡*)è§‚çœ‹ Dart ä¸Šçš„è§†é¢‘ã€‚

[**è®¢é˜…æˆ‘çš„ç”µå­é‚®ä»¶ç®€è®¯**](http://eepurl.com/gipQBX) ä¸‹è½½æˆ‘çš„å…è´¹**Dart å…¥é—¨ç”µå­ä¹¦**å¹¶åœ¨æ–°å†…å®¹å‘å¸ƒæ—¶å¾—åˆ°é€šçŸ¥ã€‚

**å–œæ¬¢ï¼Œåˆ†äº«ä¸€ä¸‹** [**è·Ÿç€æˆ‘**](https://twitter.com/creativ_bracket) ğŸ˜æœ‰å…³ Dart çš„æ›´å¤šå†…å®¹ã€‚