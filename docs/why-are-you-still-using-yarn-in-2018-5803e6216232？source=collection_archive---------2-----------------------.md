# 2018 å¹´ä¸ºä»€ä¹ˆè¿˜åœ¨ç”¨çº±ï¼Ÿ

> åŸæ–‡ï¼š<https://itnext.io/why-are-you-still-using-yarn-in-2018-5803e6216232?source=collection_archive---------2----------------------->

![](img/115dbfe091c15bda4e526f4b82a9045d.png)

æˆ‘è®°å¾—å½“çº±çˆ†ç‚¸åˆ°ç°åœºã€‚

é€Ÿåº¦è¶…å¿«ã€‚æ¯éš”`yarn install`å°±èŠ‚çœå‡ åˆ†é’Ÿã€‚

è¿™ç¡®ä¿äº†ä½ çš„`/node_modules`ä¸ä½ æ—è¾¹å¥½å‹çš„`/node_modules`å®Œå…¨åŒ¹é…ã€‚è¿˜æœ‰æœåŠ¡å™¨ä¸Šçš„`/node_modules`ã€‚ä¸è¦å†è¯´â€œè¿™å¯¹æˆ‘æœ‰ç”¨ï¼Œ\_(ãƒ„)_/â€ã€‚

è€Œä¸”ï¼Œè¡¨æƒ…ç¬¦å·æ— å¤„ä¸åœ¨ï¼ğŸ”¥ğŸ”¥ğŸ”¥

**6 ä¸ªæœˆè¿‡å»äº†â€¦â€¦**

npm åœ¨ v5 ä¸­å²è¯—èˆ¬åœ°å·åœŸé‡æ¥ï¼Œå¸¦æ¥äº†é€Ÿåº¦çš„æé«˜å’Œä¸€è‡´çš„`/node_modules`ã€‚æ˜¯çš„ï¼Œæ‰€æœ‰è¿™äº›åŸå› è®©æˆ‘ä»¬å¼€å§‹è½¬å‘çº±çº¿ã€‚

è®¸å¤šå¼€å‘è€…ç°åœ¨æƒ³çŸ¥é“:

> *â€œçº±çº¿è¿˜æœ‰å¿…è¦å—ï¼Ÿâ€*

æˆ‘æƒ³æ˜¯æ—¶å€™æ¢å›è€æ ·å­äº†ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹ã€‚

# npm å’Œçº±çº¿ä¸€æ ·å¿«ã€‚

è‡ªå·±çœ‹:

```
# Backup
mv node_modules node_modules_backup
mv package-lock.json package-lock.backup.json
mv yarn.lock yarn.backup.lock

# Test cold npm speed
time npm install# Reset modules
rm -Rf node_modules# Test warm npm speed
time npm install# Test cold yarn speed
time yarn install

# Reset modules
rm -Rf node_modules# Test warm yarn speed
time yarn install# Reset
rm package-lock.json
rm yarn.lock

# Restore
mv node_modules_backup node_modules
mv package-lock.backup.json package-lock.json
mv yarn.backup.lock yarn.lock
```

æˆ‘è·‘äº†ä¸‰æ¬¡ï¼Œé€Ÿåº¦éå¸¸ç›¸ä¼¼ã€‚

# æ‚¨å¯ä»¥è½»æ¾åœ°åˆ‡æ¢ npm ç‰ˆæœ¬ã€‚

Bob å®‰è£…äº† Yarn v1.1 ç‰ˆï¼ŒBrenda å®‰è£…äº† Yarn 1.2 ç‰ˆã€‚å½“ä»–ä»¬å®‰è£…å’Œåˆ é™¤é¡¹ç›®çš„ä¾èµ–é¡¹æ—¶ï¼ŒYarn å†™å…¥äº†ä¸€ä¸ª`yarn.lock`æ–‡ä»¶ã€‚ä½†æ˜¯ Yarn v1.1 ç‰ˆå’Œ Yarn 1.2 ç‰ˆçš„é”æ–‡ä»¶æ ¼å¼ç•¥æœ‰ä¸åŒï¼Œè¿™å¯¹ Bob å’Œ Brenda æ¥è¯´å¹¶ä¸å¥½ç©ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨`package.json`ä¸­çš„[å¼•æ“](https://yarnpkg.com/lang/en/docs/package-json/#toc-engines)æŒ‡å®šå“ªäº›çº±çº¿ç‰ˆæœ¬ä¸æ‚¨çš„é¡¹ç›®å…¼å®¹ã€‚

ä½†æ˜¯ï¼Œå¦‚æœä½ éœ€è¦å®šæœŸåœ¨ä¸åŒçš„é¡¹ç›®ä¹‹é—´åˆ‡æ¢ï¼Œæ¯ä¸ªé¡¹ç›®éƒ½éœ€è¦ä¸åŒçš„çº±çº¿ç‰ˆæœ¬ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ

æ‚¨éœ€è¦åœæ­¢ä½¿ç”¨ brew ( `brew uninstall yarn`)å¹¶æ¢å¤åˆ° npm å®‰è£…ã€‚åœ¨é¡¹ç›®é—´åˆ‡æ¢æ—¶ï¼Œè¿è¡Œ`npm install yarn@1.1 --global`å’Œ`npm install yarn@1.2 --global`ã€‚æ˜¯çš„ï¼Œæ¯æ¬¡åˆ‡æ¢é¡¹ç›®æ—¶ï¼Œéƒ½è¦é‡æ–°å®‰è£…å®Œæ•´çš„ Yarnã€‚çœŸæ˜¯ä¸€åœºå™©æ¢¦ï¼

**ä½†æ˜¯ç”¨ npm è¶…çº§ç®€å•ï¼**

ä½¿ç”¨ [nvm](https://github.com/creationix/nvm) æˆ– [n](https://github.com/tj/n) ï¼Œä¸€ä¸ªå‘½ä»¤ç¬é—´åˆ‡æ¢ç‰ˆæœ¬ã€‚å˜£ã€‚

![](img/0ea24400d3e6f3cb3edd354bf26ac58a.png)

# ä½¿ç”¨ Lerna æ¥ç®¡ç†æ‚¨çš„å·¥ä½œåŒºã€‚

å¦‚æœä½ åœ¨[å·¥ä½œç©ºé—´](https://yarnpkg.com/lang/en/docs/workspaces/)ç‰¹æ€§ä¸­ä½¿ç”¨ Yarnï¼Œè€ƒè™‘ä½¿ç”¨ [Lerna](https://github.com/lerna/lerna/) æ¥ä»£æ›¿ã€‚å®ƒåšäº† Yarn æä¾›çš„æ‰€æœ‰äº‹æƒ…å’Œé™„åŠ åŠŸèƒ½ï¼Œä¾‹å¦‚:ç®¡ç†å·¥ä½œåŒºç‰ˆæœ¬ï¼Œåœ¨æ¯ä¸ªå·¥ä½œåŒºå†…è¿è¡Œå‘½ä»¤ï¼Œä»¥åŠå‘å¸ƒå·¥ä½œåŒºã€‚

# ä½¿ç”¨ npm-check ä»¥äº¤äº’æ–¹å¼å‡çº§ã€‚

`yarn upgrade-interactive`å‘½ä»¤æ£’æäº†:

![](img/5e90904187631ad5a1ca4901cd708d78.png)

æµè¡Œçš„ [npm-check](https://github.com/dylang/npm-check) æ¨¡å—åšåŒæ ·çš„äº‹æƒ…:

![](img/b5ba32cd16c260e8f3ef93466cc3ea52.png)

å¹¶ä¸”éå¸¸å®¹æ˜“è®¾ç½®:

```
npm install npm-check --save-dev
```

å‘ package.json æ·»åŠ è„šæœ¬:

```
{
  "scripts": {
    "upgrade-interactive": "npm-check --update"
  }
}
```

ç„¶åç”¨`npm run upgrade-interactive`ã€‚

# çº±çº¿å˜å¾—å¤æ‚ã€‚

æ¥è‡ª [Jest](https://github.com/facebook/jest) è‡ªè¿°:

![](img/3bd0f8f0e25483339e57abd758c393e9.png)

ä½¿ç”¨ç¬‘è¯ä¸éœ€è¦æ•…äº‹ã€‚ä½†å®ƒå°±åœ¨è¿™é‡Œï¼Œæ¨ç»™ä½ ã€‚ç°åœ¨æˆ‘éœ€è¦æŠŠ`yarn test`è½¬æ¢æˆ`npm`å‘½ä»¤â€¦â€¦å¥½çš„ï¼Œæ˜¯`npm test`è¿˜æ˜¯`npm run test`ï¼Ÿæˆ‘ä¸å¤ªè®°å¾—äº†ã€‚è¿™æ‰æ˜¯è‡ªè¿°åº”è¯¥å‘Šè¯‰æˆ‘çš„ï¼

å³ä½¿è‡ªè¿°æ–‡ä»¶æ˜¾ç¤ºäº†`yarn`å’Œ`npm`å‘½ä»¤ï¼Œå®ƒä¹Ÿä¸å¿…è¦åœ°å¢åŠ äº†å™ªå£°ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯ [create-react-app](https://github.com/facebook/create-react-app) çš„è‡ªè¿°æ–‡ä»¶:

![](img/803b9466e697b3e4081e6b05c26e16b0.png)

çº±çº¿ç»™æˆ‘ä»¬å¸¦æ¥äº†ä»€ä¹ˆå¥½å¤„ï¼Ÿæ²¡æœ‰ã€‚

å¯¹äºå·²ç»è¢«å­¦ä¹ ä¸€ä¸ªæ–°æ¡†æ¶æå¾—ä¸çŸ¥æ‰€æªçš„å…¨æ–° React å¼€å‘äººå‘˜æ¥è¯´ï¼Œè¿™å¾ˆä»¤äººå›°æƒ‘ã€‚â€œæˆ‘åº”è¯¥è¿è¡Œå“ªä¸ªå‘½ä»¤ï¼Ÿè¿™æ˜¯ä»€ä¹ˆçº±çº¿ï¼Ÿæˆ‘éœ€è¦å®ƒå—ï¼Ÿå•Šï¼â€

æˆ‘è¿˜è§è¿‡å·¥å…·å’Œ CI ä»£ç æ£€æŸ¥`yarn.lock`æ–‡ä»¶ï¼Œå¦‚æœæ£€æµ‹åˆ°ï¼Œå°±è¿è¡Œä¸€ç»„ä¸åŒçš„å‘½ä»¤ã€‚

é€‰æ‹©åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ Yarn æ„å‘³ç€ä½ çš„å¼€å‘å›¢é˜Ÿçš„å…¶ä»–äººï¼ŒåŒ…æ‹¬æœªæ¥çš„è´¡çŒ®è€…ï¼Œä¹Ÿå¿…é¡»ä½¿ç”¨ Yarn(æ¥ç»´æŠ¤`yarn.lock`æ–‡ä»¶)ã€‚

JavaScript ç”Ÿæ€ç³»ç»Ÿå·²ç»è¶³å¤Ÿå¤æ‚äº†ã€‚æˆ‘ä»¬çœŸçš„ä¹Ÿéœ€è¦çº±çº¿å—ï¼Ÿ

æˆ‘å¸Œæœ› Yarn å›¢é˜Ÿå°†ä»–ä»¬çš„æ”¹è¿›è´¡çŒ®ç»™ npm æœ¬èº«ï¼Œä»¥ç®€åŒ–æˆ‘ä»¬çš„ç”Ÿæ´»ã€‚

# npm æ‘‡æ»šï¼

åˆ‡æ¢å› npm åï¼Œæˆ‘æ„è¯†åˆ°æˆ‘çš„ shell è®¾ç½®é€šè¿‡æ‰«æ package.json è„šæœ¬è‡ªåŠ¨å®Œæˆäº†`npm run`å‘½ä»¤:

![](img/01b2ac68fd8729a190b06fa0994a424a.png)

å½“ç„¶ï¼ŒYarn æœ€ç»ˆå¯èƒ½ä¼šæœ‰è¿™ç§æ”¯æŒ(è€Œä¸”å¯èƒ½å·²ç»æœ‰äº†)ã€‚ä½†æ˜¯ npm æ‹¥æœ‰å¹´å¤ä¸€å¹´çš„ç¤¾åŒºæ”¯æŒå’Œå·¥å…·çš„ä¼˜åŠ¿ã€‚

npm ä¹Ÿå¸¦æ¥äº†ä¸€äº›æ€æ‰‹é”ã€‚è¿è¡Œ`npm audit`æ¥æ‰«æä½ çš„é¡¹ç›®æ¼æ´ã€‚ä½¿ç”¨`npx`è¿è¡Œä¸€æ¬¡æ€§å‘½ä»¤(ä¾‹å¦‚:`npx create-react-app`è€Œä¸æ˜¯å…¨å±€å®‰è£…`create-react-app`)ã€‚

# **å†ç»™ npm ä¸€æ¬¡æœºä¼šã€‚**

å®ƒå¾ˆå¿«ã€‚è¿™æ˜¯ä¹…ç»è€ƒéªŒçš„ã€‚å®ƒå®šæœŸæ›´æ–°ã€‚å®ƒæ‹¥æœ‰å¤šå¹´çš„ç¤¾åŒºæ”¯æŒå’Œå·¥å…·(å¦‚ [nvm](https://github.com/creationix/nvm) ã€ [n](https://github.com/tj/n) å’Œä¸Šé¢çš„ shell è‡ªåŠ¨å®Œæˆ)ã€‚åƒ [Lerna](https://github.com/lerna/lerna) å’Œ [npm-check](https://github.com/dylang/npm-check) è¿™æ ·çš„æµè¡Œæ¨¡å—å®ç°äº† Yarn çš„é¢å¤–åŠŸèƒ½ã€‚

å¦‚æœæ‚¨æ­£åœ¨ç¼–å†™ javascriptï¼Œé‚£ä¹ˆæ‚¨å·²ç»å®‰è£…äº† npmã€‚ç®€åŒ–ä½ çš„å¼€å‘å·¥å…·ï¼Œå†æ¬¡ä½¿ç”¨ npmã€‚å¦‚æœä½ é”™è¿‡äº†çº±ï¼Œè®©æˆ‘çŸ¥é“ä¸ºä»€ä¹ˆåœ¨ä¸‹é¢çš„è¯„è®ºï¼

# JavaScript æ˜¯ä¸å¯èƒ½è·Ÿä¸Šçš„ã€‚

ä½ æŠ“ä½äº†æ¯ä¸€ä¸ªæœºä¼šã€‚æ»šåŠ¨â€¦é˜…è¯»â€¦åˆ·æ–°â€¦ç•¥è¯»ã€‚ä½ è¿·å¤±åœ¨æ–‡ç« ã€æ•™ç¨‹å’Œ GitHub repos çš„ 42 ä¸ªæµè§ˆå™¨æ ‡ç­¾ä¸­ã€‚ä½ å¯ä»¥æ”¶è—ä¸€æŠŠï¼Œä»¥åå†çœ‹(æˆ–è€…ï¼Œæ°¸è¿œä¸çœ‹)ã€‚

**åŠ¿ä¸å¯æŒ¡ã€‚è¦çŸ¥é“çš„å¤ªå¤šäº†ã€‚**

å› æ­¤ï¼Œæˆ‘å¼€å‘äº†ä¸€ä¸ªç³»ç»Ÿï¼Œå¯ä»¥è½»æ¾åœ°è®©æˆ‘äº†è§£æœ€æ–°æƒ…å†µã€‚