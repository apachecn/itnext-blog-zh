# Nx + Nest + Firebase =æ¢¦æƒ³

> åŸæ–‡ï¼š<https://itnext.io/nx-nest-firebase-the-dream-616e8ee71920?source=collection_archive---------1----------------------->

![](img/fd4382400c590c88146589ec49c4c844.png)

æˆ‘ä½¿ç”¨ Nrwl.io Nx è¿›è¡Œ Angular å¼€å‘å·²ç»è¶…è¿‡ 3 å¹´äº†ï¼Œæˆ‘å–œæ¬¢åœ¨ä¸€ä¸ª Monorepo ä¸­æ‹¥æœ‰å¤šä¸ªåº”ç”¨ç¨‹åºå’Œåº“çš„å¼€å‘è€…ä½“éªŒã€‚

åœ¨æˆ‘æœ€è¿‘çš„å¼€å‘ä¸­ï¼Œæˆ‘å¼€å§‹ä½¿ç”¨ Firebaseï¼Œå¹¶å¯¹ä½¿ç”¨ä¸»å·¥ä½œåŒºä¸‹çš„å­ç›®å½•è®¾ç½® Firebase å‡½æ•°çš„æ–¹å¼è¶Šæ¥è¶Šå¤±æœ›ã€‚è¿™ä¸ Nx åº”ç”¨ç¨‹åºå’Œ libs å¼€å‘ä¸ä¸€è‡´ï¼Œå› ä¸º Firebase å‡½æ•°ä½äºä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶å¤¹ä¸‹ï¼Œæœ‰è‡ªå·±çš„ *package.json* å’Œ *node_modules* å®‰è£…ã€‚

è¿™ç»™åœ¨å‰ç«¯åº”ç”¨ç¨‹åºå’Œ firebase åç«¯ä¹‹é—´å…±äº«ä»£ç å¸¦æ¥äº†å¾ˆå¤šå›°éš¾ã€‚æˆ‘åœ¨ Firebase Functions æ–‡ä»¶å¤¹ä¸­ä½¿ç”¨æ‰‹å·¥åˆ¶ä½œçš„ *tsconfig.json* æ–‡ä»¶æ¥æä¾›å¼•ç”¨ Nx å·¥ä½œåŒºä¸­çš„å…¬å…±ä»£ç çš„èƒ½åŠ›ã€‚è¿™å¹¶æ²¡æœ‰æä¾›å¾ˆå¥½çš„å¼€å‘è€…ä½“éªŒã€‚æˆ‘æƒ³æˆ‘è¢« Nx çš„åŠŸèƒ½å® åäº†ã€‚

åœ¨é€šè¯»äº† Jeff Delaney ç­‰äººçš„æ— æ•°æ–‡ç« å’Œå„ç§ Github é—®é¢˜ä¹‹åï¼Œæˆ‘ç»ˆäºèƒ½å¤Ÿå°†æˆ‘çš„å¼€å‘äººå‘˜ä½“éªŒé—®é¢˜ç¼åˆåœ¨ä¸€èµ·ï¼Œå¹¶åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ç®€åŒ–æˆ‘çš„å¼€å‘ã€‚

è™½ç„¶è¿™å¯èƒ½ä¸æ˜¯æœ€ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æˆ‘è®¤ä¸ºå®ƒä¼šå¯¹ç¤¾åŒºæœ‰ç”¨ã€‚å¯ä»¥å†™ä¸€ä¸ªåŸç†å›¾æ¥è‡ªåŠ¨åŒ–è¿™ä¸ªæ‰‹åŠ¨è¿‡ç¨‹ã€‚

# åˆå§‹åŒ– Nx å·¥ä½œç©ºé—´

è®©æˆ‘ä»¬ä»ä½¿ç”¨ Nx workspace åˆ›å»ºä¸€ä¸ªæ–°çš„ coffee åº”ç”¨ç¨‹åºå¼€å§‹ï¼Œå‘½ä»¤å¦‚ä¸‹:

```
> npx create-nx-workspace@latest
```

åœ¨ä¸ºæˆ‘çš„ Angular æŒ‡å®šå„ç§é…ç½®é€‰é¡¹åï¼ŒNx å°†ä½¿ç”¨**åº”ç”¨**å’Œ**åº“**æ­å»ºä¸€ä¸ªå·¥ä½œç©ºé—´ã€‚

![](img/f0fd10518df86c103c37c3f9424a9688.png)

ä½¿ç”¨æ‚¨å–œæ¬¢çš„ IDE æ‰“å¼€æ–°ç”Ÿæˆçš„å·¥ä½œåŒºã€‚åœ¨ **apps** æ–‡ä»¶å¤¹ä¸‹ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸¤ä¸ªåº”ç”¨ç¨‹åºï¼Œ **coffee** åº”ç”¨ç¨‹åºå’Œ **coffee-e2e** ç”¨äºç«¯åˆ°ç«¯æµ‹è¯•ã€‚

![](img/b653efab79571abcde6a0d7b224e4f70.png)

> ä»¥ä¸‹æ‰€æœ‰å‘½ä»¤éƒ½å°†ä»å·¥ä½œåŒºçš„æ ¹ç›®å½•è¿è¡Œã€‚

# åµŒå¥—åº”ç”¨

## å®‰è£…åµŒå¥—æ’ä»¶

å°†åµŒå¥—æ’ä»¶å®‰è£…åˆ°å·¥ä½œåŒºå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®Œæˆ:

```
> npm install -D @nrwl/nest
```

## ç”ŸæˆåµŒå¥—åº”ç”¨ç¨‹åº

ç”Ÿæˆæ–°çš„åµŒå¥—åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®Œæˆ:

```
> nx generate [@nrwl/nest](http://twitter.com/nrwl/nest):application <nest-app>
```

ç¤ºä¾‹:

```
> nx generate [@nrwl/nest](http://twitter.com/nrwl/nest):application coffee-api
```

## æœåŠ¡åµŒå¥—åº”ç”¨ç¨‹åº

æ‚¨çš„åµŒå¥—åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤:

```
> nx serve coffee-api
```

![](img/92fccb2547e63a3e4d3a18f918b7f4c6.png)

nx æœåŠ¡å’–å•¡-api

Nx å°†æ„å»º API å¹¶æä¾›ç»™æŒ‡å®šçš„ç«¯å£ã€‚å¯¹ API çš„ä»»ä½•æ›´æ”¹éƒ½å°†å†æ¬¡è§¦å‘æ„å»ºè¿‡ç¨‹ã€‚

ç”Ÿæˆçš„åµŒå¥—åº”ç”¨ç¨‹åºæ–‡ä»¶ç»“æ„åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:

![](img/08cf8ab366f9c61e27f59f1ac8c52d85.png)

# é‡ç«åŠ›ç‚¹

ä¸‹ä¸€æ­¥æ˜¯å°† firebase åˆå§‹åŒ–åˆ°å·¥ä½œåŒºä¸­ï¼Œå¦‚æœæ‚¨çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆï¼Œè¯·è·³è¿‡è¿™ä¸€éƒ¨åˆ†ã€‚

## Firebase åˆå§‹åŒ–

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç¡®ä¿ Firebase å·¥å…·å·²åœ¨å…¨çƒèŒƒå›´å†…å®‰è£…:

```
> npm install -g firebase-tools@latest
```

ä¸‹ä¸€æ­¥æ˜¯å°† firebase åˆå§‹åŒ–åˆ°å½“å‰å·¥ä½œåŒºã€‚

```
> firebase init
```

é€‰æ‹© Firebase éƒ¨ç½²æ‰€éœ€çš„å„ç§é€‰é¡¹ï¼Œéœ€è¦ä¸º API è®¾ç½®**åŠŸèƒ½**ã€‚

![](img/18f0a8b593cdb1aac12b62543f265e11.png)

å®‰è£…é€‰ä»¶â€”åŠŸèƒ½æ˜¯å¿…éœ€çš„

é€‰æ‹©ä¸€ä¸ªç°æœ‰çš„ Firebase é¡¹ç›®æˆ–åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ã€‚

![](img/d4d0e3575c8a81c2c80cc0724a2641ed.png)

æ¥å—æ‰€æœ‰ Firebase é»˜è®¤å€¼æˆ–æ ¹æ®éœ€è¦è¿›è¡Œä¿®æ”¹ã€‚ç¡®ä¿é€‰æ‹© Typescript ä½œä¸ºäº‘å‡½æ•°çš„è¯­è¨€ï¼Œå¹¶ä¸”ä¸è¦**è€Œä¸æ˜¯**å®‰è£…ä¾èµ–é¡¹ã€‚

![](img/088732801031f8d0a54b1905ee74f056.png)

æŒ‡å®šè¦è®¾ç½®çš„æ¯ä¸ªä»¿çœŸå™¨ï¼Œç¡®ä¿é€‰æ‹©äº†**åŠŸèƒ½ä»¿çœŸå™¨**ã€‚

![](img/e7584cb2da1e80664c2f7ba3ca6f9721.png)

æ¥å—å„ç§ç«¯å£çš„æ‰€æœ‰ Firebase ä»¿çœŸå™¨é»˜è®¤å€¼ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœéœ€è¦ï¼Œå¯ä»¥åœ¨ä»¥åè¿›è¡Œæ›´æ”¹ã€‚

![](img/4627790eb10a2c9672f04879668ae674.png)

Firebase ç°åœ¨å®‰è£…åœ¨åä¸º **functions çš„å­ç›®å½•ä¸­ã€‚**

![](img/9a3b3df3f8c0d75d87249eff0b4a3055.png)

# å°†å·¢ç©´æ”¹é€ æˆç‡ƒçƒ§åŸºåœ°

è¦å°†å½“å‰çš„ Nest åº”ç”¨ç¨‹åºè½¬æ¢æˆ Firebase readyï¼Œéœ€è¦ä¸€ç‚¹äººå·¥å¹²é¢„ã€‚

æ‰€ä»¥è®©æˆ‘ä»¬å¼€å§‹å§â€¦

å°†å„ç§ Firebase ä¾èµ–é¡¹å®‰è£…åˆ°æ ¹å·¥ä½œåŒºä¸­ã€‚

```
> npm install firebase-admin firebase-functions
```

å°†å¼€å‘ä¾èµ–é¡¹å®‰è£…åˆ°å·¥ä½œç©ºé—´ä¸­ã€‚

```
> npm install -D firebase-functions-test
```

åœ¨åµŒå¥—åº”ç”¨ç¨‹åºçš„æ ¹æºæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª **package.json** ã€‚

![](img/e5819ab21d9af118ec18a5ffb133c816.png)

Nest App â€” package.json

æ¥ä¸‹æ¥æ˜¯ä¿®æ”¹å·¥ä½œåŒºæ ¹æ–‡ä»¶å¤¹ä¸­çš„ **angular.json** ã€‚æœç´¢æ‚¨çš„åº”ç”¨ç¨‹åºçš„åç§°ï¼Œåœ¨æœ¬ä¾‹ä¸­æˆ‘ä½¿ç”¨äº† **coffee-api** ã€‚

é…ç½®åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:

![](img/5c8285555c64d2a3b7c1b2b8a075092c.png)

æˆ‘ä»¬éœ€è¦ä¿®æ”¹ **nx serve** å‘½ä»¤çš„å½“å‰è¡Œä¸ºï¼Œå› ä¸ºå®ƒå°†æ„å»ºå’Œå¯åŠ¨åµŒå¥—åº”ç”¨ç¨‹åºå¹¶ç›‘å¬ä¼ å…¥çš„è¯·æ±‚ã€‚Firebase æ¨¡æ‹Ÿå™¨éœ€è¦ä¸ºæˆ‘ä»¬å¯åŠ¨å¼€å‘æœåŠ¡å™¨ã€‚

## æˆ‘ä»¬å¼€å§‹å§

å°† **build** é‡å‘½åä¸º **build-node** ï¼Œå¹¶åœ¨ architect ä¸‹æ·»åŠ å¦ä¸€ä¸ªåä¸º **build** çš„æ¡ç›®ï¼Œè¯¥æ¡ç›®å°†ä½¿ç”¨ **nx run** å‘½ä»¤ã€‚

![](img/9f97f355ce2c4363dfff0bcbb76dd393.png)

æ–°çš„**æ„å»º**å‘½ä»¤åªæ˜¯æ‰§è¡Œ**æ„å»ºèŠ‚ç‚¹ã€‚**è¿™ä¸ªæ›´æ–°æ”¹å˜äº† **serve** å‘½ä»¤çš„è¡Œä¸ºï¼Œåªæ˜¯æ„å»ºå¹¶è§‚å¯Ÿå˜åŒ–ã€‚

è®°ä½ **package.json** æ–‡ä»¶ï¼Œå®ƒéœ€è¦è¿›å…¥æ„å»ºè¾“å‡ºã€‚å°†æ¡ç›®æ·»åŠ åˆ°**èµ„äº§**æ–‡ä»¶å¤¹ï¼Œå¦‚ä¸‹æ‰€ç¤º:

![](img/6ffe63416b49f237c7049a34bcafd661.png)

åˆ é™¤å·¥ä½œåŒºæ ¹ç›®å½•ä¸­çš„ Firebase **functions** æ–‡ä»¶å¤¹ï¼Œå› ä¸ºä¸å†éœ€è¦å®ƒã€‚

æ›´æ–°åµŒå¥—åº”ç”¨ç¨‹åºå¼•å¯¼ä»¥å°† express server è¿æ¥åˆ° Firebase å‡½æ•°ã€‚

æœ€åæ›´æ–° **firebase.json** functions éƒ¨åˆ†ï¼Œåˆ é™¤**é¢„éƒ¨ç½²**ï¼Œå› ä¸º lint å’Œ build éƒ½æ˜¯é€šè¿‡ deploy å‘½ä»¤å®Œæˆçš„ï¼Œæ·»åŠ  **source** è®© firebase çŸ¥é“ç¼–è¯‘è¾“å‡ºçš„ä½ç½®ï¼Œæ·»åŠ **å¿½ç•¥**éƒ¨åˆ†ï¼Œè¿™æ · firebase å°±ä¸ä¼šæ‰“åŒ…è¿™äº›å†…å®¹è¿›è¡Œéƒ¨ç½²ã€‚ç¨åå°†è¯¦ç»†ä»‹ç»éƒ¨ç½²ã€‚

![](img/733d0a7e75f3a5d1fc0f3642331ba9ce.png)

## ç‚¹ç‡ƒå®ƒ

å¯åŠ¨ Nest åº”ç”¨ç¨‹åºæ¥è§‚å¯Ÿå˜åŒ–ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰“å¼€å‘½ä»¤æç¤ºç¬¦:

```
> nx serve coffee-api
```

![](img/86542fa6358cdc0be534da963fbc19b0.png)

å¯åŠ¨åï¼Œåœ¨å¦ä¸€ä¸ªå‘½ä»¤çª—å£ä¸­å¯åŠ¨ Firebase æ¨¡æ‹Ÿå™¨:

```
> firebase emulators:start --only functions --inspect-functions
```

> è¿™å¯ä»¥ä½œä¸ºä¸€ä¸ª **npm** è„šæœ¬æ·»åŠ 

![](img/bd1fc311b2cc546a5ea049c39063aa4c.png)

å¯åŠ¨ Firebase æ¨¡æ‹Ÿå™¨åï¼Œæ‚¨å°†åœ¨è¾“å‡ºä¸­çœ‹åˆ°ç”¨äºè¿›è¡Œ Http è°ƒç”¨çš„ API ç«¯ç‚¹ï¼Œä»¥åŠå¯ç”¨äºæ£€æŸ¥æ—¥å¿—çš„æ¨¡æ‹Ÿå™¨çŠ¶æ€ç«¯ç‚¹ã€‚

## å®‰è£…è°ƒè¯•

ä¸ºæ­£åœ¨è¿è¡Œçš„ Nest åº”ç”¨ç¨‹åºé…ç½®è°ƒè¯•å™¨:

1.  ç‚¹å‡»èœå•ä¸­çš„**è¿è¡Œ**
2.  ç‚¹å‡»**åˆ›å»ºä¸€ä¸ª launch.json æ–‡ä»¶**
3.  ä»ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹© **Node.js** ã€‚

![](img/c5f452c158a62727ee746ebf2bf9d703.png)

æŒ‰ç…§ä»¥ä¸‹æ–¹å¼ä¿®æ”¹é…ç½®ã€‚

è¿™ä¸ªå¯åŠ¨é…ç½®å°†ä½¿ç”¨é»˜è®¤ç«¯å£ 9229 è¿æ¥åˆ°æ­£åœ¨è¿è¡Œçš„ Firebase æ¨¡æ‹Ÿå™¨ã€‚éœ€è¦ç¡®ä¿ **outFiles** æŒ‡å‘åµŒå¥—åº”ç”¨ç¨‹åºçš„æ„å»ºè¾“å‡ºã€‚æ·»åŠ  **skipFiles** å¾ˆé‡è¦ï¼Œå› ä¸ºè¿™ä¼šåŠ é€Ÿè°ƒè¯•æ–­ç‚¹çš„è¿æ¥ã€‚

# éƒ¨ç½²åˆ°ç«åŠ›åŸºåœ°

å¦‚æœæ‚¨å¸Œæœ›ç®€åŒ– Firebase å‡½æ•°çš„æ„å»ºå’Œéƒ¨ç½²ï¼Œæ‚¨å¯ä»¥å‘ **angular.json** æ–‡ä»¶æ·»åŠ é¢å¤–çš„å‘½ä»¤ã€‚

**deploy** å‘½ä»¤å°†é¦–å…ˆè°ƒç”¨ API çš„ buildï¼Œç„¶åè°ƒç”¨ firebase deployï¼Œåªå°†åŠŸèƒ½éƒ¨ç½²åˆ° firebaseã€‚

![](img/0af0aafecadd3a8a20bc086357eae54a.png)

Nx éƒ¨ç½²å‘½ä»¤

è®©æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹éƒ¨ç½²ã€‚

```
> nx deploy coffee-api
```

![](img/76215c939f8d0d6ec61f37e6bccdb210.png)

éƒ¨ç½²åˆ° Firebase åŠŸèƒ½

# æ‘˜è¦

æˆ‘ä½¿ç”¨ Nx-Nest-Firebase çš„è¿™ä¸ªè®¾ç½®å·²ç»å¿« 2 ä¸ªæœˆäº†ï¼Œæˆ‘å–œæ¬¢è¿™ç§å¼€å‘è€…ä½“éªŒã€‚

æˆ‘å¸Œæœ›è¿™èƒ½å¯¹ç¤¾åŒºæœ‰æ‰€å¸®åŠ©ã€‚

è¿™é‡Œä½¿ç”¨çš„å®Œæ•´æºä»£ç å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°:

[](https://github.com/codethatstack/nest-firebase) [## codethatstack/nest-firebase

### è¿™ä¸ªé¡¹ç›®æ˜¯ç”¨ Nx ç”Ÿæˆçš„ã€‚ğŸ”Nx æ˜¯ä¸€å¥—ç”¨äº Monorepos çš„å¯æ‰©å±•å¼€å‘å·¥å…·ã€‚Nx æ–‡æ¡£ 10 åˆ†é’Ÿâ€¦

github.com](https://github.com/codethatstack/nest-firebase) 

# å‚è€ƒ

å¯å‘äº†è¿™ç¯‡æ–‡ç« çš„å„ç§å‚è€ƒç‚¹ã€‚

[](https://fireship.io/snippets/setup-nestjs-on-cloud-functions/) [## åœ¨äº‘å‡½æ•°ä¸Šè®¾ç½®åµŒå¥—

### åœ¨ Firebase äº‘å‡½æ•°ä¸Šè¿è¡Œ NestJS çš„æ­¥éª¤ã€‚åˆ›å»ºæ—¶é—´æœ€åæ›´æ–°æ—¶é—´ä¸‹é¢çš„ä»£ç ç‰‡æ®µæ¼”ç¤ºäº†ä¸¤ä¸ªâ€¦

ç«èˆ¹. io](https://fireship.io/snippets/setup-nestjs-on-cloud-functions/) [](https://github.com/nrwl/nx/issues/836) [## å…è®¸å¼€å‘ Firebase äº‘å‡½æ•°é—®é¢˜#836 nrwl/nx

### äº‘åŠŸèƒ½æ˜¯å¼€å‘åŸºäºå¾®æœåŠ¡çš„åç«¯çš„å¥½æ–¹æ³•ã€‚å°±åƒèŠ‚ç‚¹åç«¯ä¸€æ ·ï¼Œè¿™å¾ˆå¸¸è§â€¦

github.com](https://github.com/nrwl/nx/issues/836) [](https://github.com/nrwl/nx/issues/1175) [## å¦‚ä½•ä½¿ç”¨ vscode é…ç½®å’Œè°ƒè¯• NestJSï¼Ÿé—®é¢˜#1175 nrwl/nx

### æˆ‘æ­£åœ¨åŠªåŠ›ä½¿ç”¨ vscode è¿›è¡Œè°ƒè¯•(ä½¿ç”¨æ–­ç‚¹å’Œæ£€æŸ¥åº”ç”¨ç¨‹åºæµ)ã€‚æœ‰äººèƒ½åˆ†äº«æˆ‘å¦‚ä½•â€¦

github.com](https://github.com/nrwl/nx/issues/1175) [](https://stackoverflow.com/questions/61671958/how-do-you-add-firebase-firestore-to-an-existing-nestjs-app-inside-of-a-nrwl-mon) [## å¦‚ä½•å°† Firebase/Firestore æ·»åŠ åˆ° NRWL monorepo ä¸­ç°æœ‰çš„ NestJS åº”ç”¨ç¨‹åºä¸­ï¼Ÿ

### æ­¥éª¤ 1 -åˆ›å»º Nest App NX generate @ nrwl/Nest:App myapp æ­¥éª¤ 2 -æ·»åŠ å‡½æ•°(ä¸åœ¨ apps æ–‡ä»¶å¤¹å†…)ã€‚npmâ€¦

stackoverflow.com](https://stackoverflow.com/questions/61671958/how-do-you-add-firebase-firestore-to-an-existing-nestjs-app-inside-of-a-nrwl-mon)  [## Nx Nrwl Firebase å‡½æ•°

### è‡ªä» Nrwl å‘å¸ƒäº†å¯¹èŠ‚ç‚¹åº”ç”¨ç¨‹åºçš„æ”¯æŒåï¼Œæˆ‘ä¸€ç›´åœ¨æœŸå¾… Firebase å‡½æ•°ã€‚æˆ‘ç”šè‡³åˆ›é€ äº†â€¦

medium.com](https://medium.com/mean-fire/nx-nrwl-firebase-functions-98f96f514055)