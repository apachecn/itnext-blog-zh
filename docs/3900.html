<html>
<head>
<title>Spring Boot Development in Kubernetes for Lazy Developers (like me)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">åœ¨Kubernetesä¸ºæ‡’æƒ°çš„å¼€å‘äººå‘˜(åƒæˆ‘ä¸€æ ·)Spring Bootå¼€å‘</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/spring-boot-development-in-kubernetes-for-lazy-developers-like-me-bb6e7b08f13f?source=collection_archive---------1-----------------------#2020-03-22">https://itnext.io/spring-boot-development-in-kubernetes-for-lazy-developers-like-me-bb6e7b08f13f?source=collection_archive---------1-----------------------#2020-03-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="7244" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ç¦»å¼€Spring Bootç¤¾åŒºæœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œæ‰€ä»¥æˆ‘å†³å®šæŸ¥çœ‹ä¸€äº›æ ·æœ¬ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆæ–°çš„ä¸œè¥¿ï¼Œä»¥ä¸‹æ˜¯æˆ‘çš„å‘ç°ã€‚</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/787c6dd149f598e7ba2f095831b161a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VQ2nyg-bH4nGdT0Y"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">ç…§ç‰‡ç”±<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šçš„<a class="ae lb" href="https://unsplash.com/@ihor_dvoretskyi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Ihor Dvoretskyi </a>æ‹æ‘„</figcaption></figure></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><p id="54da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å½“æˆ‘ä½¿ç”¨<a class="ae lb" href="https://start.spring.io/" rel="noopener ugc nofollow" target="_blank"> Spring Initializr </a>åˆ›å»ºæˆ‘çš„é¡¹ç›®æ—¶ï¼Œæˆ‘æƒ³å°è¯•ä¸€äº›æˆ‘ä»¥å‰ä»æœªä½¿ç”¨è¿‡Spring Bootçš„é›†æˆï¼Œæ¯”å¦‚<a class="ae lb" href="https://spring.io/guides/gs/messaging-gcp-pubsub/" rel="noopener ugc nofollow" target="_blank"> Google PubSub </a>æˆ–<a class="ae lb" href="https://flywaydb.org/documentation/plugins/springboot" rel="noopener ugc nofollow" target="_blank"> Flyway </a>ã€‚æˆ‘è¿˜æ·»åŠ äº†Postgreså’Œ<a class="ae lb" href="https://www.jooq.org/" rel="noopener ugc nofollow" target="_blank"> Jooq </a>ä½œä¸ºä¾èµ–é¡¹ã€‚</p><p id="fd44" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ‰€ä»¥æ€»çš„æ¥è¯´ï¼Œæˆ‘æœ‰ä¸¤ä¸ªä¾èµ–é¡¹:PubSubå’ŒPostgresï¼Œè¿™æ„å‘³ç€æˆ‘éœ€è¦åœ¨æœ¬åœ°è¿è¡Œå®ƒä»¬æ¥æµ‹è¯•é›†æˆã€‚</p><h1 id="64d3" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">å…¬å…±è®¢é˜…</h1><p id="072b" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">æˆ‘çŸ¥é“åœ¨æœ¬åœ°è¿è¡ŒPubSubçš„ä¸‰ä¸ªé€‰é¡¹:</p><ul class=""><li id="762c" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk mr ms mt mu bi translated">è¿è¡Œ<a class="ae lb" href="https://cloud.google.com/pubsub/docs/emulator" rel="noopener ugc nofollow" target="_blank"> gcloud PubSubä»¿çœŸå™¨</a>ã€‚ç„¶åæ‰‹åŠ¨åˆ›å»ºæ‚¨éœ€è¦çš„æ‰€æœ‰ä¸»é¢˜å’Œè®¢é˜…</li></ul><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="95c3" class="na lk iq mw b gy nb nc l nd ne">gcloud components install pubsub-emulator<br/>...<br/>gcloud beta emulators pubsub start --project=PUBSUB_PROJECT_ID</span></pre><ul class=""><li id="e2e9" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk mr ms mt mu bi translated">è¿è¡Œä¸€ä¸ª<a class="ae lb" href="https://github.com/marcelcorso/gcloud-pubsub-emulator" rel="noopener ugc nofollow" target="_blank">å®¹å™¨åŒ–çš„PubSubæ¨¡æ‹Ÿå™¨</a>ã€‚æ‚¨å¯ä»¥å°†ä¸»é¢˜å’Œè®¢é˜…ä½œä¸ºç¯å¢ƒå˜é‡ä¼ é€’ï¼Œå®ƒä»¬å°†åœ¨å®¹å™¨å¯åŠ¨æ—¶åˆ›å»ºã€‚</li></ul><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="e26e" class="na lk iq mw b gy nb nc l nd ne">docker run --rm -ti -p 8681:8681 messagebird/gcloud-pubsub-emulator:latest</span></pre><ul class=""><li id="8176" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk mr ms mt mu bi translated">åœ¨Kubernetes ä¸­è¿è¡Œ<a class="ae lb" href="https://github.com/arielsegura/spring-boot-skaffold-example/tree/master/kubernetes/pubsub" rel="noopener ugc nofollow" target="_blank"> PubSubä»¿çœŸå™¨ã€‚å®ƒä½¿ç”¨å®¹å™¨åŒ–çš„PubSubæ¨¡æ‹Ÿå™¨ï¼Œå¹¶è¢«åŒ…è£…åœ¨ä¸€ä¸ªKubernetesæœåŠ¡ä¸­ï¼Œè¿™æ ·æ›´å®¹æ˜“ä½¿ç”¨ã€‚</a></li></ul><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="3d51" class="na lk iq mw b gy nb nc l nd ne">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: pubsub<br/>  labels:<br/>    app: pubsub<br/>spec:<br/>  replicas: 1<br/>  selector:<br/>    matchLabels:<br/>      app: pubsub<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: pubsub<br/>    spec:<br/>      containers:<br/>        - name: pubsub<br/>          image: messagebird/gcloud-pubsub-emulator:latest<br/>          env:<br/>          - name: PUBSUB_PROJECT1<br/>            value: "PROJECTID,TOPIC1:SUBSCRIPTION1,TOPIC2:SUBSCRIPTION2"<br/>          ports:<br/>            - containerPort: 8681</span></pre><p id="cd9b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æœåŠ¡æ˜¯è¿™æ ·çš„:</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="5d99" class="na lk iq mw b gy nb nc l nd ne">apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: pubsub<br/>  labels:<br/>    app: pubsub<br/>spec:<br/>  externalName: pubsub<br/>  type: NodePort<br/>  ports:<br/>    - name: pubsub<br/>      port: 8681<br/>      nodePort: 30100<br/>  selector:<br/>    app: pubsub</span></pre><h1 id="74ce" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">Postgres</h1><p id="6c7d" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">æˆ‘ä¼šæåˆ°<strong class="jp ir">è‡³å°‘</strong>åœ¨æœ¬åœ°è¿è¡ŒPubSubçš„ä¸‰ä¸ªé€‰é¡¹:</p><ul class=""><li id="76ca" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk mr ms mt mu bi translated">è€æ´¾:å®‰è£…Postgresâ€”â€”è°·æ­Œæ€ä¹ˆåšï¼Œæœ‰ä¸€ä¸ªå®‰è£…ç¨‹åºã€‚</li><li id="8c20" class="mm mn iq jp b jq nf ju ng jy nh kc ni kg nj kk mr ms mt mu bi translated">è¿è¡Œä¸€ä¸ª<a class="ae lb" href="https://hub.docker.com/_/postgres" rel="noopener ugc nofollow" target="_blank">å®¹å™¨åŒ–çš„Postgreså®ä¾‹</a>:</li></ul><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="3081" class="na lk iq mw b gy nb nc l nd ne">docker run --name some-postgres -e POSTGRES_PASSWORD=mysecretpassword -d postgres</span></pre><ul class=""><li id="3f7f" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk mr ms mt mu bi translated">åœ¨Kubernetesä¸­è¿è¡Œ<a class="ae lb" href="https://github.com/arielsegura/spring-boot-skaffold-example/tree/master/kubernetes/postgres" rel="noopener ugc nofollow" target="_blank">Postgres</a>:è¿™ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œå› ä¸ºæˆ‘ä¸æƒ³è®©æˆ‘çš„æ•°æ®åº“åœ¨é‡å¯podæ—¶ä¸¢å¤±æ‰€æœ‰æ•°æ®ï¼Œå¯¹å—ï¼Ÿè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘éœ€è¦å®šä¹‰ä¸€ä¸ªå·å’Œå­˜å‚¨ã€‚</li></ul><h1 id="1633" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">ä¸ºä»€ä¹ˆæ˜¯Kubernetesï¼Ÿ</h1><p id="cdb7" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">åœ¨Nä¸ªç»ˆç«¯ä¸­è¿è¡ŒNä¸ªä¸åŒçš„å®¹å™¨åŠå…¶IPå’Œç«¯å£ï¼Œå¹¶ç¡®ä¿å®ƒä»¬éƒ½æŒ‡å‘æ­£ç¡®çš„åœ°å€å’Œç«¯å£ï¼Œè¿™å®åœ¨æ˜¯å¤ªç—›è‹¦äº†ã€‚<strong class="jp ir">è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘å†³å®šé€‰æ‹©Kubernetes </strong>è€Œä¸æ˜¯Docker:å½“ä½ åœ¨Kubernetesä¸­éƒ¨ç½²æ—¶ï¼Œä½ å¯ä»¥è®¿é—®å†…ç½®çš„DNSæœåŠ¡æˆ–ç¯å¢ƒå˜é‡ï¼ŒåŒ…æ‹¬ä½ éƒ¨ç½²çš„æ‰€æœ‰æœåŠ¡çš„åœ°å€å’Œç«¯å£ã€‚</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="8e5e" class="lj lk iq bd ll lm nk lo lp lq nl ls lt lu nm lw lx ly nn ma mb mc no me mf mg bi translated">æ–¯å¡ç¦å¾·</h1><p id="1c1b" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">ç°åœ¨æˆ‘æœ‰äº†Kubernetesä¸­çš„æ‰€æœ‰æœåŠ¡ï¼Œæˆ‘å¾ˆæ‡’ï¼Œæˆ‘ä¸æƒ³ä¸€ç›´åº”ç”¨å¤šä¸ªKubernetesæ–‡ä»¶ï¼Œå¹¶ç¡®ä¿æˆ‘æ¸…ç†äº†ç¯å¢ƒ(åˆ é™¤éƒ¨ç½²ï¼Œç­‰ç­‰)ã€‚)ç­‰æˆ‘åšå®Œäº†ã€‚</p><p id="c072" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä¸çŸ¥é“æˆ‘æ˜¯æ€ä¹ˆæ‰¾åˆ°<a class="ae lb" href="https://skaffold.dev/" rel="noopener ugc nofollow" target="_blank"> Skaffold </a>çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„å·¥å…·ï¼Œç”±è°·æ­Œå¼€å‘ï¼Œå®é™…ä¸Šä¸ºæˆ‘è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</p><p id="0651" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æœ‰ä¸¤ç§ä½¿ç”¨æƒ…å½¢:</p><p id="bb0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">1)ä½¿ç”¨çƒ­é‡è½½åœ¨Kubernetesä¸­æœ¬åœ°å¼€å‘æ‚¨çš„æœåŠ¡:æ‚¨åšå‡ºä¸€ä¸ªæ›´æ”¹ï¼ŒSkaffoldå°†åœ¨æ‚¨çš„é›†ç¾¤ä¸­åº”ç”¨ç›¸åº”çš„æ›´æ”¹</p><p id="97be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2)åœ¨prodä¸­éƒ¨ç½²æ‚¨çš„æ›´æ”¹:åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒSkaffoldä½œä¸ºç®¡é“å·¥ä½œï¼Œæ‚¨å¯ä»¥åœ¨è¿œç¨‹é›†ç¾¤ä¸­éƒ¨ç½²æ‚¨çš„æ›´æ”¹</p><p id="ed0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘å°†é‡ç‚¹æ”¾åœ¨ç¬¬ä¸€ä¸ªç”¨ä¾‹ä¸Šï¼Œå› ä¸ºæˆ‘æ²¡æœ‰ä»»ä½•ä¸œè¥¿å¯ä»¥åœ¨ç”Ÿäº§ä¸­éƒ¨ç½²ğŸ˜…</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="dcb7" class="lj lk iq bd ll lm nk lo lp lq nl ls lt lu nm lw lx ly nn ma mb mc no me mf mg bi translated">åˆä¸€ä¸ªä½¿ç”¨YAMLçš„DSL</h1><p id="4649" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">æˆ‘è®¤ä¸ºSkaffoldä½¿ç”¨YAMLè¿›è¡Œé…ç½®æ˜¯æœ‰é“ç†çš„ï¼Œå› ä¸ºKubernetesä¸­çš„å¤§å¤šæ•°é…ç½®æ–‡ä»¶ä¹Ÿæ˜¯åŸºäºYAMLçš„ã€‚</p><p id="ba37" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ–¯å¡ç¦å¾·é…ç½®çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="1f8f" class="na lk iq mw b gy nb nc l nd ne">apiVersion: skaffold/v2alpha3<br/>kind: Config<br/>deploy:<br/>  kubectl:<br/>    manifests:<br/>      - kubernetes/postgres/**<br/>      - kubernetes/pubsub/**</span></pre><p id="7a22" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Skaffoldè¦åšçš„æ˜¯åº”ç”¨è¿™ä¸¤ä¸ªç›®å½•ä¸­çš„æ‰€æœ‰Kubernetesæ–‡ä»¶ã€‚ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦åœ¨ç»ˆç«¯<code class="fe np nq nr mw b">skaffold dev</code>ä¸­è¿è¡Œï¼Œå½“æ‚¨å–æ¶ˆè¯¥è¿›ç¨‹æ—¶ï¼Œæ‰€æœ‰èµ„æºéƒ½å°†è¢«åˆ é™¤ã€‚</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="7c8b" class="lj lk iq bd ll lm nk lo lp lq nl ls lt lu nm lw lx ly nn ma mb mc no me mf mg bi translated">Skaffoldå¯¹IntelliJçš„æ”¯æŒ</h1><p id="8efa" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">ç°åœ¨æ˜¯æ—¶å€™ä¸€é”®æå®šäº†ï¼æœ‰ä¸€ä¸ªåä¸º<a class="ae lb" href="https://plugins.jetbrains.com/plugin/8079-cloud-code" rel="noopener ugc nofollow" target="_blank"> <em class="ns">äº‘ä»£ç </em> </a>çš„IntelliJæ’ä»¶ï¼Œå®ƒå…è®¸ä½ 1)ç®¡ç†ä½ çš„Kubernetesèµ„æºå’Œ2)ä»Skaffoldæ–‡ä»¶è¿è¡Œä½ çš„Kubernetesé…ç½®ã€‚</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nt"><img src="../Images/8aa4c5ee0eb1997771e7427f33c07e5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wpS307yKVelfzXsdRivuwA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">IntelliJä¸Šçš„Kubernetesèµ„æºæµè§ˆå™¨</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nu"><img src="../Images/e50220433b7cf7a0e762fce99ddb10f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q1-oOd0sEoBaKy6CGogpMw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">IntelliJä¸Šçš„Skaffoldè¿è¡Œé…ç½®</figcaption></figure><p id="f274" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä¸€æ—¦æ‚¨åˆ›å»ºäº†IntelliJ Cloud Code Kubernetesé…ç½®ï¼Œå½“æ‚¨è¿è¡Œå®ƒæ—¶ï¼Œæ‚¨å°†ä¼šçœ‹åˆ°å¦‚ä¸‹å†…å®¹:</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="0918" class="na lk iq mw b gy nb nc l nd ne">Listing files to watch...<br/>Generating tags...<br/>Checking cache...<br/>Tags used in deployment:<br/>Starting deploy...<br/> - serviceaccount/admin-user created<br/> - configmap/postgres-config created<br/> - deployment.extensions/postgres created<br/> - service/postgres created<br/> - persistentvolume/postgres-pv-volume created<br/> - persistentvolumeclaim/postgres-pv-claim created<br/> - deployment.apps/pubsub created<br/> - service/pubsub created<br/>Port forwarding service/postgres in namespace default, remote port 5432 -&gt; address 127.0.0.1 port 5432<br/>Port forwarding service/pubsub in namespace default, remote port 8681 -&gt; address 127.0.0.1 port 8681</span></pre><p id="bd17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¦‚æœä½ æ”¹å˜äº†ä¸€äº›ä¸œè¥¿ï¼Œæ¯”å¦‚æ•°æ®åº“åç§°ã€å‘å¸ƒä¸»é¢˜ã€ç«¯å£ç­‰ç­‰ã€‚åªéœ€ä½¿ç”¨redeployæŒ‰é’®ç”¨IntelliJé‡æ–°éƒ¨ç½²ï¼Œæ‚¨å°†çœ‹åˆ°æ‰€æœ‰åº”ç”¨çš„æ›´æ”¹ã€‚å®Œæˆåï¼Œåœæ­¢è¿è¡Œï¼Œæ–¯å¡ç¦å¾·å°†ä¸ºæ‚¨æ¸…ç†æ‰€æœ‰Kubernetesèµ„æº:</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="888f" class="na lk iq mw b gy nb nc l nd ne">Watching for changes...<br/>Cleaning up...<br/> - serviceaccount "admin-user" deleted<br/> - configmap "postgres-config" deleted<br/> - deployment.extensions "postgres" deleted<br/> - service "postgres" deleted<br/> - persistentvolume "postgres-pv-volume" deleted<br/> - persistentvolumeclaim "postgres-pv-claim" deleted<br/> - deployment.apps "pubsub" deleted<br/> - service "pubsub" deleted</span></pre></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="379f" class="lj lk iq bd ll lm nk lo lp lq nl ls lt lu nm lw lx ly nn ma mb mc no me mf mg bi translated">åˆ©ç”¨ä½ åœ¨Spring Bootçš„Kubernetesèµ„æº</h1><p id="fb22" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">è¿™å°±æ˜¯ä¸€åˆ‡å¦‚ä½•å¼€å§‹ï¼Œè¯•å›¾åœ¨Spring Bootä½¿ç”¨PubSubå’ŒFlywayï¼æ‰€ä»¥è®©æˆ‘ä»¬ç»§ç»­ã€‚</p><p id="3745" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ­£å¦‚æˆ‘ä¹‹å‰è¯´è¿‡çš„ï¼ŒKubernetesä¸­å·²ç»æœ‰ä¸€ä¸ªå†…ç½®çš„DNSï¼Œæ‰€ä»¥ä¸ºäº†åœ¨Kubernetesä¸­éƒ¨ç½²ï¼Œè¿™ä¸ªSpring Bootå±æ€§æ–‡ä»¶å°±è¶³å¤Ÿäº†:</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="bb1a" class="na lk iq mw b gy nb nc l nd ne"># https://kubernetes.io/docs/concepts/services-networking/connect-applications-service/#environment-variables<br/># DNS doesn't work for pubsub service for some reason<br/>spring.cloud.gcp.pubsub.emulatorHost: ${PUBSUB_SERVICE_HOST}:${PUBSUB_SERVICE_PORT}<br/>spring.cloud.gcp.pubsub.projectId: PROJECTID<br/>spring.datasource.url: jdbc:postgresql://postgres/postgresdb<br/>spring.datasource.username: postgresadmin<br/>spring.datasource.password: admin123<br/>spring.datasource.driverClassName: org.postgresql.Driver</span></pre><p id="3347" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¦‚æœæ‚¨æƒ³åœ¨æœ¬åœ°è°ƒè¯•æŸäº›ä¸œè¥¿ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦æŒ‡å‘æ‚¨åœ¨KubernetesæœåŠ¡ä¸­ä½¿ç”¨çš„ç«¯å£:</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="a09e" class="na lk iq mw b gy nb nc l nd ne">spring.cloud.gcp.pubsub.emulatorHost: localhost:30100<br/>spring.cloud.gcp.pubsub.projectId: PROJECTID<br/>spring.datasource.url: jdbc:postgresql://localhost:30000/postgresdb<br/>spring.datasource.username: postgresadmin<br/>spring.datasource.password: admin123<br/>spring.datasource.driverClassName: org.postgresql.Driver</span></pre><p id="d050" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å›åˆ°<a class="ae lb" href="https://github.com/arielsegura/spring-boot-skaffold-example/blob/master/src/main/java/com/example/demo/DemoController.java" rel="noopener ugc nofollow" target="_blank">ç¤ºä¾‹</a>ï¼Œé€šè¿‡è¿è¡ŒSpring Bootåº”ç”¨ç¨‹åºï¼Œæ‚¨å¯ä»¥åœ¨æ—¥å¿—ä¸­çœ‹åˆ°å¦‚ä¸‹å†…å®¹:</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="b7a9" class="na lk iq mw b gy nb nc l nd ne">2020-03-20 13:03:17.291  INFO 58272 --- [  restartedMain] o.f.c.internal.license.VersionPrinter    : Flyway Community Edition 6.0.8 by Redgate<br/>2020-03-20 13:03:17.427  INFO 58272 --- [  restartedMain] o.f.c.internal.database.DatabaseFactory  : Database: jdbc:postgresql://localhost:30000/postgresdb (PostgreSQL 12.2)<br/>2020-03-20 13:03:17.468  INFO 58272 --- [  restartedMain] o.f.core.internal.command.DbValidate     : Successfully validated 2 migrations (execution time 00:00.022s)</span></pre><p id="18a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä¹Ÿå°±æ˜¯è¯´å¼—è±å¨è¢«å¤„å†³äº†ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨RESTç«¯ç‚¹æ¥å°è¯•åº”ç”¨ç¨‹åº:</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="c66e" class="na lk iq mw b gy nb nc l nd ne">curl localhost:8080/hello</span></pre><p id="1169" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ²¡æœ‰å“åº”æ­£æ–‡ï¼Œä½†æ˜¯åœ¨æ—¥å¿—ä¸­æ‚¨å¯ä»¥çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å†…å®¹:</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="239a" class="na lk iq mw b gy nb nc l nd ne">com.example.demo.DemoService: User id 1 username ariel com.example.demo.DemoService: User id 2 username alejandro com.example.demo.DemoService: Success! <br/>com.example.demo.DemoService: Success! <br/>com.example.demo.DemoService: 1-ariel</span></pre><p id="62bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">åœ¨è¿ç§»è„šæœ¬ä¸­ï¼Œæˆ‘æ’å…¥äº†ä¸€äº›è¡Œã€‚ç„¶ååœ¨DemoServiceä¸­ï¼Œæˆ‘æŸ¥è¯¢è¯¥è¡¨ï¼Œå¯¹äºæ¯ä¸€è¡Œï¼Œæˆ‘åœ¨æ—¥å¿—ä¸­æ‰“å°å®ƒå¹¶å‘å¸ƒä¸€æ¡PubSubæ¶ˆæ¯(å› æ­¤æœ‰ä¸¤æ¡æˆåŠŸæ¶ˆæ¯)ï¼Œæœ€åï¼Œæˆ‘è¯»å–PubSubè®¢é˜…ä¸­çš„ä¸‹ä¸€æ¡æ¶ˆæ¯ã€‚</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="c06e" class="lj lk iq bd ll lm nk lo lp lq nl ls lt lu nm lw lx ly nn ma mb mc no me mf mg bi translated">ç»“è®º</h1><p id="fede" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">åœ¨è¿™ç¯‡çŸ­æ–‡ä¸­ï¼Œæˆ‘å±•ç¤ºäº†Spring Bootã€Google PubSubã€Flywayå’ŒKubernetesä½¿ç”¨Skaffoldç®¡ç†éƒ¨ç½²çš„å®éªŒã€‚</p><p id="08a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¸Œæœ›ä½ è§‰å¾—æœ‰ç”¨ğŸ¤©<br/>åˆ«å¿˜äº†é¼“æŒï¼ğŸ‘</p><p id="6b15" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ns">æœ‰ç”¨é“¾æ¥:</em></p><div class="nv nw gp gr nx ny"><a href="https://github.com/GoogleContainerTools/jib/tree/master/examples/spring-boot" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd ir gy z fp od fr fs oe fu fw ip bi translated">è°·æ­Œé›†è£…ç®±å·¥å…·/ä¸‰è§’å¸†</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">è¿™æ˜¯ä¸€ä¸ªå¦‚ä½•ä½¿ç”¨Jibä¸ºSpring Bootåº”ç”¨ç¨‹åºè½»æ¾æ„å»ºDockeræ˜ åƒçš„ä¾‹å­ã€‚ä½ å¯ä»¥é›†è£…ç®±åŒ–â€¦</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">github.com</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om kv ny"/></div></div></a></div><div class="nv nw gp gr nx ny"><a href="https://github.com/GoogleContainerTools/skaffold/tree/master/examples/jib" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd ir gy z fp od fr fs oe fu fw ip bi translated">GoogleContainerTools/skaffold</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">Jibæ˜¯æ–¯å¡ç¦å¾·å—æ”¯æŒçš„å»ºç­‘å•†ä¹‹ä¸€ã€‚å®ƒä¸ºæ‚¨çš„Javaåº”ç”¨ç¨‹åºæ„å»ºDockerå’ŒOCIæ˜ åƒï¼Œå¹¶ä¸”â€¦</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">github.com</p></div></div><div class="oh l"><div class="on l oj ok ol oh om kv ny"/></div></div></a></div><div class="nv nw gp gr nx ny"><a href="https://medium.com/faun/skaffold-jib-for-running-java-applications-on-kubernetes-83e6896feede" rel="noopener follow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd ir gy z fp od fr fs oe fu fw ip bi translated">Skaffold &amp; Jibç”¨äºåœ¨Kubernetesä¸Šè¿è¡ŒJavaåº”ç”¨ç¨‹åº</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">å‡ å¤©å‰ï¼ŒSkaffoldå®£å¸ƒä»æµ‹è¯•ç‰ˆå‡çº§åˆ°æ­£å¼ç‰ˆï¼Œç°åœ¨æ˜¯æ—¶å€™å°è¯•ä¸€ä¸‹äº†â€¦</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">medium.com</p></div></div><div class="oh l"><div class="oo l oj ok ol oh om kv ny"/></div></div></a></div></div></div>    
</body>
</html>