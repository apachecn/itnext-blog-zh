<html>
<head>
<title>Building Your Home Raspberry PI Kubernetes Cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">æ„å»ºæ‚¨çš„å®¶åº­æ ‘è“PI Kubernetesé›†ç¾¤</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/building-your-home-raspberry-pi-kubernetes-cluster-14eeeb3c521e?source=collection_archive---------0-----------------------#2020-11-29">https://itnext.io/building-your-home-raspberry-pi-kubernetes-cluster-14eeeb3c521e?source=collection_archive---------0-----------------------#2020-11-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="ad25" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¿™é‡Œæœ‰Kubernetesçš„ç²‰ä¸å—ï¼Ÿæˆ‘åœ¨å·¥ä½œå’Œç§äººé¡¹ç›®ä¸­è¿è¡Œå®ƒå·²ç»æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œä½†æœ‰æ—¶æˆ‘éœ€è¦ä¸€ä¸ªåœ°æ–¹æ¥å¿«é€Ÿå¼€å‘å’Œæµ‹è¯•æ–°åŠŸèƒ½ï¼Œè€Œä¸ä¼šäº§ç”Ÿé¢å¤–çš„æˆæœ¬ï¼Œæˆ–è€…åªæ˜¯è¿è¡Œæˆ‘çš„å®¶åº­å¨±ä¹ã€å¤‡ä»½ã€æ–‡ä»¶å…±äº«å’Œkettleã€‚</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/e464e18b5ce07b2edc44dc5ec657d658.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FCtgSpjwj5R7BSAk99fibA.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">è¿˜æœ‰å‡ ä¸ªèŠ‚ç‚¹åœ¨è·¯ä¸Šï¼Œé›†ç¾¤å‡ ä¹å‡†å¤‡å¥½äº†ã€‚</figcaption></figure><h1 id="c840" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak">ä½¿ç”¨çš„ç¡¬ä»¶(é»‘è‰²æ˜ŸæœŸäº”ä»·æ ¼</strong> ğŸ¥³ <strong class="ak"> ) </strong></h1><ul class=""><li id="0b63" class="mc md it js b jt me jx mf kb mg kf mh kj mi kn mj mk ml mm bi translated"><a class="ae mn" href="https://www.amazon.co.uk/gp/product/B07TC2BK1X" rel="noopener ugc nofollow" target="_blank">å››ä¸ªè¦†ç›†å­é…±4B 4GB(æ¯ä¸ª50ä¸ª)</a></li><li id="6ada" class="mc md it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated"><a class="ae mn" href="https://www.amazon.co.uk/gp/product/B07FCMKK5X" rel="noopener ugc nofollow" target="_blank">å››å¼ 128 GB U3å­˜å‚¨å¡(æ¯å¼ 15å¼ )</a></li><li id="9f3b" class="mc md it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated"><a class="ae mn" href="https://www.amazon.co.uk/gp/product/B07MJ9ZMDM/" rel="noopener ugc nofollow" target="_blank">ä¸€ä¸ªå¤šUSBç”µæº(20 ) </a></li><li id="4901" class="mc md it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated"><a class="ae mn" href="https://www.amazon.co.uk/gp/product/B085ZJQMXF/" rel="noopener ugc nofollow" target="_blank">ä¸€ä¸ªæœºæ¶ç®±ç”¨äºå¤šä¸ªPi(15)</a></li><li id="0736" class="mc md it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated">å€¼å¾—ä¸€æçš„æ˜¯:æ•£çƒ­å™¨ã€4æ ¹USB-Bè½¬USB-Cç”µç¼†</li></ul><h1 id="c81e" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">ä¸ºä»€ä¹ˆæ˜¯æ ‘è“æ´¾ï¼Ÿ</h1><p id="731c" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">TLï¼›DR:æˆæœ¬ä¸å¤„ç†èƒ½åŠ›ã€‚</p><p id="38a5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">4èŠ‚ç‚¹ç¾¤é›†æä¾›4ä¸ª(1.5Ghzã€4æ ¸ARM cpuå’Œ4 GB RAM)ï¼Œå³16ä¸ª1.5 Ghzå†…æ ¸å’Œ16 GB RAMã€‚æˆ‘ç®—è¿‡äº†ï¼Œé›†ç¾¤çš„æ€»ä½“æˆæœ¬ä»ç„¶æ¯”ç±»ä¼¼çš„å¤„ç†èƒ½åŠ›/èŠ‚ç‚¹äº‘äº§å“ä¾¿å®œã€‚ä¸å¤šè¯´â€¦</p><h1 id="af20" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak">å­˜å‚¨å¡å‡†å¤‡</strong></h1><p id="8591" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">ä»ä¸‹è½½æ“ä½œç³»ç»Ÿå¼€å§‹ï¼Œå®ƒå°†å®Œæˆç¹é‡çš„å·¥ä½œã€‚æˆ‘æ¯å¤©å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨ä¸dockerå’ŒKubernetesä¸€èµ·å·¥ä½œï¼Œæˆ‘çš„ä»»ä½•ä¸€ä¸ªçˆ±å¥½éƒ½æ˜¯å°†dockerå›¾åƒç²¾ç®€åˆ°ç»å¯¹æœ€å°â€”â€”è¿™å¤§éƒ¨åˆ†æ˜¯ç”±äºAlpine Linuxå®ç°çš„â€”â€”å› æ­¤æˆ‘å°†æˆ‘çš„é›†ç¾¤åŸºäºè¿™ç§ç²¾ç¡®çš„åˆ†å¸ƒã€‚</p><p id="3489" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å‰å¾€<a class="ae mn" href="https://alpinelinux.org/downloads/" rel="noopener ugc nofollow" target="_blank"> Alpine Linuxä¸‹è½½</a>éƒ¨åˆ†ï¼Œä¸ºæ‚¨çš„Raspberry Pi 4 Model Bé€‰æ‹©AARCH64ç‰ˆæœ¬ã€‚</p><p id="3ac6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åŒæ—¶ï¼Œè®©æˆ‘ä»¬å‡†å¤‡å­˜å‚¨å¡ï¼Œé¦–å…ˆç”¨FAT32æ–‡ä»¶ç³»ç»Ÿæ ¼å¼åŒ–å®ƒã€‚æˆ‘æ˜¯OSXäººï¼Œæ‰€ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥è·å–ä½ çš„å­˜å‚¨å¡çš„ç£ç›˜æ ‡è¯†ç¬¦</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="9039" class="nb lf it mx b gy nc nd l ne nf">diskutil list</span></pre><p id="d20e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æŒ‰ç…§å®ƒæ¥æ ¼å¼åŒ–æ•´ä¸ªå†…å­˜å¡â€”â€”æˆ‘æŠŠæˆ‘çš„å†…å­˜å¡å«åš<strong class="js iu"> RPI </strong></p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="1e89" class="nb lf it mx b gy nc nd l ne nf">sudo diskutil eraseDisk FAT32 RPI MBRFormat /dev/diskX</span></pre><p id="e7f5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å°†ä¸‹è½½çš„Alpine linuxè½¯ä»¶åŒ…è§£å‹åˆ°å­˜å‚¨å¡ä¸Š</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="1035" class="nb lf it mx b gy nc nd l ne nf">sudo tar xf alpine-rpi-3.12.1-aarch64.tar.gz -C /Volumes/RPI</span></pre><h1 id="c495" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak">åŸºç¡€ç³»ç»Ÿé…ç½®</strong></h1><p id="ce47" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">æ­å–œä½ ï¼Œä½ ç¦»è‡ªå·±å®¢å…é‡Œçš„kubernetesä¸–ç•Œåˆè¿‘äº†ä¸€æ­¥ã€‚å°†å­˜å‚¨å¡æ»‘åŠ¨åˆ°æ‚¨çš„Raspberry Piã€æ˜¾ç¤ºå™¨(æˆ–ç”µè§†)ä»¥åŠé”®ç›˜ä¸­ï¼Œç„¶åæ‰“å¼€ç”µæºã€‚ç³»ç»Ÿå¯åŠ¨å¹¶è¦æ±‚æ‚¨ç™»å½•åï¼Œä½¿ç”¨<strong class="js iu"> root </strong>ä½œä¸ºç”¨æˆ·åå’Œå¯†ç ã€‚</p><p id="c09d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨è®¾ç½®è¿‡ç¨‹ã€‚</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="b2b6" class="nb lf it mx b gy nc nd l ne nf">setup-alpine</span></pre><p id="6afa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘åœ¨å®¶é‡Œè¿è¡Œæˆ‘çš„é›†ç¾¤ï¼Œç”±äºå¯ç”¨çš„è·¯ç”±å™¨ç«¯å£è¶Šæ¥è¶Šå°‘ï¼Œæˆ‘å†³å®šä½¿ç”¨WiFiç½‘ç»œã€‚ä½ å°†é€‰æ‹©çš„é€‰é¡¹æ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«â€”â€”ä½†æ˜¯è¦æ˜æ™ºåœ°é€‰æ‹©ã€‚</p><p id="6597" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å®Œæˆè®¾ç½®åï¼Œæ‚¨è¿˜éœ€è¦åšä¸€äº›äº‹æƒ…ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒAlpineä»RAMè¿è¡Œï¼Œä½†æ˜¯æˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„æ›´æ”¹åœ¨ç£ç›˜ä¸Šä»¥åŠæ½œåœ¨çš„é‡æ–°å¯åŠ¨ä¹‹é—´ä¿æŒä¸å˜ã€‚</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="10a7" class="nb lf it mx b gy nc nd l ne nf">apk update<br/>apk add cfdisk e2fsprogs # Install disk tools<br/>cfdisk /dev/mmcblk0      # Run cfdisk on your memory card</span></pre><p id="552b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨æ­¤æ­¥éª¤ä¸­ï¼Œæ‚¨éœ€è¦:</p><ul class=""><li id="5a8f" class="mc md it js b jt ju jx jy kb ng kf nh kj ni kn mj mk ml mm bi translated">å°†FAT32åˆ†åŒºçš„å¤§å°è°ƒæ•´åˆ°åˆç†çš„æœ€å°å€¼â€”â€”åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œæˆ‘ç»™äº†å®ƒ1GBã€‚</li><li id="bc7a" class="mc md it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated">ä½¿ç”¨æ‰€æœ‰å‰©ä½™çš„å¯ç”¨ç©ºé—´åˆ›å»ºæ–°çš„å¯å¼•å¯¼åˆ†åŒºã€‚</li><li id="7ee5" class="mc md it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated">åˆ«å¿˜äº†å†™ä¸‹ä½ åˆšåˆšåšçš„ä¿®æ”¹ã€‚</li></ul><p id="e443" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æœ‰ç”¨æ•™ç¨‹:<a class="ae mn" href="https://www.thegeekdiary.com/understanding-linux-cfdisk-utility/" rel="noopener ugc nofollow" target="_blank">å¦‚ä½•ä½¿ç”¨cfdiskï¼Ÿ</a></p><p id="87ea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç°åœ¨åªéœ€è¦æ‰§è¡Œå‡ ä¸ªå‘½ä»¤å°±å¯ä»¥å®Œæˆæ•´ä¸ªè¿‡ç¨‹ã€‚</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="3f36" class="nb lf it mx b gy nc nd l ne nf">mkfs.ext4 /dev/mmcblk0p2  # Format newly created partition as EXT4<br/>mount /dev/mmcblk0p2 /mnt # Mount it<br/>setup-disk -m sys /mnt    # Install system files<br/>mount -o remount,rw /media/mmcblk0p1 # Remount old partition in RW</span><span id="e96e" class="nb lf it mx b gy nj nd l ne nf"># Let's do some housekeeping <br/>rm -f /media/mmcblk0p1/boot/*  <br/>cd /mnt<br/>rm boot/boot<br/>mv boot/* /media/mmcblk0p1/boot/  <br/>rm -Rf boot<br/>mkdir media/mmcblk0p1<br/>ln -s media/mmcblk0p1/boot boot</span></pre><p id="e4ea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ›´æ–°<code class="fe nk nl nm mx b">/etc/fstab</code>è®°å½•</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="c3ab" class="nb lf it mx b gy nc nd l ne nf">echo "/dev/mmcblk0p1 /media/mmcblk0p1 vfat defaults 0 0" &gt;&gt; etc/fstab<br/>sed -i '/cdrom/d' etc/fstab<br/>sed -i '/floppy/d' etc/fstab<br/>cd /media/mmcblk0p1</span></pre><p id="4801" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç³»ç»Ÿé‡å¯åçš„æœ€åæ¥è§¦â€”è¯·è®°ä½ï¼Œå¦‚æœæ²¡æœ‰å¯ç”¨é€‚å½“çš„cgroupsï¼Œkubeadmæ­¥éª¤å°†ä¼šå¤±è´¥ã€‚</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="2e43" class="nb lf it mx b gy nc nd l ne nf"># Enable edge repository for Alpine <br/>sed -i '/edge/s/^#//' /mnt/etc/apk/repositories<br/># Force use of new partition as the root one<br/>sed -i 's/^/root=\/dev\/mmcblk0p2 /' /media/mmcblk0p1/cmdline.txt<br/># Make sure that appropriate cgroups are enabled<br/>echo "cgroup_enable=cpuset cgroup_enable=memory cgroup_memory=1" &gt;&gt; /media/mmcblk0p1/cmdline.txt<br/>sed -i ':a;N;$!ba;s/\n/ /g' /media/mmcblk0p1/cmdline.txt</span><span id="5164" class="nb lf it mx b gy nj nd l ne nf">rc-update add wpa_supplicant boot # Make sure your wifi will come back up after restart</span></pre><p id="cc81" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æœ€åï¼Œåœ¨å®Œæˆä¸Šè¿°æ‰€æœ‰æ­¥éª¤åï¼ŒçœŸæ­£é‡è¦çš„äº‹æƒ…æ˜¯å¤‡ä»½æ‚¨åˆšæ‰æ‰€åšçš„æ›´æ”¹å¹¶é‡å¯ç³»ç»Ÿ</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="3292" class="nb lf it mx b gy nc nd l ne nf">lbu_commit -d<br/>reboot</span></pre><h1 id="e239" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">ç³»ç»Ÿé…ç½®çš„å…¶ä½™éƒ¨åˆ†</h1><p id="1898" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">æˆ‘æåˆ°è¿‡ï¼Œæˆ‘æ‰“ç®—åœ¨å®¶åº­ç¯å¢ƒä¸­ä½¿ç”¨è¿™ä¸ªkubernetesé›†ç¾¤â€”â€”åœ¨ä½ é—®ä¹‹å‰â€”â€”å®ƒä¹Ÿå¯ä»¥åœ¨åŠå…¬å®¤ç½‘ç»œä¸­å·¥ä½œï¼Œå°½ç®¡â€”â€”æˆ‘ä»¬åº”è¯¥æ·»åŠ ä¸€äº›é¢å¤–çš„ä¸œè¥¿</p><p id="35a2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">åœ¨æœ¬åœ°ç½‘ç»œä¸­å®£å¸ƒä¸»æœºåâ€” avahiå®ˆæŠ¤è¿›ç¨‹</strong></p><p id="57e8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä¸ºä»€ä¹ˆæ˜¯è¿™ä¸€æ­¥ï¼Ÿä¸è¯•å›¾æ‰¾åˆ°æ­£ç¡®çš„IPåœ°å€ç›¸æ¯”ï¼Œ<code class="fe nk nl nm mx b">ssh pi0.local</code>è¦å®¹æ˜“å¾—å¤šã€‚å®ƒè¿˜å°†ä½¿æ‚¨çš„è¿æ¥å’Œé›†ç¾¤é…ç½®æ›´åŠ å®¹æ˜“ï¼Œå°¤å…¶æ˜¯å½“æ‚¨ä¸èƒ½ä¾èµ–é™æ€IPæ—¶ã€‚</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="69cd" class="nb lf it mx b gy nc nd l ne nf">apk add dbus avahi<br/>rc-update add dbus boot   # avahi won't start without dbus<br/>rc-update add avahi-daemon boot</span></pre><p id="3ff3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">å…è®¸sshä½œä¸ºæ ¹ç”¨æˆ·è®¿é—®</strong></p><p id="cb82" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç¼–è¾‘<code class="fe nk nl nm mx b">/etc/ssh/sshd_config</code>æ–‡ä»¶â€”â€”å‘å…¶ä¸­æ·»åŠ ä¸‹é¢ä¸€è¡Œï¼Œä»¥ä¾¿èƒ½å¤Ÿä»¥rootç”¨æˆ·èº«ä»½è®¿é—®sshã€‚</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="e137" class="nb lf it mx b gy nc nd l ne nf">PermitRootLogin yes</span></pre><p id="dd56" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å®‰è£…dockerã€kuberneteså’Œæ‚¨ç¨åéœ€è¦çš„å…¶ä½™è½¯ä»¶åŒ…</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="b2d5" class="nb lf it mx b gy nc nd l ne nf">apk update<br/>apk add kubernetes docker cni-plugins kubelet kubeadm<br/>rc-update add docker default<br/>rc-update add kubelet default</span></pre><h1 id="04de" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">å°å¸®æ‰‹è¯´:ä½ å¯ä»¥çœåŠ›æ°”äº†</h1><p id="386b" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">åœ¨è¿™ä¸ªé˜¶æ®µï¼Œä½ åº”è¯¥ä¸ºä½ çš„æ—…è¡Œåšå¥½ä¸€åˆ‡å‡†å¤‡ã€‚æˆ‘åˆ©ç”¨è¿™ä¸ªæœºä¼šå…³æ‰äº†æˆ‘çš„Raspberry Piï¼ŒæŠŠå­˜å‚¨å¡å¸¦å›æˆ‘çš„ç¬”è®°æœ¬ç”µè„‘ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ªå¡çš„å›¾åƒï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥åœ¨å‰©ä½™çš„ä¸‰å¼ å¡ä¸Šæ¢å¤å®ƒï¼Œä»è€ŒèŠ‚çœæ—¶é—´ã€‚<br/>è®°ä½ä¸ºæ¯ä¸ªæ–°é‡æ–°åˆ›å»ºçš„æœºå™¨æ›´æ”¹<code class="fe nk nl nm mx b">/etc/hostname</code>å†…å®¹ï¼Œä»¥é¿å…å†²çªã€‚æˆ‘é€‰æ‹©äº†<code class="fe nk nl nm mx b">pi0, pi1, pi2</code>,ä»¥ä¾¿æ›´å®¹æ˜“è®°å¿†(å¹¶åœ¨æˆ‘çš„æœ¬åœ°sshé…ç½®ä¸­ä½¿ç”¨),å°½ç®¡æ²¡æœ‰é™åˆ¶ã€‚</p><h1 id="2e85" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">åˆ›å»ºæ‚¨çš„kuberneteså¤§å¸ˆ</h1><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="a8a4" class="nb lf it mx b gy nc nd l ne nf">service docker start<br/>kubeadm config images pull   # Get the necessary images<br/>kubeadm init --pod-network-cidr=10.244.0.0/16</span></pre><p id="1228" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¦‚æœæ‚¨çœ‹åˆ°ä»»ä½•åœæ­¢åˆå§‹åŒ–è¿‡ç¨‹çš„ä¸cgroupsç›¸å…³çš„é”™è¯¯â€”â€”æ‚¨ä¹‹å‰é”™è¿‡äº†å…¶ä¸­ä¸€ä¸ªæ­¥éª¤ï¼Œå¦åˆ™æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä»¥â€œæ‚¨çš„Kubernetesæ§åˆ¶å¹³é¢å·²æˆåŠŸåˆå§‹åŒ–â€å¼€å§‹çš„æ¶ˆæ¯ï¼`.</p><p id="b3a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">å°†æ¥è‡ªè¾“å‡º</strong>(ä»¥<code class="fe nk nl nm mx b">kubeadm join</code>å¼€å¤´çš„é‚£ä¸ª)çš„å‘½ä»¤ä¿å­˜åœ¨å®‰å…¨çš„åœ°æ–¹ã€‚æ‚¨å°†éœ€è¦å®ƒæ¥å…è®¸å‰©ä½™çš„èŠ‚ç‚¹åŠ å…¥æ‚¨çš„é›†ç¾¤ã€‚</p><p id="0ae2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¿è¡Œä»¥ä¸‹å‘½ä»¤å°†å‡­æ®å­˜å‚¨åœ¨æ‚¨çš„ä¸»ç›®å½•ä¸­</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="630f" class="nb lf it mx b gy nc nd l ne nf">mkdir -p $HOME/.kube<br/>sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config<br/>sudo chown $(id -u):$(id -g) $HOME/.kube/config</span></pre><h1 id="ff60" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">å¦‚ä½•è®¿é—®èŠ‚ç‚¹ï¼Ÿ</h1><p id="0b5f" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">æˆ‘å·²ç»å°†<code class="fe nk nl nm mx b">$HOME/.kube/config</code>çš„å†…å®¹ä»èŠ‚ç‚¹å¤åˆ¶åˆ°æˆ‘çš„æœ¬åœ°æœºå™¨ä¸Šï¼Œæ›´æ”¹äº†ä¸€äº›é»˜è®¤å€¼ä»¥é¿å…æ½œåœ¨çš„å†²çªã€‚å¤šäºäº†è¿™ä¸ªï¼Œæˆ‘å¯ä»¥åœ¨æˆ‘çš„ç¬”è®°æœ¬ç”µè„‘ä¸Šä½¿ç”¨åƒ<code class="fe nk nl nm mx b">kubectl</code>æˆ–<code class="fe nk nl nm mx b">k9s</code>è¿™æ ·çš„å·¥å…·ï¼Œå¹¶ç¡®ä¿æˆ‘æ€»èƒ½æ‰¾åˆ°æ­£ç¡®çš„æœåŠ¡å™¨ã€‚</p><h1 id="1420" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">ä¸»äººè·‘äº†ï¼Œè¿˜èƒ½åšä»€ä¹ˆï¼Ÿ</h1><p id="1caa" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">è±†èšä¹‹é—´çš„ç½‘ç»œâ€”â€”æ²¡æœ‰å®ƒï¼Œä½ çš„èŠ‚ç‚¹å°†æ°¸è¿œä¿æŒæ„ŸæŸ“å’Œæœªå°±ç»ªçŠ¶æ€ã€‚</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="e662" class="nb lf it mx b gy nc nd l ne nf">kubectl apply -f <a class="ae mn" href="https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</a></span></pre><p id="2532" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‚¨ä¸èƒ½åœ¨ä¸»èŠ‚ç‚¹ä¸Šéƒ¨ç½²ä»»ä½•ä¸œè¥¿</strong>ï¼ŒèŠ‚ç‚¹æ˜¾ç¤ºä¸ºå·²æ„ŸæŸ“ï¼Œä½†æ˜¯ä¸è¦æ‹…å¿ƒâ€”â€”æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªå‘½ä»¤æ¥æ”¹å˜å®ƒ</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="72f8" class="nb lf it mx b gy nc nd l ne nf">kubectl taint nodes --all node-role.kubernetes.io/master-</span></pre><p id="d17b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä»ªè¡¨æ¿ã€‚ä½ é‡åˆ°è¿‡è¯´â€œæˆ‘ä¸å–œæ¬¢ä»ªè¡¨ç›˜â€çš„äººå—ï¼ŸKubernetesæœ‰è‡ªå·±çš„ã€ç›¸å½“é€šç”¨çš„ä»ªè¡¨æ¿ï¼Œå¯ä»¥è®©æ‚¨å¾ˆå¥½åœ°äº†è§£æ‚¨çš„é›†ç¾¤(ä»¥åŠå…¶ä¸­çš„ä»»ä½•å†…å®¹)ã€‚</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="49e1" class="nb lf it mx b gy nc nd l ne nf"><em class="nn"># Add kubernetes-dashboard repository</em><br/>helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/<br/><em class="nn"># Deploy a Helm Release named "kubernetes-dashboard" using the kubernetes-dashboard chart</em><br/>helm install kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard --set protocolHttp=true,ingress.enabled=true,rbac.create=true,serviceAccount.create=true,service.externalPort=9090,networkPolicy.enabled=true,podLabels.app=dashboard</span></pre><p id="3933" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ­£å¦‚ä½ æ‰€æ³¨æ„åˆ°çš„ï¼Œæˆ‘åœ¨èˆµå›¾è®¾ç½®ä¸­å¢åŠ äº†ä¸€äº›é¢å¤–çš„ä¸œè¥¿ï¼Œä½†è¿™æ˜¯æœ‰åŸå› çš„ã€‚</p><p id="e93c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ‚¨çš„ä»ªè¡¨æ¿å°†ä¼šå¯åŠ¨å¹¶è¿è¡Œï¼Œä½†æ˜¯..å®ƒä¸ä¼šæ˜¾ç¤ºä»»ä½•ä¸œè¥¿ã€‚ç¼ºå°‘æƒé™ã€‚</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="d186" class="nb lf it mx b gy nc nd l ne nf">kubectl create clusterrolebinding kubernetes-dashboard --clusterrole=cluster-admin --serviceaccount=default:kubernetes-dashboard</span></pre><p id="0259" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¥½å§ã€‚æˆ‘ä»¬å¿«åˆ°äº†ã€‚æˆ‘ä»¬æœ‰ä¸»èŠ‚ç‚¹ï¼Œæˆ‘ä»¬æœ‰ä»ªè¡¨æ¿ï¼Œä½†æˆ‘ä»¬ç›®å‰æ— æ³•è®¿é—®å®ƒã€‚æˆ‘ä»¬å¯èƒ½ä¼šä½¿ç”¨èŠ‚ç‚¹ç«¯å£æ¥å…¬å¼€dashboardï¼Œä½†è¿™ä¸æ˜¯æˆ‘ä»¬çš„æ–¹å¼â€”â€”è¦åƒkubernetesé‚£æ ·åšï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè´Ÿè½½å¹³è¡¡å™¨ã€‚Nodeåœ¨æˆ‘ä»¬çš„æœ¬åœ°ç½‘ç»œä¸­è¿è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½æŒ‡æœ›AWSæˆ–GoogleCloudæä¾›ä»»ä½•å¥½å¤„ï¼Œä½†ææ€•ä¸è¡Œâ€”â€”æœ‰åŠæ³•å¯¹ä»˜å®ƒã€‚</p><h1 id="9d75" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">å®¶åº­ç½‘ç»œä¸­çš„è´Ÿè½½å¹³è¡¡</h1><p id="fa6e" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">æ ¹æ®æ¸…å•éµå¾ª<a class="ae mn" href="https://metallb.universe.tf/installation/" rel="noopener ugc nofollow" target="_blank">é‡‘å±LB </a>ä¸Šçš„å®‰è£…æ­¥éª¤ï¼Œç›´åˆ°<strong class="js iu">å®‰è£…ç»“æŸã€‚</strong></p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="3621" class="nb lf it mx b gy nc nd l ne nf">ifconfig wlan0 promisc    # Set PROMISC mode for WiFi - for ARP</span></pre><p id="499b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åªè¦æ‚¨ä¿æŒPiè¿è¡Œï¼Œä¸Šé¢çš„å‘½ä»¤å°±ä¼šç”Ÿæ•ˆã€‚ä¸ºäº†é¿å…åˆ›å»ºå¯åŠ¨è„šæœ¬ï¼Œæˆ‘å†³å®šç¼–è¾‘<code class="fe nk nl nm mx b">/etc/network/if-up.d/dad</code>æ¥è®¾ç½®ç•Œé¢å‡ºç°æ—¶çš„promiscæ¨¡å¼ã€‚</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="2000" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å°†ä»¥ä¸‹æ¸…å•åˆ›å»ºä¸ºmy-dashboard.yaml</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="9e6c" class="nb lf it mx b gy nc nd l ne nf">apiVersion: v1<br/>kind: ConfigMap<br/>metadata:<br/>  namespace: metallb-system<br/>  name: config<br/>data:<br/>  config: |<br/>    address-pools:<br/>    - name: default<br/>      protocol: layer2<br/>      addresses:<br/>      - 192.168.50.200-192.168.50.250<br/>---<br/>apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: k8s-dashboard<br/>  annotations:<br/>    metallb.universe.tf/address-pool: default<br/>spec:<br/>  ports:<br/>  - port: 80<br/>    targetPort: 9090<br/>  selector:<br/>    app: dashboard<br/>  type: LoadBalancer</span></pre><p id="ff50" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä¸è¦å¿˜è®°æ›´æ”¹åœ°å€éƒ¨åˆ†ï¼Œä»¥ç¬¦åˆæ‚¨çš„æœ¬åœ°ç½‘ç»œè®¾ç½®ã€‚</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="b331" class="nb lf it mx b gy nc nd l ne nf">kubectl apply -f my-dashboard.yaml<br/>kubectl get svc k8s-dashboard </span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nq"><img src="../Images/9a31cd128089099eb774fff123974db3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ei4FWmcaGCH5M31xDw2JTg.png"/></div></div></figure><p id="6808" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä»ç°åœ¨èµ·ï¼Œæ‚¨å¯ä»¥é€šè¿‡(å¯¹æˆ‘è€Œè¨€)<a class="ae mn" href="http://192.168.50.200/" rel="noopener ugc nofollow" target="_blank"> http://192.168.50.200/ </a>è®¿é—®æ‚¨çš„ä»ªè¡¨æ¿</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nr"><img src="../Images/f1359afd11e26edd523c98bcb336c78d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*klWWDB8X3mvfdKYX2cW0xw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">æ ‘è“Piä¾›ç”µçš„k8sé›†ç¾¤ã€‚</figcaption></figure><p id="6078" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ–‡ç« ç”±ã€Šå‘¨å…­å¥‹æ–—ã€‹ã€ã€Šçº¢ç‰›ã€‹å’Œã€Šå®éªŒä¹‹çˆ±ã€‹æä¾›åŠ¨åŠ›ã€‚</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ns"><img src="../Images/9e3cf62512dba3b4c67c2ba7e4073d5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_bz9wkFT-8DaZCM7BtNbdg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">K9Sæä¾›çš„é›†ç¾¤å•å…ƒæ¦‚è¿°</figcaption></figure><h1 id="4257" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">æ·»åŠ å…¶ä»–èŠ‚ç‚¹</h1><p id="99f0" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">å½“æˆ‘ä»¬å¹²(ä¸è¦é‡å¤è‡ªå·±)å»(ä¿æŒæ„šè ¢çš„ç®€å•)-æ»šåŠ¨åˆ°æ–‡ç« çš„å¼€å¤´ï¼Œå¹¶éµå¾ªæ‰€æœ‰æ­¥éª¤ï¼Œç›´åˆ°â€œ<em class="nn">åœ¨æ–°åˆ›å»ºçš„èŠ‚ç‚¹ä¸Šåˆ›å»ºæ‚¨çš„kubernetesä¸»èŠ‚ç‚¹</em>ï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹æ“ä½œ(è®°ä½ç”¨æ‚¨çš„ä¸»èŠ‚ç‚¹ipæ›¿æ¢IPåœ°å€-æˆ–è€…å®ƒçš„ä¸»æœºå(pi0.localï¼Œæ„Ÿè°¢avahiå®ˆæŠ¤è¿›ç¨‹)</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="b099" class="nb lf it mx b gy nc nd l ne nf">service docker start<br/>kubeadm config images pull<br/>kubeadm join 192.168.50.132:6443 --token dugwjt.0k3n \--discovery-token-ca-cert-hash sha256:55cfadHelloSuperSecretHashbf4970f49dcadf533f86e3dba</span></pre><p id="b720" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æç¤º:å¦‚æœæ‚¨åœ¨åˆ›å»ºä¸»èŠ‚ç‚¹çš„è¿‡ç¨‹ä¸­å¿˜è®°äº†å¤åˆ¶kubeadmå‘½ä»¤ï¼Œæˆ‘ä¼šå¸®åŠ©æ‚¨â€”â€”åœ¨ä¸»èŠ‚ç‚¹ä¸Šæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ä¼šå†æ¬¡ä¸ºæ‚¨æ‰“å°å‡ºæ¥</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="8df7" class="nb lf it mx b gy nc nd l ne nf">kubeadm token create --print-join-command</span></pre><p id="d6fb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">æ—¢ç„¶ä½ è®¾æ³•è¯»å®Œäº†æ‰€æœ‰å†…å®¹ï¼Œä½ åº”è¯¥çŸ¥é“â€¦â€¦</strong></p><p id="cff8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">æˆªè‡³Piæ—¥(3æœˆ14æ—¥)çš„æ›´æ–°:</strong>æˆ‘åˆšåˆšå‘è¡¨äº†å¦ä¸€ç¯‡æ–‡ç« ï¼Œå¸¦æœ‰è‡ªåŠ¨åŒ–é›†ç¾¤è®¾ç½®â€” <a class="ae mn" href="https://blog.raczylo.com/i-broke-my-kubernetes-cluster-running-on-raspberry-pi-355234a24d" rel="noopener ugc nofollow" target="_blank">â€œæˆ‘åœ¨Raspberry Piä¸Šä¸­æ–­äº†æˆ‘çš„Kubernetesé›†ç¾¤è¿è¡Œâ€</a>ï¼ŒåŒ…å«äº†æ•´ä¸ªä»£ç åº“ã€‚</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/7b9a10c97f98642e0d0b22b231fa4783.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*OhCO08D9oIzb5ksZ6XSF9Q.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">åœ†å‘¨ç‡æ—¥å¿«ä¹ï¼</figcaption></figure></div></div>    
</body>
</html>