<html>
<head>
<title>How to Serve Optimised Images on Umbraco 9</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•åœ¨Umbraco 9ä¸Šæä¾›ä¼˜åŒ–çš„å›¾åƒ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/how-to-serve-optimised-images-on-umbraco-9-f86ec06b6344?source=collection_archive---------2-----------------------#2021-06-25">https://itnext.io/how-to-serve-optimised-images-on-umbraco-9-f86ec06b6344?source=collection_archive---------2-----------------------#2021-06-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/7cd04ebd6623e372a811f3e9be0477bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kThqvW70hw0VtSgyqgUGig.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">å…³äºåœ¨Umbraco 9ä¸Šæä¾›ä¼˜åŒ–å›¾åƒçš„æ•™ç¨‹</figcaption></figure><div class=""/><p id="1e4f" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">ä¸€ä¸ªå…³äºåœ¨æœ€æ–°ç‰ˆæœ¬çš„Umbracoä¸Šæä¾›è£å‰ªå¥½çš„ã€æœç´¢å¼•æ“å‹å¥½çš„Ì¶WÌ¶eÌ¶bÌ¶PÌ¶å›¾ç‰‡çš„å¿«é€Ÿæ•™ç¨‹</p><p id="8753" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="la">æ³¨æ„:æœ¬æ•™ç¨‹æœ€åä¸€æ¬¡æ›´æ–°æ˜¯é’ˆå¯¹RCç‰ˆæœ¬:<br/>T3 9 . 0 . 0-RC(08/07/21)</em></p><p id="18ec" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">åœ¨Umbracoçš„å¼•æ“ç›–ä¸‹æœ‰ä¸€å¥—å¼ºå¤§çš„åª’ä½“ç®¡ç†å·¥å…·ï¼Œå…è®¸ä½ æä¾›é«˜æ€§èƒ½çš„å›¾ç‰‡ï¼Œè¿™äº›å›¾ç‰‡æ˜¯SEOå‹å¥½çš„ï¼Œè£å‰ªå¾—å¾ˆå¥½ã€‚</p><blockquote class="lb lc ld"><p id="cb12" class="kc kd la ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">WEBPæ”¯æŒ<a class="ae lh" href="https://github.com/SixLabors/ImageSharp/pull/1552" rel="noopener ugc nofollow" target="_blank">è¿˜æ²¡æœ‰å®Œå…¨å‡†å¤‡å¥½</a>å…­ä¸ªåŠ³åŠ¨åŠ›ã€‚ImageSharp.Webï¼Œè¿™æ˜¯ä¸€ä¸ªé—æ†¾ï¼Œå› ä¸ºå®ƒå¯ä»¥ä½œä¸ºæ’ä»¶åœ¨8ä¸Šçš„imageprocessor.webä¸Šè·å¾—ã€‚</p></blockquote><p id="b3dc" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">ç„¶è€Œï¼Œè¦è¾¾åˆ°é‚£ä¸ªé˜¶æ®µï¼Œä½ ç¡®å®éœ€è¦ä¸€ç‚¹æœªè®°å½•çš„çŸ¥è¯†æ¥è®©å®ƒå·¥ä½œã€‚</p><h2 id="59a4" class="li lj jf bd lk ll lm dn ln lo lp dp lq kn lr ls lt kr lu lv lw kv lx ly lz ma bi translated">GetCropUrl()ç®€ä»‹</h2><p id="d433" class="pw-post-body-paragraph kc kd jf ke b kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz ij bi translated">è¾“å…¥è¿™ä¸ªæ–¹æ³•ï¼Œå®ƒä¼šæ ¹æ®ä½ çš„éœ€è¦è¿›è¡ŒåŠ¨æ€è°ƒæ•´ï¼Œç›®å‰æœ‰5ç§æ–¹æ³•å¯ä»¥ç”¨æ¥è£å‰ªä½ çš„å›¾ç‰‡ï¼Œåˆ†ä¸ºä¸¤ç§ä¸»è¦æ–¹æ³•ï¼Œæˆ–è€…é€šè¿‡ä¼ é€’ä¸€ä¸ª<strong class="ke jg"> IPublishContent </strong>åª’ä½“é¡¹ï¼Œæˆ–è€…ä¸€ä¸ªurlå­—ç¬¦ä¸²ã€‚æˆ‘ä»¬æœ€æ„Ÿå…´è¶£çš„æ˜¯è¿™ä¸ª:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="36c4" class="li lj jf ml b gy mp mq l mr ms">GetCropUrl(</span><span id="aef1" class="li lj jf ml b gy mt mq l mr ms">this IPublishedContent mediaItem, // Implied by the referring object</span><span id="a13d" class="li lj jf ml b gy mt mq l mr ms">IImageUrlGenerator imageUrlGenerator,  // Implied</span><span id="9282" class="li lj jf ml b gy mt mq l mr ms">IPublishedValueFallback publishedValueFallback,  // Implied</span><span id="3154" class="li lj jf ml b gy mt mq l mr ms">IPublishedUrlProvider publishedUrlProvider,  // Implied</span><span id="557f" class="li lj jf ml b gy mt mq l mr ms">int? width = null,  // The width to crop to in pixels</span><span id="82cc" class="li lj jf ml b gy mt mq l mr ms">int? height = null,  // The height to crop to in pixels</span><span id="8ed1" class="li lj jf ml b gy mt mq l mr ms">string propertyAlias = "umbracoFile",  // Property alias of the property containing the Json data. The default is fine</span><span id="6ccb" class="li lj jf ml b gy mt mq l mr ms">string cropAlias = null,  // The crop alias specified in umbraco, we take this implicitly from the IPublished Content</span><span id="2b01" class="li lj jf ml b gy mt mq l mr ms">int? quality = null,  // Image compresion quality out of 100</span><span id="297b" class="li lj jf ml b gy mt mq l mr ms">ImageCropMode? imageCropMode = null,  // can be left, or specified explicitly based on the modes in Sharps docs</span><span id="1db3" class="li lj jf ml b gy mt mq l mr ms">ImageCropAnchor? imageCropAnchor = null,  // can be left, or specified explicitly based on the modes in Sharps docs</span><span id="49f8" class="li lj jf ml b gy mt mq l mr ms">bool preferFocalPoint = false,  // Use focal point, to generate an output image using the focal point instead of the predefined crop</span><span id="3ebe" class="li lj jf ml b gy mt mq l mr ms">bool useCropDimensions = false,  // Use crop dimensions to have the output image sized according to the predefined crop sizes, this will override the width and height parameters. So we do not want this</span><span id="2c3d" class="li lj jf ml b gy mt mq l mr ms">bool cacheBuster = true,  // Add a serialized date of the last edit of the item to ensure client cache refresh when updated. We want this</span><span id="7649" class="li lj jf ml b gy mt mq l mr ms">string furtherOptions = null,  // Specify extra features to amend the image with. This is where we specify our preferred image format, e.g.  Ì¶WÌ¶eÌ¶bÌ¶PÌ¶</span><span id="bcec" class="li lj jf ml b gy mt mq l mr ms">ImageCropRatioMode? ratioMode = null,  //  Use a dimension as a ratio. We'll ignore this as we are specifying the width and height, which will explicitly set the ratio.</span><span id="33c1" class="li lj jf ml b gy mt mq l mr ms">bool upScale = true // If the image is smaller than the dimensions, attempt to upscale it to fill the space. Ideally this wont be needed, but best to keep it so we dont get black borders or too small images</span><span id="75ec" class="li lj jf ml b gy mt mq l mr ms">);</span></pre><p id="af09" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">å®ƒç»™äº†æˆ‘ä»¬æœ€å¤§çš„çµæ´»æ€§æ¥æ”¹å˜å›¾åƒï¼Œå¹¶å…è®¸æˆ‘ä»¬æä¾›å›¾åƒæ ¼å¼ï¼Œè¿™æ˜¯å…¶ä»–å˜ä½“æ‰€ç¼ºä¹çš„ã€‚</p><p id="2460" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">è™½ç„¶è¿™çœ‹èµ·æ¥ä»¤äººæœ›è€Œç”Ÿç•ï¼Œä½†å®ƒå®é™…ä¸Šå¯¹è®¸å¤šä¸éœ€è¦çš„é‡è½½æ¥è¯´æ˜¯å¤šä½™çš„ã€‚å¯¹äºæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥åªå…³æ³¨æˆ‘ä»¬éœ€è¦çš„å…ƒç´ ã€‚è¿™ä¸ºæˆ‘ä»¬æä¾›äº†ä»¥ä¸‹ä¿¡æ¯:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="b263" class="li lj jf ml b gy mp mq l mr ms">@* /Views/Partials/ResponsiveImage.cshtml *@</span><span id="8bb5" class="li lj jf ml b gy mt mq l mr ms">@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage</span><span id="6ce9" class="li lj jf ml b gy mt mq l mr ms">@using Umbraco.Cms.Core.Media</span><span id="31b4" class="li lj jf ml b gy mt mq l mr ms">@using Umbraco.Cms.Core.Models.PublishedContent</span><span id="8619" class="li lj jf ml b gy mt mq l mr ms">@using Umbraco.Cms.Core.Routing</span><span id="fe5b" class="li lj jf ml b gy mt mq l mr ms">@{</span><span id="e18b" class="li lj jf ml b gy mt mq l mr ms">var publishedContent =  @ViewData["publishedContent"] as IPublishedContent ?? null;</span><span id="2ffa" class="li lj jf ml b gy mt mq l mr ms">var lazyLoading =  @ViewData["lazyLoading"] ?? false;</span><span id="b148" class="li lj jf ml b gy mt mq l mr ms">var imageWebP = publishedContent?.GetCropUrl(width: 600, height: 20, quality:80, furtherOptions: "&amp;format=jpg") ?? "";</span><span id="ab38" class="li lj jf ml b gy mt mq l mr ms">}</span></pre><p id="1e87" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">ç„¶åï¼Œæˆ‘ä»¬æŒ‡å®šå®½åº¦ã€é«˜åº¦å’Œè´¨é‡ï¼Œåœ¨è¿›ä¸€æ­¥çš„é€‰é¡¹ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº†â€œÌ¶WÌ¶eÌ¶bÌ¶PÌ¶'â€æ ¼å¼ï¼Œè¿™æ˜¯æ–°ç½‘ç«™çš„æœ€ä½³æ ¼å¼ã€‚</p><h2 id="c61c" class="li lj jf bd lk ll lm dn ln lo lp dp lq kn lr ls lt kr lu lv lw kv lx ly lz ma bi translated">ç”¨å›¾ç‰‡åŒ…èµ·æ¥</h2><p id="1b96" class="pw-post-body-paragraph kc kd jf ke b kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz ij bi translated">ä¸ºäº†ä½¿æˆ‘ä»¬çš„å›¾åƒæ›´å…·æ€§èƒ½ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šä¸€ä¸ªæºé›†ï¼Œä»é«˜æ€§èƒ½çš„webpå¼€å§‹ï¼Œé€æ¸é€€åŒ–åˆ°å…¶ä»–æ ¼å¼ã€‚è¿™å¯¹äºä½¿ç”¨è€ç‰ˆæœ¬æµè§ˆå™¨çš„ç½‘ç«™æ¥è¯´å¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒå¯ä»¥è®©æˆ‘ä»¬é€€å›åˆ°jpegæˆ–pngç­‰å…¬è®¤çš„æ ¼å¼ã€‚</p><p id="7101" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">ä¸ºäº†SEOçš„ç¼˜æ•…ï¼Œæˆ‘ä»¬åŒ…æ‹¬äº†<code class="fe mu mv mw ml b">loading=â€lazyâ€</code>æ ‡ç­¾ï¼Œç”¨äºä»»ä½•å‡ºç°åœ¨â€œæ–‡ä»¶å¤¹ä¸‹â€çš„ä¸œè¥¿ã€‚å³ä½¿æ˜¯ç©ºçš„ï¼Œä¹Ÿéœ€è¦æŒ‡å®šä¸€ä¸ªaltã€‚</p><p id="bb86" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">æˆ‘ä»¬è¿˜æŒ‡å®šäº†å®½åº¦å’Œé«˜åº¦ï¼Œè¿™æœ‰åŠ©äºæµè§ˆå™¨æå‰è®¡ç®—å¸ƒå±€ã€‚</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="4d6d" class="li lj jf ml b gy mp mq l mr ms">&lt;picture&gt;<br/> Ì¶&lt;Ì¶sÌ¶oÌ¶uÌ¶rÌ¶cÌ¶eÌ¶ Ì¶sÌ¶rÌ¶cÌ¶sÌ¶eÌ¶tÌ¶=Ì¶"Ì¶@Ì¶iÌ¶mÌ¶aÌ¶gÌ¶eÌ¶WÌ¶eÌ¶bÌ¶PÌ¶"Ì¶ Ì¶tÌ¶yÌ¶pÌ¶eÌ¶=Ì¶"Ì¶iÌ¶mÌ¶aÌ¶gÌ¶eÌ¶/Ì¶wÌ¶eÌ¶bÌ¶pÌ¶"Ì¶&gt;Ì¶<br/>&lt;source srcset="@imageJpeg" type='image/jpeg'&gt;<br/>&lt;img src="@imageOriginal" width="600" loading="@lazyLoading" alt="" /&gt;<br/>&lt;/picture&gt;</span></pre><h2 id="3948" class="li lj jf bd lk ll lm dn ln lo lp dp lq kn lr ls lt kr lu lv lw kv lx ly lz ma bi translated">æŠŠæ‰€æœ‰çš„æ”¾åœ¨ä¸€èµ·</h2><figure class="mg mh mi mj gt is"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="ddc8" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">æˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨ä»»ä½•è§†å›¾ä¸­å¼•ç”¨æˆ‘ä»¬çš„å›¾åƒç”Ÿæˆå™¨éƒ¨åˆ†</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="b319" class="li lj jf ml b gy mp mq l mr ms">@Html.Partial("ResponsiveImage",new ViewDataDictionary(ViewData) { { "publishedContent", Model.TestImage.MediaItem }, { "lazyLoading", true } })</span></pre><p id="e39a" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">æˆ‘ä»¬å®Œäº†ã€‚ä¸€ä¸ªè¶…çº§ç®€å•å’Œè¡¨æ¼”çš„å½¢è±¡ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å°†å®½åº¦å’Œé«˜åº¦è¾“å…¥åˆ°è§†å›¾æ•°æ®ä¸­ï¼Œä¸è¿‡è¿˜éœ€è¦ä¸€å¤©çš„ä¿®æ­£ã€‚</p><p id="c685" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">é—®é¢˜:ä½¿ç”¨å¸¦æœ‰Cropsçš„åª’ä½“è¿›è¡Œè£å‰ª</strong></p><p id="302b" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">æ ¹æ®æ‚¨ä½¿ç”¨çš„æµ‹è¯•ç‰ˆï¼Œæ‚¨å¯èƒ½éœ€è¦é‡‡å–é¢å¤–çš„æ­¥éª¤æ¥è·å¾—IPublishedContentã€‚å¦‚æœä½ çš„åª’ä½“ä»¥MediaWithCropsçš„å½¢å¼å‡ºç°ï¼Œè·å–å®ƒçš„MediaItemå€¼ï¼Œè¿™å°†æ˜¯IPublishedContentç±»å‹ï¼Œæ‰€ä»¥ä½ å¯ä»¥æŠŠå®ƒä¼ å…¥ã€‚å¿«ä¹çš„æ—¥å­ï¼</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="1609" class="li lj jf ml b gy mp mq l mr ms">MediaWithCrops cmsImage = Model.Value("cmsImage");</span><span id="fda3" class="li lj jf ml b gy mt mq l mr ms">IPublishedContent image = cmsImage.MediaItem;</span></pre><p id="1a09" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">å–œæ¬¢ä½ è¯»çš„å—ï¼Ÿç»™æˆ‘ä»¬é¼“æŒğŸ‘ğŸ‘ğŸ‘</p></div></div>    
</body>
</html>