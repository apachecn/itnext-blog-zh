# å¦‚ä½•æ”»å…‹çŒ´å­ä»£ç ï¼æ— é¦™è•‰ API ç”ŸæˆğŸ™Š

> åŸæ–‡ï¼š<https://itnext.io/why-are-you-still-writing-apis-or-no-more-monkey-code-82e6af371b0a?source=collection_archive---------3----------------------->

![](img/5e516bbeb5f571c0816364cbf07898bf.png)

ä½ è¿˜åœ¨å†™çŒ´å­ä»£ç ï¼Ÿï¼ï¼Ÿï¼ï¼Ÿï¼ï¼æ°ç±³Â·éœé¡¿åœ¨ [Unsplash](https://unsplash.com/search/photos/monkey?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šçš„ç…§ç‰‡

> æœ¬æ–‡æ˜¯ä¸€ç¯‡å…³äºä½¿ç”¨ **sugar-generate** çš„ä»£ç ç”Ÿæˆå’Œè‡ªåŠ¨ api åˆ›å»ºçš„æ•™ç¨‹ï¼Œå®ƒæ˜¯ github å’Œ [npm](https://www.npmjs.com/package/sugar-generate) ä¸Šçš„å…è´¹å¼€æº[ã€‚](https://github.com/sugarkubes/generators)

æˆ‘è§‰å¾—æœ‰ç‚¹å‚»ã€‚å¤šå¹´æ¥ï¼Œæˆ‘ä¸€ç›´åœ¨ç¼–å†™ç›¸åŒçš„ API ä»£ç å’Œæ ·æ¿æ–‡ä»¶ï¼Œæˆ‘ä»æ¥æ²¡æœ‰æƒ³åˆ°è¦ç¼–å†™ä¸ºæˆ‘ç¼–å†™è¿™äº›ä»£ç çš„ä»£ç ã€‚ä½†æ˜¯ç°åœ¨æˆ‘å·²ç»å¼€å§‹ä½¿ç”¨ä»£ç ç”Ÿæˆå™¨äº†ï¼Œæˆ‘å†ä¹Ÿä¸ä¼šå›å¤´äº†ã€‚æˆ‘ä»¬å·²ç»ä»æ±‡ç¼–è¯­è¨€åˆ° C è¯­è¨€ï¼Œå†åˆ°â€¦â€¦Javascriptã€‚å¾ˆæ˜æ˜¾ï¼Œæœªæ¥å°†æ˜¯å†™æ›´å°‘çš„ä»£ç åšæ›´å¤šçš„äº‹æƒ…ã€‚

æˆ‘æ²¡æœ‰æ·±å…¥ç ”ç©¶ä»£ç ç”Ÿæˆï¼Œä½†æ˜¯æˆ‘çš„å¿«é€Ÿæœç´¢æŠŠæˆ‘å¸¦åˆ°äº†ä¸¤ä¸ªåœ°æ–¹:

## æ–¯ç“¦æ ¼ä»£ç æ ¹

[https://swagger.io/tools/swagger-codegen/](https://swagger.io/tools/swagger-codegen/)

![](img/d5a92e4166dea44322283a29f60d743e.png)

è¿™çœ‹èµ·æ¥å¾ˆæœ‰å¸Œæœ›ï¼ï¼é™¤éä½ çœŸçš„çœ‹åˆ°å®ƒäº§ç”Ÿäº†ä»€ä¹ˆã€‚æˆ‘ä¸æƒ³è¦æœåŠ¡å™¨å­˜æ ¹ã€‚æˆ‘æƒ³è®©å®ƒæ¥å—ä¸€ä¸ªæ¨¡å¼å¹¶ä¸ºæˆ‘ç”Ÿæˆè¯¥æ­»çš„ä¸œè¥¿ã€‚

## æ–¯ç‰¹æ‹‰çš®

[](https://strapi.io/) [## Strapi -å¼€æº Node.js Headless CMSğŸš€

### å¼€æºæ— å¤´ CMS å‰ç«¯å¼€å‘è€…çš„æœ€çˆ±ã€‚ç®¡ç†æ‚¨çš„å†…å®¹ã€‚éšå¤„åˆ†å‘ã€‚

strapi.io](https://strapi.io/) 

æ–¯ç‰¹æ‹‰çš®æ˜¯ä¸€ä¸ªéå¸¸é…·çš„é€‰æ‹©ã€‚è¿™é‡Œæ²¡æœ‰æŠ±æ€¨ã€‚æˆ‘åªæ˜¯å¯¹è´­ä¹°è¿™æ ·çš„å¤§å‹æ¡†æ¶æŒè°¨æ…æ€åº¦ã€‚å¤§ä¾¿æ‰“åˆ°é£æ‰‡ä¸Šï¼Œä¸çŸ¥é“å»å“ªé‡Œä¿®ã€‚

åŒæ ·ï¼Œå½“æˆ‘è¯•å›¾æ”¾å…¥æˆ‘è‡ªå·±çš„æœ¬åœ° mongodb æ•°æ®åº“æ—¶ï¼Œåº”ç”¨ç¨‹åºå´©æºƒäº†ï¼Œæˆ‘æ— æ³•è®©å®ƒæ¢å¤ã€‚å¯èƒ½æ˜¯ä¸€äº›ç®€å•ä½†ä»ç„¶ä»¤äººè®¨åŒçš„äº‹æƒ…ã€‚

> ä¸¤ä¸ªé€‰é¡¹éƒ½å¾ˆå¥½ï¼Œæ˜¾ç„¶ï¼Œå¾ˆå¤šäººè§‰å¾—è¿™ä¸¤ä¸ªæ¨¡å—å¾ˆæœ‰ç”¨ã€‚æˆ‘æƒ³åšç‚¹ä¸åŒçš„äº‹æƒ…ã€‚ç¨å¾®è½»æ¾ä¸€ç‚¹çš„ï¼Œèƒ½è®©æˆ‘é›†ä¸­ç²¾åŠ›å·¥ä½œçš„ã€‚

# ç³–ç”Ÿæˆ

è®©æˆ‘ä»¬ä»**äº§ç³–**å¼€å§‹ã€‚è¿™æ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æº NPM æ¨¡å—ï¼Œå¯ä»¥ç”Ÿæˆ CRUD APIsï¼Œæ‰€ä»¥ä½ ä¸å¿…è¿™ä¹ˆåšã€‚

å…ˆå†³æ¡ä»¶

*   å®‰è£…å¹¶è¿è¡Œ MongoDB

```
brew install mongodb && sudo mongod --bind_ip_all
```

> å°è¯•ä» docker è¿æ¥æ—¶ï¼Œ *â€” bind_ip_all* å°†ä¼šå¾ˆé‡è¦ã€‚

ç„¶åå®‰è£…**äº§ç³–**èŠ‚ç‚¹æ¨¡å—ã€‚

```
npm i -g sugar-generate
```

åˆ›å»ºä¸€ä¸ªæ¨¡å¼ã€‚æ¨¡å¼æ˜¯ API çš„ JSON è¡¨ç¤ºã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ APIï¼Œå«åš Monkey

```
{
  "schema": {
    "first_name": {
      "type": "String",
      "default": ""
    },
    "last_name": {
      "type": "String",
      "default": ""
    },
    "isDead": {
      "type": "Boolean",
      "default": false
    },
    "age": {
      "type": "Number",
      "default": false
    }
  },
  "statics": {}
}
```

æˆ‘ä»¬å°†ç»§ç»­ä½¿ç”¨ Monkey æ¨¡å¼ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹çš„æ¨¡å¼çš„ä¾‹å­ï¼Œå®ƒæ˜¯ç”± **sugar-generate** æ”¯æŒçš„

```
{
  "schema": {
    "first_name": {
      "type": "String",
      "default": ""
    },
    "last_name": {
      "type": "String",
      "default": ""
    },
    "email": {
      "type": "String",
      "trim": true,
      "required": true,
      "unique": true,
      "immutable": true
    },
    "password": {
      "type": "String",
      "trim": true,
      "select": false,
      "immutable": true
    },
    "intro": {
      "type": "Boolean",
      "default": false
    },
    "team": {
      "type": "ObjectId",
      "ref": "Team"
    },
    "sub": {
      "one": {
        "type": "String",
        "trim": true,
        "required": true
      },
      "two": {
        "type": "Number",
        "required": true
      }
    },
    "role": {
      "type": "String",
      "enum": ["user", "maker"],
      "default": "user"
    }
  },
  "statics": {
    "statuses": ["created", "under_review", "listed", "deleted"],
    "status": {
      "active": "active",
      "inactive": "inactive",
      "deleted": "deleted"
    }
  }
}
```

å®é™…ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯[mongose](https://mongoosejs.com/)ï¼Œæ‰€ä»¥æ¨¡å¼è¢«è®¾è®¡æˆæ¨¡ä»¿ mongose æ¨¡å¼è¡¨ç¤ºã€‚æ‚¨å¯ä»¥åœ¨ç”Ÿæˆçš„ä»£ç ä¸­çœ‹åˆ°è¿™ä¸€ç‚¹ã€‚

```
const database = require('../connection/mongo');
const {
  Schema
} = require('mongoose');
const mongoosePaginate = require('mongoose-paginate-v2');
const schema = new Schema({
  first_name: {
    "type": String,
    "default": ""
  },
  last_name: {
    "type": String,
    "default": ""
  },
  isDead: {
    "type": Boolean,
    "default": false
  },
  age: {
    "type": Number,
    "default": false
  },
}, {
  timestamps: true
});
schema.plugin(mongoosePaginate);
module.exports = database.model("monkey", schema);
```

ç°åœ¨åˆ°äº†æœ‰è¶£çš„éƒ¨åˆ†ã€‚

```
sugar-generate \
--type api \
--name monkey \
--schema /path/to/monkey.json \
--destination /where/you/want/the/code
```

![](img/81fa39b630946ba19bee6a1c4284769f.png)

äº§ç³–é‡

ç°åœ¨æ‚¨å·²ç»æœ‰äº†è‡ªå·±ç”Ÿæˆçš„ APIï¼è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¾“å‡ºã€‚

![](img/c2cbc12ff62c6fd3531baecb909c71db.png)

æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«æˆ‘ä»¬çš„æ•°æ®åº“è¿æ¥ã€ç«¯å£å’Œä¸€äº›æˆ‘è®¡åˆ’åœ¨å°†æ¥æ·»åŠ çš„å…¶ä»–é¡¹ç›®ã€‚

æˆ‘ä»¬çš„è¿æ¥æ–‡ä»¶å¤¹ä¿å­˜æˆ‘ä»¬çš„æ•°æ®åº“è¿æ¥ã€‚

æˆ‘ä»¬çš„æ§åˆ¶å™¨æ‹¥æœ‰æˆ‘ä»¬çš„å•ä¸ªç«¯ç‚¹ï¼Œå…·æœ‰åˆ›å»ºã€è·å–ã€æ›´æ–°å’Œåˆ é™¤åŠŸèƒ½ã€‚

æˆ‘ä»¬çš„çŒ«é¼¬æ¨¡å‹ååœ¨è¿™é‡Œ

è¶…çº§ç®€å•è·¯ç”±

ä½ å–œæ¬¢è€ƒè¯•ï¼Œä¸æ˜¯å—ï¼Ÿ

User-can æ˜¯æˆ‘æƒ³åœ¨æœªæ¥å®ç°çš„ä¸€äº›é­”æ³•ã€‚è¿™ä¸ªæƒ³æ³•æ˜¯ï¼Œä¸€ä¸ªç®€å•çš„ä¸­é—´ä»¶å±‚å°†æ‰©å±•å…¬å…±åŠŸèƒ½ï¼Œæ¯”å¦‚å¯¹äººå’Œæœºå™¨çš„è®¤è¯ã€‚

å…¶ä½™çš„åºŸè¯æˆ‘ç›¸ä¿¡ä½ å¾ˆç†Ÿæ‚‰ã€‚è¿™é‡Œåªæœ‰ä¸€ç‚¹éœ€è¦æŒ‡å‡ºï¼Œé‚£å°±æ˜¯ swagger.jsonã€‚

å¼ºåˆ¶æ€§ NPM å®‰è£…

```
npm i
```

è®©æˆ‘ä»¬è¿è¡Œæµ‹è¯•å¥—ä»¶ï¼Œä»¥ç¡®ä¿ç”Ÿæˆå™¨æ­£å¸¸å·¥ä½œã€‚

```
npm run test
```

![](img/400a03f107521dcbd5b45aa1f6190683.png)

çœ‹èµ·æ¥ä¸é”™ï¼è®©æˆ‘ä»¬å¯åŠ¨æœåŠ¡å™¨å§ï¼ç”Ÿæˆ swagger æ–‡æ¡£ï¼Œå¹¶å¯åŠ¨æœåŠ¡å™¨

```
npm run docs && npm start
```

![](img/4404a2ac6dddf5eb228b715b96cdc816.png)

ç°åœ¨å¯¼èˆªåˆ° [localhost:7777](http://localhost:7777)

![](img/8404505a25090685d78f2c931ccd7ef6.png)

åœ¨è¿™é‡Œï¼Œæ‚¨å·²ç»æœ‰äº†ç°æˆçš„ apiã€‚

â€¦éƒ¨ç½²æƒ…å†µå¦‚ä½•ï¼Ÿæˆ‘ä»¬ä¹Ÿå¸®ä½ æå®šäº†

## æ„å»º docker å®¹å™¨ã€‚

æˆ‘ä»¬å¿…é¡»å¯¹ configs/config.json æ–‡ä»¶åšä¸€ä¸ªå°å°çš„ä¿®æ”¹

```
// in config/config.json 
// change mongoURL to mongodb://<your ip address>:27017/sugardocker build -t monkeys:0.0.1 .
```

![](img/fd8ecc84ec437dda40415b7569c8e6dd.png)

ç°åœ¨è¿è¡Œå®ƒï¼

```
docker run -ti -p 3030:3030 -e PORT=3030 monkeys:0.0.1 
```

![](img/4c44dd08c2b300111f4d14292ed6e462.png)

å¦‚æœä½ æ”¶åˆ°â€œMongo OKAYâ€çš„æ¶ˆæ¯ï¼Œä½ å°±å·²ç»è¿æ¥å¥½äº†ï¼Œå‡†å¤‡å¥½å¼€å§‹æ‘‡æ»šäº†ã€‚

å¦‚æœä½ æƒ³åœ¨ç½‘ä¸Šæ‰¾åˆ°å®ƒï¼Œè¯•è¯•è°·æ­Œäº‘è¿è¡Œã€‚è¿™æ˜¯æˆ‘æ–°å–œæ¬¢çš„è°·æ­ŒæœåŠ¡(æ— å…³è”)ã€‚åªéœ€å°†è¿™ä¸ª docker å®¹å™¨æ¨é€åˆ° googleï¼Œå°±å¯ä»¥ç”¨ SSL è¯ä¹¦è®©å®ƒç«‹å³åœ¨ web ä¸Šè¿è¡Œã€‚å®ƒè¿˜æ˜¯ä¸€ç§æ‰©å±•åˆ°é›¶çš„â€œæ— æœåŠ¡å™¨â€æœåŠ¡ï¼Œå› æ­¤æ‚¨å°†æ‹¥æœ‰æ— é™çš„å¯æ‰©å±•æ€§ï¼Œä¸€ç›´æ‰©å±•åˆ°é›¶ï¼Œè€Œæ— éœ€ä»»ä½•è¿è¥å·¥ä½œæˆ–ç»´æŠ¤ğŸ¤—ğŸ¤—ã€‚

```
docker build -t gcr.io/<your google project id>/monkeys  .
docker push gcr.io/<your google project id>/monkeys
```

ç°åœ¨è®©æˆ‘ä»¬è¿›å…¥[è°·æ­Œæ§åˆ¶å°äº‘è¿è¡ŒæœåŠ¡](https://console.cloud.google.com/run)ï¼

![](img/9a9022ce8b049726c9496a7f40d35a2f.png)

é€‰æ‹©åˆ›å»ºæœåŠ¡

åœ¨ä¸‹ä¸€é¡µä¸­ï¼Œå•å‡»å®¹å™¨å›¾åƒ URL ä¸­çš„â€œé€‰æ‹©â€æŒ‰é’®

![](img/dddcb185706beee864a3b63547c19e92.png)

ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€‰æ‹©æˆ‘ä»¬æ¨é€çš„å®¹å™¨

![](img/45b3fb214e13c0b5b4477404b9b544d3.png)

å‘½åæœåŠ¡å¹¶ç‚¹å‡»åˆ›å»ºï¼

![](img/c7146f8b47e32a381903f955de38b4bf.png)

å¤§çº¦ 30 ç§’åï¼Œæ‚¨å°†é€šè¿‡ ssl åœ¨çº¿éƒ¨ç½²æ–°çš„ api

![](img/06ea851a23c9adda94316b85295e06ed.png)

ç‚¹å‡»æ–°çš„ç½‘å€ï¼Œç§ï¼æ‚¨å¿…é¡»å°† swagger.json æ›´æ”¹ä¸ºæ–°åœ°å€ã€‚è¿›è¡Œæ›´æ”¹ï¼Œç„¶ååœ¨ swagger ui ä¸­ç‚¹å‡»â€œExploreâ€ã€‚

![](img/1592d163631ffe74b8b205e543000fbd.png)

ä½ ç°åœ¨å¯èƒ½æ˜ç™½ä¸ºä»€ä¹ˆæˆ‘æ„Ÿè§‰æœ‰ç‚¹è½åäº†ã€‚æˆ‘ç°åœ¨ä¸å†éœ€è¦äº†

*   å†™çŒ´å­ä»£ç 
*   å†™æ„šè ¢çš„æ ·æ¿æ–‡ä»¶
*   ç¼–å†™ docker æ–‡ä»¶
*   å†™å…è®¸åŠ å¯† crons
*   è®¾ç½®æœåŠ¡å™¨
*   ç®¡ç†æœåŠ¡å™¨
*   å‡Œæ™¨ 2 ç‚¹æ¥åˆ°ç”µè¯ï¼Œå› ä¸ºæœåŠ¡ä¸­æ–­
*   æ‹…å¿ƒæˆæœ¬(å®ƒéšç€ä½¿ç”¨æƒ…å†µä¸Šä¸‹æ³¢åŠ¨)
*   å› ä¸ºåœ£è¯è´Ÿè½½é¢„æœŸè€Œæ—‹è½¬ 30 c5xl è€Œè¢«å¼

æˆ‘å¯ä»¥åœ¨å¤§çº¦ä¸€åˆ†é’Ÿå†…å®Œæˆæ‰€æœ‰è¿™äº›(ä¸€æ—¦ä½ åšäº†å‡ æ¬¡)

é‚£ä¹ˆæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿä¸»è¦æ˜¯å› ä¸ºè¿™ä¸ªé¡¹ç›®è¿˜å¾ˆå¹´è½»ã€‚

è¿™æ˜¯å…³äºè¿™ä¸ªé¡¹ç›®çš„æ›´å¤šä¿¡æ¯

# ç‰¹å¾ğŸ™‰

*   ç”Ÿæˆç®€å•çš„èŠ‚ç‚¹ä»£ç 
*   ä½¿ç”¨ Mongodb å’Œ Mongoose ORM
*   æ˜“äºæ„å»º/éƒ¨ç½²/ç»´æŠ¤
*   åŒ…æ‹¬ Dockerfile æ–‡ä»¶
*   ç”Ÿæˆ CRUD API
    â€”create
    â€”get(å¤šï¼Œå¸¦åˆ†é¡µï¼›æ”¯æŒæœç´¢ã€æ’åºã€è¿‡æ»¤ã€å¼€ç®±åˆ†é¡µ)
    â€” getOne
    â€”æ›´æ–°
    â€”åˆ é™¤

# å®ƒæ“…é•¿ä»€ä¹ˆğŸ™Š

*   ç”Ÿæˆåˆå§‹ API
*   é¢å‘å¾®æœåŠ¡
    -å‡†å¤‡éƒ¨ç½²(ä½¿ç”¨ docker = > deploy æ„å»º)

# (ç›®å‰)å®ƒä¸æ“…é•¿ä»€ä¹ˆğŸ™ˆ

*   å¹‚ç­‰å˜åŒ–(ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¸çŸ¥é“ä½ æ˜¯å¦åœ¨é‚£é‡Œå†™äº†ä»£ç æˆ–è€…æ”¹å˜äº†å‘¨å›´çš„ä¸œè¥¿)
*   ä½¿ç”¨ä¿®æ”¹åçš„ä»£ç 
*   å¡«å……è¡¨è¿æ¥
*   æ§åˆ¶å™¨å‡½æ•°ä¸­çš„è‡ªå®šä¹‰æ“ä½œ

æˆ‘åœ¨ [SugarKubes](https://sugarkubes.io) åˆ¶ä½œå„ç§æœ‰è¶£çš„ä¸œè¥¿ã€‚è®©æˆ‘çŸ¥é“ä½ æ­£åœ¨ç”¨ **sugar-generate** æ„å»ºä»€ä¹ˆï¼Œä»¥åŠä½ æƒ³çœ‹åˆ°ä»€ä¹ˆç‰¹æ€§ï¼

æ‹¥æŠ±ï¼Œ

ç¾å›½è”åˆé€šè®¯ç¤¾(Associated Press)