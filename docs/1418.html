<html>
<head>
<title>How to handle the POST request body in Dart without using a framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•åœ¨ä¸ä½¿ç”¨æ¡†æ¶çš„æƒ…å†µä¸‹å¤„ç†Dartä¸­çš„POSTè¯·æ±‚ä¸»ä½“</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/how-to-handle-the-post-request-body-in-dart-without-using-a-framework-c56f12744fd2?source=collection_archive---------3-----------------------#2018-10-10">https://itnext.io/how-to-handle-the-post-request-body-in-dart-without-using-a-framework-c56f12744fd2?source=collection_archive---------3-----------------------#2018-10-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4b9d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">äº†è§£å¦‚ä½•å¤„ç†å¯¹æœåŠ¡å™¨çš„POSTè¯·æ±‚</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e81f018e5938c25ebe4a35e9c28e210a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DdEaYGpfvt63a3eyrJ6-HQ.png"/></div></div></figure><p id="5691" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">åœ¨è¿™ç¯‡ä¸å‡ ä¸ªæœˆå‰æˆ‘åœ¨Node.jsä¸Šå†™çš„æ–‡ç« ç›¸å…³çš„æ–‡ç« ä¸­ï¼Œæˆ‘å°†å±•ç¤ºæˆ‘ä»¬å¦‚ä½•åœ¨Dartä¸­å¤„ç†POSTè¯·æ±‚çš„æœ‰æ•ˆè´Ÿè½½ã€‚è¿™é‡Œå‡è®¾è¿™ä¸ªæœ‰æ•ˆè´Ÿè½½çš„<code class="fe lo lp lq lr b">Content-Type</code>æ˜¯<code class="fe lo lp lq lr b">application/x-www-form-urlencoded</code>ï¼Œå®ƒæœ¬è´¨ä¸Šæè¿°äº†æ ¼å¼åŒ–ä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²çš„æ•°æ®ã€‚</p><h1 id="a736" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">1.åˆ›å»ºæˆ‘ä»¬çš„æœåŠ¡å™¨</h1><p id="6378" class="pw-post-body-paragraph kr ks iq kt b ku mk jr kw kx ml ju kz la mm lc ld le mn lg lh li mo lk ll lm ij bi translated">åˆ›å»ºä¸€ä¸ª<code class="fe lo lp lq lr b">main.dart</code>æ–‡ä»¶ï¼Œå¹¶è¾“å…¥ä¸‹é¢çš„ä»£ç ç‰‡æ®µ:</p><pre class="kg kh ki kj gt mp lr mq mr aw ms bi"><span id="059f" class="mt lt iq lr b gy mu mv l mw mx"><strong class="lr ir">import 'dart:io'</strong>;</span><span id="ca05" class="mt lt iq lr b gy my mv l mw mx">void <strong class="lr ir">main</strong>() <strong class="lr ir">async</strong> {<br/>  var <strong class="lr ir">server</strong> = <strong class="lr ir">await HttpServer.bind</strong>('localhost', 9000);</span><span id="71d2" class="mt lt iq lr b gy my mv l mw mx">  <strong class="lr ir">await for (HttpRequest req in server) {</strong><br/>    <strong class="lr ir">req.response</strong><br/>      ..<strong class="lr ir">headers.set</strong>('Content-Type', 'text/html')<br/>      ..<strong class="lr ir">write</strong>('''<br/>        &lt;!doctype html&gt;<br/>        &lt;html&gt;<br/>        &lt;body&gt;<br/>          &lt;form action="/" method="post"&gt;<br/>            &lt;input type="text" name="fname" /&gt;&lt;br /&gt;<br/>            &lt;input type="number" name="age" /&gt;&lt;br /&gt;<br/>            &lt;input type="file" name="photo" /&gt;&lt;br /&gt;<br/>            &lt;button&gt;Save&lt;/button&gt;<br/>          &lt;/form&gt;<br/>        &lt;/body&gt;<br/>        &lt;/html&gt;<br/>      ''')<br/>      ..<strong class="lr ir">close()</strong>;<br/>  <strong class="lr ir">}<br/></strong>}</span></pre><p id="289b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è¿™å°†å¼•å¯¼æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼Œå¹¶åœ¨å‘<code class="fe lo lp lq lr b">http://localhost:9000</code>å‘å‡ºè¯·æ±‚æ—¶ç”¨ä¸€ä¸ªè¡¨å•è¿›è¡Œå“åº”ã€‚è¯¥ä»£ç ç‰‡æ®µä»å¯¼å…¥<code class="fe lo lp lq lr b">dart:io</code>åº“å¼€å§‹ï¼Œå› ä¸ºå®ƒåŒ…å«äº†åˆ›å»ºæœåŠ¡å™¨æ‰€éœ€çš„ç±»ã€‚æ•´ä¸ªå¼•å¯¼è¿‡ç¨‹å‘ç”Ÿåœ¨ä¸€ä¸ª<code class="fe lo lp lq lr b">main()</code>å‡½æ•°ä¸­ï¼Œè¿è¡Œæˆ‘ä»¬çš„Dartåº”ç”¨ç¨‹åºéœ€è¦è¿™ä¸ªå‡½æ•°ã€‚</p><p id="2e74" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è¦è¿è¡Œè¯¥æ–‡ä»¶ï¼Œè¯·åœ¨ç»ˆç«¯ä¸­é”®å…¥ä»¥ä¸‹å‘½ä»¤:</p><pre class="kg kh ki kj gt mp lr mq mr aw ms bi"><span id="df26" class="mt lt iq lr b gy mu mv l mw mx">dart main.dart</span></pre><p id="57eb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æ‚¨åº”è¯¥ä¼šåœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°ä¸€ä¸ªè¡¨å•:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/76a8b293e600ee61302080bfb2088b4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P_LvxhXS4JcmEzefXvy_lw.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">åœ¨http://localhost:9000æä¾›çš„html</figcaption></figure><h1 id="9940" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">2.æ•è·å‘å¸ƒçš„æœ‰æ•ˆè´Ÿè½½</h1><p id="96f8" class="pw-post-body-paragraph kr ks iq kt b ku mk jr kw kx ml ju kz la mm lc ld le mn lg lh li mo lk ll lm ij bi translated">ç°åœ¨è®©æˆ‘ä»¬ç¡®ä¿æˆ‘ä»¬æ­£åœ¨å¤„ç†ä¸€ä¸ªPOSTè¯·æ±‚:</p><pre class="kg kh ki kj gt mp lr mq mr aw ms bi"><span id="4644" class="mt lt iq lr b gy mu mv l mw mx">...<br/>...</span><span id="580f" class="mt lt iq lr b gy my mv l mw mx">await for (HttpRequest req in server) {<br/>  <strong class="lr ir">if (req.method == 'POST') {</strong><br/>   <strong class="lr ir">// deal with the payload</strong>  <br/>  <strong class="lr ir">} else {</strong><br/>    req.response<br/>      ..headers.set('Content-Type', 'text/html')<br/>      ..write('''<br/>        &lt;!doctype html&gt;<br/>        &lt;html&gt;<br/>        &lt;body&gt;<br/>          &lt;form action="/" method="post"&gt;<br/>            &lt;input type="text" name="fname" /&gt;&lt;br /&gt;<br/>            &lt;input type="number" name="age" /&gt;&lt;br /&gt;<br/>            &lt;input type="file" name="photo" /&gt;&lt;br /&gt;<br/>            &lt;button&gt;Save&lt;/button&gt;<br/>          &lt;/form&gt;<br/>        &lt;/body&gt;<br/>        &lt;/html&gt;<br/>      ''')<br/>      ..close();<br/>  <strong class="lr ir">}</strong><br/>}</span></pre><p id="1c4c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¯¹æœåŠ¡å™¨çš„è¯·æ±‚è¢«è§†ä¸ºä¸€ä¸ª<code class="fe lo lp lq lr b">Stream</code>ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯·æ±‚çš„<code class="fe lo lp lq lr b">transform</code>æ–¹æ³•æ¥è§£ç å†…å®¹ã€‚</p><pre class="kg kh ki kj gt mp lr mq mr aw ms bi"><span id="3488" class="mt lt iq lr b gy mu mv l mw mx">if (req.method == 'POST') {<br/>  var content = <strong class="lr ir">await req.transform().join()</strong>;<br/>} ...</span></pre><p id="b2e4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è¿™ä¸ä¼šé©¬ä¸Šç”Ÿæ•ˆï¼Œå› ä¸º<code class="fe lo lp lq lr b">transform</code>æ–¹æ³•éœ€è¦ä¸€ä¸ª<code class="fe lo lp lq lr b">StreamTransformer</code>ã€‚ä¸€ä¸ª<code class="fe lo lp lq lr b">StreamTransformer</code>åŒ…å«ä¸€ä¸ª<code class="fe lo lp lq lr b">bind</code>æ–¹æ³•ï¼Œå…è®¸å®ƒä»¥æŸç§æ–¹å¼æ“ä½œæµæ•°æ®ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ¥å°†æˆ‘ä»¬çš„æµæ•°æ®è½¬æ¢æˆå¯è¯»çš„æ ¼å¼ï¼Œç„¶åä½¿ç”¨<code class="fe lo lp lq lr b">join</code>æ–¹æ³•æ¥ç»„åˆæˆ‘ä»¬çš„<em class="ne">è½¬æ¢åçš„</em>å—ã€‚</p><p id="2f68" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">åœ¨æˆ‘ä»¬çš„<code class="fe lo lp lq lr b">dart:io</code>å¯¼å…¥ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦<code class="fe lo lp lq lr b">dart:convert</code>åº“:</p><pre class="kg kh ki kj gt mp lr mq mr aw ms bi"><span id="0a87" class="mt lt iq lr b gy mu mv l mw mx">import 'dart:io';<br/><strong class="lr ir">import 'dart:convert';</strong></span></pre><p id="9aba" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¹¶å°†<code class="fe lo lp lq lr b">Utf8Decoder</code>ç”¨ä½œæˆ‘ä»¬çš„å˜å‹å™¨:</p><pre class="kg kh ki kj gt mp lr mq mr aw ms bi"><span id="a573" class="mt lt iq lr b gy mu mv l mw mx">var content = await req.transform(<strong class="lr ir">Utf8Decoder()</strong>).join();</span></pre><p id="ab15" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¦‚æœæ‚¨åœ¨è¡¨æ ¼ä¸­å¡«å†™äº†ç›¸å…³çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ‰“å°å‡ºçš„<code class="fe lo lp lq lr b">content</code>å°†ä¼šç»™å‡ºä»¥ä¸‹ç»“æœ:</p><pre class="kg kh ki kj gt mp lr mq mr aw ms bi"><span id="43b8" class="mt lt iq lr b gy mu mv l mw mx">fname<strong class="lr ir">=</strong>John<strong class="lr ir">&amp;</strong>age=30<strong class="lr ir">&amp;</strong>photo<strong class="lr ir">=</strong>file.jpg</span></pre><p id="85c4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ç„¶è€Œï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦ä»æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­æå–ä¿¡æ¯çš„é”®/å€¼å¯¹ã€‚å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨æ ¸å¿ƒDart SDKä¸­æœ‰ä¸€ä¸ª<code class="fe lo lp lq lr b">Uri</code>ç±»:</p><pre class="kg kh ki kj gt mp lr mq mr aw ms bi"><span id="7f6f" class="mt lt iq lr b gy mu mv l mw mx">var content = await req.transform(Utf8Decoder()).join();<br/>var queryParams = <strong class="lr ir">Uri(query: content).queryParameters</strong>;</span></pre><h1 id="e33b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">3.å›å¤å¸–å­</h1><p id="66de" class="pw-post-body-paragraph kr ks iq kt b ku mk jr kw kx ml ju kz la mm lc ld le mn lg lh li mo lk ll lm ij bi translated">ç°åœ¨è®©æˆ‘ä»¬å‘å›ä¸€ä¸ªå“åº”:</p><pre class="kg kh ki kj gt mp lr mq mr aw ms bi"><span id="bb58" class="mt lt iq lr b gy mu mv l mw mx">var content = await req.transform(Utf8Decoder()).join();<br/>var queryParams = Uri(query: content).queryParameters;</span><span id="b6b6" class="mt lt iq lr b gy my mv l mw mx"><strong class="lr ir">req.response<br/>  ..write('Parsed data belonging to ${queryParams['fname']}')<br/>  ..close();</strong></span></pre><p id="832f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">æ›´æ–°20/10/2018</strong>:<a class="nf ng ep" href="https://medium.com/u/fc8b5cd1b260?source=post_page-----c56f12744fd2--------------------------------" rel="noopener" target="_blank">to be O</a>(<em class="ne">åˆ›å»ºè€…</em> <a class="ae ln" href="https://github.com/angel-dart/angel" rel="noopener ugc nofollow" target="_blank"> <em class="ne">å¤©ä½¿</em> </a>)æœ‰ç”¨çš„æŒ‡å‡ºäº†ä½¿ç”¨<code class="fe lo lp lq lr b">splitQueryString</code>é™æ€æ–¹æ³•æå–æŸ¥è¯¢å‚æ•°:</p><pre class="kg kh ki kj gt mp lr mq mr aw ms bi"><span id="78c1" class="mt lt iq lr b gy mu mv l mw mx">// var queryParams = Uri(query: content).queryParameters;<br/><strong class="lr ir">var queryParams = Uri.splitQueryString(content);</strong></span></pre><p id="81d1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬çš„æŸ¥è¯¢å‚æ•°ä½œä¸ºä¸€ä¸ª<code class="fe lo lp lq lr b">Map</code>å¯¹è±¡è¿”å›ï¼Œå…è®¸æˆ‘ä»¬åƒè¿™æ ·æå–æˆ‘ä»¬çš„å€¼:</p><pre class="kg kh ki kj gt mp lr mq mr aw ms bi"><span id="2ef0" class="mt lt iq lr b gy mu mv l mw mx">queryParams['fname'];<br/>queryParams['age'];<br/>queryParams['photo'];</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/a2a0562c461b2308ca6a4ceef031676b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N46Xjfd8VD9NDTcNSs5W7A.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">æˆ‘ä»¬å‘å¸ƒè¯·æ±‚çš„å“åº”</figcaption></figure><p id="2aef" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ä»¥ä¸‹æ˜¯å®Œæ•´çš„è§£å†³æ–¹æ¡ˆ:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">å®Œæˆçš„ä»£ç ğŸ¯</figcaption></figure><h1 id="bb04" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">æœ€åâ€¦</h1><p id="ea7b" class="pw-post-body-paragraph kr ks iq kt b ku mk jr kw kx ml ju kz la mm lc ld le mn lg lh li mo lk ll lm ij bi translated">ä¸ç›¸å…³çš„æ–‡ç« ä¸€æ ·ï¼Œå¦‚æœæœ‰æ•ˆè´Ÿè½½å†…å®¹ç±»å‹æ˜¯<code class="fe lo lp lq lr b">application/x-www-form-urlencoded</code>ï¼Œè¿™ç§æ–¹æ³•æ˜¯å¯è¡Œçš„ï¼Œå¦‚æœè§£æå…¶ä»–å†…å®¹ç±»å‹ï¼Œåˆ™éœ€è¦ä¸åŒçš„æ–¹æ³•ã€‚æˆ‘ä»¬å°†åœ¨ä»¥åçš„æ–‡ç« ä¸­è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚</p><p id="dbfc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">è®¢é˜…</strong><a class="ae ln" href="https://www.youtube.com/channel/UCHSRZk4k6e-hqIXBBM4b2iA?view_as=subscriber" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir">Youtubeé¢‘é“</strong> </a> <strong class="kt ir">äº†è§£Dart </strong>ä¸Šå³å°†æ¨å‡ºçš„è§†é¢‘ã€‚è°¢è°¢ï¼</p><p id="a907" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">å–œæ¬¢ï¼Œåˆ†äº«ï¼Œå…³æ³¨æˆ‘</strong>ğŸ˜æœ‰å…³Dartçš„æ›´å¤šå†…å®¹ã€‚</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h1 id="ea81" class="ls lt iq bd lu lv nr lx ly lz ns mb mc jw nt jx me jz nu ka mg kc nv kd mi mj bi translated">è¿›ä¸€æ­¥é˜…è¯»</h1><ol class=""><li id="048a" class="nw nx iq kt b ku mk kx ml la ny le nz li oa lm ob oc od oe bi translated"><a class="ae ln" href="https://www.dartlang.org/tutorials/dart-vm/httpserver#run-the-hello-world-server" rel="noopener ugc nofollow" target="_blank">Dartä¸­çš„Hello worldæœåŠ¡å™¨</a></li><li id="c6a3" class="nw nx iq kt b ku of kx og la oh le oi li oj lm ob oc od oe bi translated"><a class="ae ln" href="https://www.dartlang.org/articles/libraries/creating-streams" rel="noopener ugc nofollow" target="_blank">åœ¨Dartä¸­åˆ›å»ºæµ</a></li><li id="9910" class="nw nx iq kt b ku of kx og la oh le oi li oj lm ob oc od oe bi translated"><a class="ae ln" href="https://egghead.io/instructors/jermaine-oppong" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir">egghead . ioä¸Šçš„å…è´¹é£é•–æˆªå±</strong> </a></li></ol></div></div>    
</body>
</html>