<html>
<head>
<title>How to Build a Serverless Apollo GraphQL Server with AWS Lambda, Webpack and TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•ç”¨AWS Lambdaã€Webpackå’ŒTypeScriptæ„å»ºä¸€ä¸ªæ— æœåŠ¡å™¨çš„Apollo GraphQLæœåŠ¡å™¨</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/how-to-build-a-serverless-apollo-graphql-server-with-aws-lambda-webpack-and-typescript-64a377739208?source=collection_archive---------0-----------------------#2020-08-05">https://itnext.io/how-to-build-a-serverless-apollo-graphql-server-with-aws-lambda-webpack-and-typescript-64a377739208?source=collection_archive---------0-----------------------#2020-08-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/d81e6d03d1f9d29c21af8db793614824.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eqd5IINl2uTIGkdA4po_oQ.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">HawaiÊ»iè«çº³å…‹äºšå±±çš„æ˜Ÿç©º(å›¾ç‰‡æ¥æº:<a class="ae kf" href="http://http://derekfong.me" rel="noopener ugc nofollow" target="_blank">æ–¹å¿—ä¼Ÿ</a></figcaption></figure><p id="1263" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">åœ¨æˆ‘ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘å·²ç»å±•ç¤ºäº†<a class="ae kf" href="https://medium.com/free-code-camp/build-an-apollo-graphql-server-with-typescript-and-webpack-hot-module-replacement-hmr-3c339d05184f" rel="noopener">å¦‚ä½•ç”¨<a class="ae kf" href="https://medium.com/better-programming/how-to-integrate-an-apollo-graphql-server-with-mongodb-and-typescript-code-generator-b029d821591" rel="noopener">ä¸€äº›æˆ‘åœ¨å¼€å‘é˜¶æ®µå‘ç°æœ‰ç”¨çš„å¸¸ç”¨å·¥å…·é›†</a>æ„å»ºä¸€ä¸ªâ€œHello Worldâ€Apollo graph QLæœåŠ¡å™¨</a>ã€‚æˆ‘å¸Œæœ›æ‚¨å·²ç»äº†è§£äº†æˆ‘ä»¬çš„GraphQLä¹‹æ—…ï¼Œç°åœ¨åˆ°äº†æ‚¨çš„ApolloæœåŠ¡å™¨å¯ä»¥éƒ¨ç½²çš„æ—¶å€™äº†ï¼</p><h1 id="4723" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">æœåŠ¡å™¨æˆ–æ— æœåŠ¡å™¨â€”äº¤æ˜“æ˜¯ä»€ä¹ˆï¼Ÿ</h1><figure class="md me mf mg gt ju gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/375746cab89aeef2f0dfcbcfcb426985.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*LAuBD6ZqBqhNo_bllBHjHw.jpeg"/></div></figure><p id="f97b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ä¸ºä»€ä¹ˆæ²¡æœ‰æœåŠ¡å™¨ï¼Ÿè¿™å¯èƒ½æ˜¯æ‚¨å…¬å¸çš„è§£å†³æ–¹æ¡ˆæ¶æ„å¸ˆä¸ºæ‚¨å³å°†åˆ°æ¥çš„é¡¹ç›®åšå‡ºçš„å†³å®šï¼Œæˆ–è€…æ‚¨å¬åˆ°äº†å…³äºâ€œç°ä»£æ— æœåŠ¡å™¨æ–¹æ³•â€çš„<a class="ae kf" href="https://hackernoon.com/what-is-serverless-architecture-what-are-its-pros-and-cons-cc4b804022e9" rel="noopener ugc nofollow" target="_blank">å¥½(æˆ–å)</a>çš„äº‹æƒ…ï¼Œå¹¶ä¸”åªæ˜¯æƒ³å°è¯•ä¸€ä¸‹â€¦â€¦æ— è®ºæ‚¨çš„ç†ç”±æ˜¯ä»€ä¹ˆï¼Œæˆ‘éƒ½ä¼šä¸ºæ‚¨æä¾›å¸®åŠ©ğŸ˜‰</p><h1 id="85aa" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">æ­¥éª¤1:è®¾ç½®AWSç¯å¢ƒ</h1><p id="613e" class="pw-post-body-paragraph kg kh it ki b kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ml lb lc ld im bi translated">åœ¨å¼€å§‹åŠ¨æ‰‹ç¼–å†™ä»£ç ä¹‹å‰ï¼Œæ‚¨éœ€è¦åœ¨æ‚¨çš„è®¡ç®—æœºä¸Šè¿›è¡Œä¸€äº›é…ç½®ã€‚æˆ‘ä¸å¾—ä¸è¯´è¿™ä¸€æ­¥å¹¶ä¸æœ‰è¶£ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ­£ç¡®è®¾ç½®æˆ‘ä»¬çš„éƒ¨ç½²é…ç½®è‡³å…³é‡è¦ï¼Œå¦‚æœæ‚¨éµå¾ªä¸‹é¢çš„å…³é”®æ­¥éª¤ï¼Œå®Œæˆé…ç½®åº”è¯¥ä¸ä¼šèŠ±è´¹å¤ªé•¿æ—¶é—´ã€‚</p><p id="3453" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æˆ‘ä»¬å°†åœ¨<a class="ae kf" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank">äºšé©¬é€Šç½‘ç»œæœåŠ¡(AWS) </a>ä¸Šéƒ¨ç½²æˆ‘ä»¬çš„ApolloæœåŠ¡å™¨ã€‚<a class="ae kf" href="https://portal.aws.amazon.com/billing/signup" rel="noopener ugc nofollow" target="_blank">åˆ›å»ºä¸€ä¸ªAWSè´¦æˆ·</a>ï¼Œå¦‚æœä½ è¿˜æ²¡æœ‰çš„è¯ã€‚è™½ç„¶AWSæ˜¯ä¸€ä¸ªæä¾›<a class="ae kf" href="https://aws.amazon.com/pricing" rel="noopener ugc nofollow" target="_blank">ä»˜è´¹æœåŠ¡</a>çš„å¹³å°ï¼Œä½†å®ƒä¹Ÿåœ¨<a class="ae kf" href="https://aws.amazon.com/free" rel="noopener ugc nofollow" target="_blank"> AWSå…è´¹å±‚</a>ä¸‹æä¾›å¤§é‡çš„å…è´¹ä½¿ç”¨ï¼Œè¿™åº”è¯¥è¶³ä»¥æ¶µç›–æœ¬æ–‡ä¸­çš„ä½¿ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‚¨ä»ç„¶éœ€è¦äº†è§£<a class="ae kf" href="https://aws.amazon.com/pricing" rel="noopener ugc nofollow" target="_blank">å®šä»·</a>ï¼Œå¹¶è€ƒè™‘<a class="ae kf" href="https://aws.amazon.com/premiumsupport/knowledge-center/free-tier-charges" rel="noopener ugc nofollow" target="_blank">åˆ¶å®šè®¡åˆ’æ¥ç®¡ç†æœåŠ¡å’Œæ¶ˆè€—çš„èµ„æº</a>ä»¥<a class="ae kf" href="https://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/checklistforunwantedcharges" rel="noopener ugc nofollow" target="_blank">é¿å…æ„å¤–è´¹ç”¨</a>ã€‚</p><p id="a57b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ä¸€æ—¦ä½ è®¾ç½®å¥½AWSè´¦æˆ·ï¼Œä½ éœ€è¦<a class="ae kf" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install" rel="noopener ugc nofollow" target="_blank">åœ¨ä½ çš„ç”µè„‘ä¸Šå®‰è£…æœ€æ–°ç‰ˆæœ¬çš„AWS CLI </a>ã€‚å®‰è£…å®Œæˆåï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿è¡Œ<code class="fe mm mn mo mp b">aws</code>å‘½ä»¤æ¥éªŒè¯å®‰è£…ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤è¿”å›æ‚¨è®¡ç®—æœºä¸Šå®‰è£…çš„å½“å‰AWS CLIç‰ˆæœ¬:</p><pre class="md me mf mg gt mq mp mr ms aw mt bi"><span id="165f" class="mu lf it mp b gy mv mw l mx my">$ aws --version</span><span id="6af1" class="mu lf it mp b gy mz mw l mx my">aws-cli/2.0.23 Python/3.7.4 Darwin/18.7.0 botocore/2.0.0</span></pre><p id="18e0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦<a class="ae kf" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html" rel="noopener ugc nofollow" target="_blank">ä½¿ç”¨ç”¨æˆ·å‡­è¯é…ç½®AWS CLI</a>ã€‚åŸºæœ¬ä¸Šï¼Œæ‚¨éœ€è¦åšçš„å°±æ˜¯è¿è¡Œ<code class="fe mm mn mo mp b">aws configure</code>å‘½ä»¤ï¼Œå®ƒä¼šæç¤ºæ‚¨è¾“å…¥å››æ¡ä¿¡æ¯:</p><ul class=""><li id="4262" class="na nb it ki b kj kk kn ko kr nc kv nd kz ne ld nf ng nh ni bi translated"><a class="ae kf" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html#cli-configure-quickstart-creds" rel="noopener ugc nofollow" target="_blank">è®¿é—®å¯†é’¥ID </a></li><li id="8ca9" class="na nb it ki b kj nj kn nk kr nl kv nm kz nn ld nf ng nh ni bi translated"><a class="ae kf" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html#cli-configure-quickstart-creds" rel="noopener ugc nofollow" target="_blank">ç§˜å¯†è®¿é—®å¯†é’¥</a></li><li id="be70" class="na nb it ki b kj nj kn nk kr nl kv nm kz nn ld nf ng nh ni bi translated"><a class="ae kf" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html#cli-configure-quickstart-region" rel="noopener ugc nofollow" target="_blank"> AWSåŒºåŸŸ</a></li><li id="732e" class="na nb it ki b kj nj kn nk kr nl kv nm kz nn ld nf ng nh ni bi translated"><a class="ae kf" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html#cli-configure-quickstart-format" rel="noopener ugc nofollow" target="_blank">è¾“å‡ºæ ¼å¼</a></li></ul><p id="a4f7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æŒ‰ç…§æœ¬<a class="ae kf" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart" rel="noopener ugc nofollow" target="_blank">å¿«é€Ÿå…¥é—¨æŒ‡å—</a>è·å–AWS CLIæ‰€éœ€çš„å€¼ã€‚<strong class="ki iu">ä½œä¸º</strong> <a class="ae kf" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#lock-away-credentials" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">çš„æœ€ä½³å®è·µ</strong> </a> <strong class="ki iu">ï¼Œè¯·åŠ¡å¿…åœ¨æ‚¨</strong> <a class="ae kf" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/getting-started_create-admin-group.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">åˆ›å»ºç®¡ç†å‘˜IAMç”¨æˆ·å’Œç»„</strong> </a> <strong class="ki iu">æ—¶åˆ›å»ºè®¿é—®é”®ã€‚</strong></p><pre class="md me mf mg gt mq mp mr ms aw mt bi"><span id="0bed" class="mu lf it mp b gy mv mw l mx my">$ aws configure</span><span id="4ea3" class="mu lf it mp b gy mz mw l mx my">AWS Access Key ID [None]: AKIAIOSFODNN7EXAMPLE<br/>AWS Secret Access Key [None]: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY<br/>Default region name [None]: us-west-2<br/>Default output format [None]: json</span></pre><p id="797d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">AWS CLIå°†æ­¤ä¿¡æ¯å­˜å‚¨åœ¨å‡­è¯æ–‡ä»¶ä¸­åä¸º<code class="fe mm mn mo mp b">default</code>çš„<a class="ae kf" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-profiles" rel="noopener ugc nofollow" target="_blank">é…ç½®æ–‡ä»¶</a>(ä¸€ç»„è®¾ç½®)ä¸­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æ‚¨è¿è¡Œä¸€ä¸ªæ²¡æœ‰æ˜ç¡®æŒ‡å®šè¦ä½¿ç”¨çš„é…ç½®æ–‡ä»¶çš„<code class="fe mm mn mo mp b">aws</code> CLIå‘½ä»¤æ—¶ï¼Œä¼šä½¿ç”¨è¯¥é…ç½®æ–‡ä»¶ä¸­çš„ä¿¡æ¯ã€‚æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œ<code class="fe mm mn mo mp b">aws configure list</code>å‘½ä»¤æ¥æ£€æŸ¥å½“å‰çš„é…ç½®æ•°æ®:</p><pre class="md me mf mg gt mq mp mr ms aw mt bi"><span id="6776" class="mu lf it mp b gy mv mw l mx my">$ aws configure list</span><span id="e1fd" class="mu lf it mp b gy mz mw l mx my">Name                    Value             Type    Location</span><span id="3c44" class="mu lf it mp b gy mz mw l mx my">----                    -----             ----    --------</span><span id="ab19" class="mu lf it mp b gy mz mw l mx my">profile                &lt;not set&gt;             None    None</span><span id="26de" class="mu lf it mp b gy mz mw l mx my">access_key     ****************ABCD      config_file    ~/.aws/config</span><span id="b397" class="mu lf it mp b gy mz mw l mx my">secret_key     ****************ABCD      config_file    ~/.aws/config</span><span id="7ad2" class="mu lf it mp b gy mz mw l mx my">region                us-west-2              env    AWS_DEFAULT_REGION</span></pre><figure class="md me mf mg gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/aab9d087363efc2d8990169fe12b5be3.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*e3AWQ6qMLAACf75ZTrgsAg.jpeg"/></div></figure><p id="19cf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å”·~å°±æ˜¯è¿™æ ·ï¼æ‚¨çš„è®¡ç®—æœºç°åœ¨å·²è®¾ç½®ä¸ºä¸AWSäº¤äº’ã€‚</p><h1 id="e053" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">ç¬¬äºŒæ­¥:å®‰è£…<code class="fe mm mn mo mp b">apollo-server-lambda</code></h1><figure class="md me mf mg gt ju gh gi paragraph-image"><div class="gh gi np"><img src="../Images/0f45761b95b3b741e6132967c7831242.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*bku2p1PhzcBBj-azpri-xw.jpeg"/></div></figure><p id="fac1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">åˆ›å»ºä¸€ä¸ªåä¸º<code class="fe mm mn mo mp b">demo-apollo-server-lambda</code>çš„æ–°æ–‡ä»¶å¤¹ï¼Œåˆå§‹åŒ–é¡¹ç›®å¹¶å®‰è£…<code class="fe mm mn mo mp b">apollo-server-lambda</code>ã€‚</p><pre class="md me mf mg gt mq mp mr ms aw mt bi"><span id="188a" class="mu lf it mp b gy mv mw l mx my">$ mkdir demo-apollo-server-lambda &amp;&amp; cd demo-apollo-server-lambda<br/>$ npm init --yes<br/>$ npm install --save apollo-server-lambda graphql</span></pre><p id="3dd5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å› ä¸ºæˆ‘ä»¬ä½¿ç”¨TypeScriptï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…<code class="fe mm mn mo mp b">typescript</code>ä½œä¸ºå¼€å‘ä¾èµ–:</p><pre class="md me mf mg gt mq mp mr ms aw mt bi"><span id="81e8" class="mu lf it mp b gy mv mw l mx my">$ npm install --save-dev typescript</span></pre><p id="1079" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å¹¶ä¸ºæ‚¨çš„é¡¹ç›®æ ¹åˆ›å»ºä¸€ä¸ª<code class="fe mm mn mo mp b"><a class="ae kf" href="https://www.typescriptlang.org/docs/handbook/tsconfig-json.html" rel="noopener ugc nofollow" target="_blank">tsconfig.json</a></code>ã€‚</p><p id="1497" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ğŸ“„æ–‡ä»¶:<code class="fe mm mn mo mp b">tsconfig.json</code></p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="2312" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æ¥ä¸‹æ¥ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code class="fe mm mn mo mp b">/src</code>æ–‡ä»¶å¤¹ã€‚å°†<a class="ae kf" href="https://www.apollographql.com/docs/tutorial/schema" rel="noopener ugc nofollow" target="_blank"> GraphQLæ¨¡å¼çš„ç±»å‹å®šä¹‰</a> ( <code class="fe mm mn mo mp b">type-defs.ts</code>)å’Œ<a class="ae kf" href="https://www.apollographql.com/docs/tutorial/resolvers/" rel="noopener ugc nofollow" target="_blank">è§£æå™¨</a> ( <code class="fe mm mn mo mp b">resolvers.ts</code>)æ·»åŠ åˆ°<code class="fe mm mn mo mp b">/src</code>æ–‡ä»¶å¤¹ä¸­ã€‚</p><p id="037c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ğŸ“„æ–‡ä»¶:<code class="fe mm mn mo mp b">src/type-defs.ts</code></p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="b8b9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ğŸ“„æ–‡ä»¶:<code class="fe mm mn mo mp b">src/resolvers.ts</code></p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="a2fd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æ¥ä¸‹æ¥ï¼Œåœ¨<code class="fe mm mn mo mp b">/src</code>æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª<code class="fe mm mn mo mp b">apollo-server.ts</code>ã€‚ä½ å¯èƒ½ä¼šæ³¨æ„åˆ°è¿™ä¸æˆ‘ä»¬ç”¨â€œä¼ ç»Ÿâ€æœåŠ¡å™¨æ–¹æ³•è®¾ç½®ApolloæœåŠ¡å™¨çš„<a class="ae kf" href="https://medium.com/free-code-camp/build-an-apollo-graphql-server-with-typescript-and-webpack-hot-module-replacement-hmr-3c339d05184f" rel="noopener">éå¸¸ç›¸ä¼¼ï¼Œé™¤äº†æˆ‘ä»¬æ²¡æœ‰ç”¨<code class="fe mm mn mo mp b">listen()</code>è¿è¡ŒæœåŠ¡å™¨ï¼Œè€Œæ˜¯åˆ›å»ºäº†ä¸€ä¸ªå¤„ç†ç¨‹åºå¹¶å°†å…¶å¯¼å‡ºä¸º<code class="fe mm mn mo mp b">graphqlHandler</code>ã€‚</a></p><p id="e0ff" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ğŸ“„æ–‡ä»¶:<code class="fe mm mn mo mp b">src/apollo-server.ts</code></p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><h1 id="1547" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">æ­¥éª¤3:å®‰è£…æ— æœåŠ¡å™¨æ¡†æ¶</h1><p id="a4d9" class="pw-post-body-paragraph kg kh it ki b kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ml lb lc ld im bi translated">ç°åœ¨æˆ‘ä»¬å·²ç»ç”¨TypeScriptå®ç°äº†ApolloæœåŠ¡å™¨ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚ä½•â€œè¿è¡Œâ€æœåŠ¡å™¨å‘¢ï¼Ÿä¸â€œä¼ ç»Ÿâ€æœåŠ¡å™¨ä¸åŒï¼Œä½ ä¸èƒ½ç®€å•åœ°è¿è¡Œ<code class="fe mm mn mo mp b">npm start</code>å¹¶æœŸæœ›æˆ‘ä»¬çš„â€œæ— æœåŠ¡å™¨â€ApolloæœåŠ¡å™¨ç¥å¥‡åœ°å“åº”ä»»ä½•ä¼ å…¥çš„è¯·æ±‚ã€‚æˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬çš„ApolloæœåŠ¡å™¨â€œè½¬æ¢â€æˆæˆ‘ä»¬çš„å¹³å°æä¾›å•†(åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯AWS)ç†è§£çš„æ— æœåŠ¡å™¨åŠŸèƒ½(Lambdas)ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œä½ å¯ä»¥è¯•ç€ç”¨å¼ºç¡¬çš„æ–¹å¼å»åšï¼Œå¹¶è‡ªå·±å»å®ç°ï¼›æˆ–è€…ï¼Œå¦‚æœä½ åƒæˆ‘ä¸€æ ·æ˜¯ä¸ªæ‡’äººï¼Œæˆ‘ä»¬ä¸å¦¨åˆ©ç”¨å…¶ä»–èªæ˜äººå·²ç»å»ºç«‹çš„æ¡†æ¶ã€‚</p><h2 id="c470" class="mu lf it bd lg ns nt dn lk nu nv dp lo kr nw nx ls kv ny nz lw kz oa ob ma oc bi translated">ä»‹ç»â€œ<a class="ae kf" href="https://www.serverless.com/" rel="noopener ugc nofollow" target="_blank">æ— æœåŠ¡å™¨æ¡†æ¶</a></h2><p id="e02d" class="pw-post-body-paragraph kg kh it ki b kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ml lb lc ld im bi translated"><a class="ae kf" href="https://www.serverless.com/" rel="noopener ugc nofollow" target="_blank">æ— æœåŠ¡å™¨æ¡†æ¶</a>æä¾›å·¥å…·å’Œç»„ä»¶ï¼Œå¸®åŠ©<em class="od">å¼€å‘ã€éƒ¨ç½²ã€æ•…éšœæ’é™¤å’Œä¿æŠ¤æ— æœåŠ¡å™¨åº”ç”¨ï¼ŒåŒæ—¶å¤§å¹…é™ä½å¼€é”€å’Œæˆæœ¬</em>ã€‚å®ƒæ”¯æŒå¤šç§å¹³å°(ä¾‹å¦‚AWSã€Azureã€Google Cloudç­‰ã€‚)ä»¥åŠä¸åŒçš„ç¼–ç¨‹è¯­è¨€å’Œæ¡†æ¶(å¦‚NodeJSã€Pythonã€Goã€Javaç­‰ã€‚).<a class="ae kf" href="https://www.serverless.com/framework/docs" rel="noopener ugc nofollow" target="_blank">å®˜æ–¹æ— æœåŠ¡å™¨æ–‡æ¡£</a>æä¾›äº†ä¸€äº›ä¸é”™çš„æ•™ç¨‹å’Œä¾‹å­ï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºæ— æœåŠ¡å™¨æ¡†æ¶çš„çŸ¥è¯†ï¼Œä¸€å®šè¦å»çœ‹çœ‹ã€‚</p><p id="c0b1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å¤Ÿäº†ï¼Œæ²¡æœ‰æœåŠ¡å™¨çš„è°ˆè¯ğŸ˜ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦å®‰è£…æ¥è‡ªNPMçš„<em class="od">æ— æœåŠ¡å™¨æ¡†æ¶</em>:</p><pre class="md me mf mg gt mq mp mr ms aw mt bi"><span id="0769" class="mu lf it mp b gy mv mw l mx my">$ npm install -g serverless</span></pre><p id="de05" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å¹¶åœ¨æ‚¨çš„é¡¹ç›®æ ¹ä¸­åˆ›å»ºä¸€ä¸ª<code class="fe mm mn mo mp b">serverless.yml</code>ã€‚</p><p id="d226" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ğŸ“„æ–‡ä»¶:<code class="fe mm mn mo mp b">serverless.yml</code></p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="72ad" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mm mn mo mp b">serverless.yml</code>éå¸¸ç®€å•:å¾ˆå¯èƒ½ä½ åªéœ€è¦æ›¿æ¢<code class="fe mm mn mo mp b">services</code>å’Œ<code class="fe mm mn mo mp b">region</code>çš„å€¼æ¥æ»¡è¶³ä½ çš„éœ€è¦ã€‚å¦‚æœæ‚¨éœ€è¦é…ç½®çš„æ›´å¤šç»†èŠ‚ï¼Œè¯·å‚è€ƒ<code class="fe mm mn mo mp b"><a class="ae kf" href="https://www.serverless.com/framework/docs/providers/aws/guide/serverless.yml" rel="noopener ugc nofollow" target="_blank">serverless.yml</a></code> <a class="ae kf" href="https://www.serverless.com/framework/docs/providers/aws/guide/serverless.yml" rel="noopener ugc nofollow" target="_blank">å‚è€ƒ</a>ã€‚</p><p id="b30a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">åœ¨<code class="fe mm mn mo mp b">serverless.yml</code>ä¸­ï¼Œä½ å¯èƒ½ä¼šæ³¨æ„åˆ°åŒ…å«äº†ä¸€ä¸ª<code class="fe mm mn mo mp b">serverless-webpack</code>æ’ä»¶ï¼Œä½ å¯èƒ½ä¼šæƒ³ä¸ºä»€ä¹ˆæˆ‘ä»¬ä½¿ç”¨<a class="ae kf" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"> Webpack </a>æ¥ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç ï¼Ÿ</p><p id="142b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ä¸åƒé•¿æœŸè¿è¡Œçš„æœåŠ¡å™¨åªå¯åŠ¨ä¸€æ¬¡ï¼Œç„¶åè¿è¡Œå‡ å¤©ï¼Œæ— æœåŠ¡å™¨Lambdaså¯èƒ½ä¼šåœ¨æ¯æ¬¡è¢«è°ƒç”¨æ—¶è§¦å‘å†·å¯åŠ¨ï¼Œå› æ­¤è¾ƒå°çš„æ†ç»‘æ¨¡å—æˆ–å¤šæˆ–å°‘ä¼šæœ‰åŠ©äºæé«˜æ€§èƒ½ã€‚å…‹é‡Œæ–¯Â·é˜¿å§†æ–¯ç‰¹æœ—å†™çš„è¿™ç¯‡æ–‡ç« è¯¦ç»†åœ°è§£é‡Šäº†è¿™ä¸ªè¯é¢˜ã€‚</p><p id="f503" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">è¦å°†<code class="fe mm mn mo mp b"><a class="ae kf" href="https://github.com/serverless-heaven/serverless-webpack" rel="noopener ugc nofollow" target="_blank">serverless-webpack</a></code>æ’ä»¶æ·»åŠ åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…ä¸€äº›å¼€å‘ä¾èµ–åŒ…:</p><pre class="md me mf mg gt mq mp mr ms aw mt bi"><span id="340c" class="mu lf it mp b gy mv mw l mx my">$ npm install --save-dev serverless-webpack webpack webpack-node-externals ts-loader</span></pre><p id="93df" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å¹¶åœ¨æ‚¨çš„é¡¹ç›®æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª<code class="fe mm mn mo mp b"><a class="ae kf" href="https://webpack.js.org/configuration" rel="noopener ugc nofollow" target="_blank">webpack.config.js</a></code>ã€‚</p><p id="6135" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ğŸ“„æ–‡ä»¶:<code class="fe mm mn mo mp b">webpack.config.js</code></p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="5c58" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ç°åœ¨æ˜¯æ—¶å€™éƒ¨ç½²æˆ‘ä»¬çš„é˜¿æ³¢ç½—æœåŠ¡å™¨äº†ï¼å¦‚æœæ‚¨æ­£ç¡®åœ°éµå¾ªäº†è¿™äº›æ­¥éª¤å¹¶è¿è¡Œ:</p><pre class="md me mf mg gt mq mp mr ms aw mt bi"><span id="a20c" class="mu lf it mp b gy mv mw l mx my">$ serverless deploy --stage prod</span></pre><p id="ea33" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mm mn mo mp b">serverless</code>åº”è¯¥è¾“å‡ºç±»ä¼¼äºè¿™ä¸ªä¾‹å­çš„ä¸œè¥¿:</p><pre class="md me mf mg gt mq mp mr ms aw mt bi"><span id="2908" class="mu lf it mp b gy mv mw l mx my">$ serverless deploy --stage prod</span><span id="1824" class="mu lf it mp b gy mz mw l mx my">Serverless: Bundling with Webpack...<br/>Time: 3894ms<br/>Built at: 08/04/2020 9:53:38 PM<br/>Asset      Size  Chunks             Chunk Names<br/>src/apollo-server.js  10.6 KiB       0  [emitted]  src/apollo-server<br/>Entrypoint src/apollo-server = src/apollo-server.js<br/>[0] external "apollo-server-lambda" 42 bytes {0} [built]<br/>[1] ./src/apollo-server.ts 449 bytes {0} [built]<br/>[2] ./src/resolvers.ts 193 bytes {0} [built]<br/>[3] ./src/type-defs.ts 294 bytes {0} [built]<br/>Serverless: Package lock found - Using locked versions<br/>Serverless: Packing external modules: apollo-server-lambda@^2.16.1, graphql@^15.3.0<br/>Serverless: Packaging service...<br/>Serverless: Creating Stack...<br/>Serverless: Checking Stack create progress...<br/>........<br/>Serverless: Stack create finished...<br/>Serverless: Uploading CloudFormation file to S3...<br/>Serverless: Uploading artifacts...<br/>Serverless: Uploading service demo-apollo-server-lambda.zip file to S3 (6.07 MB)...<br/>Serverless: Validating template...<br/>Serverless: Updating Stack...<br/>Serverless: Checking Stack update progress...<br/>....................................<br/>Serverless: Stack update finished...<br/>Service Information<br/>service: demo-apollo-server-lambda<br/>stage: prod<br/>region: ap-southeast-2<br/>stack: demo-apollo-server-lambda-prod<br/>resources: 13<br/>api keys:<br/>None<br/>endpoints:<br/>POST - <a class="ae kf" href="https://abcde12345.execute-api.ap-southeast-2.amazonaws.com/prod/graphql" rel="noopener ugc nofollow" target="_blank">https://abcde12345.execute-api.ap-southeast-2.amazonaws.com/prod/graphql</a><br/>GET - <a class="ae kf" href="https://abcde12345.execute-api.ap-southeast-2.amazonaws.com/prod/graphql" rel="noopener ugc nofollow" target="_blank">https://abcde12345.execute-api.ap-southeast-2.amazonaws.com/prod/graphql</a><br/>functions:<br/>graphql: demo-apollo-server-lambda-prod-graphql<br/>layers:<br/>None</span></pre><p id="6ecb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æ³¨æ„è¾“å‡ºä¸­çš„<code class="fe mm mn mo mp b">POST</code>ç«¯ç‚¹ã€‚è¿™æ˜¯ä½ çš„é˜¿æ³¢ç½—æœåŠ¡å™¨çš„ç½‘å€ã€‚ç°åœ¨ä½ å¯ä»¥å°è¯•ç”¨è¯¸å¦‚<a class="ae kf" href="https://learning.postman.com/docs/sending-requests/supported-api-frameworks/graphql" rel="noopener ugc nofollow" target="_blank"> Postman </a>æˆ–<a class="ae kf" href="https://developer.github.com/v4/guides/forming-calls/#communicating-with-graphql" rel="noopener ugc nofollow" target="_blank"> cURL </a>ä¹‹ç±»çš„å·¥å…·æŸ¥è¯¢ä½ çš„ApolloæœåŠ¡å™¨:</p><pre class="md me mf mg gt mq mp mr ms aw mt bi"><span id="4e0f" class="mu lf it mp b gy mv mw l mx my"># POST Request.<br/>query GetTestMessage {<br/>  testMessage<br/>}</span></pre><p id="7bc4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å®ƒåº”è¯¥ç”¨ä¸€ä¸ª<code class="fe mm mn mo mp b">Hello World!</code>æ¶ˆæ¯æ¥å“åº”ã€‚</p><pre class="md me mf mg gt mq mp mr ms aw mt bi"><span id="5cca" class="mu lf it mp b gy mv mw l mx my">{<br/>  "data": {<br/>    "testMessage": "Hello World!"<br/>  }<br/>}</span></pre><p id="7570" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æ­å–œä½ ï¼æ‚¨å·²ç»æˆåŠŸéƒ¨ç½²äº†æ‚¨çš„ç¬¬ä¸€å°æ— æœåŠ¡å™¨ApolloæœåŠ¡å™¨ï¼</p><h1 id="3b0a" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">ç¬¬å››æ­¥:åœ°æ–¹å‘å±•</h1><p id="f178" class="pw-post-body-paragraph kg kh it ki b kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ml lb lc ld im bi translated">ç°åœ¨æˆ‘ä»¬å·²ç»ç”¨AWS Lambdaéƒ¨ç½²äº†æˆ‘ä»¬çš„ApolloæœåŠ¡å™¨â€¦ä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦æ›´æ–°æˆ–å¢å¼ºæˆ‘ä»¬çš„æœåŠ¡å™¨å‘¢ï¼Ÿâ€œæ— æœåŠ¡å™¨â€æ˜¯å¦æ„å‘³ç€æˆ‘ä»¬éœ€è¦å°†æ¯ä¸ªä»£ç å˜æ›´éƒ½éƒ¨ç½²åˆ°AWS Lambdaä¸Šä»¥ä¾¿è¿›è¡Œæµ‹è¯•ï¼Ÿå¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªæ— æœåŠ¡å™¨æ’ä»¶å¯ä»¥åœ¨æœ¬åœ°æ¨¡æ‹ŸAWS Lambdaå’ŒAPI Gatewayï¼Œä»¥åŠ å¿«å¼€å‘å‘¨æœŸã€‚</p><p id="b8cb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å¯ç”¨è¿™ä¸ªæ’ä»¶æ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚é¦–å…ˆï¼Œå®‰è£…NPMè½¯ä»¶åŒ…:</p><pre class="md me mf mg gt mq mp mr ms aw mt bi"><span id="288f" class="mu lf it mp b gy mv mw l mx my">$ npm install --save-dev serverless-offline</span></pre><p id="700e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å¹¶å°†<code class="fe mm mn mo mp b">serverless-offline</code>æ’ä»¶æ·»åŠ åˆ°<code class="fe mm mn mo mp b">serverless.yml</code>ï¼Œåœ¨<code class="fe mm mn mo mp b">serverless-webpack</code>ä¹‹å:</p><p id="9c38" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ğŸ“„æ–‡ä»¶:<code class="fe mm mn mo mp b">serverless.yml</code></p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="eae4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å°±æ˜¯è¿™æ ·ï¼ç°åœ¨å¦‚æœä½ è·‘:</p><pre class="md me mf mg gt mq mp mr ms aw mt bi"><span id="c692" class="mu lf it mp b gy mv mw l mx my">$ serverless offline start</span></pre><p id="4b7f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡º:</p><pre class="md me mf mg gt mq mp mr ms aw mt bi"><span id="2d07" class="mu lf it mp b gy mv mw l mx my">POST  <a class="ae kf" href="http://localhost:3000/dev/graphql" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/dev/graphql</a><br/>POST  <a class="ae kf" href="http://localhost:3000/2015-03-31/functions/graphql/invocations" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/2015-03-31/functions/graphql/invocations</a><br/>GET   <a class="ae kf" href="http://localhost:3000/dev/graphql" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/dev/graphql</a><br/>POST  <a class="ae kf" href="http://localhost:3000/2015-03-31/functions/graphql/invocations" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/2015-03-31/functions/graphql/invocations</a></span><span id="2ab0" class="mu lf it mp b gy mz mw l mx my"><br/>offline: [HTTP] server ready: http://localhost:3000 ğŸš€<br/>offline:<br/>offline: Enter "rp" to replay the last request</span></pre><p id="8017" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ç°åœ¨ï¼Œå¦‚æœæ‚¨å°è¯•å¯¹<code class="fe mm mn mo mp b">http://localhost:3000/dev/graphql</code>ã€<br/>è¿è¡ŒGraphQL <code class="fe mm mn mo mp b">testMessage</code>æŸ¥è¯¢ï¼Œæ‚¨åº”è¯¥ä¼šå¾—åˆ°ç›¸åŒçš„<code class="fe mm mn mo mp b">Hello World!</code>å“åº”ã€‚</p><h1 id="9f70" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">æ­¥éª¤5:ç®¡ç†ç¯å¢ƒå˜é‡</h1><p id="7ee9" class="pw-post-body-paragraph kg kh it ki b kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ml lb lc ld im bi translated">åœ¨æ„å»ºçœŸå®ä¸–ç•Œçš„åº”ç”¨ç¨‹åºæ—¶ï¼Œæ‚¨å¾ˆå¯èƒ½å¿…é¡»å¤„ç†ç‰¹å®šäºç¯å¢ƒçš„é…ç½®ï¼Œä¾‹å¦‚<code class="fe mm mn mo mp b">DEV</code> / <code class="fe mm mn mo mp b">PROD</code>ç¯å¢ƒçš„æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼Œæˆ–è€…ä¸åº”è¯¥ç­¾å…¥æºä»£ç æ§åˆ¶çš„æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚æ•°æ®åº“å‡­è¯ã€‚</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/8f69bcbe240922f76fb4c35116b9b5c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Nb4OMuKCTtNSTbJ7PPsfnQ.jpeg"/></div></figure><p id="7d93" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å¦‚æœæ‚¨ä¸€ç›´åœ¨ä»äº‹Node.jsé¡¹ç›®ï¼Œæˆ‘æ‰“èµŒæ‚¨ä¸€ç›´åœ¨ä½¿ç”¨(æˆ–è€…è‡³å°‘å¬è¯´è¿‡)NPMåŒ…ã€‚å¯¹äº<code class="fe mm mn mo mp b">serverless</code>é¡¹ç›®ï¼Œæœ‰ä¸€ä¸ªç±»ä¼¼äº<code class="fe mm mn mo mp b">.env</code>çš„æ’ä»¶ï¼Œå¸®åŠ©ç®¡ç†ä¸åŒç¯å¢ƒä¸­çš„ç¯å¢ƒå˜é‡å¹¶å°†å…¶é¢„åŠ è½½åˆ°æ— æœåŠ¡å™¨ä¸­ã€‚æ‰€ä»¥è®©æˆ‘ä»¬ç»§ç»­å®‰è£…è¿™ä¸ªæ’ä»¶:</p><pre class="md me mf mg gt mq mp mr ms aw mt bi"><span id="672b" class="mu lf it mp b gy mv mw l mx my">$ npm install --save-dev serverless-dotenv-plugin</span></pre><p id="f053" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æ¥ä¸‹æ¥ï¼Œå°†æ’ä»¶æ·»åŠ åˆ°<code class="fe mm mn mo mp b">serverless.yml</code>ä¸­ï¼Œä½œä¸º<code class="fe mm mn mo mp b">plugins</code>ä¸‹çš„ç¬¬ä¸€é¡¹ã€‚</p><p id="178a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ğŸ“„æ–‡ä»¶:<code class="fe mm mn mo mp b">serverless.yml</code></p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="e814" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ç°åœ¨ï¼Œä¸ºäº†æ¼”ç¤ºå®ƒå¦‚ä½•è·¨ä¸åŒçš„ç¯å¢ƒå·¥ä½œï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸¤ä¸ª<code class="fe mm mn mo mp b">.env</code>æ–‡ä»¶:ä¸€ä¸ªç”¨äº<code class="fe mm mn mo mp b">development</code>ï¼Œå¦ä¸€ä¸ªç”¨äº<code class="fe mm mn mo mp b">production</code>ã€‚</p><p id="fc01" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ğŸ“„æ–‡ä»¶:<code class="fe mm mn mo mp b">.env.development</code></p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="d7d6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ğŸ“„æ–‡ä»¶:<code class="fe mm mn mo mp b">.env.production</code></p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="5bab" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">åœ¨<code class="fe mm mn mo mp b">src</code>ä¸‹åˆ›å»ºä¸€ä¸ª<code class="fe mm mn mo mp b">environment.ts</code>æ–‡ä»¶ï¼Œç±»ä¼¼äºæˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­å¯¹<a class="ae kf" href="https://medium.com/free-code-camp/build-an-apollo-graphql-server-with-typescript-and-webpack-hot-module-replacement-hmr-3c339d05184f" rel="noopener">çš„æ“ä½œ:</a></p><p id="5a1e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ğŸ“„æ–‡ä»¶:<code class="fe mm mn mo mp b">src/environment.ts</code></p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="c609" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å¹¶æ›´æ–°<code class="fe mm mn mo mp b">src/resolvers.ts</code>ä»¥ä»<code class="fe mm mn mo mp b">environment.ts</code>è·å–å€¼ã€‚</p><p id="5843" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ğŸ“„æ–‡ä»¶:<code class="fe mm mn mo mp b">src/resolvers.ts</code></p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="2f52" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mm mn mo mp b">serverless-dotenv-plugin</code> <a class="ae kf" href="https://github.com/colynb/serverless-dotenv-plugin#automatic-env-file-resolution-as-of-verson-30-thanks-to-danilofuchs" rel="noopener ugc nofollow" target="_blank">æ ¹æ®æ‚¨çš„ç›®æ ‡ç¯å¢ƒ</a>è‡ªåŠ¨è§£ææ­£ç¡®çš„ <code class="fe mm mn mo mp b"><a class="ae kf" href="https://github.com/colynb/serverless-dotenv-plugin#automatic-env-file-resolution-as-of-verson-30-thanks-to-danilofuchs" rel="noopener ugc nofollow" target="_blank">.env</a></code> <a class="ae kf" href="https://github.com/colynb/serverless-dotenv-plugin#automatic-env-file-resolution-as-of-verson-30-thanks-to-danilofuchs" rel="noopener ugc nofollow" target="_blank">æ–‡ä»¶ã€‚è¦æŸ¥çœ‹å®é™…æƒ…å†µï¼Œè¯·å°è¯•åœ¨æœ¬åœ°å¯åŠ¨æœåŠ¡å™¨:</a></p><pre class="md me mf mg gt mq mp mr ms aw mt bi"><span id="8599" class="mu lf it mp b gy mv mw l mx my">$ serverless offline start</span></pre><p id="4121" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å¹¶å°è¯•åœ¨<code class="fe mm mn mo mp b"><a class="ae kf" href="http://localhost:3000/dev/graphql:" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/dev/graphql</a></code> <a class="ae kf" href="http://localhost:3000/dev/graphql:" rel="noopener ugc nofollow" target="_blank"> : </a>ä¸Šè¿è¡ŒGraphQL <code class="fe mm mn mo mp b">testMessage</code>æŸ¥è¯¢</p><pre class="md me mf mg gt mq mp mr ms aw mt bi"><span id="dc21" class="mu lf it mp b gy mv mw l mx my">query GetTestMessage {<br/>  testMessage<br/>}</span></pre><p id="7914" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æ‚¨åº”è¯¥ä¼šå¾—åˆ°ä»¥ä¸‹å“åº”:</p><pre class="md me mf mg gt mq mp mr ms aw mt bi"><span id="739e" class="mu lf it mp b gy mv mw l mx my">{<br/>  "data": {<br/>    "testMessage": "Secret message for DEV!"<br/>  }<br/>}</span></pre><p id="ffaf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ç°åœ¨ï¼Œå¦‚æœæ‚¨å°è¯•å°†æ›´æ”¹éƒ¨ç½²åˆ°AWS Lambdaä¸Š:</p><pre class="md me mf mg gt mq mp mr ms aw mt bi"><span id="1ab9" class="mu lf it mp b gy mv mw l mx my">$ NODE_ENV=production serverless deploy --stage prod</span></pre><p id="5cf2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å¹¶å°è¯•åœ¨æ‚¨çš„Lambda URLä¸Šè¿è¡Œç›¸åŒçš„GraphQL <code class="fe mm mn mo mp b">testMessage</code>æŸ¥è¯¢ï¼Œæ‚¨åº”è¯¥å¾—åˆ°ä»¥ä¸‹å“åº”:</p><pre class="md me mf mg gt mq mp mr ms aw mt bi"><span id="efe9" class="mu lf it mp b gy mv mw l mx my">{<br/>  "data": {<br/>    "testMessage": "Secret message for PROD!"<br/>  }<br/>}</span></pre><p id="66db" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å¦‚æœæ‚¨ç™»å½•åˆ°<a class="ae kf" href="https://aws.amazon.com/console" rel="noopener ugc nofollow" target="_blank"> AWSç®¡ç†æ§åˆ¶å°</a>å¹¶æŸ¥æ‰¾æ‚¨åˆšåˆšéƒ¨ç½²çš„Apollo Server Lambdaï¼Œæ‚¨åº”è¯¥çœ‹åˆ°æ¥è‡ª<code class="fe mm mn mo mp b">.env.production</code>çš„ç¯å¢ƒå˜é‡è¢«æ³¨å…¥åˆ°æ‚¨çš„<a class="ae kf" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-envvars" rel="noopener ugc nofollow" target="_blank"> Apollo Server Lambdaçš„ç¯å¢ƒå˜é‡</a>ã€‚</p><h1 id="a200" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">æœ€å:æ¸…ç†</h1><p id="636e" class="pw-post-body-paragraph kg kh it ki b kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ml lb lc ld im bi translated">å¦‚æœ¬æ–‡å¼€å¤´æ‰€è¿°ï¼Œå°½ç®¡AWSä¸ºå…¶å¤§éƒ¨åˆ†æœåŠ¡æä¾›å…è´¹ç­‰çº§ä½¿ç”¨ï¼Œä½†å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºä½¿ç”¨é‡è¶…è¿‡å…è´¹ç­‰çº§ï¼Œä»ä¼šæ¶‰åŠå®šä»·ã€‚ä½œä¸ºä¸€ä¸ªç»éªŒæ³•åˆ™ï¼Œæ€»æ˜¯ç§¯æä¸»åŠ¨åœ°ç®¡ç†ä½ çš„åº”ç”¨ç¨‹åºçš„ä½¿ç”¨ï¼Œå¹¶ç§»é™¤ä»»ä½•ä¸å†ä½¿ç”¨çš„èµ„æºï¼Œä»¥é¿å…æ„å¤–çš„è´¹ç”¨ã€‚</p><p id="7a29" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ä¸Šè¿°<code class="fe mm mn mo mp b">serverless remove</code>å‘½ä»¤åº”åˆ é™¤å·²éƒ¨ç½²çš„æœåŠ¡ã€‚</p><pre class="md me mf mg gt mq mp mr ms aw mt bi"><span id="e93f" class="mu lf it mp b gy mv mw l mx my">$ serverless remove --stage prod</span></pre><p id="9203" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å¹¶ä¸”æ‚¨å¯ä»¥éªŒè¯åœ¨<a class="ae kf" href="https://aws.amazon.com/console" rel="noopener ugc nofollow" target="_blank"> AWSç®¡ç†æ§åˆ¶å°</a>ä¸­ä¸åº”è¯¥ç•™ä¸‹éƒ¨ç½²è¶³è¿¹ã€‚</p><h1 id="268f" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">åŒ…æ‰</h1><p id="9c24" class="pw-post-body-paragraph kg kh it ki b kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ml lb lc ld im bi translated">å°±è¿™æ ·äº†ã€‚æˆ‘å¸Œæœ›ä½ å–œæ¬¢è¯»è¿™ç¯‡æ–‡ç« :)</p><p id="cc91" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æºä»£ç å¯ä»¥åœ¨GitHubä¸Šæ‰¾åˆ°:<br/><a class="ae kf" href="https://github.com/derek-fong/demo-apollo-server-lambda" rel="noopener ugc nofollow" target="_blank">https://github.com/derek-fong/demo-apollo-server-lambda</a></p><p id="3a04" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æˆ‘ç›¸ä¿¡æ— æœåŠ¡å™¨åº”ç”¨ç¨‹åºæœ‰å¾ˆå¤§çš„æ½œåŠ›ã€‚å½“æ— æœåŠ¡å™¨æ–¹æ³•å¼€å§‹æµè¡Œèµ·æ¥çš„æ—¶å€™ï¼Œçœ‹çœ‹æœªæ¥å‡ å¹´åœ¨å¼€å‘é¢†åŸŸä¼šå‘ç”Ÿä»€ä¹ˆä¼šå¾ˆæœ‰è¶£ã€‚ç„¶è€Œï¼Œå°±åƒä¸€èˆ¬çš„è½¯ä»¶å¼€å‘ä¸€æ ·ï¼Œæ— æœåŠ¡å™¨æ–¹æ³•ä¸æ˜¯ä¸€ä¸ªä¸‡çµè¯ï¼Œåœ¨ä¸‹ä¸€ä¸ªé¡¹ç›®é‡‡ç”¨æ— æœåŠ¡å™¨ä¹‹å‰ï¼Œå½“æ‚¨æƒè¡¡æ¯ç§éƒ¨ç½²ç­–ç•¥çš„åˆ©å¼Šæ—¶ï¼Œæ‚¨åº”è¯¥çŸ¥é“å¥½çš„ã€åçš„å’Œä¸å¥½çš„ã€‚</p><p id="8aee" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å–œæ¬¢è¯»æˆ‘çš„æ•…äº‹å—ï¼Ÿè¯·ç•™ä¸‹ä¸€äº›æŒå£°ğŸ‘ğŸ»ä¸‹é¢æ˜¯æˆ‘çš„ä¸€äº›å…¶ä»–å…³äºGraphQLçš„æ–‡ç« ï¼Œä½ å¯èƒ½ä¼šæ„Ÿå…´è¶£:</p><ul class=""><li id="8001" class="na nb it ki b kj kk kn ko kr nc kv nd kz ne ld nf ng nh ni bi translated"><a class="ae kf" href="https://medium.com/free-code-camp/build-an-apollo-graphql-server-with-typescript-and-webpack-hot-module-replacement-hmr-3c339d05184f" rel="noopener">å¦‚ä½•ä½¿ç”¨TypeScriptå’ŒWebpackçƒ­æ¨¡å—æ›¿æ¢æ„å»ºApollo GraphQLæœåŠ¡å™¨</a></li><li id="839a" class="na nb it ki b kj nj kn nk kr nl kv nm kz nn ld nf ng nh ni bi translated"><a class="ae kf" href="https://medium.com/better-programming/how-to-integrate-an-apollo-graphql-server-with-mongodb-and-typescript-code-generator-b029d821591" rel="noopener">å¦‚ä½•å°†Apollo GraphQLæœåŠ¡å™¨ä¸MongoDBå’ŒTypeScriptä»£ç ç”Ÿæˆå™¨é›†æˆ</a></li><li id="be55" class="na nb it ki b kj nj kn nk kr nl kv nm kz nn ld nf ng nh ni bi translated">â€¦å¾ˆå¿«ä¼šæœ‰æ›´å¤šçš„é€‰æ‹©ï¼</li></ul><p id="e2d7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å¯¹æˆ‘ä¸‹ä¸€ä¸ªä¸»é¢˜çš„é—®é¢˜ã€åé¦ˆæˆ–å»ºè®®ï¼Ÿè¯·åœ¨ä¸‹é¢ç•™è¨€ğŸ’ğŸ»â€â™‚ï¸</p></div></div>    
</body>
</html>