# é€šè¿‡ Rust ä»‹ç» WebAssembly

> åŸæ–‡ï¼š<https://itnext.io/intro-to-webassembly-via-rust-7365464868bf?source=collection_archive---------3----------------------->

## é¢å‘ Javascript å¼€å‘äººå‘˜(ä½†ä¸ä»…ä»…æ˜¯)ï¼

![](img/53bf402d7b932fe9c5ca9afc32835a59.png)

å£°æ˜:è¿™ç¯‡æ–‡ç« ä¸ä¼šæ•™ä½  Rustï¼Œå…¶åŠ¨æœºæ˜¯è®©ä½ åœ¨ç›´è§‚çš„ Rust ç”Ÿæ€ç³»ç»Ÿä¸Šä½¿ç”¨ä»¤äººæƒŠå¹çš„ **wasm-pack** å·¥å…·å¿«é€Ÿè¿›å…¥ WASMã€‚

ä¸ä¹…å‰æˆ‘å¼€å§‹å¯¹**é”ˆæ„Ÿå…´è¶£-** æ€ä¹ˆä¼šè¿™æ ·ï¼Ÿ

å›´ç»• WASM(ç½‘ç»œç»„è£…)æœ‰ä¸€åœºç‚’ä½œï¼Œå®ƒå¼•å‘äº†æˆ‘æƒ³å°è¯•æ–°äº‹ç‰©çš„éœ€æ±‚..æˆ‘æƒ³æˆä¸ºé‚£ä¸ªæ´¾å¯¹çš„ä¸€éƒ¨åˆ†ğŸ‰ ğŸŠ ğŸˆã€‚

æˆ‘å¼€å§‹é˜…è¯»ä¸€äº›å…³äº wasm [è¿™é‡Œ](https://webassembly.org/)å’Œ[é‚£é‡Œ](https://developer.mozilla.org/en-US/docs/WebAssembly)çš„èµ„æ–™:

> â€œWebAssembly æ˜¯ä¸€ç§å¯ä»¥åœ¨ç°ä»£ web æµè§ˆå™¨ä¸­è¿è¡Œçš„æ–°å‹ä»£ç ï¼Œå®ƒæ˜¯ä¸€ç§ä½çº§çš„ç±»ä¼¼æ±‡ç¼–çš„è¯­è¨€ï¼Œå…·æœ‰ç´§å‡‘çš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œä»¥æ¥è¿‘æœ¬æœºçš„æ€§èƒ½è¿è¡Œï¼Œå¹¶ä¸º C/C++å’Œ Rust ç­‰è¯­è¨€æä¾›ç¼–è¯‘ç›®æ ‡ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥åœ¨ web ä¸Šè¿è¡Œã€‚å®ƒè¿˜è¢«è®¾è®¡æˆä¸ JavaScript å¹¶è¡Œè¿è¡Œï¼Œå…è®¸ä¸¤è€…ååŒå·¥ä½œã€‚â€

## ä¸ WASM åšå£«ä¸€èµ·ï¼Œæˆ‘ä»¬å¯ä»¥:

*   ç¼–è¯‘å…¶ä»–é«˜çº§è¯­è¨€ä»£ç å¹¶åœ¨æµè§ˆå™¨ä¸­è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼(å¤ªé…·äº†ğŸ˜).
*   è·å¾—(å‡ ä¹)åŸç”Ÿæ€§èƒ½ã€‚
*   ç›´æ¥ä» JavaScript åŠ è½½å’Œæ‰§è¡Œ WASM äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶ä¸ JavaScript ä»£ç äº¤æ¢æ•°æ®ã€‚

## ä¸º WASM è€Œæ¥ï¼Œä¸ºé“é”ˆè€Œç•™

æˆ‘å¯ä»¥è¿è¡Œä¸€ä¸ªâ€œhello worldâ€æˆ–å…¶ä»–åŸºæœ¬ç¤ºä¾‹ï¼Œä½†æ˜¯æˆ‘æœ‰ç‚¹æƒ³è¦å­¦ä¹ å¦ä¸€ç§è¯­è¨€çš„æœºä¼š(æ–°çš„ç”Ÿæ€ç³»ç»Ÿï¼Œæ–°çš„ä¸–ç•Œï¼).

å­¦ä¹ ä¸€é—¨æ–°çš„è¯­è¨€ä¼šè®©ä½ æ›´å¥½åœ°æŒæ¡ä½ çš„ä¸»è¦è¯­è¨€ï¼Œå› ä¸ºä½ ä¼šåœä¸‹æ¥æ€è€ƒä¸åŒä¹‹å¤„ï¼Œæ­¤å¤–ï¼Œä½ ä¼šå¯»æ‰¾ç†Ÿæ‚‰çš„æ¨¡å¼ï¼Œè¿™ä¼šè®©ä½ å˜å¾—æ›´æ•é”ã€‚

æˆ‘ä¸å¾—ä¸é€‰æ‹© C/C++æˆ– Rustï¼Œä¸ºä»€ä¹ˆæˆ‘é€‰æ‹©äº† **Rust** ï¼Ÿ

æˆ‘æ²¡æœ‰è¿›è¡Œä»»ä½•å½»åº•çš„ç ”ç©¶å°±é€‰æ‹©äº† Rustï¼ŒåŸå› å¦‚ä¸‹:

1.  å®ƒç›¸å½“æ–°ï¼Œ **new =é—ªäº®çš„**ï¼Œå¹¶ä¸”åº”ç”¨äº†ä»æ—§è¯­è¨€å’Œç”Ÿæ€ç³»ç»Ÿâ€œé”™è¯¯â€ä¸­å¸å–çš„ç»éªŒæ•™è®­ï¼Œæˆ–è€…é‡‡ç”¨äº†è‰¯å¥½çš„å®è·µã€‚(æˆ‘çœŸçš„å¾ˆå¥½å¥‡)ã€‚
2.  å®ƒæ˜¯ç”±æˆ‘éå¸¸æ¬£èµçš„ **Mozilla** äººåˆ›å»ºçš„(ä»–ä»¬ä¸ mdn docs ä¸€èµ·åšäº†ä¸€é¡¹äº†ä¸èµ·çš„å·¥ä½œï¼Œè¿™ä¸ªä¼Ÿå¤§çš„ç¤¾åŒºæ¨åŠ¨äº†æœ‰è¶£çš„å¼€æºé¡¹ç›®ï¼Œå¦‚ [a-frame](https://aframe.io/) ã€ [servo](https://github.com/servo) ã€[mozillating](https://iot.mozilla.org/)s ç­‰ç­‰..
3.  å®ƒæœ‰ä¸€ä¸ªå¾ˆé…·çš„åå­—ï¼(æˆ‘çš„ç›´æ¥å†…æ¶µæ˜¯ Megadeth çš„ä¸“è¾‘æ˜¯ã€Šé”ˆåœ¨å’Œå¹³ä¸­ã€‹..)
4.  å¿«é€Ÿè°·æ­Œæœç´¢æ˜¾ç¤ºï¼Œå®ƒæœ‰ä¸€ä¸ªâ€œå‡½æ•°â€çš„æ¦‚å¿µ**ï¼Œ**å‡½æ•°å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°ï¼Œå†…ç½®é«˜é˜¶å‡½æ•°(å¦‚åœ°å›¾ï¼Œè¿‡æ»¤å™¨æŠ˜å )ç”¨äºè¿­ä»£ï¼Œæœ‰é€‰é¡¹å’Œç»“æœå’Œç±»å‹ç­‰..è€Œä¸”é»˜è®¤æ˜¯**å®Œå…¨ä¸å¯å˜**(é™¤éç”¨â€œmutâ€)ã€‚
5.  æˆ‘çœ‹åˆ°å®ƒæœ‰ä¸€ä¸ª**å¼‚æ­¥è¿è¡Œæ—¶** **æ”¯æŒ**ï¼Œæˆ‘å–œæ¬¢ä½¿ç”¨éé˜»å¡å‡½æ•°ï¼Œæ‰¿è¯ºå¾ˆæœ‰è¶£ï¼Œå¼‚æ­¥ await æ¨¡å¼ä¹Ÿå¾ˆæœ‰è¶£..
6.  æˆ‘çœ‹åˆ°å®ƒæœ‰ä¸€ä¸ªå¾ˆå¥½çš„**å‹ç³»ç»Ÿ**ã€‚

æˆ‘çš„åŸå› æ›´å¤šçš„æ˜¯â€œå¼€å‘â€é©±åŠ¨ï¼Œè€Œä¸æ˜¯æ€§èƒ½æˆ–æ•ˆç‡(ä¾‹å¦‚ï¼Œå†…å­˜å®‰å…¨ï¼Œå°äºŒè¿›åˆ¶)é©±åŠ¨ï¼Œæˆ‘æƒ³è¦ä¸€ç§è¯­è¨€ï¼Œå®ƒèƒ½è®©æˆ‘ä»¥æˆ‘å–œæ¬¢çš„é£æ ¼ç¼–å†™(å‡½æ•°å¼çš„ï¼Œä½†ä¸ä»…ä»…æ˜¯å‡½æ•°å¼çš„ï¼Œå…·æœ‰ç±»å‹ã€å¼‚æ­¥èƒ½åŠ›ç­‰)..).

## **æˆ‘ä½¿ç”¨çš„å­¦ä¹ èµ„æº:**

æœ‰ä¸€ä¸ªå¾ˆå¥½çš„è¯¾ç¨‹å¯ä»¥ç”¨å¤æ•°å½¢å¼è§‚çœ‹ï¼Œå«åš: [**ã€é“é”ˆåŸºç¡€ã€‘**](https://www.pluralsight.com/courses/rust-fundamentals) **ï¼Œ**æˆ‘ä¹Ÿç»å¸¸ä½¿ç”¨ [**å®˜æ–¹æ–‡ä»¶**](https://doc.rust-lang.org/book/) ..æˆ‘çœŸçš„è®¤ä¸ºä»–ä»¬åšå¾—å¾ˆå¥½ã€‚æˆ‘åªæ˜¯å¸Œæœ›æˆ‘èƒ½åƒåœ¨ MDN ä¸€æ ·åœ¨é‚£é‡Œåº¦è¿‡æˆ‘çš„æ—¶é—´:)

## **å¼€å‘ç¯å¢ƒè®¾ç½®**

ä½ éœ€è¦å®‰è£… rust å·¥å…·**ç¼–è¯‘å™¨**ã€**åŒ…ç®¡ç†å™¨**ã€**ç‰ˆæœ¬ç®¡ç†å™¨**ç­‰ç­‰..).éµå¾ª[æŒ‡ä»¤](https://www.rust-lang.org/tools/install)ã€‚

**ğŸ“æ³¨æ„:** [**Cargo**](https://crates.io/) å°±åƒ npmï¼Œ [**rustup**](https://github.com/rust-lang/rustup/blob/master/README.md) å°±åƒ nvmï¼Œ [**rustc**](https://rustc-dev-guide.rust-lang.org/codegen.html) å°±æ˜¯ç¼–è¯‘å™¨ï¼Œæˆ‘ä¸ä¼šè¯´å®ƒåƒ tsc å› ä¸ºå®ƒå®é™…ä¸Šæ˜¯æŠŠä»£ç ç¼–è¯‘æˆäºŒè¿›åˆ¶è€Œä¸æ˜¯å…¶ä»–é«˜çº§è¯­è¨€ã€‚

## å›åˆ° WASM â€”å¯åŠ¨æ¦‚å¿µéªŒè¯

[æ–‡æ¡£](https://rustwasm.github.io/docs)çœŸçš„éå¸¸é€‚åˆæ·±å…¥ç ”ç©¶ã€‚å¦‚æœä½ æƒ³å¿«é€Ÿå¼€å§‹ï¼Œè¯·éµå¾ª[è¿™æœ¬](https://rustwasm.github.io/docs/book/game-of-life/setup.html)å¿«é€Ÿæ‰‹å†Œï¼Œå®‰è£…ä¸º Rust å’Œ WASM è®¾è®¡çš„ä»¤äººæ•¬ç•çš„å¼€å‘å·¥å…·ã€‚

**å¼€å§‹ä¸€ä¸ªé¡¹ç›®æ—¶ä½ åº”è¯¥çŸ¥é“çš„äº‹æƒ…:**

*   [**æ¿æ¡ç®±**](https://crates.io/) æ˜¯ä½ å¯èƒ½è¦ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹**ä¾èµ–**(åƒ npm é—¨æˆ·å›è´­)ã€‚
*   [**Cargo.toml**](http://Cargo.toml) ç±»ä¼¼äº package.json â€” [å­¦ä¹ å¦‚ä½•è¯»å–å’Œç¼–è¾‘å®ƒ](https://doc.rust-lang.org/cargo/reference/manifest.html)ï¼Œå¹¶è¿è¡Œå®ƒçš„[å‘½ä»¤](https://doc.rust-lang.org/cargo/commands/cargo-install.html)(æ–°å»ºã€å®‰è£…ã€å‘å¸ƒç­‰..)â€”é¡ºä¾¿è¯´ä¸€å¥ï¼Œè¿˜æœ‰ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„è´§ç‰©é”ã€‚
*   å¼€å‘ web åº”ç”¨ç¨‹åºæ—¶ï¼ŒRust+WASM çš„ç›¸å…³[æ¿æ¡ç®±](https://rustwasm.github.io/docs/book/reference/crates.html)ã€‚

ä¸ºäº†å¯åŠ¨æ¦‚å¿µéªŒè¯ï¼Œæˆ‘æŒ‰ç…§[è¿™æœ¬](https://rustwasm.github.io/docs/book/reference/project-templates.html)å®˜æ–¹æ‰‹å†Œä»‹ç»äº†ä¸€ä¸ªå«åš **wasm-pack:** çš„å·¥å…·

> **wasm-pack** æ˜¯æ‚¨æ„å»ºã€æµ‹è¯•å’Œå‘å¸ƒ Rust ç”Ÿæˆçš„ WebAssembly çš„ä¸€ç«™å¼å•†åº—ã€‚

æˆ‘åœ¨æ„å»ºæˆ‘çš„ POC é¡¹ç›®æ—¶ä½¿ç”¨äº† **wasm-pack** ï¼Œä½ å¯ä»¥ç‚¹å‡»æˆ‘çš„ POC repo [è¿™é‡Œ](https://github.com/LironHazan/rust-in-peace)å’Œ web demo [é‚£é‡Œ](https://focused-booth-bb8cdc.netlify.com/)ã€‚

å¯¹äºä¸€ä¸ªæ›´â€œçœŸå®çš„ç”Ÿæ´»ä½¿ç”¨â€è§’+é”ˆ+ WASM æ¦‚å¿µæ£€æŸ¥[æˆ‘çš„å¦ä¸€ä¸ªä¾‹å­](https://github.com/LironHazan/angular-rust-wasm)ã€‚

è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹è¯¥é¡¹ç›®çš„æœ‰è¶£éƒ¨åˆ†ï¼Œè¿™å°†ä½¿æˆ‘ä»¬äº†è§£å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„:

**Cargo.toml:**

![](img/cf24f3d63f7e203ec1e16fedde0dc766.png)

*   [**web _ sys**](https://docs.rs/web-sys/0.3.4/web_sys/)crate ä¾èµ–é¡¹çœŸçš„å¾ˆæœ‰è¶£â€”â€”å®ƒæä¾›äº†ä¸€ä¸ª[ç»‘å®š](https://developer.mozilla.org/en-US/docs/Mozilla/WebIDL_bindings)ç»™æµè§ˆå™¨æä¾›çš„æ‰€æœ‰ API(æ®æˆ‘ä»è¿™é‡Œçš„é˜…è¯»[æ‰€ç†è§£çš„ï¼Œåæ˜ äº† C++æ¸²æŸ“å¼•æ“çš„ä»£ç )ã€‚](https://developer.mozilla.org/en-US/docs/Mozilla/WebIDL_bindings)
*   æˆ‘åœ¨å¼€å‘ app æ—¶äº¤äº’çš„ä¾èµ–é¡¹æ˜¯:`[**wasm-bindgen**](https://rustwasm.github.io/docs/wasm-bindgen/)`ï¼Œ(Rust åº“å’Œ CLI å·¥å…·ï¼Œæ–¹ä¾¿ wasm æ¨¡å—å’Œ JavaScript çš„é«˜å±‚äº¤äº’)ã€‚

[](https://github.com/LironHazan/rust-in-peace/blob/master/src/lib.rs)****:****

**æ³¨æ„`#[wasm_bindgen]` [å±æ€§](https://doc.rust-lang.org/reference/attributes.html)çš„ä½¿ç”¨ï¼Œæ‹¥æœ‰å®ƒå°†å¯¼è‡´ 2 ä¸ªåŒ…è£…å™¨çš„ç”Ÿæˆ:**

*   **æ¥å— JS ç±»å‹è½¬æ¢æˆ wasm çš„ JavaScript åŒ…è£…å™¨ã€‚**
*   **Rust åŒ…è£…å™¨æ¥æ”¶ wasm ç±»å‹å¹¶è½¬æ¢ä¸º Rust ç±»å‹ã€‚**

**ä½ å¯ä»¥åœ¨[è¿™ç¯‡ä¸é”™çš„å¸–å­](https://hacks.mozilla.org/2018/04/javascript-to-rust-and-back-again-a-wasm-bindgen-tale/)ä¸Šé˜…è¯»æ›´å¤šå…³äºäº’åŠ¨çš„å†…å®¹ã€‚**

****wasm-pack æ¨¡æ¿****

**è¿è¡Œ webpack æ„å»ºå°†ç”Ÿæˆ **pkg** å’Œ **dist** æ–‡ä»¶å¤¹(webpack é…ç½®éœ€è¦ä¸€ä¸ª**@ wasm-tool/wasm-pack-plugin**æ¥ç¼–è¯‘æˆ‘ä»¬çš„ Rusty ä»£ç å¹¶ç”Ÿæˆå¸¦æœ‰æ‰€æœ‰éœ€è¦çš„æ¨¡æ¿çš„ pkg)**

**å¦‚æœæˆ‘ä»¬æ‰“å¼€ä½äº **pkg** æ–‡ä»¶å¤¹ä¸­çš„ index.jsï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä»¥ä¸‹å†…å®¹:**

```
**import** * **as** wasm **from './index_bg.wasm'**;

*/**
*/* **export function** *rust_in_peace*() {
    wasm.rust_in_peace();
}
```

**æ‚¨å¯ä»¥çœ‹åˆ° wasm-pack å¦‚ä½•ç”Ÿæˆä¸€ä¸ª JavaScript åŒ…è£…å™¨æ¥è°ƒç”¨æˆ‘ä»¬çš„ Rusty å‡½æ•°ï¼Œè¯¥å‡½æ•°æ˜¯ä» wasm äºŒè¿›åˆ¶æ–‡ä»¶å¯¼å…¥çš„ã€‚æ¿€åŠ¨äººå¿ƒ:)**

## **æœªæ¥é˜…è¯»â€”å‰ç«¯ç”Ÿé”ˆçš„æ¡†æ¶**

**æœ‰è®¸å¤šç”Ÿé”ˆçš„å¼€æºé¡¹ç›®ï¼Œåªè¦çœ‹çœ‹[æ£’æäº†çš„](https://github.com/rust-unofficial/awesome-rust)å›è´­å°±çŸ¥é“äº†ã€‚**

**æ”¾å¤§åˆ°å‰ç«¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ¡†æ¶æ¥å¼€å‘ä¸€ä¸ªâ€œæœ¬åœ°â€Rust (WASM)åº”ç”¨ç¨‹åºï¼Œä»¥ä½¿ä½“éªŒæ›´å¿«/æ›´å®¹æ˜“/æ›´å…·å¯æ‰©å±•æ€§(å°±ä»£ç åº“å’Œè½¯ä»¶æ¶æ„è€Œè¨€)ã€‚**

**æˆ‘ä¸ªäººçš„ç›®æ ‡æ˜¯æ£€éªŒ[**Yew**](https://github.com/yewstack/yew)**â€”**(ä¸€ä¸ªç°ä»£çš„ [Rust](https://www.rust-lang.org/) æ¡†æ¶ï¼Œç”¨äºä½¿ç”¨ [WebAssembly](https://webassembly.org/) åˆ›å»ºå¤šçº¿ç¨‹å‰ç«¯ web åº”ç”¨ç¨‹åºã€‚)**

**ç›®å‰å°±è¿™äº›ï¼Œå¦‚æœä½ æƒ³å¼€å§‹ä½¿ç”¨ WASM+rustï¼Œæˆ‘çœŸçš„è®¤ä¸ºå¼€å§‹ä½¿ç”¨ wasm-pack æ˜¯æœ€å¥½çš„æ–¹å¼ï¼Œå¹¶ä¸”[æ–‡æ¡£](https://rustwasm.github.io/docs/wasm-pack/)çœŸçš„å¾ˆæ£’ã€‚**

**æˆ‘è¦æ„Ÿè°¢ [Uri Shaked](https://medium.com/u/355b1dfe86ae?source=post_page-----7365464868bf--------------------------------) ä¸ºæˆ‘å®¡é˜…è¿™ç¯‡æ–‡ç« :)**

**å¹²æ¯ğŸ¥‚**

**åˆ©ä¼¦ã€‚**