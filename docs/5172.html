<html>
<head>
<title>Create a Front App immediately with Next.js on Google Cloud Run</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">åœ¨Google Cloud Runä¸Šä½¿ç”¨Next.jsç«‹å³åˆ›å»ºå‰å°åº”ç”¨ç¨‹åº</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/create-a-front-app-immediately-with-next-js-on-google-cloud-run-d0cfde795ce3?source=collection_archive---------1-----------------------#2021-01-02">https://itnext.io/create-a-front-app-immediately-with-next-js-on-google-cloud-run-d0cfde795ce3?source=collection_archive---------1-----------------------#2021-01-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/814811b2d44b5e8564905e9a5d2e76dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*raWme1wi7uWXT1lTdlLrog.png"/></div></div></figure><p id="cdf6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">å½“ä½ åˆ›å»ºä¸€ä¸ªåŸå‹æ—¶ï¼Œé€Ÿåº¦å’Œé‡‘é’±æ˜¯éå¸¸é‡è¦çš„ã€‚ä½ éœ€è¦ä»¥ä½æˆæœ¬å°½å¿«å±•ç¤ºç»™ç”¨æˆ·ã€‚</p><p id="25f4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">jsæ˜¯ä¸€ä¸ªæµè¡Œçš„å‰ç«¯æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ç®€å•çš„lambda apiè¿›è¡Œé™æ€ç”Ÿæˆå’ŒæœåŠ¡å™¨ç«¯æ¸²æŸ“ã€‚å› ä¸ºå®ƒå¾ˆå®¹æ˜“è®¾ç½®ï¼Œä½†ä»ç„¶éå¸¸çµæ´»ï¼Œå®ƒæ˜¯å‰ç«¯åŸå‹çš„æœ€ä½³å€™é€‰ä¹‹ä¸€ã€‚</p><p id="3f57" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">å¦ä¸€æ–¹é¢ï¼ŒGoogle Cloud Runæ˜¯ä¸€ä¸ªæ— æœåŠ¡å™¨çš„å®¹å™¨å¹³å°ã€‚å› ä¸ºå®ƒæ˜¯æ— æœåŠ¡å™¨çš„ï¼Œä½ ä¸éœ€è¦ç»´æŠ¤åŸºç¡€è®¾æ–½ï¼Œè€Œä¸”ä¸€å¼€å§‹å°±å¾ˆä¾¿å®œã€‚å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºæ˜¯dockernizedåŒ–çš„ï¼Œæ‚¨å¯èƒ½ä¼šè·å¾—ä½æˆæœ¬çš„é«˜æ•ˆå¼€å‘ä½“éªŒã€‚</p><p id="0c5a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æ‰€ä»¥è¿™ç¯‡æ–‡ç« è§£é‡Šäº†Google Cloud Runä¸ŠNext.js appçš„é—ªç”µèˆ¬å¿«é€Ÿè®¾ç½®ã€‚å®ƒåŒ…æ‹¬ä»¥ä¸‹3ä¸ªæ­¥éª¤ã€‚</p><ol class=""><li id="7ccc" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">åˆ›å»ºNext.jsåº”ç”¨ç¨‹åº</li><li id="6a42" class="kz la it kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">Dockernize Next.jsåº”ç”¨ç¨‹åº</li><li id="a6fb" class="kz la it kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">éƒ¨ç½²åˆ°Googleäº‘è¿è¡Œ</li></ol><h1 id="4047" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">å¼€å§‹å‰ä½ éœ€è¦ä»€ä¹ˆ</h1><ul class=""><li id="999f" class="kz la it kd b ke ml ki mm km mn kq mo ku mp ky mq lf lg lh bi translated"><a class="ae mr" href="https://docs.docker.com/docker-for-mac/install/" rel="noopener ugc nofollow" target="_blank"> Dockeræ¡Œé¢</a></li><li id="c401" class="kz la it kd b ke li ki lj km lk kq ll ku lm ky mq lf lg lh bi translated"><a class="ae mr" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">è°·æ­Œäº‘è´¦å·</a>:è¯·åˆ›å»ºä¸€ä¸ªé¡¹ç›®</li><li id="b060" class="kz la it kd b ke li ki lj km lk kq ll ku lm ky mq lf lg lh bi translated"><a class="ae mr" href="https://cloud.google.com/sdk/docs/install" rel="noopener ugc nofollow" target="_blank">è°·æ­Œäº‘SDK </a></li></ul><h1 id="63e7" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">åˆ›å»ºNext.jsåº”ç”¨ç¨‹åº</h1><p id="3585" class="pw-post-body-paragraph kb kc it kd b ke ml kg kh ki mm kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">åˆ›å»ºNext.jsåº”ç”¨ç¨‹åºæœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨<code class="fe mv mw mx my b">create-next-app</code>ã€‚cliä¼šä¸ºæ‚¨è¿›è¡Œåˆå§‹è®¾ç½®ã€‚</p><pre class="mz na nb nc gt nd my ne nf aw ng bi"><span id="1d10" class="nh lo it my b gy ni nj l nk nl">// with yarn<br/>$ yarn create next-app</span><span id="d96a" class="nh lo it my b gy nm nj l nk nl">// with npm<br/>$ <!-- -->npx create-next-app</span></pre><p id="5534" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">è¯´å®Œäº†ï¼Œæˆ‘ä»¬å…ˆæ¥æ£€æŸ¥ä¸€ä¸‹åº”ç”¨ã€‚</p><pre class="mz na nb nc gt nd my ne nf aw ng bi"><span id="5e49" class="nh lo it my b gy ni nj l nk nl">$ cd &lt;your app name&gt;<br/>$ yarn dev</span></pre><p id="92f3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">å¯ä»¥åœ¨<code class="fe mv mw mx my b">localhost:3000</code>çœ‹åˆ°Next.jsçš„Hello Worldå¦‚ä¸‹å›¾ã€‚</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/0dfab1cbc99e0748b085142c6598a235.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bUgwMdg9bEDtmZSyzO89Qg.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">Next.jsä¸»é¡µ</figcaption></figure><h1 id="c770" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">Dockernize Nextjsåº”ç”¨ç¨‹åº</h1><p id="123e" class="pw-post-body-paragraph kb kc it kd b ke ml kg kh ki mm kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">å› ä¸ºäº‘è¿è¡Œæ˜¯dockerå¹³å°ï¼Œæ‰€ä»¥ä½ çš„åº”ç”¨å¿…é¡»dockeråŒ–ã€‚è¦æ³¨å†Œæ‚¨çš„Next.jsåº”ç”¨ç¨‹åºï¼Œè¯·éµå¾ªä»¥ä¸‹3ä¸ªæ­¥éª¤ã€‚</p><ol class=""><li id="efdf" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">åˆ›é€ <code class="fe mv mw mx my b">Dockerfile</code></li><li id="6c84" class="kz la it kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">åˆ›å»º<code class="fe mv mw mx my b">.dockerignore</code></li><li id="22a0" class="kz la it kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">é…ç½®ç«¯å£è®¾ç½®</li></ol><h2 id="2235" class="nh lo it bd lp ns nt dn lt nu nv dp lx km nw nx mb kq ny nz mf ku oa ob mj oc bi translated">1.åˆ›é€ <code class="fe mv mw mx my b">Dockerfile</code></h2><p id="9c85" class="pw-post-body-paragraph kb kc it kd b ke ml kg kh ki mm kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">è¿˜æœ‰åƒ<code class="fe mv mw mx my b">node:15.0.1</code>è¿™æ ·çš„base dockeré•œåƒï¼Œä½†æ˜¯å¯¹äºä½ çš„åº”ç”¨æ¥è¯´è¿˜ä¸å¤Ÿã€‚å®ƒç¼ºå°‘ä½ è‡ªå·±çš„åŒ…ï¼Œè®¾ç½®ç­‰ç­‰ã€‚è¿™å°±æ˜¯<code class="fe mv mw mx my b">Dockerfile</code>è¿›æ¥çš„åŸå› ã€‚æ‚¨åº”è¯¥ç¼–å†™ä¸€äº›è¿›ç¨‹æ¥å°†è‡ªå®šä¹‰è®¾ç½®åŒ…å«åˆ°dockeræ˜ åƒä¸­ã€‚</p><pre class="mz na nb nc gt nd my ne nf aw ng bi"><span id="e35b" class="nh lo it my b gy ni nj l nk nl">$ touch Dockerfile</span></pre><p id="7bb7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mv mw mx my b">Dockerfile</code>å¯èƒ½ä¼šåƒä¸‹é¢è¿™æ ·ã€‚è¯·é€‰æ‹©é€‚åˆæ‚¨çš„ä¸åŒèŠ‚ç‚¹ç‰ˆæœ¬(æœ€å¥½ä½¿ç”¨ä¸æœ¬åœ°ç‰ˆæœ¬ç›¸åŒçš„ç‰ˆæœ¬)ã€‚</p><pre class="mz na nb nc gt nd my ne nf aw ng bi"><span id="2611" class="nh lo it my b gy ni nj l nk nl">// base image<br/>FROM node:15.2.1-alpine</span><span id="c27d" class="nh lo it my b gy nm nj l nk nl">// working directory<br/>WORKDIR /app</span><span id="d141" class="nh lo it my b gy nm nj l nk nl">// add binaries to $PATH<br/>ENV PATH /app/node_modules/.bin:$PATH</span><span id="6570" class="nh lo it my b gy nm nj l nk nl">// install and cache app dependencies<br/>COPY package.json /app/<br/>COPY yarn.lock /app/<br/>RUN yarn install</span><span id="e076" class="nh lo it my b gy nm nj l nk nl">// copy app files and build<br/>COPY . /app<br/>RUN yarn build</span><span id="5c87" class="nh lo it my b gy nm nj l nk nl"># start app<br/>CMD [ "yarn", "start" ]</span></pre><h2 id="e5a0" class="nh lo it bd lp ns nt dn lt nu nv dp lx km nw nx mb kq ny nz mf ku oa ob mj oc bi translated">2.åˆ›é€ ã€‚dockerignore</h2><p id="65b7" class="pw-post-body-paragraph kb kc it kd b ke ml kg kh ki mm kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">ä¸ºäº†ä½¿ä½ çš„DXæ›´å¥½ï¼Œdockeré•œåƒå¿…é¡»å°½å¯èƒ½çš„å°ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥å‡å°‘æ„å»ºæ—¶é—´ã€‚è¦è®©dockerå½¢è±¡è‹—æ¡ï¼Œè¯·æ‰“é€ <code class="fe mv mw mx my b">.dockerignore</code>ã€‚å®ƒä»dockeræ˜ åƒä¸­åˆ é™¤ä¸å¿…è¦çš„æ–‡ä»¶ã€‚</p><pre class="mz na nb nc gt nd my ne nf aw ng bi"><span id="c67f" class="nh lo it my b gy ni nj l nk nl">$ touch .dockerignore</span></pre><p id="b75e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mv mw mx my b">.dockerignore</code>å¯èƒ½ä¼šåƒä¸‹é¢è¿™æ ·ã€‚ä¸å¾—åŒ…å«node_modulesï¼Œå› ä¸ºnpmè½¯ä»¶åŒ…å°†åœ¨æ‚¨æ„å»ºdockeræ˜ åƒæ—¶å®‰è£…ã€‚</p><pre class="mz na nb nc gt nd my ne nf aw ng bi"><span id="c849" class="nh lo it my b gy ni nj l nk nl">node_modules<br/>yarn-error.log</span><span id="19e1" class="nh lo it my b gy nm nj l nk nl">Dockerfile<br/>.dockerignore</span><span id="735b" class="nh lo it my b gy nm nj l nk nl">.git<br/>.gitignore</span></pre><p id="c6da" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">å› æ­¤ï¼Œè®©æˆ‘ä»¬å»ºç«‹dockerå›¾åƒæ¥æ£€æŸ¥è®¾ç½®ã€‚</p><pre class="mz na nb nc gt nd my ne nf aw ng bi"><span id="1e84" class="nh lo it my b gy ni nj l nk nl">// docker build &lt;PATH&gt; -t &lt;REPO_NAME&gt;:&lt;TAG&gt;</span><span id="0382" class="nh lo it my b gy nm nj l nk nl">$ docker build . -t next-app:latest</span></pre><p id="8888" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">åˆ›å»ºåï¼Œæ‚¨å¯ä»¥é€šè¿‡docker imageså‘½ä»¤æ£€æŸ¥å®ƒã€‚</p><pre class="mz na nb nc gt nd my ne nf aw ng bi"><span id="598e" class="nh lo it my b gy ni nj l nk nl">$ docker images</span><span id="c5d7" class="nh lo it my b gy nm nj l nk nl">REPOSITORY  TAG     IMAGE ID       CREATED             SIZE<br/>next-app    latest  f834c5ae4f9a   6 minutes ago       117MB</span></pre><h2 id="5e4c" class="nh lo it bd lp ns nt dn lt nu nv dp lx km nw nx mb kq ny nz mf ku oa ob mj oc bi translated">3.é…ç½®ç«¯å£è®¾ç½®</h2><p id="105d" class="pw-post-body-paragraph kb kc it kd b ke ml kg kh ki mm kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">æ‚¨è‡ªå·±çš„dockeræ˜ åƒå·²ç»åˆ›å»ºï¼Œæ‚¨éœ€è¦é€šè¿‡è¿è¡Œåº”ç”¨ç¨‹åºæ¥æ£€æŸ¥æ‚¨çš„dockeræ˜ åƒæ˜¯å¦è‰¯å¥½ã€‚</p><pre class="mz na nb nc gt nd my ne nf aw ng bi"><span id="584a" class="nh lo it my b gy ni nj l nk nl">$ docker run -p4000:3000 next-app</span><span id="1011" class="nh lo it my b gy nm nj l nk nl">yarn run v1.22.5<br/>$ next start<br/>ready - started server on <a class="ae mr" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a></span></pre><p id="11fd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mv mw mx my b">-p</code>é€‰é¡¹æ˜¯å…³äºç«¯å£è½¬å‘çš„ã€‚æµè§ˆå™¨è¯·æ±‚æ¥å—ç«¯å£å·<code class="fe mv mw mx my b">4000</code>å¹¶è½¬å‘ç»™<code class="fe mv mw mx my b">3000</code>ã€‚å› ä¸ºNext.jsé»˜è®¤ç«¯å£è®¾ç½®æ˜¯<code class="fe mv mw mx my b">3000</code>ï¼Œè½¬å‘çš„è¯·æ±‚åˆ°è¾¾Next.js appã€‚æ‰€ä»¥å¦‚æœä½ åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€<code class="fe mv mw mx my b">localhost:4000</code>ï¼Œ</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi od"><img src="../Images/87fbfc7efffac3a150495faf1e0b8dad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bLKbb0oXRY10KAknFGbK4A.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">æœ¬åœ°ä¸»æœº:4000</figcaption></figure><p id="186c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">çœ‹èµ·æ¥éå¸¸å¥½ğŸ‰</p><p id="1af0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ç„¶è€Œï¼Œå› ä¸ºGoogle Cloud Runè¦æ±‚åº”ç”¨ç¨‹åºåœ¨é€šè¿‡<code class="fe mv mw mx my b">PORT</code>ç¯å¢ƒå˜é‡ç»™å®šçš„ç‰¹å®šç«¯å£ä¸Šè¿è¡Œï¼Œæ‰€ä»¥æ‚¨çš„å¯åŠ¨è„šæœ¬å¿…é¡»æ¥å—ç«¯å£è®¾ç½®ã€‚å¦‚æœæ²¡æœ‰ç«¯å£è®¾ç½®ï¼Œå½“æ‚¨å°†æ˜ åƒéƒ¨ç½²åˆ°Google Cloud Runæ—¶ï¼Œä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯ã€‚</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oe"><img src="../Images/13a92547863bb0103acaad8bc8e90a89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qcjKpmT8ClPRTpHhi12Vbw.png"/></div></div></figure><p id="855b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æ‰€ä»¥è¯·æ‰“å¼€<code class="fe mv mw mx my b">package.json</code>ç¼–è¾‘å¯åŠ¨è„šæœ¬ã€‚</p><pre class="mz na nb nc gt nd my ne nf aw ng bi"><span id="e4a8" class="nh lo it my b gy ni nj l nk nl">{<br/>  ...<br/>  "scripts": {<br/>    "dev": "next dev",<br/>    "build": "next build",<br/>    "start": "next start -p $PORT"  // accept $PORT here<br/>  },<br/>  ...<br/>}</span></pre><p id="0e7b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æ‰€ä»¥ç°åœ¨ï¼Œå¯åŠ¨è„šæœ¬æ¥å—<code class="fe mv mw mx my b">PORT</code>ç¯å¢ƒå˜é‡ã€‚å› ä¸º<code class="fe mv mw mx my b">PORT</code>æ˜¯Google Cloud Runæ³¨å…¥çš„ï¼Œæ‰€ä»¥è¿™ä¸ªåº”ç”¨åœ¨Google Cloud Runä¸­è¿è¡Œè‰¯å¥½ã€‚å¦ä¸€æ–¹é¢ï¼Œä½ è¦å°å¿ƒå½“åœ°çš„ç¯å¢ƒã€‚</p><p id="db69" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³é€šè¿‡<code class="fe mv mw mx my b">yarn start</code>è¿è¡Œç”Ÿäº§æ„å»ºNext.jsåº”ç”¨ç¨‹åºï¼Œæ‚¨éœ€è¦ä¼ é€’ç¯å¢ƒå˜é‡ã€‚</p><pre class="mz na nb nc gt nd my ne nf aw ng bi"><span id="be64" class="nh lo it my b gy ni nj l nk nl">$ PORT=8080 yarn start</span></pre><p id="9bdc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">å¦‚æœä½ æƒ³è¿è¡Œæœ¬åœ°dockeræœºå™¨ï¼Œä½ çš„è¿è¡Œå‘½ä»¤åº”è¯¥åƒä¸‹é¢è¿™æ ·ã€‚</p><pre class="mz na nb nc gt nd my ne nf aw ng bi"><span id="08e1" class="nh lo it my b gy ni nj l nk nl">$ docker run -e PORT=8080 -p 4000:8080 next-app</span></pre><p id="440c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">å®ƒé€šè¿‡<code class="fe mv mw mx my b">-e</code>é€‰é¡¹ä¼ é€’ç¯å¢ƒå˜é‡ã€‚æµè§ˆå™¨è¯·æ±‚æ¥å—<code class="fe mv mw mx my b">4000</code>å¹¶è½¬å‘ç»™<code class="fe mv mw mx my b">8080</code>å¹¶åœ¨<code class="fe mv mw mx my b">8080</code>ä¸­å¯åŠ¨Next.js appã€‚</p><h1 id="9aec" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">éƒ¨ç½²åˆ°Googleäº‘è¿è¡Œ</h1><p id="3f11" class="pw-post-body-paragraph kb kc it kd b ke ml kg kh ki mm kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">å› ä¸ºä½ å·²ç»åšäº†Next.js appçš„dockernizationï¼Œæ˜¯æ—¶å€™éƒ¨ç½²äº†ï¼</p><p id="90c4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">è¦éƒ¨ç½²äº‘è¿è¡Œåº”ç”¨ç¨‹åºï¼Œæœ‰ä»¥ä¸‹3ä¸ªæ­¥éª¤ã€‚</p><ol class=""><li id="9151" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">åˆ›å»ºä¸åŒçš„åç§°ç©ºé—´dockerå›¾åƒæ ‡è®°</li><li id="c2f2" class="kz la it kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">å°†dockerå›¾åƒæ¨é€åˆ°Googleå®¹å™¨æ³¨å†Œè¡¨(GCR)</li><li id="c660" class="kz la it kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">å°†æ¨é€çš„æ˜ åƒéƒ¨ç½²åˆ°äº‘è¿è¡Œ</li></ol><p id="58b7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">åœ¨ç»§ç»­ä¹‹å‰ï¼Œè¯·å¯ç”¨<code class="fe mv mw mx my b">Cloud Run API</code>ã€<code class="fe mv mw mx my b">Container Registry API</code>ã€<code class="fe mv mw mx my b">Cloud Deployment Manager V2 API</code>çš„Google Cloud APIä½¿ç”¨cliã€‚</p><h2 id="a69a" class="nh lo it bd lp ns nt dn lt nu nv dp lx km nw nx mb kq ny nz mf ku oa ob mj oc bi translated">1.åˆ›å»ºä¸åŒçš„åç§°ç©ºé—´dockerå›¾åƒæ ‡è®°</h2><p id="543c" class="pw-post-body-paragraph kb kc it kd b ke ml kg kh ki mm kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">å½“æ‚¨æ£€æŸ¥ä¸Šé¢çš„dockeræ˜ åƒæ—¶ï¼Œæ‚¨çš„dockeræ˜ åƒçš„å­˜å‚¨åº“æ˜¯<code class="fe mv mw mx my b">next-app</code>ã€‚ä½†æ˜¯è¦éƒ¨ç½²åˆ°Cloud Runï¼Œæ‚¨çš„æ˜ åƒåº”è¯¥æ”¾åœ¨GCRã€‚è¿™æ„å‘³ç€ä½ çš„å›¾åƒå¿…é¡»å­˜æ”¾åœ¨GCRã€‚æ‰€ä»¥è¿˜æ˜¯å…ˆæ”¹åº“å§ï¼</p><pre class="mz na nb nc gt nd my ne nf aw ng bi"><span id="b961" class="nh lo it my b gy ni nj l nk nl">// docker tag &lt;SOURCE_REPO_NAME&gt; gcr.io/&lt;GCP_PROJECT_NAME&gt;/&lt;GCR_REPO_NAME&gt;:&lt;GCR_TAG&gt;</span><span id="c242" class="nh lo it my b gy nm nj l nk nl">$ docker tag next-app gcr.io/test-project/next-app:latest</span></pre><p id="164b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ç°åœ¨ä½ çš„å›¾åƒå¯ä»¥åƒä¸‹é¢è¿™æ ·æ¨é€åˆ°GCRäº†ã€‚</p><pre class="mz na nb nc gt nd my ne nf aw ng bi"><span id="6ff5" class="nh lo it my b gy ni nj l nk nl">$ docker images</span><span id="a07c" class="nh lo it my b gy nm nj l nk nl">REPOSITORY  TAG  IMAGE ID  CREATED  SIZE<br/>gcr.io/test-project/next-app:latest  2b51c1d11422  43 minutes ago  276MB</span></pre><h2 id="015a" class="nh lo it bd lp ns nt dn lt nu nv dp lx km nw nx mb kq ny nz mf ku oa ob mj oc bi translated">2.å°†dockerå›¾åƒæ¨é€åˆ°Googleå®¹å™¨æ³¨å†Œè¡¨(GCR)</h2><p id="6d50" class="pw-post-body-paragraph kb kc it kd b ke ml kg kh ki mm kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">å› ä¸ºGoogle Cloud Runä¼šæŠŠä½ çš„dockeré•œåƒä»GCRæ‹‰è¿‡æ¥ï¼Œæ‰€ä»¥ä½ å¿…é¡»æŠŠä½ çš„dockeré•œåƒæ¨é€åˆ°GCRã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨æ²¡æœ‰æ¨é€è‡³GCRï¼Œæ‚¨å°†é¢ä¸´èº«ä»½éªŒè¯é”™è¯¯ã€‚æ‰€ä»¥è¯·åˆ›å»ºä¸€ä¸ªgcloudå‘½ä»¤çš„<code class="fe mv mw mx my b">credHelper</code>æ¥dockeré…ç½®ã€‚</p><pre class="mz na nb nc gt nd my ne nf aw ng bi"><span id="3c76" class="nh lo it my b gy ni nj l nk nl">$ gcloud auth configure-docker</span></pre><p id="dab3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æœ€åï¼Œè®©æˆ‘ä»¬æŠŠä½ çš„ç å¤´å·¥äººå½¢è±¡æ¨å‘GCRã€‚å› ä¸ºæ•´ä¸ªå›¾åƒæ˜¯é€šè¿‡äº’è”ç½‘æ¨é€çš„ï¼Œæ‰€ä»¥éœ€è¦ä¸€äº›æ—¶é—´ã€‚</p><pre class="mz na nb nc gt nd my ne nf aw ng bi"><span id="e7b3" class="nh lo it my b gy ni nj l nk nl">// docker push gcr.io/&lt;GCP_PROJECT_NAME&gt;/&lt;GCR_REPO_NAME&gt;:&lt;GCR_TAG&gt;</span><span id="cc90" class="nh lo it my b gy nm nj l nk nl">$ docker push gcr.io/test-project/next-app:latest<br/>The push refers to repository [gcr.io/test-project/next-app]<br/>f01fa31cf258: Layer already exists<br/>22ce882451cc: Layer already exists<br/>970e4e2ffa6f: Layer already exists<br/>65f238554c45: Layer already exists<br/>053b1bdff0c1: Layer already exists<br/>970feb8565a1: Layer already exists<br/>78efe26eefc0: Layer already exists<br/>1b2a921893cb: Layer already exists<br/>92cab300fc69: Layer already exists<br/>3e207b409db3: Layer already exists<br/>latest: digest: sha256:5229e6386b3410a46d9771b8d863dd63ebeac620fe67c2c78f6cae67abd89bd1 size: 2413<br/>~</span></pre><p id="2a91" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">å¦‚æœä½ æŸ¥çœ‹è°·æ­Œäº‘æ§åˆ¶å°çš„GCRï¼Œæ¨é€çš„å›¾ç‰‡ä¼šåœ¨é‚£é‡Œã€‚</p><h2 id="a720" class="nh lo it bd lp ns nt dn lt nu nv dp lx km nw nx mb kq ny nz mf ku oa ob mj oc bi translated">3.å°†æ¨é€çš„æ˜ åƒéƒ¨ç½²åˆ°äº‘è¿è¡Œ</h2><p id="b6c4" class="pw-post-body-paragraph kb kc it kd b ke ml kg kh ki mm kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½ å·²ç»åœ¨GCRæ³¨å†Œäº†ä½ è‡ªå·±çš„dockerå›¾ç‰‡ã€‚å› æ­¤ï¼Œæ‚¨åªéœ€ä½¿ç”¨æ˜ åƒéƒ¨ç½²äº‘è¿è¡Œã€‚</p><pre class="mz na nb nc gt nd my ne nf aw ng bi"><span id="26ef" class="nh lo it my b gy ni nj l nk nl">$ gcloud beta run deploy --image gcr.io/test-project/next-app:latest --project test-project --platform managed --region asia-northeast1 --allow-unauthenticated</span><span id="b1ae" class="nh lo it my b gy nm nj l nk nl">Service name (next-app):<br/>Deploying container to Cloud Run service [next-app] in project [test-project] region [asia-northeast1]<br/>âœ“ Deploying... Done.<br/>  âœ“ Creating Revision...<br/>  âœ“ Routing traffic...<br/>  âœ“ Setting IAM Policy...<br/>Done.<br/>Service [test-project] revision [test-project-00001-cej] has been deployed and is serving 100 percent of traffic.<br/>Service URL: <a class="ae mr" href="https://ham-media-liff-stg-5eabyjeviq-an.a.run.app" rel="noopener ugc nofollow" target="_blank">https://next-app-5eabyjeviq-an.a.run.app</a></span></pre><p id="09d7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mv mw mx my b">--platform</code>é€‰é¡¹æœ‰ä¸‰ä¸ªå€¼<code class="fe mv mw mx my b">managed</code>ã€<code class="fe mv mw mx my b">gke</code>å’Œ<code class="fe mv mw mx my b">kubernetes</code>ã€‚å¦‚æœæ‚¨æ›´æƒ³è¦åŸºç¡€è®¾æ–½çš„çµæ´»æ€§ï¼Œè¯·é€‰æ‹©<code class="fe mv mw mx my b">gke</code>å’Œ<code class="fe mv mw mx my b">kubernetes</code>ã€‚ä½¿ç”¨<code class="fe mv mw mx my b">--allow-unauthenticated</code>é€‰é¡¹ï¼Œå¯ä»¥å¯¹æœåŠ¡è¿›è¡Œæœªç»éªŒè¯çš„è®¿é—®ã€‚è¯¦æƒ…è¯·çœ‹<a class="ae mr" href="https://cloud.google.com/sdk/gcloud/reference/beta/run/deploy" rel="noopener ugc nofollow" target="_blank">å®˜ç½‘</a>ã€‚</p><p id="7bae" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">å› ä¸ºæ‚¨å·²ç»éƒ¨ç½²äº†æœåŠ¡ï¼Œè¯·è½¬åˆ°æœåŠ¡URLã€‚å¯ä»¥çœ‹Next.js hello worldã€‚</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/0dfab1cbc99e0748b085142c6598a235.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bUgwMdg9bEDtmZSyzO89Qg.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">éƒ¨ç½²çš„æœåŠ¡</figcaption></figure><p id="cb08" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">å°±æ˜¯è¿™æ ·ï¼æœ€åï¼Œæ‚¨å®Œæˆäº†å°†Next.jsåº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°Google Cloud Runã€‚</p><h1 id="62a2" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">æŠ€å·§</h1><p id="0b1b" class="pw-post-body-paragraph kb kc it kd b ke ml kg kh ki mm kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">æ¯æ¬¡éƒ¨ç½²æ—¶è¾“å…¥æ¯ä¸ªæ­¥éª¤éå¸¸è€—æ—¶ã€‚æ‰€ä»¥æˆ‘å»ºè®®æ‚¨åˆ›å»ºå¦‚ä¸‹æ‰€ç¤ºçš„éƒ¨ç½²è„šæœ¬ã€‚</p><pre class="mz na nb nc gt nd my ne nf aw ng bi"><span id="f8c1" class="nh lo it my b gy ni nj l nk nl">// deploy.sh<br/>#!/bin/bash<br/>set -e</span><span id="6ecc" class="nh lo it my b gy nm nj l nk nl">// Image tag is the last commit hash<br/>IMAGE_TAG=`git rev-parse HEAD`<br/>REPO_NAME="Foo"<br/>GCP_PROJECT_NAME="Bar"</span><span id="5e06" class="nh lo it my b gy nm nj l nk nl">docker build . -t $REPO_NAME:$IMAGE_TAG</span><span id="e089" class="nh lo it my b gy nm nj l nk nl">docker tag $REPO_NAME gcr.io/$GCP_PROJECT_NAME/$REPO_NAME:$IMAGE_TAG</span><span id="8614" class="nh lo it my b gy nm nj l nk nl">docker push gcr.io/$GCP_PROJECT_NAME/$REPO_NAME:$IMAGE_TAG</span><span id="e55f" class="nh lo it my b gy nm nj l nk nl">gcloud beta run deploy $REPO_NAME --image gcr.io/$GCP_PROJECT_NAME/$REPO_NAME:$IMAGE_TAG \<br/>  --project $GCP_PROJECT_NAME \<br/>  --platform managed \<br/>  --region asia-northeast1 \<br/>  --allow-unauthenticated</span></pre><p id="7e1c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æœ‰äº†è¿™ä¸ªè„šæœ¬ï¼Œæ‚¨åªéœ€è¦åšçš„æ˜¯</p><pre class="mz na nb nc gt nd my ne nf aw ng bi"><span id="e77b" class="nh lo it my b gy ni nj l nk nl">sh deploy.sh</span></pre><p id="7823" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">å˜£ï¼è‡ªåŠ¨è¿›è¡Œæ„å»ºå’Œéƒ¨ç½²ï¼</p></div><div class="ab cl of og hx oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="im in io ip iq"><p id="e9ab" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">è¿™ç¯‡æ–‡ç« è§£é‡Šäº†Google Cloud Runä¸ŠNext.jsåº”ç”¨ç¨‹åºçš„å¿«é€Ÿè®¾ç½®ã€‚å› ä¸ºä½ å®Œæˆäº†åŸºç¡€è®¾æ–½ï¼Œä½ å¯ä»¥ä»ç°åœ¨å¼€å§‹ä¸“æ³¨äºåº”ç”¨ç¨‹åºä»£ç ï¼å°½æƒ…äº«å—å§ï¼</p><h1 id="c325" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">å‚è€ƒæ–‡çŒ®</h1><ul class=""><li id="3133" class="kz la it kd b ke ml ki mm km mn kq mo ku mp ky mq lf lg lh bi translated"><a class="ae mr" href="https://nextjs.org/" rel="noopener ugc nofollow" target="_blank"> Next.js </a></li><li id="abda" class="kz la it kd b ke li ki lj km lk kq ll ku lm ky mq lf lg lh bi translated"><a class="ae mr" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank">è°·æ­Œäº‘</a></li></ul></div></div>    
</body>
</html>