# ä¸€æ­¥ä¸€æ­¥:æ„å»ºå’Œå‘å¸ƒ NPM æ‰“å­—ç¨¿åŒ…ã€‚

> åŸæ–‡ï¼š<https://itnext.io/step-by-step-building-and-publishing-an-npm-typescript-package-44fe7164964c?source=collection_archive---------0----------------------->

![](img/348b4c3661179fb896d6b6454f02345e.png)

# ä»‹ç»

åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨ Typescript ä¸­æ„å»ºä¸€ä¸ªå¯é‡ç”¨æ¨¡å—ï¼Œå¹¶å°†å…¶å‘å¸ƒä¸ºä¸€ä¸ª **Node.js** åŒ…ã€‚æˆ‘è§è¿‡å¾ˆå¤šä¸åŒçš„æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘æƒ³å‘ä½ å±•ç¤ºå¦‚ä½•ä½¿ç”¨æœ€ä½³å®è·µå’Œå·¥å…·æ¥åˆ›å»ºä½ è‡ªå·±çš„åŒ…ï¼Œä¸€æ­¥ä¸€æ­¥åœ°ä½¿ç”¨ **Typescript** ã€ **Tslint** ã€**prettleã€**å’Œ **Jestã€‚**

è¿™å°±æ˜¯æˆ‘ä»¬è¦æ‰“é€ çš„:
[https://www.npmjs.com/package/my-awesome-greeter](https://www.npmjs.com/package/my-awesome-greeter)
[https://github.com/cjkihl/my-awesome-greeter](https://github.com/cjkihl/my-awesome-greeter)

# ä»€ä¹ˆæ˜¯ NPMï¼Ÿ

Npm æ˜¯ Javascript çš„åŒ…ç®¡ç†å™¨ï¼Œä¹Ÿæ˜¯ä¸–ç•Œä¸Šæœ€å¤§çš„å¯é‡ç”¨è½¯ä»¶ä»£ç åº“ã€‚å®ƒæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ„å»ºå·¥å…·ï¼Œæˆ‘å°†åœ¨åé¢å±•ç¤ºã€‚

# ä¸ºä»€ä¹ˆæ‰“å­—ç¨¿ï¼Ÿ

ä½œä¸º Javascript çš„è¶…é›†ï¼ŒTypescript æä¾›å¯é€‰çš„ç±»å‹å’Œæ·±åº¦æ™ºèƒ½æ„ŸçŸ¥ã€‚è¯´åˆ°åŒ…å¼€å‘ï¼Œè¿™æ˜¯æˆ‘ä¸ªäººçš„çœ‹æ³•:

> **æˆ‘è®¤ä¸ºæ‰€æœ‰çš„åŒ…éƒ½åº”è¯¥ç”¨ Typescript æ„å»º**

ä½ ä»¬ä¸­çš„ä¸€äº›äººå¯èƒ½ä¼šè§‰å¾—å¼ºè¾“å…¥ä¼šé™ä½ç”Ÿäº§ç‡ï¼Œä¸å€¼å¾—èŠ±åŠ›æ°”å»ä½¿ç”¨ã€‚å¯¹äºå°è§„æ¨¡çš„é¡¹ç›®ï¼Œæˆ‘åŒæ„ï¼Œä½†æ˜¯å¯¹äºåŒ…å¼€å‘ï¼ŒTypescript æœ‰ä¸€äº›é‡è¦çš„ä¼˜åŠ¿:

*   æ›´å¥å£®çš„ä»£ç ï¼Œæ›´æ˜“äºç»´æŠ¤ã€‚
*   è¿™ä¸ªåŒ…å¯ä»¥ç”¨äº Typescript å’Œ Javascript ç”¨æˆ·ï¼å¦‚æœä½ çš„åº“å˜å¾—æµè¡Œï¼Œè¿Ÿæ—©ä¼šæœ‰å¯¹ç±»å‹å®šä¹‰çš„éœ€æ±‚ï¼Œæ‰‹åŠ¨ç¼–å†™ç±»å‹å®šä¹‰å¾ˆè€—æ—¶ï¼Œå®¹æ˜“å‡ºé”™ï¼Œå¹¶ä¸”æ›´éš¾æ›´æ–°ã€‚
*   æœ‰äº†åŒ…ä¸­çš„ç±»å‹å®šä¹‰ï¼Œç”¨æˆ·å°±ä¸å¿…ä»å¦ä¸€ä¸ªåŒ…ä¸­ä¸‹è½½ç±»å‹ã€‚
*   å¼ºç±»å‹æ›´åŠ è‡ªæ–‡æ¡£åŒ–ï¼Œä½¿ä»£ç æ›´å®¹æ˜“ç†è§£ã€‚
*   å³ä½¿ä½¿ç”¨ä½ çš„åŒ…çš„äººä¸ä½¿ç”¨ Typescriptï¼Œä¸€äº›ç¼–è¾‘å™¨ï¼Œåƒ **Visual Studio Code** ä»ç„¶ä¼šä½¿ç”¨ç±»å‹å®šä¹‰æ¥ç»™ç”¨æˆ·æ›´å¥½çš„æ™ºèƒ½æ„ŸçŸ¥ã€‚

# å¥½å§ã€‚æˆ‘ä»¬å¼€å§‹å§ï¼

ç¡®ä¿æ‚¨æ‹¥æœ‰æœ€æ–°ç‰ˆæœ¬çš„èŠ‚ç‚¹å’Œ npmã€‚

```
node -v
v17.8.0npm -v
8.5.5
```

# æŒ‘ä¸ªå¥½åå­—

è¿™å¯èƒ½æ¯”å¬èµ·æ¥è¦éš¾ã€‚åŒ…åå¿…é¡»æ˜¯ pascal å¤§å°å†™ã€‚æ—¢ç„¶æœ‰ 700k+çš„è½¯ä»¶åŒ…ï¼Œåœ¨[https://www.npmjs.com/](https://www.npmjs.com/)ä¸Šå¿«é€Ÿæœç´¢ä¸€ä¸‹ï¼Œç¡®ä¿ä½ é‚£ä»¤äººæ•¬ç•çš„åå­—æ²¡æœ‰è¢«å ç”¨ã€‚å‡ºäºæœ¬æŒ‡å—çš„è€ƒè™‘ï¼Œæˆ‘å°†é€‰æ‹©åç§° **my-awesome-greeterï¼Œ**ä½†æ˜¯ä½¿ç”¨ä¸€ä¸ªå”¯ä¸€çš„åç§°ï¼Œä»¥ä¾¿æ‚¨ç¨åå¯ä»¥å°†æ‚¨çš„åŒ…å‘å¸ƒåˆ° NPM**ğŸ˜‰ã€‚**

# åŸºæœ¬è®¾ç½®

ç”¨åˆé€‚çš„åç§°åˆ›å»ºæ‚¨çš„åŒ…æ–‡ä»¶å¤¹

```
mkdir **my-awesome-greeter** && cd **my-awesome-greeter**
```

# åˆ›å»º git å­˜å‚¨åº“

é¦–å…ˆè¦åšçš„äº‹ã€‚æ‚¨éœ€è¦ä¸€ä¸ªè¿œç¨‹ git å­˜å‚¨åº“æ¥å­˜æ”¾æ‚¨çš„åŒ…ï¼Œä»¥ä¾¿å¯ä»¥ä¸‹è½½ã€‚åˆ›å»ºè¿œç¨‹ git å­˜å‚¨åº“è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ï¼Œä½†æ˜¯ä¸€æ—¦æ‚¨å®Œæˆäº†ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸‹é¢å‡ è¡Œæ¥åˆå§‹åŒ–æ‚¨çš„æœ¬åœ°å­˜å‚¨åº“å¹¶è®¾ç½®æ‚¨çš„è¿œç¨‹æºã€‚

```
git init
echo "**# My Awesome Greeter**" >> README.md
git add . && git commit -m "Initial commit"
```

å°† **< Git å­˜å‚¨åº“ Url >** æ›¿æ¢ä¸ºæ‚¨çš„è¿œç¨‹å­˜å‚¨åº“çš„ Urlã€‚

```
git remote add origin **<Git Repository Url>**git push -u origin master
```

# åˆå§‹åŒ–ä½ çš„åŒ…

è®©æˆ‘ä»¬ç”¨æ‰€æœ‰é»˜è®¤å€¼åˆ›å»ºä¸€ä¸ª **package.json** æ–‡ä»¶ã€‚æˆ‘ä»¬ç¨åä¼šä¿®æ”¹è¿™ä¸ªã€‚

```
npm init -y
```

ä½œä¸ºæœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬è¦æ·»åŠ ä¸€ä¸ª**ã€‚gitignore** æ–‡ä»¶åˆ°æ ¹ç›®å½•ã€‚è¿˜æœ‰å¾ˆå¤š**ã€‚gitignore** æ¨¡æ¿åœ¨é‚£é‡Œï¼Œä½†æˆ‘å–œæ¬¢ä¿æŒç®€å•ï¼Œä¸è¦æ·»åŠ è¶…è¿‡ä½ éœ€è¦çš„ã€‚ç›®å‰ï¼Œæˆ‘ä»¬åªéœ€è¦å¿½ç•¥ **node_modules** æ–‡ä»¶å¤¹ã€‚

```
echo **"node_modules"** >> .gitignore
```

å‰å®³ï¼æˆ‘ä»¬å¾—åˆ°äº†åŸºæœ¬çš„ğŸ˜ƒè¿™æ˜¯æˆ‘åœ¨ Visual Studio ä»£ç ä¸­æ‰“å¼€é¡¹ç›®æ—¶çš„æ ·å­ã€‚ä»ç°åœ¨å¼€å§‹æˆ‘å°†ç»§ç»­ä» vscode æ·»åŠ æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ§åˆ¶å°ï¼Œä½†æ˜¯é€‰æ‹©ä¸€ç§é€‚åˆä½ çš„é£æ ¼ğŸ˜‰

![](img/c7f850c65042218626f8bda1b39c00e1.png)

æˆ‘åœ¨ vscode çš„ç‰›é€¼è¿å®¾

![](img/424483d528df1181752fc2c8b1e8cb22.png)

æˆ‘åœ¨ Github çš„ä»“åº“

# å°† Typescript ä½œä¸º DevDependency æ·»åŠ 

è®©æˆ‘ä»¬ä»ä¾èµ– typescript å¼€å§‹

```
npm install --save-dev typescript
```

æ ‡å¿—`--save-dev`å°†å‘Šè¯‰ NPM å®‰è£… Typescript ä½œä¸º **devDependency** ã€‚devDependency å’Œ Dependency ä¹‹é—´çš„åŒºåˆ«åœ¨äºï¼ŒdevDependencies åªä¼šåœ¨æ‚¨è¿è¡Œ **npm install** æ—¶å®‰è£…ï¼Œè€Œä¸ä¼šåœ¨æœ€ç»ˆç”¨æˆ·å®‰è£…è½¯ä»¶åŒ…æ—¶å®‰è£…ã€‚
ä¾‹å¦‚ï¼ŒTypescript åªåœ¨å¼€å‘åŒ…æ—¶éœ€è¦ï¼Œè€Œåœ¨ä½¿ç”¨åŒ…æ—¶ä¸éœ€è¦ã€‚

å¾ˆå¥½ï¼ç°åœ¨ä½ ä¼šåœ¨ä½ çš„æ ¹ç›®å½•ä¸‹çœ‹åˆ°ä¸€ä¸ª **node_modules** æ–‡ä»¶å¤¹å’Œä¸€ä¸ª **package-lock.json** ã€‚

ä¸ºäº†ç¼–è¯‘ Typescriptï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ª **tsconfig.json** æ–‡ä»¶ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å°†å®ƒæ·»åŠ åˆ°é¡¹ç›®æ ¹ç›®å½•:

```
{
  "compilerOptions": {
    "target": "es5",
    "module": "commonjs",
    "declaration": true,
    "outDir": "./lib",
    "strict": true
  },
  "include": ["src"],
  "exclude": ["node_modules", "**/__tests__/*"]
}
```

![](img/7207072e2e1debb948a8f4aeea41d86d.png)

è¿™é‡Œå‘ç”Ÿäº†å¾ˆå¤šäº‹æƒ…ï¼Œæˆ‘ä»¬æ¥è§£é‡Šä¸€ä¸‹æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶:
**target** :æˆ‘ä»¬è¦ç¼–è¯‘åˆ° **es5** æ—¢ç„¶æˆ‘ä»¬è¦æ„å»ºä¸€ä¸ªå…¼å®¹æµè§ˆå™¨çš„åŒ…ï¼Œ
**æ¨¡å—**:å…¼å®¹æ€§ä½¿ç”¨ commonjsã€‚
**å£°æ˜**:å½“ä½ æ„å»ºåŒ…çš„æ—¶å€™ï¼Œè¿™åº”è¯¥æ˜¯çœŸçš„ã€‚ç„¶åï¼ŒTypescript è¿˜ä¼šå°†ç±»å‹å®šä¹‰ä¸ç¼–è¯‘åçš„ javascript ä»£ç ä¸€èµ·å¯¼å‡ºï¼Œè¿™æ ·åŒ…å°±å¯ä»¥åŒæ—¶ç”¨äº Typescript å’Œ Javascriptã€‚
**outDir**:JavaScript å°†è¢«ç¼–è¯‘åˆ° lib æ–‡ä»¶å¤¹ã€‚
**include:**src æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æºæ–‡ä»¶
**exclude:** æˆ‘ä»¬ä¸æƒ³ä¼ è¾“ node_modules æˆ–æµ‹è¯•ï¼Œå› ä¸ºå®ƒä»¬åªåœ¨å¼€å‘æœŸé—´ä½¿ç”¨ã€‚

# ä½ çš„ç¬¬ä¸€ä¸ªä»£ç ï¼

ç°åœ¨ï¼Œå½“æˆ‘ä»¬å»ºç«‹äº†ç¼–è¯‘ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ æˆ‘ä»¬çš„ç¬¬ä¸€è¡Œä»£ç ã€‚
è®©æˆ‘ä»¬åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª`src`æ–‡ä»¶å¤¹ï¼Œå¹¶æ·»åŠ ä¸€ä¸ª index.ts æ–‡ä»¶:

```
export const Greeter = (name: string) => `Hello ${name}`; 
```

å¥½å§ï¼Œè¿™æ˜¯ä¸ªå¥½çš„å¼€å§‹ã€‚ä¸‹ä¸€æ­¥æ˜¯å‘ **package.json:** æ·»åŠ ä¸€ä¸ªæ„å»ºè„šæœ¬

```
"build" : "tsc"
```

![](img/429bd1ca3fbdfc5bc76fa96c8fa83d07.png)

ç°åœ¨ï¼Œæ‚¨å¯ä»¥åœ¨æ§åˆ¶å°ä¸­è¿è¡Œ build å‘½ä»¤:

```
npm run build
```

è¿˜æœ‰ç»´å¥¥è±ï¼

ä½ ä¼šåœ¨æ ¹ç›®å½•ä¸‹çœ‹åˆ°ä¸€ä¸ªæ–°çš„ **lib** æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰ä½ ç¼–è¯‘çš„ä»£ç å’Œç±»å‹å®šä¹‰ï¼

![](img/fe58c5dec4fad5a5aca4e5356aeee81a.png)

# å¿½ç•¥ git ä¸­ç¼–è¯‘çš„ä»£ç 

é™¤äº† **package-lock.json** ä¹‹å¤–ï¼Œæ‚¨é€šå¸¸ä¸å¸Œæœ›è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶å¤„äºæºä»£ç æ§åˆ¶ä¹‹ä¸‹ã€‚æ¯æ¬¡è‡ªåŠ¨ç”Ÿæˆæ—¶ï¼Œå®ƒéƒ½ä¼šå¯¼è‡´ä¸å¿…è¦çš„å†²çªã€‚è®©æˆ‘ä»¬å°† lib æ–‡ä»¶å¤¹æ·»åŠ åˆ°ã€‚gitignore:

```
node_modules
/lib
```

lib å‰çš„æ–œçº¿è¡¨ç¤ºâ€œä»…å¿½ç•¥æ ¹ç›®å½•é¡¶éƒ¨çš„ lib æ–‡ä»¶å¤¹â€ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬åœ¨è¿™ç§æƒ…å†µä¸‹æƒ³è¦çš„ã€‚

# æ ¼å¼å’Œæ—æŒº

ä¸€ä¸ªä¼˜ç§€çš„è½¯ä»¶åŒ…åº”è¯¥åŒ…å«ä¸¥æ ¼çš„æ—æŒºå’Œæ ¼å¼è§„åˆ™ã€‚å°¤å…¶æ˜¯å¦‚æœä½ ä»¥åæƒ³è¦æ›´å¤šçš„åˆä½œè€…ã€‚å†åŠ ä¸Š**æ›´æ¼‚äº®çš„**å’Œ **TsLint å§ï¼**

åƒ Typescript ä¸€æ ·ï¼Œè¿™äº›å·¥å…·ä»…ç”¨äºåŒ…çš„å¼€å‘ã€‚å®ƒä»¬åº”è¯¥è¢«æ·»åŠ ä¸º **devDependencies** :

```
npm install --save-dev prettier tslint tslint-config-prettier
```

tslint-config-appellister æ˜¯æˆ‘ä»¬éœ€è¦çš„é¢„ç½®ï¼Œå› ä¸ºå®ƒé˜²æ­¢äº† ts lint å’Œ prettiers æ ¼å¼è§„åˆ™ä¹‹é—´çš„å†²çªã€‚

åœ¨æ ¹ç›®å½•ä¸‹ï¼Œæ·»åŠ ä¸€ä¸ª **tslint.json** :

```
{
   "extends": ["tslint:recommended", "tslint-config-prettier"]
}
```

è¿˜æœ‰ä¸€ä¸ª**ã€‚prettierrc**

```
{
  "printWidth": 120,
  "trailingComma": "all",
  "singleQuote": true
}
```

æœ€åï¼Œå°† **lint-** å’Œ**æ ¼å¼**è„šæœ¬æ·»åŠ åˆ° **package.json** ä¸­

```
"format": "prettier --write \"src/**/*.ts\" \"src/**/*.js\"",
"lint": "tslint -p tsconfig.json"
```

æ‚¨çš„ **package.json** ç°åœ¨åº”è¯¥æ˜¯è¿™æ ·çš„:

![](img/b9db66067d737f3a1d5aa0c0ac9df302.png)

ç°åœ¨æ‚¨å¯ä»¥åœ¨æ§åˆ¶å°ä¸­è¿è¡Œ **npm run lint** å’Œ **npm run format** :

```
npm run lint
npm run format
```

![](img/7adcaf889f785d67ef92b195c87c1409.png)

# ä¸è¦åœ¨ä½ çš„åŒ…è£¹é‡Œæ”¾è¶…è¿‡ä½ éœ€è¦çš„ä¸œè¥¿ï¼

åœ¨æˆ‘ä»¬çš„**é‡Œã€‚gitignore** æ–‡ä»¶ï¼Œæˆ‘ä»¬æ·»åŠ äº†`/lib`ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æƒ³è®©æ„å»ºæ–‡ä»¶å‡ºç°åœ¨æˆ‘ä»¬çš„ git å­˜å‚¨åº“ä¸­ã€‚å‘å¸ƒåŒ…çš„æƒ…å†µæ­£å¥½ç›¸åã€‚æˆ‘ä»¬ä¸æƒ³è¦æºä»£ç ï¼Œ**åªè¦**æ„å»ºæ–‡ä»¶ï¼

è¿™å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼è§£å†³ã€‚ä¸€ç§æ–¹æ³•æ˜¯åœ¨**ä¸­å°†æ–‡ä»¶/æ–‡ä»¶å¤¹åˆ—å…¥é»‘åå•ã€‚npmignore** æ–‡ä»¶ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­åº”è¯¥æ˜¯è¿™æ ·çš„:

```
src
tsconfig.json
tslint.json
.prettierrc
```

ä½†æ˜¯ï¼Œå°†æ–‡ä»¶åˆ—å…¥é»‘åå•å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„åšæ³•ã€‚æ·»åŠ åˆ°æ ¹ç›®å½•çš„æ¯ä¸ªæ–°æ–‡ä»¶/æ–‡ä»¶å¤¹éƒ½éœ€è¦æ·»åŠ åˆ°**ã€‚npmignore** æ–‡ä»¶ä¹Ÿä¸€æ ·ï¼ç›¸åï¼Œä½ åº”è¯¥**å°†ä½ æƒ³è¦å‘å¸ƒçš„æ–‡ä»¶/æ–‡ä»¶å¤¹åˆ—å…¥ç™½åå•**ã€‚è¿™å¯ä»¥é€šè¿‡åœ¨ **package.json:** ä¸­æ·»åŠ **æ–‡ä»¶**å±æ€§æ¥å®ç°

```
â€œfilesâ€: [â€œlib/**/*â€]
```

å°±æ˜¯è¿™æ ·ï¼å®¹æ˜“çš„ğŸ˜ƒå‘å¸ƒçš„åŒ…ä¸­åªåŒ…å« lib æ–‡ä»¶å¤¹ï¼(é»˜è®¤æ·»åŠ  **README.md** å’Œ **package.json** )ã€‚

å…³äº NPM è½¯ä»¶åŒ…ä¸­ç™½åå•å’Œé»‘åå•çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·çœ‹æ¥è‡ª NPM åšå®¢çš„è¿™ç¯‡æ–‡ç« ã€‚(æ„Ÿè°¢ [Tibor BlÃ©nessy](https://medium.com/u/34500fc3e94?source=post_page-----44fe7164964c--------------------------------) çš„å‚è€ƒ)

# ç”¨ Jest è®¾ç½®æµ‹è¯•

ä¸€ä¸ªä»¤äººæ•¬ç•çš„åŒ…åº”è¯¥åŒ…æ‹¬å•å…ƒæµ‹è¯•ï¼å†æ¥è¡¥å……ä¸€ä¸‹ [**Jest**](https://facebook.github.io/jest/) :è„¸ä¹¦çš„ä¸€ä¸ªç‰›é€¼æµ‹è¯•æ¡†æ¶ã€‚

![](img/68469f70511fc934655c2399467254e3.png)

Jest:è„¸ä¹¦çš„æµ‹è¯•æ¡†æ¶

ç”±äºæˆ‘ä»¬å°†é’ˆå¯¹æˆ‘ä»¬çš„ typescript æºæ–‡ä»¶ç¼–å†™æµ‹è¯•ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ·»åŠ `[ts-jest](https://github.com/kulshekhar/ts-jest)`å’Œ`@types/jest`ã€‚æµ‹è¯•å¥—ä»¶ä»…åœ¨å¼€å‘æœŸé—´ä½¿ç”¨ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å°†å®ƒä»¬æ·»åŠ ä¸º **devDependencies**

```
npm install --save-dev jest ts-jest @types/jest
```

é…·ï¼ç°åœ¨æˆ‘ä»¬éœ€è¦é…ç½® Jestã€‚ä½ å¯ä»¥é€‰æ‹©ç»™ **package.json** å†™ä¸€ä¸ª`jest`éƒ¨åˆ†ï¼Œæˆ–è€…åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„é…ç½®æ–‡ä»¶ã€‚æˆ‘ä»¬å°†æŠŠå®ƒæ·»åŠ åˆ°ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬å‘å¸ƒè¿™ä¸ªåŒ…æ—¶ï¼Œå®ƒä¸ä¼šåŒ…å«åœ¨å†…ã€‚

åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå‘½åä¸º **jestconfig.json:**

```
{
  "transform": {
    "^.+\\.(t|j)sx?$": "ts-jest"
  },
  "testRegex": "(/__tests__/.*|(\\.|/)(test|spec))\\.(jsx?|tsx?)$",
  "moduleFileExtensions": ["ts", "tsx", "js", "jsx", "json", "node"]
}
```

åˆ é™¤ **package.json** ä¸­çš„æ—§æµ‹è¯•è„šæœ¬ï¼Œå°†å…¶æ”¹ä¸º:

```
"test": "jest --config jestconfig.json",
```

è¿™ä¸ª **package.json** åº”è¯¥æ˜¯è¿™æ ·çš„:

![](img/474a61aabf88ceab521ae230d1160766.png)

# ç¼–å†™ä¸€ä¸ªåŸºæœ¬æµ‹è¯•

æ˜¯æ—¶å€™å†™æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæµ‹è¯•äº†ï¼ğŸ˜ƒ

åœ¨`src`æ–‡ä»¶å¤¹ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªåä¸º`__tests__`çš„æ–°æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨é‡Œé¢æ·»åŠ ä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œæ–‡ä»¶åä½ å–œæ¬¢ï¼Œä½†å¿…é¡»ä»¥`test.ts`ç»“å°¾ï¼Œä¾‹å¦‚`Greeter.test.ts`

```
import { Greeter } from '../index';test('My Greeter', () => {
  expect(Greeter('Carl')).toBe('Hello Carl');
});
```

å¥½äº†ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œåšçš„å”¯ä¸€ä¸€ä»¶äº‹å°±æ˜¯éªŒè¯å¦‚æœè¾“å…¥æ˜¯`Carl`ï¼Œæˆ‘ä»¬çš„æ–¹æ³•`Greeter`å°†è¿”å›`Hello Carl`ã€‚

ç°åœ¨ï¼Œè¯•ç€è·‘

```
npm test
```

![](img/11fce662aa2e016646e40a51f16c75cb.png)

é…·ï¼Œå®ƒçš„å·¥ä½œï¼å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬é€šè¿‡äº†ä¸€é¡¹æµ‹è¯•ã€‚

# åœ¨ NPM ä½¿ç”¨é­”æ³•è„šæœ¬

å¯¹äºä¸€ä¸ªä»¤äººæ•¬ç•çš„åŒ…ï¼Œæˆ‘ä»¬å½“ç„¶åº”è¯¥å°½å¯èƒ½åœ°è‡ªåŠ¨åŒ–ã€‚æˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ npm ä¸­çš„ä¸€äº›è„šæœ¬:**å‡†å¤‡**ï¼Œ**ä»…é¢„å‘å¸ƒ**ï¼Œ**å‰ç‰ˆæœ¬**ï¼Œ**ç‰ˆæœ¬**å’Œ**åç‰ˆæœ¬**

**å‡†å¤‡**å°†åœ¨åŒ…æ‰“åŒ…å’Œå‘å¸ƒä¹‹å‰è¿è¡Œï¼Œä¹Ÿåœ¨æœ¬åœ°`npm install`è¿è¡Œã€‚éå¸¸é€‚åˆè¿è¡Œæ„å»ºä»£ç ã€‚å°†è¿™ä¸ªè„šæœ¬æ·»åŠ åˆ° **package.json**

```
"prepare" : "npm run build"
```

**ä»…**å°†åœ¨**å‡†å¤‡**å’Œä¹‹å‰è¿è¡Œï¼Œä»…åœ¨`**npm publish**`è¿è¡Œã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†è¿è¡Œæˆ‘ä»¬çš„æµ‹è¯•å’Œ lintï¼Œä»¥ç¡®ä¿æˆ‘ä»¬ä¸ä¼šå‘å¸ƒé”™è¯¯çš„ä»£ç :

```
"prepublishOnly" : "npm test && npm run lint"
```

**é¢„ç‰ˆæœ¬**å°†åœ¨ç¢°æ’æ–°çš„è½¯ä»¶åŒ…ç‰ˆæœ¬ä¹‹å‰è¿è¡Œã€‚ä¸ºäº†é¢å¤–ç¡®ä¿æˆ‘ä»¬æ²¡æœ‰ç”¨ç³Ÿç³•çš„ä»£ç ç¢°æ’ä¸€ä¸ªç‰ˆæœ¬ï¼Œä¸ºä»€ä¹ˆä¸åœ¨è¿™é‡Œä¹Ÿè¿è¡Œ lint å‘¢ï¼ŸğŸ˜ƒ

```
"preversion" : "npm run lint"
```

**ç‰ˆæœ¬**å°†åœ¨æ–°ç‰ˆæœ¬è¢«ç¢°æ’åè¿è¡Œã€‚å¦‚æœä½ çš„åŒ…æœ‰ä¸€ä¸ª git åº“ï¼Œå°±åƒæˆ‘ä»¬çš„ä¾‹å­ä¸€æ ·ï¼Œæ¯æ¬¡ä½ å‡çº§ä¸€ä¸ªæ–°ç‰ˆæœ¬æ—¶ï¼Œéƒ½ä¼šæäº¤ä¸€ä¸ªæ–°çš„ç‰ˆæœ¬æ ‡ç­¾ã€‚è¯¥å‘½ä»¤å°†åœ¨æäº¤ä¹‹å‰è¿è¡Œã€‚ä¸€ä¸ªæƒ³æ³•æ˜¯åœ¨è¿™é‡Œè¿è¡Œæ ¼å¼åŒ–ç¨‹åºï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰éš¾çœ‹çš„ä»£ç ä¼ å…¥æ–°ç‰ˆæœ¬:

```
"version" : "npm run format && git add -A src"
```

**æäº¤åç‰ˆæœ¬**å°†åœ¨æäº¤åè¿è¡Œã€‚è¿™æ˜¯æäº¤å’Œæ ‡è®°çš„ç»ä½³ä½ç½®ã€‚

```
"postversion" : "git push && git push --tags"
```

è¿™æ˜¯æˆ‘åœ¨ **package.json** ä¸­çš„è„šæœ¬éƒ¨åˆ†çš„æ ·å­:

```
"scripts": {
   "test": "jest --config jestconfig.json",
   "build": "tsc",
   "format": "prettier --write \"src/**/*.ts\" \"src/**/*.js\"",
   "lint": "tslint -p tsconfig.json",
   "prepare": "npm run build",
   "prepublishOnly": "npm test && npm run lint",
   "preversion": "npm run lint",
   "version": "npm run format && git add -A src",
   "postversion": "git push && git push --tags"
}
```

# æ­£åœ¨å®Œæˆ package.json

ç»ˆäºåˆ°äº†å®Œæˆæˆ‘ä»¬ä»¤äººæ•¬ç•çš„åŒ…è£¹çš„æ—¶å€™äº†ï¼é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å†æ¬¡å¯¹æˆ‘ä»¬çš„ **package.json** è¿›è¡Œä¸€äº›ä¿®æ”¹:

```
{
   "name": "my-awesome-greeter",
   "version": "1.0.0",
   **"description": "A nice greeter",**
  ** "main": "lib/index.js",
   "types": "lib/index.d.ts",**
   "scripts": {
      "test": "jest --config jestconfig.json",
      "build": "tsc",
      "format": "prettier --write \"src/**/*.ts\" \"src/**/*.js\"",
      "lint": "tslint -p tsconfig.json",
      "prepare": "npm run build",
      "prepublishOnly": "npm test && npm run lint",
      "preversion": "npm run lint",
      "version": "npm run format && git add -A src",
      "postversion": "git push && git push --tags"
   },
   "repository": {
     "type": "git",
     "url": "git+https://github.com/caki0915/my-awesome-greeter.git"
   },
  ** "keywords": ["Hello", "Greeter"],
   "author": "C-J",**
   ....
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªå¾ˆå¥½çš„æè¿°ï¼Œä¸€ä¸ªä½œè€…ï¼Œå’Œä¸€äº›ç›¸å…³çš„å…³é”®å­—ã€‚é”® **main** åœ¨è¿™é‡Œå¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒå°†å‘Šè¯‰ **npm** å®ƒå¯ä»¥ä»å“ªé‡Œå¯¼å…¥æ¨¡å—ã€‚
é”®**ç±»å‹**å°†å‘Šè¯‰ç±»å‹è„šæœ¬å’Œä»£ç ç¼–è¾‘å™¨åœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°ç±»å‹å®šä¹‰ï¼

# æäº¤æ‚¨çš„ä»£ç å¹¶å°†å…¶æ¨é€åˆ° git

æ˜¯æ—¶å€™å°†æ‰€æœ‰å·¥ä½œæ¨é€åˆ°æ‚¨çš„è¿œç¨‹å­˜å‚¨åº“äº†ï¼å¦‚æœä½ è¿˜æ²¡æœ‰æäº¤ä½ çš„æœ€æ–°ä»£ç ï¼Œç°åœ¨æ˜¯æ—¶å€™äº†ã€‚ğŸ˜‰

```
git add -A && git commit -m "Setup Package"
git push
```

# å°†æ‚¨çš„åŒ…å‘å¸ƒåˆ° NPMï¼

ä¸ºäº†å‘å¸ƒæ‚¨çš„åŒ…ï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ª NPM å¸æˆ·ã€‚
å¦‚æœä½ æ²¡æœ‰å¸å·ï¼Œä½ å¯ä»¥åœ¨[https://www.npmjs.com/signup](https://www.npmjs.com/signup)æˆ–è€…è¿è¡Œå‘½ä»¤:`npm adduser`æ¥æ³¨å†Œ

å¦‚æœæ‚¨å·²ç»æœ‰å¸æˆ·ï¼Œè¿è¡Œ`npm login`ç™»å½•æ‚¨çš„ NPM å¸æˆ·ã€‚

![](img/0dc9e7d54b97e00a74160b3f784bdd31.png)

ç™»å½•æˆ‘ç°æœ‰çš„ NPM å¸æˆ·

å¥½å§ï¼ç°åœ¨è¿è¡Œå‘å¸ƒã€‚

```
npm publish
```

å¦‚æ‚¨æ‰€è§ï¼Œåœ¨å‘å¸ƒåŒ…ä¹‹å‰ï¼ŒåŒ…å°†é¦–å…ˆç”±**å‡†å¤‡**è„šæœ¬æ„å»ºï¼Œç„¶å**æµ‹è¯•**å’Œ **lint** å°†ç”±**é¢„å‘å¸ƒä»…**è„šæœ¬è¿è¡Œã€‚

![](img/039c5e6f356b29b723782ca5ac1352d8.png)

# æŸ¥çœ‹æ‚¨çš„åŒ…è£¹

ç°åœ¨åœ¨ **npmjs ä¸Šæµè§ˆä½ çš„åŒ…ã€‚**URL æ˜¯**https://npmjs.com/package/**<your-package-name>**åœ¨æˆ‘è¿™é‡Œæ˜¯[**https://npmjs.com/package/my-awesome-greeter**](https://npmjs.com/package/my-awesome-greeter)**

**![](img/ae7fa064fd9df806a5253f2bd2989b9c.png)**

**ä¸é”™ï¼æˆ‘ä»¬æ”¶åˆ°ä¸€ä¸ªåŒ…è£¹ğŸ˜ ğŸ“¦ç›®å‰çœ‹èµ·æ¥ä¸é”™ï¼**

# **ç¢°æ’æ–°ç‰ˆæœ¬**

**è®©æˆ‘ä»¬æ’ä¸Šä¸€ä¸ªæ–°çš„è¡¥ä¸ç‰ˆæœ¬çš„è½¯ä»¶åŒ…:**

```
npm version patch
```

**æˆ‘ä»¬çš„**å‰ç‰ˆæœ¬**ã€**ç‰ˆæœ¬ã€**å’Œ**åç‰ˆæœ¬**å°†è¿è¡Œï¼Œåœ¨ git ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ ‡ç­¾ï¼Œå¹¶å°†å…¶æ¨é€åˆ°æˆ‘ä»¬çš„è¿œç¨‹å­˜å‚¨åº“ã€‚ç°åœ¨å†æ¬¡å‘å¸ƒ:**

```
npm publish
```

**ç°åœ¨ä½ æœ‰äº†ä¸€ä¸ªæ–°ç‰ˆæœ¬**

**![](img/d64be6cc52554e38de6efdfe82ed7d68.png)**

**NPM çš„æ–°ç‰ˆæœ¬**

**![](img/f6080f886985c716b0818788d3ed10d4.png)**

**Github çš„æ–°ç‰ˆæœ¬**

# **ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿ**

**å°±æœ¬æ•™ç¨‹çš„èŒƒå›´è€Œè¨€ï¼Œæˆ‘æƒ³æš‚æ—¶å°±æ­¤æ‰“ä½ï¼Œæˆ‘ç§°ä¹‹ä¸º*â€œNPM è½¯ä»¶åŒ…çš„æœ€å°è®¾ç½®â€ã€‚ç„¶è€Œï¼Œå½“ä½ çš„åŒ…è£¹è¶Šæ¥è¶Šå¤§æ—¶ï¼Œæˆ‘å»ºè®®ä½ :***

*   **ç”¨ [Travis](https://travis-ci.org/) è®¾ç½®è‡ªåŠ¨æ„å»º**
*   **ç”¨ [Codecov](https://codecov.io/) åˆ†æä»£ç è¦†ç›–ç‡**
*   **ä½¿ç”¨[ç›¾ç‰Œ](http://shields.io/)ä¸ºæ‚¨çš„è‡ªè¿°æ–‡ä»¶æ·»åŠ å¾½ç« ã€‚æ¯ä¸ªäººéƒ½å–œæ¬¢å¾½ç« ğŸ˜**

**ä½†æ˜¯è®©æˆ‘ä»¬æŠŠå®ƒç•™ç»™å¦ä¸€ä¸ªæ•™ç¨‹ã€‚**

# **ç¥ä½ å¥½è¿å»ºç«‹ä½ çš„å¯æ€•çš„åŒ…ï¼ğŸ˜ƒ**