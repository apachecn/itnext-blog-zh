# è§’åº¦åŸå‹:å¸¦ Cypress çš„ Firebase ä»¿çœŸå™¨

> åŸæ–‡ï¼š<https://itnext.io/angular-prototyping-firebase-emulator-with-cypress-9ff6f5b3bf8a?source=collection_archive---------1----------------------->

## ä½¿ç”¨ Firebase ä»¿çœŸå™¨å’Œ Cypress è¿›è¡Œå¿«é€Ÿå¼€å‘å’Œæµ‹è¯•çš„è§’åº¦åŸå‹

![](img/ba186e378429df2118d927882dba9e0d.png)

# å…³äºæˆ‘ğŸ‘‹

æˆ‘ç›®å‰æ˜¯ä¸€åè½¯ä»¶å·¥ç¨‹å¸ˆï¼Œåœ¨è´¢å¯Œ 100 å¼ºå…¬å¸æ€ç§‘å·¥ä½œï¼Œå’Œä¸€äº›ä¸šå†…æœ€å¥½çš„ Angular å¼€å‘äººå‘˜ä¸€èµ·å·¥ä½œã€‚æˆ‘åœ¨ä¸šä½™æ—¶é—´ç§¯æä»äº‹ç”± Angular & Firebase æä¾›åŠ¨åŠ›çš„å…¼èŒé¡¹ç›®ã€‚

> ğŸ”¥ [**æºä»£ç **](https://github.com/Everduin94/poc)â€”â€”æˆ–è€…ï¼Œæ¯ä¸ªè¦ç‚¹éƒ½æœ‰ä¸€ä¸ªåˆ°å…¶å¯¹åº”æ–‡ä»¶çš„é“¾æ¥

# ç›®æ ‡ğŸ—ºï¸

*   ğŸ¦ å…¬å¸åˆ©ç”¨ Firestore æ•°æ®è¿›è¡Œäººå·¥å’Œ e2e(èµ›æ™®æ‹‰æ–¯)æµ‹è¯•
*   ğŸ§¬åœ¨ Firestore ä¸­æœ‰æ•ˆåœ°åˆ›å»ºäº†æ¨¡æ‹Ÿæ•°æ®ï¼Œç”¨äºåŸå‹åˆ¶ä½œå’Œæµ‹è¯•
*   ğŸ§ªç¼–è¾‘å’Œåˆ é™¤ä¸ä¼šå½±å“å®æ—¶æ•°æ®æˆ–è®¡å…¥è´¦å•
*   ğŸ”­æ–¹ä¾¿çš„å­˜æ ¹ Firebase è¯·æ±‚
*   ğŸ”’åœ¨ Cypress ä¸­ä½¿ç”¨ä»¿çœŸå™¨è¿›è¡Œèº«ä»½éªŒè¯

åŸå‹æ˜¯æŒ‡æˆ‘ä»¬åˆ©ç”¨ä¸€äº›æ ·æœ¬æˆ–æ¨¡æ‹Ÿæ•°æ®æ¥å¿«é€Ÿæµ‹è¯•ä¸€ä¸ªæƒ³æ³•ã€‚æ¯å½“æˆ‘å¼€å§‹ä¸€ä¸ªæ–°é¡¹ç›®çš„æ—¶å€™ï¼Œæˆ‘åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯è®¾ç½®æ¶æ„æ¥æœ‰æ•ˆåœ°å»ºç«‹åŸå‹ã€‚ â€”ä¸è¦ä¸ [JavaScript åŸå‹](https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/Object_prototypes)æ··æ·†ğŸ™‚

è¯¥è®¾ç½®å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨è®¤è¯å’Œ Firestore æ•°æ®è¿›è¡Œæ‰€æœ‰çš„æ‰‹åŠ¨å’Œ e2e æµ‹è¯•ã€‚â€”è¿™æ„å‘³ç€**æˆ‘ä»¬ä¸å¿…ä¸º e2e æµ‹è¯•åˆ›å»º json fixtures æˆ– cypress æ‹¦æˆªã€‚**

ğŸ’µæ­¤å¤–ï¼Œæˆ‘ä»¬ä¸ä¼šä¸ºåœ¨æˆ‘ä»¬çš„çœŸå®ç¯å¢ƒä¸­çš„è¯»å†™æ“ä½œä»˜è´¹ï¼›å› ä¸ºæˆ‘ä»¬ç”¨çš„æ˜¯æ¨¡æ‹Ÿå™¨ã€‚

è¿™æ˜¯ä¸€ç¯‡ä¸­çº§æ–‡ç« ï¼Œå¦‚æœä½ ä»¥å‰ä»æœªè®¾ç½®è¿‡ firebase é¡¹ç›®ï¼Œæˆ‘æ¨èè¿™ä¸ªè§†é¢‘ [**Firebase å¿«é€Ÿå…¥é—¨**](https://fireship.io/lessons/firebase-quickstart/)**by**FireShip****

# ****è£…ç½®ğŸ”§****

****ä»¥ä¸‹å†…å®¹ä»…åœ¨åˆ©ç”¨ **Firebase** æ—¶æœ‰æ•ˆã€‚å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ *HttpClient* å‚è§[è§’åº¦åŸå‹:ä½¿ç”¨åŸå‹å¼€å‘æ›´å¿«](/angular-develop-faster-with-prototyping-aafdf3376e6e)ã€‚****

****åœ¨ä½¿ç”¨ Angular å’Œ Firebase æ¨¡æ‹Ÿå™¨æ—¶ã€‚æˆ‘å‘ç°äº†è®¸å¤šé™·é˜±ã€‚ä¸ºäº†ä¿æŒè¿™ç¯‡æ–‡ç« çš„ç®€æ´ï¼Œæˆ‘åœ¨æ–‡ç« æœ«å°¾æ·»åŠ äº†ä¸€äº›é™·é˜±ã€‚å¦‚æœä½ é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œå»é‚£é‡Œå¯»æ±‚å¸®åŠ©ã€‚****

****å¦‚æœ**å·²ç»æœ‰äº† Firebase &ä»¿çœŸå™¨è®¾ç½®**ï¼Œè·³åˆ°**ç”¨æ³•ã€‚******

## ****è¦æ±‚****

*   ****Node.js æˆ–æ›´é«˜ç‰ˆæœ¬****
*   ****Java ç‰ˆæœ¬ 1.8 æˆ–æ›´é«˜ç‰ˆæœ¬****
*   ****Firebase CLI 8.14.0 æˆ–æ›´é«˜ç‰ˆæœ¬****

****å¦‚æœä½ æ­£åœ¨è¿›è¡Œ Angular å¼€å‘ï¼Œä½ å¯èƒ½å·²ç»å®‰è£…äº†[*node . js*](https://nodejs.org/en/)ã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰å®‰è£… openjdk ,è¯·ç¡®ä¿åœ¨æ‚¨çš„æœºå™¨ä¸Šå®‰è£… open JDK[ã€‚](https://openjdk.java.net/install/)****

```
****npm install -g firebase-tools**-- Angular
**ng add @angular/fire
firebase init emulators**-- NX **npm install @angular/fire
ng add @nxtend/firebase
nx generate @nxtend/firebase:firebase-project --project NX-APP
nx run NX-APP:firebase --cmd=init****
```

*   ****å®‰è£… Firebase CLI(*Firebase-tools*)****
*   ****å¯¹äº Angular & Nx é¡¹ç›®ï¼Œä¸‹é¢å°†å®‰è£…@angular/fireï¼Œæ·»åŠ ä¸€ä¸ª firebase é…ç½®ï¼Œå¹¶è®¾ç½®æ¨¡æ‹Ÿå™¨ã€‚è®¾ç½® Firebase &æ¨¡æ‹Ÿå™¨æ—¶ï¼Œç¡®ä¿**é€‰æ‹© Firestore &è®¤è¯**ã€‚****
*   ****å¯¹äº Angular é¡¹ç›®ï¼Œé€šå¸¸åªæœ‰ä¸€ä¸ªé¡¹ç›®ï¼Œæ‰€ä»¥è®¾ç½®å¾ˆç®€å•ã€‚å¯¹äº Nx é¡¹ç›®ï¼Œè¿è¡Œ *init* å°† Angular é¡¹ç›®ç»‘å®šåˆ° Firebase é¡¹ç›®ã€‚****

****![](img/0da3ce358c0baef9c0cd0358868223d2.png)****

****åˆå§‹åŒ–ç«ç¾åŸºåœ°****

****![](img/de7e5ae6e15a128c8d0e4bb93d35938a.png)****

****firebase ä»¿çœŸå™¨è®¾ç½®****

# ****é…ç½®âš™ï¸****

****æˆ‘ä½¿ç”¨æ ‡å¿—`environment.production`æ¥å†³å®šæ˜¯å¦ä½¿ç”¨æ¨¡æ‹Ÿå™¨ã€‚åœ¨æˆ‘çš„å¦ä¸€ç¯‡åŸå‹æ–‡ç« ä¸­ï¼Œæˆ‘ä¸ºå†…å­˜ API ä½¿ç”¨äº†ä¸€ä¸ªå®šåˆ¶çš„æ ‡å¿—/ç¯å¢ƒã€‚****

****ä¸ºäº†ä½¿è¿™ç¯‡æ–‡ç« ç®€æ˜æ‰¼è¦ï¼Œæˆ‘å·²ç»åˆ›å»ºäº†ä¸€ç¯‡å•ç‹¬çš„é…å¥—æ–‡ç« ï¼Œä»¥é˜²ä½ æƒ³çŸ¥é“ [**å¦‚ä½•è®¾ç½®è‡ªå®šä¹‰ç¯å¢ƒ**](https://erxk.medium.com/nx-setup-a-custom-environment-116342b7815b) ã€‚****

> ****â— **é‡è¦:**è¿™äº›ä¾‹å­ç”¨@angular/fire **v7** ã€‚****

## ****è®¾ç½®åº”ç”¨ç¨‹åº****

****åœ¨æ‚¨çš„*app . module . ts*ä¸­æ·»åŠ é…ç½®ã€‚è¿™æœ‰ç‚¹é•¿ï¼Œä½†æ˜¯æˆ‘æƒ³ç¡®ä¿å¯¼å…¥æ˜¯æ¸…æ¥šçš„ï¼Œå¹¶ä¸”ä½ å¯ä»¥åˆ é™¤ä½ ä¸éœ€è¦çš„ä¸œè¥¿ã€‚****

****[æ¥æº](https://github.com/Everduin94/poc/blob/main/apps/demo/src/app/app.module.ts#L39-L66)****

*   ****å”¯ä¸€éœ€è¦çš„æä¾›è€…æ˜¯ *provideFirebaseAppï¼Œ*ä½ å¯ä»¥åˆ é™¤ä½ ä¸éœ€è¦çš„æˆ–è€…æ”¹å˜æŒä¹…é€‰é¡¹ã€ç«¯å£ã€ä¸»æœºç­‰ç­‰â€¦****
*   *****environment . firebase config*æ˜¯æ‚¨çš„æ ‡å‡† firebase é…ç½®ï¼Œåªæ˜¯ä¿å­˜åˆ°ä¸€ä¸ªç¯å¢ƒæ–‡ä»¶ä¸­ã€‚****
*   *****experimentalForceLongPolling*æ˜¯åœ¨ Cypress ä¸­ä½¿ç”¨çš„ï¼Œå› æ­¤æˆ‘ä»¬åªå¸Œæœ›å®ƒåœ¨ dev ä¸­å¯ç”¨ã€‚****

> ****ğŸ’¡ä½¿ç”¨ firestore &éªŒè¯æ¨¡æ‹Ÿå™¨é…ç½® **firebase åº”ç”¨ç¨‹åº******

# ****ç”¨é€”â€”â€”åŸå‹åˆ¶ä½œå’Œæµ‹è¯•ğŸ§ª****

****ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºæœ¬ç»„ä»¶ï¼Œç”¨äºéªŒè¯æˆ‘ä»¬çš„æ¨¡æ‹Ÿå™¨æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚å®ƒä»ä¸€ä¸ªåä¸º`tickets`çš„é›†åˆä¸­æå–æ•°æ®ï¼Œå¹¶åœ¨ç»“æœä¸­å¾ªç¯ã€‚****

****[æ¥æº](https://github.com/Everduin94/poc/blob/main/libs/fire/src/lib/fire-ticket/fire-ticket.component.ts)****

```
****firebase emulators:start****
```

*   ****å¯¼èˆªåˆ°`localhost:4202`æŸ¥çœ‹æ¨¡æ‹Ÿå™¨ç•Œé¢ã€‚æ‚¨åº”è¯¥èƒ½å¤Ÿå¯¼èˆªåˆ°å¹¶çœ‹åˆ°ä¸€ä¸ªç©ºçš„ Firestore å®ä¾‹ã€‚å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºå°šæœªå®‰è£…ï¼Œæ‚¨å¯ä»¥åœ¨æ­¤æ·»åŠ æ¨¡æ‹Ÿæ•°æ®ã€‚****
*   ****æˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºä¸­æ‰€åšçš„æ›´æ”¹åº”è¯¥åæ˜ åœ¨æ¨¡æ‹Ÿå™¨ä¸­ï¼Œå¹¶åœ¨æ¨¡æ‹Ÿå™¨ UI ä¸­å¯è§****
*   ****å¸¦æœ‰ JSON çš„å‡ ä¹ç©ºç™½çš„å±å¹•å¹¶ä¸ä»¤äººå…´å¥‹ã€‚ä¸‹é¢æ˜¯ Firestore æ¨¡æ‹Ÿå™¨çš„**ç”Ÿäº§å®ä¾‹ã€‚******

****![](img/a3f5336d720534d3632d080fee03c9cc.png)****

****ä»¿çœŸå™¨ç¤ºä¾‹****

****ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨æ¥è‡ªæ¨¡æ‹Ÿå™¨çš„çº¯æ¨¡æ‹Ÿæ•°æ®****

*   ****ğŸ’¡æˆ‘ä»¬å¯ä»¥å¿«é€Ÿåœ°**ç”Ÿæˆå’Œä¿®æ”¹æ¨¡æ‹Ÿæ•°æ®ï¼Œç”¨äºåŸå‹åˆ¶ä½œ**æƒ³æ³•ã€æ¦‚å¿µè¯æ˜ã€æ–°åŠŸèƒ½ã€æµ‹è¯•é”™è¯¯****
*   ****ğŸ’µæˆ‘ä»¬çš„å®æ—¶ç¯å¢ƒä¸æ”¶å–è¯»å†™è´¹ç”¨****
*   ****ğŸ”¥Firebase è¢«æ–¹ä¾¿åœ°æ¨¡ä»¿ï¼Œä½¿å®ƒæ›´å®¹æ˜“ç”¨çœŸå®æ•°æ®æµ‹è¯•ã€‚****

****ä¿å­˜ä»»ä½•æ›´æ”¹(æ›¿æ¢æ–‡ä»¶å¤¹åç§°)[ã€ç¤ºä¾‹ç»“æœã€‘](https://github.com/Everduin94/poc/tree/main/apps/demo/poc-data)****

```
**-- Save Mock Data **firebase emulators:export FOLDER_NAME** -- Start Emulator with Mock Data **firebase emulators:start --import=FOLDER_NAME****
```

****ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ•°æ®é›†ä½œä¸ºåŸºçº¿**è½»æ¾åœ°è®¾ç½®/æ‹†é™¤ç¯å¢ƒã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨ e2e æµ‹è¯•ä¸­åˆ©ç”¨è¿™äº›æ•°æ®ã€‚******

# ****è­¦å‘Š:åœ¨ç©ç¬‘ä¸­ä½¿ç”¨(å•å…ƒæµ‹è¯•)âŒ****

****æˆ‘ä¸ºæ­¤åˆ›å»ºäº†ä¸€ä¸ªæ¦‚å¿µè¯æ˜ï¼Œä½†æˆ‘é€‰æ‹©ä¸å°†å®ƒæ·»åŠ åˆ°æœ¬æ–‡ä¸­ã€‚å¤æ‚æ€§å’Œç¼ºç‚¹å¤ªå¤šï¼Œä¸å€¼å¾—åš(æµ·äº‹ç»„ç»‡)ã€‚****

*   ****æˆ‘ä»¬å¿…é¡»ä½¿ç”¨ node ä½œä¸º jest ç¯å¢ƒã€‚****
*   ****æˆ‘ä»¬å¿…é¡»å°†æˆ‘ä»¬çš„ firebase é…ç½®æ·»åŠ åˆ°æ¯ä¸ªæµ‹è¯•ä¸­****
*   ****Firebase æ¨¡æ‹Ÿå™¨ä¸åƒå†…å­˜ API é‚£æ ·é‡ç½®æ¯ä¸ªæµ‹è¯•ã€‚****
*   ****é™¤äº†å•å…ƒæµ‹è¯• firebase è§„åˆ™ä¹‹å¤–ï¼Œè¿™ç±»äº‹æƒ…çš„æ–‡æ¡£/æ”¯æŒéå¸¸å°‘****

# ****åœ¨æŸæ ‘ä¸­ä½¿ç”¨(E2E è¯•éªŒ*)ğŸŒ³****

****åœ¨è¿™ä¸ªç­–ç•¥ä¹‹å‰ï¼Œæˆ‘ä¼šå°†æ•°æ®é›†ä¿å­˜åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œæˆ‘çŸ¥é“è¿™äº›ç¯å¢ƒæ˜¯ä¸èƒ½æ”¹å˜çš„ï¼Œå¦åˆ™æˆ‘çš„æµ‹è¯•å¯èƒ½ä¼šå¤±è´¥ğŸ˜±ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸è„†å¼±çš„æ–¹æ³•ã€‚å°†æ¨¡æ‹Ÿå™¨ä¸ Cypress ä¸€èµ·ä½¿ç”¨å¯ä»¥æ˜¾è‘—æ”¹å–„è¿™ä¸ªè¿‡ç¨‹****

```
**-- NX **nx run APP-e2e:e2e --watch**-- Angular
**ng serve
cypress open****
```

****![](img/067f2e0d880b0c2122c93d350fa8415c.png)****

****æŸæ ‘è¯•éªŒ****

*   ****æˆ‘åœ¨æ‰€æœ‰çš„ E2E æµ‹è¯•ä¸­éƒ½ä½¿ç”¨è¿™ä¸ªç­–ç•¥ã€‚****
*   ****å®ƒä½¿ç”¨äº† **0 json fixtures å’Œ 0 cypress interceptsã€‚******
*   ****æ³¨æ„ï¼Œè®°ä½**ä»¿çœŸå™¨ä»…åœ¨å…³æœº**æ—¶æ¸…é™¤æ•°æ®ã€‚åœ¨ CLI ä¸­ï¼Œè¿™å¾ˆå¥½ï¼Œå› ä¸ºæˆ‘ä»¬æ€»æ˜¯ä»å¹²å‡€çš„çŠ¶æ€è¿è¡Œã€‚ä½†æ˜¯å¦‚æœæ‚¨åœ¨æœ¬åœ°ä½¿ç”¨ cypressï¼Œæ‚¨å¯èƒ½å¿…é¡»æ¸…é™¤æ‚¨çš„æ•°æ®æˆ–è€…ç¼–å†™æµ‹è¯•ï¼Œä»¥å›åˆ°å®ƒä»¬æœ€åˆçš„çŠ¶æ€ã€‚****

## ****åœ¨ Cypress ä¸­è®¾ç½® Auth****

****å‰é¢ï¼Œæˆ‘ä»¬æåˆ°ä½¿ç”¨`@angular/fire`å¯¼å…¥å¾ˆé‡è¦ï¼Œè¿™æ ·æä¾›è€…æ‰èƒ½å·¥ä½œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”±äºæˆ‘ä»¬åœ¨ Angular (åœ¨ Cypress ä»£ç ä¸­)çš„ä¸Šä¸‹æ–‡ä¹‹å¤–**ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨`@firebase` importsã€‚â€”åœ¨æˆ‘ä»¬*çš„*å‘½ä»¤ä¸­:******

****[æ¥æº](https://github.com/Everduin94/poc/blob/main/apps/demo-e2e/src/support/commands.ts)****

*   ****è¿™äº›æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½• Cypress æµ‹è¯•ä¸­é‡ç”¨å’Œè°ƒç”¨çš„å‘½ä»¤****
*   ****å½“è¢«è°ƒç”¨æ—¶ï¼Œ**èº«ä»½éªŒè¯ä»¤ç‰Œè¢«æŒä¹…åŒ–åˆ°æµè§ˆå™¨ä¸­ï¼Œ**æˆ‘ä»¬åœ¨ *app.module* ä¸­è®¾ç½®çš„åŸå§‹èº«ä»½éªŒè¯æä¾›è€…ç„¶åè·å–ä»¤ç‰Œã€‚****
*   ****ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„è§’åº¦éªŒè¯é€»è¾‘ä»ç„¶æœ‰æ•ˆã€‚å³ä½¿åœ¨ Cypress å‘½ä»¤ä¸­ï¼Œauth æ˜¯ç”¨ *firebase/authã€*è€Œä¸æ˜¯ *@angular/fire/auth* è®¾ç½®çš„****

****åœ¨è¿è¡Œä¸‹é¢çš„æµ‹è¯•ä¹‹å‰ï¼Œè¯·ç¡®ä¿æˆ‘ä»¬è‡³å°‘æœ‰ä¸€ä¸ªç”¨æˆ·ã€‚**å¦‚æœæˆ‘ä»¬æ²¡æœ‰ç”¨æˆ·**ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨`localhost:4202`çš„æ¨¡æ‹Ÿå™¨ ui ä¸­åˆ›å»ºä¸€ä¸ª****

****![](img/7be9d098411016c65cfed20eb482be64.png)****

****æ˜¯çš„ï¼Œæˆ‘çš„ç”¨æˆ·åä¸ºå±±é¸¡å’Œæ°´èœœæ¡ƒ****

****[æ¥æº](https://github.com/Everduin94/poc/blob/main/apps/demo-e2e/src/integration/app.spec.ts)****

*   ****ä¸ºäº†è®¤è¯åœ°è¿è¡Œæˆ‘ä»¬çš„é¡¹ç›®ï¼Œæˆ‘ä»¬è°ƒç”¨`cy.init`åœ¨ Cypress ä¸­è®¾ç½®è®¤è¯æä¾›è€…ã€‚ç„¶åæˆ‘ä»¬ç”¨æ¨¡æ‹Ÿå™¨ç”¨æˆ·çš„ç”µå­é‚®ä»¶/å¯†ç å‘¼å«`cy.login`****
*   ****ä¸è¦å¿˜è®°è¿è¡Œ`firebase emulators:export FOLDER_NAME`æ¥ä¿å­˜æ‚¨çš„ç”¨æˆ·ã€‚****

> ****âš¡tldrâ€”â€”è¿™ä¸ªè®¾ç½®å…è®¸ä½ åœ¨**è¿è¡Œ Cypress æµ‹è¯•**æ—¶ç”¨ **firebase æ¨¡æ‹Ÿå™¨ç”¨æˆ·**ç™»å½•****

# ******ç»“è®º******

******ä»¥ä¸‹æ˜¯æˆ‘é‡åˆ°çš„é™·é˜±ã€‚ä¿ƒä½¿æˆ‘é¦–å…ˆå†™è¿™ç¯‡æ–‡ç« çš„å·¨å¤§åŠ¨åŠ›æ˜¯æ‰€æœ‰çš„é™·é˜±ã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ æ›´å¿«åœ°è§£å†³è¿™äº›é—®é¢˜ã€‚******

*******åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œe2e è¢«å¹¿æ³›ä½¿ç”¨ã€‚ç”±äºæˆ‘ä»¬æ²¡æœ‰è§¦åŠä¸€ä¸ªå®æ—¶çš„åç«¯ï¼Œæˆ‘ç§°ä¹‹ä¸ºâ€œåŠŸèƒ½æ€§â€æµ‹è¯•ã€‚******

> ******â˜ï¸[flotes](https://flotes.app)â€”â€”å°è¯•æ¼”ç¤ºï¼Œä¸éœ€è¦ç™»å½•ã€‚æˆ–è€…å…è´¹æŠ¥åã€‚Flotes æ˜¯æˆ‘è®°ç¬”è®°å’Œé«˜æ•ˆå­¦ä¹ çš„æ–¹å¼ï¼Œå³ä½¿åœ¨æˆ‘å¾ˆå¿™çš„æ—¶å€™ã€‚******

******![](img/8e468f6e74135bbbc2ecbfce7e2db2bf.png)******

******[æµ®å°¸](https://flotes.app)******

# ******é™·é˜±ğŸª¤******

## ******firebase æ¨¡æ‹Ÿå™¨:å¯åŠ¨æŒ‚èµ·******

******`firebase emulators:start`æŒ‚èµ·ä¸€åˆ†é’Ÿï¼Œç„¶åå…³æœºã€‚******

******ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å¿…é¡»ç¡®ä¿æˆ‘æœ‰ä¸€ä¸ªå…¼å®¹çš„ node.js ç‰ˆæœ¬å’Œ firebase ç‰ˆæœ¬ã€‚æˆ‘ç›®å‰æ­£åœ¨ä½¿ç”¨:******

```
******firebase:** 10.0.1
**npm:** 8.1.2
**node:** 16.13.1
**openjdk:** 11.0.15****
```

## ******firebase error:PERMISSION _ DENIED:æ²¡æœ‰åŒ¹é…çš„ allow è¯­å¥******

******è¿™æºäºä½ çš„ç«ç„°æ³•åˆ™ã€‚å½“æˆ‘åˆå§‹åŒ–æˆ‘çš„é¡¹ç›®æ—¶ï¼Œæˆ‘æ²¡æœ‰æ„è¯†åˆ°æˆ‘çš„æœåŠ¡å™¨ç«¯è§„åˆ™è¢«å¤åˆ¶åˆ°äº†æˆ‘çš„æœ¬åœ°é¡¹ç›®ä¸­ï¼Œè¿™æ˜¯æˆ‘ä¸æƒ³è¦çš„ã€‚[æ–‡ä»¶](https://firebase.google.com/docs/rules)******

## ******è§’åº¦/ç«ç„° v7******

******è§’ç«å‘å¸ƒäº†æ–°çš„æ¨¡å—åŒ– SDKã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥åƒæ™®é€šçš„ Firebase SDK ä¸€æ ·ä½¿ç”¨ Angular Fireï¼Œå¹¶åœ¨å…¶ä¸Šæ·»åŠ ä¸€äº› RxJS ä¾¿åˆ©æ“ä½œç¬¦ã€‚******

```
******NullInjectorError: No provider for InjectionToken angularfire2.app.options******
```

******AngularFire v7 æä¾›äº†æ–°çš„æ¨¡å—åŒ– SDK å’Œä¸€ä¸ªå…¼å®¹å±‚ï¼Œå¯ä»¥åƒè¿‡å»ä¸€æ ·ä½¿ç”¨ AngularFireã€‚ä¸¤è€…ä¸å…±äº«æä¾›è€…ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯èƒ½å·²ç»é€šè¿‡ç±»ä¼¼`provideFirestore`çš„ä¸œè¥¿è®¾ç½®/æä¾›äº†ä½ çš„ firebase é…ç½®ï¼Œç„¶åè¯•å›¾ä½¿ç”¨`private afs: AngularFirestore`ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦**å¯¼å…¥ *AngularFirestoreModule* æˆ–å°† *AngularFirestore* æ›¿æ¢ä¸ºå®ƒçš„** [**v7 ç­‰ä»·çš„**](https://github.com/angular/angularfire/blob/master/docs/version-7-upgrade.md#alternatives-to-v6-apis) **ã€‚********

```
****Module not found: Error: Can't resolve '@angular/core'****
```

****æ‚¨å¯èƒ½åœ¨ angular åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ä¹‹å¤–å¯¼å…¥äº† *@angular/fire/FOLDER* ã€‚**ä½ å¿…é¡»ä½¿ç”¨ *firebase/FOLDER* å¯¼å…¥ Angular** ä¹‹å¤–çš„ä¸œè¥¿(ä¾‹å¦‚ï¼Œåœ¨ Cypress)****

```
****collectionChanges Doesn't Emit when Empty****
```

****åƒ`collectionChanges`è¿™æ ·çš„æ–¹æ³•å¯èƒ½æ˜¯éå¸¸æœ‰ç›Šçš„ï¼Œå¹¶åœ¨ä¸‹æ¸¸é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œä½†(åœ¨å›½é™…æµ·äº‹ç»„ç»‡çœ‹æ¥)åŸºæœ¬ä¸Šæ˜¯ä¸å¯ç”¨çš„ï¼Œå› ä¸ºå­˜åœ¨åƒ[è¿™ä¸ª](https://github.com/FirebaseExtended/rxfire/issues/55)å’Œ[è¿™ä¸ª(ä¸‹æ¸¸)](https://github.com/dappsnation/akita-ng-fire/issues/238)è¿™æ ·çš„é—®é¢˜****

****æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨`[collectionData](https://github.com/angular/angularfire/blob/7d471662a10c92c4c340f70540c8a57c2bf71f01/README.md#example-use)`æ¥è·å–æ‰€æœ‰æ’æ”¾ã€‚****

```
****When using collection(): Expected 0 type arguments but got 1****
```

****ä½œä¸ºæ›¿ä»£ï¼Œä½ å¯ä»¥ä½¿ç”¨`collection(firestore, â€˜ticketsâ€™) as CollectionReference<Tickets>;`ã€‚â€” [å‚è§é—®é¢˜](https://github.com/angular/angularfire/issues/3081)****

```
****Cypress won't load firestore data****
```

****æ‚¨éœ€è¦å¯ç”¨*experimentalforcelonpollingã€‚*****

```
**provideFirestore(() => {
  const firestore = initializeFirestore(getApp(), **{
    experimentalForceLongPolling: environment.production ? false : true,
  }**);
  return firestore;
}),**
```