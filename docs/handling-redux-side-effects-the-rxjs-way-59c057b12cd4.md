# å¤„ç† Redux å‰¯ä½œç”¨ RxJS æ–¹æ³•

> åŸæ–‡ï¼š<https://itnext.io/handling-redux-side-effects-the-rxjs-way-59c057b12cd4?source=collection_archive---------2----------------------->

![](img/db85de0b30f8de6d82798ef230144af9.png)

ä½ å¥½é™Œç”Ÿäººï¼å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Reduxï¼Œä½ å¯èƒ½ä¼šé‡åˆ°æˆ‘ä»¬åœ¨ Orfium å‰ç«¯å›¢é˜Ÿé‡åˆ°çš„åŒæ ·çš„é—®é¢˜â€”â€”Redux å‰¯ä½œç”¨(ä¹Ÿè®¸è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ ä¹Ÿåœ¨è¯»è¿™ç¯‡æ–‡ç« ğŸ˜).å¦‚æœæ²¡æœ‰ï¼Œé‚£å°±ç­‰ç€å§ï¼Œå¾ˆå¿«å°±ä¼šå‘ç”Ÿçš„ã€‚è®©æˆ‘å¼•å¯¼ä½ é€šè¿‡æˆ‘ä»¬çš„æ•…äº‹å’Œå‘ç°ã€‚

## å‰¯ä½œç”¨ä»¥åŠæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦å®ƒä»¬

å¸¸è§„æ“ä½œæ­£åœ¨è¢«è°ƒåº¦ï¼Œå› æ­¤æŸäº›çŠ¶æ€æ­£åœ¨è¢«æ”¹å˜ã€‚

å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªåˆ—è¡¨ï¼Œéœ€è¦ä»æœåŠ¡å™¨è·å–ä¿¡æ¯æ¥å¡«å……å®ƒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦è°ƒåº¦ä¸€ä¸ªæ“ä½œâ€”æ¥è‡ªæœåŠ¡å™¨çš„è¯·æ±‚â€”å“åº”(æˆåŠŸ/é”™è¯¯)æ—¶ï¼Œè°ƒåº¦å¦ä¸€ä¸ªæ“ä½œæ¥æ›´æ–°çŠ¶æ€(åŠ è½½ã€ç»“æœç­‰)ã€‚è¿™æ˜¯ä¸€ä¸ªå‰¯ä½œç”¨ã€‚

> è¿™æ˜¯å¦‚æ­¤æ™®éå’Œ 2017 å¹´çš„æƒåˆ©ï¼Ÿ

è™½ç„¶ç°åœ¨ä½ æœ‰ä¸€ä¸ªä½ å®é™…ä¸Šä¸èƒ½å¤„ç†çš„è¡ŒåŠ¨ã€‚å¦‚æœç”¨æˆ·ç‚¹å‡»é‚£ä¸ªæŒ‰é’®ï¼Œå¹¶ä¸”æœ‰å¤šä¸ªè¯·æ±‚ï¼Œæœ€é‡è¦çš„æ˜¯å¤šä¸ªçŠ¶æ€æ›´æ–°ï¼Œè¿™ä¼šç ´åæ‚¨å®Œç¾çš„åº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥è§¦å‘ç›¸åŒçš„æ“ä½œã€‚å¦‚æœä½ å¯ä»¥å–æ¶ˆï¼Œç­‰å¾…ï¼Œå»æŠ–å’Œä¸€èˆ¬å¤„ç†è¿™äº›è¡ŒåŠ¨ã€‚å‰§é€é¢„è­¦ï¼Œå¯ä»¥ï¼

æœ‰ä¸¤ä¸ªä¸»è¦é€‰é¡¹å¯ä»¥å¤„ç†å…·æœ‰ä¸Šè¿°ä¼˜ç‚¹çš„å‰¯ä½œç”¨æ“ä½œ(ä¸åŒ…æ‹¬ thunks)

*   redux observable â€”åŸºäº RxJSï¼Œä½¿ç”¨ observable ç›‘å¬åŠ¨ä½œ
*   redux sagaâ€”â€”å®ƒä½¿ç”¨æ–°æ·»åŠ çš„ javascript ç”Ÿæˆå™¨æ¥å¤„ç†å‰¯ä½œç”¨

# RX å‰¯ä½œç”¨

ä½¿ç”¨ redux observable ä½ å¯ä»¥æ”¹å˜ä½ çš„æ“ä½œæ–¹å¼ã€‚æˆ‘ä¸ä¼šè¯¦ç»†è¯´æ˜ä½ å¦‚ä½•å®‰è£…å®ƒï¼Œå› ä¸ºä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°é˜…è¯»è¿™ä¸ª[è¿™é‡Œ](https://redux-observable.js.org/docs/basics/Epics.html)ã€‚æˆ‘ä¼šæ›´æ·±å…¥åœ°ç ”ç©¶å®ƒçš„å¤æ‚éƒ¨åˆ†ï¼Œæ¯”å¦‚

*   å¦‚ä½•å½¢æˆä¸€éƒ¨å²è¯—
*   å†—ä½™è¡¨å•(å¦‚ä½•å¤„ç†å®ƒä»¬)
*   ç”¨çŠ¶æ€æµ‹è¯•
*   è½»æ¾æµ‹è¯•æ“ä½œ

è®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸ªç®€å•çš„åœºæ™¯ã€‚å¯¹æœåŠ¡å™¨çš„ä¸€ä¸ªè¯·æ±‚ï¼Œå¦‚æœæˆåŠŸæˆ–å¤±è´¥ï¼Œæˆ‘ä»¬å°†å‘é€ä¸€äº›åŠ¨ä½œæ¥æ›´æ–°æˆ‘ä»¬çš„ reducerã€‚

è®©æˆ‘ä»¬çœ‹çœ‹è¿™ç§æƒ…å†µåœ¨ä»£ç ä¸­æ˜¯æ€æ ·çš„ã€‚

è®©æˆ‘æŠŠå®ƒåˆ†è§£ä¸€ä¸‹ã€‚

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæ–°çš„å²è¯—ã€‚ç„¶åä½¿ç”¨ç±»å‹çš„**ï¼Œæˆ‘ä»¬ç­‰å¾…**ç±»å‹çš„åŠ¨ä½œ _ è¯·æ±‚**è¢«è§¦å‘ã€‚å½“å®ƒè¢«è§¦å‘æ—¶ï¼Œæˆ‘ä»¬è½¬åˆ° **switchMap** ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬é™åˆ¶æˆ‘ä»¬å¾—åˆ°çš„è¯·æ±‚ã€‚åˆ‡æ¢æ˜ å°„ä¸€æ¬¡è¿è¡Œä¸€ä¸ªè¯·æ±‚ï¼Œå› æ­¤å…¶ä»–ä»»ä½•è¯·æ±‚éƒ½å°†è¢«å¿½ç•¥ï¼Œè¿™æ ·å¯ä»¥é¿å…å¤šä¸ªè¯·æ±‚ã€‚ç„¶åé€šè¿‡**ä¸­çš„**ï¼Œæˆ‘ä»¬å°†æ‰¿è¯ºè¯·æ±‚è½¬æ¢ä¸ºå¯è§‚å¯Ÿçš„è¯·æ±‚ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ **mergeMap** æ¥è·å–å“åº”(æƒ³è±¡ a .then on a promise ),ç„¶åæˆ‘ä»¬è¿”å›ä¸€ç»„åŠ¨ä½œï¼Œå¹¶å¯¹é”™è¯¯è¿›è¡ŒåŒæ ·çš„å¤„ç†ã€‚**

å¦‚æœæ‚¨æƒ³é¦–å…ˆæ˜¾ç¤ºä¸€ä¸ªåŠ è½½æ¥æŒ‡ç¤ºæ•°æ®çš„åŠ è½½/è·å–ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ

ç°åœ¨ï¼Œæ‚¨å¯ä»¥åœ¨è¯·æ±‚æ•°æ®ä¹‹å‰è½»æ¾æ·»åŠ ä¸€ä¸ªæ“ä½œã€‚

æˆ‘ä»¬ä½¿ç”¨ **concat** æ¥æŒ‰ç…§å®šä¹‰çš„é¡ºåºè¿è¡Œå…¶ä¸­çš„ä¸¤ä¸ªåŠ¨ä½œ(loadingList å’Œ request)ã€‚å˜å¾—å®¹æ˜“äº†ï¼Ÿ

ç°åœ¨æ‚¨å·²ç»åšå¥½äº†æ‰€æœ‰å‡†å¤‡ï¼Œå¹¶ä¸”æ­£åœ¨ä½¿ç”¨ redux è¡¨å•æ¥å¤„ç†æ‚¨çš„æ•°æ®ã€‚ä½ æ€ä¹ˆçŸ¥é“å½“ä½ åœ¨é‚£ä¸ªæ¼‚äº®çš„è¡¨æ ¼ä¸­æŒ‰ä¸‹æäº¤é”®æ—¶ï¼Œå®ƒä¼šå¾—åˆ°æäº¤çŠ¶æ€æ¥æ˜¾ç¤ºæ­£åœ¨åŠ è½½çš„åŠ¨ç”»å‘¢ï¼Ÿè¿™ä¸ªæƒ³æ³•æ˜¯ä¸€æ ·çš„ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿™æ ·çš„äº‹æƒ…æ˜¯å¦‚ä½•å®Œæˆçš„ã€‚

è¿™é‡Œæˆ‘ä»¬ç¨å¾®æ”¹å˜ä¸€ä¸‹é€»è¾‘ã€‚åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿåœ¨ç­‰å¾…ç±»å‹ä¸ºçš„**éƒ¨åˆ†çš„ç›¸åŒæ“ä½œã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›å°† formName ä¼ é€’ç»™ Epicï¼Œä»¥ä¾¿æ‰§è¡Œä¸Šé¢æ˜¾ç¤ºçš„æ“ä½œã€‚åœ¨ **switchMap** ä¸­ï¼Œæˆ‘ä»¬æœŸå¾…ä¸¤ä»¶äº‹ï¼Œä¸€ä¸ªæœ‰æ•ˆè½½è·å’Œä¸€ä¸ªå…ƒï¼æ˜¯çš„ä¸€ä¸ª metaã€‚å…ƒæŒæœ‰æœ‰æ•ˆè´Ÿè½½ä¸å¿…çŸ¥é“çš„é€»è¾‘ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°[æ›´å¤šå…³äºä¸ºä»€ä¹ˆä»¥åŠä½•æ—¶ä½¿ç”¨å®ƒçš„ç»†èŠ‚ã€‚å†æ¬¡ä½¿ç”¨ concat å’Œ redux è¡¨å•åŠ¨ä½œ startSubmitï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰è¡¨å•å¼€å§‹æäº¤å†…å®¹ã€‚ä¸è¦å¿˜è®°åœ¨æˆåŠŸå’Œé”™è¯¯æ—¶éƒ½**åœæ­¢æäº¤**ã€‚å°±æ˜¯è¿™æ ·ï¼](https://medium.com/@jtbennett/standard-actions-in-redux-c6a415c8aea4)**

æˆ‘å»ºè®®ä½ æ€»æ˜¯ç”¨é‚£ä¸ªåå­—è°ƒåº¦ä¸€ä¸ªè¯·æ±‚åŠ¨ä½œï¼Œæ¯”å¦‚ **ACTION_REQUEST** æˆ–è€…**FETCH _ BLAH _ LIST _ REQUEST**ã€‚è¿™æ ·ä½ å°±ä¼šçŸ¥é“è¿™æ˜¯ä¸€ä¸ªå²è¯—èˆ¬çš„å‰¯ä½œç”¨ã€‚

æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨ **takeUntil** å¹¶åœ¨äº‹ä»¶å‘ç”Ÿååœæ­¢ç›‘å¬ä»»ä½•æˆåŠŸäº‹ä»¶ã€‚è¿™æœ‰åŠ©äºè§£å†³ç»å…¸çš„ç½‘é£é—®é¢˜ã€‚å½“ä½ å¯¼èˆªåˆ°ä¸€ä¸ªè¯¦ç»†ä¿¡æ¯é¡µé¢å¼€å§‹æŠ“å–æ—¶ï¼Œä½ ä¼šè¿”å›åˆ°å¦ä¸€ä¸ªè¯¦ç»†ä¿¡æ¯é¡µé¢ï¼Œè€Œç¬¬ä¸€é¡µå¼€å§‹è§£æå¹¶å¼„ä¹±ä½ å½“å‰çš„é¡µé¢ã€‚

è¿™ä¸ªé—®é¢˜åœ¨è¿™é‡Œ[å¾—åˆ°äº†å¾ˆå¥½çš„è§£é‡Š](https://www.youtube.com/watch?v=AslncyG8whg)æ¥è‡ª[æ°ä¼Šè²å°”æ™®æ–¯](https://medium.com/u/5b0111cff646?source=post_page-----59c057b12cd4--------------------------------)æˆ‘æ¨èä½ å»çœ‹ä¸€çœ‹ã€‚

ç°åœ¨æˆ‘ä»¬æœ‰å’Œä»¥å‰ä¸€æ ·çš„ä¾‹å­ï¼Œä½†æ˜¯æˆ‘ä»¬åªæ”¾äº† **takeUntil** æ“ä½œç¬¦ã€‚ç°åœ¨ï¼Œå¦‚æœå®ƒç›‘å¬ **PAGE_CHANGED** åŠ¨ä½œï¼Œå®ƒä¸ä¼šå–æ¶ˆè¯·æ±‚ï¼Œä½†ä¼šå¿½ç•¥å½“å‰è¯·æ±‚çš„ä»»ä½•è§£æã€‚è€¶ï¼ï¼ç°åœ¨ï¼Œå¦‚æœä½ æ„¿æ„ï¼Œä½ å¯ä»¥ç”¨ axios å®ç°ä¸€ä¸ªå¯å–æ¶ˆçš„è¯·æ±‚ã€‚

# **è½»æ¾æµ‹è¯• RxJS**

æˆ‘å‘ç° redux-observable æ•™ç¨‹åœ¨æµ‹è¯•æ–¹é¢æœ‰ç‚¹é«˜çº§å’Œæ··ä¹±ã€‚æˆ‘çŸ¥é“ä¸ºä»€ä¹ˆï¼Œä½†åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ ä¸éœ€è¦è¿™æ ·çš„ä¸œè¥¿ï¼Œæ‰€ä»¥æˆ‘ä¼šæå‡ºä¸€ä¸ªç®€å•çš„æµ‹è¯•è§£å†³æ–¹æ¡ˆã€‚

Redux observable ä»æ¨¡å—ä¸­ç»™äº†æˆ‘ä»¬ä¸¤ä¸ªä¸œè¥¿ ActionsObservable å’Œ StateObservableã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥åˆ›å»ºç”¨äºæµ‹è¯•çš„å¯è§‚æµ‹é‡ã€‚æˆ‘ä»¬ä¹‹æ‰€ä»¥ä½¿ç”¨å®ƒä»¬ï¼Œæ˜¯å› ä¸ºåœ¨åº“ä¸Šï¼Œé€šè¿‡å²è¯—çš„åŠ¨ä½œæ˜¯ç”¨è¿™äº›åŠ¨ä½œåˆ›å»ºçš„ï¼Œæ‰€ä»¥å› ä¸ºæˆ‘ä»¬å°†å°è¯•æ¯”è¾ƒè¿™ä¸¤ä¸ªåŠ¨ä½œï¼Œæ‰€ä»¥å®ƒä»¬éœ€è¦å®Œå…¨ç›¸åŒã€‚

è®©æˆ‘ä»¬è¯•ç€æµ‹è¯•æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªä¾‹å­ã€‚

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä»¶äº‹:ä¸€ä¸ªæ˜¯è§¦å‘å²è¯—çš„å¯è§‚å¯ŸåŠ¨ä½œçš„**åŠ¨ä½œ$** ï¼Œå¦ä¸€ä¸ªæ˜¯æˆ‘ä»¬é¢„æœŸå²è¯—å°†è¿”å›çš„åŠ¨ä½œæ•°ç»„çš„**é¢„æœŸå˜é‡**ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ç”¨æ¨¡æ‹Ÿå“åº”æ¨¡æ‹Ÿ axios (fetchï¼Œaxiosï¼Œæ— è®ºæ‚¨å¯¹ http è¯·æ±‚æœ‰ä»€ä¹ˆ)è§£æã€‚æœ€åï¼Œæœ‰è¶£çš„æ˜¯ï¼Œæˆ‘ä»¬å°† action$ä¼ é€’ç»™æˆ‘ä»¬æƒ³è¦æµ‹è¯•çš„ epicï¼Œæˆ‘ä»¬å°† epic çš„ç»“æœè½¬æ¢æˆä¸€ä¸ªå¸¦æœ‰**çš„æ•°ç»„ã€‚pipe(toArray())** ç„¶åæˆ‘ä»¬ç”¨**åšä¸€ä¸ªæ‰¿è¯ºã€‚top promise()**æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ async await ç­‰å¾…å®ƒç»“æŸã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°æ¯”è¾ƒä»€ä¹ˆå²è¯—è¿”å›åˆ°æˆ‘ä»¬æ‰€æœŸå¾…çš„ï¼

ä¸‹é¢æ˜¯å¯¹è¯·æ±‚é”™è¯¯çš„æµ‹è¯•

ä½¿ç”¨è¿™ç§æŠ€æœ¯ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°æµ‹è¯•ä»»ä½• epicï¼Œå¹¶ç¡®å®šæ¯ä¸ª epic çš„é¢„æœŸã€‚

å¸Œæœ›ä½ å–œæ¬¢æˆ‘çš„ä¾‹å­ï¼Œredux observables å¯¹äºæ—¥å¸¸ä½¿ç”¨è¿™äº›ä¾‹å­æ›´æœ‰æ„ä¹‰ã€‚

> å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œå¯ä»¥è€ƒè™‘ç‚¹å‡» clapğŸ‘å¹¶ä¸”ä½ å¯ä»¥éšæ—¶è®¿é—®[æˆ‘çš„å…¶ä»–æ–‡ç« ](https://medium.com/@panagiotisvrs)ğŸ”¥

å¦‚æœä½ æœ‰æ›´å¤šå…³äºå¦‚ä½•ä½¿ç”¨å®ƒçš„ä¾‹å­ï¼Œè¯·åœ¨ä¸‹é¢çš„è¯„è®ºä¸­åˆ†äº«ã€‚

 [## å†—ä½™å½¢å¼

### åœ¨ Redux ä¸­ç®¡ç†è¡¨å•çŠ¶æ€çš„æœ€ä½³æ–¹å¼ã€‚

redux-form.com](https://redux-form.com/6.0.0-rc.4/docs/api/actioncreators.md/) [](https://redux-observable.js.org/) [## ä»‹ç»å†—ä½™-å¯è§‚å¯Ÿ

### ç¼–è¾‘æè¿°

redux-observable.js.org](https://redux-observable.js.org/)