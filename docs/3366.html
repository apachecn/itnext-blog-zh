<html>
<head>
<title>How to deal with 4xx responses in MicroProfile Rest-Client</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•åœ¨MicroProfile Rest-Clientä¸­å¤„ç†4xxå“åº”</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/how-to-deal-with-4xx-5xx-responses-in-microprofile-rest-client-2e16559f542?source=collection_archive---------1-----------------------#2019-11-29">https://itnext.io/how-to-deal-with-4xx-5xx-responses-in-microprofile-rest-client-2e16559f542?source=collection_archive---------1-----------------------#2019-11-29</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><p id="aeb7" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">Eclipseå¾®æ–‡ä»¶ <a class="ae km" href="https://github.com/eclipse/microprofile-rest-client" rel="noopener ugc nofollow" target="_blank"> Restå®¢æˆ·ç«¯</a>æ˜¯ä¸€æ¬¾éå¸¸é…·çš„è½¯ä»¶ã€‚<a class="ae km" rel="noopener ugc nofollow" target="_blank" href="/authentication-with-microprofile-rest-client-d1e9da774f70">æˆ‘æƒ³æˆ‘ç”šè‡³åœ¨</a>ä¹‹å‰æåˆ°è¿‡ğŸ˜€ã€‚å…¶ä¸­ä¸€ä¸ªå¾ˆé…·çš„ç‰¹æ€§æ˜¯ä½ ä¸å¿…å¤„ç†åº•å±‚çš„httpå¤„ç†ã€‚</p><figure class="ko kp kq kr gu ks gi gj paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gi gj kn"><img src="../Images/ea16b72ba9f1475963f4e58645d4ac09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gVPygEdI_4W3Ynoq3maU-A.png"/></div></div></figure><p id="5348" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">ä½†æ˜¯æœ‰æ—¶ä½ æƒ³å®é™…å¤„ç†httpçš„æœ¬è´¨â€”â€”ç‰¹åˆ«æ˜¯å¤„ç†ä¼ è¾¾è¯­ä¹‰çš„ä¸åŒçŠ¶æ€ä»£ç ã€‚é»˜è®¤çš„å¤„ç†æ˜¯ï¼Œå¯¹äºæ¯ä¸€ä¸ªä»£ç â‰¥ 400ï¼ŒæŠ›å‡ºä¸€ä¸ª<em class="kz"> WebApplicationException </em>ï¼Œåªæ˜¯å‘Šè¯‰ä½ è°ƒç”¨æ²¡æœ‰æˆåŠŸï¼Œå¹¶æ²¡æœ‰è¿›ä¸€æ­¥åŒºåˆ†ã€‚</p><h2 id="a4f4" class="la lb ir bd lc ld le dn lf lg lh dp li jz lj lk ll kd lm ln lo kh lp lq lr ls bi translated">è‡ªå®šä¹‰å¼‚å¸¸æ˜ å°„å™¨çš„å¸®åŠ©</h2><p id="faf1" class="pw-post-body-paragraph jo jp ir jq b jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh lx kj kk kl ik bi translated">å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ±‚åŠ©äºåŸºæœ¬çš„HttpClientæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè€Œæ˜¯å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¼ºå¤§çš„ç‰¹æ€§ï¼Œå³è‡ªå®šä¹‰ResponseExceptionMappersã€‚è®©æˆ‘ä»¬å…ˆçœ‹çœ‹ä¸€ä¸ªç¤ºä¾‹å®ç°ï¼Œç„¶åçœ‹çœ‹å¦‚ä½•å°†å®ƒåº”ç”¨åˆ°æ‚¨çš„ä»£ç ä¸­ã€‚è¿™å»ºç«‹åœ¨æˆ‘ä¸Šä¸€ç¯‡æ–‡ç« çš„<a class="ae km" rel="noopener ugc nofollow" target="_blank" href="/authentication-with-microprofile-rest-client-d1e9da774f70">ä»£ç ä¹‹ä¸Šã€‚</a></p><pre class="ko kp kq kr gu ly lz ma mb aw mc bi"><span id="6bea" class="la lb ir lz b gz md me l mf mg"><strong class="lz is">@Priority</strong>(4000)                                            // <strong class="lz is"><em class="kz">(1)</em></strong><br/>public class <strong class="lz is">MyMapper</strong> implements <br/>             ResponseExceptionMapper&lt;RuntimeException&gt; {   // <strong class="lz is"><em class="kz">(2)</em></strong></span><span id="72b5" class="la lb ir lz b gz mh me l mf mg">  @Override<br/>  public RuntimeException toThrowable(Response response) {<br/>    int status = response.getStatus();                     // <strong class="lz is"><em class="kz">(3)</em></strong><br/><br/>    String msg = getBody(response); // see below<br/><br/>    RuntimeException re ;<br/>    switch (status) {<br/>      case <strong class="lz is">412</strong>: re = new ValidationException(msg);         // <strong class="lz is"><em class="kz">(4)</em></strong><br/>      break;<br/>      default:<br/>        re = new WebApplicationException(status);          // <strong class="lz is"><em class="kz">(5)</em></strong><br/>    }<br/>    return re;<br/>  }</span></pre><ol class=""><li id="2bd5" class="mi mj ir jq b jr js jv jw jz mk kd ml kh mm kl mn mo mp mq bi translated">å‘Šè¯‰å…¶ä»–å®¢æˆ·ä¼˜å…ˆçº§ã€‚å¦‚æœå¤šä¸ªæ˜ å°„å™¨åŒ¹é…ï¼Œåˆ™é‡‡ç”¨ä¼˜å…ˆçº§æœ€ä½çš„æ˜ å°„å™¨</li><li id="af8d" class="mi mj ir jq b jr mr jv ms jz mt kd mu kh mv kl mn mo mp mq bi translated">æˆ‘ä»¬çš„ç±»éœ€è¦å®ç°ResponseExceptionMapperæ¥å£</li><li id="df70" class="mi mj ir jq b jr mr jv ms jz mt kd mu kh mv kl mn mo mp mq bi translated">æˆ‘ä»¬å¯ä»¥ä»å“åº”ä¸­æ£€ç´¢çŠ¶æ€ä»£ç </li><li id="ec6c" class="mi mj ir jq b jr mr jv ms jz mt kd mu kh mv kl mn mo mp mq bi translated">å¹¶ä½¿ç”¨å®ƒæ¥åˆ†æ´¾ä¸åŒç±»å‹çš„å¼‚å¸¸</li><li id="05d6" class="mi mj ir jq b jr mr jv ms jz mt kd mu kh mv kl mn mo mp mq bi translated">å¯¹äºæ‰€æœ‰å…¶ä»–ä»£ç ï¼Œæˆ‘ä»¬ä½¿ç”¨é»˜è®¤å€¼</li></ol><p id="72c2" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">å¦‚æœæˆ‘ä»¬è°ƒç”¨çš„æœåŠ¡å™¨åœ¨ä¸»ä½“ä¸­è¿”å›ä¸€ä¸ªå“åº”ï¼Œæˆ‘ä»¬å¸Œæœ›çŸ¥é“å®ƒå¹¶åœ¨å¼‚å¸¸ä¸­æä¾›å®ƒã€‚è¿™å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°:</p><pre class="ko kp kq kr gu ly lz ma mb aw mc bi"><span id="b4dc" class="la lb ir lz b gz md me l mf mg">private String getBody(Response response) {<br/>  ByteArrayInputStream is = (ByteArrayInputStream) response.getEntity();<br/>  byte[] bytes = new byte[is.available()];<br/>  is.read(bytes,0,is.available());<br/>  String body = new String(bytes);<br/>  return body;<br/>}</span></pre><p id="5db8" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">ç°åœ¨æˆ‘ä»¬æœ‰äº†æ˜ å°„å™¨åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰restå®¢æˆ·æœºä½•æ—¶åº”è¯¥åº”ç”¨å®ƒã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†æ˜ å°„å™¨æ³¨å†Œåˆ°æˆ‘ä»¬å¸Œæœ›ä½¿ç”¨å®ƒçš„æ¥å£:</p><pre class="ko kp kq kr gu ly lz ma mb aw mc bi"><span id="1e11" class="la lb ir lz b gz md me l mf mg">@RegisterRestClient<br/><strong class="lz is">@RegisterProvider</strong>(value = <strong class="lz is">MyMapper.class</strong>,<br/>                  priority = 50)<br/>public interface <strong class="lz is">VerifyEngine</strong> {</span></pre><p id="b7e7" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">åªéœ€åœ¨æ¥å£ä¸Šæ·»åŠ ä¸€ä¸ª<em class="kz"> @RegisterProvider </em>æ³¨é‡Šå°±å¤§åŠŸå‘Šæˆäº†ã€‚å¦‚æœè¿œç¨‹æœåŠ¡å™¨ç°åœ¨å“åº”ä»£ç 412ï¼Œæ‚¨å°†å¾—åˆ°ä¸€ä¸ªValidationExceptionï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒ:</p><pre class="ko kp kq kr gu ly lz ma mb aw mc bi"><span id="8fb5" class="la lb ir lz b gz md me l mf mg">@Inject<br/>@RestClient<br/>VerifyEngine engine;</span><span id="15cd" class="la lb ir lz b gz mh me l mf mg">[...]</span><span id="da63" class="la lb ir lz b gz mh me l mf mg">try {<br/>  <strong class="lz is">engine.verify</strong>(policy);<br/>}<br/>catch (ValidationException ve) {<br/>  // Deal with a 412 response<br/>}<br/>catch (Exception e) {<br/>  // Deal with other cases<br/>}</span></pre><h1 id="2928" class="mw lb ir bd lc mx my mz lf na nb nc li nd ne nf ll ng nh ni lo nj nk nl lr nm bi translated">æ›´å¤šï¼Ÿ</h1><p id="0eef" class="pw-post-body-paragraph jo jp ir jq b jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh lx kj kk kl ik bi translated">å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºEclipse MicroProfileçš„çŸ¥è¯†ï¼Œå¯ä»¥çœ‹çœ‹æˆ‘ä¹Ÿæ˜¯åˆè‘—è€…çš„ä¹¦â€œ<a class="ae km" href="https://www.packtpub.com/web-development/hands-on-enterprise-java-microservices-with-eclipse-microprofile" rel="noopener ugc nofollow" target="_blank"> <strong class="jq is">ç”¨Eclipse MicroProfile </strong> </a>åŠ¨æ‰‹æ“ä½œä¼ä¸šJavaå¾®æœåŠ¡â€ã€‚</p><figure class="ko kp kq kr gu ks gi gj paragraph-image"><div class="gi gj nn"><img src="../Images/b98916f13a93c476031ffe4fc6841dfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/1*2TpxgNcoNpjDKmJeiwWY5g.jpeg"/></div></figure></div></div>    
</body>
</html>