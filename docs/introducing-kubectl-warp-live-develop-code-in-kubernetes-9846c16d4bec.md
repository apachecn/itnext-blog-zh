# kubectl warp ç®€ä»‹ Kubernetes ä¸­çš„å®æ—¶å¼€å‘ä»£ç ï¼

> åŸæ–‡ï¼š<https://itnext.io/introducing-kubectl-warp-live-develop-code-in-kubernetes-9846c16d4bec?source=collection_archive---------5----------------------->

![](img/a8f75b9102b3ea562bfd6dbf0718dd9c.png)

kubectl åœ¨ Kubernetes ä¸­è¿è¡Œä»£ç çš„æ’ä»¶

Warp æ˜¯ä¸€ä¸ª kubectl æ’ä»¶ï¼Œå®ƒå…è®¸ä½ åœ¨ Kubernetes ä¸­ç›´æ¥æ‰§è¡Œä½ çš„æœ¬åœ°ä»£ç ï¼Œè€Œä¸éœ€è¦ç¼“æ…¢çš„æ˜ åƒæ„å»ºè¿‡ç¨‹ã€‚è¿™æ˜¯ MIT æˆæƒçš„ï¼Œå¯ä»¥åœ¨ [*GitHub*](https://github.com/ernoaapa/kubectl-warp) *ä¹°åˆ°ã€‚*

æœ‰æ—¶ï¼Œæˆ‘ä¼šé¢ä¸´ä¸€äº›æˆ‘éå¸¸æƒ³è§£å†³çš„é—®é¢˜ã€‚è¿™ä¸€æ¬¡ï¼Œæˆ‘åœ¨ç”¨ Kubernetes å¸®åŠ©æˆ‘ä»¬åœ¨[æåœ°å°ç»„](https://polarsquad.com)çš„å®¢æˆ·æ—¶é‡åˆ°äº†é—®é¢˜

> å¦‚ä½•åœ¨ Kubernetes ä¸Šç›´æ¥æ‰§è¡Œæˆ‘çš„æœ¬åœ°ä»£ç ï¼Ÿ
> -éšæœºå¼€å‘è€…

è¿™å¯èƒ½æ˜¯å¼€å‘äººå‘˜åœ¨æœ¬åœ°ä½¿ç”¨ Docker æ—¶å·²ç»ä¹ æƒ¯çš„äº‹æƒ…ï¼Œä½†æ˜¯ä½¿ç”¨ Kubernetesï¼Œæ‰€æœ‰å®¹å™¨éƒ½è¿è¡Œåœ¨é›†ç¾¤ä¸­çš„æŸä¸ªæœåŠ¡å™¨ä¸Šã€‚

æˆ‘å·²ç»è§£å†³è¿‡ä¸€æ¬¡äº†ï¼Œå½“æˆ‘åœ¨å’Œè‰¾ç•¥ç‰¹é¡¹ç›®ä¸€èµ·å·¥ä½œçš„æ—¶å€™ã€‚å› æ­¤ï¼Œæˆ‘æ‰€éœ€è¦åšçš„å°±æ˜¯åœ¨ Kubernetes ä¸Šé‡æ–°å®ç°å®ƒï¼Œè¿™å°±æ˜¯æˆ‘å¦‚ä½•åˆ›å»ºäº†`[kubectl warp](https://github.com/ernoaapa/kubectl-warp)`æ’ä»¶ã€‚

## â€¦å¬èµ·æ¥å¾ˆå®¹æ˜“

å‡è®¾ä½ æƒ³ç”¨ Kubernetes ä¸­çš„**æ¥å¼€å‘è½¯ä»¶**

*   æˆ‘åœ¨æœ¬åœ°æœ‰æºä»£ç (å¯èƒ½æ˜¯ä» GitHub å…‹éš†çš„)â€¦
*   â€¦æˆ‘æƒ³å°†ä»£ç è½¬ç§»åˆ° Kubernetes çš„ä¸€ä¸ªå®¹å™¨ä¸­â€¦
*   â€¦ **æ„å»º**å¹¶å¼€å§‹é¡¹ç›®å’Œâ€¦
*   â€¦å¯¹æºæ–‡ä»¶è¿›è¡Œ**æ›´æ”¹**,ç„¶åâ€¦
*   â€¦å®æ—¶é‡æ–°åŠ è½½ä»£ç ï¼Œç„¶å**çœ‹åˆ°**ç»“æœï¼

## æ²¡é‚£ä¹ˆå®¹æ˜“â€¦

è¦å®ç°ä¸Šè¿°åŠŸèƒ½ï¼Œæ‚¨éœ€è¦

![](img/d17b9cfda2830fb5222aeb684288d8f5.png)

æ­£å¸¸æ›´æ–°æµç¨‹

*   æ„å»ºæºä»£ç 
*   åˆ›å»º Docker å›¾åƒ
*   å°†å›¾åƒæ¨é€åˆ° Docker å­˜å‚¨åº“
*   å°†æ–°ç‰ˆæœ¬éƒ¨ç½²åˆ° Kubernetes
*   ç­‰å¾…æ»šåŠ¨æ›´æ–°
*   çœ‹ç»“æœ

å¦‚æœä½ éœ€è¦åœ¨ä¸€åˆ†é’Ÿå†…å¤šæ¬¡è¿™æ ·åšï¼Œä½ çš„å¼€å‘å‘¨æœŸå°±å¤ªæ…¢äº†ï¼Œè€Œä¸”ä½ ä¼šå¼€å§‹æ€€å¿µåªæœ‰ä¸€ä¸ªå¤§å‹ monolith åº”ç”¨ç¨‹åºçš„æ—¥å­ï¼Œé‚£äº›ä½ å¯ä»¥åœ¨æœ¬åœ°è½»æ¾è¿è¡Œçš„ç¨‹åºã€‚ä½†æ˜¯è¦åœ¨æœ¬åœ°è¿è¡Œç°åœ¨çš„â€œå¾®æœåŠ¡â€ï¼Œä½ éœ€è¦å¤åˆ¶æ‰€æœ‰çš„ä¾èµ–é¡¹(å…¶ä»–æœåŠ¡ã€æ•°æ®åº“ã€å­˜å‚¨ç­‰ç­‰ã€‚)æ¥è·å¾—ä¸€ä¸ªçœŸæ­£çš„â€œç±»ç”Ÿäº§â€ç¯å¢ƒã€‚

# æˆ‘ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªï¼Ÿ

[ç½‘çœŸ](https://telepresence.io)å¾ˆå¥½åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜**ï¼Œå®ƒåœ¨æœ¬åœ°è¿è¡Œä½ çš„é¡¹ç›®**å¹¶å°†æ‰€æœ‰æ¥è‡ª/å»å¾€ Kubernetes çš„æµé‡éš§é“ä¼ è¾“åˆ°ä½ çš„æœ¬åœ°è¿›ç¨‹ã€‚

è¿™åœ¨å¾ˆå¤šæƒ…å†µä¸‹éƒ½å¾ˆå¥½ï¼Œä½†æ˜¯å¦‚æœæ‚¨æƒ³è¦çœŸæ­£çš„â€œäº§å“åŒ–â€å‘¢ï¼Ÿå¦‚æœè¦åŒ¹é…å†…å­˜/CPU é™åˆ¶æ€ä¹ˆåŠï¼ŸCPU æ¶æ„ï¼Ÿé™„åŠ ç£ç›˜ï¼Ÿä¼ æ„Ÿå™¨ï¼Ÿçªç„¶é—´**æœ‰èƒ½åŠ›åœ¨ Kubernetes** ä¸­è¿è¡Œé¡¹ç›®å¬èµ·æ¥ä¸é”™ã€‚

å½“æ‚¨æ­£åœ¨æ„å»ºæ¯”ç®€å•çš„ web åº”ç”¨ç¨‹åºç¨å¾®å¤æ‚ä¸€ç‚¹çš„ä¸œè¥¿æ—¶ï¼Œå°±æ˜¯è¿™ç§æƒ…å†µã€‚å°¤å…¶æ˜¯å½“æ‚¨åœ¨ç‰¹æ®Šç¯å¢ƒä¸­å·¥ä½œã€é’ˆå¯¹é«˜è´Ÿè½½è¿›è¡Œä¼˜åŒ–æˆ–æ„å»ºç‰©è”ç½‘è§£å†³æ–¹æ¡ˆæ—¶ã€‚

# å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

å¥½äº†ï¼Œè®©æˆ‘ä»¬åœæ­¢é—²èŠï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

![](img/d7c6fae39c94c29c69c5c7559864f638.png)

ç¿˜æ›²é€šè¿‡é¿å…è·³è¿‡ç¼“æ…¢çš„æ­¥éª¤æ¥åŠ é€Ÿè¿™ä¸ªè¿‡ç¨‹

æˆ‘å¸Œæœ›å®ƒå°½å¯èƒ½ç®€å•ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å…±äº« NFS å®ç°åŒæ ·çš„äº‹æƒ…(è¿™åœ¨ç‰©è”ç½‘å¼€å‘ä¸­éå¸¸å¸¸è§)ï¼Œä½†æ˜¯è®¾ç½®å’Œæ‹†é™¤å®ƒæ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„è¿‡ç¨‹(çŒœçŒœæœ‰å¤šå°‘ç‰©è”ç½‘è®¾å¤‡ä»åœ¨è¿è¡Œ Samba æœåŠ¡å™¨ï¼Ÿ).å¦‚æœæˆ‘ä»¬åœ¨å¼•æ“ç›–ä¸‹æœ‰ Kubernetesï¼Œä¸€å®šæœ‰æ›´ç®€å•çš„æ–¹æ³•ã€‚

`kubectl warp` command åœ¨å®¹å™¨ä¸­è¿è¡Œä½ çš„å‘½ä»¤ï¼Œæ–¹å¼å’Œ`kubectl run`ä¸€æ ·ï¼Œä½†æ˜¯åœ¨æ‰§è¡Œå‘½ä»¤ä¹‹å‰ï¼Œå®ƒä¼šå°†ä½ æ‰€æœ‰çš„æ–‡ä»¶åŒæ­¥åˆ°å®¹å™¨ä¸­ã€‚

> `*kubectl warp*`**=**`*kubectl run*`**+**`*rsync*`

ä¾‹å¦‚ï¼Œè¦åœ¨ Kubernetes ä¸­è¿è¡Œå¹¶å®æ—¶é‡æ–°åŠ è½½ [NodeJS é¡¹ç›®](https://github.com/ernoaapa/kubectl-warp/tree/master/examples/nodejs)ï¼Œæ‚¨å¯ä»¥

```
$ kubectl warp -i -t --image node -- npm run watch*# Start editing files and it live reloads the changes!*
```

`kubectl warp`åˆ›å»º *Pod* å…¶ä¸­ï¼Œé™¤äº†å®é™…çš„å®¹å™¨ï¼Œè¿˜æœ‰`sshd`å®¹å™¨è¿è¡Œ(ä½¿ç”¨ä¸€æ¬¡æ€§ SSH å¯†é’¥)ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨`rsync`å°†æ–‡ä»¶åŒæ­¥åˆ° *Pod* ã€‚

# æŒ‘æˆ˜

å®ç°å®ƒæ¯”æˆ‘æƒ³è±¡çš„è¦å¤æ‚ã€‚æœ€åˆï¼Œæˆ‘è®¡åˆ’ç”¨ä¸€ä¸ªç®€å•çš„ bash è„šæœ¬æ¥å®ç°å®ƒğŸ˜€

## åˆå§‹åŒæ­¥

é¦–å…ˆï¼Œæˆ‘éœ€è¦åœ¨å®é™…çš„å®¹å™¨å¯åŠ¨ä¹‹å‰åŒæ­¥æ–‡ä»¶ä¸€æ¬¡ï¼Œè¿™æ ·å½“å®é™…çš„å®¹å™¨ä½¿ç”¨å®šä¹‰çš„å‘½ä»¤å¯åŠ¨æ—¶ï¼Œæ–‡ä»¶å°±å·²ç»å¯ç”¨äº†ã€‚
æ‰€ä»¥æˆ‘éœ€è¦`sshd`å®¹å™¨æˆä¸º init-containerï¼Œå¹¶åœ¨ç¬¬ä¸€æ¬¡åŒæ­¥å®Œæˆæ—¶å®Œæˆå®ƒã€‚è¿™å¾ˆå®¹æ˜“ï¼Œæ„Ÿè°¢`sshd -d`è°ƒè¯•æ ‡å¿—ï¼Œé™¤äº†å®ƒæå‡ºäº†å¦ä¸€ä¸ªé—®é¢˜â€¦

## è®¿é—®åˆå§‹åŒ–å®¹å™¨

æˆ‘éœ€è¦ä¸€ç§æ–¹æ³•æ¥è®¿é—®`sshd` init-containerï¼Œä½†æ˜¯ Kubernetes åªåœ¨*å°±ç»ª*çŠ¶æ€æ—¶å°†æµé‡è·¯ç”±åˆ° *Pod* ï¼Œä½†æ˜¯å½“ init-container æ­£åœ¨è¿è¡Œæ—¶ï¼Œå®ƒå¤„äº *Init* çŠ¶æ€ã€‚
å¹¸è¿çš„æ˜¯ï¼Œæˆ‘å‘ç°ï¼Œå¯ä»¥é€šè¿‡ Kubernetes API å‘ init-container è¿›è¡Œç«¯å£è½¬å‘(`kubectl port-forward`åªåœ¨å®¢æˆ·ç«¯é˜»æ­¢è¿™ä¸€ç‚¹)ã€‚[åˆ›å»ºäº†ä¸€ä¸ª Github é—®é¢˜](https://github.com/kubernetes/kubernetes/issues/72461)ï¼Œå¸Œæœ›åœ¨æœªæ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ™®é€šçš„`kubectl port-forward`æ‰“å¼€åˆ° init-container çš„ç«¯å£è½¬å‘ã€‚

å› æ­¤ï¼Œå®ƒæœ€ç»ˆç”šè‡³æ¯”å¼€å§‹å¼„ä¹±*å…¥å£*é…ç½®æ›´å¥½ï¼Œè¿™å®é™…ä¸Šæ˜¯ç‰¹å®šäºç¯å¢ƒçš„ã€‚
åˆ›å»º *Pod* åï¼Œ`warp`å¼€å§‹ä»æœ¬åœ°éšæœºç«¯å£å‘`sshd`é›†è£…ç®±æ¸¯å£ 22 è½¬å‘ç«¯å£ï¼Œå¹¶åœ¨æœ¬åœ°æ‰§è¡Œ`rsync`å‘½ä»¤ã€‚ç„¶åï¼Œå½“ç¬¬ä¸€æ¬¡åŒæ­¥å®Œæˆæ—¶ï¼Œinit-container æˆåŠŸå®Œæˆï¼Œå®é™…çš„å®¹å™¨å¯åŠ¨ã€‚å‰å®³ï¼ğŸ‰

# å…¥é—¨æŒ‡å—

ä½¿ç”¨ MacOS å’Œ Brew(å…¶ä»–è¯·å‚è§[æ–‡æ¡£](https://github.com/ernoaapa/kubectl-warp#linux--macos-without-brew))ï¼Œæ‚¨å¯ä»¥å®‰è£…å®ƒ

```
brew install rsync ernoaapa/kubectl-plugins/warp
```

ä»[è¿™é‡Œ](https://github.com/ernoaapa/kubectl-warp/tree/master/examples/nodejs)è·å–ç¤ºä¾‹ NodeJS é¡¹ç›®

```
kubectl warp -i -t --image node demo -- npm install && npm run watch
```

# ç»“è®º

æœŸå¾…å¾—åˆ°ä¸€äº›å…³äº`kubectl warp`çš„åé¦ˆã€‚è¿™æ˜¯æ—©æœŸçš„å·¥ä½œç‰ˆæœ¬ï¼Œå¹¶æ²¡æœ‰å®ç°`kubectl run`çš„æ‰€æœ‰åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼Œéœ€è¦å®ç°ä¸€ä¸ª[åŠŸèƒ½æ¥ä½¿ç”¨*æŒä¹…å·*æ¥æ›´å¿«åœ°å¯åŠ¨](https://github.com/ernoaapa/kubectl-warp/issues/1)ï¼Œä»¥ä½¿å®ƒå˜å¾—æ›´å¥½ã€‚

![](img/c91da59d6d718c4737df33f984d4f11b.png)

kubiot.io â€”é¢å‘ç‰©è”ç½‘çš„ Kubernetes

è¿™åªæ˜¯[Kubiotâ€”â€”ç‰©è”ç½‘çš„ Kubernetes](https://www.kubiot.io/)çš„ä¸€ä¸ªå¼€æºéƒ¨åˆ†ã€‚
**åœ¨**[**kubiot . io**](https://www.kubiot.io/)**æŠ¥åæå‰è·å–ï¼**