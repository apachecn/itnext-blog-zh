<html>
<head>
<title>Leader election in Kubernetes using client-go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨client-goåœ¨Kubernetesè¿›è¡Œé¢†å¯¼äººé€‰ä¸¾</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/leader-election-in-kubernetes-using-client-go-a19cbe7a9a85?source=collection_archive---------0-----------------------#2021-10-27">https://itnext.io/leader-election-in-kubernetes-using-client-go-a19cbe7a9a85?source=collection_archive---------0-----------------------#2021-10-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="14be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">å¦‚æœä½ æƒ³äº†è§£é¢†å¯¼äººé€‰ä¸¾ä»¥åŠKubernetesçš„å·¥ä½œæ–¹å¼ï¼Œé‚£ä¹ˆæˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰ç”¨ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºé«˜å¯ç”¨æ€§ç³»ç»Ÿä¸­é¢†å¯¼è€…é€‰ä¸¾èƒŒåçš„æ€æƒ³ï¼Œå¹¶æ¢ç´¢kubernetes/client-go</em><em class="kl">åº“çš„</em> <a class="ae km" href="https://github.com/kubernetes/client-go" rel="noopener ugc nofollow" target="_blank"> <em class="kl">ä»¥åœ¨Kubernetesæ§åˆ¶å™¨çš„ä¸Šä¸‹æ–‡ä¸­ç†è§£å®ƒã€‚</em></a></p><h1 id="2347" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">ä»‹ç»</h1><p id="d351" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">éšç€å¯¹å¯é ç³»ç»Ÿå’ŒåŸºç¡€è®¾æ–½éœ€æ±‚çš„å¢åŠ ï¼Œæœ¯è¯­â€œé«˜å¯ç”¨æ€§â€è¿‘å¹´æ¥è¶Šæ¥è¶Šæµè¡Œã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œé«˜å¯ç”¨æ€§é€šå¸¸å¤„ç†æœ€å¤§åŒ–æ­£å¸¸è¿è¡Œæ—¶é—´å’Œä½¿ç³»ç»Ÿå®¹é”™ã€‚é«˜å¯ç”¨æ€§ä¸­ä¸€ä¸ªå¸¸è§çš„å®è·µæ˜¯ä½¿ç”¨å†—ä½™æ¥æœ€å¤§é™åº¦åœ°å‡å°‘å•ç‚¹æ•…éšœã€‚ä¸ºå†—ä½™å‡†å¤‡æ‚¨çš„ç³»ç»Ÿå’ŒæœåŠ¡å¯èƒ½å°±åƒåœ¨è´Ÿè½½å¹³è¡¡å™¨åé¢éƒ¨ç½²æ›´å¤šçš„itå‰¯æœ¬ä¸€æ ·ç®€å•ã€‚è™½ç„¶è¿™ç§é…ç½®å¯ä»¥ç”¨äºè®¸å¤šåº”ç”¨ç¨‹åºï¼Œä½†æœ‰äº›ç”¨ä¾‹éœ€è¦è·¨å‰¯æœ¬ä»”ç»†åè°ƒï¼Œæ‰èƒ½ä½¿ç³»ç»Ÿæ­£å¸¸å·¥ä½œã€‚</p><p id="81be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­å°±æ˜¯å°†Kubernetesæ§åˆ¶å™¨éƒ¨ç½²ä¸ºå¤šä¸ªå®ä¾‹ã€‚ä¸ºäº†é˜²æ­¢ä»»ä½•æ„å¤–è¡Œä¸ºï¼Œé¢†å¯¼è€…é€‰ä¸¾è¿‡ç¨‹å¿…é¡»ç¡®ä¿é¢†å¯¼è€…åœ¨å‰¯æœ¬ä¸­è¢«é€‰å‡ºï¼Œå¹¶ä¸”æ˜¯å”¯ä¸€ä¸»åŠ¨åè°ƒé›†ç¾¤çš„é¢†å¯¼è€…ã€‚å…¶ä»–å®ä¾‹åº”è¯¥ä¿æŒéæ´»åŠ¨çŠ¶æ€ï¼Œä½†å‡†å¤‡å¥½åœ¨ä¸»å®ä¾‹å¤±è´¥æ—¶æ¥ç®¡ã€‚</p><h1 id="4136" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">Kubernetesçš„é¢†å¯¼äººé€‰ä¸¾</h1><p id="96e5" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">Kubernetesçš„é¢†å¯¼äººé€‰ä¸¾è¿‡ç¨‹å¾ˆç®€å•ã€‚å®ƒä»åˆ›å»ºä¸€ä¸ªé”å¯¹è±¡å¼€å§‹ï¼Œå…¶ä¸­çš„é¢†å¯¼è€…å®šæœŸæ›´æ–°å½“å‰çš„æ—¶é—´æˆ³ï¼Œä½œä¸ºé€šçŸ¥å…¶ä»–å¤åˆ¶å“å…³äºå…¶é¢†å¯¼åœ°ä½çš„ä¸€ç§æ–¹å¼ã€‚è¿™ä¸ªé”å¯¹è±¡å¯èƒ½æ˜¯ä¸€ä¸ª<code class="fe lq lr ls lt b">Lease</code>ã€<code class="fe lq lr ls lt b">ConfigMap</code>æˆ–ä¸€ä¸ª<code class="fe lq lr ls lt b">Endpoint</code>ï¼Œå®ƒä¹ŸæŒæœ‰å½“å‰é¢†å¯¼è€…çš„èº«ä»½ã€‚å¦‚æœé¢†å¯¼è€…æœªèƒ½åœ¨ç»™å®šçš„æ—¶é—´é—´éš”å†…æ›´æ–°æ—¶é—´æˆ³ï¼Œåˆ™è®¤ä¸ºå®ƒå·²ç»å´©æºƒï¼Œæ­¤æ—¶éæ´»åŠ¨å‰¯æœ¬é€šè¿‡ç”¨å®ƒä»¬çš„èº«ä»½æ›´æ–°é”æ¥ç«äº‰è·å¾—é¢†å¯¼æƒã€‚æˆåŠŸè·å¾—é”çš„podå°†æˆä¸ºæ–°çš„é¢†å¯¼è€…ã€‚</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi lu"><img src="../Images/132c2b4e895b40541918e6251419cb2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ea0yTtafuGKug1JdcN1YGg.png"/></div></div></figure><p id="5831" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">åœ¨æˆ‘ä»¬å¤„ç†ä»»ä½•ä»£ç ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆçœ‹çœ‹è¿™ä¸ªè¿‡ç¨‹çš„è¿è¡Œæƒ…å†µï¼</p><p id="f25e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç¬¬ä¸€æ­¥æ˜¯å»ºç«‹ä¸€ä¸ªå½“åœ°çš„Kubernetesé›†ç¾¤ã€‚æˆ‘å°†ä½¿ç”¨<a class="ae km" href="https://kind.sigs.k8s.io/docs/user/quick-start/" rel="noopener ugc nofollow" target="_blank">ç±»å‹çš„</a>ï¼Œä½†æ˜¯ä½ å¯ä»¥éšæ„é€‰æ‹©ä¸€ä¸ªä½ å–œæ¬¢çš„æœ¬åœ°k8så‘è¡Œç‰ˆã€‚</p><pre class="lv lw lx ly gt mg lt mh mi aw mj bi"><span id="d0a0" class="mk ko iq lt b gy ml mm l mn mo">$ kind create cluster<br/>Creating cluster "kind" ...<br/> âœ“ Ensuring node image (kindest/node:v1.21.1) ğŸ–¼<br/> âœ“ Preparing nodes ğŸ“¦<br/> âœ“ Writing configuration ğŸ“œ<br/> âœ“ Starting control-plane ğŸ•¹ï¸<br/> âœ“ Installing CNI ğŸ”Œ<br/> âœ“ Installing StorageClass ğŸ’¾<br/>Set kubectl context to "kind-kind"<br/>You can now use your cluster with:</span><span id="e593" class="mk ko iq lt b gy mp mm l mn mo">kubectl cluster-info --context kind-kind</span><span id="a81b" class="mk ko iq lt b gy mp mm l mn mo">Not sure what to do next? ğŸ˜…  Check out <a class="ae km" href="https://kind.sigs.k8s.io/docs/user/quick-start/" rel="noopener ugc nofollow" target="_blank">https://kind.sigs.k8s.io/docs/user/quick-start/</a></span></pre><p id="4f3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬å°†ä½¿ç”¨çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºå¯ä»¥åœ¨<a class="ae km" href="https://github.com/mayankshah1607/k8s-leader-election" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚å®ƒä½¿ç”¨<a class="ae km" href="https://github.com/kubernetes/client-go" rel="noopener ugc nofollow" target="_blank"> kubernetes/client-go </a>æ¥æ‰§è¡Œé¢†å¯¼è€…é€‰ä¸¾ã€‚è®©æˆ‘ä»¬åœ¨é›†ç¾¤ä¸Šå®‰è£…åº”ç”¨ç¨‹åº:</p><pre class="lv lw lx ly gt mg lt mh mi aw mj bi"><span id="238c" class="mk ko iq lt b gy ml mm l mn mo"># Setup required permissions for creating/getting Lease objects<br/>$ kubectl apply -f rbac.yaml<br/>serviceaccount/leaderelection-sa created<br/>role.rbac.authorization.k8s.io/leaderelection-role created<br/>rolebinding.rbac.authorization.k8s.io/leaderelection-rolebinding created</span><span id="cd3a" class="mk ko iq lt b gy mp mm l mn mo"># Create deployment<br/>$ kubectl apply -f deploy.yaml<br/>deployment.apps/leaderelection created</span></pre><p id="6ca1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¿™å°†åˆ›å»ºä¸€ä¸ªåŒ…å«3ä¸ªå•å…ƒ(å‰¯æœ¬)çš„éƒ¨ç½²ã€‚å¦‚æœæ‚¨ç­‰å¾…å‡ ç§’é’Ÿï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°å®ƒä»¬å¤„äº<code class="fe lq lr ls lt b">Running</code>çŠ¶æ€ã€‚</p><pre class="lv lw lx ly gt mg lt mh mi aw mj bi"><span id="31c0" class="mk ko iq lt b gy ml mm l mn mo">â¯ kubectl get pods<br/>NAME                              READY   STATUS    RESTARTS   AGE<br/>leaderelection-6d5b456c9d-cfd2l   1/1     Running   0          19s<br/>leaderelection-6d5b456c9d-n2kx2   1/1     Running   0          19s<br/>leaderelection-6d5b456c9d-ph8nj   1/1     Running   0          19s</span></pre><p id="4d5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä¸€æ—¦æ‚¨è¿è¡Œäº†æ‚¨çš„podï¼Œè®©æˆ‘ä»¬å°è¯•æŸ¥çœ‹ä»–ä»¬ä½œä¸ºé¢†å¯¼è€…é€‰ä¸¾è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†åˆ›å»ºçš„<code class="fe lq lr ls lt b">Lease</code>é”å¯¹è±¡ã€‚</p><pre class="lv lw lx ly gt mg lt mh mi aw mj bi"><span id="cb25" class="mk ko iq lt b gy ml mm l mn mo">$ kubectl describe lease my-lease</span><span id="ba09" class="mk ko iq lt b gy mp mm l mn mo">Name:         my-lease<br/>Namespace:    default<br/>Labels:       &lt;none&gt;<br/>Annotations:  &lt;none&gt;<br/>API Version:  coordination.k8s.io/v1<br/>Kind:         Lease<br/>Metadata:<br/>...<br/>Spec:<br/>  Acquire Time:            2021-10-23T06:51:50.605570Z<br/>  Holder Identity:         leaderelection-56457b6c5c-fn725<br/>  Lease Duration Seconds:  15<br/>  Lease Transitions:       0<br/>  Renew Time:              2021-10-23T06:52:45.309478Z<br/></span></pre><p id="3924" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ ¹æ®è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬ç›®å‰çš„é¢†è¢–åŠèˆ±æ˜¯<code class="fe lq lr ls lt b">leaderelection-56457bc5c-fn725</code>ã€‚è®©æˆ‘ä»¬é€šè¿‡æŸ¥çœ‹podæ—¥å¿—æ¥éªŒè¯è¿™ä¸€ç‚¹ã€‚</p><pre class="lv lw lx ly gt mg lt mh mi aw mj bi"><span id="8260" class="mk ko iq lt b gy ml mm l mn mo"># leader pod<br/>$ kubectl logs leaderelection-56457b6c5c-fn725</span><span id="ce4a" class="mk ko iq lt b gy mp mm l mn mo">I1023 06:51:50.605439       1 leaderelection.go:248] attempting to acquire leader lease default/my-lease...<br/>I1023 06:51:50.630111       1 leaderelection.go:258] successfully acquired lease default/my-lease<br/>I1023 06:51:50.630141       1 main.go:57] still the leader!<br/>I1023 06:51:50.630245       1 main.go:36] doing stuff...</span><span id="4b1c" class="mk ko iq lt b gy mp mm l mn mo"># inactive pods<br/>$ kubectl logs leaderelection-56457b6c5c-n857k<br/>I1023 06:51:55.400797       1 leaderelection.go:248] attempting to acquire leader lease default/my-lease...<br/>I1023 06:51:55.412780       1 main.go:60] new leader is %sleaderelection-56457b6c5c-fn725</span><span id="02b1" class="mk ko iq lt b gy mp mm l mn mo"># inactive pod<br/>$ kubectl logs leaderelection-56457b6c5c-s48kx<br/>I1023 06:51:52.905451       1 leaderelection.go:248] attempting to acquire leader lease default/my-lease...<br/>I1023 06:51:52.915618       1 main.go:60] new leader is %sleaderelection-56457b6c5c-fn725</span></pre><p id="8147" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å°è¯•åˆ é™¤leader podæ¥æ¨¡æ‹Ÿå æœºï¼Œå¦‚æœé€‰å‡ºäº†æ–°çš„leaderï¼Œåˆ™æ£€æŸ¥<code class="fe lq lr ls lt b">Lease</code>å¯¹è±¡ï¼›)</p><h1 id="24b4" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">æ·±æ½œä»£ç </h1><blockquote class="mq mr ms"><p id="f2f4" class="jn jo kl jp b jq jr js jt ju jv jw jx mt jz ka kb mu kd ke kf mv kh ki kj kk ij bi translated">è¿™ä¸ªé¡¹ç›®çš„ä»£ç å¯ä»¥åœ¨<a class="ae km" href="https://github.com/mayankshah1607/k8s-leader-election" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚</p></blockquote><p id="a43c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¿™é‡Œçš„åŸºæœ¬æ€æƒ³æ˜¯ä½¿ç”¨åˆ†å¸ƒå¼é”å®šæœºåˆ¶æ¥å†³å®šå“ªä¸ªè¿›ç¨‹æˆä¸ºé¢†å¯¼è€…ã€‚è·å¾—é”çš„è¿›ç¨‹å¼€å§‹æ‰§è¡Œæ‰€éœ€çš„ä»»åŠ¡ã€‚<code class="fe lq lr ls lt b">main</code>å‡½æ•°æ˜¯æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„å…¥å£ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¯¹lockå¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶å¼€å§‹ä¸€ä¸ªé¢†å¯¼è€…é€‰ä¸¾å¾ªç¯ã€‚</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="mw mx l"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated"><a class="ae km" href="https://github.com/mayankshah1607/k8s-leader-election/blob/master/main.go#L66-L95" rel="noopener ugc nofollow" target="_blank">https://github . com/mayankshah 1607/k8s-leader-election/blob/master/main . go # L66-L95</a></figcaption></figure><p id="a368" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬é¦–å…ˆè§£æ<code class="fe lq lr ls lt b">lease-name</code>å’Œ<code class="fe lq lr ls lt b">lease-namespace</code>æ ‡å¿—æ¥è·å–å‰¯æœ¬å¿…é¡»ä½¿ç”¨çš„é”å¯¹è±¡çš„åç§°å’Œå‘½åç©ºé—´ã€‚ç¯å¢ƒå˜é‡<code class="fe lq lr ls lt b">POD_NAME</code>çš„å€¼(å¡«å……åœ¨<a class="ae km" href="https://github.com/mayankshah1607/k8s-leader-election/blob/master/deploy.yaml#L26" rel="noopener ugc nofollow" target="_blank"> deploy.yaml </a>æ¸…å•ä¸­)å°†ç”¨äºè¯†åˆ«<code class="fe lq lr ls lt b">Lease</code>å¯¹è±¡ä¸­çš„é¢†å¯¼è€…ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™äº›å‚æ•°åˆ›å»ºä¸€ä¸ªé”å¯¹è±¡æ¥å¯åŠ¨é¢†å¯¼è€…é€‰ä¸¾è¿‡ç¨‹ã€‚</p><p id="52c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">åœ¨<code class="fe lq lr ls lt b">runLeaderElection</code>å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨<code class="fe lq lr ls lt b">RunOrDie</code>æ¥å¯åŠ¨é¢†å¯¼è€…é€‰ä¸¾å¾ªç¯ã€‚æˆ‘ä»¬ä¼ é€’ä¸€ä¸ª<code class="fe lq lr ls lt b">LeaderElectionConfig</code>ç»™å®ƒ:</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="mw mx l"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated"><a class="ae km" href="https://github.com/mayankshah1607/k8s-leader-election/blob/master/main.go#L41-L64" rel="noopener ugc nofollow" target="_blank">https://github . com/mayankshah 1607/k8s-leader-election/blob/master/main . go # L41-L64</a></figcaption></figure><p id="a8b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹<code class="fe lq lr ls lt b">RunOrDie</code>åœ¨client-goä¸­çš„å®ç°ã€‚</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="mw mx l"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated"><a class="ae km" href="https://github.com/kubernetes/client-go/blob/master/tools/leaderelection/leaderelection.go#L218-L227" rel="noopener ugc nofollow" target="_blank">https://github . com/kubernetes/client-go/blob/master/tools/leader election/leader election . go # L218-L227</a></figcaption></figure><p id="214d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å®ƒä½¿ç”¨æˆ‘ä»¬ä¼ é€’ç»™å®ƒçš„<code class="fe lq lr ls lt b">LeaderElectorConfig</code>åˆ›å»ºä¸€ä¸ª<code class="fe lq lr ls lt b">*LeaderElector</code>,å¹¶è°ƒç”¨å®ƒçš„<code class="fe lq lr ls lt b">Run</code>æ–¹æ³•:</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="mw mx l"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated"><a class="ae km" href="https://github.com/kubernetes/client-go/blob/56656ba0e04ff501549162385908f5b7d14f5dc8/tools/leaderelection/leaderelection.go#L200-L213" rel="noopener ugc nofollow" target="_blank">https://github . com/kubernetes/client-go/blob/56656 ba 0 e 04 ff 501549162385908 F5 b 7d 14 F5 DC 8/tools/leader election/leader election . go # L200-L213</a></figcaption></figure><p id="80ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ­¤æ–¹æ³•è´Ÿè´£è¿è¡Œé¢†å¯¼è€…é€‰ä¸¾å¾ªç¯ã€‚å®ƒé¦–å…ˆè¯•å›¾è·å–é”(ä½¿ç”¨<code class="fe lq lr ls lt b">le.acquire</code>)ã€‚æˆåŠŸåï¼Œå®ƒè¿è¡Œæˆ‘ä»¬ä¹‹å‰é…ç½®çš„<code class="fe lq lr ls lt b">OnStartedLeading</code>å›è°ƒï¼Œå¹¶å®šæœŸæ›´æ–°ç§Ÿçº¦ã€‚åœ¨è·å–é”å¤±è´¥æ—¶ï¼Œå®ƒç®€å•åœ°è¿è¡Œ<code class="fe lq lr ls lt b">OnStoppedLeading</code>å›è°ƒå¹¶è¿”å›ã€‚</p><p id="e1e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å®ç°<code class="fe lq lr ls lt b"><a class="ae km" href="https://github.com/kubernetes/client-go/blob/56656ba0e04ff501549162385908f5b7d14f5dc8/tools/leaderelection/leaderelection.go#L243" rel="noopener ugc nofollow" target="_blank">acquire</a></code>å’Œ<code class="fe lq lr ls lt b"><a class="ae km" href="https://github.com/kubernetes/client-go/blob/56656ba0e04ff501549162385908f5b7d14f5dc8/tools/leaderelection/leaderelection.go#L265" rel="noopener ugc nofollow" target="_blank">renew</a> </code>æ–¹æ³•æœ€é‡è¦çš„éƒ¨åˆ†æ˜¯å¯¹<code class="fe lq lr ls lt b"><a class="ae km" href="https://github.com/kubernetes/client-go/blob/56656ba0e04ff501549162385908f5b7d14f5dc8/tools/leaderelection/leaderelection.go#L317" rel="noopener ugc nofollow" target="_blank">tryAcquireOrRenew</a></code>çš„è°ƒç”¨ï¼Œå®ƒæŒæœ‰é”å®šæœºåˆ¶çš„æ ¸å¿ƒé€»è¾‘ã€‚</p><h2 id="dead" class="mk ko iq bd kp nc nd dn kt ne nf dp kx jy ng nh lb kc ni nj lf kg nk nl lj nm bi translated">ä¹è§‚é”å®š(å¹¶å‘æ§åˆ¶)</h2><p id="834e" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">é¢†å¯¼è€…é€‰ä¸¾è¿‡ç¨‹åˆ©ç”¨äº†Kubernetesæ“ä½œçš„åŸå­æ€§è´¨ï¼Œä»¥ç¡®ä¿æ²¡æœ‰ä¸¤ä¸ªå‰¯æœ¬å¯ä»¥åŒæ—¶è·å¾—<code class="fe lq lr ls lt b">Lease</code>(å¦åˆ™ä¼šå¯¼è‡´ç«æ€æ¡ä»¶å’Œå…¶ä»–æ„å¤–è¡Œä¸ºï¼).æ¯å½“<code class="fe lq lr ls lt b">Lease</code>è¢«æ›´æ–°(æ›´æ–°æˆ–æ”¶è´­)æ—¶ï¼Œä¸Šé¢çš„<code class="fe lq lr ls lt b">resourceVersion</code>å­—æ®µä¹Ÿä¼šè¢«Kubernetesæ›´æ–°ã€‚å½“å¦ä¸€ä¸ªè¿›ç¨‹è¯•å›¾åŒæ—¶æ›´æ–°<code class="fe lq lr ls lt b">Lease</code>æ—¶ï¼ŒKubernetesæ£€æŸ¥è¢«æ›´æ–°å¯¹è±¡çš„<code class="fe lq lr ls lt b">resourceVersion</code>å­—æ®µæ˜¯å¦ä¸å½“å‰å¯¹è±¡åŒ¹é…â€”â€”å¦‚æœä¸åŒ¹é…ï¼Œæ›´æ–°å°±ä¼šå¤±è´¥ï¼Œä»è€Œé˜²æ­¢å¹¶å‘é—®é¢˜ï¼</p><h1 id="3943" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">æ‘˜è¦</h1><p id="e6dd" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†é¢†å¯¼è€…é€‰ä¸¾çš„æ¦‚å¿µï¼Œä»¥åŠä¸ºä»€ä¹ˆå®ƒå¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§è‡³å…³é‡è¦ã€‚æˆ‘ä»¬çœ‹äº†ä¸€ä¸‹è¿™æ˜¯å¦‚ä½•åœ¨Kubernetesä¸­ä½¿ç”¨<code class="fe lq lr ls lt b">Lease</code>é”å®ç°çš„ï¼Œå¹¶å°è¯•ä½¿ç”¨<a class="ae km" href="https://github.com/kubernetes/client-go/blob/master/tools/leaderelection/leaderelection.go" rel="noopener ugc nofollow" target="_blank"> kubernetes/client-go </a>åº“è‡ªå·±å®ç°å®ƒã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜è¯•å›¾ç†è§£Kuberneteså¦‚ä½•ä½¿ç”¨åŸå­æ“ä½œå’Œä¹è§‚é”å®šæ–¹æ³•æ¥é˜²æ­¢å¹¶å‘æ€§å¼•èµ·çš„é—®é¢˜ã€‚</p><blockquote class="mq mr ms"><p id="9486" class="jn jo kl jp b jq jr js jt ju jv jw jx mt jz ka kb mu kd ke kf mv kh ki kj kk ij bi translated">è¿˜è¯·æ³¨æ„ï¼Œè¿™ç¯‡æ–‡ç« ä¸­ä½¿ç”¨çš„ä»£ç ä¸æ˜¯ä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒæ˜¯ä¸ºäº†ä»¥ä¸€ç§ç®€å•çš„æ–¹å¼æ¼”ç¤ºé¢†å¯¼è€…é€‰ä¸¾è€Œç¼–å†™çš„ï¼</p></blockquote><p id="c3f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰å¸®åŠ©ï¼Œè¯·è€ƒè™‘é¼“æŒå¹¶ä¸ä½ çš„æœ‹å‹å’ŒåŒäº‹åˆ†äº«ã€‚æ‚¨å¯ä»¥åœ¨ä»¥ä¸‹ç½‘å€æ‰¾åˆ°æˆ‘:</p><ul class=""><li id="3cb6" class="nn no iq jp b jq jr ju jv jy np kc nq kg nr kk ns nt nu nv bi translated">æ¨ç‰¹â€”<a class="ae km" href="https://twitter.com/mayankshah__" rel="noopener ugc nofollow" target="_blank">https://twitter.com/mayankshah__</a></li><li id="146e" class="nn no iq jp b jq nw ju nx jy ny kc nz kg oa kk ns nt nu nv bi translated">LinkedInâ€”<a class="ae km" href="https://www.linkedin.com/in/mayankshah1607/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/mayankshah1607/</a></li><li id="be9d" class="nn no iq jp b jq nw ju nx jy ny kc nz kg oa kk ns nt nu nv bi translated">GitHubâ€”<a class="ae km" href="https://github.com/mayankshah1607" rel="noopener ugc nofollow" target="_blank">https://github.com/mayankshah1607</a></li></ul><p id="0b2b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">æ„Ÿè°¢æ‚¨èŠ±æ—¶é—´é˜…è¯»æœ¬æ–‡ï¼</em></p><h1 id="859b" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">å‚è€ƒ</h1><ul class=""><li id="b9ad" class="nn no iq jp b jq ll ju lm jy ob kc oc kg od kk ns nt nu nv bi translated"><a class="ae km" href="https://kubernetes.io/blog/2016/01/simple-leader-election-with-kubernetes/" rel="noopener ugc nofollow" target="_blank">https://kubernetes . io/blog/2016/01/simple-leader-election-with-kubernetes/</a></li><li id="929d" class="nn no iq jp b jq nw ju nx jy ny kc nz kg oa kk ns nt nu nv bi translated"><a class="ae km" href="https://medium.com/hybrid-cloud-hobbyist/leader-election-architecture-kubernetes-32600da81e3c" rel="noopener">https://medium . com/hybrid-cloud-hobbist/leader-election-architecture-kubernetes-32600 da 81 e3c</a></li><li id="b087" class="nn no iq jp b jq nw ju nx jy ny kc nz kg oa kk ns nt nu nv bi translated"><a class="ae km" href="https://carlosbecker.com/posts/k8s-leader-election/" rel="noopener ugc nofollow" target="_blank">https://carlosbecker.com/posts/k8s-leader-election/</a></li><li id="969c" class="nn no iq jp b jq nw ju nx jy ny kc nz kg oa kk ns nt nu nv bi translated"><a class="ae km" href="https://taesunny.github.io/kubernetes/kubernetes-controllers-leader-election-with-go-library/" rel="noopener ugc nofollow" target="_blank">https://tae sunny . github . io/kubernetes/kubernetes-controllers-leader-election-with-go-library/</a></li></ul></div></div>    
</body>
</html>