# RxJS è¿ç®—ç¬¦:é‡è¯•è¿˜æ˜¯é‡å¤ï¼Ÿ

> åŸæ–‡ï¼š<https://itnext.io/rxjs-operators-retry-vs-repeat-26028ca1744a?source=collection_archive---------7----------------------->

> é‚£ä¹ˆ RxJS ä¸­é‡è¯•å’Œé‡å¤çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿå­¦ä¹ è¿™ä¸¤ä¸ªæ“ä½œç¬¦çš„ç®€æ´ç”¨ä¾‹æœ‰åŠ©äºæ‚¨æ›´å¥½åœ°ç†è§£å®ƒä»¬ã€‚

![](img/b649e9bae5cdfa092a6dfad3cf150d23.png)

Elle Florio çš„ä¸€ä¸ªé•œå¤´

# ä»‹ç»

å‡ å¹´å‰ï¼Œå½“æˆ‘åˆšå¼€å§‹å­¦ä¹  RxJS æ—¶ï¼Œæˆ‘ä¸å¤ªæ˜ç™½ä¸ºä»€ä¹ˆ RxJS ä¸­æœ‰ä¸¤ä¸ªæ“ä½œç¬¦ç”¨äºé‡å¤é€»è¾‘ã€‚ä¸ä»…æˆ‘å¯èƒ½æœ‰è¿™æ ·çš„ç–‘é—®ï¼Œæ‰€ä»¥åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†å›é¡¾**é‡è¯•**å’Œ**é‡å¤**æ“ä½œç¬¦ä»¥åŠå®ƒä»¬å¯èƒ½çš„ç”¨ä¾‹ã€‚

# é‡è¯•â€¦è¿˜æ˜¯é‡å¤ï¼Ÿ

åœ¨ RxJS ä¸­ï¼Œ **repeat** å’Œ **retry** æ“ä½œç¬¦éƒ½å…è®¸æ‚¨æœ‰æ¡ä»¶åœ°é‡æ–°è®¢é˜…å®ƒä»¬æ‰€åº”ç”¨åˆ°çš„ç»ˆæ­¢æºå¯è§‚å¯Ÿå¯¹è±¡ã€‚
ä¸¤è€…éƒ½ä½¿æºå¯è§‚æµ‹åºåˆ—å°†è¢«é‡æ–°å¯åŠ¨ã€‚

ä¸»è¦åŒºåˆ«æ˜¯

**é‡å¤** â€”æ”¶åˆ° onComplete()æ—¶é‡æ–°è®¢é˜…ï¼Œä½†ä¸æ˜¯é”™è¯¯ã€‚
**é‡è¯•** â€”æ”¶åˆ° onError()æ—¶é‡æ–°è®¢é˜…ã€‚

å°±å¯èƒ½çš„ç”¨ä¾‹è€Œè¨€:

> *å¦‚æœä½ æƒ³é‡å¤æˆåŠŸçš„æ•°æ®æå–ï¼Œä½¿ç”¨* ***é‡å¤*** *ã€‚
> å¦‚æœæ‚¨æƒ³åœ¨å¯è§‚å¯Ÿå¯¹è±¡ä¸­é‡å¤å¤±è´¥çš„æ•°æ®æå–â€”ä½¿ç”¨* ***é‡è¯•*** *ã€‚*

ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡ç¤ºä¾‹è¯¦ç»†äº†è§£ä¸€ä¸‹å®ƒä»¬ã€‚

# é‡è¯•

> ***ã€é‡è¯•æ¬¡æ•°ã€‘***

å®ƒè¿”å›åæ˜ æºå¯è§‚æµ‹å€¼çš„å¯è§‚æµ‹å€¼ï¼Œä½†æœ‰ä¸€ä¸ªé”™è¯¯ã€‚
å¦‚æœæºå¯è§‚å¯Ÿè°ƒç”¨å‡ºé”™ï¼Œè¯¥æ–¹æ³•å°†é‡æ–°è®¢é˜…ä¸ºæºå¯è§‚å¯Ÿï¼Œæœ€å¤šæœ‰*æ¬¡*æ¬¡é‡æ–°è®¢é˜…

**è®¡æ•°** â€”å¤±è´¥å‰é‡è¯•äº‹ä»¶çš„æ¬¡æ•°ã€‚é»˜è®¤å€¼ä¸º-1ã€‚

![](img/d2c25844533da0223ce74c075786f5bc.png)

**é‡è¯•**å¤§ç†çŸ³å›¾

è¿™æ˜¯ä¸€ä¸ªå¤„ç†ä¸ç¨³å®šç½‘ç»œè¿æ¥çš„æ™®é€š JS ç¤ºä¾‹ã€‚æˆ‘ä»¬è¿›è¡Œå¯è§‚å¯ŸåŒ…è£…çš„ Ajax è°ƒç”¨å¹¶ä½¿ç”¨é‡è¯•æ“ä½œç¬¦ã€‚å¦‚æœç¬¬ä¸€æ¬¡ ajax è°ƒç”¨è¿”å›é”™è¯¯ï¼Œé‡è¯•æ“ä½œç¬¦å°†å†æ¬¡æ‰§è¡Œ Ajax è¯·æ±‚ä¸‰æ¬¡ã€‚
å¦‚æœå…¶ä¸­ä¸€æ¬¡å°è¯•æˆåŠŸï¼Œå®ƒå°†ä¸ºä¸‹ä¸€æ¬¡ç”¨æˆ·å›æ‹¨æä¾›æ•°æ®ã€‚
å¦‚æœå¦å¤–ä¸‰æ¬¡å°è¯•éƒ½å¤±è´¥ï¼Œåˆ™é”™è¯¯å°†é€šè¿‡é”™è¯¯å›è°ƒå¤„ç†ç¨‹åºä¼ æ’­ç»™è®¢æˆ·ã€‚

è®©æˆ‘ä»¬è¯•ç€åœ¨[ä»£ç ç¬”](https://codepen.io/kievsash/pen/zXevvo?editors=0010)ä¸­è¿è¡Œå®ƒã€‚

æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¤±è´¥çš„è¯·æ±‚å’Œ 4 æ¬¡é‡è¯•å°è¯•(å®ƒä»¬éƒ½å¤±è´¥äº†ï¼Œå› ä¸ºå‡ºäºå­¦ä¹ ç›®çš„ï¼Œæˆ‘ä»¬è¯•å›¾åˆ°è¾¾ä¸å­˜åœ¨çš„ url)ã€‚

![](img/a7abd65fc1179cba32ad8bb3b492dbb7.png)

# æ€»ç»“ä¸€ä¸‹:

1.  **é‡è¯•**è¿”å›é•œåƒæºå¯è§‚å¯Ÿå¯¹è±¡çš„å¯è§‚å¯Ÿå¯¹è±¡ã€‚
2.  å¦‚æœæºå¯è§‚å¯Ÿè°ƒç”¨å‡ºé”™ï¼Œè¯¥æ–¹æ³•å°†é‡æ–°è®¢é˜…æºå¯è§‚å¯Ÿ(é‡å¤è¿è¡Œæºåºåˆ—)ï¼Œæœ€å¤šå¯é‡æ–°è®¢é˜… count param å€¼ã€‚
3.  å¦‚æœå…¶ä¸­ä¸€æ¬¡é‡è¯•è¿è¡ŒæˆåŠŸï¼Œäº‹ä»¶æ•°æ®å°†æä¾›ç»™è®¢æˆ·çš„ä¸‹ä¸€ä¸ªå›è°ƒå¤„ç†ç¨‹åºã€‚å¦‚æœæ‰€æœ‰é‡è¯•è¿è¡Œéƒ½å¤±è´¥â€”é”™è¯¯å°†ä¼ æ’­åˆ° onError å¤„ç†ç¨‹åºã€‚
4.  ä¸€ä¸ªå¯èƒ½çš„ç”¨ä¾‹â€” ajax å¤±è´¥çš„è¯·æ±‚é‡è¯•ã€‚

# é‡å¤

> ***ã€é‡å¤è®¡æ•°ã€‘***

è¿”å›ä¸€ä¸ªå¯è§‚å¯Ÿå¯¹è±¡ï¼Œè¯¥å¯è§‚å¯Ÿå¯¹è±¡æœ€å¤šé‡å¤æºå¯è§‚å¯Ÿå¯¹è±¡å‘å‡ºçš„é¡¹ç›®æµ*è®¡æ•°*æ¬¡ã€‚

**è®¡æ•°** â€”æºå¯è§‚æµ‹é¡¹ç›®é‡å¤çš„æ¬¡æ•°ï¼Œè®¡æ•°ä¸º 0 å°†äº§ç”Ÿç©ºå¯è§‚æµ‹é¡¹ç›®ã€‚é»˜è®¤å€¼ä¸º-1ã€‚

![](img/3653d9cccd2631a8cc1fd9e5a498ff8e.png)

**é‡å¤**å¤§ç†çŸ³å›¾

çœ‹çœ‹è¿™ä¸ªä¾‹å­:

![](img/d0404a96b7f8cff52007e494d1e15fe1.png)

æˆ‘ä»¬æå–æºåºåˆ—å¹¶è¿è¡Œä¸¤æ¬¡ã€‚
æ³¨æ„*é‡å¤*æ“ä½œå‘˜å°†åˆå§‹è¿è¡Œè§†ä¸ºç¬¬ä¸€æ¬¡è¿è¡Œã€‚

ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ›´å¤æ‚çš„ç”¨ä¾‹â€”â€”æ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªåç«¯ï¼Œä½†å®ƒä¸æ˜¯ä¸€æ¬¡å¸¦æ¥æ‰€æœ‰æ•°æ®ï¼Œè€Œæ˜¯æŒ‰é¡µå¸¦æ¥ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬å®ç°ä»åç«¯è·å–ç‰¹å®šæ•°é‡çš„åˆ†é¡µæ•°æ®éƒ¨åˆ†:

åœ¨æˆ‘æè¿°è¿™æ®µä»£ç ä¹‹å‰â€”â€”æ³¨æ„æˆ‘ä»¬åœ¨ RxJS çš„ **defer** å‡½æ•°ä¸­åŒ…è£…äº†æºå¯è§‚å¯Ÿå¯¹è±¡ã€‚æ¯æ¬¡å½“ *repeat* operator é‡æ–°è¿è¡Œ source observable æ—¶â€”â€”*defer*å°†ä¸ºå…¶å·¥å‚å‡½æ•°æä¾›èµ„é‡‘â€”â€”å› æ­¤æˆ‘ä»¬çš„ url å°†å…·æœ‰æ›´æ–°çš„è®¡æ•°å™¨å€¼ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»æ›´å¤šå…³äº*æ¨è¿Ÿ*T21

ç°åœ¨è®©æˆ‘ä»¬è§‚å¯Ÿå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„:

1.  å½“æˆ‘ä»¬è®¢é˜…æ—¶ï¼Œsource ç¬¬ä¸€æ¬¡è°ƒç”¨ page = 0(è®¡æ•°å™¨å˜é‡)ã€‚
2.  æˆåŠŸè·å–æ•°æ®åï¼Œæˆ‘ä»¬å°†æ•°æ®å‘é€ç»™è®¢é˜…è€…ã€‚ç„¶åæºå¯è§‚å¯Ÿæ€§å®Œæˆâ€”å› æ­¤*é‡å¤*å¼€å§‹å·¥ä½œâ€”å¹¶é‡æ–°è¿è¡Œæºâ€”åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯*å»¶è¿Ÿ*åŠŸèƒ½ã€‚
3.  Defer å‡½æ•°è°ƒç”¨å…¶å·¥å‚å‡½æ•°ï¼Œå¹¶è¿”å›å¸¦æœ‰æ–°è®¡æ•°å™¨å€¼çš„ ajax observableã€‚æ‰€ä»¥ç°åœ¨æˆ‘ä»¬ç”¨ page = 1 è¯·æ±‚ APIã€‚
4.  æ–°çš„æ•°æ®é¡µä¹Ÿè¢«å‘é€ç»™è®¢é˜…è€…ã€‚

æ‚¨å¯ä»¥å°è¯•åœ¨ [codepen](https://codepen.io/kievsash/pen/EJrKoj?editors=0010) ä¸­è¿è¡Œè¿™æ®µä»£ç ã€‚

# æ€»ç»“ä¸€ä¸‹:

1.  **repeat** è¿”å›ä¸€ä¸ªå¯è§‚å¯Ÿå¯¹è±¡ï¼Œå®ƒé‡å¤æºå¯è§‚å¯Ÿå¯¹è±¡å‘å‡ºçš„é¡¹ç›®æµæœ€å¤š *count* æ¬¡ã€‚
2.  **count** param â€”æºå¯è§‚å¯Ÿé¡¹ç›®é‡å¤çš„æ¬¡æ•°ï¼Œè®¡æ•°ä¸º 0 å°†äº§ç”Ÿç©ºå¯è§‚å¯Ÿé¡¹ç›®ã€‚ä¸ retry-repeat è¿ç®—ç¬¦ä¸åŒï¼Œå®ƒå°†åˆå§‹æº$ run è§†ä¸ºç¬¬ä¸€æ¬¡å°è¯•ï¼Œå› æ­¤è¯¥æºå°†è¢«é‡å¤(count-1)æ¬¡ã€‚
3.  **é‡å¤** â€”ä»æºåºåˆ—æ¥æ”¶åˆ° onComplete()æ—¶é‡æ–°è®¢é˜…ï¼Œä½†ä¸æ˜¯é”™è¯¯ã€‚
4.  å¦‚æœæ‚¨éœ€è¦æºå¯è§‚æµ‹å€¼ä»¥ä¸åŒçš„å‚æ•°é‡å¤â€”â€”ä½¿ç”¨ RxJS å»¶è¿Ÿå‡½æ•°ã€‚

# æˆ‘ä»¬èƒ½ä¸€èµ·ä½¿ç”¨å®ƒä»¬å—ï¼Ÿ

æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸¤ä¸ª**é‡è¯•**å’Œ**é‡å¤**å—ï¼Ÿ
è‚¯å®šæ˜¯çš„ï¼å¦‚æœæ‚¨æƒ³è¦é‡å¤æºè¯·æ±‚ï¼Œå¹¶åœ¨å…¶ä¸­ä¸€ä¸ªé‡å¤è°ƒç”¨å¤±è´¥æ—¶é‡è¯•â€”æ‚¨å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªè¿ç®—ç¬¦ã€‚

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç”¨ **repeat** æ“ä½œç¬¦è¯·æ±‚åˆ†é¡µä¿¡æ¯ä¸¤æ¬¡ã€‚å¦‚æœæŸäº›è¯·æ±‚å¤±è´¥ï¼Œé‡è¯•å°†é‡æ–°è¿è¡Œå®ƒã€‚

# retryWhen å’Œ repeatWhen

å½“æˆ‘ç¬¬ä¸€æ¬¡çœ‹åˆ° **retry** å’Œ **repeat** æ“ä½œç¬¦çš„ä¾‹å­æ—¶ï¼Œæˆ‘çš„æƒ³æ³•æ˜¯â€”â€”æˆ‘èƒ½åœ¨é‡è¯• ajax è°ƒç”¨ä¹‹é—´å¢åŠ ä¸€äº›å»¶è¿Ÿå—ï¼Ÿ
è¿™æ˜¯è¿ç®—ç¬¦ ***retryWhen*** å’Œ ***repeatWhen*** å‘æŒ¥ä½œç”¨çš„æ—¶å€™â€”â€”ä¸è¿‡è¿™æ˜¯å¦ä¸€ç¯‡æ–‡ç« çš„ä¸»é¢˜â€”â€”[è®©æˆ‘ä»¬ä¿æŒè”ç³»](https://twitter.com/El_Extremal)ï¼

[![](img/e39daa364c50029b206bdc057d2b3487.png)](http://eepurl.com/gHF0av)

# å…¶ä»–é“¾æ¥:

1.  [RxJSâ€˜é‡å¤â€™æ“ä½œè€…â€”â€”åˆçº§æ­»çµæ³•å¸ˆæŒ‡å—](https://blog.angularindepth.com/rxjs-repeat-operator-beginner-necromancer-guide-391a3b2ad3ad)ã€‚
2.  [Rxã€‚iframe-d Angular SPA ä¸­çš„ JS retryWhen ç”¨ä¾‹](https://medium.com/@alexanderposhtaruk/rx-js-replywhen-use-case-in-iframe-d-angular-spa-d86d35d3bce8)

> *Packtpub.com å’Œæˆ‘å‡†å¤‡äº†ä¸€æ•´å¥—* [*RxJS è¯¾ç¨‹*](https://www.packtpub.com/web-development/hands-rxjs-web-development-video) *ï¼Œè¿˜æœ‰è®¸å¤šå…¶ä»–ç»†èŠ‚ï¼Œå‘Šè¯‰ä½ å¦‚ä½•ç”¨è¿™ä¸ªç¥å¥‡çš„åº“è§£å†³ä½ çš„æ—¥å¸¸å¼€å‘ä»»åŠ¡ã€‚å®ƒå¯¹åˆå­¦è€…æ¥è¯´å¯èƒ½å¾ˆæœ‰è¶£ï¼Œä½†ä¹ŸåŒ…å«é«˜çº§ä¸»é¢˜ã€‚çœ‹ä¸€çœ‹ï¼*

*åŸå‘å¸ƒäº*[*https://dev . to*](https://dev.to/oleksandr/rxjs-operators-retry-vs-repeat-5gn)*ã€‚*

*ä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« å—ï¼Ÿ* [***å‘å¾®åš***](https://clicktotweet.com/az3L1) *å…³æ³¨æˆ‘* [***å‘å¾®åš***](https://twitter.com/El_Extremal)*ğŸ¤“*ï¼**