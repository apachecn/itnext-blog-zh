# å‡å°‘æŠ–åŠ¨åº”ç”¨ç¨‹åºçš„å¤§å°

> åŸæ–‡ï¼š<https://itnext.io/reducing-flutter-app-size-570db9810ebb?source=collection_archive---------0----------------------->

![](img/0a9e756f6bb9ed0e02de572575a2ddd8.png)

å‡å°‘æŠ–åŠ¨åº”ç”¨ç¨‹åºçš„å¤§å°

åº”ç”¨ç¨‹åºçš„å¤§å°éå¸¸é‡è¦ã€‚å®ƒæœ‰ä¸¤ä¸ªç»´åº¦:ä¸‹è½½å¤§å° play store ä¸Šåº”ç”¨ç¨‹åºçš„å¤§å°/ä¸‹è½½æ—¶/å®‰è£…æ—¶çš„å¤§å°ï¼Œä»¥åŠå®‰è£…å¤§å°â€”â€”è¿™æ˜¯å½“ä½ ä¸‹è½½åº”ç”¨ç¨‹åºã€è§£å‹ç¼©ã€ç¼–è¯‘å’Œä¼˜åŒ–å®ƒæ—¶ä¼šå‘ç”Ÿçš„äº‹æƒ…ã€‚è¿™å¤§å¤§æ‰©å±•äº†åº”ç”¨ç¨‹åºï¼Œå¯ä»¥æ˜¯å®‰è£…å¤§å°çš„ä¸¤å€ã€ä¸‰å€ç”šè‡³æ›´å¤šã€‚ä½ ä¸ºä»€ä¹ˆè¦å…³å¿ƒè¿™äº›å°ºå¯¸å‘¢ï¼Ÿ

# ä¸‹è½½å¤§å°

å½“ç”¨æˆ·åœ¨ play store ä¸Šå®‰è£…åº”ç”¨ç¨‹åºæ—¶ï¼Œä»–ä¼šçœ‹åˆ°åŠ è½½æ å’Œå®é™…çš„åº”ç”¨ç¨‹åºå¤§å°ã€‚åº”ç”¨ç¨‹åºè¶Šå¤§ï¼Œä¸‹è½½å¤±è´¥/å–æ¶ˆçš„å‡ ç‡å°±è¶Šå¤§ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬å¸Œæœ›è®©åº”ç”¨ç¨‹åºå˜å°ï¼Œè¿™æ ·æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°±èƒ½è·å¾—å°½å¯èƒ½å¤šçš„åˆ†å‘ã€‚

# å®‰è£…å°ºå¯¸

è¿™ä¹Ÿæœ‰ç±»ä¼¼çš„ç°è±¡ã€‚ç”¨æˆ·ç”¨è§†é¢‘ã€éŸ³é¢‘ã€å›¾åƒå¡«å……ä»–ä»¬çš„æ‰‹æœºï¼Œåœ¨æŸä¸ªæ—¶é—´ç‚¹ï¼Œä»–ä»¬ä¼šå°è¯•å®‰è£…ä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åºï¼Œä½†ç³Ÿç³•çš„æ˜¯æ²¡æœ‰ç©ºé—´äº†ğŸ˜ªğŸ˜ªğŸ˜ªã€‚ä»–ä»¬ä¼šå»å¯»æ‰¾ç©ºé—´ï¼Œå»è®¾ç½®ï¼Œæ£€æŸ¥å“ªä¸ªåº”ç”¨ç¨‹åºæ¶ˆè€—æ›´å¤šçš„ç©ºé—´ã€‚å³ä½¿åœ¨è¯•å›¾ä» play store ä¸‹è½½æ—¶ï¼Œå®ƒä¹Ÿå»ºè®®ä»–ä»¬åˆ é™¤ä¸€äº›åº”ç”¨ç¨‹åºä»¥é€‚åº”æ–°çš„åº”ç”¨ç¨‹åºï¼Œç”šè‡³ç»™ä»–ä»¬ä¸€äº›å»ºè®®ã€‚

# æˆ‘ä»¬æ¥åˆ†æä¸€äº› APK

å› æ­¤ï¼Œæˆ‘å°†åˆ†æä¸€ä¸ªå‘å¸ƒåº”ç”¨ç¨‹åºçš„ç­¾å apkã€‚æˆ‘å°†ä½¿ç”¨ ncovid åº”ç”¨ç¨‹åºâ€”â€”ä¸€ä¸ªæ–°å† è‚ºç‚æ–°é—»åº”ç”¨ç¨‹åºï¼Œå¸¦æœ‰ç»Ÿè®¡æ•°æ®å’Œè·Ÿè¸ªä»ªè¡¨æ¿ï¼Œå…¶ GitHub repo å¯ç”¨äº [**è¿™é‡Œ**](https://github.com/Mastersam07/ncovid) ã€‚ä½ å¯ä»¥æŸ¥çœ‹å›è´­åè®®ä¸Šçš„å‘è¡Œæ ‡ç­¾ã€‚æˆ‘ä»¬å°†åœ¨è¿™é‡Œ åˆ†æé¢„å‘å¸ƒç‰ˆæœ¬ 0.8 å¯ç”¨çš„ [**ã€‚**](https://github.com/Mastersam07/ncovid/releases/tag/v0.8)

è®©æˆ‘ä»¬å¯åŠ¨ android studio å¹¶æ‰“å¼€é¡¹ç›®ã€‚åœ¨ android studio ä¸Šæ‰“å¼€é¡¹ç›®ï¼Œç‚¹å‡» Build >> Analyze Apk å¹¶é€‰æ‹© Apkã€‚æˆ‘å°†è¦åˆ†æçš„ apk åœ¨ [**è¿™é‡Œ**](https://github.com/Mastersam07/ncovid/releases/tag/v0.8) å¯ç”¨ã€‚æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªä¸ä¸‹å›¾ç±»ä¼¼çš„å±å¹•ã€‚

![](img/72c7d52461401d6d5db238c875d38873.png)

åˆ†æ Apk

æˆ‘ä»¬å¯ä»¥çœ‹åˆ° 95%çš„åº”ç”¨ç¨‹åºå¤§å°è¢« **lib å ç”¨ã€‚**å±•å¼€ **lib** ï¼Œæˆ‘ä»¬çœ‹åˆ°ä¸‰ä¸ªä¸åŒçš„ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶ã€‚è¿™å‘Šè¯‰æˆ‘ä»¬ä»€ä¹ˆï¼ŸğŸ¤”ğŸ¤”ğŸ¤”â€¦â€¦.ç”¨äºæ„å»ºå‘å¸ƒåº”ç”¨ç¨‹åºçš„å‘½ä»¤åº”è¯¥æ˜¯`flutter build apk --release`ã€‚åˆ†æè¿˜å‘Šè¯‰æˆ‘ä»¬ï¼Œè¯¥åº”ç”¨ç¨‹åºæ˜¯ä¸€ä¸ªèƒ– apkï¼ŒåŒ…æ‹¬ android-armã€android-arm64 å’Œ android-x64 çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

![](img/29710182ae136e644e58abc586ed7e31.png)

åˆ†æ Apk

## è§£å†³ fat apk é—®é¢˜

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬ä¸Šä¼ åˆ° playstoreï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªåº”ç”¨æ†ç»‘åŒ…ï¼Œæˆ–è€…æˆ‘ä»¬å¯ä»¥æŒ‰ç…§ abi æ‹†åˆ† apkï¼Œå°† apk æ‹†åˆ†ä¸º x64 å’Œ x86 ä½ä»£ç ã€‚

ä¸ºäº†æ„å»º app bundleï¼Œæˆ‘ä»¬è¿è¡Œå‘½ä»¤`flutter build appbundle`ï¼Œè¯¥å‘½ä»¤åŒ…å«ä¸º [armeabi-v7a](https://developer.android.com/ndk/guides/abis#v7a) (ARM 32 ä½)ã€ [arm64-v8a](https://developer.android.com/ndk/guides/abis#arm64-v8a) (ARM 64 ä½)å’Œ[x86â€“64](https://developer.android.com/ndk/guides/abis#86-64)(x86 64 ä½)ç¼–è¯‘çš„ flutter è¿è¡Œæ—¶çš„ dart ä»£ç ï¼Œæˆ–è€…æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤`flutter build appbundle --target-platform android-arm,android-arm64,android-x64`æ‹†åˆ† app bundleã€‚

ä¸ºäº†åˆ†å‰² apkï¼Œæˆ‘ä»¬è¿è¡Œå‘½ä»¤`flutter build apk --split-per-abi`ã€‚è¿™å°†æ˜¾è‘—å‡å°åº”ç”¨ç¨‹åºçš„å¤§å°ã€‚æ­¤å¤„ æœ‰ [**çš„æ‹†åˆ† apkã€‚**](https://github.com/Mastersam07/ncovid/releases/tag/v0.9)

# å¤„ç†å›¾åƒèµ„äº§

![](img/e07d05e607d80542ebf1345c6a10a586.png)

åˆ†æèµ„äº§

çœ‹ä¸Šé¢çš„å›¾åƒï¼Œå®ƒè¯´èµ„äº§å ç”¨äº†å¤§çº¦ 439.5kbï¼Œå…¶ä¸­å›¾åƒå  48.7kbï¼Œæ–‡æ¡£å  1.4kbï¼Œå­—ä½“å  61.5kbã€‚è¿™å°±å¼•å‡ºäº†ä¸€ä¸ªé—®é¢˜â€œå¦‚æœä½¿ç”¨äº†åº”ç”¨ç¨‹åºå›¾åƒï¼Œå®ƒä»¬åœ¨å“ªé‡Œï¼Ÿâ€ã€‚

ç­”æ¡ˆå¾ˆç®€å•ã€‚é™¤äº†å°†å›¾åƒèµ„äº§æ†ç»‘åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œç”¨æˆ·å¯ä»¥å°†å›¾åƒæ‰˜ç®¡åœ¨ firebase ç­‰å¤–éƒ¨æœåŠ¡ä¸Šï¼Œå¹¶ä½¿ç”¨åŒ… **cached_network_image åœ¨åº”ç”¨ç¨‹åºä¸­è°ƒç”¨è¿™äº›å›¾åƒã€‚**ç¬¬ä¸€æ¬¡å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶ï¼Œè½¯ä»¶åŒ…ä¼šä»æä¾›çš„ URL è·å–å›¾åƒå¹¶ç¼“å­˜ï¼Œå› æ­¤æ‚¨åœ¨åç»­ä½¿ç”¨åº”ç”¨ç¨‹åºæ—¶ä¼šè·å¾—ç¼“å­˜çš„å›¾åƒï¼Œå› æ­¤è¿™äº›å›¾åƒä¸ä¼šå ç”¨ä¸‹è½½ç©ºé—´ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰æ†ç»‘åœ¨åº”ç”¨ç¨‹åºä¸­ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œ **æŸ¥çœ‹ pub.dev [**ä¸Šçš„åŒ…ã€‚**](https://pub.dev/packages/cached_network_image)**

# å‹ç¼© png å’Œ jpg

æ¯å½“ä½ ä¸å¾—ä¸åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å›¾åƒï¼Œæ¯”å¦‚æ¼«æ¸¸å±å¹•ï¼Œå¹¶ä¸”ä½ ä¸æƒ³ä»å¤–éƒ¨ä¸»æœºè°ƒç”¨å›¾åƒæ—¶ï¼Œä½ åº”è¯¥å‹ç¼©ä½ çš„ png å’Œ jpgï¼Œå› ä¸ºé«˜è´¨é‡çš„ png å’Œ jpg ä¼šå¢åŠ åº”ç”¨ç¨‹åºçš„å¤§å°ã€‚ä½ å¯ä»¥åœ¨è°·æ­Œä¸Šå¿«é€Ÿæœç´¢å‹ç¼© png å’Œ jpg çš„å·¥å…·ã€‚

# ä½¿ç”¨ã€‚svg æ ¼å¼å›¾æ ‡

æˆ‘ä»¬åº”è¯¥å¯¹çŸ¢é‡ç»˜å›¾è¯´æ¬¢è¿ï¼Œå¯¹ png è¯´å†è§ï¼Œå› ä¸ºä½¿ç”¨å®ƒä»¬æœ‰å¾ˆå¤šå¥½å¤„ã€‚äººä»¬ä¸éœ€è¦æ‹…å¿ƒä¸åŒçš„è®¾å¤‡ DPIï¼Œè¿™ä¹Ÿæœ‰åŠ©äºå‡å°‘ apk çš„å¤§å°ã€‚

å½“ä½ ä»è°·æ­Œ[æè´¨è®¾è®¡å›¾æ ‡åº“](https://design.google.com/icons/)ä¸‹è½½ç³»ç»Ÿ app å›¾æ ‡æ—¶ï¼Œä¸‹è½½ã€‚svg æ ¼å¼ï¼Œè€Œä¸æ˜¯ã€‚png

# ä½¿ç”¨ç‰¹å®šçš„åº“

åº”è¯¥é¿å…è°ƒç”¨æˆ‘ä»¬çš„ pubspec.yaml æ–‡ä»¶ä¸­ä¸éœ€è¦æˆ–ä¸ä½¿ç”¨çš„åŒ…ã€‚ä¸€æ—¦æ„å»ºå¥½ä½ çš„åº”ç”¨ç¨‹åºï¼Œä½ åº”è¯¥æ£€æŸ¥ä½ çš„ pubspec.yaml å¹¶åˆ é™¤é‚£äº›æ²¡æœ‰è¢«ä½¿ç”¨çš„åº“/åŒ…ã€‚

# ä½¿ç”¨è°·æ­Œå­—ä½“

å­—ä½“æ˜¯åº”ç”¨ç¨‹åºè†¨èƒ€çš„ä¸€ä¸ªæ¥æºã€‚å®ƒä»¬å¾ˆé‡ï¼Œå¡åœ¨ app é‡Œã€‚å½“ç„¶ï¼Œä½ çš„ UX éœ€è¦å®ƒä»¬ã€‚ä½ å¯èƒ½æƒ³ä½¿ç”¨ google_fonts åŒ…ï¼Œè€Œä¸æ˜¯åœ¨åº”ç”¨ç¨‹åºä¸­æ†ç»‘å­—ä½“ã€‚ä½¿ç”¨`google_fonts`åŒ…ï¼Œ`.ttf`æˆ–`.otf`æ–‡ä»¶ä¸éœ€è¦å­˜å‚¨åœ¨ assets æ–‡ä»¶å¤¹ä¸­ï¼Œä¹Ÿä¸éœ€è¦æ˜ å°„åˆ° pubspec.yaml æ–‡ä»¶ä¸­ã€‚ç›¸åï¼Œå®ƒä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡ HTTP è·å–ä¸€æ¬¡ï¼Œå¹¶ç¼“å­˜åœ¨åº”ç”¨ç¨‹åºçš„æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚è¿™ç±»ä¼¼äºåŸç”Ÿ android å¼€å‘ä¸­çš„å¯ä¸‹è½½å­—ä½“ã€‚å¯ä»¥åœ¨ è¿™é‡ŒæŸ¥çœ‹ pub.dev [**ä¸Šçš„åŒ…ã€‚**](https://pub.dev/packages/google_fonts)

# ä½¿ç”¨ Proguard

Proguard æ˜¯ä¸€ä¸ª java ç¨‹åºä¼˜åŒ–å™¨ã€‚å®ƒä»¥ä¸æ”¹å˜åŠŸèƒ½çš„æ–¹å¼ä¼˜åŒ–æ‚¨çš„ä»£ç ï¼Œä½†æ˜¯æ”¹å˜è¡¨ç¤ºä½¿å®ƒæ›´ç´§å‡‘ã€‚å®ƒæ··æ·†äº†ç±»å‹ã€å­—æ®µã€æ–¹æ³•çš„åç§°ï¼Œå…¶ä¸­åŸå§‹åç§°å¹¶ä¸é‡è¦ï¼Œå› æ­¤ä¸ºäº†æé«˜æ•ˆç‡ï¼Œé•¿åç§°è¢«æ›¿æ¢ä¸ºçŸ­å­—ç¬¦ä¸²ï¼Œå¦‚ a å’Œ bã€‚åŒ…å’Œç±»å¯èƒ½æœ‰ä¸€ä¸ªå¾ˆé•¿çš„åå­—ï¼Œä½†æ˜¯ä¸åº”è¯¥å¦¨ç¢æ•ˆç‡ã€‚å®ƒè¿˜ä»ä¾èµ–é¡¹ä¸­åˆ é™¤äº†æœªä½¿ç”¨çš„ java ä»£ç ã€‚è¦è®¾ç½® proguardï¼Œè¯·ç¡®ä¿æ‚¨çš„ <app dir="">/android/app/build.gradle ä¸­çš„æ„å»ºç±»å‹å¦‚ä¸‹æ‰€ç¤º:</app>

```
buildTypes {
        release {
            minifyEnabled true // add this
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro' // add this
            signingConfig signingConfigs.release // this is default for release
        }
    }
```

åœ¨åŒä¸€ä¸ªç›®å½•ä¸­ï¼Œåˆ›å»º proguard-rules.pro æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ä»£ç :

```
## Flutter wrapper
 -keep class io.flutter.app.** { *; }
 -keep class io.flutter.plugin.** { *; }
 -keep class io.flutter.util.** { *; }
 -keep class io.flutter.view.** { *; }
 -keep class io.flutter.** { *; }
 -keep class io.flutter.plugins.** { *; }
# -keep class com.google.firebase.** { *; } // uncomment this if you are using firebase in the project
 -dontwarn io.flutter.embedding.**
 -ignorewarnings
```

æ‚¨è¿˜åº”è¯¥è½¬åˆ° gradle.propertiesï¼Œå¹¶å°†ä¸‹é¢çš„ä»£ç ç‰‡æ®µæ·»åŠ åˆ°å…¶ä¸­:

```
extra-gen-snapshot-options=--obfuscate
```

# èµ„æºèç¼©

è¿™å°† proguard çš„æ­»ä»£ç æ¶ˆé™¤çš„æ¦‚å¿µæ‰©å±•åˆ°äº†èµ„æºã€‚åœ¨ <app dir="">/android/app ç›®å½•ä¸‹çš„ build.gradle æ–‡ä»¶ä¸­ï¼Œæ‚¨çš„æ„å»ºç±»å‹åº”è¯¥æ˜¯è¿™æ ·çš„:</app>

```
buildTypes {
        release {
            minifyEnabled true // added previously
            shrinkResources true // add this
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro' // added previously
            signingConfig signingConfigs.release // added previously
        }
    }
```

è¿™å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ğŸ™‚ğŸ™‚ğŸ™‚ã€‚åœ¨æ‰€æœ‰è¿™äº›è°ƒæ•´å’Œé…ç½®ä¹‹åï¼Œæ‚¨åº”è¯¥è¿è¡Œâ€œ**è§£å†³ fat apk é—®é¢˜**â€ä¸­æåˆ°çš„å‘å¸ƒå‘½ä»¤ã€‚å¦‚æœæ‚¨æ‰“ç®—å‘é€åˆ° playstore æˆ–åœ¨å¿…è¦æ—¶æ‹†åˆ† apkï¼Œè¯·ç”Ÿæˆä¸€ä¸ªåº”ç”¨æ†ç»‘åŒ…ã€‚

å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·éšæ—¶å‘è¡¨è¯„è®ºğŸ™‚ã€‚

# æœ‰ç›Šé“¾æ¥

[æ„å»ºå¹¶å‘å¸ƒä¸€æ¬¾ android åº”ç”¨](https://flutter.dev/docs/deployment/android)
[æµ‹é‡ä½ çš„åº”ç”¨å¤§å°](https://flutter.dev/docs/perf/app-size)
[æ··æ·†é£é•–ä»£ç ](https://flutter.dev/docs/deployment/obfuscate)
[ç²¾ç®€ä½ çš„åº”ç”¨å¤§å°çš„æœ€ä½³å®è·µ(Google I/Oâ€™17)](https://www.youtube.com/watch?v=AdfKNgyT438)