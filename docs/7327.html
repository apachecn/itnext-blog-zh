<html>
<head>
<title>ASP.NET Custom Metrics with OpenTelemetry Collector &amp; Prometheus/Grafana</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨open telemetry Collector &amp; Prometheus/Grafanaçš„ASP.NETå®šåˆ¶æŒ‡æ ‡</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/asp-net-custom-metrics-with-opentelemetry-collector-prometheus-grafana-4b39b4a2b754?source=collection_archive---------2-----------------------#2022-08-22">https://itnext.io/asp-net-custom-metrics-with-opentelemetry-collector-prometheus-grafana-4b39b4a2b754?source=collection_archive---------2-----------------------#2022-08-22</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><p id="6c41" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">ä¸æ—¶æœ‰äººé—®æˆ‘ï¼Œåœ¨ç°ä»£åº”ç”¨ç¨‹åºä¸­åº”è¯¥ä½¿ç”¨å“ªç§è·Ÿè¸ªã€æ—¥å¿—è®°å½•æˆ–ç›‘æ§è§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºå¯èƒ½æ€§è¶Šæ¥è¶Šå¤§â€”â€”è‡³å°‘ï¼Œä½ å¯èƒ½ä¼šæœ‰è¿™ç§æ„Ÿè§‰ã€‚ä¸ºäº†å°½å¯èƒ½çµæ´»å’Œä¾èµ–å¼€æ”¾æ ‡å‡†ï¼Œå»ºè®®æ›´ä»”ç»†åœ°ç ”ç©¶OpenTelemetryã€‚å®ƒå˜å¾—è¶Šæ¥è¶Šå—æ¬¢è¿ï¼Œå› ä¸ºå®ƒæä¾›äº†ä¸€ä¸ªç‹¬ç«‹äºä¾›åº”å•†çš„è§£å†³æ–¹æ¡ˆï¼Œåœ¨æ‚¨çš„æœåŠ¡ä¸­å¤„ç†é¥æµ‹æ•°æ®ï¼Œå¹¶å°†å®ƒä»¬å‘é€åˆ°æ‚¨é€‰æ‹©çš„åç«¯(Prometheusã€Jaegerç­‰)ã€‚).è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨spaceæœåŠ¡ä¸­ä½¿ç”¨OpenTelemetryè‡ªå®šä¹‰æŒ‡æ ‡ï¼Œå¹¶ç»“åˆäº‘æœ¬åœ°ç©ºé—´ä¸­å¯èƒ½æœ€æµè¡Œçš„ç›‘æ§å †æ ˆ:Prometheus / Grafanaã€‚</p><h1 id="13d1" class="km kn ir bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">TLï¼›é€Ÿåº¦ä¸‰è§’å½¢å®šä½æ³•(dead reckoning)</h1><p id="364c" class="pw-post-body-paragraph jo jp ir jq b jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh lo kj kk kl ik bi translated">ä½ å¯ä»¥åœ¨<a class="ae lp" href="https://github.com/cdennig/otel-demo" rel="noopener ugc nofollow" target="_blank"> GitHub </a>ä¸Šæ‰¾åˆ°æ¼”ç¤ºé¡¹ç›®ã€‚å®ƒä½¿ç”¨ä¸€ä¸ªæœ¬åœ°Kubernetesé›†ç¾¤(<a class="ae lp" href="https://kind.sigs.k8s.io/" rel="noopener ugc nofollow" target="_blank">ç±»</a>)æ¥è®¾ç½®ç¯å¢ƒï¼Œå¹¶éƒ¨ç½²ä¸€ä¸ªç”Ÿæˆä¸€äº›æ ·æœ¬æŒ‡æ ‡çš„æ¼”ç¤ºåº”ç”¨ç¨‹åºã€‚è¿™äº›æŒ‡æ ‡è¢«å‘é€åˆ°ä½œä¸ºPrometheusæŒ‡æ ‡ç«¯ç‚¹çš„OTELæ”¶é›†å™¨ã€‚æœ€åï¼Œè¿™äº›æŒ‡æ ‡ç”±Prometheusæ”¶é›†å¹¶æ˜¾ç¤ºåœ¨Grafanaä»ªè¡¨æ¿/å›¾è¡¨ä¸­ã€‚</p><figure class="lr ls lt lu gu lv gi gj paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gi gj lq"><img src="../Images/6c7508d84edea6d9dadb1b31165ee936.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BhgK72KWRfPP9Y_6"/></div></div><figcaption class="mc md gk gi gj me mf bd b be z dk translated">æ¼”ç¤ºè®¾ç½®</figcaption></figure><h1 id="8b8f" class="km kn ir bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">OpenTelemetry â€”å®ƒæ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆæ‚¨åº”è¯¥å…³æ³¨å®ƒï¼Ÿ</h1><figure class="lr ls lt lu gu lv gi gj paragraph-image"><div class="gi gj mg"><img src="../Images/d7fd5e26f92e9a08834dc87279822b57.png" data-original-src="https://miro.medium.com/v2/resize:fit:560/0*QdxBaEdvchXemVeP"/></div><figcaption class="mc md gk gi gj me mf bd b be z dk translated">å¼€æ”¾å¼é¥æµ‹</figcaption></figure><p id="a0c7" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">OpenTelemetry (OTEL)æ˜¯ä¸€ä¸ªå¼€æºçš„CNCFé¡¹ç›®ï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªç‹¬ç«‹äºä¾›åº”å•†çš„è§£å†³æ–¹æ¡ˆï¼Œç”¨äºç”Ÿæˆã€æ”¶é›†å’Œå¤„ç†åŸºç¡€è®¾æ–½å’ŒæœåŠ¡çš„é¥æµ‹æ•°æ®ã€‚å®ƒèƒ½å¤Ÿæ¥æ”¶ã€å¤„ç†å’Œå¯¼å‡ºè·Ÿè¸ªã€æ—¥å¿—å’ŒæŒ‡æ ‡åˆ°ä¸åŒçš„åç«¯ï¼Œå¦‚<a class="ae lp" href="https://prometheus.io/" rel="noopener ugc nofollow" target="_blank">æ™®ç½—ç±³ä¿®æ–¯</a>ã€<a class="ae lp" href="https://www.jaegertracing.io/" rel="noopener ugc nofollow" target="_blank">ç§¯å®¶</a>æˆ–å…¶ä»–å•†ä¸šSaaSäº§å“ï¼Œè€Œä¸éœ€è¦æ‚¨çš„åº”ç”¨ç¨‹åºä¾èµ–è¿™äº›è§£å†³æ–¹æ¡ˆã€‚è™½ç„¶OTELæœ¬èº«ä¸æä¾›åç«¯ç”šè‡³åˆ†æèƒ½åŠ›ï¼Œä½†å®ƒå……å½“äº†â€œä¸­å¤®ç›‘æ§ç»„ä»¶â€ï¼ŒçŸ¥é“å¦‚ä½•é€šè¿‡ä½¿ç”¨æ‰€è°“çš„â€œå¯¼å‡ºå™¨â€å°†æ”¶åˆ°çš„æ•°æ®å‘é€åˆ°ä¸åŒçš„åç«¯ã€‚</p><p id="aed1" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">æ‰€ä»¥ä½ ä¸ºä»€ä¹ˆè¦åœ¨ä¹å‘¢ï¼Ÿåœ¨å½“ä»Šçš„åˆ†å¸ƒå¼ç³»ç»Ÿå’Œå¾®æœåŠ¡æ¶æ„ä¸–ç•Œä¸­ï¼Œå¼€å‘äººå‘˜å¯ä»¥æ›´å¿«ã€æ›´ç‹¬ç«‹åœ°å‘å¸ƒè½¯ä»¶å’ŒæœåŠ¡ï¼Œå¯è§‚å¯Ÿæ€§æˆä¸ºæ‚¨ç¯å¢ƒä¸­æœ€é‡è¦çš„ç‰¹æ€§ä¹‹ä¸€ã€‚ç³»ç»Ÿçš„å¯è§æ€§å¯¹äºåº”ç”¨ç¨‹åºçš„æˆåŠŸè‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒæœ‰åŠ©äºæ‚¨æ‰©å±•ç»„ä»¶ã€å‘ç°é”™è¯¯å’Œé”™è¯¯é…ç½®ç­‰ã€‚</p><p id="7e0e" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">å¦‚æœæ‚¨è¿˜æ²¡æœ‰å†³å®šåœ¨ä¸‹ä¸€ä¸ªåº”ç”¨ä¸­ä½¿ç”¨ä»€ä¹ˆæ ·çš„ç›‘æ§æˆ–è·Ÿè¸ªè§£å†³æ–¹æ¡ˆï¼Œè¯·æŸ¥çœ‹OpenTelemetryã€‚å®ƒè®©æ‚¨å¯ä»¥è‡ªç”±å°è¯•ä¸åŒçš„ç›‘æ§è§£å†³æ–¹æ¡ˆï¼Œç”šè‡³åœ¨ç”Ÿäº§åæœŸæ›¿æ¢æ‚¨å–œæ¬¢çš„æ–¹æ¡ˆã€‚</p><h1 id="39d1" class="km kn ir bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">æ‰“å¼€é¥æµ‹ç»„ä»¶</h1><p id="1a03" class="pw-post-body-paragraph jo jp ir jq b jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh lo kj kk kl ik bi translated">OpenTelemetryç›®å‰ç”±å‡ ä¸ªç»„ä»¶ç»„æˆï¼Œå¦‚ç”¨äºæ¥æ”¶ã€å¤„ç†/è½¬æ¢å’Œå¯¼å‡ºé¥æµ‹æ•°æ®çš„ä»ªå™¨å’Œå·¥å…·çš„<a class="ae lp" href="https://opentelemetry.io/docs/reference/specification/" rel="noopener ugc nofollow" target="_blank">è·¨è¯­è¨€è§„èŒƒ</a>(API/SDKå’ŒOpenTelemetryåè®®OTLP)ã€‚SDKæœ‰å‡ ç§æµè¡Œçš„è¯­è¨€ç‰ˆæœ¬ï¼Œå¦‚Javaã€C++ã€C#ã€Goç­‰ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æ”¯æŒè¯­è¨€çš„å®Œæ•´åˆ—è¡¨<a class="ae lp" href="https://opentelemetry.io/docs/instrumentation/" rel="noopener ugc nofollow" target="_blank">ã€‚</a></p><p id="f6c6" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªåä¸ºâ€œOpenTelemetry Collectorâ€çš„ç»„ä»¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹äºä¾›åº”å•†çš„ä»£ç†ï¼Œå¯ä»¥ä»ä¸åŒçš„æ¥æºæ¥æ”¶é¥æµ‹æ•°æ®ï¼Œå¹¶åœ¨å°†æ•°æ®å‘é€åˆ°æ‰€éœ€çš„åç«¯è§£å†³æ–¹æ¡ˆä¹‹å‰å¯¹å…¶è¿›è¡Œè½¬æ¢ã€‚</p><p id="ca60" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">è®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹æ”¶é›†å™¨â€¦â€¦<em class="mh">æ¥æ”¶å™¨ã€å¤„ç†å™¨</em>å’Œ<em class="mh">è¾“å‡ºå™¨</em>çš„ç»„ä»¶:</p><ul class=""><li id="4b35" class="mi mj ir jq b jr js jv jw jz mk kd ml kh mm kl mn mo mp mq bi translated"><em class="mh">æ¥æ”¶å™¨</em>â€”open telemetryä¸­çš„æ¥æ”¶å™¨æ˜¯è´Ÿè´£å°†æ•°æ®é€å…¥æ”¶é›†å™¨çš„ç»„ä»¶ã€‚å®ƒå¯ä»¥ç”¨äºåŸºäºæ¨æˆ–æ‹‰çš„æ–¹æ³•ã€‚å®ƒå¯ä»¥æ”¯æŒOLTPåè®®ï¼Œç”šè‡³å¯ä»¥æŠ“å–Prometheus /metricsç«¯ç‚¹</li><li id="3117" class="mi mj ir jq b jr mr jv ms jz mt kd mu kh mv kl mn mo mp mq bi translated"><em class="mh">å¤„ç†å™¨</em> â€”å¤„ç†å™¨æ˜¯ä¸€ç§ç»„ä»¶ï¼Œåœ¨å°†é‡‡é›†å™¨æ¥æ”¶çš„é¥æµ‹æ•°æ®ç§»äº¤ç»™<em class="mh">å¯¼å‡ºå™¨</em>ä¹‹å‰ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œæ‰¹å¤„ç†ã€é‡‡æ ·ã€è½¬æ¢å’Œ/æˆ–ä¸°å¯Œã€‚æ‚¨å¯ä»¥æ·»åŠ æˆ–åˆ é™¤å±æ€§ï¼Œä¾‹å¦‚â€œä¸ªäººèº«ä»½ä¿¡æ¯â€(PII)ï¼Œæˆ–è€…åŸºäºæ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤æ•°æ®ã€‚å¤„ç†å™¨æ˜¯æ”¶é›†å™¨ç®¡é“ä¸­çš„å¯é€‰ç»„ä»¶ã€‚</li><li id="3588" class="mi mj ir jq b jr mr jv ms jz mt kd mu kh mv kl mn mo mp mq bi translated"><em class="mh">å¯¼å‡ºå™¨</em> â€”å¯¼å‡ºå™¨è´Ÿè´£å°†æ•°æ®å‘é€åˆ°åç«¯è§£å†³æ–¹æ¡ˆï¼Œå¦‚Prometheusã€Azure Monitorã€DataDogã€Splunkç­‰ã€‚</li></ul><p id="f151" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">æœ€ç»ˆï¼Œå®ƒå½’ç»“ä¸ºé…ç½®å¸¦æœ‰æ¥æ”¶è€…ã€(å¯é€‰çš„)å¤„ç†å™¨å’Œå¯¼å‡ºè€…çš„æ”¶é›†å™¨æœåŠ¡ï¼Œä»¥å½¢æˆä¸€ä¸ªåŠŸèƒ½é½å…¨çš„æ”¶é›†å™¨ç®¡é“â€”â€”å®˜æ–¹æ–‡æ¡£å¯ä»¥åœ¨<a class="ae lp" href="https://opentelemetry.io/docs/collector/configuration/" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚æ­¤å¤„æ¼”ç¤ºçš„é…ç½®å¦‚ä¸‹:</p><pre class="lr ls lt lu gu mw mx my mz aw na bi"><span id="ce79" class="nb kn ir mx b gz nc nd l ne nf">receivers:<br/>  otlp:<br/>    protocols:<br/>      http:<br/>      grpc:<br/>processors:<br/>  batch:<br/>exporters:<br/>  logging:<br/>    loglevel: debug<br/>  prometheus:<br/>    endpoint: "0.0.0.0:8889"<br/>service:<br/>  pipelines:<br/>    metrics:<br/>      receivers: [otlp]<br/>      processors: [batch]<br/>      exporters: [logging, prometheus]</span></pre><p id="bab5" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">è¯¥é…ç½®åŒ…æ‹¬:</p><ul class=""><li id="d787" class="mi mj ir jq b jr js jv jw jz mk kd ml kh mm kl mn mo mp mq bi translated">ä¸€ä¸ªå¼€æ”¾å¼é¥æµ‹åè®®(OTLP)æ¥æ”¶å™¨ï¼Œç”¨äº<em class="mh"> http </em>å’Œ<em class="mh"> gRPC </em>é€šä¿¡</li><li id="d4cc" class="mi mj ir jq b jr mr jv ms jz mt kd mu kh mv kl mn mo mp mq bi translated">ä¸€ä¸ªå¤„ç†å™¨ï¼Œç”¨é»˜è®¤å€¼(ä¾‹å¦‚200æ¯«ç§’çš„<code class="fe ng nh ni mx b">timeout</code>)æ‰¹é‡å¤„ç†é¥æµ‹æ•°æ®</li><li id="0714" class="mi mj ir jq b jr mr jv ms jz mt kd mu kh mv kl mn mo mp mq bi translated">ä¸¤ä¸ªå¯¼å‡ºå™¨å°†æ•°æ®ä¼ è¾“åˆ°æ§åˆ¶å°(<code class="fe ng nh ni mx b">logging</code>)ï¼Œå¹¶åœ¨<code class="fe ng nh ni mx b">0.0.0.0:8889</code>ä¸Šæš´éœ²ä¸€ä¸ªæ™®ç½—ç±³ä¿®æ–¯<code class="fe ng nh ni mx b">/metrics</code>ç«¯ç‚¹(è¿œç¨‹å†™å…¥ä¹Ÿæ˜¯å¯èƒ½çš„)</li></ul><h1 id="d9a5" class="km kn ir bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">ASPã€‚ç½‘ç»œå¼€æ”¾é¥æµ‹</h1><p id="736c" class="pw-post-body-paragraph jo jp ir jq b jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh lo kj kk kl ik bi translated">ä¸ºäº†æ¼”ç¤ºå¦‚ä½•é€šè¿‡OpenTelemetryå°†è‡ªå®šä¹‰æŒ‡æ ‡ä»ASP.NETåº”ç”¨ç¨‹åºå‘é€åˆ°Prometheusï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ä¸€ä¸ªå…¬å¼€è¿™äº›æŒ‡æ ‡çš„æœåŠ¡ã€‚åœ¨è¿™ä¸ªæ¼”ç¤ºä¸­ï¼Œæˆ‘ä»¬ç®€å•åœ°åˆ›å»ºäº†ä¸¤ä¸ªè‡ªå®šä¹‰æŒ‡æ ‡<code class="fe ng nh ni mx b">otel.demo.metric.gauge1</code>å’Œ<code class="fe ng nh ni mx b">otel.demo.metric.gauge2</code>ï¼Œå®ƒä»¬å°†è¢«å‘é€åˆ°æ§åˆ¶å°(<code class="fe ng nh ni mx b">AddConsoleExporter()</code>)å¹¶é€šè¿‡OTLPåè®®å‘é€åˆ°ä¸€ä¸ªæ”¶é›†æœåŠ¡ç¨‹åº(<code class="fe ng nh ni mx b">AddOtlpExporter()</code>)ï¼Œæˆ‘ä»¬å°†åœ¨åé¢ä»‹ç»è¿™ä¸ªæ”¶é›†æœåŠ¡ç¨‹åºã€‚è¯¥åº”ç”¨ç¨‹åºä½¿ç”¨ASP.NETæœ€å°APIï¼Œä»£ç æˆ–å¤šæˆ–å°‘æ˜¯ä¸è¨€è‡ªæ˜çš„:</p><pre class="lr ls lt lu gu mw mx my mz aw na bi"><span id="17cd" class="nb kn ir mx b gz nc nd l ne nf">using System.Diagnostics.Metrics;<br/>using OpenTelemetry.Resources;<br/>using OpenTelemetry.Metrics;<br/> <br/>var builder = WebApplication.CreateBuilder(args);<br/> <br/>builder.Services.AddOpenTelemetryMetrics(metricsProvider =&gt;<br/>{<br/>    metricsProvider<br/>        .AddConsoleExporter()<br/>        .AddOtlpExporter()<br/>        .AddMeter("otel.demo.metric")<br/>        .SetResourceBuilder(ResourceBuilder.CreateDefault()<br/>            .AddService(serviceName: "otel.demo", serviceVersion: "0.0.1")<br/>        );<br/>});<br/> <br/>var app = builder.Build();<br/>var otel_metric = new Meter("otel.demo.metric", "0.0.1");<br/>var randomNum = new Random();<br/>// Create two metrics<br/>var obs_gauge1 = otel_metric.CreateObservableGauge&lt;int&gt;("otel.demo.metric.gauge1", () =&gt;<br/>{<br/>    return randomNum.Next(10, 80);<br/>});<br/>var obs_gauge2 = otel_metric.CreateObservableGauge&lt;double&gt;("otel.demo.metric.gauge2", () =&gt;<br/>{<br/>    return randomNum.NextDouble();<br/>});<br/> <br/>app.MapGet("/otelmetric", () =&gt;<br/>{<br/>    return "Hello, Otel-Metric!";<br/>});<br/> <br/>app.Run();</span></pre><p id="b48f" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">æˆ‘ä»¬ç›®å‰æ­£åœ¨å¤„ç†è‡ªå®šä¹‰æŒ‡æ ‡ã€‚å½“ç„¶ï¼ŒASP.NETä¹Ÿæä¾›äº†ç°æˆçš„æŒ‡æ ‡ä¾›æ‚¨ä½¿ç”¨ã€‚åœ¨é…ç½®æŒ‡æ ‡æä¾›è€…æ—¶ï¼Œåªéœ€é€šè¿‡æ·»åŠ <code class="fe ng nh ni mx b">AddAspNetCoreInstrumentation<strong class="jq is">()</strong></code>æ¥ä½¿ç”¨ASP.NETå·¥å…·ç‰¹æ€§â€”â€”æ›´å¤šä¿¡æ¯è¯·ç‚¹å‡»<a class="ae lp" href="https://github.com/open-telemetry/opentelemetry-dotnet-instrumentation" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a>ã€‚</p><h1 id="8d12" class="km kn ir bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">æ¼”ç¤º</h1><p id="3a52" class="pw-post-body-paragraph jo jp ir jq b jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh lo kj kk kl ik bi translated">æ˜¯æ—¶å€™æŠŠäº‹æƒ…è”ç³»èµ·æ¥äº†ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä½¿ç”¨åˆ›å»ºä¸€ä¸ªKubernetesé›†ç¾¤ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥å‘å¸ƒæ¼”ç¤ºæœåŠ¡ï¼Œå¯åŠ¨OTELæ”¶é›†å™¨å®ä¾‹å¹¶è¿è¡Œä¸€ä¸ªPrometheus/Grafanaç¯å¢ƒã€‚å¦‚æœä½ æƒ³è·Ÿéšæ•™ç¨‹ï¼Œä»<a class="ae lp" href="https://github.com/cdennig/otel-demo" rel="noopener ugc nofollow" target="_blank">https://github.com/cdennig/otel-demo</a>å…‹éš†å›è´­ï¼Œå¹¶åˆ‡æ¢åˆ°<code class="fe ng nh ni mx b">otel-demo</code>ç›®å½•ã€‚</p><h1 id="258f" class="km kn ir bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">åˆ›å»ºä¸€ä¸ªæœ¬åœ°Kubernetesé›†ç¾¤</h1><p id="2c4b" class="pw-post-body-paragraph jo jp ir jq b jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh lo kj kk kl ik bi translated">è¦åˆ›å»ºä¸€ä¸ªèƒ½å¤Ÿæ‰˜ç®¡Prometheusç¯å¢ƒçš„<code class="fe ng nh ni mx b">kind</code>é›†ç¾¤ï¼Œè¯·æ‰§è¡Œ:</p><pre class="lr ls lt lu gu mw mx my mz aw na bi"><span id="9c24" class="nb kn ir mx b gz nc nd l ne nf">$ kind create cluster --name demo-cluster \ <br/>     --config ./kind/kind-cluster.yaml</span></pre><p id="6226" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">YAMLé…ç½®æ–‡ä»¶(<code class="fe ng nh ni mx b">./kind/kind-cluster.yaml</code>)è°ƒæ•´Kubernetesæ§åˆ¶å¹³é¢çš„ä¸€äº›è®¾ç½®ï¼Œä»¥ä¾¿Prometheusèƒ½å¤ŸæŠ“å–æ§åˆ¶å™¨æœåŠ¡çš„ç«¯ç‚¹ã€‚æ¥ä¸‹æ¥ï¼Œåˆ›å»ºOpenTelemetryæ”¶é›†å™¨å®ä¾‹ã€‚</p><h1 id="5549" class="km kn ir bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">OTELæ”¶è—å®¶</h1><p id="54fb" class="pw-post-body-paragraph jo jp ir jq b jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh lo kj kk kl ik bi translated">åœ¨<code class="fe ng nh ni mx b">manifests</code>ç›®å½•ä¸­ï¼Œæ‚¨ä¼šå‘ç°ä¸¤ä¸ªKubernetesæ¸…å•ã€‚ä¸€ä¸ªåŒ…å«æ”¶é›†å™¨çš„é…ç½®(<code class="fe ng nh ni mx b">otel-collector.yaml</code>)ã€‚å®ƒåŒ…æ‹¬æ”¶é›†å™¨é…ç½®çš„<code class="fe ng nh ni mx b">ConfigMap</code>(å®ƒå°†ä½œä¸ºä¸€ä¸ªå·å®‰è£…åˆ°æ”¶é›†å™¨å®¹å™¨ä¸­)ï¼Œæ”¶é›†å™¨æœ¬èº«çš„éƒ¨ç½²å’Œä¸€ä¸ªå…¬å¼€æ•°æ®æ¥æ”¶ç«¯å£çš„æœåŠ¡(<code class="fe ng nh ni mx b">4318</code>ç”¨äº<code class="fe ng nh ni mx b">http</code>å’Œ<code class="fe ng nh ni mx b">4317</code>ç”¨äº<code class="fe ng nh ni mx b">gRPC</code>)ä»¥åŠç¨åå°†ç”±Prometheusæ”¶é›†çš„æŒ‡æ ‡ç«¯ç‚¹(<code class="fe ng nh ni mx b">8889</code>)ã€‚å®ƒçœ‹èµ·æ¥å¦‚ä¸‹:</p><pre class="lr ls lt lu gu mw mx my mz aw na bi"><span id="68d0" class="nb kn ir mx b gz nc nd l ne nf">apiVersion: v1<br/> <br/>kind: ConfigMap<br/>metadata:<br/>  name: otel-collector-config<br/>data:<br/>  otel-collector-config: |-<br/>    receivers:<br/>      otlp:<br/>        protocols:<br/>          http:<br/>          grpc:<br/>    exporters:<br/>      logging:<br/>        loglevel: debug<br/>      prometheus:<br/>        endpoint: "0.0.0.0:8889"<br/>    processors:<br/>      batch:<br/>    service:<br/>      pipelines:<br/>        metrics:<br/>          receivers: [otlp]<br/>          processors: [batch]<br/>          exporters: [logging, prometheus]<br/>---<br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: otel-collector<br/>  labels:<br/>    app: otel-collector<br/>spec:<br/>  replicas: 1<br/>  selector:<br/>    matchLabels:<br/>      app: otel-collector<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: otel-collector<br/>    spec:<br/>      containers:<br/>        - name: collector<br/>          image: otel/opentelemetry-collector:latest<br/>          args:<br/>            - --config=/etc/otelconf/otel-collector-config.yaml<br/>          ports:<br/>            - name: otel-http<br/>              containerPort: 4318<br/>            - name: otel-grpc<br/>              containerPort: 4317<br/>            - name: prom-metrics<br/>              containerPort: 8889<br/>          volumeMounts:<br/>            - name: otel-config<br/>              mountPath: /etc/otelconf<br/>      volumes:<br/>        - name: otel-config<br/>          configMap:<br/>            name: otel-collector-config<br/>            items:<br/>              - key: otel-collector-config<br/>                path: otel-collector-config.yaml<br/>---<br/>apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: otel-collector<br/>  labels:<br/>    app: otel-collector<br/>spec:<br/>  type: ClusterIP<br/>  ports:<br/>    - name: otel-http<br/>      port: 4318<br/>      protocol: TCP<br/>      targetPort: 4318<br/>    - name: otel-grpc<br/>      port: 4317<br/>      protocol: TCP<br/>      targetPort: 4317<br/>    - name: prom-metrics<br/>      port: 8889<br/>      protocol: TCP<br/>      targetPort: prom-metrics<br/>  selector:<br/>    app: otel-collector</span></pre><p id="f4c3" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">è®©æˆ‘ä»¬åº”ç”¨æ¸…å•ã€‚</p><pre class="lr ls lt lu gu mw mx my mz aw na bi"><span id="4424" class="nb kn ir mx b gz nc nd l ne nf">$ kubectl apply -f ./manifests/otel-collector.yaml<br/> <br/>configmap/otel-collector-config created<br/>deployment.apps/otel-collector created<br/>service/otel-collector created</span></pre><p id="2c0a" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">æ£€æŸ¥ä¸€åˆ‡æ˜¯å¦æŒ‰é¢„æœŸè¿è¡Œ:</p><pre class="lr ls lt lu gu mw mx my mz aw na bi"><span id="b212" class="nb kn ir mx b gz nc nd l ne nf">$ kubectl get pods,deployments,services,endpoints<br/> <br/>NAME                                  READY   STATUS    RESTARTS   AGE<br/>pod/otel-collector-5cd54c49b4-gdk9f   1/1     Running   0          5m13s<br/> <br/>NAME                             READY   UP-TO-DATE   AVAILABLE   AGE<br/>deployment.apps/otel-collector   1/1     1            1           5m13s<br/> <br/>NAME                     TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                      AGE<br/>service/kubernetes       ClusterIP   10.96.0.1      &lt;none&gt;        443/TCP                      22m<br/>service/otel-collector   ClusterIP   10.96.194.28   &lt;none&gt;        4318/TCP,4317/TCP,8889/TCP   5m13s<br/> <br/>NAME                       ENDPOINTS                                         AGE<br/>endpoints/kubernetes       172.19.0.9:6443                                   22m<br/>endpoints/otel-collector   10.244.1.2:8889,10.244.1.2:4318,10.244.1.2:4317   5m13s</span></pre><p id="f729" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">æ—¢ç„¶OpenTelemetryåŸºç¡€è®¾æ–½å·²ç»å°±ç»ªï¼Œè®©æˆ‘ä»¬æ·»åŠ æš´éœ²å®šåˆ¶æŒ‡æ ‡çš„å·¥ä½œè´Ÿè½½ã€‚</p><h1 id="5b15" class="km kn ir bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">ASPã€‚å‡€å·¥ä½œé‡</h1><p id="5e72" class="pw-post-body-paragraph jo jp ir jq b jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh lo kj kk kl ik bi translated">ä¸ºäº†æ‚¨çš„æ–¹ä¾¿ï¼Œæ¼”ç¤ºåº”ç”¨ç¨‹åºå·²ç»è¢«å®¹å™¨åŒ–å¹¶å‘å¸ƒåˆ°GitHubå®¹å™¨æ³¨å†Œä¸­å¿ƒã€‚å› æ­¤ï¼Œè¦å‘é›†ç¾¤æ·»åŠ å·¥ä½œè´Ÿè½½ï¼Œåªéœ€åº”ç”¨åŒ…å«<code class="fe ng nh ni mx b">Deployment</code>æ¸…å•çš„<code class="fe ng nh ni mx b">./manifests/otel-demo-workload.yaml</code>ï¼Œå¹¶æ·»åŠ ä¸¤ä¸ªç¯å¢ƒå˜é‡æ¥é…ç½®OTELæ”¶é›†å™¨ç«¯ç‚¹å’Œè¦ä½¿ç”¨çš„OTLPåè®®â€”â€”åœ¨æœ¬ä¾‹ä¸­æ˜¯<code class="fe ng nh ni mx b">gRPC</code>ã€‚</p><p id="d4e2" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">ç›¸å…³éƒ¨åˆ†å¦‚ä¸‹:</p><pre class="lr ls lt lu gu mw mx my mz aw na bi"><span id="096d" class="nb kn ir mx b gz nc nd l ne nf">spec:<br/>  containers:<br/>  - image: ghcr.io/cdennig/otel-demo:1.0<br/>    name: otel-demo<br/>    env:<br/>    - name: OTEL_EXPORTER_OTLP_ENDPOINT<br/>      value: "<a class="ae lp" href="http://otel-collector.default.svc.cluster.local:4317" rel="noopener ugc nofollow" target="_blank">http://otel-collector.default.svc.cluster.local:4317</a>"<br/>    - name: OTEL_EXPORTER_OTLP_PROTOCOL<br/>      value: "grpc"</span></pre><p id="2592" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">ç«‹å³åº”ç”¨æ¸…å•ã€‚</p><pre class="lr ls lt lu gu mw mx my mz aw na bi"><span id="d542" class="nb kn ir mx b gz nc nd l ne nf">$ kubectl apply -f ./manifests/otel-demo-workload.yaml</span></pre><p id="5dc7" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">è¯·è®°ä½ï¼Œåº”ç”¨ç¨‹åºä¹Ÿä¼šè®°å½•åˆ°æ§åˆ¶å°ã€‚è®©æˆ‘ä»¬æŸ¥è¯¢ASP.NETæœåŠ¡çš„æ—¥å¿—(æ³¨æ„ï¼Œåœ¨æ‚¨çš„ç¯å¢ƒä¸­ï¼Œpodnameä¼šæœ‰æ‰€ä¸åŒ)ã€‚</p><pre class="lr ls lt lu gu mw mx my mz aw na bi"><span id="df7b" class="nb kn ir mx b gz nc nd l ne nf">$ kubectl logs po/otel-workload-69cc89d456-9zfs7<br/> <br/>info: Microsoft.Hosting.Lifetime[14]<br/>      Now listening on: <a class="ae lp" href="http://[::]:80" rel="noopener ugc nofollow" target="_blank">http://[::]:80</a><br/>info: Microsoft.Hosting.Lifetime[0]<br/>      Application started. Press Ctrl+C to shut down.<br/>info: Microsoft.Hosting.Lifetime[0]<br/>      Hosting environment: Production<br/>info: Microsoft.Hosting.Lifetime[0]<br/>      Content root path: /app/<br/>Resource associated with Metric:<br/>    service.name: otel.demo<br/>    service.version: 0.0.1<br/>    service.instance.id: b84c78be-49df-42fa-bd09-0ad13481d826<br/> <br/>Export otel.demo.metric.gauge1, Meter: otel.demo.metric/0.0.1<br/>(2022-08-20T11:40:41.4260064Z, 2022-08-20T11:40:51.3451557Z] LongGauge<br/>Value: 10<br/> <br/>Export otel.demo.metric.gauge2, Meter: otel.demo.metric/0.0.1<br/>(2022-08-20T11:40:41.4274763Z, 2022-08-20T11:40:51.3451863Z] DoubleGauge<br/>Value: 0.8778815716262417<br/> <br/>Export otel.demo.metric.gauge1, Meter: otel.demo.metric/0.0.1<br/>(2022-08-20T11:40:41.4260064Z, 2022-08-20T11:41:01.3387999Z] LongGauge<br/>Value: 19<br/> <br/>Export otel.demo.metric.gauge2, Meter: otel.demo.metric/0.0.1<br/>(2022-08-20T11:40:41.4274763Z, 2022-08-20T11:41:01.3388003Z] DoubleGauge<br/>Value: 0.35409627617124295</span></pre><p id="a9ae" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">åŒæ ·ï¼Œè®©æˆ‘ä»¬æ£€æŸ¥æ•°æ®æ˜¯å¦å°†è¢«å‘é€åˆ°æ”¶é›†å™¨ã€‚è®°ä½å®ƒåœ¨<code class="fe ng nh ni mx b">0.0.0.0:8889/metrics</code>ä¸Šå…¬å¼€äº†å®ƒçš„<code class="fe ng nh ni mx b">/metrics</code>ç«¯ç‚¹ã€‚è®©æˆ‘ä»¬é€šè¿‡å°†æœåŠ¡ç«¯å£è½¬å‘åˆ°æœ¬åœ°æœºå™¨æ¥æŸ¥è¯¢å®ƒã€‚</p><pre class="lr ls lt lu gu mw mx my mz aw na bi"><span id="4468" class="nb kn ir mx b gz nc nd l ne nf">$ kubectl port-forward svc/otel-collector 8889:8889<br/> <br/>Forwarding from 127.0.0.1:8889 -&gt; 8889<br/>Forwarding from [::1]:8889 -&gt; 8889<br/> <br/># in a different session, curl the endpoint<br/>$  curl <a class="ae lp" href="http://localhost:8889/metrics" rel="noopener ugc nofollow" target="_blank">http://localhost:8889/metrics</a><br/> <br/># HELP otel_demo_metric_gauge1<br/># TYPE otel_demo_metric_gauge1 gauge<br/>otel_demo_metric_gauge1{instance="b84c78be-49df-42fa-bd09-0ad13481d826",job="otel.demo"} 37<br/># HELP otel_demo_metric_gauge2<br/># TYPE otel_demo_metric_gauge2 gauge<br/>otel_demo_metric_gauge2{instance="b84c78be-49df-42fa-bd09-0ad13481d826",job="otel.demo"} 0.45433988869946285</span></pre><p id="b1c7" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">å¤ªå¥½äº†ï¼Œä¸¤ä¸ªç»„ä»¶â€”â€”æŒ‡æ ‡ç”Ÿæˆå™¨å’Œæ”¶é›†å™¨â€”â€”éƒ½æ­£å¸¸å·¥ä½œã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¯åŠ¨Prometheus/Grafanaç¯å¢ƒï¼Œæ·»åŠ æœåŠ¡ç›‘è§†å™¨æ¥æŠ“å–<code class="fe ng nh ni mx b">/metrics</code>ç«¯ç‚¹å¹¶ä¸ºå…¶åˆ›å»ºGrafanaä»ªè¡¨æ¿ã€‚</p><h1 id="cdae" class="km kn ir bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">æ·»åŠ Kube-Prometheus-Stack</h1><p id="be66" class="pw-post-body-paragraph jo jp ir jq b jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh lo kj kk kl ik bi translated">å°†Prometheus/Grafana stackæ·»åŠ åˆ°æ‚¨çš„Kubernetesé›†ç¾¤çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨<a class="ae lp" href="https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack" rel="noopener ugc nofollow" target="_blank">kube-Prometheus-stack</a>Helm chartã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªå®šåˆ¶çš„<code class="fe ng nh ni mx b">values.yaml</code>æ–‡ä»¶ä¸ºåä¸º<code class="fe ng nh ni mx b">demo/otel-collector</code>çš„OTELæ”¶é›†å™¨è‡ªåŠ¨æ·»åŠ é™æ€Prometheusç›®æ ‡(ä»…åœ¨<code class="fe ng nh ni mx b">kind</code>ç¯å¢ƒä¸­éœ€è¦<code class="fe ng nh ni mx b">kubeEtc</code>é…ç½®):</p><pre class="lr ls lt lu gu mw mx my mz aw na bi"><span id="a3cd" class="nb kn ir mx b gz nc nd l ne nf">kubeEtcd:<br/>  service:<br/>    targetPort: 2381<br/>prometheus:<br/>  prometheusSpec:<br/>    additionalScrapeConfigs:<br/>    - job_name: "demo/otel-collector"<br/>      static_configs:<br/>      - targets: ["otel-collector.default.svc.cluster.local:8889"]</span></pre><p id="125b" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">ç°åœ¨ï¼Œé€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°†èˆµå›¾æ·»åŠ åˆ°é›†ç¾¤ä¸­:</p><pre class="lr ls lt lu gu mw mx my mz aw na bi"><span id="3318" class="nb kn ir mx b gz nc nd l ne nf">$ helm upgrade --install --wait --timeout 15m \<br/>  --namespace monitoring --create-namespace \<br/>  --repo <a class="ae lp" href="https://prometheus-community.github.io/helm-charts" rel="noopener ugc nofollow" target="_blank">https://prometheus-community.github.io/helm-charts</a> \<br/>  kube-prometheus-stack kube-prometheus-stack --values ./prom-grafana/values.yaml<br/> <br/>Release "kube-prometheus-stack" does not exist. Installing it now.<br/>NAME: kube-prometheus-stack<br/>LAST DEPLOYED: Mon Aug 22 13:53:58 2022<br/>NAMESPACE: monitoring<br/>STATUS: deployed<br/>REVISION: 1<br/>NOTES:<br/>kube-prometheus-stack has been installed. Check its status by running:<br/>  kubectl --namespace monitoring get pods -l "release=kube-prometheus-stack"</span></pre><p id="1ac0" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">è®©æˆ‘ä»¬æ¥çœ‹çœ‹Prometheusç›®æ ‡ï¼Œå¦‚æœPrometheuså¯ä»¥æŠ“å–OTELæ”¶é›†å™¨ç«¯ç‚¹â€”åŒæ ·ï¼Œå°†æœåŠ¡è½¬å‘åˆ°æ‚¨çš„æœ¬åœ°æœºå™¨ï¼Œå¹¶åœ¨<a class="ae lp" href="http://localhost:9090/targets" rel="noopener ugc nofollow" target="_blank">http://localhost:9090/targets</a>æ‰“å¼€æµè§ˆå™¨ã€‚</p><pre class="lr ls lt lu gu mw mx my mz aw na bi"><span id="1be7" class="nb kn ir mx b gz nc nd l ne nf">$ kubectl port-forward -n monitoring svc/kube-prometheus-stack-prometheus 9090:9090</span></pre><figure class="lr ls lt lu gu lv gi gj paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gi gj lq"><img src="../Images/3f741bf379ee8b1f3677ae334dc620a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cGpXViVY7P4RZr53"/></div></div><figcaption class="mc md gk gi gj me mf bd b be z dk translated">æ™®ç½—ç±³ä¿®æ–¯ç›®æ ‡</figcaption></figure><p id="56c3" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">è¿™çœ‹èµ·æ¥å’Œé¢„æœŸçš„ä¸€æ ·ï¼Œç°åœ¨è½¬åˆ°Grafanaå¹¶åˆ›å»ºä¸€ä¸ªæ˜¾ç¤ºå®šåˆ¶æŒ‡æ ‡çš„ä»ªè¡¨æ¿ã€‚å¦‚å‰æ‰€è¿°ï¼Œå°†GrafanaæœåŠ¡ç«¯å£è½¬å‘åˆ°æ‚¨çš„æœ¬åœ°æœºå™¨ï¼Œå¹¶åœ¨<a class="ae lp" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>æ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨ã€‚å› ä¸ºæ‚¨éœ€è¦ç”¨æˆ·å/å¯†ç ç»„åˆæ¥ç™»å½•Grafanaï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆéœ€è¦ä»Kubernetes secretä¸­è·å–è¯¥ä¿¡æ¯:</p><pre class="lr ls lt lu gu mw mx my mz aw na bi"><span id="fe60" class="nb kn ir mx b gz nc nd l ne nf"># Grafana admin username<br/>$ kubectl get secret -n monitoring kube-prometheus-stack-grafana -o jsonpath='{.data.admin-user}' | base64 --decode<br/> <br/># Grafana password<br/>$ kubectl get secret -n monitoring kube-prometheus-stack-grafana -o jsonpath='{.data.admin-password}' | base64 --decode<br/> <br/># port-forward Grafana service<br/>$ kubectl port-forward -n monitoring svc/kube-prometheus-stack-grafana 3000:80<br/> <br/>Forwarding from 127.0.0.1:3000 -&gt; 3000<br/>Forwarding from [::1]:3000 -&gt; 3000</span></pre><p id="d392" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">åœ¨<a class="ae lp" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>æ‰“å¼€æµè§ˆå™¨å¹¶æˆåŠŸç™»å½•åï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°Grafanaæ¬¢è¿é¡µé¢ã€‚</p><figure class="lr ls lt lu gu lv gi gj paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gi gj lq"><img src="../Images/8d3fca3037527f1d4bd199b46498408d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3P1Cj85NfuZ-KU3H"/></div></div><figcaption class="mc md gk gi gj me mf bd b be z dk translated">Grafanaæ¬¢è¿é¡µé¢</figcaption></figure><h1 id="6164" class="km kn ir bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">ä¸ºè‡ªå®šä¹‰æŒ‡æ ‡æ·»åŠ ä»ªè¡¨æ¿</h1><p id="ec8a" class="pw-post-body-paragraph jo jp ir jq b jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh lo kj kk kl ik bi translated">è½¬åˆ°<a class="ae lp" href="https://partlycloudy.blog/2022/08/22/asp-net-custom-metrics-with-opentelemetry-collector-prometheus-grafana/3000/dashboard/import" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/dashboard/import</a>ï¼Œä»<code class="fe ng nh ni mx b">./prom-grafana/dashboard.json</code>ä¸Šä¼ é¢„å…ˆåˆ›å»ºçš„ä»ªè¡¨æ¿(æˆ–è€…ç®€å•åœ°å°†å…¶å†…å®¹ç²˜è´´åˆ°æ–‡æœ¬æ¡†ä¸­)ã€‚å¯¼å…¥å®šä¹‰åï¼Œæ‚¨åº”è¯¥ä¼šè¢«é‡å®šå‘åˆ°ä»ªè¡¨æ¿ï¼Œå¹¶çœ‹åˆ°æ˜¾ç¤ºçš„è‡ªå®šä¹‰æŒ‡æ ‡ã€‚</p><figure class="lr ls lt lu gu lv gi gj paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gi gj lq"><img src="../Images/e01126412ebc61ee0ad760f1c955f2de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AMeJXhWTeV0HNZej"/></div></div><figcaption class="mc md gk gi gj me mf bd b be z dk translated">å¯¼å…¥Grafanaä»ªè¡¨æ¿</figcaption></figure><figure class="lr ls lt lu gu lv gi gj paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gi gj nj"><img src="../Images/16227bc74ca4b0c7c9b153a2398375aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QGk9WxJSkNBlGFIA"/></div></div><figcaption class="mc md gk gi gj me mf bd b be z dk translated">å…·æœ‰ä»ªè¡¨1å’Œä»ªè¡¨2æŒ‡æ ‡çš„å›¾è¡¨</figcaption></figure><h1 id="5a5f" class="km kn ir bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">æ€»ç»“</h1><p id="e0d1" class="pw-post-body-paragraph jo jp ir jq b jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh lo kj kk kl ik bi translated">è¯¥æ¼”ç¤ºå±•ç¤ºäº†å¦‚ä½•åœ¨ASP.NETæœåŠ¡ä¸­ä½¿ç”¨OpenTelemetryè‡ªå®šä¹‰æŒ‡æ ‡ï¼Œå°†é¥æµ‹æ•°æ®å‘é€åˆ°ç”±Prometheuså®ä¾‹æ”¶é›†çš„OTELæ”¶é›†å™¨å®ä¾‹ã€‚ä¸ºäº†ç»“æŸè¿™ä¸ªå¾ªç¯ï¼Œè¿™äº›å®šåˆ¶æŒ‡æ ‡æœ€ç»ˆä¼šæ˜¾ç¤ºåœ¨Grafanaä»ªè¡¨æ¿ä¸­ã€‚è¿™ç§è§£å†³æ–¹æ¡ˆçš„ä¼˜ç‚¹æ˜¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨OpenTelemetryè¿™æ ·çš„é€šç”¨è§£å†³æ–¹æ¡ˆæ¥ç”Ÿæˆå’Œæ”¶é›†æŒ‡æ ‡ã€‚é€šè¿‡OTELå¯¼å‡ºå™¨é…ç½®ï¼Œå¯ä»¥è½»æ¾åœ°äº¤æ¢æ•°æ®æœ€ç»ˆå‘é€åˆ°å“ªä¸ªæœåŠ¡ä»¥åŠä½¿ç”¨å“ªä¸ªè§£å†³æ–¹æ¡ˆæ¥åˆ†ææ•°æ®â€”â€”å¦‚æœæ‚¨ä¸æƒ³ä½¿ç”¨Prometheusï¼Œæ‚¨åªéœ€ä¿®æ”¹OTELç®¡é“å¹¶å°†é¥æµ‹æ•°æ®å¯¼å‡ºåˆ°Azure Monitoræˆ–DataDogã€Splunkç­‰ã€‚</p><p id="93fa" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">æˆ‘å¸Œæœ›è¿™ä¸ªæ¼”ç¤ºå·²ç»å¾ˆå¥½åœ°å‘æ‚¨ä»‹ç»äº†OpenTelemetryä¸–ç•Œã€‚ç¼–ç å¿«ä¹ï¼ğŸ™‚</p></div><div class="ab cl nk nl hv nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ik il im in io"><p id="923b" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><em class="mh">åŸè½½äº2022å¹´8æœˆ22æ—¥</em><a class="ae lp" href="https://partlycloudy.blog/2022/08/22/asp-net-custom-metrics-with-opentelemetry-collector-prometheus-grafana/" rel="noopener ugc nofollow" target="_blank"><em class="mh">http://partly cloudy . blog</em></a><em class="mh">ã€‚</em></p></div></div>    
</body>
</html>