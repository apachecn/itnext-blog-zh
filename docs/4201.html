<html>
<head>
<title>.NET Console Apps Preparation for Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ã€‚Dockerçš„. NETæ§åˆ¶å°åº”ç”¨ç¨‹åºå‡†å¤‡</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/net-console-apps-preparation-for-docker-b72c9dfc1ded?source=collection_archive---------4-----------------------#2020-05-14">https://itnext.io/net-console-apps-preparation-for-docker-b72c9dfc1ded?source=collection_archive---------4-----------------------#2020-05-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="dff5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘æœ‰ä¸€ä¸ªæœåŠ¡è¦åœ¨æˆ‘çš„Raspberry Piä¸Šè¿è¡Œï¼Œæˆ‘å†³å®šç”¨Dockeréƒ¨ç½²å’Œæ‰˜ç®¡å®ƒã€‚äº‹æƒ…è¿›è¡Œå¾—å¾ˆé¡ºåˆ©ï¼Œç›´åˆ°æˆ‘éœ€è¦ä¸€äº›æ”¹å˜æ¥è®©æˆ‘çš„æ§åˆ¶å°åº”ç”¨ç¨‹åºä¸ºDockeråšå¥½å‡†å¤‡ã€‚</p><p id="05dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¤§å¤šæ•°æ—¶å€™ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨<code class="fe ko kp kq kr b">Console.ReadLine</code>æ¥ç»“æŸæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºMainæ–¹æ³•ã€‚è¿™ä¼¼ä¹å¾ˆåˆç†ï¼Œç›´åˆ°ä½ å°è¯•åœ¨Docker <a class="ae ks" href="https://en.wikipedia.org/wiki/Standard_streams#Standard_input_(stdin)" rel="noopener ugc nofollow" target="_blank">åˆ†ç¦»æ¨¡å¼</a>ä¸‹è¿è¡Œä½ çš„åº”ç”¨ã€‚</p><pre class="kt ku kv kw gt kx kr ky kz aw la bi"><span id="1194" class="lb lc it kr b gy ld le l lf lg">docker run -d myapp:latest</span></pre><p id="4d66" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å®ƒè¿è¡Œå®¹å™¨ï¼Œåº”ç”¨ç¨‹åºå°†ç«‹å³é€€å‡ºï¼å› ä¸ºåœ¨åˆ†ç¦»æ¨¡å¼ä¸‹ä½ åšä¸åˆ°ã€‚æˆ‘å°†æ¶µç›–äº¤äº’å¼å’Œåˆ†ç¦»æ¨¡å¼çš„æ‰€æœ‰åœºæ™¯å’Œè§£å†³æ–¹æ³•ï¼Œæ‰€ä»¥è¯·ç³»å¥½å®‰å…¨å¸¦ï¼</p></div><div class="ab cl lh li hx lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="im in io ip iq"><h2 id="15fe" class="lb lc it bd lo lp lq dn lr ls lt dp lu kb lv lw lx kf ly lz ma kj mb mc md me bi translated">åœºæ™¯1:äº¤äº’æ¨¡å¼</h2><p id="39f1" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated">äº’åŠ¨æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿäº¤äº’æ¨¡å¼æ„å‘³ç€ä½ éœ€è¦ç”¨æˆ·åœ¨å®¹å™¨ä¸­çš„åº”ç”¨ä¸Šè¿›è¡Œäº¤äº’ï¼Œæ¯”å¦‚è¾“å…¥ä¸€äº›ä¿¡æ¯ï¼Œé€‰æ‹©ä¸€ä¸ªé€‰é¡¹ç­‰ç­‰ã€‚æˆ‘ä¸å–œæ¬¢è¿™æ ·ï¼Œå› ä¸ºåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç”¨æˆ·æ›´å–œæ¬¢ä¸ºå®¹å™¨æä¾›å¸¦æœ‰å‚æ•°æˆ–ç¯å¢ƒå˜é‡çš„æ•°æ®ã€‚</p><p id="b65b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æƒ³è±¡ä¸€ä¸ªç®€å•çš„ã€‚NETæ§åˆ¶å°åº”ç”¨ç¨‹åºï¼Œéœ€è¦ç”¨æˆ·ç¡®è®¤æ‰èƒ½è¦†ç›–æ–‡ä»¶ã€‚</p><pre class="kt ku kv kw gt kx kr ky kz aw la bi"><span id="731f" class="lb lc it kr b gy ld le l lf lg">static void Main(string[] args)<br/>{<br/> while (true)<br/> {<br/>  Console.WriteLine("Overwrite the files? (y/n)");<br/>  var confirmation = Console.ReadLine().Substring(0, 1);<br/>  if (confirmation.Equals("y", StringComparison.OrdinalIgnoreCase))<br/>  {<br/>   Console.WriteLine("File(s) overwrited.");<br/>   break;<br/>  }<br/> }<br/> Console.WriteLine("Application exited.");<br/>}</span></pre><blockquote class="mk ml mm"><p id="3864" class="jq jr mn js b jt ju jv jw jx jy jz ka mo kc kd ke mp kg kh ki mq kk kl km kn im bi translated">ğŸ’¡è¿™ä¸æ˜¯ä¸ºå®ç°CLIçš„å¥½æ–¹æ³•ã€‚ä¸ºäº†æ›´å¥½åœ°å®ç°CLIï¼Œè¯·é˜…è¯»<a class="ae ks" rel="noopener ugc nofollow" target="_blank" href="/command-line-interface-cli-application-with-net-core-75bb5603ee70?source=friends_link&amp;sk=2819a8e43b2e02e72c816961eb0c3217">å‘½ä»¤è¡Œç•Œé¢(CLI)åº”ç”¨ç¨‹åºã€‚ç½‘èŠ¯</a>ç¯‡ã€‚</p></blockquote><p id="95b2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¦‚æœæˆ‘ä»¬åˆ›å»ºå¹¶è¿è¡Œdockeræ˜ åƒï¼Œæ‚¨å°†å¾—åˆ°è¿™ä¸ªé”™è¯¯ã€‚ç”¨æˆ·è¾“å…¥ä¸ºnullï¼Œåº”ç”¨ç¨‹åºå¼•å‘NullReferenceExceptionã€‚</p><figure class="kt ku kv kw gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mr"><img src="../Images/d22df2c4655af03f8a3b454f5b3608af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AOqeGyf8W7PI_5cRTciFsg.png"/></div></div></figure><p id="1ed8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¿™æ˜¯å› ä¸ºå½“æ‚¨è¿è¡Œdocker-imageæ—¶æ²¡æœ‰ä»»ä½•ç”¨æˆ·è¾“å…¥ã€‚ç°åœ¨ï¼Œå¦‚æœåœ¨äº¤äº’<code class="fe ko kp kq kr b">-i</code>æ¨¡å¼ä¸‹è¿è¡Œåº”ç”¨ç¨‹åº:</p><figure class="kt ku kv kw gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mz"><img src="../Images/d559e5998788ddbacd5089f8d39183c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iB7O-3IU2qC8FG3mU7yxPg.png"/></div></div></figure><p id="d58e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨è¿™ç§åœºæ™¯å’Œå®ç°ä¸­ï¼Œæ‚¨ä¸èƒ½ä»¥åˆ†ç¦»æˆ–é™„åŠ çš„æ–¹å¼è¿è¡Œåº”ç”¨ç¨‹åºã€‚</p><h2 id="6dae" class="lb lc it bd lo lp lq dn lr ls lt dp lu kb lv lw lx kf ly lz ma kj mb mc md me bi translated">åœºæ™¯2:åˆ†ç¦»æ¨¡å¼ä¸‹é•¿æ—¶é—´è¿è¡Œçš„ä½œä¸š</h2><p id="39b9" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated">å‡è®¾æ‚¨æœ‰ä¸€ä¸ªæ°¸è¿œè¿è¡Œçš„æœåŠ¡ï¼Œå®ƒæå–æ•°æ®å¹¶ä»¥é¢å‘äº‹ä»¶çš„æ–¹å¼å¤„ç†å®ƒä»¬ã€‚</p><p id="3211" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è€ƒè™‘åˆ°è¿™äº›ç±»å‹çš„åº”ç”¨ç¨‹åºæ˜¯åœ¨åˆ†ç¦»æ¨¡å¼ä¸‹è¿è¡Œçš„ï¼Œåƒ<code class="fe ko kp kq kr b">Console.Read</code>æˆ–<code class="fe ko kp kq kr b">System.Thread.Thread.Sleep(...)</code>è¿™æ ·çš„è§£å†³æ–¹æ³•å¹¶ä¸å¥½ã€‚åœ¨ä¸‹é¢å¸¦æœ‰<a class="ae ks" href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.autoresetevent?view=netcore-3.1" rel="noopener ugc nofollow" target="_blank">autoreseteeventã€</a>çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬è®¾æ³•ä¿æŒåº”ç”¨ç¨‹åºæ‰“å¼€ï¼Œç›´åˆ°ç”¨æˆ·æƒ³è¦ç”¨<code class="fe ko kp kq kr b">CTRL + C</code>å…³é—­åº”ç”¨ç¨‹åºã€‚</p><pre class="kt ku kv kw gt kx kr ky kz aw la bi"><span id="1530" class="lb lc it kr b gy ld le l lf lg">internal static class Program<br/>{<br/> private static readonly AutoResetEvent _waitHandle = new AutoResetEvent(false);</span><span id="a25c" class="lb lc it kr b gy na le l lf lg">private static readonly Service _service = new Service();<br/> private static void Main()<br/> {</span><span id="c7a9" class="lb lc it kr b gy na le l lf lg">_service.OnMessageRecieved = OnMessage_Received;<br/>  _service.StartReceiving();</span><span id="7fca" class="lb lc it kr b gy na le l lf lg">// Handle Control+C or Control+Break<br/>  Console.CancelKeyPress += (o, e) =&gt;<br/>  {<br/>   Console.WriteLine("Exit");<br/>   // Allow the manin thread to continue and exit...<br/>   _waitHandle.Set();<br/>  };</span><span id="63e5" class="lb lc it kr b gy na le l lf lg">// wait until Set method calls<br/>  _waitHandle.WaitOne();<br/> }</span><span id="7f24" class="lb lc it kr b gy na le l lf lg">private static void OnMessage_Received(int messageId, string message)<br/> {<br/>  Console.WriteLine($"Message {messageId} recieved.");<br/> }<br/>}</span></pre><ul class=""><li id="14dc" class="nb nc it js b jt ju jx jy kb nd kf ne kj nf kn ng nh ni nj bi translated">è®°ä½ï¼Œåœ¨æ‰€æœ‰çš„ä½œä¸šä¹‹åè°ƒç”¨<code class="fe ko kp kq kr b">AutoResetEvent.WaitOne</code>æ–¹æ³•ã€‚</li></ul><h2 id="6402" class="lb lc it bd lo lp lq dn lr ls lt dp lu kb lv lw lx kf ly lz ma kj mb mc md me bi translated">åœºæ™¯3:åˆ†ç¦»æ¨¡å¼ä¸‹çš„æœåŠ¡</h2><p id="18dc" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥è½»æ¾åˆ›å»ºä¸€ä¸ªæ‰˜ç®¡æœåŠ¡ï¼Œå¹¶åœ¨æ‚¨çš„æ§åˆ¶å°åº”ç”¨ç¨‹åºä¸­è¿è¡Œå®ƒã€‚å¾®è½¯<a class="ae ks" href="https://www.nuget.org/packages/Microsoft.Extensions.Hosting/" rel="noopener ugc nofollow" target="_blank">æä¾›æ‰˜ç®¡æœåŠ¡ã€‚æ‰©å±•.æ‰˜ç®¡</a>åŒ…ã€‚</p><p id="f949" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åªéœ€åˆ›å»ºä¸€ä¸ªç±»å¹¶å®ç°<code class="fe ko kp kq kr b">IHostedService</code>æ¥å£ã€‚ä½ å¯ä»¥åœ¨å¾®è½¯æ–‡æ¡£ä¸Šé˜…è¯»æ›´å¤šå…³äº<a class="ae ks" href="https://docs.microsoft.com/en-us/dotnet/architecture/microservices/multi-container-microservice-net-applications/background-tasks-with-ihostedservice" rel="noopener ugc nofollow" target="_blank"> HostedServicesçš„ä¿¡æ¯ã€‚</a></p><pre class="kt ku kv kw gt kx kr ky kz aw la bi"><span id="d6c8" class="lb lc it kr b gy ld le l lf lg">public class Service : IHostedService<br/>{<br/> public Service()<br/> {<br/> }</span><span id="0c14" class="lb lc it kr b gy na le l lf lg">public Task StartAsync(CancellationToken cancellationToken)<br/> {<br/>  Console.WriteLine("Task is started.");<br/>  return Task.CompletedTask;<br/> }</span><span id="7215" class="lb lc it kr b gy na le l lf lg">public Task StopAsync(CancellationToken cancellationToken)<br/> {<br/>  Console.WriteLine("Task stopped.");<br/>  return Task.CompletedTask;<br/> }<br/>}</span></pre><p id="8f62" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨æ‚¨çš„Mainæ–¹æ³•ä¸­ï¼Œåˆ›å»ºæ‰˜ç®¡æœåŠ¡å¹¶é…ç½®æœåŠ¡ï¼Œç­‰ç­‰ã€‚</p><pre class="kt ku kv kw gt kx kr ky kz aw la bi"><span id="2f7a" class="lb lc it kr b gy ld le l lf lg">private static async Task Main()<br/>{<br/> var hostBuilder = new HostBuilder()<br/>  .ConfigureServices((hostContext, services) =&gt;<br/>   {<br/>    services.AddHostedService&lt;Service&gt;();<br/>   }<br/>  );</span><span id="9982" class="lb lc it kr b gy na le l lf lg">await hostBuilder.RunConsoleAsync().ConfigureAwait(false);<br/>}</span></pre><h2 id="6683" class="lb lc it bd lo lp lq dn lr ls lt dp lu kb lv lw lx kf ly lz ma kj mb mc md me bi translated">ç»“è®º</h2><p id="5e50" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated">æˆ‘æ›´å–œæ¬¢AutoResetEventæ–¹æ³•ï¼Œå› ä¸ºæˆ‘çš„æœåŠ¡éå¸¸å°ã€‚ç„¶è€Œï¼Œå¯¹äºæ›´å¤æ‚æˆ–ç°å®ä¸–ç•Œçš„é—®é¢˜ï¼Œæœ€å¥½é‡‡ç”¨æ‰˜ç®¡æœåŠ¡æ–¹æ³•ã€‚</p></div><div class="ab cl lh li hx lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="im in io ip iq"><h2 id="c414" class="lb lc it bd lo lp lq dn lr ls lt dp lu kb lv lw lx kf ly lz ma kj mb mc md me bi translated">è¦é˜…è¯»çš„ç›¸å…³æ–‡ç« </h2><ul class=""><li id="4ffc" class="nb nc it js b jt mf jx mg kb nk kf nl kj nm kn ng nh ni nj bi translated"><a class="ae ks" rel="noopener ugc nofollow" target="_blank" href="/smaller-docker-images-for-asp-net-core-apps-bee4a8fd1277?source=friends_link&amp;sk=32ffef97e661f1131703b2c84a0d5e14">ASP.NETæ ¸å¿ƒåº”ç”¨çš„è¾ƒå°Dockerå›¾åƒ</a></li><li id="b9d3" class="nb nc it js b jt nn jx no kb np kf nq kj nr kn ng nh ni nj bi translated"><a class="ae ks" rel="noopener ugc nofollow" target="_blank" href="/command-line-interface-cli-application-with-net-core-75bb5603ee70?source=friends_link&amp;sk=2819a8e43b2e02e72c816961eb0c3217">å‘½ä»¤è¡Œç•Œé¢(CLI)åº”ç”¨ç¨‹åºã€‚ç½‘ç»œæ ¸å¿ƒ</a></li></ul></div></div>    
</body>
</html>