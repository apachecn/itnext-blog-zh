# æ„å»ºäº‘åŸç”Ÿåº”ç”¨:å¼€æ”¾åº”ç”¨æ¨¡å‹å’Œ Rudr ç®€ä»‹

> åŸæ–‡ï¼š<https://itnext.io/building-cloud-native-apps-intro-to-open-application-model-and-rudr-bd1b55df9bf3?source=collection_archive---------0----------------------->

ç”Ÿäº§çº§åˆ†å¸ƒå¼äº‘åŸç”Ÿå¾®æœåŠ¡é€šå¸¸ç”±å¤šä¸ªåˆä½œå›¢é˜Ÿæ„å»ºå’Œè¿è¥ã€‚è¿™è¯´èµ·æ¥å®¹æ˜“åšèµ·æ¥éš¾ï¼è€ƒè™‘åˆ°è§„æ¨¡å’Œå¤æ‚æ€§ï¼Œé—®é¢˜ä¼šä»¥å¤šç§æ–¹å¼å‡ºç°(å¹¶ä¸æ€»æ˜¯ç”±äºæŠ€æœ¯åŸå› )ã€‚å…¶ä»–ä¸€äº›å› ç´ åŒ…æ‹¬ç¼ºä¹èŒè´£åˆ†ç¦»ã€è§’è‰²/è´£ä»»é‡å ç­‰ã€‚ï¼Œå› æ­¤èƒ½å¤Ÿæ¸…æ¥šåœ°åŒºåˆ†æ¯ä¸ªå›¢é˜Ÿ/å°ç»„è´Ÿè´£çš„é¢†åŸŸè‡³å…³é‡è¦â€”â€”ä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ˜¯åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å’Œæ“ä½œäººå‘˜ã€‚

è¿™æ˜¯ä¸€ç¯‡ä»‹ç»æ€§çš„åšæ–‡ï¼Œå¸®åŠ©ä½ ç†Ÿæ‚‰äº‘åŸç”Ÿåº”ç”¨å¼€å‘é¢†åŸŸçš„å‡ ä¸ªé¡¹ç›®:**å¼€æ”¾åº”ç”¨æ¨¡å‹**å’Œ **Rudr** ã€‚æ‚¨å°†äº†è§£è¿™äº›é¡¹ç›®åŠå…¶æ ¸å¿ƒæ¦‚å¿µçš„æ¦‚è¿°ã€‚

> *(æœ¬ç³»åˆ—ä¸­çš„)åç»­æ–‡ç« å°†å»ºç«‹åœ¨æœ¬æ–‡æ‰€è®¨è®ºçš„æ¦‚å¿µä¹‹ä¸Šï¼Œå¹¶æ¶µç›–å®é™…ä¾‹å­*

# å¼€æ”¾åº”ç”¨æ¨¡å‹:ä»€ä¹ˆå’Œä¸ºä»€ä¹ˆï¼Ÿ

`[Open Application Model (OAM)](https://github.com/oam-dev/spec)`é‡‡ç”¨â€œå…³æ³¨ç‚¹åˆ†ç¦»â€åŸåˆ™è¯•å›¾è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä¸ºäº†å®šä¹‰åº”ç”¨ç¨‹åºå¼€å‘çš„è§„èŒƒï¼Œå®ƒè€ƒè™‘äº†ä»¥ä¸‹è§’è‰²å’ŒèŒè´£:

*   åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜:ä»–ä»¬çš„èŒè´£æ˜¯æ„å»ºã€æè¿°å’Œé…ç½®åº”ç”¨ç¨‹åºã€‚
*   åº”ç”¨æ“ä½œå‘˜:åœ¨å¹³å°ä¸Šå·¥ä½œï¼Œè´Ÿè´£é…ç½®ä¸€ä¸ªæˆ–å¤šä¸ªå¾®æœåŠ¡çš„è¿è¡Œæ—¶ç»„ä»¶ã€‚
*   åŸºç¡€è®¾æ–½æ“ä½œå‘˜:è®¾ç½®å’Œç»´æŠ¤è¿è¡Œè¿™äº›åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒåŸºç¡€è®¾æ–½ã€‚

![](img/f0a8f6160e5fbf1ad00a1814548567f4.png)

ç®€å•æ¥è¯´ï¼Œ`OAM`æ˜¯ä¸€ä¸ªæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„è§„èŒƒã€‚å®ƒæä¾›äº†ä¸€ç§å¹³å°ä¸­ç«‹çš„æ–¹å¼æ¥å®šä¹‰è¿™äº›åº”ç”¨ç¨‹åºï¼Œé€šè¿‡æŠ½è±¡å‡ºè®¸å¤šå› ç´ ï¼Œå¦‚äº‘æä¾›å•†ã€ç¼–æ’å¹³å°ç­‰ã€‚å®ƒå®šä¹‰çš„æ ‡å‡†å¯ä»¥ä¸ºä¸åŒçš„å®ç°é“ºå¹³é“è·¯

> *è¿™ç§å®ç°çš„ä¸€ä¸ªä¾‹å­æ˜¯* `*Rudr*` *ï¼Œè¿™åœ¨ thig åšæ–‡*ä¸­æœ‰æ‰€æ¶‰åŠ

# å¼€æ”¾å¼åº”ç”¨æ¨¡å‹:æ ¸å¿ƒæ¦‚å¿µ

å¼€æ”¾åº”ç”¨ç¨‹åºæ¨¡å‹å®šä¹‰äº†ä»¥ä¸‹ç»„ä»¶â€”â€”å°†å®ƒä»¬è§†ä¸ºå¯ä»¥æœ‰ä¸åŒå®ç°çš„æŠ½è±¡æ¦‚å¿µ

*   *ç»„ä»¶ç¤ºæ„å›¾*:å¼€å‘è€…ç”¨æ¥æè¿°ä¸€ä¸ªåº”ç”¨æˆ–æœåŠ¡ã€‚æ‚¨å¯ä»¥å°†ç»„ä»¶ç¤ºæ„å›¾è§†ä¸ºä¸€ä¸ªâ€œç±»â€,å› ä¸ºè¿™åªæ˜¯åº”ç”¨ç¨‹åºçš„è“å›¾
*   *åº”ç”¨é…ç½®*:ç”±åº”ç”¨æ“ä½œå‘˜å®šä¹‰çš„ç»„ä»¶ã€ç‰¹æ€§å’Œåº”ç”¨èŒƒå›´çš„ç»„åˆã€‚å°†åº”ç”¨ç¨‹åºé…ç½®è§†ä¸ºåˆ›å»ºä¸€ä¸ªç±»(ç»„ä»¶ç¤ºæ„å›¾)çš„å¤šä¸ªâ€œå®ä¾‹â€çš„æ–¹å¼ï¼Œæ¯ä¸ªå®ä¾‹éƒ½å…·æœ‰ä¸åŒçš„å±æ€§ã€‚
*   *ç‰¹æ€§*:åº”ç”¨æ“ä½œå‘˜å¯ä»¥ä¸ºç»„ä»¶åˆ†é…é™„åŠ ç‰¹æ€§ï¼Œä»¥æ»¡è¶³æ¨ªåˆ‡éœ€æ±‚
*   *å·¥ä½œè´Ÿè½½*:ç”¨äºå®šä¹‰ç‰¹å®šç»„ä»¶çš„è¿è¡Œæ—¶ç±»å‹
*   *åº”ç”¨èŒƒå›´*:å®ƒä»¬æä¾›äº†ä¸€ç§å°†å…·æœ‰å…±åŒç‰¹å¾çš„ç»„ä»¶ç»„åˆæˆæ¾æ•£è€¦åˆçš„åº”ç”¨ç¨‹åºçš„æ–¹æ³•

ç°åœ¨æˆ‘ä»¬å¯¹`OAM`åŠå…¶æœ¯è¯­æœ‰äº†ä¸€ä¸ªåŸºæœ¬çš„æ¦‚å¿µï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£`Rudr`

# ä½ å¥½ï¼Œè·¯å¾·ï¼

`[Rudr](https://github.com/oam-dev/rudr/)`æ˜¯ä¸€ä¸ª [Kubernetes](https://kubernetes.io/) è§„èŒƒçš„å…·ä½“å®ç°ã€‚å®ƒå®šä¹‰äº†æ›´é«˜çº§åˆ«çš„åŸè¯­ï¼Œåœ¨ Kubernetes ä¹‹ä¸Šæä¾›äº†ä¸€ä¸ªæŠ½è±¡å±‚ã€‚`Rudr`å®ç°`OAM`æ¦‚å¿µ(å¦‚ç»„ä»¶ã€ç‰¹è´¨ç­‰ã€‚)ä½¿ç”¨ Kubernetes èµ„æºï¼Œå¦‚`Deployment` sã€`Service` sã€`Ingress`ç­‰ã€‚`Rudr`å…è®¸æ‚¨ä½¿ç”¨ YAML æ¸…å•å®šä¹‰`OAM`å®ä½“ï¼Œå®ƒåœ¨å†…éƒ¨æ˜ å°„åˆ° Kubernetes è‡ªå®šä¹‰èµ„æºå®šä¹‰(CRDs)

![](img/53ef053fda269a8d93c9e558290796fc.png)

> *[*æ§åˆ¶å™¨/æ“ä½œå™¨æ¨¡å¼*](https://kubernetes.io/docs/concepts/extend-kubernetes/operator/) *ç”¨äºå°†è¿™äº› CRD è½¬æ¢æˆå…·ä½“çš„ Kubernetes èµ„æºã€‚**

*`Rudr`å®ç°äº†`OAM`çš„æ‰¿è¯ºï¼Œä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç§å®šä¹‰åº”ç”¨å’Œå…¶ä»–å¯¹è±¡çš„æ–¹å¼ï¼Œæ¯”å¦‚åº”ç”¨é…ç½®ã€ç‰¹å¾ç­‰ã€‚å¹¶è®©æ“ä½œå‘˜å®šä¹‰æ“ä½œèƒ½åŠ›ã€‚*

*ç”±äºä¸Šä¸€èŠ‚ä»‹ç»äº†`OAM`æ¦‚å¿µï¼Œç°åœ¨æ˜¯ä»`Rudr`çš„è§’åº¦æ·±å…¥äº†è§£å…¶æœ¬è´¨çš„å¥½æ—¶æœºã€‚*

# *Rudr è‡ªå®šä¹‰èµ„æºå®šä¹‰(CRDs)*

*æœ¬èŠ‚å°†æ¦‚è¿°`Rudr`ä½¿ç”¨çš„è‡ªå®šä¹‰èµ„æºå®šä¹‰ã€‚*

## *æˆåˆ†*

*ç»„ä»¶æè¿°äº†ç‰¹å®šæœåŠ¡æˆ–åº”ç”¨ç¨‹åºçš„ç‰¹å¾â€”â€”å®ƒç”±`ComponentSchematic` CRD è¡¨ç¤ºã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­:*

```
*apiVersion: core.oam.dev/v1alpha1
kind: ComponentSchematic
metadata:
  name: greeter-component
spec:
  workloadType: core.oam.dev/v1alpha1.Server
  containers:
    - name: greeter
      image: abhirockzz/greeter-go
      env:
        - name: GREETING
          fromParam: greeting
      ports:
        - protocol: TCP
          containerPort: 8080
          name: http
      resources:
        cpu:
          required: 0.1
        memory:
          required: "128"
  parameters:
    - name: greeting
      type: string
      default: abhi_tweeter*
```

*`ComponentSchematic` CRD çš„å„ä¸ªéƒ¨åˆ†æ˜¯:*

*   *`metadata`:ç”¨äºæä¾›åç§°ã€æ ‡ç­¾ã€æ³¨é‡Šç­‰åŸºæœ¬ä¿¡æ¯*
*   *`workloadType`:ç”¨æ¥è¡¨ç¤ºå¼€å‘è€…æƒ³è¦å¦‚ä½•è¿è¡Œè¿™ä¸ªç»„ä»¶ã€‚æœ‰æ•ˆé€‰é¡¹åŒ…æ‹¬:`Server`ã€`Singleton Server`ã€`Task`ã€`Singleton Task`ã€`Worker`ã€`Singleton Worker`*
*   *`containers`:ç±»ä¼¼äº[ `Kubernetes`å®¹å™¨è§„èŒƒ](TODO è§„èŒƒé“¾æ¥)ï¼Œç”¨äºå®šä¹‰è¿è¡Œç»„ä»¶çš„å®¹å™¨åŒ–å·¥ä½œè´Ÿè½½æ‰€éœ€çš„è¿è¡Œæ—¶é…ç½®*
*   *`parameters`:è¿™æ˜¯å¯é€‰éƒ¨åˆ†ï¼Œç”¨äºæä¾›ç»„ä»¶çš„é…ç½®é€‰é¡¹ã€‚*

## *å·¥ä½œé‡*

*å¦‚ä¸Šæ‰€è¿°ï¼Œ`Rudr`å®šä¹‰äº†å…­ç§æ ¸å¿ƒå·¥ä½œè´Ÿè½½ç±»å‹ã€‚å·¥ä½œè´Ÿè½½ç±»å‹åªæ˜¯ç»„ä»¶ä¸­çš„ä¸€ä¸ªå­—æ®µã€‚é™¤äº†æ ¸å¿ƒå·¥ä½œè´Ÿè½½ï¼Œæ‰©å±•ç±»å‹å¯ä»¥é€šè¿‡[å®ç°ä¸€ä¸ªå¹¶å°†å…¶ç›´æ¥æ·»åŠ åˆ°](https://github.com/oam-dev/rudr/blob/master/docs/tutorials/deploy_openfaas_workload.md) `[Rudr](https://github.com/oam-dev/rudr/blob/master/docs/tutorials/deploy_openfaas_workload.md)`(ä¸é‚£ä¹ˆçµæ´»)æˆ–[ä½¿ç”¨ CRD æ–¹æ³•](https://github.com/oam-dev/rudr/blob/master/docs/tutorials/deploy_prometheus_workload.md)æ¥é¿å…å¯¹`Rudr`æœ¬èº«è¿›è¡Œä»£ç æ›´æ”¹æ¥å®šä¹‰ã€‚*

> **åœ¨ä¸Šé¢çš„* `*ComponentSchematic*` *ä¸­ï¼Œ* `*workloadType*` *è¢«å®šä¹‰ä¸º* `*core.oam.dev/v1alpha1.Server*`*

## *åº”ç”¨ç¨‹åºé…ç½®*

*A `ComponentSchematic`æœ¬èº«ä¸åšä»»ä½•æœ‰æ„ä¹‰çš„äº‹æƒ…ã€‚ä½¿ç”¨ä¸ä¸€ä¸ªæˆ–å¤šä¸ªç»„ä»¶ç›¸å…³è”çš„`ApplicationConfiguration`æ¥å®ç°åŸºäº`Rudr`çš„æœåŠ¡ï¼Œå¹¶å®šä¹‰å¦‚ä½•å®ä¾‹åŒ–å’Œé…ç½®åº”ç”¨ï¼ŒåŒ…æ‹¬å‚æ•°è¦†ç›–å’Œé™„åŠ ç‰¹æ€§ã€‚*

*è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­*

```
*apiVersion: core.oam.dev/v1alpha1
kind: ApplicationConfiguration
metadata:
  name: greeter-app-config
spec:
  components:
    - componentName: greeter-component
      instanceName: greeter-app*
```

*å®ƒæœ‰è¿™äº›éƒ¨åˆ†*

*   *`metadata`:ç”¨äºæä¾›åç§°ã€æ ‡ç­¾ã€æ³¨é‡Šç­‰åŸºæœ¬ä¿¡æ¯*
*   *`components`:ç”¨äºå¼•ç”¨ä¸€ä¸ªæˆ–å¤šä¸ª`ComponentSchematic`ï¼Œè¦†ç›–å®ƒä»¬çš„å‚æ•°(å¯é€‰)å¹¶å®šä¹‰é™„åŠ ç‰¹å¾*
*   *`traits`:æ‚¨å¯ä»¥ä½¿ç”¨æ­¤éƒ¨åˆ†å¯¹ç»„ä»¶åº”ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªåŠŸèƒ½ï¼Œä¾‹å¦‚è‡ªåŠ¨ç¼©æ”¾ã€å…¥å£ç­‰ã€‚*
*   *`scopes`:æ‚¨å¯ä»¥å°†å¤šä¸ªç»„ä»¶å½’å…¥ä¸€ä¸ªèŒƒå›´*
*   *`variables`:å¯ä»¥æ›¿æ¢åˆ°åº”ç”¨ç¨‹åºé…ç½®çš„å¤šä¸ªå…¶ä»–ä½ç½®çš„å…¬å…±å€¼*

## *ç‰¹ç‚¹*

*ä»£è¡¨ç³»ç»Ÿçš„ç‰¹æ€§ï¼Œè¿™äº›ç‰¹æ€§æ˜¯æ“ä½œä¸Šçš„å…³æ³¨ç‚¹ï¼Œè€Œä¸æ˜¯å¼€å‘äººå‘˜çš„å…³æ³¨ç‚¹ã€‚æ‚¨å¯ä»¥å°†å®ƒä»¬ä¸ç»„ä»¶å®ä¾‹ç›¸å…³è”ï¼Œä»¥æä¾›é¢å¤–çš„åŠŸèƒ½ï¼Œå¦‚è‡ªåŠ¨ä¼¸ç¼©ã€æŒä¹…æ€§ç­‰ã€‚*

*è¿™æ˜¯ä¸€ä¸ªç‰¹å¾çš„ä¾‹å­*

```
*apiVersion: core.oam.dev/v1alpha1
kind: ApplicationConfiguration
metadata:
  name: pv-example
spec:
  components:
    - componentName: rudr-pvc
      instanceName: rudr-pvc1
      traits:
        - name: volume-mounter
          properties:
            volumeName: config-data-vol
            storageClass: default*
```

*æ¯ä¸ªç‰¹å¾éƒ½æœ‰ä¸€ç»„ä¸åŒçš„å±æ€§ï¼Œæ˜¯`properties`éƒ¨åˆ†çš„ä¸€éƒ¨åˆ†ã€‚åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œ`Rudr`æ”¯æŒè¿™äº›ç‰¹æ€§ï¼Œå¹¶ä¸”æ¯ä¸ªç‰¹æ€§éƒ½é€‚ç”¨äºç‰¹å®šçš„å·¥ä½œè´Ÿè½½ç±»å‹*

*   *æ‰‹åŠ¨ç¼©æ”¾å™¨â€”æœåŠ¡å™¨ï¼Œä»»åŠ¡*
*   *è‡ªåŠ¨ç¼©æ”¾â€”æœåŠ¡å™¨ï¼Œä»»åŠ¡*
*   *å…¥å£â€”æœåŠ¡å™¨ï¼ŒSingletonServer*
*   *å·å®‰è£…ç¨‹åºâ€”æ‰€æœ‰æ ¸å¿ƒå·¥ä½œè´Ÿè½½*

> **ä½¿ç”¨* `*kubectl get traits*` *è·å–æ”¯æŒçš„ç‰¹æ€§åˆ—è¡¨**

## *èŒƒå›´*

*åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œ`Rudr`æ”¯æŒä¸€ä¸ª`Health`å’Œ`Network`ä½œç”¨åŸŸï¼Œæ‚¨å¯ä»¥åœ¨`ApplicationConfiguration`æ–‡ä»¶ä¸­å°†è¯¥ä½œç”¨åŸŸåˆ†é…ç»™åº”ç”¨ç¨‹åºç»„ä»¶å·¥ä½œè´Ÿè½½çš„å®ä¾‹ï¼Œä»¥å®šæœŸæ£€æŸ¥åº”ç”¨ç¨‹åºå†…ç»„ä»¶çš„æ€»ä½“å¥åº·çŠ¶å†µã€‚*

> **ä½¿ç”¨* `*kubectl get scopes*` *è·å–æ”¯æŒèŒƒå›´çš„åˆ—è¡¨**

*å¦‚æœæ‚¨å¯¹æ­¤æ„Ÿå…´è¶£ï¼Œå¹¶æƒ³æ·±å…¥äº†è§£ï¼Œè¯·æŸ¥çœ‹ä»¥ä¸‹èµ„æº:*

*   *[OAM è§„èŒƒ](https://github.com/oam-dev/spec/blob/master/1.purpose_and_goals.md)ï¼Œä»¥åŠï¼Œ*
*   *[Rudr æ–‡æ¡£](https://github.com/oam-dev/rudr/blob/master/docs/README.md)*

*è¿™æ˜¯ç›®å‰è¶³å¤Ÿçš„ç†è®ºğŸ‘å³å°†å‘å¸ƒçš„å¸–å­å°†é€šè¿‡å…·ä½“çš„ä¾‹å­æ¥å¸®åŠ©å¼ºåŒ–è¿™äº›æ¦‚å¿µã€‚æ•¬è¯·æœŸå¾…ï¼*