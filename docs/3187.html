<html>
<head>
<title>Merging React Refs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">åˆå¹¶ååº”å‚è€ƒ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/mergin-react-refs-5e26f3fcf765?source=collection_archive---------2-----------------------#2019-10-20">https://itnext.io/mergin-react-refs-5e26f3fcf765?source=collection_archive---------2-----------------------#2019-10-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/034d9ba35d13bf20a7679dcbae55556c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L_GAzRRLIrW9BnmKjWZC1A.png"/></div></div></figure><blockquote class="jy jz ka"><p id="91d7" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="iq">TLï¼›DR â€” </em> <code class="fe la lb lc ld b"><em class="iq">useRef</em></code> <em class="iq">å’Œ</em> <code class="fe la lb lc ld b"><em class="iq">createRef</em></code> <em class="iq">å¹¶ä¸æ˜¯æ‚¨å¯èƒ½æ„Ÿå…´è¶£çš„å”¯ä¸€APIè°ƒç”¨ğŸ‘¨â€ğŸ”¬</em></p></blockquote><p id="8ee5" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">è®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸‹â€”â€”ä½ æ­£åœ¨æ‰“å¼€ä¸€ä¸ª<a class="ae lh" href="https://reactjs.org/docs/hooks-reference.html#useimperativehandle" rel="noopener ugc nofollow" target="_blank"> React Hooks API Reference </a>ï¼Œå¯»æ‰¾å¯ç”¨çš„é’©å­ï¼Œç„¶åâ€¦â€¦ä½ çš„çœ¼ç›å‘ç°äº†ä¸€ä¸ªå¥‡æ€ªçš„é’©å­ï¼Œä½ å¯èƒ½ä¹‹å‰é”™è¿‡äº†â€”â€”<code class="fe la lb lc ld b">useImperativeHandle</code>ã€‚ä½ ä»æœªä½¿ç”¨è¿‡å®ƒï¼Œå¯èƒ½ä¹Ÿä»æœªéœ€è¦è¿‡å®ƒï¼Œä¹Ÿä¸çŸ¥é“å®ƒæœ‰ä»€ä¹ˆç”¨ã€‚å¹¶ä¸”æ‰€æä¾›çš„ä¾‹å­å¯¹ç†è§£ç”¨ä¾‹æ²¡æœ‰å¤ªå¤§çš„å¸®åŠ©ã€‚<br/>é‚£ä¹ˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><pre class="li lj lk ll gt lm ld ln lo aw lp bi"><span id="f8fe" class="lq lr iq ld b gy ls lt l lu lv">function FancyInput(props, ref) {<br/>  const inputRef = useRef();<br/>  useImperativeHandle(ref, () =&gt; ({<br/>    focus: () =&gt; {<br/>      inputRef.current.focus();<br/>    }<br/>  }));<br/>  return &lt;input ref={inputRef} ... /&gt;;<br/>}<br/>FancyInput = forwardRef(FancyInput);</span></pre><p id="b3c3" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">å—¯ï¼Œæ­£å¦‚æˆ‘åˆšæ‰æ‰€è¯´â€”â€”é‚£æ²¡ä»€ä¹ˆå¸®åŠ©ã€‚æˆ‘æƒ³æ²¡äººæ˜ç™½è¿™é‡Œå†™çš„æ˜¯ä»€ä¹ˆğŸ¤”ã€‚ä¸ºä»€ä¹ˆå†™åœ¨è¿™é‡ŒğŸ¤·â€â™‚ï¸.è®©æˆ‘ä»¬ç”¨ä¸€è¡Œä»£ç æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><pre class="li lj lk ll gt lm ld ln lo aw lp bi"><span id="81ab" class="lq lr iq ld b gy ls lt l lu lv">function FancyInput(props, ref) {<br/>  const inputRef = useRef();<br/>  useImperativeHandle(ref, () =&gt; ({<br/>+   // this is the PUBLIC API, we are exposing to a consumer via `ref`<br/>    focus: () =&gt; {<br/>      inputRef.current.focus();<br/>    }<br/>  }));<br/>  return &lt;input ref={inputRef} ... /&gt;;<br/>}<br/>FancyInput = forwardRef(FancyInput);</span></pre><p id="f5f2" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">æ¢å¥è¯è¯´â€”â€”æ›¾ç»æœ‰äººä¼š<code class="fe la lb lc ld b">&lt;FancyInput ref={ref} /&gt;</code>è¯´<code class="fe la lb lc ld b">ref</code>åªä¼šåŒ…å«<strong class="ke ir"/><code class="fe la lb lc ld b">.focus</code>ã€‚</p><blockquote class="jy jz ka"><p id="b9bc" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="iq">è¿™é‡Œæœ‰ä¸€ä¸ª</em> <strong class="ke ir"> <em class="iq">ä»£ç ä¸‰ä¸ªç›’å­</em> </strong> <em class="iq">ä½ å¯ä»¥ç”¨</em>ç©</p></blockquote><figure class="li lj lk ll gt jr"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="8b8a" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated"><code class="fe la lb lc ld b">useImperativeHandle</code>çš„åŠ›é‡æ˜¯ä¸€ä¸ª<a class="ae lh" href="https://en.wikipedia.org/wiki/Bridge_pattern" rel="noopener ugc nofollow" target="_blank">æ¡¥</a>çš„åŠ›é‡ï¼Œæˆ–è€…æ›´å…·ä½“åœ°è¯´â€”â€”ä¸€ä¸ª<a class="ae lh" href="https://en.wikipedia.org/wiki/Facade_pattern" rel="noopener ugc nofollow" target="_blank">ç«‹é¢</a> <strong class="ke ir">å›¾æ¡ˆ</strong>(ä½ å¯èƒ½çŸ¥é“å®ƒæ˜¯ä¸€ä¸ª<strong class="ke ir">åŒ…è£…</strong>)ã€‚</p><p id="aa18" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">ç„¶è€Œï¼Œ<code class="fe la lb lc ld b">useImperativeHandle</code>100%æ²¡ç”¨ï¼Œå¯¹ç°å®æ— èƒ½ä¸ºåŠ›â€”â€”æˆ‘ä¼šåœ¨ä¸‹é¢è¯æ˜ã€‚</p><p id="7cd5" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">è®©æˆ‘ä»¬å°†ä¸€åˆ‡åˆ†è§£ä¸ºåŸå­æ“ä½œï¼Œä»¥äº†è§£æˆ‘ä»¬å®é™…ä¸Šéœ€è¦ä»€ä¹ˆï¼Œä»¥åŠè¿˜ç¼ºå°‘ä»€ä¹ˆã€‚</p><h1 id="8f0e" class="ly lr iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">1.å½“è£åˆ¤æ”¹å˜æ—¶ï¼Œæˆ‘æƒ³åšäº›ä»€ä¹ˆ</h1><p id="92eb" class="pw-post-body-paragraph kb kc iq ke b kf mv kh ki kj mw kl km le mx kp kq lf my kt ku lg mz kx ky kz ij bi translated">è®©æˆ‘ä»¬å‡è®¾æ‚¨æƒ³è¦æ ¹æ®<code class="fe la lb lc ld b">ref</code>å€¼å…¬å¼€ä¸åŒçš„çŠ¶æ€ï¼Œå› ä¸º<em class="kd">ä¸åŒçš„</em> <code class="fe la lb lc ld b">refs</code>å¯èƒ½æ„å‘³ç€<em class="kd">ä¸åŒçš„</em>ã€‚ä½†æ˜¯ï¼Œæ‚¨å‘çˆ¶å¯¹è±¡å…¬å¼€çš„<code class="fe la lb lc ld b">wrapper</code>(å’Œ<code class="fe la lb lc ld b">useImperativeHandle</code>â€œå…¬å¼€â€a <code class="fe la lb lc ld b">wrapper</code>)æ˜¯<strong class="ke ir">æ€»æ˜¯é™æ€çš„</strong>ã€‚è¿™åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥ï¼Œä½†åœ¨å…¶ä»–æƒ…å†µä¸‹å°±ä¸è¡Œäº†ã€‚æ¯”å¦‚ï¼Œä½ ä¸èƒ½æš´éœ²ä¸€ä¸ª<code class="fe la lb lc ld b">real ref</code>â€”â€”åªèƒ½æš´éœ²å®ƒå‘¨å›´çš„ä¸€ä¸ª<code class="fe la lb lc ld b">wrapper</code>ï¼Œæ°¸è¿œæ˜¯ä¸€ä¸ª<code class="fe la lb lc ld b">wrapper</code>ã€‚</p><blockquote class="jy jz ka"><p id="dc96" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="iq">ä½ éœ€è¦ç±»ä¼¼äº</em> <code class="fe la lb lc ld b"><em class="iq">useImperativeHandle(ref, inputRef)</em></code> <em class="iq">çš„ä¸œè¥¿æ¥åŒæ­¥</em> <code class="fe la lb lc ld b"><em class="iq">ref.current</em></code> <em class="iq">å’Œ</em> <code class="fe la lb lc ld b"><em class="iq">inputRef.current</em></code> <em class="iq">ä¹‹é—´çš„å€¼ï¼Œä½†æ˜¯å®ƒä¸èµ·ä½œç”¨â€”â€”åªæœ‰</em> <code class="fe la lb lc ld b"><em class="iq">useImperativeHandle(ref, () =&gt; inputRef.current)</em></code> <em class="iq">å¯ä»¥å·¥ä½œï¼Œä½†æ˜¯å½“</em> <code class="fe la lb lc ld b"><em class="iq">inputRef</em></code> <em class="iq">æ”¹å˜æ—¶å®ƒä¸ä¼šæ›´æ–°å€¼ã€‚ä½ æ²¡æœ‰åŠæ³•å¯¹</em> <code class="fe la lb lc ld b"><em class="iq">inputRef.current</em></code> <em class="iq">çš„å˜åŒ–åšå‡ºååº”</em></p></blockquote><p id="c2f6" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">æ‚¨å¯ä»¥å°è¯•ä½¿ç”¨<code class="fe la lb lc ld b">useImperativeHandle</code>é’©å­çš„<code class="fe la lb lc ld b">dependency</code>åˆ—è¡¨æ¥å¤„ç†è¿™ç§æƒ…å†µã€‚ç±»ä¼¼äº:</p><pre class="li lj lk ll gt lm ld ln lo aw lp bi"><span id="0fe7" class="lq lr iq ld b gy ls lt l lu lv">useImperativeHandle( <br/>   ref, <br/>   () =&gt; inputRef.current, <br/>   [mmm, butWhen, itsGoing, toChange] // ğŸ¤·â€â™‚ï¸ ğŸ¤”<br/>);</span></pre><p id="2c8d" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">å¥½å§ï¼Œä½ ä¸éœ€è¦<em class="kd">ä¾èµ–</em>è¿™äº›ä¾èµ–å…³ç³»(å¹¶ä¸”<code class="fe la lb lc ld b">eslint</code>è§„åˆ™ä¸ä¼šå¸®åŠ©ä½ )ï¼Œè€Œæ˜¯ä½ é™„åŠ <code class="fe la lb lc ld b">ref</code>çš„ä¸œè¥¿ã€‚æ›´é‡è¦çš„æ˜¯â€”â€”ä½ å¯ä»¥å°†â€œä½ çš„â€<code class="fe la lb lc ld b">ref</code>é™„åŠ åˆ°åŒä¸€ä¸ª<code class="fe la lb lc ld b">forwardProp</code>ç»„ä»¶ä¸Šï¼Œè¿™æ ·åšä¹Ÿæ˜¯ä¸€æ ·çš„â€”â€”<strong class="ke ir">ä½ ä¸èƒ½æ§åˆ¶ä»€ä¹ˆæ˜¯</strong><code class="fe la lb lc ld b"><strong class="ke ir">ref</strong></code><strong class="ke ir"/>ã€‚è¿™æ˜¯ä¸€ä¸ªé»‘ç›’ï¼Œä½ ä¸å¯èƒ½å®‰å…¨åœ°é¢„æµ‹è¿™ä¸ªé»‘ç›’æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><blockquote class="jy jz ka"><p id="2356" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">è¿™ç§å›¾æ¡ˆéå¸¸æ˜“ç¢ï¼Œè¯·ä¸è¦ä½¿ç”¨ã€‚è¯·è®°ä½ï¼Œå®˜æ–¹æ–‡æ¡£ä¹Ÿè¦æ±‚ä¸è¦ä½¿ç”¨å®ƒã€‚</p></blockquote><p id="0f1d" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">ä½¿è¿™ç§æ¨¡å¼â€œç¨³å®šâ€çš„å”¯ä¸€æ–¹æ³•æ˜¯çŸ¥é“<code class="fe la lb lc ld b">ref</code>ä½•æ—¶æ›´æ–°ï¼Œå¹¶ä¸”<em class="kd">ååº”æ€§åœ°</em>æ›´æ–°<code class="fe la lb lc ld b">parentRef</code>ã€‚<br/>æ€ä¹ˆåšï¼Ÿä½¿ç”¨å‚è€ƒå·<code class="fe la lb lc ld b">callback</code>ï¼è¿™æ˜¯å®˜æ–¹çš„å»ºè®®ã€‚</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/b9ba0914b8f369c4645b61e4b76695f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rUS06qwF_cfoPY4f.png"/></div></div></figure><p id="2330" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">è¿™ä¹Ÿä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚å›è°ƒå¹¶ä¸å¥½ï¼Œå¯èƒ½è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬æœ‰<code class="fe la lb lc ld b">RefObject</code>ã€‚</p><p id="8a6f" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">å¦‚ä½•ä½¿ç”¨<code class="fe la lb lc ld b">RefObject</code>å¹¶å¾—åˆ°å˜æ›´é€šçŸ¥ï¼Ÿç®€å•ï¼Œå’Œes5å…¼å®¹ã€‚</p><pre class="li lj lk ll gt lm ld ln lo aw lp bi"><span id="fcdd" class="lq lr iq ld b gy ls lt l lu lv">function createCallbackRef(onChangeCallback) {<br/>  let current = null;<br/>  return {<br/>    set current(newValue) {<br/>      // new value set<br/>      current=newValue;<br/>      onChangeCallback(newValue);<br/>    }<br/>    get current() {<br/>      // what shall I return?<br/>      return current;<br/>    }<br/>  }<br/>}</span></pre><p id="fde0" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">å¯¹è±¡<strong class="ke ir">è·å–å™¨å’Œè®¾ç½®å™¨</strong>ç”¨äºæ•‘æ´ã€‚è¿˜æœ‰å¦ä¸€ç¯‡å…³äºè¿™ç§æ–¹æ³•çš„æ–‡ç« ï¼Œæ·±å…¥è§£é‡Šäº†ä¸åŒçš„ç”¨ä¾‹:</p><div class="nb nc gp gr nd ne"><a href="https://dev.to/thekashey/the-same-useref-but-it-will-callback-8bo" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd ir gy z fp nj fr fs nk fu fw ip bi translated">åŒä¸€ä¸ªuseRefï¼Œä½†æ˜¯å®ƒä¼šå›è°ƒğŸ¤™</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œæˆ‘ä»¬æ²¡æœ‰ref-æˆ‘ä»¬åªæœ‰refï¼Œå®ƒæ˜¯åŸºäºå›è°ƒçš„ã€‚æŸäº›ä¸œè¥¿ä¼šé€šè¿‡è°ƒç”¨æ¥è®¾ç½®è£åˆ¤â€¦</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">å¼€å‘åˆ°</p></div></div><div class="nn l"><div class="no l np nq nr nn ns jw ne"/></div></div></a></div><h1 id="176a" class="ly lr iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">2.æˆ‘æƒ³ä½¿ç”¨å¯¹DOMå¯¹è±¡çš„å¼•ç”¨</h1><p id="e250" class="pw-post-body-paragraph kb kc iq ke b kf mv kh ki kj mw kl km le mx kp kq lf my kt ku lg mz kx ky kz ij bi translated">è¿™å¾ˆå¥½ï¼Œä½†æ˜¯å½“æ‚¨éœ€è¦å¤„ç†çœŸæ­£çš„DOMå…ƒç´ æ—¶ï¼Œè¿™å¹¶æ²¡æœ‰ä»€ä¹ˆå¸®åŠ©ã€‚<br/>é—®é¢˜è¿˜æ˜¯ä¸€æ ·â€”â€”è®©<strong class="ke ir">æœ‰ä¸€ä¸ªæœ¬åœ°å¼•ç”¨</strong>ï¼Œå¹¶å°†å…¶ä¸çˆ¶å¼•ç”¨åŒæ­¥ã€‚ä½ éœ€è¦ä¸€çŸ³äºŒé¸Ÿã€‚æˆ‘çš„æ„æ€æ˜¯-ä½ éœ€è¦æ›´æ–°ä¸¤ä¸ªå°±åƒåªæœ‰ä¸€ä¸ªï¼</p><figure class="li lj lk ll gt jr"><div class="bz fp l di"><div class="nt lx l"/></div></figure><p id="58bb" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">äº‹å®ä¸Šâ€”â€”è¿™æ˜¯ä¸€ä¸ªéå¸¸éœ€è¦å’Œéå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œå°±åƒ<code class="fe la lb lc ld b">forwardRef</code>æœ¬èº«ä¸€æ ·æœ‰ç”¨â€”â€”èƒ½å¤Ÿåœ¨æœ¬åœ°ç»´æŠ¤<code class="fe la lb lc ld b">ref</code>,å¯¹äºå¤–éƒ¨æ¶ˆè´¹è€…æ¥è¯´ä»ç„¶æ˜¯<em class="kd">é€æ˜çš„</em>ã€‚</p><p id="64d9" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">ä»æŸç§è§’åº¦æ¥çœ‹ï¼Œ<code class="fe la lb lc ld b">mergeRef</code>æ˜¯ä¸€ä¸ª<code class="fe la lb lc ld b">forwardRef</code>ï¼Œåªè¦å®ƒ<em class="kd">å‘å‰</em>ä¸€ä¸ªç»™å®šçš„refï¼Œå°±ä¸æ­¢ä¸€ä¸ªä½ç½®ã€‚</p><h1 id="73aa" class="ly lr iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">3.æˆ‘æƒ³æ›´æ–°å‚è€ƒæ–‡çŒ®</h1><p id="1a00" class="pw-post-body-paragraph kb kc iq ke b kf mv kh ki kj mw kl km le mx kp kq lf my kt ku lg mz kx ky kz ij bi translated">ä½†æ˜¯ï¼Œ<code class="fe la lb lc ld b">ref</code>æ˜¯ä»€ä¹ˆï¼Ÿå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡(<code class="fe la lb lc ld b">ref object</code>)ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°(<code class="fe la lb lc ld b">callback ref</code>)ã€‚å¦‚æœä¸çŸ¥é“æä¾›çš„<code class="fe la lb lc ld b">ref</code>æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•è®¾ç½®æ–°å€¼ï¼Ÿ</p><p id="cc29" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated"><code class="fe la lb lc ld b">React</code>å’Œ<code class="fe la lb lc ld b">useImperativeHandle</code>ä»¥åŠ<code class="fe la lb lc ld b">mergeRef</code>éƒ½åœ¨å†…éƒ¨éšè—äº†è¿™ä¸ªé€»è¾‘ï¼Œä½†æ˜¯åœ¨å…¶ä»–æƒ…å†µä¸‹ä½ å¯èƒ½éœ€è¦å®ƒã€‚ä»¥<code class="fe la lb lc ld b">useEffect</code>ä¸ºä¾‹ã€‚<br/>æ‰€ä»¥ç»™ä½ :</p><pre class="li lj lk ll gt lm ld ln lo aw lp bi"><span id="972a" class="lq lr iq ld b gy ls lt l lu lv">function assignRef&lt;T&gt;(ref, value) {<br/>  if (typeof ref === 'function') {<br/>    ref(value);<br/>  } else if (ref != null) {<br/>    ref.current = value;<br/>  }<br/>  return ref;<br/>}</span></pre><p id="e3f8" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">å¦‚æœå°†æ¥<code class="fe la lb lc ld b">ref</code>çš„å½¢çŠ¶ä¼šå†æ¬¡æ”¹å˜ï¼Œå°±åƒReact 16å‘å¸ƒæ—¶é‚£æ ·ï¼Œè¿™å°†åªæ˜¯ä¸€ä¸ªéœ€è¦æ›´æ–°çš„å‡½æ•°ã€‚</p><h1 id="5bec" class="ly lr iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">4.æˆ‘æƒ³æ”¹å˜æˆ‘çš„è£åˆ¤</h1><p id="aac5" class="pw-post-body-paragraph kb kc iq ke b kf mv kh ki kj mw kl km le mx kp kq lf my kt ku lg mz kx ky kz ij bi translated">å“ª(æƒŠå–œï¼)æ˜¯<code class="fe la lb lc ld b">useImperativeHandle</code>æ‰€åšçš„â€”â€”å®ƒç»™ä½ ä¸€ä¸ªç¼–ç¨‹çš„æ–¹æ³•æ¥è¿”å›å…¶ä»–çš„ä¸œè¥¿ï¼Œä»åŸå§‹çš„refã€‚</p><p id="e5cf" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">æ‰€ä»¥ï¼Œå¦‚æœä½ æƒ³:</p><ul class=""><li id="349d" class="nu nv iq ke b kf kg kj kk le nw lf nx lg ny kz nz oa ob oc bi translated">æœ‰ä¸€ä¸ª<code class="fe la lb lc ld b">local ref</code>ï¼ŒæŒ‡çš„æ˜¯çœŸæ­£çš„DOMèŠ‚ç‚¹</li><li id="a621" class="nu nv iq ke b kf od kj oe le of lf og lg oh kz nz oa ob oc bi translated">ç”¨<code class="fe la lb lc ld b">.focus</code>æ–¹æ³•å‘çˆ¶å¯¹è±¡å…¬å¼€ref</li></ul><p id="d512" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">ç„¶åä½ å¿…é¡»åˆå¹¶å’Œè½¬æ¢</p><pre class="li lj lk ll gt lm ld ln lo aw lp bi"><span id="27bd" class="lq lr iq ld b gy ls lt l lu lv">-useImperativeHandle(ref, () =&gt; ({<br/>-  focus: () =&gt; {<br/>-    inputRef.current.focus();<br/>-  }<br/>-}));<br/>mergeRefs([innerRef, tranformRef(ref, (current) =&gt; ({focus:() =&gt; current.focus()})</span></pre><p id="4d8e" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">å¦‚ä½•åˆ›ä½œ<code class="fe la lb lc ld b">transformRef</code>ï¼Ÿå—¯ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›æˆ‘ä»¬å·²ç»æœ‰çš„é›¶ä»¶- <code class="fe la lb lc ld b">callbackRef</code>å’Œ<code class="fe la lb lc ld b">assignRef</code></p><pre class="li lj lk ll gt lm ld ln lo aw lp bi"><span id="efe8" class="lq lr iq ld b gy ls lt l lu lv">function transformRef(ref, transformer) {<br/>  return createCallbackRef(<br/>    value =&gt; assignRef(ref, transformer(value))<br/>  )<br/>}</span></pre><p id="66e7" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated"><code class="fe la lb lc ld b">transformRef</code>æ˜¯ä¸¤ä¸ªä¸–ç•Œä¹‹é—´çœŸæ­£çš„â€œæ¡¥æ¢â€ï¼Œä¾‹å¦‚åœ¨è¿™ä¸ª<a class="ae lh" href="https://github.com/theKashey/react-focus-lock/issues/85" rel="noopener ugc nofollow" target="_blank">é—®é¢˜</a>ä¸­ï¼Œæœ‰äººéœ€è¦å°†ä¸€ä¸ªâ€œrefï¼Œå­˜å‚¨åœ¨ä¸€ä¸ªClassComponentå®ä¾‹ä¸­ï¼Œä¼ é€’ç»™çˆ¶å¯¹è±¡â€ã€‚</p><pre class="li lj lk ll gt lm ld ln lo aw lp bi"><span id="49ce" class="lq lr iq ld b gy ls lt l lu lv">const FocusLock = ({As}) =&gt; &lt;As ref={ref} /&gt;</span><span id="535c" class="lq lr iq ld b gy oi lt l lu lv">const ResizableWithRef = forwardRef((props, ref) =&gt;<br/>  &lt;Resizable {...props} ref={i =&gt; i &amp;&amp; ref(i.resizable)}/&gt;<br/>  // i is a ref to a Class Component with .resizable property<br/>);<br/>// ...<br/>&lt;FocusLock as={ResizableWithRef}&gt;</span></pre><ul class=""><li id="13f2" class="nu nv iq ke b kf kg kj kk le nw lf nx lg ny kz nz oa ob oc bi translated"><code class="fe la lb lc ld b">FocusLock</code>æœŸæœ›<code class="fe la lb lc ld b">ref</code>æˆä¸º<code class="fe la lb lc ld b">DOMNode</code></li><li id="2ab2" class="nu nv iq ke b kf od kj oe le of lf og lg oh kz nz oa ob oc bi translated"><code class="fe la lb lc ld b">Resizable</code>æ˜¯ä¸€ä¸ª<strong class="ke ir">ç±»</strong>ç»„ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†<code class="fe la lb lc ld b">ref</code>è½¬æ¢æˆä¸€ä¸ª<strong class="ke ir">ç±»å®ä¾‹</strong></li><li id="b640" class="nu nv iq ke b kf od kj oe le of lf og lg oh kz nz oa ob oc bi translated"><code class="fe la lb lc ld b">i =&gt; i &amp;&amp; ref(i.resizable)</code> -å›è°ƒref - <em class="kd">å°†</em> <code class="fe la lb lc ld b">i.resizable</code>è½¬æ¢ä¸ºç„¦ç‚¹é”å®šrefï¼Œ<em class="kd">è‡ªé€‚åº”</em>APIã€‚</li></ul><p id="245a" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">å’Œ<code class="fe la lb lc ld b">transformRef</code>åœ¨ä¸€èµ·ä¼šæ˜¯ä»€ä¹ˆæ ·å­</p><pre class="li lj lk ll gt lm ld ln lo aw lp bi"><span id="1d11" class="lq lr iq ld b gy ls lt l lu lv">&lt;Resizable {...props} ref={transformRef(ref, i =&gt; i.resizable)}/&gt;</span></pre><p id="60a8" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">çœ‹èµ·æ¥ä¸€æ ·ï¼Œä½†ä¸è¦æ±‚<code class="fe la lb lc ld b">ref</code>æ˜¯<code class="fe la lb lc ld b">callback ref</code>â€”â€”ä½ ä¸éœ€è¦æ‹…å¿ƒ<code class="fe la lb lc ld b">how</code>ä½ è¦åšä»€ä¹ˆï¼Œåªéœ€è¦æ‹…å¿ƒ<code class="fe la lb lc ld b">what</code>ä½ è¦åšä»€ä¹ˆã€‚</p><h1 id="76e3" class="ly lr iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">5.æˆ‘å¸Œæœ›æˆ‘çš„è£åˆ¤ä¸è¦æ¯æ¬¡éƒ½é‡æ–°ä¸Šé©¬</h1><p id="23ec" class="pw-post-body-paragraph kb kc iq ke b kf mv kh ki kj mw kl km le mx kp kq lf my kt ku lg mz kx ky kz ij bi translated">ä¸çŸ¥é“ä½ æ˜¯å¦æ³¨æ„åˆ°äº†ï¼Œä½†æ˜¯ä¸Šé¢çš„ä»£ç (æ˜¯çš„ï¼Œä¸Šé¢çš„æ‰€æœ‰ä»£ç )å¯ä»¥å·¥ä½œï¼Œä½†æ˜¯ä¸ä¼šè®©ä½ (å’Œååº”)å¼€å¿ƒã€‚</p><p id="4a39" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">é—®é¢˜æ˜¯:å½“<code class="fe la lb lc ld b">ref</code>æ”¹å˜æ—¶ï¼Œ<code class="fe la lb lc ld b">React</code>ä¼šå°†<code class="fe la lb lc ld b">null</code>è®¾ç½®ä¸ºæ—§å€¼ï¼Œç„¶åå°†æ­£ç¡®çš„å€¼è®¾ç½®ä¸ºæ–°å€¼ã€‚è€Œä¸”ï¼Œåªè¦ä¸Šé¢çš„æ‰€æœ‰å‡½æ•°æ¯æ¬¡éƒ½è¿”å›ä¸€ä¸ªæ–°å‡½æ•°æˆ–æ–°å¯¹è±¡â€”â€”æ¯æ¬¡å®ƒä»¬éƒ½ä¼šå¯¼è‡´æœ¬åœ°å’Œçˆ¶refsçš„æ›´æ–°ã€‚</p><blockquote class="jy jz ka"><p id="259f" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">å¦‚æœä½ ä½¿ç”¨å›è°ƒå¼•ç”¨ï¼Œå¹¶åŸºäºå®ƒä»¬çš„å€¼è¿è¡Œä¸€äº›æ•ˆæœâ€”â€”é‚£ä¹ˆè¿™å°†å¯¼è‡´æ›´å¤§çš„æ›´æ–°ã€‚</p></blockquote><p id="832a" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">æˆ‘ä»¬ä¸è¦é‚£æ ·åšã€‚è®©æˆ‘ä»¬ç”¨<code class="fe la lb lc ld b">hooks</code>æ¥è®°å¿†<code class="fe la lb lc ld b">ref</code></p><pre class="li lj lk ll gt lm ld ln lo aw lp bi"><span id="ef40" class="lq lr iq ld b gy ls lt l lu lv">function useTransformRef(ref, transformer) {<br/>  return useState(() =&gt; createCallbackRef(<br/>    value =&gt; assignRef(ref, transformer(value))<br/>  ))[0];<br/>}</span></pre><p id="b57e" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">ç®€å•è€Œå¯é â€”â€”æˆ‘ä»¬ä½¿ç”¨<code class="fe la lb lc ld b">useState</code>å’Œ<code class="fe la lb lc ld b">state fabric</code>ä½œä¸ºå‚æ•°ï¼Œåªåˆ›å»ºä¸€æ¬¡refï¼Œè®©æˆ‘ä»¬çš„ä»£ç æ‰§è¡Œèµ·æ¥æ›´åŠ ç®€å•ã€‚</p><h1 id="7b91" class="ly lr iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">ç»“è®º</h1><p id="ee0a" class="pw-post-body-paragraph kb kc iq ke b kf mv kh ki kj mw kl km le mx kp kq lf my kt ku lg mz kx ky kz ij bi translated">æœ‰ä¸€ä¸ªåº“ï¼Œå·²ç»å®ç°äº†æˆ‘ä¸Šé¢æä¾›çš„æ‰€æœ‰çš„<em class="kd">åŸå­</em>ï¼Œç»è¿‡æµ‹è¯•å’Œç±»å‹åŒ–:</p><div class="nb nc gp gr nd ne"><a href="https://github.com/theKashey/use-callback-ref" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd ir gy z fp nj fr fs nk fu fw ip bi translated">å¡ä»€/ä½¿ç”¨å›è°ƒå¼•ç”¨</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">è¯·è®°ä½ï¼ŒuseRefä¸ä¼šåœ¨å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶é€šçŸ¥æ‚¨ã€‚å˜å¼‚äº†ã€‚å½“å‰å±æ€§ä¸ä¼šå¯¼è‡´â€¦</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">github.com</p></div></div><div class="nn l"><div class="oj l np nq nr nn ns jw ne"/></div></div></a></div></div><div class="ab cl ok ol hu om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="ij ik il im in"><ul class=""><li id="8d53" class="nu nv iq ke b kf kg kj kk le nw lf nx lg ny kz nz oa ob oc bi translated"><code class="fe la lb lc ld b">assignRef</code></li><li id="f0f0" class="nu nv iq ke b kf od kj oe le of lf og lg oh kz nz oa ob oc bi translated"><code class="fe la lb lc ld b">useCallbackRef</code> / <code class="fe la lb lc ld b">createCallbackRef</code></li><li id="3a85" class="nu nv iq ke b kf od kj oe le of lf og lg oh kz nz oa ob oc bi translated"><code class="fe la lb lc ld b">useMergeRefs</code> / <code class="fe la lb lc ld b">mergeRefs</code></li><li id="1b45" class="nu nv iq ke b kf od kj oe le of lf og lg oh kz nz oa ob oc bi translated"><code class="fe la lb lc ld b">useTransformRef</code> / <code class="fe la lb lc ld b">transformRef</code></li><li id="dfb2" class="nu nv iq ke b kf od kj oe le of lf og lg oh kz nz oa ob oc bi translated"><code class="fe la lb lc ld b">useRefToCallback</code> / <code class="fe la lb lc ld b">refToCallback</code></li></ul><blockquote class="jy jz ka"><p id="07a7" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="iq">å£°æ˜:æ‰€æœ‰</em> <code class="fe la lb lc ld b"><em class="iq">mergeRefs</em></code> <em class="iq">çš„è£èª‰å½’äºæ ¼é›·æ ¼Â·ä¼¯å¥‡å’Œ</em><a class="ae lh" href="https://github.com/smooth-code/react-merge-refs" rel="noopener ugc nofollow" target="_blank"><em class="iq">react-merge-refs</em></a></p></blockquote></div></div>    
</body>
</html>