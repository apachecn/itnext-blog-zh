# è®°å¿†å‹¿å¿˜æˆ‘ç‚¸å¼¹

> åŸæ–‡ï¼š<https://itnext.io/kashe-memoization-forget-me-bomb-db14e9597e05?source=collection_archive---------3----------------------->

![](img/dcaefc671faa39322056520129c7f94f.png)

> è¿˜è®°å¾—å—ï¼Ÿä¸è¦ï¼

ä½ å¬è¯´è¿‡*è®°å¿†*å—ï¼Ÿè¿™æ˜¯ä¸€ä»¶è¶…çº§ç®€å•çš„äº‹æƒ…ã€‚åªéœ€*è®°ä½*ä½ ä»ç¬¬ä¸€æ¬¡å‡½æ•°è°ƒç”¨ä¸­å¾—åˆ°çš„ç»“æœï¼Œå¹¶ä½¿ç”¨å®ƒè€Œä¸æ˜¯ç¬¬äºŒæ¬¡è°ƒç”¨å‡½æ•°â€”â€”ä¸è¦æ¯«æ— ç†ç”±åœ°è°ƒç”¨çœŸå®çš„ä¸œè¥¿ï¼Œä¸è¦æµªè´¹ä½ çš„æ—¶é—´ã€‚æ˜¯çš„ï¼Œè¿™åªé€‚ç”¨äºçº¯å‡½æ•°ï¼Œå½“ç›¸åŒå‚æ•°çš„ç»“æœç›¸åŒæ—¶ã€‚

> å¦‚æœç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä½ ä¸ºä»€ä¹ˆè¦åšä¸¤æ¬¡å‘¢ï¼Ÿ

**è·³è¿‡**ä¸€äº›**å¯†é›†å‹æ“ä½œ**æ˜¯ä¸€ç§å¾ˆå¸¸è§çš„ä¼˜åŒ–æŠ€æœ¯ã€‚æ¯æ¬¡ä½ å¯èƒ½**ä¸** **åš**æŸäº‹â€”â€”**ä¸è¦åš**ã€‚å°½é‡ä½¿ç”¨ç¼“å­˜â€” `memcache`ã€`file cache`ã€`local cache` â€”ä»»æ„ç¼“å­˜ï¼è¿™æ˜¯é«˜è´Ÿè½½ç³»ç»Ÿçš„å¿…å¤‡ç»„ä»¶ï¼Œä¹Ÿæ˜¯è¿‡å»å’Œç°åœ¨ä»»ä½•åç«¯ç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚

æ˜ç™½äº†å—ï¼Ÿç®—äº†å§ï¼

![](img/ec70448aa5d13471f9b08b8c018b5a4e.png)

# è®°å¿†ä¸ç¼“å­˜

> è®°å¿†åŒ–å°±åƒç¼“å­˜ã€‚åªæ˜¯æœ‰ç‚¹ä¸åŒã€‚ä¸æ˜¯**ç¼“å­˜**ï¼Œå§‘ä¸”ç§°ä¹‹ä¸º**å¡èˆ**ã€‚

é•¿è¯çŸ­è¯´ï¼Œä½†æ˜¯è®°å¿†åŒ–ä¸æ˜¯ç¼“å­˜ï¼Œä¹Ÿä¸æ˜¯æ°¸ä¹…ç¼“å­˜ã€‚è®°å¿†ç”šè‡³å¬èµ·æ¥åƒæ˜¯ä¸€ç¬é—´ã€‚åœ¨æœåŠ¡å™¨ç«¯è¿™å¯èƒ½æ˜¯ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´ï¼Œä½†åœ¨å®¢æˆ·ç«¯ä¸å¯èƒ½ä¹Ÿä¸åº”è¯¥æ˜¯çœŸæ­£çš„é•¿æœŸç¼“å­˜ã€‚æ›´å¤šçš„æ˜¯å…³äºå¯ç”¨èµ„æºã€ä½¿ç”¨æ¨¡å¼å’Œä½¿ç”¨çš„ç†ç”±ã€‚

## é—®é¢˜â€”ç¼“å­˜éœ€è¦ä¸€ä¸ªâ€œç¼“å­˜é”®â€

ç¼“å­˜ä½¿ç”¨ä¸€ä¸ª**å­—ç¬¦ä¸²** `cache key`å­˜å‚¨å’Œè·å–æ•°æ®ã€‚æ„é€ ä¸€ä¸ªå”¯ä¸€ä¸”å¯ç”¨çš„é”®å·²ç»æ˜¯ä¸€ä¸ªé—®é¢˜äº†ï¼Œä½†æ˜¯ä½ å¿…é¡»å¯¹æ•°æ®è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œç„¶åå†å­˜å‚¨åœ¨åŸºäºå­—ç¬¦ä¸²çš„ä»‹è´¨ä¸­â€¦â€¦ç®€è€Œè¨€ä¹‹ï¼Œç¼“å­˜å¯èƒ½æ²¡æœ‰ä½ æƒ³è±¡çš„é‚£ä¹ˆå¿«ï¼Œå°¤å…¶æ˜¯åˆ†å¸ƒå¼ç¼“å­˜ã€‚

## è®°å¿†ä¸éœ€è¦ä»»ä½•ç¼“å­˜é”®

åŒæ—¶ï¼Œè®°å¿†ä¸éœ€è¦é’¥åŒ™ã€‚é€šå¸¸* å®ƒæŒ‰åŸæ ·ä½¿ç”¨å‚æ•°ï¼Œä¸è¯•å›¾ä»å®ƒä»¬ä¸­åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„é”®ï¼Œä¹Ÿä¸åƒç¼“å­˜é€šå¸¸åšçš„é‚£æ ·ï¼Œä½¿ç”¨ä¸€äº›å…¨å±€å¯ç”¨çš„å…±äº«å¯¹è±¡ï¼Œå¦‚`window.cache`æ¥å­˜å‚¨ç»“æœã€‚

> å†…å­˜åŒ–å’Œç¼“å­˜çš„åŒºåˆ«åœ¨äº API æ¥å£ï¼

**é€šå¸¸*ä¸ä»£è¡¨*æ€»æ˜¯*ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ`Lodash.memoize`ä½¿ç”¨`JSON.stringify`å°†ä¼ é€’çš„å‚æ•°è½¬æ¢åˆ°å­—ç¬¦ä¸²ç¼“å­˜ä¸­ã€‚å› ä¸ºä»–ä»¬è¦ç”¨è¿™ä¸ªé”®æ¥è®¿é—®ä¸€ä¸ªå†…éƒ¨å¯¹è±¡ï¼Œä¿å­˜ä¸€ä¸ªç¼“å­˜çš„å€¼ã€‚[å¿«é€Ÿè®°å¿†](https://community.risingstack.com/the-worlds-fastest-javascript-memoization-library/)ã€*ã€ã€æœ€å¿«çš„è®°å¿†åº“ã€‘*ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¸¤ä¸ªå‘½ååº“éƒ½ä¸æ˜¯*å†…å­˜åŒ–*åº“ï¼Œè€Œæ˜¯*ç¼“å­˜*åº“ã€‚

> å€¼å¾—ä¸€æçš„æ˜¯â€”â€”`JSON.stringify`å¯èƒ½æ¯”ä½ è¦*è®°å¿†*çš„å‡½æ•°æ…¢ 10 å€ã€‚

**æ˜¾ç„¶ï¼Œ**è¿™ä¸ªé—®é¢˜æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ä¸ä½¿ç”¨ç¼“å­˜é”®ï¼Œå¹¶ä¸”ä¸ä½¿ç”¨é‚£ä¸ªé”®è®¿é—®ä¸€äº›å†…éƒ¨ç¼“å­˜ã€‚æ‰€ä»¥ï¼Œè®°ä½ä½ è¢«è°ƒç”¨çš„æœ€åä¸€ä¸ªå‚æ•°ï¼Œæ¯”å¦‚[memoizeric](https://github.com/thinkloop/memoizerific)ï¼Œmemoize-one æˆ–è€… reselect doã€‚æ˜¯çš„â€”â€”æ‰€æœ‰æœ€å¥½çš„è®°å¿†åº“éƒ½æ˜¯è¿™æ ·åšçš„ã€‚

> memoizeric å¯èƒ½æ˜¯ä½ å”¯ä¸€æƒ³ä½¿ç”¨çš„**é€šç”¨**ç¼“å­˜åº“ã€‚

## ç¼“å­˜å¤§å°

æ‰€æœ‰åº“ä¹‹é—´çš„ç¬¬äºŒå¤§åŒºåˆ«æ˜¯ç¼“å­˜å¤§å°å’Œç¼“å­˜ç»“æ„ã€‚

ä½ æœ‰æ²¡æœ‰æƒ³è¿‡â€”â€”ä¸ºä»€ä¹ˆ`reselect`æˆ–`memoize-one`åªæŒæœ‰ä¸€ä¸ªï¼Œæœ€åçš„ç»“æœï¼Ÿä¸æ˜¯ä¸ºäº†"*ä¸ä½¿ç”¨ç¼“å­˜é”®èƒ½å¤Ÿå­˜å‚¨å¤šä¸ªç»“æœ"*ï¼Œè€Œæ˜¯å› ä¸º**æ²¡æœ‰ç†ç”±å­˜å‚¨æ¯”ä»…ä¸€ä¸ª**æœ€åç»“æœ**æ›´å¤šçš„**ã€‚

â€¦å®ƒæ›´å¤šçš„æ˜¯å…³äº:

*   å¯ç”¨èµ„æºâ€”â€”å•ä¸ªç¼“å­˜è¡Œæ˜¯éå¸¸èµ„æºå‹å¥½çš„
*   ä½¿ç”¨æ¨¡å¼â€”â€”è®°ä½â€œåŸåœ°â€çš„ä¸œè¥¿æ˜¯ä¸€ä¸ªå¥½çš„æ¨¡å¼ã€‚â€œå°±åœ°â€ä½ é€šå¸¸åªéœ€è¦ä¸€ä¸ªï¼Œæœ€åä¸€ä¸ªï¼Œç»“æœã€‚
*   ä½¿ç”¨ç†ç”±â€”â€”æ¨¡å—åŒ–ã€éš”ç¦»å’Œå†…å­˜å®‰å…¨æ˜¯å¾ˆå¥½çš„ç†ç”±ã€‚å°±ç¼“å­˜å†²çªè€Œè¨€ï¼Œä¸ä¸åº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†å…±äº«ç¼“å­˜æ›´å®‰å…¨ã€‚

# å•ä¸€ç»“æœï¼Ÿï¼

æ˜¯çš„â€”â€”å”¯ä¸€çš„ä¸€ä¸ªç»“æœã€‚ä¸€ä¸ªç»“æœè®°å¿†äº†ä¸€äº›ç»å…¸çš„ä¸œè¥¿ï¼Œæ¯”å¦‚è®°å¿†çš„æ–æ³¢é‚£å¥‘æ•°ç”Ÿæˆï¼Œä½ å¯ä»¥åœ¨æ¯ç¯‡å…³äºè®°å¿†çš„æ–‡ç« ä¸­æ‰¾åˆ°è¿™ä¸ªä¾‹å­ã€‚ä½†æ˜¯ï¼Œé€šå¸¸ï¼Œä½ åœ¨åšåˆ«çš„äº‹æƒ…â€”â€”è°éœ€è¦å‰ç«¯çš„æ–æ³¢é‚£å¥‘ï¼Ÿåœ¨åç«¯ï¼ŸçœŸå®ä¸–ç•Œçš„ä¾‹å­ä¸æŠ½è±¡çš„ IT æµ‹éªŒç›¸å»ç”šè¿œã€‚

ä½†æ˜¯ï¼Œå…³äºå•å€¼è®°å¿†ç±»å‹è¿˜æœ‰ä¸¤ä¸ªå¤§é—®é¢˜ã€‚

## é—®é¢˜ 1â€”â€”å®ƒå¾ˆâ€œè„†å¼±â€

é»˜è®¤æƒ…å†µä¸‹â€”æ‰€æœ‰å‚æ•°éƒ½åº”è¯¥åŒ¹é…ï¼Œç¡®åˆ‡åœ°è¯´**æ˜¯â€œ===â€ç›¸åŒçš„**ã€‚å¦‚æœä¸€ä¸ªè®ºç‚¹ä¸åŒ¹é…ï¼Œæ¸¸æˆå°±ç»“æŸäº†ã€‚å³ä½¿è¿™æ¥è‡ªè®°å¿†åŒ–çš„æƒ³æ³•â€”â€”é‚£å¯èƒ½ä¸æ˜¯ä½ ç°åœ¨æƒ³è¦çš„ä¸œè¥¿ã€‚æˆ‘çš„æ„æ€æ˜¯â€”â€”ä½ æƒ³å°½å¯èƒ½å¤šåœ°å›å¿†ï¼Œå°½å¯èƒ½ç»å¸¸åœ°å›å¿†ã€‚

> å³ä½¿ç¼“å­˜æœªå‘½ä¸­ä¹Ÿæ˜¯ç¼“å­˜æ“¦é™¤çˆ†å¤´ã€‚

â€œç°åœ¨â€å’Œâ€œè¿‡å»â€ä¹‹é—´æœ‰ä¸€ç‚¹ç‚¹ä¸åŒâ€”â€”ä¸å¯å˜çš„æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚åœ¨ Redux ä¸­ä½¿ç”¨çš„ã€‚

```
const getSomeDataFromState = memoize(state => compute(state.tasks));
```

å¥½çœ‹å—ï¼Ÿå‘å³çœ‹ï¼Ÿç„¶è€Œå½“`tasks`ä¸å˜çš„æ—¶å€™`state`å¯èƒ½ä¼šæ”¹å˜ï¼Œä½ åªéœ€è¦`tasks`æ¥åŒ¹é…ã€‚

**ç»“æ„é€‰æ‹©è€…**åœ¨è¿™é‡Œç”¨ä»–ä»¬æœ€å¼ºçš„æˆ˜å£«**é‡æ–°é€‰æ‹©**åœ¨ä½ çš„å¬å”¤ä¸‹æ‹¯æ•‘ä¸–ç•Œã€‚Reselect ä¸ä»…ä»…æ˜¯è®°å¿†åŒ–åº“ï¼Œå®ƒçš„åŠ›é‡æ¥è‡ªè®°å¿†åŒ–**çº§è”**ï¼Œæˆ–è€…é€é•œ(å®ƒä»¬ä¸æ˜¯ï¼Œä½†æ˜¯æŠŠé€‰æ‹©å™¨æƒ³è±¡æˆå…‰å­¦é€é•œ)ã€‚

```
// every time `state` changes, cached value would be rejected
const getTasksFromState = createSelector(state => state.tasks);const getSomeDataFromState = createSelector(
  // `tasks` "without" `state`
  **getTasksFromState**,            
  // and this operation would be memoized "more often"
  tasks => compute(state.tasks) 
);
```

å› æ­¤ï¼Œåœ¨ä¸å¯å˜æ•°æ®çš„æƒ…å†µä¸‹â€”â€”æ‚¨æ€»æ˜¯å¿…é¡»é¦–å…ˆ"**å…³æ³¨**æ‚¨çœŸæ­£éœ€è¦çš„æ•°æ®ï¼Œç„¶åâ€”â€”æ‰§è¡Œè®¡ç®—ï¼Œå¦åˆ™ç¼“å­˜å°†è¢«æ‹’ç»ï¼Œæ‰€æœ‰è®°å¿†åŒ–èƒŒåçš„æƒ³æ³•éƒ½å°†æ¶ˆå¤±ã€‚

è¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¤§é—®é¢˜ï¼Œå°¤å…¶æ˜¯å¯¹æ–°æ‰‹æ¥è¯´ï¼Œä½†æ˜¯ä½œä¸ºä¸å¯å˜æ•°æ®ç»“æ„èƒŒåçš„æ€æƒ³ï¼Œå®ƒæœ‰ä¸€ä¸ªæ˜¾è‘—çš„å¥½å¤„â€” **å¦‚æœæŸä¸ªä¸œè¥¿æ²¡æœ‰è¢«æ”¹å˜â€”å®ƒå°±æ²¡æœ‰è¢«æ”¹å˜ã€‚å¦‚æœæŸä»¶äº‹æƒ…å‘ç”Ÿäº†å˜åŒ–â€”â€”å¾ˆå¯èƒ½å°±æ˜¯å‘ç”Ÿäº†å˜åŒ–**ã€‚è¿™ç»™äº†æˆ‘ä»¬ä¸€ä¸ªè¶…çº§å¿«é€Ÿçš„æ¯”è¾ƒï¼Œä½†æœ‰ä¸€äº›å‡é˜´æ€§ï¼Œå°±åƒç¬¬ä¸€ä¸ªä¾‹å­ã€‚

> è¿™ä¸ªæƒ³æ³•æ˜¯å…³äºâ€œå…³æ³¨â€ä½ æ‰€ä¾èµ–çš„æ•°æ®

æœ‰ä¸¤ä¸ªæ—¶åˆ»æˆ‘åº”è¯¥æåˆ°:

*   `lodash.memoize`å’Œ`fast-memoize`æ­£åœ¨æŠŠä½ çš„æ•°æ®è½¬æ¢æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨ä½œä¸€ä¸ªé”®ã€‚è¿™æ„å‘³ç€å®ƒä»¬ 1) **ä¸å¿«** 2) **ä¸å®‰å…¨** 3)å¯èƒ½ä¼šäº§ç”Ÿè¯¯æŠ¥â€”â€”ä¸€äº›ä¸åŒçš„æ•°æ®å¯èƒ½æœ‰ç›¸åŒçš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚è¿™å¯èƒ½ä¼šæé«˜â€œç¼“å­˜çƒ­ç‡â€ï¼Œä½†å®é™…ä¸Šæ˜¯ä¸€ä»¶éå¸¸ç³Ÿç³•çš„äº‹æƒ…ã€‚
*   æœ‰ä¸€ç§ ES6 ä»£ç†æ–¹æ³•ï¼Œå…³äºè·Ÿè¸ªæ‰€æœ‰ä½¿ç”¨çš„*ç»™å®šçš„*ä¸ªå˜é‡ï¼Œå¹¶ä¸”åªæ£€æŸ¥é‡è¦çš„é”®ã€‚è™½ç„¶æˆ‘ä¸ªäººæƒ³åˆ›å»ºæ— æ•°çš„æ•°æ®é€‰æ‹©å™¨â€”â€”ä½ å¯èƒ½ä¸å–œæ¬¢æˆ–ä¸ç†è§£è¿™ä¸ªè¿‡ç¨‹ï¼Œä½†å¯èƒ½å¸Œæœ›å¼€ç®±å³ç”¨çš„é€‚å½“çš„å†…å­˜åŒ–â€”â€”ç„¶åä½¿ç”¨ [memoize-state](https://github.com/theKashey/memoize-state) ã€‚

[](/how-i-wrote-the-worlds-fastest-react-memoization-library-535f89fc4a17) [## æˆ‘å¦‚ä½•ç¼–å†™ä¸–ç•Œä¸Šæœ€å¿«çš„ååº”è®°å¿†åº“

### å®é™…ä¸Šæˆ‘å·²ç»è¯•ç€å†™äº†æœ€æ…¢çš„ä¸€ä¸ªï¼Œè€Œâ€œæœ€å¿«çš„ JavaScript è®°å¿†åº“â€æ˜¯ä¸€å¹´å‰å†™çš„â€¦

itnext.io](/how-i-wrote-the-worlds-fastest-react-memoization-library-535f89fc4a17) 

## é—®é¢˜ 2â€”å®ƒæ˜¯â€œä¸€æ¡ç¼“å­˜çº¿â€

æ— é™çš„ç¼“å­˜å¤§å°æ˜¯ä¸€ä¸ªæ€æ‰‹ã€‚åªè¦å†…å­˜éå¸¸æœ‰é™ï¼Œä»»ä½•ä¸å—æ§åˆ¶çš„ç¼“å­˜éƒ½æ˜¯æ€æ‰‹ã€‚æ‰€ä»¥â€”â€”æ‰€æœ‰æœ€å¥½çš„åº“éƒ½æ˜¯â€œä¸€ä¸ªç¼“å­˜è¡Œé•¿â€ã€‚è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å’Œå¼ºå¤§çš„è®¾è®¡å†³ç­–ã€‚æˆ‘åˆšåˆšå†™äº†å®ƒæ˜¯å¤šä¹ˆæ­£ç¡®ï¼Œç›¸ä¿¡æˆ‘â€”â€”è¿™ç¡®å®æ˜¯ä¸€ä»¶**æ­£ç¡®**çš„äº‹æƒ…ï¼Œä½†å®ƒ**ä»ç„¶æ˜¯ä¸€ä¸ªé—®é¢˜**ã€‚ä¸€ä¸ªå¤§é—®é¢˜ã€‚

```
const tasks = getTasks(state); // let's get some data from state1 (function was defined above)
getDataFromTask(tasks[0]); 
// ğŸš€equal(getDataFromTask(tasks[0]), getDataFromTask(tasks[0])) 
//ğŸ”¥getDataFromTask(tasks**[1]**); 
// a different task? What the heck?
// oh! That's **another** argument? How dare you!?// TLDR -> task[0] in the cache got replaced by task[1]ğŸ¤·â€â™‚ï¸ you cannot use getDataFromTask to get data from different tasks
```

ä¸€æ—¦**ç›¸åŒçš„**é€‰æ‹©å™¨ä¸å¾—ä¸ä¸**ä¸åŒçš„**æºæ•°æ®ä¸€èµ·å·¥ä½œï¼Œè€Œä¸”ä¸æ­¢ä¸€ä¸ªâ€”â€”ä¸€åˆ‡éƒ½è¢«æ‰“ç ´äº†ã€‚è€Œä¸”å¾ˆå®¹æ˜“ç¢°åˆ°è¿™æ ·çš„é—®é¢˜:

*   åªè¦æˆ‘ä»¬ä½¿ç”¨é€‰æ‹©å™¨ä»ä¸€ä¸ªçŠ¶æ€ä¸­è·å–ä»»åŠ¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ç›¸åŒçš„é€‰æ‹©å™¨ä»ä¸€ä¸ªä»»åŠ¡ä¸­è·å–æŸäº›ä¸œè¥¿ã€‚æ¿€çƒˆæ¥è‡ªäº API æœ¬èº«ã€‚ä½†å®ƒä¸å·¥ä½œï¼Œé‚£ä¹ˆä½ åªèƒ½è®°ä½æœ€åä¸€æ¬¡è°ƒç”¨ï¼Œä½†å¿…é¡»ä¸å¤šä¸ªæ•°æ®æºã€‚
*   å¤šä¸ª React ç»„ä»¶ä¹Ÿæœ‰åŒæ ·çš„é—®é¢˜â€”â€”å®ƒä»¬éƒ½æ˜¯ç›¸åŒçš„ï¼Œä½†éƒ½æœ‰ä¸€ç‚¹ä¸åŒï¼Œè·å–ä¸åŒçš„`tasks`ï¼Œæ“¦é™¤å½¼æ­¤çš„ç»“æœã€‚

æœ‰ 3 ç§å¯èƒ½çš„è§£å†³æ–¹æ¡ˆ:

*   å¦‚æœ**é‡å¤**â€”â€”ä½¿ç”¨`mapStateToProps`å·¥å‚ã€‚å®ƒå°†åˆ›å»ºæ¯ä¸ªå®ä¾‹çš„è®°å¿†ã€‚

```
const mapStateToProps = () => {
   const selector = createSelector(...); 
   // ^ you have to define per-instance selectors here
   // usually that's not possible :)  
   return state => ({
      data: selector(data), // a usual mapStateToProps
   });
}
```

*   ç¬¬äºŒä¸ªå˜ä½“å‡ ä¹ç›¸åŒ(å¯¹äº redux ä¹Ÿæ˜¯å¦‚æ­¤)â€”â€”å®ƒæ˜¯å…³äºä½¿ç”¨[é‡æ–°é€‰æ‹©](https://github.com/toomuchdesign/re-reselect)ã€‚è¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„åº“ï¼Œé€šè¿‡åŒºåˆ†ç»„ä»¶å¯ä»¥åŒ–é™©ä¸ºå¤·ã€‚å®ƒå¯ä»¥ç†è§£ï¼Œæ–°çš„è°ƒç”¨æ˜¯é’ˆå¯¹â€œå¦ä¸€ä¸ªâ€ç»„ä»¶çš„ï¼Œå¹¶ä¸”å®ƒå¯ä»¥ä¸ºâ€œå‰ä¸€ä¸ªâ€ç»„ä»¶ä¿ç•™ç¼“å­˜ã€‚

![](img/b034bf0e93a88dc43630bca761e67ca6.png)

é‡æ–°é€‰æ‹©ç¼“å­˜æ¡¶

è¿™ä¸ªåº“å¯ä»¥å¸®åŠ©ä½ â€œä¿ç•™â€è®°å¿†ç¼“å­˜ï¼Œä½†ä¸èƒ½åˆ é™¤å®ƒã€‚å°¤å…¶æ˜¯å› ä¸ºå®ƒæ­£åœ¨å®ç° 5(äº”ï¼)é€‚åˆä»»ä½•æƒ…å†µçš„ä¸åŒç¼“å­˜ç­–ç•¥ã€‚é‚£æ˜¯ä¸€è‚¡éš¾é—»çš„æ°”å‘³ã€‚é€‰é”™äº†æ€ä¹ˆåŠï¼Ÿ

ä½ è®°ä½çš„æ‰€æœ‰æ•°æ®â€”â€”ä½ è¿Ÿæ—©ä¼šå¿˜è®°çš„ã€‚é‡ç‚¹ä¸åœ¨äºè®°ä½æœ€åä¸€æ¬¡å‡½æ•°è°ƒç”¨â€”â€”é‡ç‚¹æ˜¯åœ¨é€‚å½“çš„æ—¶å€™å¿˜è®°å®ƒã€‚ä¸è¦å¤ªå¿«ï¼Œç ´åè®°å¿†ï¼Œä¹Ÿä¸è¦å¤ªæ™šã€‚

> æ˜ç™½äº†å—ï¼Ÿç°åœ¨ç®—äº†å§ï¼

# è®©æˆ‘ä»¬æš‚åœä¸€ä¸‹

åœä¸‹æ¥ã€‚æ”¾æ¾ç‚¹ã€‚åšä¸€ä¸ªæ·±å‘¼å¸ã€‚å›ç­”ä¸€ä¸ªç®€å•çš„é—®é¢˜â€”â€”ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬å¿…é¡»åšäº›ä»€ä¹ˆæ¥è¾¾åˆ°ç›®æ ‡ï¼Ÿä»€ä¹ˆèƒ½æ‹¯æ•‘è¿™ä¸€å¤©ï¼Ÿ

> æç¤º:é‚£ä¸ªè¯¥æ­»çš„â€œéšè—â€åœ¨å“ªé‡Œï¼

![](img/43ae89b6524a57abdd2eb6959ef08d34.png)

é‚£ä¸ªè¯¥æ­»çš„â€œè´®è—åº“â€åœ¨å“ªé‡Œï¼Ÿæ˜¯çš„â€”â€”è¿™æ˜¯ä¸ªæ­£ç¡®çš„é—®é¢˜ã€‚è°¢è°¢ä½ çš„æé—®ã€‚ç­”æ¡ˆå¾ˆç®€å•â€”â€”å®ƒ**ä½äºä¸€ä¸ªå°é—­ç‰©**ä¸­ã€‚åœ¨å†…å­˜å‡½æ•°å†…éƒ¨çš„*éšè—ç‚¹ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œè¿™æ˜¯ memoize-one ä»£ç :*

```
function(fn) {
  let lastArgs;  // the last arguments
  let **lastResult**;// the last result// the memoized function
const memoizedCall = function(...newArgs) {
    if (isEqual(newArgs, lastArgs)) {
      return lastResult;
    } lastResult = resultFn.apply(this, newArgs);
    lastArgs = newArgs;
    return lastResult;
  };return memoizedCall;
}
```

æ‚¨å°†è·å¾—ä¸€ä¸ª`memoizedCall`ï¼Œå®ƒå°†ä¿å­˜é™„è¿‘çš„æœ€åä¸€ä¸ªç»“æœ*ï¼Œåœ¨å…¶æœ¬åœ°é—­åŒ…å†…ï¼Œé™¤äº†`memoizedCall`ä¹‹å¤–ï¼Œä»»ä½•äººéƒ½ä¸èƒ½è®¿é—®ã€‚ä¸€ä¸ªå®‰å…¨çš„åœ°æ–¹ã€‚è¿™ä¸ªâ€œT23â€æ˜¯ä¸€ä¸ªå®‰å…¨çš„åœ°æ–¹ã€‚*

`Reselect`åšåŒæ ·çš„äº‹æƒ…ï¼Œå”¯ä¸€çš„æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªâ€œåˆ†æ”¯â€ï¼Œç”¨å¦ä¸€ä¸ª*ç¼“å­˜*â€”â€”åˆ›å»ºä¸€ä¸ªæ–°çš„å†…å­˜åŒ–é—­åŒ…ã€‚

> ä½†æ˜¯(å¦ä¸€ä¸ª)ä¸»è¦é—®é¢˜æ˜¯ï¼Œå®ƒ(ç¼“å­˜)ä½•æ—¶ä¼šâ€œæ¶ˆå¤±â€ï¼Ÿ

> TLDR:å½“å‡½æ•°å®ä¾‹è¢«åƒåœ¾æ”¶é›†å™¨åƒæ‰æ—¶ï¼Œå®ƒå°±å’Œå‡½æ•°ä¸€èµ·â€œæ¶ˆå¤±â€äº†ã€‚

å®ä¾‹ï¼Ÿå®ä¾‹ï¼é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯**æ¯å®ä¾‹å†…å­˜åŒ–ï¼Ÿ**React æ–‡æ¡£ä¸­æœ‰ä¸€æ•´ç¯‡å…³äºå®ƒçš„æ–‡ç« :

[](https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#what-about-memoization) [## ä½ å¯èƒ½ä¸éœ€è¦è¡ç”Ÿçš„çŠ¶æ€ååº”åšå®¢

### React 16.4 åŒ…å«ä¸€ä¸ª getDerivedStateFromProps çš„é”™è¯¯ä¿®å¤ï¼Œè¯¥é”™è¯¯å¯¼è‡´ React ç»„ä»¶ä¸­çš„ä¸€äº›ç°æœ‰é”™è¯¯â€¦

reactjs.org](https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#what-about-memoization) 

å› æ­¤ï¼Œå¦‚æœæ‚¨ä½¿ç”¨åŸºäºç±»çš„ React ç»„ä»¶ï¼Œæ‚¨å¯èƒ½ä¼š:

```
import memoize from "memoize-one";class Example extends Component {
  **filter = memoize**(
    (list, filterText) => list.filter(...);
  // ^ that is "per instance" memoization
  // we are creating "own" memoization function
  // with the "own" lastResultrender() {
    // Calculate the latest filtered list. 
    // If these arguments haven't changed since the last render, 
    // `memoize-one` will reuse the last return value.
    const filteredList = this.filter(something, somehow); return <ul>{filteredList.map(item => ...}</ul>
  }
}
```

é‚£ä¹ˆâ€œ**last resultâ€**å­˜å‚¨åœ¨å“ªé‡Œå‘¢ï¼Ÿåœ¨å†…å­˜åŒ–çš„**è¿‡æ»¤å™¨**çš„å±€éƒ¨èŒƒå›´å†…ï¼Œåœ¨**è¿™ä¸ª**ç±»å®ä¾‹å†…ã€‚é•¿è¯çŸ­è¯´â€¦

> å®ƒä»€ä¹ˆæ—¶å€™ä¼šâ€œæ¶ˆå¤±â€ï¼Ÿ

è¿™ä¸€æ¬¡ï¼Œå®ƒå°†éšç€ä¸€ä¸ªç±»å®ä¾‹â€œæ¶ˆå¤±â€ã€‚ä¸€æ—¦ç»„ä»¶è¢«å¸è½½ï¼Œå®ƒå°±ä¼šæ¶ˆå¤±å¾—æ— å½±æ— è¸ªã€‚è¿™æ˜¯ä¸€ä¸ªçœŸæ­£çš„â€œæ¯ä¸ªå®ä¾‹â€ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ **this.lastResult** æ¥ä¿å­˜ä¸€ä¸ªä¸´æ—¶ç»“æœï¼Œå…·æœ‰å®Œå…¨ç›¸åŒçš„â€œè®°å¿†åŒ–â€æ•ˆæœã€‚

# ååº”å‘¢ã€‚é’©ä½

æˆ‘ä»¬è¶Šæ¥è¶Šè¿‘äº†ã€‚Redux æŒ‚é’©æœ‰å‡ ä¸ªå¯ç–‘çš„å‘½ä»¤ï¼Œå¯èƒ½æ˜¯å…³äºå†…å­˜åŒ–çš„ã€‚æ¯”å¦‚â€” `useMemo`ã€`useCallback`ã€`useRef`

> [useMemo](https://reactjs.org/docs/hooks-reference.html#usememo) åªä¼šåœ¨å…¶ä¸­ä¸€ä¸ªä¾èµ–å…³ç³»æ”¹å˜æ—¶é‡æ–°è®¡ç®—è®°å¿†å€¼ã€‚

![](img/fa24510bfd65358879a83f4da3f7673e.png)

> ä½†é—®é¢˜æ˜¯â€”â€”è¿™æ¬¡å®ƒåœ¨å“ªé‡Œå­˜å‚¨è®°å¿†å€¼å‘¢ï¼Ÿ

ç®€è€Œè¨€ä¹‹â€”â€”å®ƒå°†å®ƒå­˜å‚¨åœ¨â€œé’©å­â€ä¸­ï¼Œåœ¨ VDOM å…ƒç´ çš„ä¸€ä¸ªç‰¹æ®Šéƒ¨åˆ†ï¼Œç§°ä¸ºä¸å½“å‰å…ƒç´ ç›¸å…³è”çš„`fiber`ã€‚åœ¨å¹¶è¡Œæ•°æ®ç»“æ„ä¸­ã€‚

æ²¡é‚£ä¹ˆçŸ­â€”â€”é’©å­æ”¹å˜äº†ä½ ç¨‹åºçš„å·¥ä½œæ–¹å¼ï¼Œå°†ä½ çš„å‡½æ•°ç§»åˆ°å¦ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œä¸€äº›å˜é‡åœ¨çˆ¶é—­åŒ…çš„éšè—ç‚¹ä¸­ã€‚è¿™æ ·çš„å‡½æ•°è¢«ç§°ä¸ºå¯æŒ‚èµ·çš„ï¼Œæˆ–å¯æ¢å¤çš„ï¼Œæˆ–**åç¨‹**ã€‚åœ¨ JavaScript ä¸­ï¼Œå®ƒä»¬é€šå¸¸è¢«ç§°ä¸ºç”Ÿæˆå™¨æˆ–å¼‚æ­¥å‡½æ•°ã€‚

ä½†è¿™æœ‰ç‚¹æç«¯ã€‚ç®€è€Œè¨€ä¹‹â€” `useMemo`å°±æ˜¯åœ¨**è¿™ä¸ª**ä¸­å­˜å‚¨è®°å¿†å€¼ã€‚åªæ˜¯â€œè¿™ä¸ªâ€æœ‰ç‚¹ä¸ä¸€æ ·ã€‚

> å¦‚æœæˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ªæ›´å¥½çš„è®°å¿†åº“ï¼Œæˆ‘ä»¬åº”è¯¥æ‰¾åˆ°ä¸€ä¸ªæ›´å¥½çš„â€œthisâ€ã€‚

> Zingï¼

![](img/82ddb37501eebf4e7ad3974d6befb9ed.png)

# å­¬ç§ï¼

æ˜¯å•Šï¼å­¬ç§ï¼å­˜å‚¨é”®å€¼ï¼Œå…¶ä¸­`key`æ˜¯`this`ï¼Œåªè¦ WeakMap ä¸æ¥å—é™¤`this`ä¹‹å¤–çš„ä»»ä½•ä¸œè¥¿ï¼Œå³â€œobjectsâ€ã€‚

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„ä¾‹å­:

```
const createHiddenSpot = (fn) => {
  const map = new WeakMap(); // a hidden "closure"
  const set = (key, value) => (map.set(key, value), value); return (key) => { 
     return map.get(key) || set(key, fn(key))
  }
}const weakSelect = createHiddenSpot(selector);
weakSelect(todos);    // create a new entry
weakSelect(todos);    // return an existing entry
weakSelect(todos[0]); // create a new entry
weakSelect(todos[1]); // create a new entry
weakSelect(todos[0]); // return an existing entry!
weakSelect(todos[1]); // return an existing entry!!
weakSelect(todos);    // return an existing entry!!!
```

è¿™éå¸¸ç®€å•ï¼Œè€Œä¸”éå¸¸â€œæ­£ç¡®â€ã€‚æ‰€ä»¥â€œå®ƒä»€ä¹ˆæ—¶å€™ä¼šæ¶ˆå¤±â€ï¼Ÿ

*   å¿˜è®°`weakSelect`,æ•´ä¸ªâ€œåœ°å›¾â€å°±ä¼šæ¶ˆå¤±
*   å¿˜è®°`todos[0]`å’Œä»–ä»¬çš„*å¼±*æ¡ç›®å°±ä¼šæ¶ˆå¤±
*   å¿˜è®°`todos`â€”â€”è®°å¿†æ•°æ®å°†ä¼šæ¶ˆå¤±ï¼

> å¾ˆæ¸…æ¥šä»€ä¹ˆæ—¶å€™ä¼šâ€œæ¶ˆå¤±â€

> TLï¼›DR â€”åªåœ¨åº”è¯¥çš„æ—¶å€™ã€‚

ç¥å¥‡çš„æ˜¯ï¼Œæ‰€æœ‰çš„`reselect`é—®é¢˜éƒ½æ¶ˆå¤±äº†ã€‚ä¸*æ¿€è¿›çš„*è®°å¿†åŒ–æœ‰å…³çš„é—®é¢˜â€”â€”ä¹Ÿæ˜¯ä¸€å»ä¸å¤è¿”äº†ã€‚

è¿™ç§æ–¹æ³•**è®°ä½**çš„æ•°æ®ï¼Œç›´åˆ°**å¿˜è®°**ä¸ºæ­¢ã€‚è¿™æ˜¯éš¾ä»¥ç½®ä¿¡çš„ï¼Œä½†è¦æ›´å¥½åœ°è®°ä½ä¸€äº›äº‹æƒ…ï¼Œä½ å¿…é¡»èƒ½å¤Ÿæ›´å¥½åœ°å¿˜è®°å®ƒã€‚

å”¯ä¸€æŒä¹…çš„æ˜¯â€”ä¸ºè¿™ç§æƒ…å†µåˆ›å»ºä¸€ä¸ªæ›´å¥å£®çš„ API

# Kashe â€”æ˜¯ä¸€ä¸ªç¼“å­˜

`kashe`æ˜¯ä¸€ä¸ªåŸºäº WeakMap çš„è®°å¿†åº“ï¼Œå¯ä»¥æ‹¯æ•‘ä½ çš„ä¸€å¤©ã€‚

[](https://github.com/theKashey/kashe) [## theKashey/kashe

### ğŸ¤¯æœ‰æ—¶ç¼“å­˜æ˜¯ kasheã€‚åœ¨ GitHub ä¸Šåˆ›å»ºä¸€ä¸ªå¸æˆ·ï¼Œä¸º Kashey/kashe çš„å‘å±•åšå‡ºè´¡çŒ®ã€‚

github.com](https://github.com/theKashey/kashe) 

è¿™ä¸ªåº“å…¬å¼€äº† 4 ä¸ªå‡½æ•°

*   `kashe`â€”ç”¨äºè®°å¿†ã€‚
*   `box` â€”å¯¹äºå‰ç¼€è®°å¿†ï¼Œå¢åŠ è®°å¿†çš„æœºä¼šã€‚
*   `inbox` â€”åµŒå¥—å‰ç¼€è®°å¿†åŒ–ï¼Œä»¥ _ å‡å°‘ _ æ”¹å˜è®°å¿†åŒ–
*   `fork` â€” to _fork_(æ˜æ˜¾)è®°å¿†åŒ–ã€‚

## kashe(fn) => memoizedFn(â€¦args)

å®ƒå®é™…ä¸Šæ˜¯ä¸Šä¸€ä¸ªç¤ºä¾‹ä¸­çš„ createHiddenSpotã€‚å®ƒå°†ä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå†…éƒ¨ WeakMap çš„`key`ã€‚

```
const selector = (state, prop) => ({result: state[prop]});
const memoized = kashe(selector);
const old = memoized(state, 'x')
memoized(state, 'x') === old
memoized(state, 'y') === memoized(state, 'y') 
// ^^ another argument// but
old !== memoized(state, 'x') // 'y' wiped 'x' cache in `state`
```

**ç¬¬ä¸€ä¸ªå‚æ•°**æ˜¯ä¸€ä¸ªé”®ï¼Œå¦‚æœä½ å†æ¬¡è°ƒç”¨åŒä¸€ä¸ªå‡½æ•°`key`ï¼Œä½†æ˜¯ä¸åŒçš„å‚æ•°â€”â€”ç¼“å­˜å°†è¢«æ›¿æ¢ï¼Œå®ƒä»ç„¶æ˜¯ä¸€ä¸ªç¼“å­˜è¡Œé•¿çš„å†…å­˜åŒ–ã€‚ä¸ºäº†è®©å®ƒå·¥ä½œâ€”â€”ä½ å¿…é¡»ä¸ºä¸åŒçš„æƒ…å†µæä¾›ä¸åŒçš„`keys`,å°±åƒæˆ‘ç”¨`weakSelect`ä¾‹å­åšçš„é‚£æ ·ï¼Œä»¥æä¾›ä¸åŒçš„ this æ¥ä¿å­˜ç»“æœã€‚é‡é€‰ç€‘å¸ƒ A è¿˜æ˜¯é‚£ä¸ªä¸œè¥¿ã€‚

å¹¶éæ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯å¯è®°å¿†çš„ã€‚ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯å¯¹è±¡ã€æ•°ç»„æˆ–å‡½æ•°ã€‚å®ƒåº”è¯¥å¯ä»¥ç”¨ä½œ`WeakMap`çš„æŒ‰é”®ã€‚

## box(fn) => memoizedFn2(boxï¼Œâ€¦args)

è¿™æ˜¯åŒä¸€ä¸ªåŠŸèƒ½ï¼Œåªæ˜¯**åº”ç”¨äº†ä¸¤æ¬¡**ã€‚ä¸€æ¬¡ç”¨äº`fn`ï¼Œä¸€æ¬¡ç”¨äº`memoizedFn`ï¼Œä¸ºå‚æ•°æ·»åŠ å‰å¯¼`key`ã€‚å®ƒå¯èƒ½ä¼šä½¿ä»»ä½•åŠŸèƒ½*å¯è®°å¿†*ã€‚

> è¿™æ˜¯ç›¸å½“å£°æ˜æ€§çš„-å˜¿åŠŸèƒ½ï¼æˆ‘å°†**å°†ç»“æœå­˜å‚¨åœ¨è¿™ä¸ª** `**box**`ä¸­ã€‚

```
// could not be "kashe" memoized
const addTwo = (a,b) => ({ result: a+b }); const bAddTwo = boxed(addTwo);
const cacheKey = {}; // any objectbAddTwo(cacheKey, 1, 2) === bAddTwo(cacheKey, 1, 2) === { result: 3}
```

å¦‚æœä½ `box`å·²ç»è®°å¿†äº†å‡½æ•°â€”â€”ä½ å°†å¢åŠ è®°å¿†çš„æœºä¼šï¼Œæ¯”å¦‚æ¯ä¸ªå®ä¾‹è®°å¿†â€”â€”ä½ å¯ä»¥åˆ›å»º**è®°å¿†çº§è”ã€‚**

```
const selectSomethingFromTodo = (state, prop) => ...
const selector = kashe(selectSomethingFromTodo);
const boxedSelector = kashe(selector);class Component {
  render () {
    const result = boxedSelector(this, todos, this.props.todoId);
    // 1\. try to find result in `this`
    // 2\. try to find result in `todos`
    // 3\. store in `todos`
    // 4\. store in `this` // if multiple `this`(components) are reading from `todos` - 
    // selector is not working (they are wiping each other)
    // but data stored in `this` - exists. ...
  }
} 
```

## inbox(fn) => memoizedFn2(boxï¼Œâ€¦args)

è¿™ä¸ªä¸ box ç›¸åï¼Œä½†æ˜¯åšçš„å‡ ä¹ä¸€æ ·ï¼Œå‘½ä»¤åµŒå¥—ç¼“å­˜å°†æ•°æ®å­˜å‚¨åˆ°æä¾›çš„`box`ä¸­ã€‚ä»ä¸€ä¸ªè§’åº¦æ¥çœ‹ï¼Œå®ƒé™ä½äº†è®°å¿†åŒ–çš„å¯èƒ½æ€§(æ²¡æœ‰è®°å¿†åŒ–çº§è”)ã€‚ä½†æ˜¯ä»å¦ä¸€ä¸ªè§’åº¦æ¥çœ‹â€”â€”å®ƒæ¶ˆé™¤äº†ç¼“å­˜å†²çªï¼Œå¹¶ä¸”æœ‰åŠ©äºéš”ç¦»è¿›ç¨‹ï¼Œå¦‚æœå®ƒä»¬ä¸åº”è¯¥ç”±äºä»»ä½•åŸå› ç›¸äº’å¹²æ‰°çš„è¯ã€‚

> å¾ˆæœ‰å®£ç¤ºæ€§â€”â€”å˜¿ï¼æ‰€æœ‰äººéƒ½è¿›å»ï¼è¿™é‡Œæœ‰ä¸€ä¸ª`box`å¯ä»¥ä½¿ç”¨

```
const getAndSet = (task, number) => task.value + number;
const memoized = kashe(getAndSet);
const inboxed = inbox(getAndSet);
const doubleBoxed = inbox(memoized);memoized(task, 1) // ok
memoized(task, 2) // previous result wipedinboxed(key1, task, 1) // ok
inboxed(key2, task, 2) // ok// inbox also override the cache for any underlaying kashe calls
doubleBoxed(key1, task, 1) // ok
doubleBoxed(key2, task, 2) // ok
```

## fork(kashe-memo ized)= > kashe-memo ized

Fork æ˜¯ä¸€ä¸ªçœŸæ­£çš„ forkâ€”â€”å®ƒè·å–ä»»ä½• *kashe-memoized* å‡½æ•°ï¼Œå¹¶è¿”å›ç›¸åŒçš„ç»“æœï¼Œä½†å¸¦æœ‰å¦ä¸€ä¸ªå†…éƒ¨ç¼“å­˜æ¡ç›®ã€‚è¿˜è®°å¾— redux mapStateToProps å·¥å‚æ–¹æ³•å—ï¼Ÿ

```
const mapStateToProps = () => {
   // const selector = createSelector(...); // 
   const selector = fork(realSelector);
   // just fork existing selector. Or box it, or don't do anything
   // kashe is more "stable" than reselect. return state => ({
      data: selector(data),
   });
}
```

# é‡æ–°é€‰

è¿˜æœ‰ä¸€ä»¶äº‹ä½ åº”è¯¥çŸ¥é“â€” **kashe å¯ä»¥ä»£æ›¿ reselect** ã€‚å­—é¢ä¸Šã€‚

```
import { createSelector } from 'kashe/reselect';
```

å®ƒå®é™…ä¸Šæ˜¯åŒæ ·çš„`reselect`ï¼Œåªæ˜¯ç”¨`kashe`ä½œä¸ºè®°å¿†åŠŸèƒ½åˆ›å»ºçš„ã€‚

> å…¨éƒ¨æµ‹è¯•å®Œæ¯•ï¼Œå‡†å¤‡å°±ç»ªï¼

> PS:å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™ç§æ–¹æ³•çš„æ›´ç®€å•çš„ç‰ˆæœ¬â€”â€”[weak-memo ize](https://github.com/emotion-js/emotion/tree/master/packages/weak-memoize)â€”â€”åœ¨ emotion-js ä¸­ä½¿ç”¨äº†ä¸€æ®µæ—¶é—´ã€‚æ²¡æœ‰æŠ±æ€¨ã€‚ [nano-memoize](https://medium.com/@anywhichway/nano-memoize-faster-than-fast-smaller-than-micro-c8a8d626bb82) ä¹Ÿå°† WeakMaps ç”¨äºå•å‚æ•°æƒ…å†µã€‚

æ˜ç™½äº†å—ï¼Ÿâ€œè¾ƒå¼±â€çš„æ–¹æ³•ä¼šå¸®åŠ©ä½ æ›´å¥½åœ°è®°ä½ä¸€äº›ä¸œè¥¿ï¼Œä¹Ÿæ›´å¥½åœ°å¿˜è®°å®ƒã€‚æ˜¯çš„ï¼Œå…³äºé—å¿˜â€”â€”ä½ èƒ½çœ‹è¿™é‡Œå—ï¼Ÿ

![](img/efc83110fbadd00d0264ab229231f598.png)