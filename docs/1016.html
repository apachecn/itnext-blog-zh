<html>
<head>
<title>Handling Long Running API Requests in Nodejs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">åœ¨Nodejsä¸­å¤„ç†é•¿æ—¶é—´è¿è¡Œçš„APIè¯·æ±‚</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/handling-long-running-api-requests-in-nodejs-403bd566d47?source=collection_archive---------1-----------------------#2018-07-05">https://itnext.io/handling-long-running-api-requests-in-nodejs-403bd566d47?source=collection_archive---------1-----------------------#2018-07-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/e3be539a7ca626b28bbe2bd8406dcfb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*lv4y-fWfvOn_YGnBdJOu_g.jpeg"/></div></figure><p id="2b42" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">æˆ‘å·²ç»ç ”ç©¶äº†<a class="ae ks" rel="noopener ugc nofollow" target="_blank" href="/building-restful-web-apis-with-node-js-express-mongodb-and-typescript-part-1-2-195bdaf129cf">è®¾è®¡å’Œéƒ¨ç½²RESTful APIæœ‰ä¸€æ®µæ—¶é—´äº†</a>ã€‚å¹¶ä¸”å¤„ç†å’Œå‘ˆç°æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚çš„æ•°æ®æ˜¯æœ‰è¶£çš„ã€‚ä»Šå¤©ï¼Œæˆ‘æ”¶åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå…³äºæˆ‘åº”è¯¥å¦‚ä½•å¤„ç†ä¸€ä¸ªéœ€è¦ä¸€å®šæ—¶é—´å¤„ç†çš„è¯·æ±‚ã€‚æˆ‘ä»¬ä¸èƒ½è®©å®¢æˆ·ç­‰10åˆ†é’Ÿæ‰èƒ½å¾—åˆ°å›å¤ã€‚æ­¤å¤–ï¼Œåœ¨æ•°æ®å¤„ç†è¿‡ç¨‹ä¸­ï¼Œä»»ä½•å…¶ä»–è¯·æ±‚éƒ½å¿…é¡»ç­‰å¾…ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ç“¶é¢ˆã€‚å¿…é¡»æœ‰ä¸€äº›æ–¹æ³•æ¥å¤„ç†é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ã€‚</p><p id="54d4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">åœ¨åšäº†ä¸€äº›ç ”ç©¶åï¼Œæˆ‘å‘ç°åœ¨æ„å»ºåº”ç”¨ç¨‹åºæ—¶ï¼Œæœ‰ä¸¤ç§äº¤äº’æ¨¡å¼å¯ä¾›æˆ‘ä»¬ä½¿ç”¨:</p><ul class=""><li id="c824" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr ky kz la lb bi translated"><strong class="jw ir">è¯·æ±‚-å“åº”(åŒæ­¥)</strong>:å“åº”è¿”å›ä¸€ä¸ªç­”æ¡ˆã€‚ä¾‹å¦‚ï¼Œåœ¨ç”µå­å•†åŠ¡åº”ç”¨ç¨‹åºä¸­ï¼Œå¦‚æœæäº¤çš„è®¢å•å·²è¢«å¤„ç†æˆ–æœ‰ä»»ä½•é—®é¢˜ï¼Œç”¨æˆ·ä¼šç«‹å³å¾—åˆ°é€šçŸ¥ã€‚</li><li id="1caf" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><strong class="jw ir">ä¸€åŠ³æ°¸é€¸(å¼‚æ­¥)</strong>:è¯·æ±‚å·²è¢«æ¥æ”¶ï¼Œå¹¶æä¾›äº†è·å–å“åº”çš„æ›¿ä»£æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·å¯¼å…¥å¤§é‡éœ€è¦å¤„ç†çš„æ•°æ®æ—¶ï¼Œä»–ä»¬ä¼šæ”¶åˆ°æ•°æ®å·²æ”¶åˆ°çš„ç¡®è®¤ï¼Œå¹¶è¢«æŒ‡ç¤ºæ£€æŸ¥å¯¼å…¥é˜Ÿåˆ—ä»¥æŸ¥çœ‹çŠ¶æ€ã€‚æˆ–è€…ï¼Œåœ¨å¯¼å…¥å®Œæˆæ—¶å‘é€ä¸€æ¡æ¶ˆæ¯ã€‚</li></ul><p id="b4fe" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">è¿™å¯¼è‡´äº†<strong class="jw ir">æ¶ˆæ¯é˜Ÿåˆ—</strong>çš„æ¦‚å¿µï¼Œå®ƒå¯ä»¥å¸è½½å¤„ç†å¹¶é‡Šæ”¾èµ„æºï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºå¯ä»¥å¤„ç†å…¶ä»–è¯·æ±‚ã€‚</p><p id="302e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">åœ¨è¿™ä¸ªæ¼”ç¤ºä¸­ï¼Œæˆ‘å°†ä½¿ç”¨RabbitMQæ¥å¤„ç†APIè¯·æ±‚ã€‚</p><p id="db35" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">ç¬¬ä¸€æ­¥:å‡†å¤‡å¥½RabbitMQã€‘</strong></p><p id="d800" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">ä½ æ—¢å¯ä»¥ä»<a class="ae ks" href="https://www.cloudamqp.com" rel="noopener ugc nofollow" target="_blank"> CloudAMQP </a>æ³¨å†Œä¸€ä¸ªè´¦æˆ·ï¼Œä¹Ÿå¯ä»¥ä»æœ¬åœ°æœºå™¨ä»<a class="ae ks" href="https://www.rabbitmq.com/download.html" rel="noopener ugc nofollow" target="_blank"> RabbitMQ </a>å®‰è£…æœåŠ¡ã€‚</p><p id="a9b7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">åœ¨ä»CloudAMQPåˆ›å»ºäº†ä¸€ä¸ªå¸æˆ·å’Œä¸€ä¸ªå®ä¾‹ä¹‹åï¼Œæ‚¨å¯ä»¥ç‚¹å‡»è¯¥å®ä¾‹å¹¶æŸ¥çœ‹äº‘æ‰˜ç®¡çš„RabbitMQä¿¡æ¯ã€‚</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lh"><img src="../Images/9376742f0a995da61e43e77b81a497b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mWLf8sm_CQl8eSfXJncjdQ.png"/></div></div></figure><p id="9064" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">å¦‚æœæ‚¨åœ¨æœ¬åœ°å®‰è£…RabbitMQï¼Œå®‰è£…å®Œæˆåï¼ŒRabbitMQæœåŠ¡å°†è‡ªåŠ¨åœ¨æ‚¨çš„æœºå™¨ä¸Šè¿è¡Œã€‚æ‚¨å¯ä»¥é€šè¿‡åº”ç”¨ç¨‹åºä¸­çš„<strong class="jw ir">â€œamqp://localhostâ€</strong>URLè®¿é—®å®ƒã€‚</p><p id="c322" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">æ­¥éª¤2:å®ç°RESTful APIçš„æ¶ˆæ¯é˜Ÿåˆ—</strong></p><p id="7eca" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘å‡è®¾æˆ‘ä»¬å°†æœ‰ä¸€ä¸ªå¾ˆé•¿çš„å¤„ç†POSTè¯·æ±‚ï¼Œå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ‰èƒ½å®Œæˆã€‚</p><p id="0dff" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">åœ¨åšä»»ä½•äº‹æƒ…ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…amqp.nodeåŒ…</p><pre class="li lj lk ll gt lq lr ls lt aw lu bi"><span id="0c91" class="lv lw iq lr b gy lx ly l lz ma">npm install amqplib</span></pre><p id="25cb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">ç„¶åï¼Œåœ¨æ‚¨çš„è·¯çº¿ä¸­ï¼Œæ‚¨éœ€è¦å¯¼å…¥åŒ…</p><pre class="li lj lk ll gt lq lr ls lt aw lu bi"><span id="427c" class="lv lw iq lr b gy lx ly l lz ma">// For TypeScript<br/>import * as amqp from 'amqplib/callback_api';</span><span id="2759" class="lv lw iq lr b gy mb ly l lz ma">// For JavaScript <br/>var amqp = require('amqplib/callback_api');</span></pre><p id="e88d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">ç„¶åç¼–è¾‘å‘å¸ƒè·¯çº¿åŠŸèƒ½ã€‚ä¾‹å¦‚:</p><pre class="li lj lk ll gt lq lr ls lt aw lu bi"><span id="9079" class="lv lw iq lr b gy lx ly l lz ma">app.route('/messages).post(req: Request, res: Response) {</span><span id="ecb7" class="lv lw iq lr b gy mb ly l lz ma"> amqp.connect('amqp://localhost', (err, conn) =&gt; {<br/>  conn.createChannel((err, ch) =&gt; {<br/>   const q = 'hello';<br/>   ch.assertQueue(q, {durable: false});</span><span id="f762" class="lv lw iq lr b gy mb ly l lz ma">   // I suppose the process will take about 5 seconds to finish<br/>   setTimeout(() =&gt; {<br/>    let msg = 'Get data from message queue!';<br/>    ch.sendToQueue(q, new Buffer(msg));<br/>    console.log(` [X] Send ${msg}`);<br/>   }, 5000)                       <br/>  });</span><span id="2b0b" class="lv lw iq lr b gy mb ly l lz ma">  // The connection will close in 10 seconds<br/>  setTimeout(() =&gt; {<br/>   conn.close();<br/>  }, 10000);<br/> });<br/> res.send('The POST request is being processed!');<br/>}</span></pre><p id="933a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">ç°åœ¨ï¼Œæˆ‘ä»¬çš„APIå°†ç›‘å¬ä¸€ä¸ªPOSTè¯·æ±‚ã€‚ä¾‹å¦‚æ¥è‡ª:<a class="ae ks" href="https://localhost:3000/messages'" rel="noopener ugc nofollow" target="_blank">https://localhost:3000/messages</a></p><p id="1d2a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">ä¸ºäº†æµ‹è¯•é…ç½®ï¼Œæˆ‘å°†ä½¿ç”¨<a class="ae ks" href="https://www.npmjs.com/package/request" rel="noopener ugc nofollow" target="_blank">è¯·æ±‚åŒ…</a>ä»å®¢æˆ·ç«¯å‘å‡ºPOSTè¯·æ±‚ã€‚</p><pre class="li lj lk ll gt lq lr ls lt aw lu bi"><span id="b7d0" class="lv lw iq lr b gy lx ly l lz ma">// receive.js<br/>var amqp = require('amqplib/callback_api');<br/>var request = require('request');</span><span id="8444" class="lv lw iq lr b gy mb ly l lz ma">request.post('<a class="ae ks" href="https://localhost:3000/messages'" rel="noopener ugc nofollow" target="_blank">https://localhost:3000/messages'</a>, function (error, response, body) {</span><span id="8e26" class="lv lw iq lr b gy mb ly l lz ma">    console.log(response.body);</span><span id="498e" class="lv lw iq lr b gy mb ly l lz ma">    // Connect to the server and wait for the queue<br/>    amqp.connect('amqp://localhost', (err, conn) =&gt; {<br/>        conn.createChannel((err, ch) =&gt; {<br/>            var q = 'hello';</span><span id="fad4" class="lv lw iq lr b gy mb ly l lz ma">ch.assertQueue(q, {<br/>                durable: false<br/>            });<br/>            console.log(' [*] Waiting for messages in %s. To exit press CTRL+C', q);<br/>            ch.consume(q, msg =&gt; {<br/>                console.log(' [x] Received %s', msg.content);  <br/>                conn.close();            <br/>            }, {<br/>                noAck: true<br/>            });<br/>        });<br/>    })<br/>        <br/>});</span></pre><p id="ff94" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">ç„¶åï¼Œæˆ‘è¿è¡Œæµ‹è¯•æœåŠ¡å™¨å¹¶å‘å‡ºç¤ºä¾‹POSTè¯·æ±‚ã€‚</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi mc"><img src="../Images/21c5ae76bb38e51125080aaad4463053.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3XEbw9GFkM1AiNVDxD59iA.png"/></div></div></figure><p id="8bd9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œ5såï¼ŒAPIä¼šåˆ†è§£å‡ºæ–‡æœ¬<strong class="jw ir">â€˜ä»æ¶ˆæ¯é˜Ÿåˆ—è·å–æ•°æ®ï¼â€™</strong>ã€<strong class="jw ir">ã€</strong>å’ŒPOSTè¯·æ±‚ä¹Ÿä»æ§åˆ¶å°æ—¥å¿—ä¸­è·å–æ¶ˆæ¯å¹¶æ‰“å°å‡ºæ¥ã€‚</p><p id="835b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">å°½ç®¡è¿™åªæ˜¯ä¸€ä¸ªæµ‹è¯•é¡¹ç›®ï¼Œä½†æ‚¨ç°åœ¨å·²ç»çŸ¥é“äº†ä¸€ç§åœ¨è°ƒç”¨RESTful APIåº”ç”¨ç¨‹åºæ—¶å¤„ç†é•¿æ—¶é—´è¿è¡Œè¿‡ç¨‹çš„æ–¹æ³•ã€‚</p><p id="3924" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">å‚è€ƒæ–‡çŒ®:</strong></p><ul class=""><li id="4f5c" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr ky kz la lb bi translated"><a class="ae ks" href="https://www.devbridge.com/articles/messaging-with-rabbitmq-in-node-js/" rel="noopener ugc nofollow" target="_blank">node . jsä¸­RabbitMQçš„æ¶ˆæ¯ä¼ é€’</a></li><li id="081a" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" href="https://www.rabbitmq.com/tutorials/tutorial-one-javascript.html" rel="noopener ugc nofollow" target="_blank"> RabbitMQæ•™ç¨‹</a></li></ul><p id="0da0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae ks" href="https://twitter.com/dale_nguyen" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir">åœ¨Twitterä¸Šå…³æ³¨æˆ‘</strong> </a>äº†è§£Angularã€JavaScript &amp; WebDevelopmentçš„æœ€æ–°å†…å®¹ğŸ‘</p></div></div>    
</body>
</html>