<html>
<head>
<title>Extracting decorated properties from classes in TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä»TypeScriptä¸­çš„ç±»æå–ä¿®é¥°å±æ€§</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/extracting-decorated-properties-from-classes-in-typescript-caf24aabcb59?source=collection_archive---------2-----------------------#2019-05-20">https://itnext.io/extracting-decorated-properties-from-classes-in-typescript-caf24aabcb59?source=collection_archive---------2-----------------------#2019-05-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/40e5b9fd111191511eecb59ed2e15d42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tf_R6rG2LbDnNA1OUyhpZQ.png"/></div></div></figure><div class=""/><p id="1e39" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è¿™æ˜¯ä¸€ç¯‡å…³äºæˆ‘å¯¹ä¸€ä¸ªæœ‰è¶£çš„æ‰“å­—ç¨¿é—®é¢˜çš„å¤æ‚è€Œç²—ç³™çš„ç­”æ¡ˆçš„æ—…ç¨‹çš„å¸–å­ã€‚æˆ‘ä¸ç¡®å®šè¿™æ˜¯ä¸æ˜¯ä½ åº”è¯¥ä½¿ç”¨çš„æ–¹æ³•ï¼Œä½†æˆ‘è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„æ–¹æ³•ã€‚å¦‚æœæœ‰ä¸€ä¸ªæ›´ç®€å•çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ç¡®ä¿¡(æ­£å¦‚åå®å®‰å®šå¾‹æ‰€å»ºè®®çš„)å®ƒä¼šå‡ºç°åœ¨è¯„è®ºä¸­ğŸ‘‡</p><p id="7d03" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æ³¨æ„:è¿™ä¸ªæ•…äº‹è¿›å…¥äº†ä¸€äº›é«˜çº§æ‰“å­—ç¨¿ã€‚æˆ‘å‡è®¾ä½ çŸ¥é“ä»€ä¹ˆæ˜¯è£…é¥°å™¨ã€ç±»å‹åˆ«åå’Œæ³›å‹ã€‚</p><h1 id="e905" class="ky kz jb bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">è¿™ä¸ªé—®é¢˜</h1><blockquote class="lw lx ly"><p id="a543" class="jy jz kx ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated">å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ˜ å°„ç±»å‹ï¼Œåªæå–å·²ç»è¢«æˆ‘çš„å±æ€§è£…é¥°å™¨æ³¨é‡Šçš„å±æ€§ï¼Ÿ</p></blockquote><p id="11cc" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è¿™ä¸ªé—®é¢˜æœ‰ç‚¹æŠ½è±¡ï¼Œè®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥çœ‹ä¸€ä¸‹ã€‚</p><h2 id="6e4f" class="mc kz jb bd la md me dn le mf mg dp li kj mh mi lm kn mj mk lq kr ml mm lu mn bi translated">æˆ‘ä»¬çš„ç‰¹åˆ«è£…æ½¢å¸ˆğŸŸ</h2><p id="b4f1" class="pw-post-body-paragraph jy jz jb ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">è®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„åä¸ºâ€œç‰¹æ®Šâ€çš„è£…é¥°è€…:</p><pre class="mt mu mv mw gt mx my mz bn na nb bi"><span id="2618" class="nc kz jb my b be nd ne l nf ng">/* special.ts */<br/><br/>function special(target: Object, propertyName: string) {<br/>  ğŸŸ(target)(ğŸš€, ğŸ’¯, ğŸ™Œ, propertyName);<br/>}<br/>// I have no clue what this does, but it looks very important.</span></pre><p id="14fa" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æˆ‘ä»¬æœ‰ä¸€äº›ä½¿ç”¨è£…é¥°å™¨çš„ç±»:</p><pre class="mt mu mv mw gt mx my mz bn na nb bi"><span id="ef06" class="nc kz jb my b be nd ne l nf ng">/* SomeModel.ts */<br/><br/>import special from "./special";<br/><br/>export default class SomeModel {<br/>  @special foo: number;<br/>  @special bar: Array&lt;string&gt;;<br/><br/>  baz: number;<br/>  qux: string;<br/>}<br/><br/>export const model = new SomeModel();</span></pre><blockquote class="lw lx ly"><p id="2fe9" class="jy jz kx ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated"><strong class="ka jc">å…³äºä»£ç ç‰‡æ®µçš„è¯´æ˜</strong>:æœ¬æ–‡ä¸­æ›¾ç»åµŒå…¥äº†CodeSandboxï¼Œå…è®¸ä½ æŸ¥çœ‹æ¥è‡ªTypeScriptç¼–è¯‘å™¨çš„åé¦ˆã€‚ä¸å¹¸çš„æ˜¯ï¼Œç”±äºä¸­ç­‰åµŒå…¥çš„é—®é¢˜ï¼Œæˆ‘ä¸å¾—ä¸æš‚æ—¶ç”¨ç®€å•çš„ä»£ç ç‰‡æ®µæ›¿æ¢å®ƒä»¬ã€‚ä¸è¿‡ï¼Œä½ ä»ç„¶å¯ä»¥é€šè¿‡<a class="ae kw" href="https://codesandbox.io/s/tspropertydecorators-0ht2s?file=/src/SomeModel.ts" rel="noopener ugc nofollow" target="_blank">è¿™ä¸ªé“¾æ¥</a>åœ¨æ²™ç›’é‡Œæ‘†å¼„ä»£ç ã€‚</p></blockquote><h2 id="1ae1" class="mc kz jb bd la md me dn le mf mg dp li kj mh mi lm kn mj mk lq kr ml mm lu mn bi translated">getSpecialPropertyå®ç”¨ç¨‹åº</h2><p id="ed5a" class="pw-post-body-paragraph jy jz jb ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">ç°åœ¨æˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ªå®ç”¨å‡½æ•°ï¼Œä»ä¸€ä¸ªå¯¹è±¡ä¸­è·å–è¿™äº›@specialå±æ€§ä¹‹ä¸€:</p><pre class="mt mu mv mw gt mx my mz bn na nb bi"><span id="ea8a" class="nc kz jb my b be nd ne l nf ng">/* getSpecialProperty.ts */<br/><br/>import { model } from "./SomeModel";<br/><br/>function getSpecialProperty&lt;TModel, TKey extends keyof TModel&gt;(<br/>  model: TModel,<br/>  key: TKey<br/>) {<br/>  return model[key];<br/>}<br/><br/>/* TESTING */<br/>// âœ… works! it even correctly infers type 'number'<br/>const fooValue = getSpecialProperty(model, "foo");<br/><br/>// âŒ this gives an error, as we expected<br/>const imaginaryValue = getSpecialProperty(<br/>  model,<br/>  "imaginary" /* ERROR: Argument of type '"imaginary"' is not assignable to parameter of type '"foo" | "bar" | "baz" | "qux"'. */<br/>);<br/><br/>// ğŸ‘ whoops. it allows 'qux', even though it's not special<br/>getSpecialProperty(model, "qux");</span></pre><p id="6f29" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æ­£å¦‚ä½ åœ¨æœ€åä¸€è¡Œçœ‹åˆ°çš„ï¼Œæˆ‘ä»¬çš„å‡½æ•°æœ‰é—®é¢˜ã€‚å®ƒè¿˜å°†æ¥å—ä¸€ä¸ªæ²¡æœ‰ç”¨æˆ‘ä»¬çš„ç‰¹æ®Šè£…é¥°å™¨æ³¨é‡Šçš„<code class="fe nh ni nj my b">key</code>ã€‚è¿™å°±æ˜¯æˆ‘ä»¬è¯•å›¾è§£å†³çš„é—®é¢˜:ä»¥è¿™æ ·ä¸€ç§æ–¹å¼å®šä¹‰<code class="fe nh ni nj my b">TKey</code>,å®ƒåªåŒ¹é…æˆ‘ä»¬ç‰¹æ®Šçš„ä¿®é¥°å±æ€§ã€‚</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h1 id="b52f" class="ky kz jb bd la lb nr ld le lf ns lh li lj nt ll lm ln nu lp lq lr nv lt lu lv bi translated">ç¬¬1éƒ¨åˆ†:éè§£å†³æ–¹æ¡ˆ</h1><p id="0741" class="pw-post-body-paragraph jy jz jb ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">è®©æˆ‘ä»¬å¿«é€Ÿåœ°è®¤è¯†åˆ°ï¼Œæœ‰ä¸€ä¸ªç®€å•çš„æ–¹æ³•å¯ä»¥å°†è¿™äº›@specialå±æ€§åˆ†ç¦»å‡ºæ¥ã€‚åªæ˜¯æŠŠä»–ä»¬æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„ç±»ä¸Š:</p><pre class="mt mu mv mw gt mx my mz bn na nb bi"><span id="c60b" class="nc kz jb my b be nd ne l nf ng">/* SomeModel.easy.ts */<br/><br/>import special from "./special";<br/><br/>class Special {<br/>  @special foo: number;<br/>  @special bar: Array&lt;string&gt;;<br/>}<br/><br/>class SomeModel {<br/>  special = new Special();<br/><br/>  baz: number;<br/>  qux: string;<br/>}<br/><br/>function getSpecialProperty&lt;TSpecial, TKey extends keyof TSpecial&gt;(<br/>  model: { special: TSpecial },<br/>  key: TKey<br/>) {<br/>  return model.special[key];<br/>}</span></pre><p id="c5e8" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç„¶è€Œï¼Œè¿™ä¸æ˜¯æˆ‘è¯•å›¾è§£å†³çš„é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚æˆ‘æƒ³æŠŠæˆ‘çš„â€œ@specialâ€å±æ€§å’Œå…¶ä»–å±æ€§æ”¾åœ¨åŒä¸€ä¸ªå¯¹è±¡ä¸Šã€‚æ¯•ç«Ÿï¼Œå¦‚æœæˆ‘ä¹Ÿå¿…é¡»å°†æˆ‘æ‰€æœ‰çš„å±æ€§ç§»åŠ¨åˆ°ä¸€ä¸ªå•ç‹¬çš„å¯¹è±¡ä¸­ï¼Œé‚£ä¹ˆä½¿ç”¨decoratorsè¿˜æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿ</p><figure class="mt mu mv mw gt is"><div class="bz fp l di"><div class="nw nx l"/></div></figure></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h1 id="a36f" class="ky kz jb bd la lb nr ld le lf ns lh li lj nt ll lm ln nu lp lq lr nv lt lu lv bi translated">ç¬¬2éƒ¨åˆ†:é€šè¿‡å€¼ç±»å‹è·å–é”®</h1><h2 id="eced" class="mc kz jb bd la md me dn le mf mg dp li kj mh mi lm kn mj mk lq kr ml mm lu mn bi translated">æŸ¥æ‰¾æ‰€æœ‰æ•°å­—</h2><p id="fa02" class="pw-post-body-paragraph jy jz jb ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">è®©æˆ‘ä»¬å…ˆè§£å†³ä¸€ä¸ªâ€œæ›´ç®€å•â€çš„é—®é¢˜:ä»æˆ‘ä»¬çš„ç±»<code class="fe nh ni nj my b">TModel</code>ä¸­è·å–æ‰€æœ‰å€¼ä¸ºç±»å‹<code class="fe nh ni nj my b">number</code>çš„é”®ã€‚æˆ‘åœ¨è¿™é‡Œå°†â€œæ›´å®¹æ˜“â€æ”¾åœ¨å¼•å·ä¸­ï¼Œå› ä¸ºè¿™æ ·åšçš„ç±»å‹åˆ«åçœ‹èµ·æ¥ä»ç„¶æœ‰ç‚¹ä»¤äººç”Ÿç•:</p><pre class="mt mu mv mw gt mx my mz bn na nb bi"><span id="3acd" class="nc kz jb my b be nd ne l nf ng">/* SomeModel.easy.ts */<br/><br/>/* THIS IS THE TYPE ALIAS */<br/>type NumberKeys&lt;T&gt; = {<br/>  [K in keyof T]: T[K] extends number ? K : never<br/>}[keyof T];<br/><br/>/* BROKEN DOWN EXPLANATION + EXAMPLE */<br/>type ExampleInput = { a: number; b: string; c: number };<br/><br/>// this will convert key-value pairs into key-key pairs<br/>type MapValuesToKeys&lt;T&gt; = { [K in keyof T]: K };<br/>// MapValuesToKeys&lt;ExampleInput&gt; = { a: "a"; b: "b"; c: "c"; }<br/><br/>// this will do the same, but map non-numbers to 'never'<br/>type MapNumbersToKeys&lt;T&gt; = {<br/>  [K in keyof T]: T[K] extends number ? K : never<br/>};<br/>// MapNumbersToKeys&lt;ExampleInput&gt; = { a: "a"; b: never; c: "c"; }<br/><br/>// the last step is to take the above, and get a union of the values<br/>// (note that 'never' gets stripped from union types)<br/>type FinalStep&lt;T&gt; = MapNumbersToKeys&lt;T&gt;[keyof T];<br/>// FinalStep&lt;ExampleInput&gt; = "a" | "c"</span></pre><h2 id="debe" class="mc kz jb bd la md me dn le mf mg dp li kj mh mi lm kn mj mk lq kr ml mm lu mn bi translated">ä½¿å…¶æ›´åŠ é€šç”¨</h2><p id="6057" class="pw-post-body-paragraph jy jz jb ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">æˆ‘ä»¬å¯ä»¥ä¸€èˆ¬åŒ–æˆ‘ä»¬çš„<code class="fe nh ni nj my b">NumberKeys</code>ç±»å‹åˆ«åæ¥è·å¾—ä»»ä½•ç»™å®šç±»å‹çš„é”®:</p><pre class="mt mu mv mw gt mx my mz bn na nb bi"><span id="bbcc" class="nc kz jb my b be nd ne l nf ng">type KeysOfType&lt;TTarget, TValue&gt; = {<br/>  [K in keyof TTarget]: TTarget[K] extends TValue ? K : never<br/>}[keyof TTarget];</span></pre><p id="88d9" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¤ªå¥½äº†ï¼æ‰€ä»¥ç°åœ¨æˆ‘ä»¬æ‰€éœ€è¦çš„å°±æ˜¯ä½¿ç”¨è¿™ä¸ªç±»å‹åˆ«åæ¥è¿‡æ»¤æˆ‘ä»¬ç‰¹æ®Šå±æ€§çš„ç±»å‹ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ï¼ğŸ¥³</p><p id="3889" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å—¯â€¦â€¦è¿™å°±æ˜¯é—®é¢˜æ‰€åœ¨ğŸ˜Ÿã€‚æˆ‘ä»¬çš„å±æ€§<code class="fe nh ni nj my b">foo</code>å’Œ<code class="fe nh ni nj my b">bar</code>å¯èƒ½æœ‰<code class="fe nh ni nj my b">special</code>è£…é¥°å™¨ï¼Œä½†æ˜¯å®ƒä»¬çš„ç±»å‹åªæ˜¯æ™®é€šçš„<code class="fe nh ni nj my b">number</code>å’Œ<code class="fe nh ni nj my b">Array&lt;string&gt;</code>ã€‚è€Œä¸”(åœ¨ç¼–å†™çš„æ—¶å€™)TypeScriptä¸å…è®¸ä½ ç”¨è£…é¥°å™¨æ”¹å˜æŸäº›ä¸œè¥¿çš„ç±»å‹ã€‚å®ƒåœ¨Githubä¸Šæœ‰ä¸€ä¸ª<a class="ae kw" href="https://github.com/Microsoft/TypeScript/issues/4881" rel="noopener ugc nofollow" target="_blank">å†—é•¿çš„é—®é¢˜</a>ï¼Œçœ‹èµ·æ¥è¿™ä¸ªé—®é¢˜ä¸ä¼šå¾ˆå¿«å¾—åˆ°è§£å†³ã€‚è¿™è®©æˆ‘ä»¬åˆ«æ— é€‰æ‹©ï¼Œåªèƒ½æ˜¾å¼åœ°æ”¹å˜æˆ‘ä»¬çš„ä¿®é¥°å±æ€§çš„ç±»å‹ã€‚</p><h1 id="0ea6" class="ky kz jb bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">ç¬¬3éƒ¨åˆ†:åˆ›å»ºâ€œç‰¹æ®Šâ€ç±»å‹</h1><p id="cb0e" class="pw-post-body-paragraph jy jz jb ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å‹<code class="fe nh ni nj my b">Special</code>,å®ƒå…·æœ‰ä¸€äº›å±æ€§ï¼Œå¯ä»¥ä¸å…¶ä»–ç±»å‹åŒºåˆ†å¼€æ¥ã€‚æˆ‘ä»¬å¯ä»¥ç¼–é€ ä¸€äº›ä¸œè¥¿ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨è¿è¡Œæ—¶å¹¶ä¸çœŸçš„è¦ä½¿ç”¨å®ƒğŸ¤·â€â™‚ï¸.è®©æˆ‘ä»¬ä¹Ÿä¿®æ”¹ä¸€ä¸‹æˆ‘ä»¬çš„@specialè£…é¥°å™¨ï¼Œè¿™æ ·å®ƒå°±ä¸èƒ½å†ç”¨äºä¸æ˜¯<code class="fe nh ni nj my b">Special</code>çš„å±æ€§</p><pre class="mt mu mv mw gt mx my mz bn na nb bi"><span id="fc19" class="nc kz jb my b be nd ne l nf ng">/* SpecialType.ts */<br/><br/>export interface IsSpecial {<br/>  __imAUniqueSnowflake: true;<br/>}<br/><br/>// I guess you could say this is my specialty<br/>export type Special&lt;T&gt; = T &amp; IsSpecial;<br/><br/>// By typing our @special decorator like this,<br/>// decorated property need type 'IsSpecial'<br/>export function special&lt;<br/>  TKey extends string,<br/>  TTarget extends { [K in TKey]: IsSpecial }<br/>&gt;(target: TTarget, propertyName: TKey) {<br/>  // implementation here<br/>}</span></pre><p id="23d3" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨æˆ‘ä»¬æ–°ç±»å‹çš„æ¨¡å‹:</p><pre class="mt mu mv mw gt mx my mz bn na nb bi"><span id="8ce4" class="nc kz jb my b be nd ne l nf ng">/* SpecialTypeClass.ts */<br/><br/>import { special, Special } from "./SpecialType";<br/><br/>class SomeModel {<br/>  @special foo: Special&lt;number&gt;;<br/>  @special bar: Special&lt;Array&lt;string&gt;&gt;;<br/><br/>  baz: number;<br/>  qux: string;<br/>}<br/><br/>/* TESTING */<br/>const model = new SomeModel();<br/><br/>logNumber(model.foo); // âœ… OK<br/>model.foo = 5; // âŒ ERROR: Type '5' is not assignable to type 'Special&lt;number&gt;'. Type '5' is not assignable to type 'IsSpecial'.ts(2322)<br/>model.bar = ["abc"]; // âŒ ERROR Type 'string[]' is not assignable to type 'Special&lt;string[]&gt;'. Property '__imAUniqueSnowflake' is missing in type 'string[]' but required in type 'IsSpecial'.<br/><br/>function logNumber(n: number) {<br/>  console.log(n);<br/>}</span></pre><p id="3c84" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªæ–°é—®é¢˜ğŸ˜©ã€‚æˆ‘ä»¬ä»ç„¶å¯ä»¥å°†<code class="fe nh ni nj my b">model.foo</code>å’Œ<code class="fe nh ni nj my b">model.bar</code>ä¼ é€’ç»™éœ€è¦<code class="fe nh ni nj my b">number</code>å’Œ<code class="fe nh ni nj my b">Array&lt;string&gt;</code>çš„å‡½æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸èƒ½å†ç”¨æ²¡æœ‰è¢«è½¬æ¢ä¸º<code class="fe nh ni nj my b">Special</code>çš„å€¼æ¥æ›´æ–°<code class="fe nh ni nj my b">foo</code>å’Œ<code class="fe nh ni nj my b">bar</code>ã€‚å½“æ‚¨åœ¨ç±»ä¸Šå®šä¹‰åˆå§‹å€¼æ—¶ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªå¯æ¥å—çš„æŠ˜è¡·ï¼Œä½†æ˜¯å½“åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨è¯¥æ¨¡å‹æ—¶ï¼Œè¿™å°±ä¸å¤ªå®é™…äº†ã€‚</p><blockquote class="ny"><p id="9b67" class="nz oa jb bd ob oc od oe of og oh kv dk translated">è¿™çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªç¬¬22æ¡å†›è§„:æˆ‘ä»¬æƒ³è¦æ”¹å˜@specialä¿®é¥°å±æ€§çš„ç±»å‹ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æå–å®ƒä»¬ï¼Œä½†æ˜¯æ¯ä¸€æ¬¡æ”¹å˜éƒ½ä¼šä½¿å®ƒä»¬ä¸æˆ‘ä»¬çš„åŸå§‹ç±»å‹ä¸å…¼å®¹ã€‚</p></blockquote><h1 id="1b3a" class="ky kz jb bd la lb lc ld le lf lg lh li lj oi ll lm ln oj lp lq lr ok lt lu lv bi translated">ç¬¬4éƒ¨åˆ†:å›åˆ°ç»˜å›¾æ¿</h1><h2 id="042c" class="mc kz jb bd la md me dn le mf mg dp li kj mh mi lm kn mj mk lq kr ml mm lu mn bi translated">æ— æ³•æ¥å—ï¼Ÿ</h2><p id="46bb" class="pw-post-body-paragraph jy jz jb ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">å› æ­¤ï¼Œæˆ‘ä»¬ä»ä¸€ä¸ªä¸åˆé€‚çš„æ–¹æ³•å¼€å§‹:å°†å±æ€§æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„å¯¹è±¡ä¸Šã€‚ç„¶åæˆ‘ä»¬å¼€å§‹å°è¯•ä½¿ç”¨ç‰¹æ®Šç±»å‹æå–æˆ‘ä»¬çš„å±æ€§ã€‚è¿™ä¼¼ä¹ä½¿æˆ‘ä»¬çš„è¯¾å˜å¾—æ¯«æ— ç”¨å¤„ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æŠŠè¿™äº›æ–¹æ³•ç»„åˆæˆä¸€ä¸ªå¼—å…°è‚¯æ–¯å¦å¼çš„é»‘å®¢å¤§å¸ˆä¼šæ€ä¹ˆæ ·å‘¢ï¼ŸğŸ¤”å½“ç„¶ï¼Œè¿™å°†è§£å†³æˆ‘ä»¬çš„é—®é¢˜ã€‚</p><p id="fdb8" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ğŸ¦¹â€â™‚ ï¸Hereæ˜¯æˆ‘ä»¬é‚ªæ¶çš„æ€»è®¡åˆ’:</p><ol class=""><li id="3033" class="ol om jb ka b kb kc kf kg kj on kn oo kr op kv oq or os ot bi translated">ç”¨ä¸€ä¸ª<code class="fe nh ni nj my b">Special</code>ç±»å‹å®šä¹‰æˆ‘ä»¬ç±»çš„<code class="fe nh ni nj my b">@special</code>ä¿®é¥°å±æ€§</li><li id="91e1" class="ol om jb ka b kb ou kf ov kj ow kn ox kr oy kv oq or os ot bi translated">ä½¿ç”¨<code class="fe nh ni nj my b">Special</code>ç±»å‹æå–ç±»çš„ä¿®é¥°å±æ€§</li><li id="daa6" class="ol om jb ka b kb ou kf ov kj ow kn ox kr oy kv oq or os ot bi translated">åˆ›å»ºä¸€ä¸ª<strong class="ka jc">æ–°ç±»å‹</strong>ï¼Œå®ƒå°†æ‰€æœ‰çš„ä¿®é¥°å±æ€§è½¬æ¢å›å®ƒä»¬çš„åŸå§‹ç±»å‹<em class="kx">ï¼Œè€Œä¸”</em>è¿˜æ·»åŠ äº†ä¸€ä¸ªå•ç‹¬çš„å¯¹è±¡ï¼ŒåªåŒ…å«ä¿®é¥°å±æ€§</li><li id="af7f" class="ol om jb ka b kb ou kf ov kj ow kn ox kr oy kv oq or os ot bi translated">æ¬ºéª—typescriptè®¤ä¸ºæˆ‘ä»¬çš„åŸå§‹ç±»å®é™…ä¸Šæ˜¯è¿™ç§æ–°ç±»å‹ğŸ‘Œ</li></ol><h2 id="7312" class="mc kz jb bd la md me dn le mf mg dp li kj mh mi lm kn mj mk lq kr ml mm lu mn bi translated">æˆ‘ä»¬çš„æœ€ç»ˆæ¨¡å‹</h2><p id="dc3a" class="pw-post-body-paragraph jy jz jb ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">è¿™æ˜¯æˆ‘ä»¬æœ€ç»ˆæ¨¡å‹çš„æ ·å­:</p><pre class="mt mu mv mw gt mx my mz bn na nb bi"><span id="2f3c" class="nc kz jb my b be nd ne l nf ng">/* FinalModel.ts */<br/><br/>import { special, Special } from "./SpecialType";<br/>import WithSpecial from "./WithSpecial";<br/><br/>class FinalModel {<br/>  @special foo: Special&lt;number&gt;;<br/>  @special bar: Special&lt;Array&lt;string&gt;&gt;;<br/><br/>  baz: number;<br/>  qux: string;<br/>}<br/><br/>export default (FinalModel as unknown) as WithSpecial&lt;<br/>  typeof FinalModel<br/>&gt;;</span></pre><p id="51b4" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æ³¨æ„ï¼Œæœ€åä¸€è¡Œå·²ç»åŒ…å«äº†æˆ‘ä»¬é‚ªæ¶è®¡åˆ’çš„4ï¸âƒ£æ­¥éª¤ã€‚å®ƒå¯¼å‡ºäº†<code class="fe nh ni nj my b">FinalModel</code>ï¼Œä½†ç¨åŠ ä¿®æ”¹ã€‚é¦–å…ˆï¼Œå®ƒé€šè¿‡å°†TypeScriptå¼ºåˆ¶è½¬æ¢ä¸ºæœªçŸ¥çš„ç±»å‹æ¥å¿˜è®°å®ƒæ‰€çŸ¥é“çš„å…³äºè¿™ä¸ªç±»çš„ä¸€åˆ‡ã€‚ğŸ•¶</p><figure class="mt mu mv mw gt is"><div class="bz fp l di"><div class="oz nx l"/></div><figcaption class="pa pb gj gh gi pc pd bd b be z dk translated">"æœªçŸ¥"</figcaption></figure><p id="0625" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç¬¬äºŒï¼Œæˆ‘ä»¬ç”¨è‡ªå·±çš„è§£é‡Šæ›¿æ¢ç±»å‹ã€‚è¿™å°±æ˜¯<code class="fe nh ni nj my b">as WithSpecial&lt;typeof FinalModel&gt;</code>çš„ä½œç”¨ã€‚æˆ‘å–œæ¬¢è¿™ä¸ªæœ€ç»ˆè§£å†³æ–¹æ¡ˆçš„åŸå› æ˜¯ï¼Œæˆ‘ä»¬çš„æ¨¡å‹çœ‹èµ·æ¥éå¸¸æ¸…æ™°æ˜“è¯»ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ç±»å£°æ˜ä¸­åŠ å…¥ä¸€äº›<code class="fe nh ni nj my b">Special</code>ç±»å‹ï¼Œä½†æ˜¯æˆ‘ä»¬çš„decoratorç­¾åå°†ç¡®ä¿æˆ‘ä»¬ä¸ä¼šå¿˜è®°è¿™ä¸€ç‚¹ã€‚å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬ä»ç„¶å¿…é¡»å†™<code class="fe nh ni nj my b">WithSpecial</code>ï¼Œè¿™æ˜¯æ‰€æœ‰è‚®è„çš„é»‘å®¢æ”»å‡»å‘ç”Ÿçš„åœ°æ–¹ã€‚æ‰€ä»¥è®©æˆ‘ä»¬æŠŠå®ƒè—åœ¨ä¸€ä¸ªå•ç‹¬çš„æ¨¡å—é‡Œï¼Œè¿™æ ·å°±æ²¡äººä¼šå‘ç°å®ƒäº†ã€‚ğŸ¤«</p><h2 id="4195" class="mc kz jb bd la md me dn le mf mg dp li kj mh mi lm kn mj mk lq kr ml mm lu mn bi translated">è½¬æ¢ç±»å®šä¹‰</h2><p id="83a3" class="pw-post-body-paragraph jy jz jb ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è½¬æ¢ä¸€ä¸ªç±»å®šä¹‰å‘¢ï¼Ÿè¿™å½’ç»“ä¸ºä¸¤ä»¶äº‹:æ˜ å°„é™æ€å±æ€§å¹¶è½¬æ¢æ„é€ å‡½æ•°ä»¥ä½¿å®ƒè¿”å›æˆ‘ä»¬ä¿®æ”¹è¿‡çš„å®ä¾‹ç±»å‹:</p><pre class="mt mu mv mw gt mx my mz bn na nb bi"><span id="3d66" class="nc kz jb my b be nd ne l nf ng">/* WithSpecial.ts */<br/><br/>import TransformSpecial from "./TransformSpecial";<br/><br/>// type that will match any class (constructor)<br/>type AnyConstructor = new (...args: Array&lt;any&gt;) =&gt; any;<br/><br/>// extract the type of the arguments of a constructor function<br/>type ConstructorArgs&lt;T&gt; = T extends new (...args: infer A) =&gt; any<br/>  ? A<br/>  : never;<br/><br/>type WithSpecial&lt;T extends AnyConstructor&gt; = {<br/>  // include any static properties on the class<br/>  [K in keyof T]: T[K]<br/>} &amp; {<br/>  // type a constructor with the original arguments,<br/>  // but return a transformed instance<br/>  new (...args: ConstructorArgs&lt;T&gt;): TransformSpecial&lt;<br/>    InstanceType&lt;T&gt;<br/>  &gt;;<br/>};<br/><br/>export default WithSpecial;</span></pre><h2 id="8913" class="mc kz jb bd la md me dn le mf mg dp li kj mh mi lm kn mj mk lq kr ml mm lu mn bi translated">è½¬æ¢ç±»å®ä¾‹</h2><p id="bbc2" class="pw-post-body-paragraph jy jz jb ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">ç°åœ¨è®©æˆ‘ä»¬å®šä¹‰æ–°çš„å®ä¾‹ç±»å‹ã€‚æ‰€æœ‰çš„<code class="fe nh ni nj my b">Special</code>å±æ€§å°†è¢«æ˜ å°„å›å®ƒä»¬åŸæ¥çš„ç±»å‹ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º<code class="fe nh ni nj my b">__special</code>çš„æ–°å±æ€§ã€‚è¿™åœ¨è¿è¡Œæ—¶å¹¶ä¸çœŸæ­£å­˜åœ¨ï¼Œä½†TypeScriptä¼šè®¤ä¸ºå®ƒå­˜åœ¨ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥è®¿é—®æ‰€æœ‰çš„<code class="fe nh ni nj my b">Special</code>å±æ€§åç§°ï¼Œå³ä½¿å±æ€§æœ¬èº«ç°åœ¨æ¢å¤æ­£å¸¸ã€‚</p><pre class="mt mu mv mw gt mx my mz bn na nb bi"><span id="a3c4" class="nc kz jb my b be nd ne l nf ng">/* TransformSpecial.ts */<br/><br/>import { Special } from "./SpecialType";<br/><br/>// leftover from previous experiment<br/>// gets all keys of 'TTarget' where the value has type 'TValue'<br/>type KeysOfType&lt;TTarget extends object, TValue&gt; = {<br/>  [K in keyof TTarget]: TTarget[K] extends TValue ? K : never<br/>}[keyof TTarget];<br/><br/>type TransformSpecial&lt;T extends object&gt; = {<br/>  // map over all properties. If they are special, transform them back<br/>  [P in keyof T]: T[P] extends Special&lt;infer A&gt; ? A : T[P]<br/>} &amp; {<br/>  // define a new property, __special<br/>  // this will only contain all the Special properties<br/>  __special: Pick&lt;T, KeysOfType&lt;T, Special&lt;unknown&gt;&gt;&gt;;<br/>};<br/><br/>// we can use this to extract Special properties from our transformed class<br/>export type HasSpecial = { __special: object };<br/>export type SpecialKeys&lt;T extends HasSpecial&gt; = keyof T["__special"];<br/><br/>export default TransformSpecial;</span></pre><h2 id="6394" class="mc kz jb bd la md me dn le mf mg dp li kj mh mi lm kn mj mk lq kr ml mm lu mn bi translated">æ–°çš„å’Œæ”¹è¿›çš„getSpecialProperty</h2><p id="0fa0" class="pw-post-body-paragraph jy jz jb ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªç±»ï¼Œå…¶ä¸­æˆ‘ä»¬çš„å±æ€§æœ‰æ™®é€šç±»å‹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªutilæ¥æå–æ‰€æœ‰ä¿®é¥°å±æ€§ï¼Œæˆ‘ä»¬æœ€ç»ˆå¯ä»¥åˆ›å»ºæˆ‘ä»¬çš„æ”¹è¿›ç‰ˆæœ¬çš„<code class="fe nh ni nj my b">getSpecialProperty</code>ğŸ˜€</p><pre class="mt mu mv mw gt mx my mz bn na nb bi"><span id="a2da" class="nc kz jb my b be nd ne l nf ng">/* getSpecialProperty.fixed.ts */<br/><br/>import FinalModel from "./FinalModel";<br/>import { SpecialKeys, HasSpecial } from "./TransformSpecial";<br/><br/>function getSpecialProperty&lt;<br/>  TModel extends HasSpecial,<br/>  TKey extends SpecialKeys&lt;TModel&gt;<br/>&gt;(model: TModel, key: TKey): TModel[TKey] {<br/>  return model[key];<br/>}<br/><br/>/* TESTING */<br/>const model = new FinalModel();<br/><br/>// âœ… still works<br/>const fooValue = getSpecialProperty(model, "foo");<br/>// âŒ Gives an error now, because "qux" is not special!<br/>const quxValue = getSpecialProperty(<br/>  model,<br/>  "qux" /* Argument of type '"qux"' is not assignable to parameter of type '"foo" | "bar"'. */<br/>);</span></pre><p id="ca3f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è€Œéšç€<code class="fe nh ni nj my b">qux</code>ä¸Šçš„é‚£ä¸ªé”™è¯¯ï¼Œæˆ‘ä»¬çš„å¯»æ‰¾ä¹Ÿèµ°åˆ°äº†å°½å¤´ã€‚ğŸ‰ğŸˆğŸŠğŸ‘¯â€â™‚ï¸</p><p id="77f1" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æˆ‘ä»¬å·²ç»å®ç°äº†å¯¹ä¿®é¥°å±æ€§è¿›è¡Œç±»å‹æ£€æŸ¥çš„ç›®æ ‡ï¼Œç°åœ¨ç»ˆäºå¯ä»¥ä¼‘æ¯äº†ã€‚ğŸ˜´</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h1 id="c667" class="ky kz jb bd la lb nr ld le lf ns lh li lj nt ll lm ln nu lp lq lr nv lt lu lv bi translated">é—®ä¸ç­”(Question and Answer)</h1><blockquote class="lw lx ly"><p id="2584" class="jy jz kx ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated">æœ‰æ²¡æœ‰æ›´ç®€å•çš„æ–¹æ³•æ¥å®ç°è¿™ä¸€ç‚¹ï¼Ÿ</p></blockquote><p id="a7f4" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¯èƒ½</p><blockquote class="lw lx ly"><p id="dc9c" class="jy jz kx ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated">æˆ‘åº”è¯¥ç”¨è¿™ä¸ªé»‘å®¢å—ï¼Ÿ</p></blockquote><p id="f64a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¯èƒ½ä¸ä¼š</p><blockquote class="lw lx ly"><p id="1c06" class="jy jz kx ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated">æˆ‘èƒ½ç»„ç»‡æˆ‘çš„ä»£ç ï¼Œè¿™æ ·æˆ‘å°±ä¸ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜äº†å—ï¼Ÿ</p></blockquote><p id="3e92" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æ˜ç¡®åœ°</p><blockquote class="lw lx ly"><p id="5fc3" class="jy jz kx ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated">è¿™å€¼å¾—å—ï¼Ÿ</p></blockquote><p id="33eb" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">ç»å¯¹</strong></p><blockquote class="lw lx ly"><p id="8631" class="jy jz kx ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated">æˆ‘åªæ˜¯æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œå› ä¸ºæˆ‘ä¸æƒ³é˜…è¯»ä½ çš„é•¿ç¯‡å¤§è®ºã€‚æˆ‘å¯ä»¥æœ‰ä¸€ä¸ªå¤åˆ¶ç²˜è´´é€šç”¨ç‰ˆæœ¬ï¼Œèƒ½å¤Ÿæ³¨é‡Šå’Œæå–ä»»ä½•ä¸€ç»„å±æ€§å—ï¼Ÿå°±ç®—æˆ‘ä¸ç”¨è£…ä¿®å·¥ï¼Ÿ</p></blockquote><p id="8e51" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç»™ä½ :</p><pre class="mt mu mv mw gt mx my mz bn na nb bi"><span id="bafb" class="nc kz jb my b be nd ne l nf ng">/* generic.ts */<br/><br/>// use this to test if a class is transformed or if a property is a special attribute<br/>type WithAttribute&lt;TAttr extends string&gt; = { [K in TAttr]: object };<br/>// a generic version of the special attribute type<br/>type AttributeType&lt;TAttr extends string = string, TVal = unknown&gt; = {<br/>  value: TVal;<br/>} &amp; WithAttribute&lt;TAttr&gt;;<br/>// extract all the special attributes of a transformed class<br/>type AttributeKeysOf&lt;<br/>  TAttr extends string,<br/>  TModel extends WithAttribute&lt;TAttr&gt;<br/>&gt; = keyof TModel[TAttr];<br/><br/>// transform a class with typed attributes<br/><br/>// prettier-ignore<br/>type WithAttributes&lt;TModel extends new (...args: Array&lt;any&gt;) =&gt; any, TAttr extends string&gt; = {<br/>  [K in keyof TModel]: TModel[K] <br/>} &amp; {<br/>  new (...args: TModel extends new (...args: infer A) =&gt; any ? A : never): {<br/>    [P in keyof InstanceType&lt;TModel&gt;]: InstanceType&lt;TModel&gt;[P] extends AttributeType&lt;TAttr, infer A&gt; ? A : InstanceType&lt;TModel&gt;[P]<br/>  } &amp; {<br/>    [K in TAttr]: Pick&lt;InstanceType&lt;TModel&gt;, {<br/>      [K in keyof InstanceType&lt;TModel&gt;]: InstanceType&lt;TModel&gt;[K] extends AttributeType&lt;TAttr, any&gt; ? K : never<br/>    }[keyof InstanceType&lt;TModel&gt;]&gt;<br/>  };<br/>};<br/><br/>/* EXAMPLE USAGE -- creating an Ultra special attribtue */<br/><br/>// create our special attribute type 'Ultra'<br/>// it doesn't really matter what string you put here, as long as it's unique<br/>type UltraId = "__ultra";<br/>type Ultra&lt;T&gt; = AttributeType&lt;UltraId, T&gt;;<br/>type UltraKeysOf&lt;T extends WithAttribute&lt;UltraId&gt;&gt; = AttributeKeysOf&lt;<br/>  UltraId,<br/>  T<br/>&gt;;<br/><br/>/* EXAMPLE USAGE -- create a setter to set Ultra special attributes */<br/>function setSpecialProperty&lt;<br/>  TModel extends WithAttribute&lt;UltraId&gt;,<br/>  TKey extends UltraKeysOf&lt;TModel&gt;<br/>&gt;(model: TModel, key: TKey, value: TModel[TKey]) {<br/>  model[key] = value;<br/>}<br/><br/>/* EXAMPLE USAGE -- creating a model with Ultra special attributes */<br/>// don't use this one -- this is the base model<br/>class BaseModel {<br/>  ultraNumber: Ultra&lt;number&gt;;<br/>  ultraString: Ultra&lt;string&gt;;<br/><br/>  regularNumber: number;<br/>  someArray: Array&lt;string&gt;;<br/>}<br/>// use this one<br/>const Model = (BaseModel as unknown) as WithAttributes&lt;<br/>  typeof BaseModel,<br/>  UltraId<br/>&gt;;<br/>type Model = InstanceType&lt;typeof Model&gt;;<br/><br/>/* TESTING THE EXAMPLE */<br/>const model: Model = new Model();<br/><br/>setSpecialProperty(model, "ultraNumber", 5); // âœ… compiles<br/>setSpecialProperty(model, "ultraNumber", "5"); // âŒ Error, value should be number<br/>setSpecialProperty(model, "ultraString", "5"); // âœ… compiles<br/>setSpecialProperty(model, "ultraString", 5); // âŒ Error, value should be string<br/>setSpecialProperty(model, "regularNumber", 5); // âŒ Error, regularNumber is not Ultra<br/>setSpecialProperty(model, "someArray", ["abc"]); // âŒ Error, someArray is not Ultra<br/><br/>const logNumber = (n: number) =&gt; console.log(n);<br/>logNumber(model.ultraNumber); // âœ… ultraNumber is still of type number<br/>model.ultraNumber = 5; // âœ… still able to assign numbers to ultraNumber<br/><br/>/* EXAMPLE USAGE - limiting a decorator to Ultra typings */<br/>function ultra&lt;<br/>  TKey extends string,<br/>  TTarget extends { [K in TKey]: Ultra&lt;unknown&gt; }<br/>&gt;(target: TTarget, propertyName: TKey) {<br/>  // decorator implementation here<br/>}<br/><br/>class DecoratedModel {<br/>  @ultra someProperty: number; // âŒ Error, property has to have Ultra type<br/>  @ultra anotherOne: Ultra&lt;number&gt;; // âœ… compiles<br/>}</span></pre></div></div>    
</body>
</html>