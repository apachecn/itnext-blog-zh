<html>
<head>
<title>Routing with TypeScript decorators for node applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä¸ºèŠ‚ç‚¹åº”ç”¨ç¨‹åºä½¿ç”¨ç±»å‹è„šæœ¬è£…é¥°å™¨è¿›è¡Œè·¯ç”±</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/routing-with-typescript-decorators-for-node-applications-41a71f83f582?source=collection_archive---------7-----------------------#2019-04-02">https://itnext.io/routing-with-typescript-decorators-for-node-applications-41a71f83f582?source=collection_archive---------7-----------------------#2019-04-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7b13ee5879d7f1183156f5dea28ec284.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SsnGgHhisKAEKXDC1XphSg.png"/></div></div></figure><p id="eb9e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">åœ¨ç¼–å†™TypeScriptåº”ç”¨ç¨‹åºæ—¶ï¼ŒDecoratorså¯èƒ½æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ã€‚æˆ‘å–œæ¬¢ä½¿ç”¨å®ƒä»¬çš„ä¸€ç§æ–¹å¼æ˜¯åˆ›å»ºåŸºäºèŠ‚ç‚¹çš„MVC webåº”ç”¨ç¨‹åºï¼Œdecoratorsä¸ºè·¯ç”±æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„å·¥å…·ã€‚åƒè¿™æ ·æƒ³ä¸€æƒ³:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="c987" class="lf lg iq lb b gy lh li l lj lk"><a class="ae ll" href="http://twitter.com/Controller" rel="noopener ugc nofollow" target="_blank">@Controller</a>('/user')<br/>class UserController {<br/>    <a class="ae ll" href="http://twitter.com/Route" rel="noopener ugc nofollow" target="_blank">@Route</a>('/')<br/>    public index() {<br/>        // return proper response<br/>    }<br/>    <br/>    <a class="ae ll" href="http://twitter.com/Route" rel="noopener ugc nofollow" target="_blank">@Route</a>('/:name')<br/>    public details() {<br/>        // return proper response<br/>    }<br/>}</span></pre><p id="548c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è¿™å°†æä¾›ä»¥<code class="fe lm ln lo lb b">/user</code>ä¸ºå‰ç¼€çš„è·¯çº¿ï¼Œè€Œ<code class="fe lm ln lo lb b">/user</code>å¯èƒ½å¯¼è‡´ç”¨æˆ·æ¦‚è¿°ï¼Œè€Œ<code class="fe lm ln lo lb b">/user/:name</code>å¯¼è‡´ç”¨æˆ·ç»†èŠ‚ã€‚å¦‚æœä½ ä¹ æƒ¯äº<a class="ae ll" href="https://symfony.com/doc/current/routing.html" rel="noopener ugc nofollow" target="_blank"> Symfonyè·¯ç”±</a>æˆ–<a class="ae ll" href="https://docs.nestjs.com/controllers" rel="noopener ugc nofollow" target="_blank"> NestJSæ§åˆ¶å™¨</a>ï¼Œè¿™ä¸ªæ¦‚å¿µå¯èƒ½çœ‹èµ·æ¥å¾ˆç†Ÿæ‚‰ã€‚</p><h1 id="a2ed" class="lp lg iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">ä»‹ç»</h1><p id="104d" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<a class="ae ll" href="https://www.npmjs.com/package/ts-node" rel="noopener ugc nofollow" target="_blank"> ts-node </a>æ„å»ºä¸€ä¸ªå¸¦æœ‰TypeScriptçš„<a class="ae ll" href="http://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express </a>åº”ç”¨ç¨‹åº(è¿™ä½¿å¾—è¿è¡ŒTypeScriptåº”ç”¨ç¨‹åºè€Œä¸å¿…æ‰‹åŠ¨ç¼–è¯‘æˆ‘ä»¬çš„<code class="fe lm ln lo lb b">.ts</code>æ–‡ä»¶æˆä¸ºå¯èƒ½)ã€‚</p><p id="9943" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä½ æƒ³è¦çš„åº•å±‚æ¡†æ¶ï¼Œä¾‹å¦‚<a class="ae ll" href="https://koajs.com/" rel="noopener ugc nofollow" target="_blank"> koa </a>ã€<a class="ae ll" href="https://hapijs.com/" rel="noopener ugc nofollow" target="_blank"> hapi </a>æˆ–è€…ç”šè‡³æ˜¯ä½ è‡ªå·±çš„httpæœåŠ¡å™¨å®ç°ã€‚å·®å¼‚åº”è¯¥ä»…åœ¨å®é™…æ³¨å†Œè·¯ç”±æ—¶å‡ºç°ï¼Œå…¶ä»–ä¸€åˆ‡éƒ½åº”è¯¥ä¿æŒä¸å˜ã€‚æˆ‘é€‰æ‹©expressçš„å”¯ä¸€åŸå› æ˜¯å› ä¸ºæˆ‘å¯¹å®ƒæœ€æœ‰ç»éªŒâ€”â€”ä½†æ˜¯ä½ å¯ä»¥éšæ„ä½¿ç”¨ä½ æƒ³è¦çš„ä»»ä½•ä¸œè¥¿ã€‚</p><p id="053d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ä¸‡ä¸€ä½ åœ¨æ‰¾ä¸€ä¸ªTLï¼›DR:ä½ å¯ä»¥åœ¨GitHub ä¸Šæ‰¾åˆ°è¿™ç¯‡æ–‡ç« çš„<a class="ae ll" href="https://github.com/nehalist/ts-decorator-routing" rel="noopener ugc nofollow" target="_blank">å®Œæ•´æºä»£ç (åŒ…æ‹¬æµ‹è¯•)ã€‚</a></p><h1 id="f957" class="lp lg iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">ä½“ç³»ç»“æ„</h1><p id="afd7" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">ç”¨TypeScriptå®ç°è·¯ç”±åŠŸèƒ½æœ‰ä¸åŒçš„æ–¹æ³•ã€‚ä½†æ˜¯åœ¨å¼€å§‹å®ç°ä¹‹å‰ï¼Œè®°ä½ä¸€äº›äº‹æƒ…æ˜¯å¾ˆé‡è¦çš„ã€‚</p><p id="6529" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç¬¬ä¸€ä¸ªé‡è¦ä¿¡æ¯æ˜¯:</p><blockquote class="ms mt mu"><p id="667f" class="jy jz mr ka b kb kc kd ke kf kg kh ki mv kk kl km mw ko kp kq mx ks kt ku kv ij bi translated">Decoratorsæ˜¯åœ¨ç±»è¢«å£°æ˜æ—¶è°ƒç”¨çš„ï¼Œè€Œä¸æ˜¯åœ¨å®ƒè¢«å®ä¾‹åŒ–æ—¶ã€‚</p></blockquote><p id="cddc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æ‰€ä»¥å½“è£…é¥°æˆ‘ä»¬çš„æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬åœ¨æˆ‘ä»¬çš„è£…é¥°å™¨ä¸­ä½¿ç”¨å®ä¾‹åŒ–çš„å¯¹è±¡ã€‚ç›¸åï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªå¯ä»¥ä½¿ç”¨çš„ç±»å£°æ˜ã€‚æœ‰å…³è£…é¥°å·¥è¯„ä¼°è®¢å•çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§æ­¤å¤„çš„ã€‚</p><p id="00ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å› ä¸ºè£…é¥°è€…åªæ˜¯å‡½æ•°ï¼Œä»–ä»¬æœ‰è‡ªå·±çš„ä½œç”¨åŸŸã€‚ä¸€æ—¦æˆ‘ä»¬æ„è¯†åˆ°expressçš„è·¯ç”±æ³¨å†Œå‘ç”Ÿåœ¨decoratorsä¹‹å¤–ï¼Œè¿™å°±æœ‰ç‚¹æˆé—®é¢˜äº†:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi my"><img src="../Images/aded239a81324aa05175ce61ee83f3df.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/0*oWwANRrbZ7PI_KLN.png"/></div></figure><p id="3f37" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å°†æˆ‘ä»¬çš„è·¯ç”±ä»è£…é¥°å™¨è·å–åˆ°expressåº”ç”¨ç¨‹åºçš„ä¸€ç§æ–¹æ³•æ˜¯å¼•å…¥ä¸€ä¸ªæ³¨å†Œè¡¨ç±»ï¼Œå®ƒå°†ç”±æˆ‘ä»¬çš„è£…é¥°å™¨å¡«å……ï¼Œå¹¶åœ¨ç¨åæ³¨å†Œæˆ‘ä»¬çš„è·¯ç”±æ—¶è¯»å–ã€‚</p><p id="4b7f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">ä½†æ˜¯</strong>æœ‰ä¸€ç§æ›´ç®€å•çš„æ–¹æ³•ï¼Œå®ƒæ¶‰åŠåˆ°<a class="ae ll" href="https://github.com/rbuckton/reflect-metadata" rel="noopener ugc nofollow" target="_blank"> reflect-metadata </a>åº“(å¦‚æœä½ åœ¨å’Œdecoratorsæ‰“äº¤é“ï¼Œä½ å¯èƒ½å·²ç»åœ¨ä½¿ç”¨å®ƒäº†)ã€‚æˆ‘ä»¬å¯ä»¥ç®€å•åœ°å°†è·¯ç”±é™„åŠ åˆ°æ§åˆ¶å™¨å…ƒæ•°æ®ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å•ç‹¬çš„å±‚(ä»¥æ³¨å†Œè¡¨çš„å½¢å¼):</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/d0b8907a4b4c7e275ef669f4e85867b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/0*bVMBJMCKUDqmp8fp.png"/></div></figure><p id="ce6b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æˆ‘ä»¬åªéœ€å°†è·¯ç”±ä¿å­˜åˆ°æ§åˆ¶å™¨å…ƒæ•°æ®ä¸­ã€‚ç¨åï¼Œå½“åœ¨æˆ‘ä»¬çš„expressåº”ç”¨ç¨‹åºä¸­æ³¨å†Œæˆ‘ä»¬çš„è·¯çº¿æ—¶ï¼Œæˆ‘ä»¬å·²ç»éœ€è¦åŠ è½½æˆ‘ä»¬çš„æ§åˆ¶å™¨â€”â€”è¿™å°±æ˜¯æˆ‘ä»¬ç®€å•åœ°è¯»å–æˆ‘ä»¬çš„è·¯çº¿å…ƒæ•°æ®å¹¶æ­£ç¡®æ³¨å†Œå®ƒä»¬çš„åœ°æ–¹ã€‚</p><p id="1bb3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">çŸ¥é“äº†æ‰€æœ‰è¿™äº›ï¼Œè®©æˆ‘ä»¬å¼€å§‹å®ç°æˆ‘ä»¬çš„è·¯ç”±è£…é¥°å™¨å§ï¼</p><h1 id="f375" class="lp lg iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">å¿«é€Ÿç”³è¯·</h1><p id="dc43" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºæˆ‘ä»¬çš„expressåº”ç”¨ç¨‹åºã€‚åœ¨æˆ‘ä»¬çš„ç¬¬ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬å°†åªæä¾›ä¸€æ¡é»˜è®¤è·¯çº¿æ¥æµ‹è¯•æ˜¯å¦ä¸€åˆ‡æ­£å¸¸:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="3afa" class="lf lg iq lb b gy lh li l lj lk">// index.ts</span><span id="d740" class="lf lg iq lb b gy na li l lj lk">import 'reflect-metadata';<br/>import {Request, Response} from 'express';</span><span id="2e58" class="lf lg iq lb b gy na li l lj lk">const app = express();</span><span id="c6af" class="lf lg iq lb b gy na li l lj lk">app.get('/', (req: Request, res: Response) =&gt; {<br/>  res.send('Hello there!');<br/>});</span><span id="ffca" class="lf lg iq lb b gy na li l lj lk">app.listen(3000, () =&gt; {<br/>  console.log('Started express on port 3000');<br/>});</span></pre><blockquote class="ms mt mu"><p id="27bf" class="jy jz mr ka b kb kc kd ke kf kg kh ki mv kk kl km mw ko kp kq mx ks kt ku kv ij bi translated">æ¯ä¸ªåº”ç”¨ç¨‹åºåªéœ€è¦å¯¼å…¥ä¸€æ¬¡ï¼Œå› æ­¤è¿™é‡Œæ˜¯è¿™æ ·åšçš„å¥½åœ°æ–¹ã€‚</p></blockquote><p id="e77a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç”¨<code class="fe lm ln lo lb b">ts-node index.ts</code>å¯åŠ¨ä½ çš„æœåŠ¡å™¨ï¼Œå‰å¾€<code class="fe lm ln lo lb b">localhost:3000</code>æ¥å—<a class="ae ll" href="https://www.youtube.com/watch?v=rEq1Z0bjdwc" rel="noopener ugc nofollow" target="_blank">å¥¥æ¯”ä¸‡</a>çš„å‹å¥½é—®å€™ã€‚</p><h1 id="a890" class="lp lg iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">æ§åˆ¶å™¨è£…é¥°å™¨</h1><p id="b874" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">è¿™ä¸ªè£…é¥°å™¨å°†è¢«é™„åŠ åˆ°æˆ‘ä»¬çš„æ§åˆ¶å™¨ä¸Šï¼Œå¹¶åŒ…å«è¿™ä¸ªæ§åˆ¶å™¨çš„å‰ç¼€:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="0c67" class="lf lg iq lb b gy lh li l lj lk">// Decorator/Controller.ts</span><span id="5096" class="lf lg iq lb b gy na li l lj lk">export const Controller = (prefix: string = ''): ClassDecorator =&gt; {<br/>  return (target: any) =&gt; {<br/>    Reflect.defineMetadata('prefix', prefix, target);</span><span id="68a3" class="lf lg iq lb b gy na li l lj lk">// Since routes are set by our methods this should almost never be true (except the controller has no methods)<br/>    if (! Reflect.hasMetadata('routes', target)) {<br/>      Reflect.defineMetadata('routes', [], target);<br/>    }<br/>  };<br/>};</span></pre><p id="54b9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ä¸€ä¸ªéå¸¸ç®€å•çš„ç±»è£…é¥°å™¨ï¼Œå®ƒåœ¨æ§åˆ¶å™¨ä¸Šè®¾ç½®<code class="fe lm ln lo lb b">prefix</code>å…ƒæ•°æ®ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°<code class="fe lm ln lo lb b">routes</code>å…ƒæ•°æ®ï¼Œå°±å°†å…¶è®¾ç½®ä¸ºä¸€ä¸ªç©ºæ•°ç»„ã€‚å¦‚æ³¨é‡Šä¸­æ‰€è¿°ï¼Œ<code class="fe lm ln lo lb b">routes</code>å‡ ä¹ä¸åº”è¯¥æ˜¯<code class="fe lm ln lo lb b">undefined</code>ï¼Œé™¤éæˆ‘ä»¬çš„æ§åˆ¶å™¨æ²¡æœ‰ä¿®é¥°æ–¹æ³•ã€‚</p><h1 id="04f4" class="lp lg iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">è·¯çº¿è£…é¥°è€…</h1><p id="7a56" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">ä¸ºæ¯ä¸ªHTTPåŠ¨è¯ï¼Œå¦‚<code class="fe lm ln lo lb b">@Get</code>ã€<code class="fe lm ln lo lb b">@Post</code>ç­‰ï¼Œéƒ½æœ‰ä¸€ä¸ªè£…é¥°å™¨ä¼šå¾ˆæ–¹ä¾¿..ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬åªå®ç°äº†<code class="fe lm ln lo lb b">@Get</code>è£…é¥°å™¨:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="8a93" class="lf lg iq lb b gy lh li l lj lk">// Decorator/Get.ts</span><span id="87e5" class="lf lg iq lb b gy na li l lj lk">import {RouteDefinition} from '..';</span><span id="2dbe" class="lf lg iq lb b gy na li l lj lk">export const Get = (path: string): MethodDecorator =&gt; {<br/>  // `target` equals our class, `propertyKey` equals our decorated method name<br/>  return (target, propertyKey: string): void =&gt; {<br/>    // In case this is the first route to be registered the `routes` metadata is likely to be undefined at this point.<br/>    // To prevent any further validation simply set it to an empty array here.<br/>    if (! Reflect.hasMetadata('routes', target.constructor)) {<br/>      Reflect.defineMetadata('routes', [], target.constructor);<br/>    }</span><span id="b35f" class="lf lg iq lb b gy na li l lj lk">// Get the routes stored so far, extend it by the new route and re-set the metadata.<br/>    const routes = Reflect.getMetadata('routes', target.constructor) as Array&lt;RouteDefinition&gt;;</span><span id="22e0" class="lf lg iq lb b gy na li l lj lk">routes.push({<br/>      requestMethod: 'get',<br/>      path,<br/>      methodName: propertyKey<br/>    });<br/>    Reflect.defineMetadata('routes', routes, target.constructor);<br/>  };<br/>};</span></pre><blockquote class="ms mt mu"><p id="7420" class="jy jz mr ka b kb kc kd ke kf kg kh ki mv kk kl km mw ko kp kq mx ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="iq">é‡è¦:</em> </strong> <em class="iq">é‡è¦çš„æ˜¯è®¾å®šæˆ‘ä»¬çš„ç›®æ ‡</em> <code class="fe lm ln lo lb b"><em class="iq">target.constructor</em></code> <em class="iq">è€Œä¸ä»…ä»…æ˜¯</em> <code class="fe lm ln lo lb b"><em class="iq">target</em></code> <em class="iq">æ¥æ°å½“åœ°å¤„ç†å…ƒæ•°æ®ã€‚</em></p></blockquote><p id="8a19" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">åŒæ ·ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„è£…é¥°å™¨ï¼Œå®ƒé€šè¿‡ä¸€ä¸ªæ–°çš„è·¯ç”±æ¥æ‰©å±•æ§åˆ¶å™¨ä¸Šå­˜å‚¨çš„è·¯ç”±ã€‚<code class="fe lm ln lo lb b">RouteDefinition</code>æ˜¯å®šä¹‰è·¯çº¿å½¢çŠ¶çš„ç•Œé¢:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="2bae" class="lf lg iq lb b gy lh li l lj lk">// Model/RouteDefinition.ts</span><span id="532c" class="lf lg iq lb b gy na li l lj lk">export interface RouteDefinition {<br/>  // Path to our route<br/>  path: string;<br/>  // HTTP Request method (get, post, ...)<br/>  requestMethod: 'get' | 'post' | 'delete' | 'options' | 'put';<br/>  // Method name within our class responsible for this route<br/>  methodName: string;<br/>}</span></pre><blockquote class="ms mt mu"><p id="4bb5" class="jy jz mr ka b kb kc kd ke kf kg kh ki mv kk kl km mw ko kp kq mx ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="iq">æç¤º:</em> </strong> <em class="iq">å¦‚æœæ‚¨æƒ³åœ¨æ§åˆ¶å™¨ä¹‹å‰æ·»åŠ ä¸€äº›ä¸­é—´ä»¶ï¼Œæœ€å¥½å°†å…¶å­˜å‚¨åœ¨</em> <code class="fe lm ln lo lb b"><em class="iq">RouteDefinition</em></code> <em class="iq">ä¸­ã€‚</em></p></blockquote><p id="205e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç°åœ¨æˆ‘ä»¬å·²ç»å¾—åˆ°äº†æˆ‘ä»¬éœ€è¦çš„ä¸¤ä¸ªè£…é¥°è€…ï¼Œå¯ä»¥è¿”å›åˆ°æˆ‘ä»¬çš„expressåº”ç”¨ç¨‹åºæ¥æ³¨å†Œæˆ‘ä»¬çš„è·¯çº¿äº†ã€‚</p><h1 id="4733" class="lp lg iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">æ³¨å†Œè·¯çº¿</h1><p id="a4ef" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">åœ¨å°†æˆ‘ä»¬çš„è·¯ç”±æ³¨å†Œåˆ°æˆ‘ä»¬çš„expressåº”ç”¨ç¨‹åºä¹‹å‰ï¼Œè®©æˆ‘ä»¬ç”¨æ–°çš„decoratorså®ç°ä¸€ä¸ªæ§åˆ¶å™¨:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="45bf" class="lf lg iq lb b gy lh li l lj lk">// UserController.ts</span><span id="ece2" class="lf lg iq lb b gy na li l lj lk">import {Controller} from '../src';<br/>import {Get} from '../src';<br/>import {Request, Response} from 'express';</span><span id="8d87" class="lf lg iq lb b gy na li l lj lk"><a class="ae ll" href="http://twitter.com/Controller" rel="noopener ugc nofollow" target="_blank">@Controller</a>('/user')<br/>export default class UserController {<br/>  <a class="ae ll" href="http://twitter.com/Get" rel="noopener ugc nofollow" target="_blank">@Get</a>('/')<br/>  public index(req: Request, res: Response) {<br/>    return res.send('User overview');<br/>  }</span><span id="d666" class="lf lg iq lb b gy na li l lj lk"><a class="ae ll" href="http://twitter.com/Get" rel="noopener ugc nofollow" target="_blank">@Get</a>('/:name')<br/>  public details(req: Request, res: Response) {<br/>    return res.send(`You are looking at the profile of ${req.params.name}`);<br/>  }<br/>}</span></pre><p id="59a7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æ ‡é¢˜åˆ°<code class="fe lm ln lo lb b">/user</code>åº”è¯¥æ˜¾ç¤ºä¸€ä¸ªâ€œç”¨æˆ·æ¦‚è¿°â€ä¿¡æ¯ï¼Œè€Œ<code class="fe lm ln lo lb b">/user/foobar</code>åº”è¯¥æ˜¾ç¤ºä¸€ä¸ªâ€œä½ æ­£åœ¨æŸ¥çœ‹foobarçš„ä¸ªäººèµ„æ–™â€ä¿¡æ¯ã€‚</p><p id="c79b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ä½†æ˜¯åœ¨è¿™å®Œå…¨èµ·ä½œç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰expressæˆ‘ä»¬çš„è·¯çº¿â€”â€”æ‰€ä»¥è®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„<code class="fe lm ln lo lb b">index.ts</code>:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="89b8" class="lf lg iq lb b gy lh li l lj lk">import 'reflect-metadata';<br/>import * as express from 'express';<br/>import UserController from './example/UserController';<br/>import {RouteDefinition} from './src';</span><span id="4f99" class="lf lg iq lb b gy na li l lj lk">const app = express();</span><span id="79bb" class="lf lg iq lb b gy na li l lj lk">app.get('/', (req: express.Request, res: express.Response) =&gt; {<br/>  res.send('Hello there!');<br/>});</span><span id="abb2" class="lf lg iq lb b gy na li l lj lk">// Iterate over all our controllers and register our routes<br/>[<br/>  UserController<br/>].forEach(controller =&gt; {<br/>  // This is our instantiated class<br/>  const instance                       = new controller();<br/>  // The prefix saved to our controller<br/>  const prefix                         = Reflect.getMetadata('prefix', controller);<br/>  // Our `routes` array containing all our routes for this controller<br/>  const routes: Array&lt;RouteDefinition&gt; = Reflect.getMetadata('routes', controller);<br/>  <br/>  // Iterate over all routes and register them to our express application <br/>  routes.forEach(route =&gt; {<br/>    // It would be a good idea at this point to substitute the `app[route.requestMethod]` with a `switch/case` statement<br/>    // since we can't be sure about the availability of methods on our `app` object. But for the sake of simplicity<br/>    // this should be enough for now.<br/>    app[route.requestMethod](prefix + route.path, (req: express.Request, res: express.Response) =&gt; {<br/>      // Execute our method for this path and pass our express request and response object.<br/>      instance[route.methodName](req, res);<br/>    });<br/>  });<br/>});</span><span id="a08e" class="lf lg iq lb b gy na li l lj lk">app.listen(3000, () =&gt; {<br/>  console.log('Started express on port 3000');<br/>});</span></pre><p id="68dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç§ï¼Œå°±æ˜¯è¿™æ ·ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥å¯¼èˆªåˆ°<code class="fe lm ln lo lb b">/user</code>æˆ–<code class="fe lm ln lo lb b">/user/&lt;name&gt;</code>ï¼Œå¹¶ä»æˆ‘ä»¬çš„å¿«é€Ÿåº”ç”¨ç¨‹åºä¸­è·å¾—é€‚å½“çš„å“åº”ã€‚<em class="mr">å“‡å‘¼ï¼</em></p><h1 id="f52c" class="lp lg iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">æ¨è¿›è¿™ç§æ–¹æ³•</h1><p id="8efe" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">è¿™æ˜¯ä¸€ä¸ªéå¸¸åŸºæœ¬çš„æ–¹æ³•ï¼Œåœ¨å®é™…å®ç°ä¸­è¿˜æœ‰å¾ˆå¤šæ”¹è¿›çš„ç©ºé—´ã€‚ä¸‹é¢æ˜¯ä¸€äº›å…³äºæ”¹è¿›è¿™ç§å®ç°çš„æƒ³æ³•:</p><h1 id="cf12" class="lp lg iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">å®ä¾‹åŒ–</h1><p id="3079" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">æˆ‘ä»¬çš„æ§åˆ¶å™¨ç”¨<code class="fe lm ln lo lb b">new controller()</code>å¤©çœŸåœ°å®ä¾‹åŒ–äº†ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬çš„æ§åˆ¶å™¨æœ‰ä¸€äº›<code class="fe lm ln lo lb b">constructor</code>å‚æ•°å‘¢ï¼Ÿ</p><p id="a997" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è¿™å°†æ˜¯ä¸€ä¸ªå®Œç¾çš„ç”¨ä¾‹æ¥åº”ç”¨ä¸€äº›<a class="ae ll" href="https://nehalist.io/dependency-injection-in-typescript/" rel="noopener ugc nofollow" target="_blank">ä¾èµ–æ³¨å…¥ï¼Œå¦‚å‰ä¸€ç¯‡æ–‡ç« </a>ä¸­æ‰€æè¿°çš„ï¼Œå®ƒå°†è¢«æ’å…¥åˆ°æˆ‘ä»¬çš„æ§åˆ¶å™¨è¢«å®ä¾‹åŒ–çš„åœ°æ–¹ã€‚</p><h1 id="0607" class="lp lg iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">è¿”å›å€¼</h1><p id="48b3" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">æˆ‘ä¸æ˜¯<code class="fe lm ln lo lb b">res.send()</code>çš„ç‹‚çƒ­ç²‰ä¸â€”â€”ç›¸åï¼Œå¦‚æœå“åº”å¯ä»¥æ˜¯åæ˜ å…¶å†…å®¹çš„ç®€å•å¯¹è±¡ï¼Œé‚£ä¼šéå¸¸æ–¹ä¾¿(æƒ³æƒ³ç±»ä¼¼<code class="fe lm ln lo lb b">return new JsonResponse(/* ... */)</code>çš„ä¸œè¥¿)ã€‚è¿™å¯ä»¥é€šè¿‡å®ç°è¿™æ ·çš„å“åº”å¯¹è±¡å¹¶ä»æˆ‘ä»¬çš„æ–¹æ³•ä¸­è¿”å›å®ƒä»¬æ¥è½»æ¾å®Œæˆâ€”â€”ç¨åï¼Œå½“æ³¨å†Œæˆ‘ä»¬çš„è·¯ç”±æ—¶ï¼Œå›è°ƒä»ç„¶ä¼š<code class="fe lm ln lo lb b">send</code>æˆ‘ä»¬çš„å“åº”:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="be24" class="lf lg iq lb b gy lh li l lj lk">app[route.requestMethod](prefix + route.path, (req: express.Request, res: express.Response) =&gt; {<br/>  const response = instance[route.methodName](req, res);<br/>  res.send(response.getContent()); // where `getContent` returns the actual response content</span></pre><p id="a8e0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è¿™å°†éœ€è¦å¯¹æˆ‘ä»¬çš„è¿”å›å€¼è¿›è¡Œé¢å¤–çš„éªŒè¯ï¼Œå°¤å…¶æ˜¯ä¸ºäº†é˜²æ­¢expressç”±äºç¼ºå°‘ä¸€ä¸ª<code class="fe lm ln lo lb b">next()</code>è°ƒç”¨è€Œè¢«é˜»å¡(è¿™ä¸ªè°ƒç”¨åŒ…å«åœ¨<code class="fe lm ln lo lb b">send</code>ä¸­ï¼Œä½†æ˜¯å¦‚æœæ‚¨ä¸ä½¿ç”¨<code class="fe lm ln lo lb b">send</code>åˆ™éœ€è¦æ‰‹åŠ¨è°ƒç”¨)ã€‚</p><h1 id="af6e" class="lp lg iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">ç»“è®º</h1><p id="8174" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">æ­£å¦‚æ‚¨åˆšåˆšçœ‹åˆ°çš„ï¼Œé€šè¿‡TypeScript decoratorså¤„ç†è·¯ç”±éå¸¸ç®€å•ï¼Œä¸éœ€è¦å¤ªå¤šçš„é­”æ³•ï¼Œä¹Ÿä¸éœ€è¦å®‰è£…æ¡†æ¶æˆ–ä»»ä½•é¢å¤–çš„åº“ã€‚</p><p id="cf08" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ä¸€å¦‚æ—¢å¾€ï¼Œè¿™ç¯‡æ–‡ç« çš„å…¨éƒ¨æºä»£ç (åŒ…æ‹¬æµ‹è¯•)å¯ä»¥åœ¨GitHub ä¸Šæ‰¾åˆ°ã€‚</p><p id="c48f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mr">å¦‚æœä½ æœ‰å…¶ä»–æ–¹æ³•æ¥å®ç°è¿™ä¸ªç›®æ ‡ï¼Œæˆ–è€…å¯¹è¿™ç¯‡æ–‡ç« ä¸­æè¿°çš„æ–¹æ³•æœ‰ä»»ä½•æƒ³æ³•ï¼Œè¯·ç•™ä¸‹ä½ çš„è¯„è®ºï¼</em></p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><p id="a87b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mr">å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·ç•™ä¸‹ä½ çš„ğŸ‘ï¼Œå…³æ³¨æˆ‘ä¸Š</em> <a class="ae ll" href="https://twitter.com/nehalist" rel="noopener ugc nofollow" target="_blank"> <em class="mr">æ¨ç‰¹</em> </a> <em class="mr">å¹¶è®¢é˜…</em> <a class="ae ll" href="https://nehalist.io/newsletter/" rel="noopener ugc nofollow" target="_blank"> <em class="mr">æˆ‘çš„å¿«è®¯</em> </a> <em class="mr">ã€‚åŸè½½äº2019å¹´4æœˆ2æ—¥</em><a class="ae ll" href="https://nehalist.io/routing-with-typescript-decorators/" rel="noopener ugc nofollow" target="_blank"><em class="mr">nehalist . io</em></a><em class="mr">ã€‚</em></p></div></div>    
</body>
</html>