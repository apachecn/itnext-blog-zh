<html>
<head>
<title>Build FFmpeg WebAssembly version (= ffmpeg.wasm): Part.2 Compile with Emscripten</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">æ„å»ºFFmpeg WebAssemblyç‰ˆæœ¬(= ffmpeg.wasm):ç¬¬2éƒ¨åˆ†ç”¨Emscriptenç¼–è¯‘</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/build-ffmpeg-webassembly-version-ffmpeg-js-part-2-compile-with-emscripten-4c581e8c9a16?source=collection_archive---------3-----------------------#2019-10-13">https://itnext.io/build-ffmpeg-webassembly-version-ffmpeg-js-part-2-compile-with-emscripten-4c581e8c9a16?source=collection_archive---------3-----------------------#2019-10-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/8c0c378d4f8e771bf56ebf20e4685f63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*bJYwDAe6Hj59mpHZr46olQ.png"/></div></figure><blockquote class="jx jy jz"><p id="4554" class="ka kb kc kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="it"> 2020/9æ›´æ–°:ä¿®æ”¹æ•…äº‹ï¼Œä½¿å…¶åœ¨MacOSä¸­å·¥ä½œã€‚</em></p><p id="f2d0" class="ka kb kc kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2020/2/11æ›´æ–°:ä»è¿™ä¸ªæ•…äº‹çš„ååº”æ¥çœ‹ï¼Œç›®å‰éµå¾ªæŒ‡ä»¤åœ¨Macç¯å¢ƒä¸‹ä¸èµ·ä½œç”¨ã€‚æˆ‘æ— æ³•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºæˆ‘æ²¡æœ‰è‡ªå·±çš„é—®é¢˜ã€‚åœ¨Macä¸­æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯åœ¨è™šæ‹Ÿæœºä¸­å®‰è£…åƒUbuntuä¸€æ ·çš„linuxå‘è¡Œç‰ˆã€‚</p></blockquote><p id="ee8c" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">ä¸Šä¸€ä¸ªæ•…äº‹:<a class="ae lc" href="https://medium.com/@jeromewus/build-ffmpeg-webassembly-version-ffmpeg-js-part-1-preparation-ed12bf4c8fac" rel="noopener">æ„å»ºFFmpeg WebAssemblyç‰ˆæœ¬(= ffmpeg.wasm): Part.1å‡†å¤‡</a></p><blockquote class="jx jy jz"><p id="103d" class="ka kb kc kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ä»è¿™é‡Œå¼€å§‹ï¼Œäº‹æƒ…å°†å˜å¾—æ›´åŠ å¤æ‚å’Œéš¾ä»¥ç†è§£ï¼Œå¦‚æœä½ ä¸çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä½ å¯èƒ½éœ€è¦è°·æ­ŒèƒŒæ™¯çŸ¥è¯†(æˆ–è€…ä½ å¯ä»¥ç•™ä¸‹å›ç­”æ¥é—®æˆ‘)ã€‚</p><p id="6924" class="ka kb kc kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æ­¤å¤–ï¼Œä¸ºäº†ä½¿æœ¬æ•™ç¨‹æ›´æœ‰ç”¨ï¼Œæˆ‘è¯•ç€å†™ä¸‹æˆ‘å¦‚ä½•è§£å†³æ¯ä¸ªé—®é¢˜çš„ç»†èŠ‚ï¼Œå¸Œæœ›å®ƒèƒ½å¸®åŠ©ä½ å»ºç«‹ä½ é€‰æ‹©çš„åº“ã€‚</p></blockquote><p id="5505" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæ‚¨å°†å­¦ä¹ :</p><ol class=""><li id="f775" class="ld le it kd b ke kf ki kj kz lf la lg lb lh ky li lj lk ll bi translated">å¦‚ä½•ä½¿ç”¨Dockerè®¾ç½®è„šæœ¬ç¯å¢ƒ</li><li id="ad45" class="ld le it kd b ke lm ki ln kz lo la lp lb lq ky li lj lk ll bi translated"><code class="fe lr ls lt lu b">emconfigure</code>å’Œ<code class="fe lr ls lt lu b">emmake</code>çš„ç”¨æ³•</li><li id="e12e" class="ld le it kd b ke lm ki ln kz lo la lp lb lq ky li lj lk ll bi translated">å¦‚ä½•ä¿®å¤ç”¨Emscriptenç¼–è¯‘FFmpegæ—¶çš„é—®é¢˜</li></ol></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="77a2" class="mc md it bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">å¦‚ä½•ä½¿ç”¨Dockerè®¾ç½®è„šæœ¬ç¯å¢ƒ</h1><p id="05cd" class="pw-post-body-paragraph ka kb it kd b ke na kg kh ki nb kk kl kz nc ko kp la nd ks kt lb ne kw kx ky im bi translated">åœ¨<a class="ae lc" href="https://medium.com/@jeromewus/build-ffmpeg-webassembly-version-ffmpeg-js-part-1-preparation-ed12bf4c8fac" rel="noopener">æ„å»ºFFmpeg WebAssemblyç‰ˆæœ¬(= ffmpeg.wasm): Part.1å‡†å¤‡</a>ä¸­ï¼Œæˆ‘ä»¬å·²ç»ç”¨GCCæ„å»ºäº†FFmpegçš„åŸå§‹ç‰ˆæœ¬ï¼Œç°åœ¨æˆ‘ä»¬è½¬è€Œä½¿ç”¨Emscriptenã€‚</p><p id="d440" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">æˆ‘ä»¬è¦ç”¨çš„emscriptençš„ç‰ˆæœ¬æ˜¯1 . 39 . 18(trz ECI/Emscripten:1 . 39 . 18-upstream)ï¼Œä½ å¯ä»¥é€šè¿‡<a class="ae lc" href="https://emscripten.org/docs/getting_started/downloads.html#installation-instructions" rel="noopener ugc nofollow" target="_blank">å®˜æ–¹æ•™ç¨‹</a>å®‰è£…Emscripten(æœ¬æ•™ç¨‹ä¸­æˆ‘ä»¬æ˜¯<a class="ae lc" href="https://github.com/mymindstorm/setup-emsdk" rel="noopener ugc nofollow" target="_blank">setup-EMS dk</a>Github Actions in MAC OS)æˆ–è€…ä»docker hubæ‹‰Emscriptené•œåƒã€‚</p><pre class="nf ng nh ni gt nj lu nk nl aw nm bi"><span id="9c00" class="nn md it lu b gy no np l nq nr">$ docker pull trzeci/emscripten:1.39.18-upstream</span></pre><blockquote class="jx jy jz"><p id="f6ba" class="ka kb kc kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">è¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿçš„æ—¶é—´ï¼Œå› ä¸ºæ˜ åƒçš„å¤§å°çº¦ä¸º1 GBã€‚</p></blockquote><p id="fc58" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">ç„¶åæˆ‘ä»¬éœ€è¦æ›´æ–°<code class="fe lr ls lt lu b">build-with-docker.sh</code>å¦‚ä¸‹:</p><figure class="nf ng nh ni gt ju"><div class="bz fp l di"><div class="ns nt l"/></div></figure><blockquote class="jx jy jz"><p id="ff15" class="ka kb kc kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ç¬¬8è¡Œä¸æ˜¯å¿…éœ€çš„ï¼Œä½†æ˜¯å®ƒå¯ä»¥å¸®åŠ©æ‚¨åœ¨åç»­æ„å»ºä¸­åŠ å¿«é€Ÿåº¦ã€‚</p></blockquote><p id="bc46" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">ä¸‹ä¸€æ­¥æˆ‘ä»¬è¦åšçš„æ˜¯æ‰¾åˆ°ç”¨emscriptenæ„å»ºFFmpegçš„é…ç½®ï¼Œè¿™æ˜¯ä¸€ä¸ªè¯•é”™çš„è¿‡ç¨‹ï¼Œéœ€è¦æŒ–æ˜æ–‡æ¡£å’Œè€å¿ƒã€‚</p><h1 id="92e2" class="mc md it bd me mf nu mh mi mj nv ml mm mn nw mp mq mr nx mt mu mv ny mx my mz bi translated"><code class="fe lr ls lt lu b">emconfigure </code>å’Œ<code class="fe lr ls lt lu b">emmake &amp; </code>çš„ç”¨æ³•å¦‚ä½•ä¿®å¤ç”¨Emscriptenç¼–è¯‘FFmpegæ—¶çš„é—®é¢˜</h1><p id="d7b0" class="pw-post-body-paragraph ka kb it kd b ke na kg kh ki nb kk kl kz nc ko kp la nd ks kt lb ne kw kx ky im bi translated">è®©æˆ‘ä»¬å¼€å§‹å¯»æ‰¾æ­£ç¡®é…ç½®çš„æ—…ç¨‹ã€‚åœ¨Part.1ä¸­ï¼Œå®ƒä»¥<code class="fe lr ls lt lu b">./configure --disable-x86asm</code>å¼€å¤´ï¼Œè¦ç”¨emscriptenæ¥åšï¼Œéœ€è¦æŠŠå®ƒæ”¹æˆ<code class="fe lr ls lt lu b">emconfigure ./configure --disable-x86asm</code>ã€‚(æœ‰å…³emconfigureçš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹æ­¤å¤„çš„<a class="ae lc" href="https://emscripten.org/docs/compiling/Building-Projects.html#integrating-with-a-build-system" rel="noopener ugc nofollow" target="_blank"/>)ç”±äºæˆ‘ä»¬æ­£åœ¨è¿›è¡Œäº¤å‰ç¼–è¯‘ï¼Œå› æ­¤éœ€è¦æ·»åŠ äº¤å‰ç¼–è¯‘æ ‡å¿—æ¥æ˜ç¡®å‘ŠçŸ¥FFmpegã€‚</p><p id="7820" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">ä¸‹é¢æˆ‘ä»¬æ¥æ›´æ–°ä¸€ä¸‹<code class="fe lr ls lt lu b">build.sh</code>å§:</p><figure class="nf ng nh ni gt ju"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="2482" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">ç¥å¥‡çš„æ˜¯ï¼Œæ²¡æœ‰ä»»ä½•é”™è¯¯ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è¾“å…¥<code class="fe lr ls lt lu b">emmake make -j</code>å°±å¯ä»¥å¾—åˆ°FFmpeg.wasmäº†å—ï¼Ÿä¸å¹¸çš„æ˜¯ï¼Œç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œ<code class="fe lr ls lt lu b">emconfigure</code>æœ€é‡è¦çš„ä»»åŠ¡ä¹‹ä¸€å°±æ˜¯å°†ç¼–è¯‘å™¨ä»gccæ›¿æ¢ä¸ºemcc(æˆ–è€…g++æ›¿æ¢ä¸ºem++)ï¼Œä½†æ˜¯åœ¨<code class="fe lr ls lt lu b">./configure</code>çš„è¾“å‡ºä¸­ï¼Œæˆ‘ä»¬ä»ç„¶å¾—åˆ°gccä½œä¸ºæˆ‘ä»¬çš„ç¼–è¯‘å™¨ã€‚</p><pre class="nf ng nh ni gt nj lu nk nl aw nm bi"><span id="3087" class="nn md it lu b gy no np l nq nr">emscripten sdl2-config called with /emsdk_portable/emscripten/tag-1.38.45/system/bin/sdl2-config --cflags                            <br/>emscripten sdl2-config called with /emsdk_portable/emscripten/tag-1.38.45/system/bin/sdl2-config --libs                               <br/>install prefix            /usr/local                                                                                                   <br/>source path               .                                                                                                                <br/>C compiler                gcc             # Should be emcc                                                                                             <br/>C library                 glibc                                                                                                           <br/>ARCH                      x86 (generic)                                                                                                     <br/>big-endian                no                                                                                                            <br/>runtime cpu detection     yes                                                                                                         <br/>standalone assembly       no                                                                                                            <br/>x86 assembler             nasm</span></pre><p id="d136" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">æ¯ä¸ªè‡ªåŠ¨åŒ–å·¥å…·éƒ½æœ‰å…¶å±€é™æ€§ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ“ä½œã€‚è®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹æ˜¯å¦æœ‰ä»»ä½•è®ºç‚¹å¯ä»¥æ‹¯æ•‘æˆ‘ä»¬ã€‚</p><pre class="nf ng nh ni gt nj lu nk nl aw nm bi"><span id="b90b" class="nn md it lu b gy no np l nq nr">$ ./configure --help</span></pre><p id="80f7" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">åœ¨<code class="fe lr ls lt lu b">Toolchain options</code>ä¸‹ï¼Œæœ‰å‚æ•°åˆ†é…ç¼–è¯‘å™¨ä½¿ç”¨ã€‚</p><pre class="nf ng nh ni gt nj lu nk nl aw nm bi"><span id="ac38" class="nn md it lu b gy no np l nq nr">root@57ab95def750:/src# ./configure --help<br/>Usage: configure [options]<br/>Options: [defaults in brackets after descriptions]</span><span id="acb9" class="nn md it lu b gy nz np l nq nr">Help options:<br/>...<br/>Toolchain options:                                                                                                             <br/>...<br/>  --nm=NM                  use nm tool NM [nm -g]<br/>  --ar=AR                  use archive tool AR [ar]<br/>  --as=AS                  use assembler AS []<br/>  --ln_s=LN_S              use symbolic link tool LN_S [ln -s -f]<br/>  --strip=STRIP            use strip tool STRIP [strip]<br/>  --windres=WINDRES        use windows resource compiler WINDRES [windres]<br/>  --x86asmexe=EXE          use nasm-compatible assembler EXE [nasm]<br/>  --cc=CC                  use C compiler CC [gcc]<br/>  --cxx=CXX                use C compiler CXX [g++]<br/>  --objcc=OCC              use ObjC compiler OCC [gcc]<br/>  --dep-cc=DEPCC           use dependency generator DEPCC [gcc]<br/>  --nvcc=NVCC              use Nvidia CUDA compiler NVCC [nvcc]<br/>  --ld=LD                  use linker LD []<br/>...</span></pre><p id="d2f2" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">è®©æˆ‘ä»¬åœ¨<code class="fe lr ls lt lu b">build.sh</code>ä¸­å°†è¿™äº›å‚æ•°ä¼ é€’ç»™emscriptenè¿›è¡Œç¼–è¯‘:</p><figure class="nf ng nh ni gt ju"><div class="bz fp l di"><div class="ns nt l"/></div></figure><blockquote class="jx jy jz"><p id="67cb" class="ka kb kc kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">å¯¹äºæœ¬æœºç‰ˆæœ¬ï¼Œè¯·ç¡®ä¿<code class="fe lr ls lt lu b">llvm-ranlib</code>ã€<code class="fe lr ls lt lu b">llvm-as</code>å’Œ<code class="fe lr ls lt lu b">llvm-nm</code>å­˜åœ¨ã€‚å¦‚æœæ²¡æœ‰ï¼Œæ‚¨å¯ä»¥åœ¨<code class="fe lr ls lt lu b">$EMSDK_ROOT/upstream/bin</code>ä¸­æ‰¾åˆ°å®ƒä»¬ã€‚</p></blockquote><p id="21a5" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">æœ‰äº†è¿™äº›å‚æ•°ï¼Œ<code class="fe lr ls lt lu b">./configure</code>å°†ä¼šèŠ±è´¹æ›´å¤šçš„æ—¶é—´æ¥è¿è¡Œï¼Œä½†æ˜¯ä½ æœ€ç»ˆä¼šå¾—åˆ°æƒ³è¦çš„è¾“å‡ºã€‚</p><pre class="nf ng nh ni gt nj lu nk nl aw nm bi"><span id="6bf7" class="nn md it lu b gy no np l nq nr">emscripten sdl2-config called with /emsdk_portable/emscripten/tag-1.39.18/system/bin/sdl2-config --cflags                            <br/>emscripten sdl2-config called with /emsdk_portable/emscripten/tag-1.39.18/system/bin/sdl2-config --libs                                     <br/>install prefix            /usr/local                                                                                                   <br/>source path               .                                                                                                         <br/>C compiler                emcc         # emcc as expected                                                                                    <br/>C library                                                                                                                          <br/>ARCH                      x86 (generic)                                                                                                     <br/>big-endian                no                                                                                                              <br/>runtime cpu detection     yes                                                                                                             <br/>standalone assembly       no</span></pre><p id="3360" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">åœ¨<code class="fe lr ls lt lu b">build.sh</code>çš„æœ«å°¾æ·»åŠ <code class="fe lr ls lt lu b">emmake make -j4</code>(æ‚¨å¯ä»¥å°†å¹¶è¡Œåº¦æé«˜åˆ°ç±»ä¼¼<code class="fe lr ls lt lu b">-j8</code>æˆ–ç®€å•åœ°ä½¿ç”¨<code class="fe lr ls lt lu b">-j</code>æ¥ä½¿ç”¨æ‰€æœ‰å†…æ ¸):</p><figure class="nf ng nh ni gt ju"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="2935" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">å¹¶ä¸”åœ¨æ‰§è¡Œåä¼šç«‹å³å¤±è´¥:</p><pre class="nf ng nh ni gt nj lu nk nl aw nm bi"><span id="14be" class="nn md it lu b gy no np l nq nr">...<br/>./libavutil/x86/timer.h:39:24: error: invalid output constraint '=a' in asm<br/>                     : "=a" (a), "=d" (d));<br/>                       ^</span></pre><p id="1c8b" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">ä»è¾“å‡ºæ¶ˆæ¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šè¯¥é”™è¯¯ä¸asmæœ‰å…³ã€‚æ‰“å¼€<code class="fe lr ls lt lu b">./libavutil/x86/timer.h</code>ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤é—®é¢˜æ˜¯ç”±x86å†…è”æ±‡ç¼–å¼•èµ·çš„ï¼Œå®ƒä¸WebAssemblyä¸å…¼å®¹ï¼Œå› æ­¤è§£å†³æ–¹æ¡ˆæ˜¯åœ¨<code class="fe lr ls lt lu b">build.sh</code>ä¸­ç¦ç”¨å®ƒ:</p><figure class="nf ng nh ni gt ju"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="6bf8" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">å®ƒå·¥ä½œå¹¶ç»§ç»­ç¼–è¯‘ï¼Œç›´åˆ°æˆ‘ä»¬é‡åˆ°å¦ä¸€ä¸ªé”™è¯¯:</p><pre class="nf ng nh ni gt nj lu nk nl aw nm bi"><span id="0292" class="nn md it lu b gy no np l nq nr">...<br/>CC libavfilter/dnn/dnn_backend_native_layers.o<br/>In file included from libavfilter/aeval.c:26:<br/>In file included from ./libavutil/avassert.h:31:<br/>In file included from ./libavutil/avutil.h:296:<br/>In file included from ./libavutil/common.h:533:<br/>In file included from ./libavutil/internal.h:176:<br/>./libavutil/libm.h:54:32: error: static declaration of 'cbrt' follows non-static declaration<br/>static av_always_inline double cbrt(double x)<br/>                               ^<br/>/emsdk_portable/upstream/emscripten/system/include/libc/math.h:151:13: note: previous declaration is here<br/>double      cbrt(double);<br/>            ^<br/>In file included from libavfilter/aeval.c:26:</span></pre><p id="6ad7" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">è¿™ä¸€æ¬¡æ ¹æœ¬åŸå› ä¸æ˜¯é‚£ä¹ˆæ˜æ˜¾ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ›´æ·±å…¥åœ°æŒ–æ˜åœ¨<code class="fe lr ls lt lu b">./configure</code>æœŸé—´å‡ºäº†ä»€ä¹ˆé—®é¢˜ã€‚ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ£€æŸ¥æ–‡ä»¶æ˜¯<code class="fe lr ls lt lu b">ffbuild/config.log</code>ï¼Œå®ƒåŒ…å«äº†<code class="fe lr ls lt lu b">./configure</code>æœŸé—´çš„æ—¥å¿—ï¼Œå¤§å¤šæ•°æ—¶å€™ä½ å¯ä»¥åœ¨é‚£é‡Œæ‰¾åˆ°æ ¹æœ¬åŸå› ã€‚</p><p id="e48f" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">é€šè¿‡åœ¨<code class="fe lr ls lt lu b">config.log</code>ä¸­æœç´¢<code class="fe lr ls lt lu b">cbrt</code>ï¼Œæˆ‘ä»¬å‘ç°é”™è¯¯ä¿¡æ¯å¦‚ä¸‹:</p><pre class="nf ng nh ni gt nj lu nk nl aw nm bi"><span id="4b97" class="nn md it lu b gy no np l nq nr">...<br/>check_mathfunc cbrt 1                                                                                                                             test_ld cc                                                                                                                                        test_cc                                                                                                                                           BEGIN /tmp/ffconf.syfN4Irw/test.c                                                                                                                     1 #include &lt;math.h&gt;                                                                                                                               2 float foo(float f, float g) { return cbrt(f); }                                                                                             <br/>    3 int main(void){ return (int) foo; }                                                                                                         <br/>END /tmp/ffconf.syfN4Irw/test.c                                                                                                                   <br/>emcc -D_ISOC99_SOURCE -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -D_POSIX_C_SOURCE=200112 -D_XOPEN_SOURCE=600 -std=c11 -fomit-frame-pointer -pthread -c -o /tmp/ffconf.syfN4Irw/test.o /tmp/ffconf.syfN4Irw/test.c                                                                                  emcc -Wl,-z,noexecstack -o /tmp/ffconf.syfN4Irw/test /tmp/ffconf.syfN4Irw/test.o                                                                  wasm-ld: error: 'atomics' feature is used by /tmp/ffconf.syfN4Irw/test.o, so --shared-memory must be used<br/>...                                         </span></pre><p id="ad83" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">è¯¥æµ‹è¯•è¯•å›¾æ£€æŸ¥cbrtæ˜¯å¦åœ¨ç¯å¢ƒä¸­å·¥ä½œï¼Œä½†æ˜¯ç”±äº<code class="fe lr ls lt lu b">atomics</code>ç‰¹æ€§å‡ºé”™è€Œå¤±è´¥ã€‚ä½¿ç”¨<code class="fe lr ls lt lu b">pthread</code>æ—¶ä¼šè¯¢é—®<code class="fe lr ls lt lu b">atomics</code>ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬æ·»åŠ <code class="fe lr ls lt lu b">pthread</code>æ ‡å¿—ã€‚(æŸ¥çœ‹<a class="ae lc" href="https://emscripten.org/docs/porting/pthreads.html" rel="noopener ugc nofollow" target="_blank">æ­¤å¤„</a>äº†è§£æ›´å¤šå…³äºpthreadæ ‡å¿—çš„è¯¦ç»†ä¿¡æ¯)</p><p id="dde1" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">æ›´æ–°<code class="fe lr ls lt lu b">build.sh</code>:</p><figure class="nf ng nh ni gt ju"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="9559" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">å®ƒå·¥ä½œå¹¶ç»§ç»­ç¼–è¯‘ï¼Œç›´åˆ°æˆ‘ä»¬é‡åˆ°å¦ä¸€ä¸ªé”™è¯¯:</p><pre class="nf ng nh ni gt nj lu nk nl aw nm bi"><span id="29a5" class="nn md it lu b gy no np l nq nr">...<br/>LD      ffplay_g                                                                                                                                  emcc: warning: ignoring unsupported linker flag: `-rpath-link=:libpostproc:libswresample:libswscale:libavfilter:libavdevice:libavformat:libavcodec:libavutil:libavresample` [-Wlinkflags]                                                                                                           <br/>7 warnings generated.                                                      <br/>wasm-ld: error: initial memory too small, 19491744 bytes needed<br/>...                    <br/>make: *** [Makefile:114: ffplay_g] Error 1<br/>make: *** Waiting for unfinished jobs....<br/>emcc: warning: ignoring unsupported linker flag: `-rpath-link=:libpostproc:libswresample:libswscale:libavfilter:libavdevice:libavformat:libavcodec<br/>:libavutil:libavresample` [-Wlinkflags]<br/>...</span></pre><p id="9764" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">è¿™æ¬¡çš„é—®é¢˜æ˜¯ç”±äºåˆå§‹å†…å­˜å¤ªå°(åœ¨Emscriptenä¸­é»˜è®¤åªæœ‰16 MBï¼Œè¿™é‡Œæœ€å°çš„æ˜¯19+ MB)ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡ä¼ é€’<code class="fe lr ls lt lu b">-s INITIAL_MEMORY=33554432</code> (32 MB)å°†åˆå§‹å†…å­˜æé«˜åˆ°ä¸€ä¸ªæ›´é«˜çš„å€¼ã€‚</p><figure class="nf ng nh ni gt ju"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="e4a4" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">ä¿®å¤åä»æœ‰ä¸€ä¸ªé”™è¯¯:</p><pre class="nf ng nh ni gt nj lu nk nl aw nm bi"><span id="77ed" class="nn md it lu b gy no np l nq nr">LD      ffplay_g<br/>emcc: warning: ignoring unsupported linker flag: `-rpath-link=:libpostproc:libswresample:libswscale:libavfilter:libavdevice:libavformat:libavcodec:libavutil:libavresample` [-Wlinkflags]<br/>6 warnings generated.<br/>LD      ffmpeg_g<br/>emcc: warning: ignoring unsupported linker flag: `-rpath-link=:libpostproc:libswresample:libswscale:libavfilter:libavdevice:libavformat:libavcodec:libavutil:libavresample` [-Wlinkflags]<br/>9 warnings generated.<br/>LD      ffprobe_g<br/>emcc: warning: ignoring unsupported linker flag: `-rpath-link=:libpostproc:libswresample:libswscale:libavfilter:libavdevice:libavformat:libavcodec:libavutil:libavresample` [-Wlinkflags]<br/>STRIP   ffmpeg<br/>strip:ffmpeg_g: file format not recognized<br/>make: *** [Makefile:107: ffmpeg] Error 1<br/>make: *** Waiting for unfinished jobs....</span></pre><p id="5a94" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">ç”±äºæˆ‘ä»¬æ— æ³•å‰¥ç¦»(å› ä¸ºå®ƒä¸æ˜¯æœ‰æ•ˆçš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œæ‰€ä»¥æœ‰æ„ä¹‰)ï¼Œè®©æˆ‘ä»¬ç®€å•åœ°ç”¨<code class="fe lr ls lt lu b">--disable-stripping</code>ç¦ç”¨å‰¥ç¦»ï¼Œå¹¶å†æ¬¡ç”Ÿæˆ:</p><figure class="nf ng nh ni gt ju"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="22d8" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">æœ€åï¼Œæˆ‘ä»¬æˆåŠŸåœ°å®Œæˆäº†<code class="fe lr ls lt lu b">emmake make -j</code>éƒ¨åˆ†ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°æ ¹æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆçš„ffplay / ffplay_gã€ffprobe / ffprobe_gå’Œffmpeg / ffmpeg_gã€‚å®ƒçœ‹èµ·æ¥å¾ˆå®Œç¾ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªæ€ªå¼‚çš„<code class="fe lr ls lt lu b">_g</code>åç¼€ä½¿å¾—è¾“å‡ºæ–‡ä»¶æ˜¯è¿™æ ·çš„:</p><ul class=""><li id="d861" class="ld le it kd b ke kf ki kj kz lf la lg lb lh ky oa lj lk ll bi translated">ffmpeg</li><li id="af47" class="ld le it kd b ke lm ki ln kz lo la lp lb lq ky oa lj lk ll bi translated">ffmpeg_g</li><li id="e4ba" class="ld le it kd b ke lm ki ln kz lo la lp lb lq ky oa lj lk ll bi translated">ffmpeg_g.wasm</li><li id="b6c3" class="ld le it kd b ke lm ki ln kz lo la lp lb lq ky oa lj lk ll bi translated">ffmpeg_g.worker.js</li></ul><p id="5488" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">è¿™é‡Œçš„ffmpegå’Œffmpeg_gå®é™…ä¸Šéƒ½æ˜¯jsæ–‡ä»¶ï¼Œç†æƒ³çš„å‘½åå¦‚ä¸‹:</p><ul class=""><li id="d8cd" class="ld le it kd b ke kf ki kj kz lf la lg lb lh ky oa lj lk ll bi translated">ffmpeg / ffmpeg_g =&gt; ffmpeg.js</li><li id="7a23" class="ld le it kd b ke lm ki ln kz lo la lp lb lq ky oa lj lk ll bi translated">ffmpeg_g.wasm =&gt; ffmpeg.wasm</li><li id="9f5d" class="ld le it kd b ke lm ki ln kz lo la lp lb lq ky oa lj lk ll bi translated">ffmpeg _ g . worker . js = &gt; ffmpeg . worker . js</li></ul><p id="186e" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±æ„å»ºå®ƒã€‚æ„å»ºffmpegçš„å‘½ä»¤å¯ä»¥é€šè¿‡è¿è¡Œ<code class="fe lr ls lt lu b">emmake make -n</code>æ¥æå–:</p><pre class="nf ng nh ni gt nj lu nk nl aw nm bi"><span id="cbfe" class="nn md it lu b gy no np l nq nr">...<br/>printf "LD\t%s\n" ffmpeg_g; emcc -Llibavcodec -Llibavdevice -Llibavfilter -Llibavformat -Llibavresample -Llibavutil -Llibpostproc -Llibswscale -Llibswresample -Wl,--as-needed -Wl,-z,noexecstack -Wl,--warn-common -Wl,-rpath-link=libpostproc:libswresample:libswscale:libavfilter:libavdevice:libavformat:libavcodec:libavutil:libavresample -Qunused-arguments   -o ffmpeg_g fftools/ffmpeg_opt.o fftools/ffmpeg_filter.o fftools/ffmpeg_hw.o fftools/cmdutils.o fftools/ffmpeg.o  -lavdevice -lavfilter -lavformat -lavcodec -lswresample -lswscale -lavutil  -lm -pthread -lm -lm -pthread -lm -lm -lm -pthread -lm<br/>printf "CP\t%s\n" ffmpeg; cp -p ffmpeg_g ffmpeg<br/>...</span></pre><p id="9e7e" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">ç¨å¾®æ¸…ç†ä¸€ä¸‹:</p><pre class="nf ng nh ni gt nj lu nk nl aw nm bi"><span id="5d54" class="nn md it lu b gy no np l nq nr">emcc \<br/>  -I. -I./fftools \<br/>  -Llibavcodec -Llibavdevice -Llibavfilter -Llibavformat -Llibavresample -Llibavutil -Llibpostproc -Llibswscale -Llibswresample \<br/>  -Qunused-arguments \<br/>  -o ffmpeg_g fftools/ffmpeg_opt.o fftools/ffmpeg_filter.o fftools/ffmpeg_hw.o fftools/cmdutils.o fftools/ffmpeg.o \<br/>  -lavdevice -lavfilter -lavformat -lavcodec -lswresample -lswscale -lavutil -lm</span></pre><p id="b96a" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">å› ä¸ºæˆ‘ä»¬æ­£åœ¨æ„å»ºæˆ‘ä»¬è‡ªå·±çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬åœ¨<code class="fe lr ls lt lu b">./configure</code>æ­¥éª¤ä¸­æ·»åŠ <code class="fe lr ls lt lu b">--disable-programs</code>å’Œ<code class="fe lr ls lt lu b">--disable-doc</code>æ¥åŠ é€Ÿæ„å»ºï¼Œå¹¶ä¸”åœ¨æ„å»ºffmpegæ—¶æ·»åŠ ä¸€äº›å¿…è¦çš„æ ‡å¿—</p><figure class="nf ng nh ni gt ju"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="93ab" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<a class="ae lc" href="https://github.com/ffmpegwasm/FFmpeg/blob/n4.3.1-p2/wasm/basic.html" rel="noopener ugc nofollow" target="_blank">basic.html</a>æ¥æµ‹è¯•ffmpeg.wasmæ˜¯å¦å·¥ä½œ:</p><figure class="nf ng nh ni gt ju"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="8be7" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">è¿è¡Œè½»é‡çº§webæœåŠ¡å™¨(ä¾‹å¦‚<code class="fe lr ls lt lu b">python3 -m http.server 3000</code>)å¹¶è®¿é—®ç½‘é¡µ(ä¾‹å¦‚<code class="fe lr ls lt lu b"><a class="ae lc" href="http://localhost:8000/test.html)" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/basic.html</a></code> <a class="ae lc" href="http://localhost:8000/test.html)" rel="noopener ugc nofollow" target="_blank"> ) </a>å¹¶æ‰“å¼€Chrome DevToolsã€‚</p><figure class="nf ng nh ni gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><div class="gh gi ob"><img src="../Images/3cb0946317e0325fa3d83367be938f8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N1KJtAcdlhYBzJ2XSv3XGA.png"/></div></div></figure><p id="61c2" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">ä½ å¯ä»¥çœ‹åˆ°å®ƒçš„è¾“å‡ºç±»ä¼¼äºåŸå§‹çš„FFmpegï¼Œè¿™ç»™äº†æˆ‘ä»¬ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹æ¥å®Œå–„æˆ‘ä»¬çš„ffmpeg.wasmåº“ã€‚</p><p id="a396" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">ä½ å¯ä»¥è®¿é—®è¿™é‡Œçš„çŸ¥è¯†åº“ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•è¯¦ç»†å·¥ä½œçš„:<a class="ae lc" href="https://github.com/ffmpegwasm/FFmpeg/tree/n4.3.1-p2" rel="noopener ugc nofollow" target="_blank">https://github.com/ffmpegwasm/FFmpeg/tree/n4.3.1-p2</a></p><p id="f4e2" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">å¹¶ä¸”å¯ä»¥åœ¨è¿™é‡Œéšæ„ä¸‹è½½å»ºé€ ç¥å™¨:ã€https://github.com/ffmpegwasm/FFmpeg/releases/tag/n4.3.1-p2 T2ã€‘</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="fd9c" class="pw-post-body-paragraph ka kb it kd b ke kf kg kh ki kj kk kl kz kn ko kp la kr ks kt lb kv kw kx ky im bi translated">å¦‚ä½•æ‰“ç£¨å’Œåˆ›å»ºä¸€ä¸ªâ€œçœŸæ­£çš„â€ffmpeg.wasmåº“ï¼Œè¯·çœ‹æœ¬ç³»åˆ—æ•…äº‹çš„<a class="ae lc" href="https://medium.com/@jeromewus/build-ffmpeg-webassembly-version-ffmpeg-js-part-3-ffmpeg-js-v0-1-0-transcoding-avi-to-mp4-f729e503a397" rel="noopener">æ„å»ºFFmpeg WebAssemblyç‰ˆæœ¬(= FFmpeg . wasm):part . 3 FFmpeg . wasm v 0.1â€”å°†aviè½¬ç ä¸ºmp4 </a>ã€‚ğŸ˜ƒ</p></div></div>    
</body>
</html>