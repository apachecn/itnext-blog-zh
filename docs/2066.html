<html>
<head>
<title>Grafana Logging using Loki</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨Lokiçš„Grafanaæµ‹äº•</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/grafana-logging-using-loki-45665916aec9?source=collection_archive---------0-----------------------#2019-03-26">https://itnext.io/grafana-logging-using-loki-45665916aec9?source=collection_archive---------0-----------------------#2019-03-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="73f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://grafana.com/loki" rel="noopener ugc nofollow" target="_blank"> Loki </a>æ˜¯ä¸€ä¸ªå—æ™®ç½—ç±³ä¿®æ–¯å¯å‘çš„é’ˆå¯¹äº‘æœ¬åœ°åŸºç¡€è®¾æ–½çš„æ—¥å¿—æœåŠ¡ã€‚</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/a0347f52840c85de65bf10eb3969c92b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aHUnR6i2SKj3lHaGZWAWCA.jpeg"/></div></div></figure><h1 id="283c" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">æ´›åŸºæ˜¯ä»€ä¹ˆï¼Ÿ</h1><p id="c0e7" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">åœ¨KubeCon Seattle 2018æœŸé—´ï¼ŒGrafana Labså¼€æºäº†Lokiï¼Œå®ƒæ˜¯ä¸€ä¸ªé’ˆå¯¹è¿è¡ŒPrometheuså’ŒKubernetesçš„ç”¨æˆ·ä¼˜åŒ–çš„æ—¥å¿—åç«¯ï¼Œåœ¨Grafana 6.0ä¸­å…·æœ‰å‡ºè‰²çš„æ—¥å¿—æœç´¢å’Œå¯è§†åŒ–åŠŸèƒ½ã€‚</p><p id="12c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Lokiçš„è®¾è®¡æ—¨åœ¨æé«˜æ•ˆç‡ï¼ŒåŒæ—¶å®ç°ä»¥ä¸‹ç›®æ ‡:</p><ul class=""><li id="30ee" class="mb mc iq jp b jq jr ju jv jy md kc me kg mf kk mg mh mi mj bi translated">åŸæœ¨åº”è¯¥å¾ˆä¾¿å®œã€‚ä¸åº”è¯¥è¦æ±‚ä»»ä½•äººå‡å°‘è®°å½•ã€‚</li><li id="e2aa" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated">æ˜“äºæ“ä½œå’Œæ‰©å±•ã€‚</li><li id="dce8" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated">åº¦é‡ã€æ—¥å¿—(ä»¥åŠåé¢çš„è·Ÿè¸ª)éœ€è¦ååŒå·¥ä½œã€‚</li></ul><h1 id="7b57" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">Lokiä¸å…¶ä»–æ—¥å¿—è®°å½•è§£å†³æ–¹æ¡ˆ</h1><p id="c342" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">å¦‚å‰æ‰€è¿°ï¼ŒLokiæ—¨åœ¨æé«˜æ•ˆç‡ï¼Œä»¥ä¾¿åœ¨Kubernetesç¯å¢ƒä¸­ä¸Prometheus metricsç»“åˆä½¿ç”¨ã€‚</p><p id="7be0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¿™ä¸ªæƒ³æ³•æ˜¯åŸºäºæ‚¨å·²ç»åœ¨Prometheusä¸Šä½¿ç”¨çš„Kubernetesæ ‡ç­¾ï¼Œåœ¨æŒ‡æ ‡å’Œæ—¥å¿—ä¹‹é—´è½»æ¾åˆ‡æ¢ã€‚</p><p id="4b57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä¸å¤§å¤šæ•°æ—¥å¿—è®°å½•è§£å†³æ–¹æ¡ˆä¸åŒï¼ŒLokiä¸è§£æä¼ å…¥çš„æ—¥å¿—ï¼Œä¹Ÿä¸è¿›è¡Œå…¨æ–‡ç´¢å¼•ã€‚</p><p id="c444" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç›¸åï¼Œå®ƒä½¿ç”¨ä¸Prometheusç›¸åŒçš„æ ‡ç­¾å¯¹æ—¥å¿—æµè¿›è¡Œç´¢å¼•å’Œåˆ†ç»„ã€‚è¿™å¤§å¤§æé«˜äº†æ‰©å±•å’Œè¿è¥çš„æ•ˆç‡ã€‚</p><h1 id="1712" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">æ´›åŸºç»„ä»¶</h1><p id="5429" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">Lokiæ˜¯ä¸€ä¸ªTSDB(æ—¶é—´åºåˆ—æ•°æ®åº“)ï¼Œå®ƒå°†æ—¥å¿—å­˜å‚¨ä¸ºåˆ†å‰²å’Œå‹ç¼©çš„æ•°æ®å—ã€‚</p><p id="8a5d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ—¥å¿—æ˜¯é€šè¿‡APIè·å–çš„ï¼Œä¸€ä¸ªåä¸ºPromtail(Prometheusæ ¼å¼çš„è·Ÿè¸ªæ—¥å¿—)çš„ä»£ç†å°†æŠ“å–Kubernetesæ—¥å¿—å¹¶æ·»åŠ æ ‡ç­¾å…ƒæ•°æ®ï¼Œç„¶åå°†å…¶å‘é€åˆ°Lokiã€‚</p><p id="aa62" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¿™ç§å…ƒæ•°æ®æ·»åŠ ä¸Prometheuså®Œå…¨ç›¸åŒï¼Œå› æ­¤æ‚¨æœ€ç»ˆå°†è·å¾—ä¸æ‚¨çš„èµ„æºå®Œå…¨ç›¸åŒçš„æ ‡ç­¾ã€‚</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mp"><img src="../Images/bc4c27ce2675ebf2b468716c0f216dd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gTD64wp0vn2AZ5SazChi_w.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated"><a class="ae kl" href="https://grafana.com/blog/2018/12/12/loki-prometheus-inspired-open-source-logging-for-cloud-natives/" rel="noopener ugc nofollow" target="_blank">https://grafana . com/blog/2018/12/12/Loki-Prometheus-inspired-open-source-logging-for-cloud-natives/</a></figcaption></figure><h1 id="79b5" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">å¦‚ä½•åœ¨æ‚¨çš„Kubernetesé›†ç¾¤ä¸Šéƒ¨ç½²Loki</h1><ol class=""><li id="acf8" class="mb mc iq jp b jq lw ju lx jy mu kc mv kg mw kk mx mh mi mj bi translated"><strong class="jp ir">åœ¨æ‚¨çš„é›†ç¾¤ä¸Šéƒ¨ç½²Loki</strong></li></ol><p id="8978" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">åœ¨Kubernetesé›†ç¾¤ä¸Šéƒ¨ç½²Lokiæœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨å®˜æ–¹å­˜å‚¨åº“ä¸­çš„<a class="ae kl" href="https://github.com/grafana/loki/tree/master/production/helm" rel="noopener ugc nofollow" target="_blank"> Helm chart </a>ã€‚</p><p id="1208" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¯ä»¥æŒ‰ç…§å®˜æ–¹å›è´­çš„<a class="ae kl" href="https://github.com/grafana/loki/blob/master/production/helm/README.md" rel="noopener ugc nofollow" target="_blank">è®¾ç½®æŒ‡å—</a>æ“ä½œã€‚</p><p id="ed4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¿™å°†éƒ¨ç½²æ´›åŸºå’ŒPromtailã€‚</p><h1 id="a645" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated"><strong class="ak">åœ¨Grafana </strong>ä¸­æ·»åŠ Lokiæ•°æ®æº(6.0åŠæ›´æ–°ç‰ˆæœ¬ä¸­å†…ç½®äº†å¯¹Lokiçš„æ”¯æŒ)</h1><ol class=""><li id="428c" class="mb mc iq jp b jq lw ju lx jy mu kc mv kg mw kk mx mh mi mj bi translated">ç™»å½•æ‚¨çš„Grafanaã€‚</li><li id="6d8d" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mx mh mi mj bi translated">é€šè¿‡å·¦ä¾§å·¥å…·æ¡ä¸­çš„é½¿è½®å›¾æ ‡è¿›å…¥<code class="fe my mz na nb b">Configuration</code> &gt; <code class="fe my mz na nb b">Data Sources</code>ã€‚</li><li id="ea49" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mx mh mi mj bi translated">ç‚¹å‡»å¤§<code class="fe my mz na nb b">+ Add data source</code>æŒ‰é’®ã€‚</li><li id="82d0" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mx mh mi mj bi translated">ä»åˆ—è¡¨ä¸­é€‰æ‹©æ´›åŸºã€‚</li><li id="5c59" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mx mh mi mj bi translated">http URLå­—æ®µåº”è¯¥æ˜¯æ‚¨çš„LokiæœåŠ¡å™¨çš„åœ°å€:<code class="fe my mz na nb b"><a class="ae kl" href="http://loki:3100" rel="noopener ugc nofollow" target="_blank">http://loki:3100</a></code></li></ol><h1 id="4e43" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated"><strong class="ak">åœ¨â€œæµè§ˆâ€è§†å›¾ä¸­æŸ¥çœ‹æ‚¨çš„æ—¥å¿—</strong></h1><ol class=""><li id="67ed" class="mb mc iq jp b jq lw ju lx jy mu kc mv kg mw kk mx mh mi mj bi translated">é€‰æ‹©è¾¹æ ä¸Šçš„â€œæ¢ç´¢â€è§†å›¾ã€‚</li><li id="4e09" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mx mh mi mj bi translated">é€‰æ‹©Lokiæ•°æ®æºã€‚</li><li id="580f" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mx mh mi mj bi translated">ä½¿ç”¨â€œæ—¥å¿—æ ‡ç­¾â€æŒ‰é’®é€‰æ‹©æ—¥å¿—æµã€‚</li></ol><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nc"><img src="../Images/88c7741cd71d00e1cfb2b374ebb068ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h2BWAUK2tC6WxsunRN8z7w.png"/></div></div></figure><h1 id="a035" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">å¿«é€Ÿé…ç½®</h1><p id="8676" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated"><em class="nd"> Promtailæ˜¯å…ƒæ•°æ®é™„åŠ å™¨å’Œæ—¥å¿—å‘é€ä»£ç†</em></p><p id="5014" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ‚¨ä»Helm chartè·å¾—çš„Promtailé…ç½®å·²ç»é…ç½®ä¸ºä»æ‚¨çš„Kubernetesé›†ç¾¤è·å¾—æ‰€æœ‰æ—¥å¿—ï¼Œå¹¶åƒPrometheusä¸ºmetricsæ‰€åšçš„é‚£æ ·åœ¨å…¶ä¸Šé™„åŠ æ ‡ç­¾ã€‚</p><p id="bbf0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´é…ç½®ã€‚</p><p id="d3fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¿™é‡Œæœ‰ä¸¤ä¸ªä¾‹å­:</p><ol class=""><li id="3925" class="mb mc iq jp b jq jr ju jv jy md kc me kg mf kk mx mh mi mj bi translated"><strong class="jp ir">ä»…è·å–ç‰¹å®šåç§°ç©ºé—´çš„æ—¥å¿—</strong></li></ol><p id="6c07" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ‚¨å¯ä»¥ä½¿ç”¨<code class="fe my mz na nb b">action: keep</code>ä½œä¸ºæ‚¨çš„åç§°ç©ºé—´ï¼Œå¹¶ä¸º<a class="ae kl" href="https://github.com/grafana/loki/blob/master/production/helm/templates/promtail/configmap.yaml" rel="noopener ugc nofollow" target="_blank">prom tail/config map . YAML</a>ä¸­çš„æ¯ä¸ª<code class="fe my mz na nb b">scrape_config</code>æ·»åŠ ä¸€ä¸ªæ–°çš„<code class="fe my mz na nb b">relabel_configs</code></p><p id="c044" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åªæƒ³è·å–<code class="fe my mz na nb b">kube-system</code>åç§°ç©ºé—´çš„æ—¥å¿—:</p><pre class="kn ko kp kq gt ne nb nf ng aw nh bi"><span id="3319" class="ni kz iq nb b gy nj nk l nl nm">scrape_configs:<br/>- job_name: kubernetes-pods         <br/>  kubernetes_sd_configs:         <br/>  - role: pod         <br/>  relabel_configs:         <br/>  - source_labels: [__meta_kubernetes_namespace]           <br/>    action: keep           <br/>    regex: kube-system</span><span id="b11c" class="ni kz iq nb b gy nn nk l nl nm"># [...]<br/>         <br/>- job_name: kubernetes-pods-app         <br/>  kubernetes_sd_configs:         <br/>  - role: pod         <br/>  relabel_configs:         <br/>  - source_labels: [__meta_kubernetes_namespace]           <br/>    action: keep           <br/>    regex: kube-system</span></pre><ol class=""><li id="f677" class="mb mc iq jp b jq jr ju jv jy md kc me kg mf kk mx mh mi mj bi translated"><strong class="jp ir">ä»ç‰¹å®šåç§°ç©ºé—´ä¸­æ’é™¤æ—¥å¿—</strong></li></ol><p id="2948" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³ä»<code class="fe my mz na nb b">kube-system</code>åç§°ç©ºé—´ä¸­æ’é™¤æ—¥å¿—:</p><p id="a121" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ‚¨å¯ä»¥ä½¿ç”¨<code class="fe my mz na nb b">action: drop</code>ä½œä¸ºæ‚¨çš„åç§°ç©ºé—´ï¼Œå¹¶ä¸º<a class="ae kl" href="https://github.com/grafana/loki/blob/master/production/helm/templates/promtail/configmap.yaml" rel="noopener ugc nofollow" target="_blank">prom tail/config map . YAML</a>ä¸­çš„æ¯ä¸ª<code class="fe my mz na nb b">scrape_config</code>æ·»åŠ ä¸€ä¸ªæ–°çš„<code class="fe my mz na nb b">relabel_configs</code></p><pre class="kn ko kp kq gt ne nb nf ng aw nh bi"><span id="98d4" class="ni kz iq nb b gy nj nk l nl nm">scrape_configs:<br/>- job_name: kubernetes-pods         <br/>  kubernetes_sd_configs:         <br/>  - role: pod         <br/>  relabel_configs:         <br/>  - source_labels: [__meta_kubernetes_namespace]           <br/>    action: drop           <br/>    regex: kube-system</span><span id="706f" class="ni kz iq nb b gy nn nk l nl nm"># [...]<br/>       <br/>- job_name: kubernetes-pods-app         <br/>  kubernetes_sd_configs:         <br/>  - role: pod         <br/>  relabel_configs:         <br/>  - source_labels: [__meta_kubernetes_namespace]           <br/>    action: drop           <br/>    regex: kube-system</span></pre><p id="c9ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å…³äºé…ç½®çš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒã€Prometheuså®˜æ–¹é…ç½®æ–‡æ¡£ã€‚</p><h1 id="d348" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">ä½¿ç”¨fluentdè¾“å‡ºæ’ä»¶</h1><p id="c4eb" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">Fluentdæ˜¯ä¸€ä¸ªè‘—åçš„å¥½çš„æ—¥å¿—è½¬å‘å™¨ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª[CNCFé¡¹ç›®](https://www . cncf . io/projects/)ã€‚å®ƒæœ‰å¾ˆå¤šè¾“å…¥æ’ä»¶å’Œè‰¯å¥½çš„è¿‡æ»¤å†…ç½®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³è¦å°†æ—¥å¿—è½¬å‘åˆ°Lokiï¼Œåˆ™æ— æ³•é€šè¿‡Promtailå®ç°ï¼Œå› æ­¤æ‚¨å¯ä»¥ä½¿ç”¨fluentd syslogè¾“å…¥æ’ä»¶å’Œfluentd Lokiè¾“å‡ºæ’ä»¶å°†è¿™äº›æ—¥å¿—æ”¾å…¥Lokiã€‚</p><p id="2f52" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å…³äºå¦‚ä½•ä½¿ç”¨fluentd Lokiæ’ä»¶ï¼Œæ‚¨å¯ä»¥å‚è€ƒ<a class="ae kl" href="https://github.com/grafana/loki/tree/master/fluentd/fluent-plugin-loki" rel="noopener ugc nofollow" target="_blank">å®‰è£…æŒ‡å—</a>ã€‚</p><p id="9873" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¿˜æœ‰ä¸€ä¸ªä¾‹å­ï¼Œå¦‚ä½•ç”¨fluentdå°†APIæœåŠ¡å™¨å®¡è®¡æ—¥å¿—è½¬å‘ç»™Lokiã€‚</p><p id="4680" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä»¥ä¸‹æ˜¯fluentdé…ç½®:</p><pre class="kn ko kp kq gt ne nb nf ng aw nh bi"><span id="0567" class="ni kz iq nb b gy nj nk l nl nm">&lt;match fluent.**&gt;<br/>  type null         <br/>&lt;/match&gt;<br/>&lt;source&gt;      <br/>  @type tail     <br/>  path /var/log/apiserver/audit.log     <br/>  pos_file /var/log/fluentd-audit.log.pos     <br/>  time_format %Y-%m-%dT%H:%M:%S.%NZ     <br/>  tag audit.*     <br/>  format json     <br/>  read_from_head true<br/>&lt;/source&gt;   <br/>&lt;filter kubernetes.**&gt;<br/>  type kubernetes_metadata<br/>&lt;/filter&gt;   <br/>&lt;match audit.**&gt;<br/>@type loki     <br/>url "#{ENV['LOKI_URL']}"     <br/>username "#{ENV['LOKI_USERNAME']}"     <br/>password "#{ENV['LOKI_PASSWORD']}"     <br/>extra_labels {"env":"dev"}     <br/>flush_interval 10s     <br/>flush_at_shutdown true     <br/>buffer_chunk_limit 1m<br/>&lt;/match&gt;</span></pre><h1 id="2335" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">ä½œä¸ºè¾¹è½¦çš„Promtail</h1><p id="5153" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">é»˜è®¤æƒ…å†µä¸‹ï¼ŒPromtailè¢«é…ç½®ä¸ºè‡ªåŠ¨ä»å®¹å™¨ä¸­æŠ“å–æ—¥å¿—å¹¶å°†å…¶å‘é€åˆ°Lokiã€‚è¿™äº›æ—¥å¿—æ¥è‡ªstdoutã€‚</p><p id="fcde" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä½†æœ‰æ—¶ï¼Œæ‚¨å¯èƒ½å¸Œæœ›èƒ½å¤Ÿå°†æ—¥å¿—ä»å¤–éƒ¨æ–‡ä»¶å‘é€åˆ°Lokiã€‚</p><p id="695d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥å°†Promtailè®¾ç½®ä¸ºsidecarï¼Œå³podä¸­çš„ç¬¬äºŒä¸ªå®¹å™¨ï¼Œé€šè¿‡å…±äº«å·ä¸å®ƒå…±äº«æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶æŠ“å–æ•°æ®ä»¥å°†å…¶å‘é€åˆ°Loki</p><p id="1264" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å‡è®¾æ‚¨æœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åº<code class="fe my mz na nb b">simple-logger</code>ã€‚åº”ç”¨ç¨‹åºç™»å½•åˆ°<code class="fe my mz na nb b">/home/slog/creator.log</code></p><p id="b190" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ‚¨çš„kuberneteséƒ¨ç½²å°†å¦‚ä¸‹æ‰€ç¤º:</p><ol class=""><li id="da26" class="mb mc iq jp b jq jr ju jv jy md kc me kg mf kk mx mh mi mj bi translated"><strong class="jp ir">æ·»åŠ Promtailä½œä¸ºè¾¹è½¦</strong></li></ol><pre class="kn ko kp kq gt ne nb nf ng aw nh bi"><span id="746e" class="ni kz iq nb b gy nj nk l nl nm">apiVersion: apps/v1  <br/>kind: Deployment  <br/>metadata:<br/>  name: my-app<br/>spec:<br/>  template:<br/>    metadata:<br/>      name: my-app<br/>spec:<br/>  containers:        <br/>  - name: simple-logger         <br/>    image: giantswarm/simple-logger:latest</span><span id="7121" class="ni kz iq nb b gy nn nk l nl nm">apiVersion: apps/v1<br/>kind: Deployment  <br/>metadata:<br/>  name: my-app<br/>spec:<br/>  template:<br/>    metadata:<br/>      name: my-app<br/>spec:<br/>  containers:<br/>  - name: simple-logger          <br/>  image: giantswarm/simple-logger:latest        <br/>  - name: promtail          <br/>  image: grafana/promtail:master          <br/>  args:<br/>    - "-config.file=/etc/promtail/promtail.yaml"            <br/>    - "-client.url=http://loki:3100/api/prom/push"</span></pre><p id="2558" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.<strong class="jp ir">ä½¿ç”¨åŒ…å«æ—¥å¿—æ–‡ä»¶çš„å…±äº«æ•°æ®å·</strong></p><pre class="kn ko kp kq gt ne nb nf ng aw nh bi"><span id="7a6a" class="ni kz iq nb b gy nj nk l nl nm">apiVersion: apps/v1  <br/>kind: Deployment  <br/>metadata:<br/>  name: my-app<br/>spec:<br/>  template:<br/>    metadata:<br/>      name: my-app<br/>spec:<br/>  containers:        <br/>  - name: simple-logger         <br/>    image: giantswarm/simple-logger:latest<br/>    volumeMounts:<br/>      - name: shared-data<br/>        mountPath: /home/slog<br/>  - name: promtail          <br/>    image: grafana/promtail:master          <br/>    args:<br/>      - "-config.file=/etc/promtail/promtail.yaml"            <br/>      - "-client.url=http://loki:3100/api/prom/push"<br/>volumeMounts:<br/>      - name: shared-data<br/>        mountPath: /home/slog<br/>volumes:<br/>- name: shared-data<br/>  emptyDir: {}</span></pre><p id="7912" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.<strong class="jp ir">é…ç½®Promtailæ¥è¯»å–ä½ çš„æ—¥å¿—æ–‡ä»¶</strong></p><pre class="kn ko kp kq gt ne nb nf ng aw nh bi"><span id="593f" class="ni kz iq nb b gy nj nk l nl nm">scrape_configs:<br/>  - job_name: system          <br/>    entry_parser: raw          <br/>    static_configs:<br/>      - targets:<br/>          - localhost<br/>        labels:<br/>          job: my-app               <br/>          my-label: awesome               <br/>          __path__: /home/slog/creator.log</span></pre><p id="a036" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä½ å°±å®Œäº†ã€‚</p><p id="f24b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¿è¡Œç¤ºä¾‹å¯åœ¨<a class="ae kl" href="https://github.com/giantswarm/simple-logger" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a>æ‰¾åˆ°</p><h1 id="90a6" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">ç»“è®º</h1><p id="c7a6" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">æ‰€ä»¥æ´›åŸºçœ‹èµ·æ¥å¾ˆæœ‰å¸Œæœ›ã€‚è¶³è¿¹éå¸¸ä½ã€‚å®ƒä¸æ ¼æ‹‰å¤«çº³å’Œæ™®ç½—ç±³ä¿®æ–¯å®Œç¾ç»“åˆã€‚ä½¿ç”¨ä¸Prometheusä¸­ç›¸åŒçš„æ ‡ç­¾éå¸¸æœ‰åŠ©äºå°†äº‹ä»¶æ˜ å°„åœ¨ä¸€èµ·ï¼Œå¹¶å¿«é€Ÿæ‰¾åˆ°ä¸æŒ‡æ ‡ç›¸å…³çš„æ—¥å¿—ã€‚å¦ä¸€ä¸ªè¦ç‚¹æ˜¯ç®€å•çš„å¯æ‰©å±•æ€§ï¼ŒLokiçš„è®¾è®¡æ˜¯æ°´å¹³å¯æ‰©å±•çš„ã€‚</p><p id="5c38" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç”±äºLokiç›®å‰æ˜¯é˜¿å°”æ³•è½¯ä»¶ï¼Œå®‰è£…å®ƒï¼Œç©å®ƒã€‚ç„¶åï¼ŒåŠ å…¥æˆ‘ä»¬çš„grafana.slack.comï¼Œå¹¶æ·»åŠ æ‚¨çš„åé¦ˆï¼Œä½¿å®ƒå˜å¾—æ›´å¥½ã€‚</p><p id="7c08" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æœ‰å…´è¶£äº†è§£Giant Swarmå¦‚ä½•å¤„ç†åŒ…æ‹¬Lokiåœ¨å†…çš„æ•´ä¸ªäº‘åŸç”Ÿå †æ ˆå—ï¼Ÿåœ¨è¿™é‡Œç”³è¯·å…è´¹è¯•ç”¨<a class="ae kl" href="https://giantswarm.io/" rel="noopener ugc nofollow" target="_blank">å·¨å‹èœ‚ç¾¤åŸºç¡€è®¾æ–½</a>ã€‚</p><p id="2fb4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç”±<a class="ae kl" href="https://twitter.com/jgsqware" rel="noopener ugc nofollow" target="_blank">æœ±åˆ©å®‰Â·åŠ è¥¿äºšÂ·å†ˆè¨é›·æ–¯</a>â€”â€”è§£å†³æ–¹æ¡ˆå·¥ç¨‹å¸ˆ@ <a class="ae kl" href="https://giantswarm.io/" rel="noopener ugc nofollow" target="_blank">å·¨å‹èœ‚ç¾¤</a>æ’°å†™</p><div class="no np gp gr nq nr"><a href="https://twitter.com/jgsqware" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd ir gy z fp nw fr fs nx fu fw ip bi translated">å°‘å°‰ğŸ¤˜(@jgsqware) |æ¨ç‰¹</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">æ¥è‡ªJGçš„æœ€æ–°æ¨æ–‡ğŸ¤˜(@jgsqware)ã€‚è§£å†³æ–¹æ¡ˆå·¥ç¨‹å¸ˆ@GiantSwarm</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">twitter.com</p></div></div><div class="oa l"><div class="ob l oc od oe oa of kw nr"/></div></div></a></div></div></div>    
</body>
</html>