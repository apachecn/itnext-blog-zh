# å¦‚ä½•åœ¨ Compose CLI ä¸­æ„å»º Kubernetes åç«¯ï¼Ÿ

> åŸæ–‡ï¼š<https://itnext.io/how-to-build-a-kubernetes-backend-in-compose-cli-7ec79b071700?source=collection_archive---------0----------------------->

## â€¦å¹¶ä½¿ç”¨å®ƒå°†åˆæˆåº”ç”¨ç¨‹åºç›´æ¥éƒ¨ç½²åˆ° K8s ä¸­

![](img/efadadd85c8b51d3b784fa7e49976f0d.png)

Docker Compose æ˜¯ Docker çš„ä¸€ä¸ªå¾ˆæ£’çš„å·¥å…·ï¼Œæ•°ç™¾ä¸‡äººä½¿ç”¨å®ƒæ¥éƒ¨ç½²å’Œç®¡ç†å¤šå®¹å™¨åº”ç”¨ç¨‹åºã€‚Docker æ’°å†™åŸºæœ¬ä¸Šæ˜¯ä¸¤ä»¶äº‹:

*   Compose æ–‡ä»¶æ˜¯ yaml ä¸­çš„ä¸€ä¸ªè§„èŒƒ(é»˜è®¤æƒ…å†µä¸‹åä¸º*Docker-Compose . YAML*), Docker Compose å°†å®ƒä½œä¸ºè¾“å…¥ã€‚è¿™ä¸ªæ–‡ä»¶å®šä¹‰äº†å®¹å™¨åŒ–åº”ç”¨ç¨‹åºçš„ç»„ä»¶ä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•è¿æ¥åœ¨ä¸€èµ·çš„ã€‚åº”è¯¥æ˜¯æŒ‰ç…§[ç¼–å†™è§„èŒƒ](https://compose-spec.io/)ç¼–å†™çš„ï¼Œè§„èŒƒçš„ç»†èŠ‚å¯ä»¥ä»[è¿™ä¸ªåº“](https://github.com/compose-spec/compose-spec/blob/master/spec.md)é‡Œå¾—åˆ°
*   Docker Compose æ˜¯å¤„ç†è¿™ä¸ªåˆæˆæ–‡ä»¶çš„å·¥å…·:å®ƒæ£€æŸ¥å®ƒæ˜¯å¦æ˜¯æ ¹æ®åˆæˆè§„èŒƒç¼–å†™çš„ï¼Œå¹¶éƒ¨ç½²åº”ç”¨ç¨‹åºç»„ä»¶

æ¥è‡ª Docker çš„å®‰å¡Â·çº¦å°”è¾¾åˆ‡è§£é‡Šäº† Compose è§„èŒƒçš„å…¬å¼€åŒ–ï¼Œä»¥åŠå¥¹æ˜¯å¦‚ä½•ä½œä¸ºä¸€ä¸ªé™„å¸¦é¡¹ç›®å¼€å§‹ä¸º Compose CLI å¼€å‘ kube åç«¯çš„:

> â€œç”±äºå…¶ç®€å•æ€§ï¼ŒCompose æ ¼å¼åœ¨å¼€å‘äººå‘˜ä¸­éå¸¸å—æ¬¢è¿ï¼Œäººä»¬æ€»æ˜¯å¯¹åœ¨å¹³å°ä¸Šéƒ¨ç½² Compose æ–‡ä»¶çš„å·¥å…·æ„Ÿå…´è¶£ï¼Œè€Œä¸æ˜¯å•ä¸ª Docker å¼•æ“æˆ– Swarmã€‚ä¸ºäº†è®© Compose è¶…è¶Š Docker å’Œ Swarmï¼Œåœ¨ 2020 å¹´åˆï¼Œæˆ‘ä»¬å¼€æ”¾äº† Compose è§„èŒƒï¼Œä½¿ä»»ä½•äººéƒ½å¯ä»¥å›´ç»•å®ƒæ„å»ºå·¥å…·ã€‚æˆ‘ä»¬ä½¿ç”¨æ–°çš„å¼€æ”¾è§„èŒƒå’Œå‚è€ƒåº“åœ¨ Docker CLI ä¸­æ„å»ºå¯¹ Amazon ECS å’Œ Microsoft ACI çš„æ”¯æŒï¼Œä»¥ä¾¿åœ¨è¿™äº›å¹³å°ä¸Šéƒ¨ç½² Compose åº”ç”¨ç¨‹åºã€‚ä¸€ä¸ªæ˜æ˜¾çš„ä¸‹ä¸€ä¸ªç›®æ ‡æ˜¯ Kubernetesï¼Œå› ä¸ºå®ƒéå¸¸å—æ¬¢è¿ï¼Œäººä»¬å¯¹åœ¨å…¶ä¸Šéƒ¨ç½² Compose åº”ç”¨ç¨‹åºéå¸¸æ„Ÿå…´è¶£ã€‚æˆ‘ä»¬å†™äº†ä¸€ä¸ªåˆæ­¥çš„æ¦‚å¿µè¯æ˜æ¥æµ‹è¯•è¿™ç§é›†æˆï¼Œä½†å®ƒè¿˜æ²¡æœ‰è¢«æ·»åŠ åˆ° Docker çš„äº§å“è·¯çº¿å›¾ä¸­ã€‚æˆ‘æŠŠå®ƒä½œä¸ºæˆ‘çš„é»‘å®¢é¡¹ç›®ï¼Œç»§ç»­åœ¨è¿™ä¸ªé›†æˆä¸Šå–å¾—è¿›å±•ã€‚Kubernetes åç«¯çš„å½“å‰ä»£ç å¯ä»¥åœ¨å…¬å…±å­˜å‚¨åº“ [docker/compose-cli](https://github.com/docker/compose-cli) ä¸­æ‰¾åˆ°ï¼Œæ¬¢è¿æ¯ä¸ªäººå¯¹å…¶åšå‡ºè´¡çŒ®ã€‚â€

æ­£å¦‚ Anca æ‰€è¯´ï¼Œ [Compose CLI](https://github.com/docker/compose-cli) GitHub å­˜å‚¨åº“æ˜¯æ‰˜ç®¡ä¸åŒåç«¯çš„åœ°æ–¹:

[](https://github.com/docker/compose-cli) [## docker/compose-cli

### è¿™ä¸ªç¼–å†™ CLI å·¥å…·ä½¿è¿è¡Œ Docker å®¹å™¨å’Œ Docker ç¼–å†™åº”ç”¨ç¨‹åºå˜å¾—å®¹æ˜“:åœ¨æœ¬åœ°ä½œä¸ºä¸€ä¸ªå‘½ä»¤åœ¨â€¦

github.com](https://github.com/docker/compose-cli) 

ä½†æ˜¯ï¼Œç­‰ç­‰â€¦æˆ‘ä»¬è°ˆè®ºçš„åç«¯åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ

ä¸‹é¢çš„å›¾ç‰‡(æ¥è‡ª compose-cli GitHub åº“çš„å›¾ç‰‡çš„ç•¥å¾®ä¿®æ”¹ç‰ˆæœ¬)ä½¿äº‹æƒ…å˜å¾—æ›´åŠ æ¸…æ¥š:

![](img/c98f88bf9e0237c608ae5b1c23a9a21b.png)

æ¥è‡ª https://github.com/docker/compose-cli[çš„ä¿®æ”¹å›¾ç‰‡](https://github.com/docker/compose-cli)

åç«¯æ˜¯ Compose API çš„ä¸€ä¸ªå®ç°ï¼Œæ¯ä¸ªåç«¯é’ˆå¯¹ä¸€ä¸ªç‰¹å®šçš„å¹³å°(Amazon ECSï¼ŒAzure ACI)ã€‚å¦å¤–ï¼ŒDocker compose æ˜¯è¿™ä¸ª compose api çš„ cli å®¢æˆ·æœºã€‚

æˆ‘ä»¬å¦‚ä½•é€‰æ‹©æˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„åç«¯ï¼Ÿ

Docker compose cli çŸ¥é“ä½¿ç”¨å“ªä¸ªåç«¯çš„æ–¹å¼æ˜¯é€šè¿‡å½“å‰ä½¿ç”¨çš„ Docker ä¸Šä¸‹æ–‡ã€‚ä»"*docker context create-help "*å‘½ä»¤ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° **aci** å’Œ **ecs** ä¸Šä¸‹æ–‡éƒ½å¯ä»¥åœ¨æ›´å¸¸è§çš„ Docker å¼•æ“ä¹‹ä¸Šåˆ›å»º:

```
Create docker engine context:
$ docker context create CONTEXT [flags]Create Azure Container Instances context:
$ docker context create aci CONTEXT [flags]
(see docker context create aci --help)Create Amazon ECS context:
$ docker context create ecs CONTEXT [flags]
(see docker context create ecs --help)
```

å› æ­¤ï¼ŒåŸºäºå½“å‰ä¸Šä¸‹æ–‡é€‰æ‹©åç«¯ã€‚

ç›®å‰æœ‰ 3 ä¸ªå®˜æ–¹åç«¯:

*   **æœ¬åœ°**:éƒ¨ç½²åœ¨æœ¬åœ°æœºå™¨ä¸Šã€‚è¿™ä¸ªåç«¯æ˜¯ [Compose V2](https://docs.docker.com/compose/cli-command/) ï¼Œå®ƒå°†ä½œä¸º CLI æ’ä»¶å‘å¸ƒï¼Œå–ä»£åŸæ¥çš„ python docker-compose
*   **aci** :éƒ¨ç½²åœ¨ [Azure å®¹å™¨å®ä¾‹ä¸Š](https://docs.docker.com/cloud/aci-integration/)
*   **ecs** :éƒ¨ç½²åœ¨[äºšé©¬é€Šå¼¹æ€§å®¹å™¨æœåŠ¡](https://docs.docker.com/cloud/ecs-integration/)

é™¤æ­¤ä¹‹å¤–ï¼ŒAnca è¿˜åœ¨å¼€å‘åç«¯é¡¹ç›® kubeã€‚è¯¥åç«¯å°†å…è®¸åœ¨ Kubernetes é›†ç¾¤ä¸Šéƒ¨ç½²ä¸€ä¸ªç»„åˆåº”ç”¨ç¨‹åºã€‚

åœ¨æ¥ä¸‹æ¥çš„éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»ç”¨äºè®¾ç½®æ•´ä¸ªç¯å¢ƒçš„æ­¥éª¤ã€‚å› ä¸ºè¿™ä¸ªé¡¹ç›®è¿˜å¾ˆå¹´è½»ï¼Œæ²¡æœ‰é™„å¸¦ Docker CLIï¼Œæ‰€ä»¥æœ‰å¿…è¦ä»æºä»£ç ç¼–è¯‘å®ƒï¼Œä½†æ˜¯ä½ ä¼šå‘ç°å®ƒå¹¶ä¸å¤æ‚ã€‚

# è®¾ç½®ç¯å¢ƒ

**Linux è™šæ‹Ÿæœº**

é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª Ubuntu è™šæ‹Ÿæœºã€‚ä¸ºäº†è¿™ç¯‡æ–‡ç« çš„ç›®çš„ï¼Œæˆ‘ç”¨ Terraform é…ç½®æ–‡ä»¶åœ¨ä¸€ä¸ªä¼Ÿå¤§çš„æ¬§æ´²äº‘æä¾›å•† Exoscale ä¸Šåˆ›å»ºäº†å®ƒã€‚

```
**$ terraform apply** ...
Outputs:instances_names = {
  "exo-0" = "89.145.160.162"
}
```

ä»¥ä¸‹æŒ‡ä»¤å°†é€šè¿‡æ–°è™šæ‹Ÿæœºä¸­çš„ shell è¿è¡Œã€‚

**ç å¤´å·¥äººå®‰è£…**

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­å®‰è£… Dockerï¼Œè¿™å¯ä»¥é€šè¿‡ä¸‹é¢è¿™ä¸ªæ–¹ä¾¿çš„å‘½ä»¤æ¥å®Œæˆ:

```
$ curl -sSL [https://get.docker.com](https://get.docker.com) | sh
```

**è·å–æ’°å†™ CLI æŠ¥å‘Š**

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è·å– Compose CLI æºä»£ç å¹¶ç§»å…¥å…¶ä¸­

```
$ git clone [https://github.com/docker/compose-cli.git](https://github.com/docker/compose-cli.git)
$ cd compose-cli/
```

ç¼–è¯‘ç¼–å†™å‘½ä»¤è¡Œç•Œé¢

ğŸ”¥ä¸‹é¢çš„å‡ ä¸ªè¯´æ˜æ˜¯å¿…éœ€çš„ï¼Œå› ä¸º kube åç«¯æ²¡æœ‰åœ¨ Compose ç‰ˆæœ¬ä¸­å‘å¸ƒï¼Œå®ƒéœ€è¦ä»æºä»£ç ä¸­æ„å»ºã€‚

é¦–å…ˆæˆ‘ä»¬éœ€è¦å®‰è£… *make* å®ç”¨ç¨‹åº:

```
$ apt-get install make
```

ç„¶åæˆ‘ä»¬å¯ä»¥é’ˆå¯¹ compose-cli é¡¹ç›®è¿è¡Œå®ƒ:

```
$ make
```

ç¼–è¯‘æ˜¯åœ¨ä¸€ä¸ªå®¹å™¨ä¸­å®Œæˆçš„ï¼Œåªéœ€è¦å‡ åˆ†é’Ÿã€‚ç„¶ååœ¨*ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ *docker* äºŒè¿›åˆ¶æ–‡ä»¶ã€‚/bin* æ–‡ä»¶å¤¹(æ—è¾¹æ˜¯ä¸€ä¸ª docker-compose äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªä¾‹å­ä¸­ä¸ä¼šç”¨åˆ°å®ƒ)ã€‚

```
root@exo-0:~/compose-cli# tree bin
bin
â”œâ”€â”€ docker
â””â”€â”€ docker-compose
```

ä¸ºäº†ä½¿ç”¨æ–°çš„ docker äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦å°†ä¹‹å‰çš„äºŒè¿›åˆ¶æ–‡ä»¶é‡å‘½åä¸º *com.docker.cli* ï¼Œå¹¶å°†å½“å‰çš„äºŒè¿›åˆ¶æ–‡ä»¶ç§»åŠ¨åˆ° PATH ä¸­

```
$ mv /usr/bin/docker /usr/bin/com.docker.cli
$ mv ./bin/docker /usr/bin/docker
```

å®ƒç›®å‰çš„å·¥ä½œæ–¹å¼æ˜¯: *compose* å­å‘½ä»¤å°†ç”±æˆ‘ä»¬åˆšåˆšæ„å»ºçš„ *docker* äºŒè¿›åˆ¶æ–‡ä»¶å¤„ç†ï¼Œæ‰€æœ‰å…¶ä»–å‘½ä»¤(å®¹å™¨ã€å›¾åƒâ€¦â€¦)å°†ç”± *com.docker.cli* äºŒè¿›åˆ¶æ–‡ä»¶è¿è¡Œã€‚

**Kubernetes é›†ç¾¤**

ä¸‹ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ª Kubernetes é›†ç¾¤ã€‚æˆ‘ä»¬å°†é‡‡ç”¨ç®€å•çš„æ–¹æ³•ï¼Œå»ºç«‹ä¸€ä¸ªæœ¬åœ°å•èŠ‚ç‚¹ [k3s](https://get.k3s.io) é›†ç¾¤ã€‚åªéœ€ä¸€ä¸ªå‘½ä»¤(å‡ åç§’é’Ÿ)å°±å¯ä»¥å¯åŠ¨å¹¶è¿è¡Œé›†ç¾¤:

```
$ curl -sSL [https://get.k3s.io](https://get.k3s.io) | sh
```

k3s è‡ªå¸¦ kubectl äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™ä½¿å¾—ç›´æ¥æ£€æŸ¥é›†ç¾¤æ˜¯å¦æ­£åœ¨è¿è¡Œå˜å¾—å®¹æ˜“

```
$ k3s kubectl get nodes
NAME   STATUS   ROLES                  AGE   VERSION
demo   Ready    control-plane,master   87s   v1.21.1+k3s1$ kubectl get pods -A
```

æˆ‘ä»¬åªæ˜¯æŠŠ k3s åˆ›å»ºçš„ kubeconfig æ–‡ä»¶(ä½äº*/etc/rancher/k3s/k3s . YAML*)å¤åˆ¶åˆ°é»˜è®¤çš„ *~/ä¸­ã€‚kube/configï¼Œ*æˆ‘ä»¬å°†åœ¨åé¢çš„æ­¥éª¤ä¸­éœ€è¦å®ƒã€‚

```
$ cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
```

æˆ‘ä»¬éœ€è¦åˆ›å»ºçš„æœ€åä¸€ä»¶äº‹æ˜¯ Docker ä¸Šä¸‹æ–‡ã€‚æˆ‘ä»¬ä½¿ç”¨ **kubernetes** ç±»å‹é€‰æ‹©é»˜è®¤çš„ *kubeconfig* æ–‡ä»¶( *~/)ã€‚kube/config* )æ¥è·å–é›†ç¾¤çš„ä¿¡æ¯:

```
**$ docker context create kubernetes k3s** ? Create a Docker context using: Context from kubeconfig file
? Select kubeconfig context default
Successfully created kube context "k3s"
```

ç„¶åæˆ‘ä»¬éœ€è¦ä½¿ç”¨è¿™ä¸ªæ–°çš„ä¸Šä¸‹æ–‡:

```
$ docker context use k3s
```

ç°åœ¨æˆ‘ä»¬åº”è¯¥çœ‹åˆ°â€œcomposeâ€å­å‘½ä»¤æ˜¯å¯ç”¨çš„ã€‚å®ƒä¼šç”Ÿæˆä¸€ä¸ªç©ºåˆ—è¡¨ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰éƒ¨ç½²åº”ç”¨ç¨‹åº:

```
$ docker compose ls
NAME                STATUS
```

æˆ‘ä»¬å·²ç»å®‰è£…äº† Compose CLIï¼Œç°åœ¨å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ã€‚åœ¨ä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•éƒ¨ç½²ä¸€ä¸ªç¤ºä¾‹åº”ç”¨ç¨‹åº

# åœ¨ç¤ºä¾‹åº”ç”¨ç¨‹åºä¸Šä½¿ç”¨ kube åç«¯

kube åç«¯å®ç°äº† Docker Compose å‘½ä»¤ï¼Œç”¨äºåœ¨ Kubernetes é›†ç¾¤ä¸Šéƒ¨ç½²å®¹å™¨åŒ–çš„åº”ç”¨ç¨‹åºã€‚

æ³¨æ„:ç”±äºè¿™ä¸ªåç«¯ä¸æ˜¯å®˜æ–¹çš„ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘åˆ°å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç¼–å†™å‘½ä»¤éƒ½è¢«å®ç°äº†ï¼Œåªæœ‰ä¸‹é¢çš„å‘½ä»¤è¢«å®ç°äº†:

*   docker ç»„åˆèµ·æ¥éƒ¨ç½²ä¸€ä¸ªç»„åˆåº”ç”¨ç¨‹åº
*   *docker compose ls* åˆ—å‡ºå½“å‰éƒ¨ç½²çš„åˆæˆé¡¹ç›®
*   *docker ç¼–å†™ ps* åˆ—å‡º pod
*   *docker compose exec* åœ¨å®¹å™¨ä¸­è¿è¡Œ shell
*   *docker ç¼–å†™æ—¥å¿—*ä»¥è·å–ä¸€ä¸ªå®¹å™¨çš„æ—¥å¿—
*   *docker æ’°å†™å…³é—­*å¸è½½æ’°å†™åº”ç”¨ç¨‹åº

æ­¤å¤–ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰åœ¨åˆæˆæ–‡ä»¶ä¸­å®šä¹‰çš„å±æ€§éƒ½ä¼šè¢«è€ƒè™‘åœ¨å†…

ä¸ºäº†è¯´æ˜ kube åç«¯çš„ç”¨æ³•ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æŠ•ç¥¨åº”ç”¨ç¨‹åº v3 çš„ç®€åŒ–ç‰ˆæœ¬(å¦‚[https://gitlab.com/voting-application/config](https://gitlab.com/voting-application/config)ä¸­æ‰€å®šä¹‰çš„)ã€‚

```
**$ cat <<EOF > compose.yaml** services:
  nats:
    image: nats:2.2-alpine3.13
    expose:
      - 4222:4222
  vote:
    image: registry.gitlab.com/voting-application/vote:v3
    expose:
      - 80
  vote-ui:
    image: registry.gitlab.com/voting-application/vote-ui
    ports:
      - 5000:80
  result:
    image: registry.gitlab.com/voting-application/result:v3
    expose:
       - 80
  result-ui:
    image: registry.gitlab.com/voting-application/result-ui
    ports:
      - 5001:80
**EOF**
```

åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥ kubernetes çš„è§„èŒƒï¼Œè¿™ä¼šäº§ç”Ÿ:

*   æè¿°è¯¥é¡¹ç›®çš„ README.md æ–‡ä»¶
*   åŒ…å«é¡¹ç›®å…ƒæ•°æ®çš„ Chart.yaml
*   åº”ç”¨ç¨‹åºçš„æ¯ä¸ªå¾®æœåŠ¡çš„éƒ¨ç½²å’ŒæœåŠ¡

[è¦ç‚¹](https://gist.github.com/lucj/a75b29e671f84b4a1e8da5f7dbc9c0b6)ä¸­è¾“å‡ºæ˜¯å‘½ä»¤*docker compose converter*çš„ç»“æœï¼Œå®ƒä» *compose.yaml* æ–‡ä»¶ä¸­ç”Ÿæˆ Kubernetes è§„èŒƒ

ğŸ”¥ç›®å‰ï¼Œåœ¨ Compose æ–‡ä»¶ä¸­å®šä¹‰çš„æœåŠ¡æ˜¯åœ¨ Helm æ¡£æ¡ˆä¸­è½¬æ¢çš„ï¼Œä½†æ˜¯è¿™ç§è¡Œä¸ºåœ¨ä¸ä¹…çš„å°†æ¥å¯èƒ½ä¼šæ”¹å˜ï¼Œç›´æ¥è®¿é—® Kubernetes APIï¼Œä»è€Œé¿å… helm vendoringã€‚

æˆ‘ä»¬ç°åœ¨å¯ä»¥æµ‹è¯•åº”ç”¨ç¨‹åºçš„éƒ¨ç½²äº†

```
**$ docker compose up** [+] Running 7/7
 â ¿ Convert Compose file to Helm charts      0.0s
 â ¿ Install Compose stack                    0.4s
 â ¿ nats                                     22.5s
 â ¿ vote                                     22.5s
 â ¿ result                                   22.5s
 â ¿ vote-ui                                  22.5s
 â ¿ result-ui
```

ä½¿ç”¨ kubectlï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å·²ç»åˆ›å»ºäº†éƒ¨ç½²å’ŒæœåŠ¡ã€‚

![](img/340e007fc33e309a6cd36db7fb7b2188.png)

ä½¿ç”¨ä¸Šé¢ä¿¡æ¯ä¸­æŒ‡å®šçš„èŠ‚ç‚¹ç«¯å£ï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®æŠ•ç¥¨ç•Œé¢ï¼Œä¸ºæˆ‘ä»¬æœ€å–œæ¬¢çš„å°çŒ«æŠ•ç¥¨ã€‚

![](img/b94792fd3e0922581dbfde10fd03d97b.png)

å‡ ä¸ªç»„åˆå‘½ä»¤å¯ç”¨äºè·å–ä¿¡æ¯å’Œç®¡ç†åº”ç”¨ç¨‹åºçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸ:

*   åˆ—å‡ºç”¨ compose-cli åˆ›å»ºçš„é¡¹ç›®ã€‚åªæœ‰å½“å‰é¡¹ç›®å‡ºç°åœ¨è¿™ä¸ªåˆ—è¡¨ä¸­ï¼Œå®ƒè¢«å‘½åä¸º voteï¼Œå› ä¸ºå®ƒæ˜¯ä» *vote* æ–‡ä»¶å¤¹ä¸­è¿è¡Œçš„ã€‚

```
**$ docker compose ls** NAME                STATUS
vote                deployed
```

*   åˆ—å‡ºåˆ›å»ºçš„çª—æ ¼

```
$ docker compose ps
```

*   æˆ‘ä»¬å¯ä»¥åœ¨å®¹å™¨ä¸­è¿è¡Œ shell

```
$ docker compose exec www bash
```

*   è¿˜è¦æ£€æŸ¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨çš„æ—¥å¿—

```
$ docker compose logs nats
```

ä¸€æ—¦æˆ‘ä»¬å®Œæˆäº†æˆ‘ä»¬çš„æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°åˆ é™¤é¡¹ç›®ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»ä¹ æƒ¯äº†:

```
$ docker compose down
```

## å…³é”®è¦ç‚¹

è¿™ä¸ª kube åç«¯ä»å¤„äºèµ·æ­¥é˜¶æ®µï¼Œä½†ç»å¯¹æ˜¯ä¸€ä¸ªä¼Ÿå¤§çš„ä¸¾åŠ¨ï¼Œå®ƒå°†åœ¨ Compose è§„èŒƒä¸­å®šä¹‰çš„åº”ç”¨ç¨‹åºå’Œ Kubernetes èµ„æºä¹‹é—´æ¶èµ·ä¸€åº§æ¡¥æ¢ã€‚

æƒ³å°è¯•ä¸€ä¸‹è¿™ä¸ªé¡¹ç›®ï¼Œç”šè‡³ä¸ºå®ƒåšç‚¹è´¡çŒ®å—ï¼Ÿä¸è¦å†æƒ³äº†ï¼Œå‹‡å¾€ç›´å‰:)

éå¸¸æ„Ÿè°¢æ¥è‡ª Docker çš„ Anca çº¦å°”è¾¾åˆ‡å¯åŠ¨äº†è¿™ä¸ª kube åç«¯ï¼Œå¹¶èŠ±æ—¶é—´å‘æˆ‘å±•ç¤ºäº†ä»£ç çš„å½“å‰çŠ¶æ€ï¼Œå¹¶ä¸€æ­¥ä¸€æ­¥åœ°å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ä¸€å¯¹ä¸€çš„è§†é¢‘é€šè¯æ¥è®¾ç½®æ•´ä¸ªäº‹æƒ…ğŸ‘ä¹Ÿæ„Ÿè°¢å¥¹å¯¹è¿™ç¯‡æ–‡ç« çš„è¯¦ç»†è¯„è®ºï¼Œä»¥åŠå¥¹åœ¨ Docker åšå®¢ä¸Šå†™çš„æ‰€æœ‰ç²¾å½©æ–‡ç« ã€‚