<html>
<head>
<title>Directive Type Checking</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">æŒ‡ä»¤ç±»å‹æ£€æŸ¥</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/directive-type-checking-3d3c5f1137b3?source=collection_archive---------1-----------------------#2022-12-05">https://itnext.io/directive-type-checking-3d3c5f1137b3?source=collection_archive---------1-----------------------#2022-12-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/55a51fe66cccb0d2c11d8d3ee1ec3596.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BVnx3NEh93UIQF0nuFza1A.png"/></div></div></figure><p id="1b7a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">æŒ‡ä»¤</strong>æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å·¥å…·ï¼Œæˆ‘ä»¬åº”è¯¥æŒæ¡å®ƒæ¥æé«˜æˆ‘ä»¬çš„è§’åº¦æŠ€å·§ã€‚Typescriptå¼ºåˆ¶æ‰§è¡Œä¸¥æ ¼ç±»å‹ï¼Œå¹¶å¸®åŠ©æˆ‘ä»¬ä½¿æˆ‘ä»¬çš„ä»£ç åº“æ›´æœ‰å¼¹æ€§ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå®šåˆ¶æŒ‡ä»¤å¹¶ä¸æ˜¯å¼€ç®±å³ç”¨çš„ã€‚æœ¬æ–‡çš„ç›®çš„æ˜¯å‘æ‚¨å±•ç¤ºå¦‚ä½•å°†ä¸¥æ ¼çš„ç±»å‹æ·»åŠ åˆ°æ‚¨çš„ç»“æ„åŒ–æŒ‡ä»¤ä¸­ï¼Œå¹¶ä½¿æ‚¨çš„è§’åº¦ä»£ç åº“æ›´å…·å¼¹æ€§ã€‚</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="08d4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ä¸ºäº†æ”¯æŒç±»å‹æ£€æŸ¥ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨Angularæä¾›çš„ä¸¤ä¸ªæ–¹ä¾¿çš„ç±»å‹ä¿æŠ¤:</p><ul class=""><li id="93e8" class="ld le iq ka b kb kc kf kg kj lf kn lg kr lh kv li lj lk ll bi translated">ngTemplateContextGuard :ä¸ºæˆ‘ä»¬çš„è‡ªå®šä¹‰æŒ‡ä»¤çš„ä¸Šä¸‹æ–‡å£°æ˜ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹</li><li id="db52" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated"><strong class="ka ir">ngTemplateGuard _[customInputProperty]</strong>:ç¼©å°è¾“å…¥å±æ€§çš„å‘ˆç°ç±»å‹ã€‚</li></ul><p id="8584" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">åœ¨æˆ‘ä»¬æ·±å…¥è¿™äº›é™æ€è§’åº¦å‡½æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£Typescriptç±»å‹è°“è¯æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚å¦‚æœä½ ä¸ç†è§£æˆ–è€…ä»æœªå¬è¯´è¿‡è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘é‚€è¯·ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« ã€‚</p><div class="ls lt gp gr lu lv"><a href="https://medium.com/@thomas.laforge/typescript-type-predicate-d9b8c4a15569" rel="noopener follow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">ç±»å‹è„šæœ¬ç±»å‹è°“è¯</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">åœ¨Typescriptä¸­è·å–æ‚¨çš„ç±»å‹çš„æ§ä»¶</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">medium.com</p></div></div><div class="me l"><div class="mf l mg mh mi me mj jw lv"/></div></div></a></div></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h2 id="df10" class="mk ml iq bd mm mn mo dn mp mq mr dp ms kj mt mu mv kn mw mx my kr mz na nb nc bi translated">ngTemplateContextGuard</h2><p id="ea9e" class="pw-post-body-paragraph jy jz iq ka b kb nd kd ke kf ne kh ki kj nf kl km kn ng kp kq kr nh kt ku kv ij bi translated">å¦‚æœæˆ‘ä»¬éœ€è¦ä¸ºæˆ‘ä»¬çš„è‡ªå®šä¹‰æŒ‡ä»¤æä¾›ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é™æ€å‡½æ•°<strong class="ka ir"> ngTemplateContextGuard </strong>ç¡®ä¿å®ƒåœ¨æ¨¡æ¿ä¸­è¢«æ­£ç¡®åœ°é”®å…¥ã€‚å®ƒçš„å·¥ä½œæ–¹å¼ç±»ä¼¼äºTypescriptç±»å‹ä¿æŠ¤å‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªç±»å‹è°“è¯ã€‚</p><p id="5937" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­æ¥æ›´å¥½åœ°ç†è§£è¿™ä¸ªæ¦‚å¿µã€‚</p><pre class="ni nj nk nl gt nm nn no bn np nq bi"><span id="fb56" class="nr ml iq nn b be ns nt l nu nv">interface DemoUrl {<br/>  url: string;<br/>  video: boolean;<br/>}<br/><br/>// interface declaring the Context of this Directive<br/>interface DemoContext {<br/>  $implicit: number;<br/>  demo: string;<br/>  url: DemoUrl;<br/>}<br/><br/>@Directive({<br/>  selector: '[demo]',<br/>  standalone: true,<br/>})<br/>export class DemoDirective implements OnInit {<br/>  @Input() demo!: string;<br/>  @Input() demoUrl!: DemoUrl;<br/><br/>  constructor(<br/>    private readonly viewContainerRef: ViewContainerRef,<br/>    private readonly templateRef: TemplateRef&lt;DemoContext&gt;<br/>  ) {}<br/><br/>  ngOnInit(): void {<br/>    const context = {<br/>      $implicit: 1,<br/>      demo: this.demo,<br/>      url: this.demoUrl,<br/>    };<br/>    this.viewContainerRef.createEmbeddedView(this.templateRef, context);<br/>  }<br/><br/>  // Guard to help Typescript correctly type checked <br/>  // the context with which the template will be rendered<br/>  static ngTemplateContextGuard(<br/>    directive: DemoDirective,<br/>    context: unknown<br/>  ): context is DemoContext {<br/>    return true;<br/>  }<br/>}</span></pre><p id="68e0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nw">ngTemplateContextGuardè¿”å›trueï¼Œå› ä¸ºè¯¥æŒ‡ä»¤æ€»æ˜¯å°†DemoContextç±»å‹çš„ä¸Šä¸‹æ–‡ä¼ é€’ç»™æ¨¡æ¿ã€‚</em></p><p id="6966" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç°åœ¨ï¼Œå½“æˆ‘ä»¬åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨è¿™ä¸ªæŒ‡ä»¤æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ç±»å‹æ­£ç¡®çš„å±æ€§ã€‚</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/13dac0dc452c49efb0a11bfc3b90f86e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oHN1l5PCJma-ig0rIph9Mg.png"/></div></div></figure><blockquote class="ny nz oa"><p id="39fa" class="jy jz nw ka b kb kc kd ke kf kg kh ki ob kk kl km oc ko kp kq od ks kt ku kv ij bi translated">é¢å¤–æç¤º:æˆ‘ä»¬å¯ä»¥ç”¨ä¸‰ç§ä¸åŒçš„æ–¹å¼ç¼–å†™ç»“æ„æŒ‡ä»¤ã€‚æ‰€æœ‰è¿™äº›éƒ½è¢«ç¼–è¯‘å™¨ä»¥åŒæ ·çš„æ–¹å¼è§£é‡Šã€‚</p></blockquote><pre class="ni nj nk nl gt nm nn no bn np nq bi"><span id="69ed" class="nr ml iq nn b be ns nt l nu nv">&lt;ng-template demo="toto" [demoUrl]="demoUrl" let-version let-demo="demo" let-url="url"&gt;<br/>  {{ url.url }}<br/>&lt;/ng-template&gt;<br/><br/>// * is the shorthand for what angular will interpret with ng-template<br/>&lt;div *demo="'toto'; let version; url: demoUrl; let demo = demo; let url = url"&gt;<br/>  {{ url.url }}<br/>&lt;/div&gt;<br/><br/>// We can use "as" in replacement of "let ... = "<br/>&lt;div *demo="'toto' as version; url: demoUrl; demo as demo; url as url"&gt;<br/>  {{ url.url }}<br/>&lt;/div&gt;</span></pre><h2 id="45e2" class="mk ml iq bd mm mn mo dn mp mq mr dp ms kj mt mu mv kn mw mx my kr mz na nb nc bi translated">ngTemplateGuard _[customInputProperty]</h2><p id="1823" class="pw-post-body-paragraph jy jz iq ka b kb nd kd ke kf ne kh ki kj nf kl km kn ng kp kq kr nh kt ku kv ij bi translated">ç†è§£è¿™ä¸ªä¿æŠ¤æœ‰ç‚¹å¤æ‚ã€‚ç»“æ„æŒ‡ä»¤æ§åˆ¶æ¨¡æ¿åœ¨è¿è¡Œæ—¶çš„å‘ˆç°æ–¹å¼ã€‚<em class="nw">(ä¾‹å¦‚ï¼Œåªæœ‰å½“è¾“å…¥æ¡ä»¶ä¸ºthrustlyæ—¶ï¼ŒNgIfæ‰ä¼šå°†æ¨¡æ¿æ·»åŠ åˆ°DOMä¸­ã€‚)</em></p><p id="a26b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¦‚æœæˆ‘ä»¬çš„è‡ªå®šä¹‰æŒ‡ä»¤çš„è¾“å…¥å…·æœ‰å¤æ‚çš„ç±»å‹ï¼Œå¹¶ä¸”è¯¥æŒ‡ä»¤ä»…åœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶æ‰å‘ˆç°æ¨¡æ¿ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ç§ä¿æŠ¤æ¥ç¼©å°å‘ˆç°çš„ç±»å‹ã€‚</p><p id="70c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è®©æˆ‘ä»¬å±•ç¤ºè¿™ä¸ªä¾‹å­æ¥æ›´å¥½åœ°ç†è§£è¿™ä¸ªæ¦‚å¿µ:</p><pre class="ni nj nk nl gt nm nn no bn np nq bi"><span id="3e8c" class="nr ml iq nn b be ns nt l nu nv">// Typescript type guard<br/>export const isDog = (animal: Animal): animal is Dog =&gt; {<br/>  return (animal as Dog).breed !== undefined;<br/>}<br/><br/>interface Cat {<br/>  name: string;<br/>  type: 'cat';<br/>}<br/><br/>interface Dog {<br/>  name: string;<br/>  race: string;<br/>  type: 'dog';<br/>}<br/><br/>type Animal = Dog | Cat;<br/><br/>@Directive({<br/>  selector: '[isDog]',<br/>  standalone: true,<br/>})<br/>export class DogDirective {<br/>  @Input('isDog') set isDogInput(animal: Animal) {<br/>    if (isDog(animal.type)) {<br/>      this.viewContainerRef.createEmbeddedView(this.templateRef);<br/>    } else {<br/>      this.viewContainerRef.clear();<br/>    }<br/>  }<br/><br/>  constructor(<br/>    private readonly viewContainerRef: ViewContainerRef,<br/>    private readonly templateRef: TemplateRef&lt;unknown&gt;<br/>  ) {}</span></pre><p id="92ab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è¯¥æŒ‡ä»¤å°†ä¸€ä¸ª<code class="fe oe of og nn b">Animal</code>ä½œä¸ºè¾“å…¥ï¼Œå¹¶ä¸”ä»…å½“è¾“å…¥åŠ¨ç‰©çš„ç±»å‹ä¸º<code class="fe oe of og nn b">Dog</code>æ—¶æ‰å‘ˆç°æ¨¡æ¿ã€‚å°½ç®¡æˆ‘ä»¬100%ç¡®å®šåªæœ‰å½“æˆ‘ä»¬çš„è¾“å…¥æ˜¯<code class="fe oe of og nn b">Dog</code>ç±»å‹æ—¶ï¼Œè¿™ä¸ªæ¨¡æ¿æ‰ä¼šè¢«æ¸²æŸ“ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¨¡æ¿ä¸­çš„åŠ¨ç‰©å˜é‡ä»ç„¶æ˜¯<code class="fe oe of og nn b">Animal</code>ç±»å‹ã€‚</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oh"><img src="../Images/df406d780e9669d4ea375d333f648e04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*5nVCWmTNEyAVkMatHxIMoA.png"/></div></div><figcaption class="oi oj gj gh gi ok ol bd b be z dk translated">æ²¡æœ‰<strong class="bd mm"> ngTemplateGuard </strong></figcaption></figure><p id="cc28" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è¿™å°±æ˜¯<strong class="ka ir"> ngTemplateGuard </strong>å‰æ¥æ•‘æ´çš„åœ°æ–¹ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„å‡½æ•°å°†æˆ‘ä»¬çš„ç±»å‹ç¼©å°åˆ°<code class="fe oe of og nn b">Dog</code>ï¼Œå¹¶åœ¨æ¨¡æ¿ä¸­äº«å—æ›´å¥½çš„ç±»å‹å®‰å…¨æ€§ã€‚</p><pre class="ni nj nk nl gt nm nn no bn np nq bi"><span id="dccf" class="nr ml iq nn b be ns nt l nu nv">static ngTemplateGuard_isDog(<br/>  dir: DogDirective,<br/>  state: Animal // input type<br/>): state is Dog { // output type<br/>  return true;<br/>}</span></pre><p id="b9e8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨æ¨¡æ¿ä¸­çœ‹åˆ°æ­£ç¡®æ¨æ–­çš„ç±»å‹</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div class="gh gi om"><img src="../Images/662716acfd4f7486489659d53b7bc62f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*OAlA-WL6Cvz5D1Fz6w6mNQ.png"/></div><figcaption class="oi oj gj gh gi ok ol bd b be z dk translated">ä¸<strong class="bd mm"> ngTemplateGuard </strong></figcaption></figure><p id="5352" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">å¤‡æ³¨:</strong>å¦‚æœæˆ‘ä»¬å†³å®šæ›´æ”¹ç»‘å®šåˆ°æˆ‘ä»¬å†…éƒ¨è¾“å…¥åç§°çš„æ¨¡æ¿ä¸­ä½¿ç”¨çš„åç§°ï¼Œå¦‚<em class="nw">@ Input(' isDogExternal ')isDog</em>ï¼Œåˆ™é˜²æŠ¤é‡‡ç”¨å¤–éƒ¨å€¼ã€‚è¿™æ„å‘³ç€å®ˆå«å°†å˜æˆ<em class="nw">ngTemplateGuard _ isDogExternal</em>ã€‚</p><p id="0fda" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç„¶è€Œï¼Œé™¤éæˆ‘ä»¬æœ‰å……åˆ†çš„ç†ç”±ï¼Œå¦åˆ™åº”è¯¥é¿å…æ··æ·†ã€‚åŒä¸€ä¸ªå±æ€§æœ‰ä¸¤ä¸ªåç§°(å¤–éƒ¨å’Œå†…éƒ¨)ä¼šå¼•èµ·æ··æ·†ã€‚<em class="nw">(æŸ¥çœ‹</em> <a class="ae lr" href="https://angular.io/guide/styleguide#avoid-aliasing-inputs-and-outputs" rel="noopener ugc nofollow" target="_blank"> <em class="nw">æ£±è§’é£æ ¼æŒ‡å—</em> </a> <em class="nw">)ã€‚)</em></p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="5aa1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å°±æ˜¯è¿™æ ·ï¼æ‚¨ä¸å†æœ‰ä»»ä½•å€Ÿå£ä¸ä¸¥æ ¼è¾“å…¥æ‚¨çš„è‡ªå®šä¹‰æŒ‡ä»¤â€¦</p><p id="d9f1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰ç”¨ï¼Œè¯·è€ƒè™‘æ”¯æŒæˆ‘çš„å·¥ä½œï¼Œä¸ºå®ƒé¼“æŒğŸ‘ğŸ‘å¸®åŠ©å®ƒæ¥è§¦åˆ°æ›´å¹¿æ³›çš„å—ä¼—ã€‚éå¸¸æ„Ÿè°¢ä½ çš„æ”¯æŒã€‚</p><p id="0f5f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æˆ‘å¸Œæœ›ä½ å­¦åˆ°äº†æ–°çš„è§’åº¦æ¦‚å¿µã€‚ä½ å¯ä»¥åœ¨<a class="ae lr" href="https://medium.com/@thomas.laforge" rel="noopener">åª’ä½“</a>ã€<a class="ae lr" href="https://twitter.com/laforge_toma" rel="noopener ugc nofollow" target="_blank">æ¨ç‰¹</a>æˆ–<a class="ae lr" href="https://github.com/tomalaforge" rel="noopener ugc nofollow" target="_blank"> Github </a>ä¸Šæ‰¾åˆ°æˆ‘ã€‚å¦‚æœä½ æœ‰æ›´å¤šçš„é—®é¢˜ï¼Œä¸è¦çŠ¹è±«æ¥æ‰¾æˆ‘</p><blockquote class="on"><p id="010e" class="oo op iq bd oq or os ot ou ov ow kv dk translated">ğŸ‘‰å¦‚æœä½ æƒ³åŠ å¿«ä½ çš„è§’åº¦å­¦ä¹ ä¹‹æ—…ï¼Œæ¥çœ‹çœ‹<a class="ae lr" href="https://github.com/tomalaforge/angular-challenges" rel="noopener ugc nofollow" target="_blank">è§’åº¦æŒ‘æˆ˜</a>ã€‚</p></blockquote></div></div>    
</body>
</html>