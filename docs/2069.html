<html>
<head>
<title>React Hooks â€” designing a simple forms API â€” part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">react Hooksâ€”â€”è®¾è®¡ç®€å•çš„è¡¨å•APIâ€”â€”ç¬¬1éƒ¨åˆ†</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/react-hooks-designing-a-simple-forms-api-part-1-307b04bc6007?source=collection_archive---------3-----------------------#2019-03-26">https://itnext.io/react-hooks-designing-a-simple-forms-api-part-1-307b04bc6007?source=collection_archive---------3-----------------------#2019-03-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="fb41" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¦‚æœæ‚¨è‡´åŠ›äºåˆ›å»ºåŠŸèƒ½ç»„ä»¶è€Œä¸æ˜¯ç±»ç»„ä»¶ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦æ·±å…¥é’©å­ã€‚æ‚¨å°†ä½¿ç”¨å¤§é‡çš„é’©å­ï¼Œéšç€ä»£ç è§„æ¨¡çš„å¢åŠ ï¼Œæ‚¨å¯èƒ½éœ€è¦åˆ›å»ºè‡ªå®šä¹‰é’©å­ã€‚Reacté’©å­æä¾›äº†ä¸€ç§æŠ½è±¡å¯é‡ç”¨é€»è¾‘çš„æ–°æ–¹æ³•ã€‚å¼€å§‹ä½¿ç”¨å®ƒä»¬å¾ˆå®¹æ˜“ï¼Œä½†æ˜¯æˆ‘å‘ç°éšç€ç”¨ä¾‹å¤æ‚æ€§çš„å¢åŠ ï¼ŒæŠ½è±¡æ‚¨çš„å®šåˆ¶é’©å­å˜å¾—æ›´å…·æŒ‘æˆ˜æ€§ã€‚</p><p id="6435" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨è¿™ä¸ªç”±å¤šä¸ªéƒ¨åˆ†ç»„æˆçš„ç³»åˆ—ä¸­ï¼Œæˆ‘ä»¬å°†è®¾è®¡ä¸€ä¸ªç®€å•çš„useFormé’©å­ï¼Œå¹¶è®¨è®ºæµ‹è¯•ç­–ç•¥ã€‚æˆ‘ä¸å»ºè®®æ‚¨æ„å»ºè‡ªå·±çš„è‡ªå®šä¹‰è¡¨å•APIï¼Œå› ä¸ºæœ‰è®¸å¤šReactè¡¨å•åº“ï¼Œæ—¢æœ‰åŸºäºç»„ä»¶çš„ï¼Œä¹Ÿæœ‰åŸºäºhookçš„ï¼Œæ‚¨å¯ä»¥å¼€å§‹ä½¿ç”¨ã€‚ä½†æ˜¯æˆ‘ç›¸ä¿¡è®¾è®¡å’Œå®ç°è¡¨å•APIæ˜¯åŠ æ·±å¯¹Reacté’©å­ç†è§£çš„ä¸€ä¸ªå¥½æ–¹æ³•ã€‚</p><p id="c7c8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨ç¬¬1éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†ä»åˆ›å»ºä¸€ä¸ªç®€å•çš„useFormæŒ‚é’©å¼€å§‹ï¼Œå¹¶è®¨è®ºå¦‚ä½•åœ¨è¡¨å•ä¸­ä½¿ç”¨å®ƒã€‚æˆ‘ä»¬è¿˜å°†è®¨è®ºæµ‹è¯•é’©å­çš„æ–¹æ³•ã€‚æˆ‘ä»¬å¼€å§‹å§ï¼</p><p id="b684" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œ<a class="ae ko" rel="noopener ugc nofollow" target="_blank" href="/react-hooks-designing-a-simple-forms-api-part-2-1fe5d12f23d9"> part 2 </a>ã€<a class="ae ko" rel="noopener ugc nofollow" target="_blank" href="/react-hooks-designing-a-simple-forms-api-part-3-validation-and-a-running-example-18b835a3b817"> part 3 </a>å’Œ<a class="ae ko" rel="noopener ugc nofollow" target="_blank" href="/react-hooks-designing-a-simple-forms-api-part-4-scaling-to-other-input-types-e738db0a3fc3"> part 4 </a>åœ¨çº¿ğŸ’ªã€‚</p><h1 id="b6f5" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">æ­¥éª¤1 â€”è®¾è®¡å…¬å…±API</h1><p id="9537" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">æˆ‘å‘ç°è®¾è®¡hooks APIsçš„æœ€ä½³èµ·ç‚¹æ˜¯é¦–å…ˆç†è§£ä½ å¸Œæœ›å®ƒåšä»€ä¹ˆï¼Œç„¶åä½ å°†å¦‚ä½•ä½¿ç”¨å®ƒã€‚æ‰€ä»¥è®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸ªå«åš<code class="fe ls lt lu lv b">useForm</code>çš„é’©å­ã€‚</p><h2 id="d21f" class="lw kq it bd kr lx ly dn kv lz ma dp kz kb mb mc ld kf md me lh kj mf mg ll mh bi translated">å®ƒä¼šåšä»€ä¹ˆï¼Ÿ</h2><ul class=""><li id="e9a8" class="mi mj it js b jt ln jx lo kb mk kf ml kj mm kn mn mo mp mq bi translated"><code class="fe ls lt lu lv b">useForm</code>å°†æ˜¯ä¸»è¦çš„APIå…¥å£ç‚¹</li><li id="5597" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated"><code class="fe ls lt lu lv b">useForm</code>å°†å‘æ¶ˆè´¹è€…æä¾›è¾“å…¥çŠ¶æ€ï¼Œå³åç§°å’Œå€¼ã€‚å‡ºäºè¡¨å•åˆå§‹åŒ–çš„ç›®çš„ï¼Œè¾“å…¥çŠ¶æ€å¿…é¡»èƒ½å¤Ÿä¼ é€’ç»™useFormé’©å­</li><li id="2431" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated"><code class="fe ls lt lu lv b">useForm</code>å°†æä¾›è¡¨å•çš„æ•´ä½“UIçŠ¶æ€ï¼Œå¦‚â€œè¡¨å•æ˜¯å¦æäº¤â€ã€â€œè¡¨å•æ˜¯å¦æäº¤â€ã€â€œè¡¨å•æ˜¯å¦éªŒè¯â€</li><li id="e3f4" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated"><code class="fe ls lt lu lv b">useForm</code>å°†å°è¯•ä¸ºè¡¨å•æä¾›åˆç†çš„HTMLå±æ€§</li><li id="a5ea" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated"><code class="fe ls lt lu lv b">useForm</code>æä¾›å¯è®¿é—®æ€§é“å…·ï¼Œå¦‚æœæ¶ˆè´¹è€…å¸Œæœ›æ”¯æŒå¯è®¿é—®æ€§æ ‡å‡†ï¼Œå¦‚<a class="ae ko" href="https://medium.com/@shanplourde/strategies-for-building-accessible-websites-f0d256decae6" rel="noopener"> WCAG AA </a>ï¼Œä»–ä»¬å¯ä»¥é€‰æ‹©ä½¿ç”¨è¿™äº›é“å…·</li><li id="e908" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">æ¶ˆè´¹è€…å°†é€šè¿‡<code class="fe ls lt lu lv b">useForm</code>é’©å­å®šä¹‰è¡¨å•ã€è¾“å…¥å’ŒéªŒè¯å™¨</li><li id="cec5" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated"><code class="fe ls lt lu lv b">useForm</code>å°†æ”¯æŒå¼‚æ­¥éªŒè¯å’Œæäº¤</li><li id="7204" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated"><code class="fe ls lt lu lv b">useForm</code>åŸæ–™è¯åº”è¿›è¡Œæµ‹è¯•</li><li id="7dfa" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">APIå°†å®Œå…¨æ˜¯éå¯è§†åŒ–çš„ï¼Œè¿™æ ·æ¶ˆè´¹è€…å°±å¯ä»¥å®Œå…¨æ§åˆ¶ä»–ä»¬è¡¨å•çš„å¤–è§‚å’Œæ„Ÿè§‰</li></ul><p id="1362" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å‡ºäºç¬¬1éƒ¨åˆ†çš„ç›®çš„ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„é’©å­åˆå§‹ç‰ˆæœ¬ï¼Œå®ƒåŒ…æ‹¬å®šåˆ¶çš„onSubmitå‡½æ•°æ”¯æŒå’Œæµ‹è¯•ç­–ç•¥ã€‚</p><h2 id="4184" class="lw kq it bd kr lx ly dn kv lz ma dp kz kb mb mc ld kf md me lh kj mf mg ll mh bi translated">æˆ‘ä»¬å°†å¦‚ä½•ä½¿ç”¨å®ƒï¼Ÿ</h2><p id="7ef8" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">æˆ‘è®¾æƒ³ç”¨æ³•å¦‚ä¸‹:</p><pre class="mw mx my mz gt na lv nb nc aw nd bi"><span id="1317" class="lw kq it lv b gy ne nf l ng nh">const sleep = ms =&gt; new Promise(resolve =&gt; setTimeout(resolve, ms));</span><span id="9136" class="lw kq it lv b gy ni nf l ng nh">function SampleForm(props) {<br/>  const { settings } = props;</span><span id="16aa" class="lw kq it lv b gy ni nf l ng nh"><strong class="lv iu">const { getFormProps, formState, formSummary } = useForm("settingsForm", {<br/>    ...settings<br/>  });</strong></span><span id="c4bc" class="lw kq it lv b gy ni nf l ng nh">const onSubmit = async ({ evt, formState } =&gt; {<br/>    await sleep(2000);<br/>  };</span><span id="2e78" class="lw kq it lv b gy ni nf l ng nh">  return (<br/>    &lt;div&gt;<br/>      &lt;h2&gt;Sample form&lt;/h2&gt;<br/>      {<strong class="lv iu">formSummary.isSubmitting</strong> &amp;&amp; &lt;div&gt;Submitting&lt;/div&gt;}<br/>      &lt;form <strong class="lv iu">{...getFormProps({ onSubmit })}</strong>&gt;<br/>      /* form stuff here */<br/>      &lt;/form&gt;<br/>    &lt;/div&gt;<br/>  );</span><span id="d27e" class="lw kq it lv b gy ni nf l ng nh">}</span></pre><p id="d67a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘ä»¬çš„è¡¨å•APIå°†é€šè¿‡<code class="fe ls lt lu lv b">useForm</code>é’©å­å¯ç”¨ã€‚åœ¨useFormé’©å­çš„ç¬¬1éƒ¨åˆ†ä¸­ï¼Œ<code class="fe ls lt lu lv b">formState</code>å°†è¿”å›å½“å‰çš„è¡¨å•çŠ¶æ€(æ­¤æ—¶å°†æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡)ã€‚<code class="fe ls lt lu lv b">getFormProps</code>å°†è¢«æ¶ˆè´¹è€…ç”¨æ¥è®¾ç½®ä¸€ä¸ªè¡¨å•çš„é“å…·ï¼Œæ¯”å¦‚<code class="fe ls lt lu lv b">onSubmit</code>ï¼Œå› ä¸º<code class="fe ls lt lu lv b">useForm</code>é’©å­å°†å®ç°ä¸€ä¸ª<code class="fe ls lt lu lv b">onSubmit</code>å‡½æ•°æ¥åŒ…è£…æ¶ˆè´¹è€…çš„<code class="fe ls lt lu lv b">onSubmit</code>å›è°ƒï¼Œä»¥ä¾¿å‘æ¶ˆè´¹è€…æä¾›ä¸€äº›é«˜çº§UIçŠ¶æ€ã€‚</p><p id="593a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è‡ªå®šä¹‰çš„<code class="fe ls lt lu lv b">onSubmit</code>å‡½æ•°åªæ˜¯ä¸€ä¸ªä¼‘çœ 2ç§’çš„å­˜æ ¹ã€‚è¿™å¯¹äºå¼‚æ­¥æµ‹è¯•è¡¨å•å¾ˆæœ‰ç”¨ã€‚</p><p id="a9a7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe ls lt lu lv b">formSummary</code>å°†è¡¨ç¤ºè¡¨å•çš„UIæ‘˜è¦ã€‚åœ¨ç¬¬ä¸€ä¸ªUIç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨æŸ¥çœ‹<code class="fe ls lt lu lv b">isSubmitting</code>é“å…·ï¼Œå¦‚æœä¸ºçœŸï¼Œæˆ‘ä»¬å°†å‘æ¶ˆè´¹è€…æ˜¾ç¤ºä¸€æ¡æäº¤æ¶ˆæ¯ã€‚è¿™ç§å±æ€§å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼å®ç°ã€‚ä¹Ÿè®¸æ‚¨çš„åº”ç”¨ç¨‹åºä¸­æœ‰ä¸€ä¸ªå…¨å±€Redux storeæ¥è·Ÿè¸ªç«¯ç‚¹ä½•æ—¶è¢«è¯·æ±‚å’Œå®Œæˆï¼Œå¦‚æœæ˜¯è¿™æ ·ï¼Œè¿™å¯èƒ½æ˜¯è·Ÿè¸ªè¡¨å•æäº¤çŠ¶æ€çš„å¦ä¸€ç§æ–¹æ³•ã€‚ä½†æ˜¯ä¸ºäº†ä¿æŒä¸€ä¸ªå…¨é¢çš„APIï¼Œæˆ‘ä»¬å°†åŒ…æ‹¬å®ƒï¼Œä½†æ˜¯å¦‚æœç”¨æˆ·ä¸ä½¿ç”¨å®ƒï¼Œå…è®¸ä»–ä»¬å¿½ç•¥å®ƒã€‚</p><h1 id="cb02" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">é¦–æ¬¡å®æ–½</h1><p id="c406" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">è®©æˆ‘ä»¬æ¥çœ‹çœ‹<code class="fe ls lt lu lv b">useForm</code>é’©å­çš„åˆå§‹ç‰ˆæœ¬:</p><pre class="mw mx my mz gt na lv nb nc aw nd bi"><span id="f68f" class="lw kq it lv b gy ne nf l ng nh">import { useState } from "react";</span><span id="5c36" class="lw kq it lv b gy ni nf l ng nh">export const defaultFormProps = {<br/>  autoComplete: "on"<br/>};<br/>export const useForm = (name, initialState = {}, props) =&gt; {<br/>  const [formState, setFormState] = useState({<br/>    values: initialState<br/>  });<br/>  const [formSummary, setFormSummary] = useState({<br/>    isSubmitting: false<br/>  });</span><span id="c40b" class="lw kq it lv b gy ni nf l ng nh">const getFormProps = (props = {}) =&gt; ({<br/>    ...defaultFormProps,<br/>    ...props,<br/>    onSubmit: async evt =&gt; {<br/>      evt.preventDefault();<br/>      try {<br/>        setFormSummary({ isSubmitting: true });<br/>        props.onSubmit &amp;&amp; (await props.onSubmit({ evt, formState }));<br/>      } finally {<br/>        setFormSummary({ isSubmitting: false });<br/>      }<br/>    }<br/>  });</span><span id="c395" class="lw kq it lv b gy ni nf l ng nh">return {<br/>    getFormProps,<br/>    formState: formState,<br/>    formSummary<br/>  };<br/>};</span></pre><p id="5a5d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">é’©å­çš„åˆå§‹ç‰ˆæœ¬æ”¯æŒdefaultFormPropsçš„APIï¼Œé»˜è®¤æƒ…å†µä¸‹<a class="ae ko" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/form" rel="noopener ugc nofollow" target="_blank">è¡¨å•è‡ªåŠ¨å®Œæˆ</a>å±æ€§ä¸ºonã€‚<code class="fe ls lt lu lv b">getFormProps</code>è¿”å›è°ƒç”¨è€…å¯ä»¥æ‰©å±•åˆ°è¡¨å•ä¸Šçš„è¡¨å•å±æ€§ã€‚<code class="fe ls lt lu lv b">onSubmit</code>åŒ…è£…è°ƒç”¨è€…<code class="fe ls lt lu lv b">onSubmit</code>ï¼Œä»¥ä¾¿èƒ½å¤Ÿè·Ÿè¸ª<code class="fe ls lt lu lv b">isSubmitting</code>ã€‚</p><h1 id="ecb8" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">æµ‹è¯•</h1><p id="06f0" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">é¦–å…ˆï¼Œæˆ‘ä»¬å°†æµ‹è¯•hooks APIã€‚å½“æˆ‘ä»¬å¼€å§‹åˆ›å»ºUIæµ‹è¯•ç”¨ä¾‹æ—¶ï¼Œæˆ‘ä»¬å°†ä¿å­˜UIæµ‹è¯•ä»¥å¤‡åç”¨ã€‚ä¸ºäº†å¼€å§‹æµ‹è¯•é’©å­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<a class="ae ko" href="https://jestjs.io/" rel="noopener ugc nofollow" target="_blank"> jest </a>å’Œ<a class="ae ko" href="https://www.npmjs.com/package/react-hooks-testing-library" rel="noopener ugc nofollow" target="_blank">react-hooks-testing-library</a>ã€‚å»ºè®®ä½¿ç”¨react-hooks-testing-libraryæµ‹è¯•é’©å­ã€‚</p><p id="b9d1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å› ä¸ºæˆ‘ä»¬å°†ä½¿ç”¨setTimeoutå¼‚æ­¥æµ‹è¯•ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä½¿ç”¨<code class="fe ls lt lu lv b">jest.useFakeTimers</code>ï¼Œå› ä¸ºjestå…¨å±€è¦†ç›–setTimeoutä»¥é¿å…é˜»å¡å•å…ƒæµ‹è¯•ã€‚</p><p id="d697" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ­¤æ—¶ï¼Œæµ‹è¯•çš„ç›®æ ‡æ˜¯æµ‹è¯•åŒ…å«åœ¨<code class="fe ls lt lu lv b">useForm</code>é’©å­ä¸­çš„æ‰€æœ‰ç‰¹æ€§ã€‚è¿™äº›æµ‹è¯•éªŒè¯ä»¥ä¸‹å†…å®¹:</p><ul class=""><li id="d61d" class="mi mj it js b jt ju jx jy kb nj kf nk kj nl kn mn mo mp mq bi translated">ä¼ å…¥<code class="fe ls lt lu lv b">useForm</code>çš„è¡¨å•çŠ¶æ€è¢«æ­£ç¡®è¿”å›</li><li id="a025" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">è‡ªå®šä¹‰<code class="fe ls lt lu lv b">onSubmit</code>å›è°ƒè¢«è°ƒç”¨</li><li id="dec1" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated"><code class="fe ls lt lu lv b">useForm</code>è¡¨å•æäº¤å‰åæ­£ç¡®è®¾ç½®æ•´ä½“ç•Œé¢çŠ¶æ€(<code class="fe ls lt lu lv b">isSubmitting</code> ) â€”é€‚ç”¨äºå¼‚æ­¥æäº¤</li><li id="757e" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">ç”±äºç«¯ç‚¹æ•…éšœè€Œå¯¼è‡´çš„æ‰¿è¯ºæ‹’ç»ç­‰é”™è¯¯å¾—åˆ°äº†å¦¥å–„å¤„ç†</li></ul><p id="984b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¿˜æœ‰å…¶ä»–å¯ä»¥ä¹Ÿåº”è¯¥åšçš„æµ‹è¯•ï¼Œæ¯”å¦‚éªŒè¯onSubmitå›è°ƒçš„å‚æ•°ã€‚éšç€APIçš„è¿›ä¸€æ­¥æ„å»ºï¼Œè¿™äº›å°†è¢«æ·»åŠ åˆ°å°†æ¥çš„éƒ¨åˆ†ä¸­</p><pre class="mw mx my mz gt na lv nb nc aw nd bi"><span id="ba07" class="lw kq it lv b gy ne nf l ng nh">import { renderHook, cleanup, act } from "react-hooks-testing-library";<br/>import { useForm } from "./use-form";</span><span id="9306" class="lw kq it lv b gy ni nf l ng nh">const noop = () =&gt; {};</span><span id="2588" class="lw kq it lv b gy ni nf l ng nh">jest.useFakeTimers();</span><span id="0098" class="lw kq it lv b gy ni nf l ng nh">describe("useForm tests", () =&gt; {<br/>  afterEach(cleanup);</span><span id="353e" class="lw kq it lv b gy ni nf l ng nh">it("should return empty form state", () =&gt; {<br/>    const { result } = renderHook(() =&gt; useForm());<br/>    const { getFormProps, formState } = result.current;<br/>    expect(getFormProps).toBeDefined();<br/>    expect(formState.values).toEqual({});<br/>  });</span><span id="631d" class="lw kq it lv b gy ni nf l ng nh">it("should return an initial formSummary", () =&gt; {<br/>    const { result } = renderHook(() =&gt; useForm());<br/>    const { getFormProps, formSummary } = result.current;<br/>    expect(getFormProps).toBeDefined();<br/>    expect(formSummary).toEqual({<br/>      isSubmitting: false<br/>    });<br/>  });</span><span id="3612" class="lw kq it lv b gy ni nf l ng nh">it("should support custom form props", () =&gt; {<br/>    const { result } = renderHook(() =&gt; useForm());<br/>    const { getFormProps } = result.current;<br/>    const formProps = getFormProps({ foo: "bar" });<br/>    expect(formProps.foo).toEqual("bar");<br/>  });</span><span id="7a35" class="lw kq it lv b gy ni nf l ng nh">it("should support custom onSubmit", async () =&gt; {<br/>    const { result } = renderHook(() =&gt; useForm());<br/>    const { getFormProps, formSummary } = result.current;</span><span id="35d6" class="lw kq it lv b gy ni nf l ng nh">const onSubmit = jest.fn();</span><span id="822c" class="lw kq it lv b gy ni nf l ng nh">const formProps = getFormProps({ onSubmit });<br/>    expect(formProps.onSubmit).toBeDefined();</span><span id="db05" class="lw kq it lv b gy ni nf l ng nh">// Could be some weirdness right now due to<br/>    // <a class="ae ko" href="https://github.com/facebook/react/issues/14769" rel="noopener ugc nofollow" target="_blank">https://github.com/facebook/react/issues/14769</a><br/>    act(() =&gt; {<br/>      formProps.onSubmit({ preventDefault: noop });<br/>    });<br/>    expect(formSummary).toEqual({<br/>      isSubmitting: false<br/>    });<br/>    expect(onSubmit).toHaveBeenCalledTimes(1);<br/>  });</span><span id="bca5" class="lw kq it lv b gy ni nf l ng nh">it("should support async onSubmit", async () =&gt; {<br/>    const { waitForNextUpdate, result } = renderHook(() =&gt; useForm());<br/>    const { getFormProps, formSummary } = result.current;</span><span id="5520" class="lw kq it lv b gy ni nf l ng nh">const onSubmit = evt =&gt;<br/>      new Promise(r =&gt; {<br/>        setTimeout(() =&gt; {<br/>          r();<br/>        }, 1000);<br/>      });</span><span id="b3ce" class="lw kq it lv b gy ni nf l ng nh">const formProps = getFormProps({ onSubmit });<br/>    expect(formProps.onSubmit).toBeDefined();</span><span id="0a83" class="lw kq it lv b gy ni nf l ng nh">// Could be some weirdness right now due to<br/>    // <a class="ae ko" href="https://github.com/facebook/react/issues/14769" rel="noopener ugc nofollow" target="_blank">https://github.com/facebook/react/issues/14769</a><br/>    act(() =&gt; {<br/>      formProps.onSubmit({ preventDefault: noop });<br/>    });<br/>    jest.runAllTimers();<br/>    expect(result.current.formSummary).toEqual({<br/>      isSubmitting: true<br/>    });<br/>    await waitForNextUpdate();<br/>    expect(formSummary).toEqual({<br/>      isSubmitting: false<br/>    });<br/>  });</span><span id="d5d5" class="lw kq it lv b gy ni nf l ng nh">it("should gracefully handle onSubmit errors", async () =&gt; {<br/>    const { result } = renderHook(() =&gt; useForm());<br/>    const { getFormProps, formSummary } = result.current;</span><span id="c098" class="lw kq it lv b gy ni nf l ng nh">const onSubmit = evt =&gt; new Error();</span><span id="e8ff" class="lw kq it lv b gy ni nf l ng nh">const formProps = getFormProps({ onSubmit });<br/>    expect(formProps.onSubmit).toBeDefined();</span><span id="2e83" class="lw kq it lv b gy ni nf l ng nh">// Could be some weirdness right now due to<br/>    // <a class="ae ko" href="https://github.com/facebook/react/issues/14769" rel="noopener ugc nofollow" target="_blank">https://github.com/facebook/react/issues/14769</a><br/>    act(() =&gt; {<br/>      formProps.onSubmit({ preventDefault: noop });<br/>    });<br/>    expect(formSummary).toEqual({<br/>      isSubmitting: false<br/>    });<br/>  });</span><span id="b0f3" class="lw kq it lv b gy ni nf l ng nh">it("should gracefully handle async onSubmit errors", async () =&gt; {<br/>    const { waitForNextUpdate, result } = renderHook(() =&gt; useForm());<br/>    const { getFormProps, formSummary } = result.current;</span><span id="e8d2" class="lw kq it lv b gy ni nf l ng nh">const onSubmit = evt =&gt;<br/>      new Promise((resolve, reject) =&gt; {<br/>        setTimeout(() =&gt; {<br/>          reject();<br/>        }, 1000);<br/>      });</span><span id="e0cd" class="lw kq it lv b gy ni nf l ng nh">const formProps = getFormProps({ onSubmit });<br/>    expect(formProps.onSubmit).toBeDefined();</span><span id="b348" class="lw kq it lv b gy ni nf l ng nh">// Could be some weirdness right now due to<br/>    // <a class="ae ko" href="https://github.com/facebook/react/issues/14769" rel="noopener ugc nofollow" target="_blank">https://github.com/facebook/react/issues/14769</a><br/>    act(() =&gt; {<br/>      formProps.onSubmit({ preventDefault: noop });<br/>    });<br/>    jest.runAllTimers();<br/>    expect(result.current.formSummary).toEqual({<br/>      isSubmitting: true<br/>    });<br/>    await waitForNextUpdate();<br/>    expect(formSummary).toEqual({<br/>      isSubmitting: false<br/>    });<br/>  });<br/>});</span></pre><h1 id="3b02" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">æ‘˜è¦</h1><p id="f5bb" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">åœ¨ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®¾è®¡äº†é«˜çº§çš„<code class="fe ls lt lu lv b">useForm</code>é’©å­ï¼Œè®¾æƒ³äº†å¦‚ä½•ä½¿ç”¨å®ƒï¼Œå¹¶åˆ›å»ºäº†ä¸€äº›åˆå§‹æµ‹è¯•ç”¨ä¾‹æ¥éªŒè¯<code class="fe ls lt lu lv b">useForm</code>é’©å­ã€‚</p><p id="6d3b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜ã€åé¦ˆæˆ–å»ºè®®ï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚</p><p id="1b75" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" href="https://medium.com/@shanplourde/react-hooks-designing-a-simple-forms-api-part-2-1fe5d12f23d9" rel="noopener">æœ¬ç³»åˆ—çš„ç¬¬2éƒ¨åˆ†å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°</a>ã€‚</p></div></div>    
</body>
</html>