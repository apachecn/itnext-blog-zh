# 2019 å¹´ååº”ä»£ç æ‹†åˆ†

> åŽŸæ–‡ï¼š<https://itnext.io/react-code-splitting-in-2019-9a5d2776c502?source=collection_archive---------3----------------------->

éƒ½ 2019 å¹´äº†ï¼æ¯ä¸ªäººéƒ½è®¤ä¸ºä»–ä»¬çŸ¥é“ä»£ç åˆ†è§£ã€‚æ‰€ä»¥â€”â€”è®©æˆ‘ä»¬ä»”ç»†æ£€æŸ¥ä¸€ä¸‹ï¼

![](img/77312c873eb773ad008c99a380723369.png)

[http://www.pacesettersinitiative.org/broken-pieces/](http://www.pacesettersinitiative.org/broken-pieces/)

# ä»£ç æ‹†åˆ†ä»£è¡¨ä»€ä¹ˆï¼Ÿ

ç®€è€Œè¨€ä¹‹ï¼Œä»£ç æ‹†åˆ†å°±æ˜¯ä¸åŠ è½½æ•´ä¸ªå…ƒç´ ï¼Œè€Œæ˜¯åªåŠ è½½å…¶ä¸­çš„ä¸€éƒ¨åˆ†ã€‚å½“ä½ é˜…è¯»è¿™ä¸ªé¡µé¢æ—¶ï¼Œä½ ä¸å¿…åŠ è½½æ•´ä¸ªç½‘ç«™ã€‚å½“æ‚¨ä»Žæ•°æ®åº“ä¸­é€‰æ‹©å•ä¸ªè¡Œæ—¶ï¼Œæ‚¨ä¸å¿…èŽ·å–æ‰€æœ‰æ•°æ®ã€‚*æ˜Žæ˜¾çš„*ï¼Ÿä»£ç åˆ†å‰²ä¹Ÿå¾ˆæ˜Žæ˜¾ï¼Œå®ƒä¸ä»…ä»…æ˜¯å…³äºŽä½ çš„æ•°æ®ï¼Œè€Œæ˜¯ä½ çš„ä»£ç ã€‚

# æ˜¯è°åœ¨åšä»£ç æ‹†åˆ†ï¼Ÿ

ååº”ã€‚æ‡’æƒ°ï¼Ÿä¸ï¼Œå®ƒåªæ˜¯åœ¨ä½¿ç”¨å®ƒã€‚ä»£ç æ‹†åˆ†æ˜¯åœ¨æ†ç»‘çº§åˆ«å®Œæˆçš„â€”â€”ç½‘ç»œåŒ…ã€åŒ…ï¼Œæˆ–è€…åœ¨â€œæœ¬æœºâ€esm æ¨¡å—çš„æƒ…å†µä¸‹ï¼Œåªæ˜¯æ‚¨çš„æ–‡ä»¶ç³»ç»Ÿã€‚ä»£ç åˆ†å‰²åªæ˜¯æ–‡ä»¶ï¼Œä½ å¯ä»¥â€œä»¥åŽâ€åœ¨æŸä¸ªåœ°æ–¹åŠ è½½çš„æ–‡ä»¶ã€‚

# è°åœ¨ä½¿ç”¨ä»£ç åˆ†å‰²ï¼Ÿ

`React.lazy`æ­£åœ¨ä½¿ç”¨å®ƒã€‚åªæ˜¯**ä½¿ç”¨**ä½ çš„æ†ç»‘å™¨çš„ä»£ç åˆ†å‰²ã€‚åœ¨æ¸²æŸ“æ—¶è°ƒç”¨`import`ã€‚ä»…æ­¤è€Œå·²ã€‚

# React-loadable æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

`React.lazy`å–è€Œä»£ä¹‹ã€‚å¹¶ä¸”æä¾›äº†æ›´å¤šçš„åŠŸèƒ½ï¼Œåƒ`Suspense`æ¥æŽ§åˆ¶åŠ è½½çŠ¶æ€ã€‚æ‰€ä»¥â€”â€”ç”¨`React.Lazy`ä»£æ›¿ã€‚

> æ˜¯çš„ï¼Œå°±è¿™äº›ã€‚æ„Ÿè°¢æ‚¨çš„é˜…è¯»ï¼Œç¥æ‚¨æ„‰å¿«ã€‚

# ä¸ºä»€ä¹ˆæ–‡ç« è¿˜æ²¡å†™å®Œï¼Ÿ

å—¯â€¦â€¦æœ‰ä¸€äº›å…³äºŽ React.lazy å’Œä»£ç åˆ†å‰²çš„ç°è‰²åœ°å¸¦ï¼Œæˆ‘å¿˜äº†è¯´äº†ã€‚

# ç°è‰²åŒºåŸŸ 1â€“æµ‹è¯•

æµ‹è¯•â€œReact.lazyâ€å¹¶ä¸å®¹æ˜“ï¼Œå› ä¸ºå®ƒçš„*å¼‚æ­¥ç‰¹æ€§*ã€‚`mount(MyLazyComponent)`çš„ç»“æžœåªä¼šæ˜¯â€œç©ºâ€ï¼Œåªè¦ `MyLazy`åŽé¢çš„`Component`ã€*ï¼Œå°±æ˜¯**è¿˜æ²¡æœ‰åŠ è½½ã€‚****å³ä½¿æ˜¯â€”â€”`import`è¿”å›žï¼Œ`lazy`æŽ¥å—ï¼Œ**æ‰¿è¯º**ï¼Œæ€»æ˜¯åœ¨**ä¸‹ä¸€ä¸ªæ»´ç­”**æ‰§è¡Œã€‚æ‰€ä»¥â€”â€”ä½ æ°¸è¿œä¸ä¼šåœ¨**å½“å‰èŠ‚æ‹**ä¸­å¾—åˆ°åˆ†é‡ã€‚è¿™æ˜¯æ³•å¾‹ï¼***

```
const LazyComponent = lazy(() => import('/path/to/dynamic/component'));
const Fallback = () => <div />;
const SuspenseComponent = () => (
    <Suspense fallback={<Fallback />}>
      <LazyComponent />
    </Suspense>
);const wrapper = mount(<SuspenseComponent />)
expect(wrapper.find('Fallback')).to.have.lengthOf(1)
expect(wrapper.find('DynamicComponent')).to.have.lengthOf(0)
// ^ not loaded**await wrapper.waitUntilLazyLoaded()**expect(wrapper.find('Fallback')).to.have.lengthOf(0)
expect(wrapper.find('DynamicComponent')).to.have.lengthOf(1)
// ^ loaded!
```

**å»ºè®®çš„è§£å†³æ–¹æ¡ˆï¼Ÿä½ å¯èƒ½ä¸ç›¸ä¿¡ï¼Œä½†å»ºè®®çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨**åŒæ­¥æ ‡ç­¾**ã€‚**

**[](https://github.com/facebook/react/pull/14626) [## gaearon Pull è¯·æ±‚#14626 facebook/react æ”¯æŒä¸º lazy()åŒæ­¥åç§°

### ä¸ºä»€ä¹ˆä¸å‘¢ï¼Ÿç›®å‰ï¼Œç”±äºŽç«žäº‰æ¡ä»¶(çŠ¶æ€è®¾ç½®ä¸ºâ€œå·²è§£å†³â€,ä½†æ˜¯â€¦â€¦,å®ƒä»¬ä¼šå› ä¸€ä¸ªä»¤äººå›°æƒ‘çš„é”™è¯¯è€Œå¤±è´¥

github.com](https://github.com/facebook/react/pull/14626) 

```
const LazyText = lazy(() => ({
   **then**(cb) {   
      cb({default: Text});
      // this is "sync" thenable
   },
})); const root = ReactTestRenderer.create(
  <Suspense fallback={<Text text="Loading..." />}>          
     <LazyText text="Hi" /> // this lazy is not very lazy
  </Suspense>,
);
```

å°†å¯¼å…¥å‡½æ•°è½¬æ¢æˆè®°å¿†çš„åŒæ­¥åç§°å¹¶ä¸å›°éš¾ã€‚

```
const syncImport = (importFn) => {
   let preloaded = undefined;
   const promise = importFn().then(module => preloaded = module);
   // ^ "auto" import and "cache" promise      return () => preloaded ? { then: () => preloaded } : promise;
   // ^ return sync thenable then possible
}const lazyImport = isNode ? syncImport : a => a; 
// ^ sync for node, async for browserconst LazyComponent = React.lazy(lazyImport(() => import('./file'));
```

# ç°è‰²åŒºåŸŸ 2â€“SSR

> å¦‚æžœä½ ä¸éœ€è¦ SSR è¯·ç»§ç»­é˜…è¯»æ–‡ç« ï¼

`React.lazy`æ˜¯ SSR å‹å¥½çš„ã€‚ä½†æ˜¯å®ƒéœ€è¦`Suspense`æ‰èƒ½å·¥ä½œï¼Œ`Suspense`æ˜¯**è€Œä¸æ˜¯**æœåŠ¡å™¨ç«¯å‹å¥½çš„ã€‚

æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆ:

*   æŠŠ`Suspense`æ¢æˆ`Fragment`ï¼Œåªæ˜¯**æ¨¡ä»¿**å‡ºæ¥ã€‚ç„¶åŽ-ä½¿ç”¨æ”¹å˜ç‰ˆæœ¬åŒæ­¥`thenable`ä½¿æ‡’æƒ°ä¹ŸåŒæ­¥ã€‚

```
import React from 'react';const realLazy = React.lazy;
React.lazy = importer => realLazy(syncImport(importer));
React.Suspense = React.Fragment; // :P// ^ React SSR just got fixed.
```

è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œä½†æ˜¯å®ƒå¯¹å®¢æˆ·ç«¯ä¸å¤ªå‹å¥½ã€‚ä¸ºä»€ä¹ˆï¼Ÿè®©æˆ‘ä»¬å®šä¹‰ç¬¬äºŒç§å¯èƒ½çš„è§£å†³æ–¹æ¡ˆ:

*   **ä½¿ç”¨ä¸“é—¨çš„åº“**æ¥è·Ÿè¸ªä½¿ç”¨è¿‡çš„è„šæœ¬ã€ç»„å—å’Œæ ·å¼ï¼Œå¹¶åœ¨å®¢æˆ·ç«¯åŠ è½½å®ƒä»¬(å°¤å…¶æ˜¯æ ·å¼ï¼)åœ¨è¿›è¡Œæ°´åˆååº”ä¹‹å‰ã€‚å¦åˆ™â€”â€”ä½ ä¼šå‘ˆçŽ°å‡ºç©ºæ´žï¼Œè€Œä¸æ˜¯ä»£ç åˆ†ç¦»çš„ç»„ä»¶ã€‚å†ä¸€æ¬¡ï¼Œä½ æ²¡æœ‰åŠ è½½ä½ åˆšåˆšåˆ†å‰²çš„ä»£ç ï¼Œæ‰€ä»¥ä½ ä¸èƒ½æ¸²æŸ“ä»»ä½•ä½ å°†è¦æ¸²æŸ“çš„ä¸œè¥¿ã€‚

## çœ‹çœ‹ä»£ç åˆ†å‰²åº“

*   [é€šç”¨ç»„ä»¶](https://www.npmjs.com/package/react-universal-component)â€”â€”æœ€å¤è€ä¸”ä»å¯ç»´æŠ¤çš„åº“ã€‚å®ƒâ€œå‘æ˜Žâ€äº†ä»£ç åˆ†å‰²ï¼Œå¹¶æ•™ä¼šäº† Webpack ä»£ç åˆ†å‰²ã€‚
*   [React-loadable](https://www.npmjs.com/package/react-loadable)â€“**éžå¸¸å—æ¬¢è¿Žï¼Œä½†æ˜¯æ²¡æœ‰ç»´æŠ¤çš„åº“ã€‚è®©ä»£ç åæ§½æˆä¸ºä¸€ä»¶æµè¡Œçš„äº‹æƒ…ã€‚é—®é¢˜æ˜¯å°é—­çš„ï¼Œæ‰€ä»¥å‘¨å›´æ²¡æœ‰ç¤¾åŒºã€‚**
*   å¯åŠ è½½ç»„ä»¶â€“ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„åº“ï¼Œä½¿ç”¨èµ·æ¥å¾ˆæ„‰å¿«ï¼Œæ‹¥æœ‰æœ€æ´»è·ƒçš„ç¤¾åŒºã€‚
*   [å¯¼å…¥ç»„ä»¶](https://www.npmjs.com/package/react-imported-component)â€“å•ä¸ªåº“ï¼Œä¸ç»‘å®šåˆ° Webpackï¼Œå³èƒ½å¤Ÿå¤„ç†åŒ…è£¹æˆ– esmã€‚
*   [React-async-component](https://www.npmjs.com/package/react-async-component)â€“å·²ç»æ­»äº†çš„åº“(ä½†ä»ç„¶å¾ˆæµè¡Œ)ï¼Œå®ƒå¯¹ä»£ç åˆ†å‰²ã€è‡ªå®šä¹‰ React æ ‘éåŽ†å’Œ SSR çš„æ‰€æœ‰æ–¹é¢éƒ½äº§ç”Ÿäº†é‡å¤§å½±å“ã€‚
*   *å¦ä¸€ä¸ªåº“â€”****æœ‰*** *è®¸å¤šåº“ï¼Œå…¶ä¸­è®¸å¤šæ²¡æœ‰é€šè¿‡ Webpack evolution æˆ– React 16â€”â€”æˆ‘æ²¡æœ‰åœ¨è¿™é‡Œåˆ—å‡ºå®ƒä»¬ï¼Œä½†æ˜¯å¦‚æžœä½ çŸ¥é“ä¸€ä¸ªå¥½çš„å€™é€‰åº“â€”â€”å°±ç»™æˆ‘å‘é‚®ä»¶ã€‚*

# é€‰å“ªä¸ªå›¾ä¹¦é¦†ï¼Ÿ

å®ƒå¾ˆç®€å•â€”â€”ä¸æ˜¯ååº”å¼åŠ è½½çš„â€”â€”å®ƒå¾ˆéš¾ç»´æŠ¤ï¼Œè€Œä¸”å·²ç»è¿‡æ—¶ï¼Œå³ä½¿å®ƒä»ç„¶å¾ˆæµè¡Œã€‚*(å†æ¬¡æ„Ÿè°¢ä½ æŽ¨å¹¿ä»£ç åˆ†å‰²)*

*   å¯åŠ è½½ç»„ä»¶â€“å¯èƒ½æ˜¯ä¸€ä¸ªéžå¸¸å¥½çš„é€‰æ‹©ã€‚å®ƒå†™å¾—å¾ˆå¥½ï¼Œç§¯æžç»´æŠ¤ï¼Œæ”¯æŒå¼€ç®±å³ç”¨çš„ä¸€åˆ‡ã€‚æ”¯æŒâ€œå…¨åŠ¨æ€å¯¼å…¥â€ï¼Œå…è®¸ä½ æ ¹æ®ç»™å®šçš„é“å…·å¯¼å…¥æ–‡ä»¶ï¼Œä½†æ˜¯*ä¸å¯ç±»åž‹åŒ–*ã€‚**æ”¯æŒæš‚åœ**ï¼Œæ‰€ä»¥å¯ä»¥æ›¿æ¢`React.lazy`ã€‚
*   **é€šç”¨ç»„ä»¶**â€”â€”å®žé™…ä¸Šæ˜¯å®Œå…¨åŠ¨æ€å¯¼å…¥çš„â€œå‘æ˜Žè€…â€â€”â€”åªè¦**ä»–ä»¬åœ¨ Webpack** ä¸­å®žçŽ°äº†å®ƒã€‚è¿˜æœ‰è®¸å¤šå…¶ä»–ä½Žå±‚æ¬¡çš„ä¸œè¥¿ï¼Œåƒ *css è¯­å—ã€æŠ¥å‘Šè¯­å—å’Œå…¶ä»–è¯­å—*â€“**ä»–ä»¬åšåˆ°äº†**ã€‚è¿™ä¸ªåº“çš„ä½œè€…ä¹Ÿæ˜¯ webpack å›¢é˜Ÿçš„æˆå‘˜ã€‚æˆ‘ä¼šè¯´â€”â€”è¿™ä¸ªåº“æœ‰ç‚¹ç¡¬ï¼Œæœ‰ç‚¹ä¸å¤ªç”¨æˆ·å‹å¥½ã€‚å¯åŠ è½½ç»„ä»¶æ–‡æ¡£æ˜¯æ— ä¸Žä¼¦æ¯”çš„ã€‚å¦‚æžœä¸ä½¿ç”¨è¿™ä¸ªåº“ï¼Œé‚£ä¹ˆé˜…è¯»æ–‡æ¡£æ˜¯å€¼å¾—çš„â€”â€”æœ‰å¾ˆå¤šç»†èŠ‚ä½ åº”è¯¥çŸ¥é“â€¦
*   **React-imported-component**â€“æœ‰ç‚¹*å¤æ€ª*ã€‚å®ƒæ˜¯ *bundler ç‹¬ç«‹çš„*ï¼Œæ‰€ä»¥å®ƒæ°¸è¿œä¸ä¼šå(æ²¡æœ‰ä»€ä¹ˆå¯åçš„)ï¼Œå¯ä»¥ä¸Ž Webpack 5 å’Œ 55 ä¸€èµ·å·¥ä½œï¼Œä½†æ˜¯**æœ‰ä¸€ä¸ªæˆæœ¬**ã€‚ä¸æ”¯æŒå®Œå…¨åŠ¨æ€å¯¼å…¥ï¼Œå¦‚`React.lazy`ï¼Œå› æ­¤æ˜¯å¯ç±»åž‹åŒ–çš„ã€‚å¦å¤–**æ”¯æŒæ‚¬å¿µ**ã€‚åœ¨ SSR ä¸Šä½¿ç”¨`synchronous thenables`ã€‚å®ƒä¹Ÿæœ‰å®Œå…¨ä¸åŒçš„ CSS æ–¹æ³•ï¼Œå’Œå®Œç¾Žçš„**æµæ¸²æŸ“**æ”¯æŒã€‚

ä¹Ÿè®¸è§£é‡Šè¿™ä¸ªåº“çš„â€œæˆæœ¬â€æ›´å¥½â€”â€”ç®€è€Œè¨€ä¹‹â€”â€”å®ƒå¯èƒ½ä¼šæŽ¨è¿Ÿ TTI(äº¤äº’æ—¶é—´)ã€‚

SSR æœŸé—´çš„â€œæ™®é€šâ€åº“ä¼šå°†æ‰€æœ‰ä½¿ç”¨è¿‡çš„è„šæœ¬æ·»åŠ åˆ°é¡µé¢ä¸»ä½“ï¼Œå¹¶ä¸”æ‚¨å°†èƒ½å¤Ÿ**ä»¥å¹¶è¡Œæ–¹å¼**åŠ è½½æ‰€æœ‰è„šæœ¬ï¼Œå¹¶ä¸”ä¸€æ—¦å®ƒä»¬éƒ½å‡†å¤‡å¥½äº†ï¼Œå°±â€œæ°´åˆâ€æ‚¨çš„åº”ç”¨ç¨‹åºã€‚

> TTI ä¼šæ˜¯`max(mainTime, chunk1Time, chunk2Time)`

`imported`æ˜¯â€œbunder-independentâ€ï¼Œè€Œ**ä¸çŸ¥é“**è¦åŠ è½½çš„æ–‡ä»¶åã€‚å› æ­¤ï¼Œå®ƒå°†é¦–å…ˆç­‰å¾…ä¸»åŒ…åŠ è½½ï¼Œç„¶åŽä»Žä¸»åŒ…å†…éƒ¨è°ƒç”¨åŽŸæ¥çš„â€œ`imports`â€ï¼Œè®©`bundler`åŠ è½½å—ï¼Œå°±åƒåœ¨ç®€å•çš„`React.lazy`ä¸­ä¸€æ ·ã€‚è¿™æ˜¯ä¸€ä¸ªéžå¸¸å¯é çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯ï¼Œä½ å¿…é¡»å…ˆè£…è½½ä¸»æ†æ‰Žæœºã€‚

> TTI ä¼šæ˜¯`mainTime + max(chunk1Time, chunk2Time)`

è€Œä¸”ï¼Œè¯´å®žè¯ï¼Œ^that^å¯èƒ½åªæ¯” t43 æ…¢ä¸¤å€ t44ã€‚

é™¤äº†ä¸€äº›å®žçŽ°ç»†èŠ‚â€”â€”åˆ—å‡ºçš„åº“åœ¨è´¨é‡æˆ–å—æ¬¢è¿Žç¨‹åº¦ä¸Šæ²¡æœ‰åŒºåˆ«ï¼Œæˆ‘ä»¬éƒ½æ˜¯å¥½æœ‹å‹â€”â€”æ‰€ä»¥ç”¨å¿ƒæŒ‘é€‰ä¸€ä¸ªå§ã€‚

[](https://github.com/smooth-code/loadable-components) [## å¹³æ»‘ä»£ç /å¯åŠ è½½ç»„ä»¶

### ååº”ä»£ç åˆ†è£‚ä½¿âœ‚ï¸âœ¨.å˜å¾—å®¹æ˜“é€šè¿‡åœ¨â€¦ä¸Šåˆ›å»ºå¸æˆ·ï¼Œä¸ºå¹³æ»‘ä»£ç /å¯åŠ è½½ç»„ä»¶çš„å¼€å‘åšå‡ºè´¡çŒ®

github.com](https://github.com/smooth-code/loadable-components) [](https://github.com/theKashey/react-imported-component) [## kashey/react-å¯¼å…¥ç»„ä»¶

### é€‚ç”¨äºŽä»»ä½•å»¶è¿Ÿç»„ä»¶çš„ç‹¬ç«‹äºŽ Bundler çš„è§£å†³æ–¹æ¡ˆï¼Œå¯å®žçŽ°æ›´å¥½çš„ SSRã€ä»£ç åˆ†å‰²å’Œ React-Hot-Loaderã€‚æ²¡æœ‰âœ¨â€¦

github.com](https://github.com/theKashey/react-imported-component) [](https://github.com/faceyspacey/react-universal-component) [## é¢ç©ºé—´/ååº”é€šç”¨ç»„ä»¶

### ðŸš€React é€šç”¨ç»„ä»¶çš„æœ€ç»ˆç­”æ¡ˆ:åŒæ­¥ SSR +ä»£ç æ‹†åˆ†â€¦

github.com](https://github.com/faceyspacey/react-universal-component) 

# ç°è‰²åŒºåŸŸ 3â€“æ··åˆæ¸²æŸ“

SSR æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œä½†æ˜¯ä½ çŸ¥é“å¾ˆéš¾ã€‚å°é¡¹ç›®å¯èƒ½å¸Œæœ›æœ‰ä¸€ä¸ª SSRâ€”â€”æœ‰å¾ˆå¤šç†ç”±éœ€è¦å®ƒâ€”â€”ä½†ä¸æƒ³å»ºç«‹å’Œç»´æŠ¤å®ƒã€‚

> SSR å¯èƒ½ä¼šéžå¸¸éžå¸¸éš¾ã€‚å¦‚æžœä½ æƒ³å¿«é€Ÿå–èƒœï¼Œè¯•è¯• razzle æˆ– Next.jsã€‚

å› æ­¤ï¼ŒSSR æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆï¼Œå°¤å…¶æ˜¯ç®€å•çš„ SPAï¼Œåº”è¯¥æ˜¯**é¢„æ¸²æŸ“**ã€‚æ¯”å¦‚åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ä½ çš„ SPAï¼Œç‚¹å‡»â€œä¿å­˜â€æŒ‰é’®ã€‚æ¯”å¦‚:

*   [React-snap](https://github.com/stereobooster/react-snap) â€”ä½¿ç”¨[æœ¨å¶å¸ˆ](https://github.com/GoogleChrome/puppeteer)åœ¨â€œæµè§ˆå™¨â€ä¸­æ¸²æŸ“ä½ çš„é¡µé¢å¹¶ä¿å­˜ç»“æžœ
*   Rendertronâ€”â€”åšåŒæ ·çš„äº‹æƒ…ï¼Œä½†æ˜¯ä»¥ä¸åŒçš„æ–¹å¼(åœ¨è°·æ­Œäº‘ä¸­)ã€‚

é¢„æ¸²æŸ“æ˜¯æ²¡æœ‰â€œæœåŠ¡å™¨â€çš„â€œSSRâ€ã€‚æ˜¯ SSR ä½¿ç”¨å®¢æˆ·ç«¯ã€‚ç¥žå¥‡ï¼å¼€ç®±å³ç”¨â€¦ â€¦ä½†ä¸æ˜¯ä¸ºäº†ä»£ç åˆ†ç¦»ã€‚

æ‰€ä»¥â€”â€”æ‚¨åªéœ€åœ¨æµè§ˆå™¨ä¸­å‘ˆçŽ°æ‚¨çš„é¡µé¢ï¼Œä¿å­˜ HTMLï¼Œå¹¶è¯·æ±‚åŠ è½½ç›¸åŒçš„å†…å®¹ã€‚ä½†æ˜¯**æœåŠ¡å™¨ç«¯ç‰¹å®šä»£ç **(æ”¶é›†æ‰€æœ‰ä½¿ç”¨è¿‡çš„å—)æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œå› ä¸º**æ²¡æœ‰æœåŠ¡å™¨**ï¼

![](img/01ff08eaaeb4d159e68ad4244e159fd0.png)

ååº”å¿«ç…§æ–‡æ¡£

åœ¨ä¸Šä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘æŒ‡å‡ºäº†åœ¨æ”¶é›†å…³äºŽä½¿ç”¨çš„å—çš„ä¿¡æ¯æ–¹é¢ç»‘å®šåˆ° webpack çš„åº“â€”â€”å®ƒä»¬æ ¹æœ¬ä¸èƒ½å¤„ç†æ··åˆæ¸²æŸ“ã€‚

> react-snap éƒ¨åˆ†æ”¯æŒå¯åŠ è½½ç»„ä»¶ç‰ˆæœ¬ 2(ä¸Žå½“å‰ç‰ˆæœ¬ 5 ä¸å…¼å®¹)ã€‚æ”¯æŒæ²¡æœ‰äº†ã€‚

å¯ä»¥å¤„ç†è¿™ç§æƒ…å†µï¼Œåªè¦å®ƒä¸å—æ†ç»‘è€…/ä¸€æ–¹çš„çº¦æŸã€‚æ‰€ä»¥æ²¡æœ‰åŒºåˆ«â€”â€”ä¸ç®¡æ˜¯ SSR è¿˜æ˜¯ Hybridâ€”â€”å®ƒç”šè‡³å¯ä»¥åœ¨æ··åˆæ¨¡å¼ä¸‹å·¥ä½œï¼Œä½†åªé€‚ç”¨äºŽ`react-snap`å¯ä»¥æä¾›çš„æ··åˆæ¨¡å¼ï¼Œåªè¦å®ƒä¸º*â€œçŠ¶æ€æ°´åˆâ€*æä¾›ä¸€äº›é’©å­ï¼Œè€Œ`rendertron`åªæ˜¯*æ¸²æŸ“ä¸€åˆ‡*ã€‚

> å†™è¿™ç¯‡æ–‡ç« æ—¶å‘çŽ°äº†`react-imported-componen`ä½¿ç”¨ react-snap çš„èƒ½åŠ›ï¼Œåœ¨ â€” [è§ç¤ºä¾‹](https://github.com/theKashey/react-imported-component/tree/master/examples/hybrid/react-snap)ä¹‹å‰**å¹¶ä¸çŸ¥é“ã€‚è¿™å¾ˆå®¹æ˜“ã€‚**

è¿™é‡Œä½ ä¸å¾—ä¸ä½¿ç”¨å¦ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œå®ƒåªæ˜¯**åž‚ç›´äºŽ**æ‰€æœ‰å…¶ä»–çš„åº“ã€‚

## ååº”é¢„æ¸²æŸ“ç»„ä»¶

è¿™ä¸ªåº“æ˜¯ä¸º*éƒ¨åˆ†æ°´åˆ*è€Œåˆ›å»ºçš„ï¼Œå¯ä»¥éƒ¨åˆ†å†æ°´åˆä½ çš„åº”ç”¨ï¼Œä¿æŒå…¶ä½™éƒ¨åˆ†ä»ç„¶*è„±æ°´*ã€‚å®ƒé€‚ç”¨äºŽ SSR å’Œæ··åˆæ¸²æŸ“å™¨ï¼Œæ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚

è¿™ä¸ªæƒ³æ³•å¾ˆç®€å•:

*   åœ¨ SSR æœŸé—´â€”â€”æ¸²æŸ“ç»„ä»¶ï¼Œç”¨åŒ…è£…
*   åœ¨å®¢æˆ·ç«¯â€”â€”æ‰¾åˆ°é‚£ä¸ª divï¼Œä½¿ç”¨`innerHTML`,ç›´åˆ°`Component`å‡†å¤‡å¥½æ›¿æ¢*æ­»çš„* HTMLã€‚
*   æ‚¨ä¸å¿…åŠ è½½ï¼Œå¹¶ç­‰å¾…å¸¦æœ‰åˆ†å‰²ç»„ä»¶çš„å—åŠ è½½åˆ°`"NOT render a *white hole* instead of it"`â€”â€”ä½¿ç”¨é¢„å…ˆå‘ˆçŽ°çš„ HTMLã€‚ä½ ä»ŽæœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ä»£ç å·²ç»åŒ…å«äº†ä½ éœ€è¦æ˜¾ç¤ºçš„æ‰€æœ‰ HTMLã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¿…é¡»åœ¨`hydrate`ä¹‹å‰ç­‰å¾…æ‰€æœ‰çš„å—åŠ è½½â€”â€”ä»¥åŒ¹é…æœåŠ¡å™¨æ¸²æŸ“çš„ HTMLã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æœåŠ¡å™¨æ¸²æŸ“çš„ HTML ç‰‡æ®µï¼Œç›´åˆ°å®¢æˆ·ç«¯æ²¡æœ‰å‡†å¤‡å¥½ã€‚

> è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¿…é¡»åœ¨ hydrate ä¹‹å‰ç­‰å¾…æ‰€æœ‰æ•°æ®å—åŠ è½½å®Œæ¯•ï¼Œä»¥åŒ¹é…æœåŠ¡å™¨å‘ˆçŽ°çš„ HTMLã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æœåŠ¡å™¨æ¸²æŸ“çš„ HTML ç‰‡æ®µï¼Œç›´åˆ°å®¢æˆ·ç«¯æ²¡æœ‰å‡†å¤‡å¥½â€”â€”å®ƒç›¸å½“äºŽæˆ‘ä»¬åªå‡†å¤‡ç”Ÿäº§çš„ä¸€ä¸ªã€‚

```
import {PrerenderedComponent} from 'react-prerendered-component';const importer = memoizeOne(() => import('./Component'));
// ^ it's very important to keep the "one" promiseconst Component = React.lazy(importer); 
// or use any other library with ".prefetch" support
// all libraries has it (more or less)const App = () => (
  <PrerenderedComponent live={importer()}> 
   {/* ^ shall return the same promise */ }
    <Component /> 
   {/* ^ would be rendered when component goes "live" */ }
  </PrerenderedComponent>
);
```

è¿˜æœ‰å¦ä¸€ç¯‡å…³äºŽå®ƒçš„æ–‡ç« ï¼Œä»¥å‰å†™çš„ï¼Œæ²¡æœ‰æ··åˆæ¸²æŸ“çš„æƒ³æ³•:

[](https://medium.com/@antonkorzunov/react-server-side-code-splitting-made-again-a61f8cbbd64b) [## React æœåŠ¡å™¨ç«¯ä»£ç æ‹†åˆ†å·²å®Œæˆ..åˆ

### React ä»£ç æ‹†åˆ†åœ¨ä¸€å¹´å‰å°±æˆä¸ºäº†ä¸€ä»¶äº‹ã€‚ä»Žé‚£æ—¶èµ·ï¼Œæˆ‘ä»¬æ­£åœ¨å¯»æ‰¾æ–°çš„æ–¹æ³•æ¥ä»£ç åˆ†å‰²å’Œå»¶è¿Ÿç»„ä»¶â€¦

medium.com](https://medium.com/@antonkorzunov/react-server-side-code-splitting-made-again-a61f8cbbd64b) 

# TLDRï¼Ÿ

*   ä¸è¦ä½¿ç”¨ react-loadableï¼Œå®ƒä¸ä¼šå¢žåŠ ä»»ä½•æœ‰ä»·å€¼çš„ä»·å€¼
*   æ‡’æƒ°æ˜¯å¥½çš„ï¼Œä½†æ˜¯å¤ªç®€å•äº†ã€‚
*   SSR æ˜¯ä¸€ä»¶å¾ˆéš¾çš„äº‹æƒ…ï¼Œä½ åº”è¯¥çŸ¥é“
*   æ··åˆæœ¨å¶å¸ˆé©±åŠ¨çš„æ¸²æŸ“æ˜¯ä¸€ä»¶äº‹ã€‚æœ‰æ—¶ç”šè‡³æ›´éš¾çš„äº‹æƒ…ã€‚

è¯·å°† kudos å‘é€è‡³:

[ä¼¯æ ¼Â·æ ¼é›·æ ¼](https://medium.com/u/2210cd491fe0?source=post_page-----9a5d2776c502--------------------------------) â€”å¯åŠ è½½ç»„ä»¶ä½œè€…

Sean Mathesonâ€”react-async-component(å³ä½¿ä»–ä»¬æœ‰ç‚¹æ­»)

è©¹å§†æ–¯Â·å‰å°”æ‘©å’Œ[æ‰Žå…‹Â·æ°å…‹æ£®](https://medium.com/u/9ef1379caffc?source=post_page-----9a5d2776c502--------------------------------)â€”â€”é€šç”¨éƒ¨ä»¶çš„åˆ›é€ è€…

[Anton Korzunov](https://medium.com/u/742f2d568062?source=post_page-----9a5d2776c502--------------------------------) â€”é’ˆå¯¹ react-imported å’Œ prerendered ç»„ä»¶

ä»¥åŠæ‰€æœ‰é‚£äº›å‘æ˜Žæ–°æ–¹æ³•å’Œæ–°åŽŸåˆ™çš„äººï¼Œä»–ä»¬ä½¿æˆ‘ä»¬çš„ç”Ÿæ´»æœ‰æ—¶æ›´å®¹æ˜“ï¼Œæœ‰æ—¶æ›´å›°éš¾ã€‚

> è¿˜åœ¨ä¸º React é«˜å…´æ‡’ï¼Ÿ
> 
> å¾ˆé…·ï¼Œä½†æˆ‘ä»¬å¿…é¡»æ›´æ·±å…¥ã€‚**