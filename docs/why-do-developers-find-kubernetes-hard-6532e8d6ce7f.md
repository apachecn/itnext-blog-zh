# ä¸ºä»€ä¹ˆå¼€å‘è€…è¿™ä¹ˆéš¾æ‰¾åˆ° Kubernetesï¼Ÿ

> åŸæ–‡ï¼š<https://itnext.io/why-do-developers-find-kubernetes-hard-6532e8d6ce7f?source=collection_archive---------0----------------------->

![](img/a5c1a636e190f4dbefb8b0dee495c827.png)

[æ½˜äº‘æ³¢](https://unsplash.com/@panyunbo?utm_source=medium&utm_medium=referral)åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹ç…§

## Crossplane Kubernetes æä¾›å•†å¦‚ä½•æä¾›å¸®åŠ©

è¿™ç¯‡æ–‡ç« å°†å¯¹ä»»ä½•å¯¹ç°ä»£å¤æ‚è½¯ä»¶å¼€å‘æ„Ÿå…´è¶£çš„äººæœ‰æ‰€å¸®åŠ©ã€‚

å¯¹äºä½¿ç”¨è¿™ä¸ª[è‡ªå®šæ­¥è°ƒçš„ Katacoda åœºæ™¯](https://www.katacoda.com/decoder/scenarios/crossplane-k8s-provider)çš„å®é™…æ¼”ç»ƒï¼Œè¯·æŸ¥çœ‹è¿™ä¸ªé™„å¸¦çš„è§†é¢‘ï¼Œå…¶ä¸­æœ‰äº¤å‰å¹³é¢åŸºç¡€çŸ¥è¯†å’Œ Kubernetes æä¾›å•†çš„æŒ‡å¯¼ä¹‹æ—…ã€‚

æœ‰å¯¼æ¸¸çš„ Katacoda åœºæ™¯æ¸¸è§ˆ

## ç°ä»£å‘å±•æŒ‘æˆ˜

å¼€å‘è€…éœ€è¦äº†è§£å¤šå°‘ Kubernetesï¼Ÿâ€œå·¦ç§»â€æ˜¯å¦æ„å‘³ç€ä¸»è¦ç„¦ç‚¹ä¹‹å¤–çš„å·¥å…·å’Œæ¡†æ¶çš„ä¸æ–­æ‰©å±•çš„è¯¾ç¨‹ï¼›è½¯ä»¶å¼€å‘ï¼Ÿ

è¿‡å»çš„ä½“ç³»ç»“æ„ä¾èµ–äºå¼€å‘ã€è¿è¥ã€å®‰å…¨å’Œå…¶ä»–åˆ©ç›Šç›¸å…³æ–¹ä¹‹é—´çš„å­¤å²›å’Œå¤æ‚çš„ç§»äº¤æµç¨‹ã€‚ç°ä»£ DevOps å®è·µé¼“åŠ±æˆ‘ä»¬â€œå·¦ç§»â€ï¼Œæ‹¥æŠ±â€œä½ å»ºé€ å®ƒï¼Œä½ è¿è¡Œå®ƒâ€çš„å¿ƒæ€ã€‚éšç€å­¤å²›ä¹‹é—´çš„è¾¹ç•Œå˜å¾—æ¨¡ç³Šï¼Œç§»äº¤ç‚¹å˜å¾—è¶Šæ¥è¶Šè‡ªåŠ¨åŒ–ï¼Œå¼€å‘äººå‘˜éœ€è¦å­¦ä¹ å’Œäº†è§£æ¯”ä»¥å¾€æ›´å¤šçš„çŸ¥è¯†ï¼Œä»¥å®Œå…¨æ”¯æŒä»–ä»¬æ‰€è´Ÿè´£çš„äº§å“çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚

å¼€å‘å›¢é˜Ÿå˜æˆäº†å¤šå­¦ç§‘çš„â€œå°å…¬å¸â€,å¯ä»¥ä¸ºéå¸¸å°çš„é¡¹ç›®å·¥ä½œï¼Œä½†æ˜¯ä¸èƒ½æ‰©å±•åˆ°ä¸­ç­‰è§„æ¨¡ã€‚æˆ‘ä»¬å¦‚ä½•åè°ƒå¼€å‘è€…å¯¹ä»–ä»¬åˆ›å»ºçš„è½¯ä»¶çš„å®Œå…¨æ‰€æœ‰æƒå’Œå…¶ä»–é—®é¢˜ï¼Œå¦‚æ“ä½œã€å®‰å…¨æ€§å’Œåˆè§„æ€§ä»ç„¶ä»¥æ ‡å‡†åŒ–çš„æ–¹å¼å¾—åˆ°é€‚å½“è§£å†³ï¼Ÿ

ç­”æ¡ˆæ˜¯å¹³å°å›¢é˜Ÿè´Ÿè´£é€šè¿‡åˆ›å»ºæ ‡å‡†åŒ–å’Œå¯é‡ç”¨çš„æœåŠ¡æ¥æ”¯æŒå¼€å‘äººå‘˜ï¼Œè¿™äº›æœåŠ¡ä½¿æ¯ä¸ªäººéƒ½èƒ½è½»æ¾åœ°æˆåŠŸå®Œæˆä»»åŠ¡å¹¶æ»¡è¶³ä¸æ–­å¢é•¿çš„éœ€æ±‚ã€‚è¿™é‡Œçš„é‡ç‚¹æ˜¯å¹³å°å›¢é˜Ÿä»¥å·¥å…·ã€APIã€äº§å“å’ŒåˆåŒçš„å½¢å¼æä¾›çš„å¯é‡ç”¨æœåŠ¡ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹ Crossplane Kubernetes Provider å¦‚ä½•å¸®åŠ©å¼€å‘äººå‘˜ä½¿ç”¨è¶³å¤Ÿçš„ Kubernetes æ¥å®Œå…¨æ§åˆ¶ä»–ä»¬çš„è½¯ä»¶ï¼ŒåŒæ—¶å»ºç«‹å…¬å¸æ ‡å‡†ã€‚

# Kubernetes ç®€ä½“

ç”Ÿäº§çº§ Kubernetes èµ„æºé€šå¸¸æ˜¯å¤æ‚çš„ YAML å—ï¼Œå…·æœ‰ä¸å®‰å…¨æ€§ã€æ€§èƒ½ã€ç¡¬ä»¶åˆ©ç”¨ç‡ã€å¯è§‚å¯Ÿæ€§ç­‰ç›¸å…³çš„è®¾ç½®ã€‚

è€Œä¸”è¿™åªæ˜¯ä¸€ä¸ªéƒ¨ç½²èµ„æºï¼Œè¿˜æœ‰æ›´å¤šéœ€è¦æ‹…å¿ƒçš„ã€‚é€šå¸¸ï¼Œåœ¨ Kubernetes ä¸Šè¿è¡Œçš„å®¹å™¨åŒ–åº”ç”¨ç¨‹åºéœ€è¦

*   éƒ¨ç½²
*   æœåŠ¡
*   æœåŠ¡å¸æˆ·
*   è§’è‰²å’Œé›†ç¾¤è§’è‰²
*   è§’è‰²ç»‘å®š
*   ç§˜å¯†
*   é…ç½®æ˜ å°„
*   ç½‘ç»œç­–ç•¥
*   æ°´å¹³åŠèˆ±è‡ªåŠ¨å®šæ ‡å™¨

å¯¹äºæœ‰çŠ¶æ€çš„å·¥ä½œè´Ÿè½½ï¼Œè¿™äº›é€šå¸¸åªæ˜¯æ— çŠ¶æ€çš„å·¥ä½œæµ

*   å·
*   æŒç»­é‡ç´¢èµ”
*   å­˜å‚¨ç±»åˆ«é…ç½®
*   æœ‰çŠ¶æ€é›†åˆ

å› ä¸º Kubernetes å¾ˆå°‘ç‹¬ç«‹è¿è¡Œï¼Œæ‰€ä»¥æ‚¨éœ€è¦åŒ…å«å¤šä¸ª CRD(è‡ªå®šä¹‰èµ„æºå®šä¹‰),è¿™äº› CRD ä¸æœåŠ¡ç½‘æ ¼ã€observability techã€å®‰å…¨æ‰«æå™¨ç­‰å…¶ä»–äº§å“ä¸€èµ·æä¾›ã€‚

ä¸‹é¢ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ä¸€ä¸ªé‡‡ç”¨å¼ºåŒ–å®‰å…¨è®¾ç½®å’Œå…¶ä»–æœ€ä½³å®è·µçš„éƒ¨ç½²ç¤ºä¾‹ã€‚

![](img/848469f8ebc1416c110413459aa1cfb4.png)

æºä½œè€…

è¿™é‡Œæ˜¯ Kubernetes èµ„æºåˆ—è¡¨ï¼Œé€šå¸¸ç”¨æ¥æè¿°å·¥ä½œè´Ÿè½½ã€‚æ ‡æœ‰*çš„é¡¹ç›®æ˜¯å¼€å‘äººå‘˜é€šå¸¸å¿…é¡»ä¸ä¹‹äº¤äº’çš„é¡¹ç›®ã€‚

![](img/5674a229254f524089c098803e2d23a8.png)

æºä½œè€…

ç°åœ¨æƒ³è±¡ä¸€ä¸‹ï¼Œè¿™äº›èµ„æºå°†éœ€è¦ä¹˜ä»¥åº”ç”¨ç¨‹åº/å›¢é˜Ÿ/ç¯å¢ƒçš„æ•°é‡ï¼Œå¹¶ä¸”æ¯ä¸ªéƒ½å¯èƒ½æœ‰è½»å¾®çš„å˜åŒ–ï¼Œä»¥è¯´æ˜å›¢é˜Ÿæ²»ç†ã€æŠ€æœ¯å †æ ˆã€å˜æ›´é€Ÿåº¦ç­‰æ–¹é¢çš„å·®å¼‚ã€‚

é€šè¿‡åˆ©ç”¨ [Kubernetes æä¾›è€…](https://github.com/crossplane-contrib/provider-kubernetes)ï¼Œå¯ä»¥æ§åˆ¶æ­£åœ¨åˆ›å»ºçš„ Kubernetes èµ„æºã€‚å®ƒè¿˜ä¸ºä¸ç†Ÿæ‚‰ [Kubernetes èµ„æºæ¨¡å‹](https://github.com/Kubernetes/design-proposals-archive/blob/main/architecture/resource-management.md)çš„å¼€å‘äººå‘˜éšè—äº†å¤æ‚æ€§ã€‚åœ¨é™„å¸¦çš„ Katacoda åœºæ™¯å’Œ Youtube è§†é¢‘ä¸­ï¼Œæˆ‘ä»¬éƒ¨ç½²äº†ä¸€ä¸ª Kubernetes åº”ç”¨ç¨‹åºï¼ŒåŒ…æ‹¬:

*   éƒ¨ç½²
*   æœåŠ¡
*   æ°´å¹³åŠèˆ±è‡ªåŠ¨ç¼©æ”¾å™¨

æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„ç»„åˆï¼ŒåªåŒ…å«é‡è¦çš„å­—æ®µï¼Œæ¯”å¦‚:

*   è¦éƒ¨ç½²åˆ°çš„å‘½åç©ºé—´
*   å¸¦æ ‡ç­¾çš„å›¾åƒ

> *å®šä¹‰æè¿°äº†ç”¨äºåˆ›å»ºå¤åˆèµ„æºçš„ APIï¼Œè€Œç»„åˆå®šä¹‰äº†å½“ç›´æ¥æˆ–é€šè¿‡ä¸“ç”¨å£°æ˜åˆ›å»ºå¤åˆèµ„æºæ—¶ï¼Œå°†åˆ›å»ºå“ªäº›å—ç®¡èµ„æºã€‚*

æˆ‘ä»¬çš„ç»„åˆå’Œå®šä¹‰æè¿°äº†æˆ‘ä»¬æƒ³è¦åˆ›å»ºä»€ä¹ˆ Kubernetes å¯¹è±¡ï¼Œä½†æ˜¯å¼€å‘äººå‘˜åº”è¯¥å¦‚ä½•è®©æˆ‘ä»¬çŸ¥é“åº”è¯¥åˆ›å»ºä»€ä¹ˆï¼Ÿä»–ä»¬éœ€è¦å¼€å‰æ‹‰ç¥¨å—ï¼ŸğŸ˜¶

â€¦ä¸ï¼Œä»–ä»¬åªéœ€è¦åˆ›å»ºä¸€ä¸ªç®€å•çš„å£°æ˜ï¼Œå°±åƒè¿™æ ·

```
apiVersion: acmeplatform.com/v1alpha1
kind: AppClaim
metadata:
  name: platform-demo
  labels:
    app-owner: piotrzan
spec:
  id: acmeplatform
  compositionSelector:
    matchLabels:
      type: frontend
  parameters:
    namespace: devops-team
    image: piotrzan/nginx-demo:green
```

é€šè¿‡åº”ç”¨è¯¥å£°æ˜ï¼Œæˆ‘ä»¬â€œåœ¨å¼•æ“ç›–ä¸‹â€åˆ›å»ºäº†å¤šä¸ª Kubernetes èµ„æºï¼Œè€Œä¸éœ€è¦çŸ¥é“å®ƒä»¬æ˜¯ä»€ä¹ˆä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•åˆ›å»ºçš„ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥è½¬ç§»åˆ°å¹³å°å›¢é˜Ÿã€‚

æœ‰å‡ ä¸ªåŸºäºç»„åˆåˆ›å»ºçš„èµ„æºã€‚

æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°æ›´æ–°å›¾åƒï¼Œåªéœ€åœ¨ AppClaim çš„å‚æ•°éƒ¨åˆ†æ›´æ”¹å›¾åƒåç§°ã€‚

åˆ é™¤åº”ç”¨ç¨‹åºå’Œåº•å±‚èµ„æºå°±åƒæ‰§è¡Œ kubectl å‘½ä»¤æˆ–è®¾ç½® GitOps å¹¶å°† yaml æ–‡ä»¶æ¨é€åˆ° git repo ä¸€æ ·ç®€å•ã€‚

ç”±äº Crossplane çš„ç»„æˆï¼Œè¿™ç§ç®€å•æ€§æˆä¸ºå¯èƒ½ã€‚

# äº¤å‰å¹³é¢

é€šè¿‡åˆ©ç”¨ Kubernetes æä¾›è€…ï¼Œå¯ä»¥æ§åˆ¶æ­£åœ¨åˆ›å»ºçš„ Kubernetes èµ„æºã€‚å®ƒè¿˜ä¸ºä¸ç†Ÿæ‚‰ Kubernetes èµ„æºæ¨¡å‹çš„å¼€å‘äººå‘˜éšè—äº†å¤æ‚æ€§ã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å°†éƒ¨ç½²ä¸€ä¸ª Kubernetes åº”ç”¨ç¨‹åºï¼ŒåŒ…æ‹¬:

> *è¦äº†è§£æ›´å¤šå…³äº Crossplane çš„æ¦‚è¿°ï¼Œè¯·æŸ¥çœ‹è¿™ä¸ª* [*çš„ç®€çŸ­ä»‹ç»*](https://slides.com/decoder/crossplane) *å’Œéå¸¸å…¨é¢çš„* [*Crossplane æ–‡æ¡£*](https://crossplane.io/docs/v1.6/) *ä»¥åŠæˆ‘æœ€è¿‘çš„åšå®¢ï¼Œç‰¹åˆ«æ˜¯* [*åŸºç¡€è®¾æ–½ä»£ç :ä¸‹ä¸€ä¸ªå¤§è½¬å˜å°±åœ¨è¿™é‡Œ*](/infrastructure-as-code-the-next-big-shift-is-here-9215f0bda7ce)

ä¸‹å›¾è§£é‡Šäº†äº¤å‰å¹³é¢çš„ç»„ä»¶åŠå…¶å…³ç³»ã€‚

![](img/b6adb3a42740b571fc9439f3cf3309ff.png)

æ˜¯ä»€ä¹ˆè®© Crossplane å¦‚æ­¤ç‰¹åˆ«ï¼Ÿé¦–å…ˆï¼Œå®ƒå»ºç«‹åœ¨ Kubernetes ä¹‹ä¸Šï¼Œå¹¶åˆ©ç”¨äº†è¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œå³ Kubernetes çš„çœŸæ­£å¼ºå¤§ä¹‹å¤„åœ¨äºå…¶å¼ºå¤§çš„ API æ¨¡å‹å’Œæ§åˆ¶å¹³é¢é€»è¾‘(æ§åˆ¶å¾ªç¯)ã€‚å®ƒä¹Ÿä»ä½œä¸ºä»£ç çš„åŸºç¡€è®¾æ–½è½¬ç§»åˆ°ä½œä¸ºæ•°æ®çš„åŸºç¡€è®¾æ–½ã€‚åŒºåˆ«åœ¨äº IaC æ„å‘³ç€ç¼–å†™ä»£ç æ¥æè¿°ä¾›åº”åº”è¯¥å¦‚ä½•å‘ç”Ÿï¼Œè€Œ IaD æ„å‘³ç€ç¼–å†™çº¯æ•°æ®æ–‡ä»¶(åœ¨ Kubernetes YAML çš„æƒ…å†µä¸‹)å¹¶å°†å®ƒä»¬æäº¤ç»™æ§åˆ¶ç»„ä»¶(åœ¨ Kubernetes æ˜¯æ“ä½œå‘˜çš„æƒ…å†µä¸‹)æ¥å°è£…å’Œæ‰§è¡Œä¾›åº”é€»è¾‘ã€‚

å…³äº Crossplane æœ€å¥½çš„éƒ¨åˆ†æ˜¯å®ƒæ— ç¼åœ°æ”¯æŒåº”ç”¨ç¨‹åºå›¢é˜Ÿå’Œå¹³å°å›¢é˜Ÿä¹‹é—´çš„åä½œï¼Œé€šè¿‡åˆ©ç”¨ [Kubernetes æ§åˆ¶](https://containerjournal.com/kubeconcnc/kubernetes-true-superpower-is-its-control-plane/)å¹³é¢ä½œä¸ºæ¯ä¸ªäººç›¸é‡çš„æ±‡èšç‚¹ã€‚

## äº¤å‰å¹³é¢ Kubernetes æä¾›å•†

Crossplane Kubernetes Provider å¸®åŠ©æˆ‘ä»¬å‘å·¦è½¬ç§»ï¼Œè€Œä¸ä¼šè®©å¼€å‘äººå‘˜æ‰¿æ‹…è¿‡å¤šå¤æ‚çš„è¿è¥é—®é¢˜ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å¸®åŠ©å¼€å‘äººå‘˜å’Œåº”ç”¨ç¨‹åºå›¢é˜Ÿä¸“æ³¨äºå¯é å’Œå¿«é€Ÿåœ°äº¤ä»˜ç‰¹æ€§å’Œä¿®å¤ bug ç­‰ã€‚ä¸æ­¤åŒæ—¶ï¼Œè¿˜å¿…é¡»è§£å†³å®‰å…¨å’Œæ“ä½œæ–¹é¢çš„é—®é¢˜ã€‚è¿™äº›å…³æ³¨ç‚¹ä¼šå› å›¢é˜Ÿå’Œé¡¹ç›®çš„ä¸åŒè€Œä¸åŒã€‚

DevOps æ„å‘³ç€é™ä½å¼€å‘äººå‘˜å’Œå…¶ä»–åŠŸèƒ½ä¹‹é—´çš„æ‘©æ“¦ã€‚å¾ˆæ˜æ˜¾ï¼Œä¸åŒåˆ©ç›Šç›¸å…³è€…ä¹‹é—´çš„æ²Ÿé€šæ˜¯é«˜æ•ˆåä½œçš„å…³é”®ã€‚ç„¶è€Œï¼Œå¾ˆéš¾æ•æ‰åˆ°æ¯ä¸ªè®¨è®ºçš„æœ¬è´¨å’Œæ‰€æœ‰çš„ç»†å¾®å·®åˆ«ï¼Œå¹¶å°†å…¶ä½œä¸ºä¸€ç§æ¨¡å¼æ¨å¹¿åˆ°å…¶ä»–å›¢é˜Ÿã€‚å·¥å…·æ ¹æœ¬ä¸åœ¨é‚£é‡Œã€‚è¿™éšç€ Crossplane åŠå…¶æå‡ºçš„å·¥ä½œæµå’Œç†å¿µè€Œæ”¹å˜ã€‚ç°åœ¨ï¼Œå¯ä»¥æ•æ‰æ¯ç§åœºæ™¯çš„ç»†å¾®å·®åˆ«å’Œå¤æ‚æ€§ï¼Œå¹¶æä¾›ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œå…¶ä¸­å®šåˆ¶å’Œæ ‡å‡†éƒ¨ä»¶å¾—åˆ°å¾ˆå¥½çš„å¹³è¡¡ï¼Œè€Œä¸ä¼šé™·å…¥â€œæœ€å°å…¬åˆ†æ¯â€çš„é™·é˜±ã€‚

> *Crossplane å·¥ä½œæµç¨‹å’Œç†å¿µå¸®åŠ©æˆ‘ä»¬æ•è·å’Œæ•´ç†å¿…è¦çš„å®šåˆ¶ï¼Œå¹¶éšç€æ—¶é—´çš„æ¨ç§»å¯¹å…¶è¿›è¡Œç®¡ç†ã€‚ç°åœ¨ï¼Œåœ¨å¼€å‘äººå‘˜å’Œå¹³å°å›¢é˜Ÿä¹‹é—´çš„ä¼šè®®ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªç»„åˆï¼Œä»¥å¼€å‘äººå‘˜(å£°æ˜)å’Œå¹³å°å›¢é˜Ÿ(ç»„åˆ)ä¹‹é—´çš„åˆåŒçš„å½¢å¼å°†ä¼šè®®çš„å†³å®šè¿›è¡Œç¼–ç ï¼Œè€Œä¸æ˜¯å‘é€ç”µå­é‚®ä»¶æˆ–ä¼šè®®è®°å½•ã€‚*

## æ„å›¾çš„åŠ›é‡

äº¤å‰å¹³é¢çš„é­”åŠ›å‘ç”Ÿåœ¨[æ„å›¾](https://crossplane.io/docs/v1.6/reference/composition.html)ä¸­ã€‚åˆæˆæ‰§è¡Œ 3 ä¸ªä¸»è¦ä»»åŠ¡

*   åŸºäºå£°æ˜æˆ–ç»„åˆèµ„æºç»„åˆä¸€ç»„æ‰˜ç®¡èµ„æº
*   è®¿é—®æä¾›è€… API æ‰€éœ€çš„å¼•ç”¨å‡­æ®
*   ä»å£°æ˜ä¸­æä¾›çš„å€¼ä¿®è¡¥/æ˜ å°„åˆ°æ‰˜ç®¡èµ„æºä¸­çš„å€¼

ä¸‹é¢æ‚¨å¯ä»¥çœ‹åˆ° composition å¦‚ä½•åˆ›å»ºéƒ¨ç½²ã€æœåŠ¡å’Œæ°´å¹³ pod autoscaler æ¥å“åº”åˆ›å»º AppClaimã€‚ç»„åˆå’Œå®é™… Kubernetes èµ„æºä¹‹é—´çš„â€œç²˜åˆå‰‚â€æ˜¯ç»„åˆèµ„æºå®šä¹‰(XRD ),æ‚¨å¯ä»¥å°†å…¶è§†ä¸ºé€šè¿‡å£°æ˜ä½¿ç”¨èµ„æºçš„å¼€å‘äººå‘˜å’Œä¸ºåº•å±‚èµ„æºæˆ–åŸºç¡€è®¾æ–½è®¾è®¡ç»„åˆçš„å¹³å°å·¥ç¨‹å¸ˆæˆ– SRE ä¹‹é—´çš„ä¸€ç§ APIã€‚

è¿™é‡Œæœ‰ä¸¤ä¸ªå…³é”®é¢†åŸŸï¼Œä½¿ç»„æˆå¦‚æ­¤å¼ºå¤§ã€‚

# å¯¹äºä¾›åº”å•†

æŒ‡å®šè¦åˆ›å»ºçš„ Kubernetes èµ„æºå’Œè®¾ç½®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç»„åˆæ˜¯å¦‚ä½•æ·»åŠ  livenessProbe å’Œ readinessProbe ä»¥åŠå¯èƒ½ç”±å¹³å°å›¢é˜Ÿå®šä¹‰çš„èµ„æºé™åˆ¶çš„ï¼Œå› æ­¤ä¸ä¼šå‘åº”ç”¨ç¨‹åºå¼€å‘å›¢é˜Ÿå…¬å¼€ã€‚

# è¡¥ä¸

å¯ç”¨å®šä¹‰(XRD)ä¸­æä¾›çš„å­—æ®µå’Œæ‰˜ç®¡èµ„æº(MR)ä¸­çš„å­—æ®µä¹‹é—´çš„æ˜ å°„ã€‚

> *blow YAMl æ˜¯ç¼©å†™çš„ï¼Œè¿™äº›æ–‡ä»¶çš„å¤æ‚æ€§å¯èƒ½å¾ˆå¤§ã€‚è¿™æ˜¯è®¾è®¡å‡ºæ¥çš„ï¼Œæ²¡æœ‰ç¥å¥‡çš„â€œå»é™¤å¤æ‚æ€§â€æŒ‰é’®ã€‚ç›¸åï¼ŒCrossplane æä¾›äº†å°†å¤æ‚æ€§è½¬ç§»åˆ°å¹³å°å›¢é˜Ÿå¹¶ä¸ºå…¶ä»–å›¢é˜Ÿè®¾è®¡ç®€å•çš„å®šåˆ¶ API çš„å·¥å…·ã€‚*

```
apiVersion: apiextensions.crossplane.io/v1
kind: Composition
...
spec:
  compositeTypeRef:
    apiVersion: acmeplatform.com/v1alpha1
    kind: App
...
  - name: deployment
    base:
      apiVersion: kubernetes.crossplane.io/v1alpha1
      kind: Object
      spec:
        forProvider:
          manifest:
            apiVersion: apps/v1
            kind: Deployment
            spec:
              template:
                spec:
                  containers:
                  - name: frontend
                    ports:
                    - containerPort: 80
                    livenessProbe:
                      httpGet:
                        path: /
                        port: 80
                    readinessProbe:
                      httpGet:
                        path: /
                        port: 80
                    resources:
                      limits:
                        cpu: 250m
                        memory: 256Mi
                      requests:
                        cpu: 125m
                        memory: 128Mi
    patches:
    - fromFieldPath: spec.id
      toFieldPath: metadata.name
      transforms:
        - type: string
          string:
            fmt: "%s-deployment"
...
  - name: service
    base:
      apiVersion: kubernetes.crossplane.io/v1alpha1
      kind: Object
      spec:
        forProvider:
          manifest:
            apiVersion: v1
            kind: Service
            spec:
              type: ClusterIP
              ports:
              - port: 80
                targetPort: 80
                protocol: TCP
                name: http
    patches:
    - fromFieldPath: spec.id
      toFieldPath: metadata.name
      transforms:
        - type: string
          string:
            fmt: "%s-service"
...
  - name: hpa
    base:
      apiVersion: kubernetes.crossplane.io/v1alpha1
      kind: Object
      spec:
        forProvider:
          manifest:
            apiVersion: autoscaling/v1
            kind: HorizontalPodAutoscaler
            spec:
              minReplicas: 2
              maxReplicas: 6
              scaleTargetRef:
                apiVersion: apps/v1
                kind: Deployment
              targetCPUUtilizationPercentage: 80
    patches:
    - fromFieldPath: spec.id
      toFieldPath: metadata.name
      transforms:
        - type: string
          string:
            fmt: "%s-ingress"
    readinessChecks:
      - type: None
```

## å…³é”®è¦ç‚¹

Crossplane çš„å¼ºå¤§ä¹‹å¤„åœ¨äºèƒ½å¤Ÿç»„åˆåŒ…æ‹¬ç›¸é‚»æœåŠ¡ç”šè‡³åº”ç”¨ç¨‹åºåœ¨å†…çš„åŸºç¡€è®¾æ–½ï¼Œå¹¶å‘æ¶ˆè´¹è€…å…¬å¼€ç®€å•çš„æ¥å£ï¼ŒåŒæ—¶ä¼˜é›…åœ°å¤„ç†åå°çš„å¤æ‚æ€§ã€‚

*   å¯ç»„åˆçš„åŸºç¡€è®¾æ–½
*   è‡ªåŠ©æœåŠ¡
*   è‡ªåŠ¨åŒ–ç¨‹åº¦æé«˜
*   æ ‡å‡†åŒ–åä½œ
*   é€šç”¨è¯­è¨€(K8s API)
*   Kubernetes provider å¯ä»¥æˆä¸º helm æ›´å¼ºå¤§çš„æ›¿ä»£äº§å“

## ä½ è‡ªå·±è¯•è¯•

ç°åœ¨ï¼Œæ‚¨å·²ç»äº†è§£å¹¶ä½“éªŒäº†åŸºæœ¬çš„äº¤å‰å¹³é¢æ¦‚å¿µï¼Œè¯·å‰å¾€ [Upbound Cloud](https://www.upbound.io/) ï¼Œåœ¨é‚£é‡Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªå…è´¹å¸æˆ·å¹¶äº²è‡ªä½“éªŒäº‘åŸºç¡€æ¶æ„çš„é…ç½®ï¼

## é¢å¤–èµ„æº

*   æ¢ç´¢å…¶ä»–ä¾›åº”å•†ï¼Œå¦‚[å¤´ç›”ä¾›åº”å•†](https://github.com/crossplane-contrib/provider-helm)
*   æµè§ˆ [Upbound Registry](https://cloud.upbound.io/browse) ï¼Œåœ¨è¿™é‡Œä½ å¯ä»¥å‘ç°å¹¶å°è¯•æ–°çš„æä¾›å•†å’Œé«˜çº§ä½œå“
*   å¦‚æœä½ ç†Ÿæ‚‰ terraformï¼Œä½ ä¼š[äº¤å‰å¹³é¢ä¸ terra form](https://blog.crossplane.io/crossplane-vs-terraform/)Nic Cope çš„æ¯”è¾ƒéå¸¸æœ‰ç”¨
*   æ‰¾å‡ºä»€ä¹ˆæ˜¯çœŸæ­£çš„ Kubernetes è¶…çº§åŠ›é‡
*   çœ‹çœ‹ä¸ºä»€ä¹ˆæˆ‘ç›¸ä¿¡ Crossplane æ˜¯ IaC çš„ä¸‹ä¸€ä¸ªå¤§è½¬å˜

## å¼€æ”¾ç¤¾åŒº

å›´ç»• Crossplane çš„å¼€æºç¤¾åŒºéå¸¸å—æ¬¢è¿å’Œæœ‰å¸®åŠ©ï¼Œæ‰€ä»¥å¦‚æœä½ æœ‰ä»»ä½•å…³äº Crossplane çš„é—®é¢˜ï¼Œè¯·åŠ å…¥ [slack channel](https://slack.crossplane.io/) å¹¶è¯´ğŸ‘‹