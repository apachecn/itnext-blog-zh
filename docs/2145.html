<html>
<head>
<title>Replace Redux state with React Hooks and Context</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ç”¨Reacté’©å­å’Œä¸Šä¸‹æ–‡æ›¿æ¢ReduxçŠ¶æ€</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/replace-redux-state-with-react-hooks-and-context-7906e0fd5521?source=collection_archive---------0-----------------------#2019-04-07">https://itnext.io/replace-redux-state-with-react-hooks-and-context-7906e0fd5521?source=collection_archive---------0-----------------------#2019-04-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/f24a92bedbfe821d163d3177d5f30b54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ISGtKTBwJem2C7tPfKL4-A.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://spdload.com/jobs-vacancies/front-end/front-end-developer-react-js/" rel="noopener ugc nofollow" target="_blank">æ¥è‡ªspdloadçš„å›¾åƒ</a></figcaption></figure><blockquote class="kg"><p id="47c2" class="kh ki it bd kj kk kl km kn ko kp kq dk translated">å…è´£å£°æ˜ã€‚æˆ‘çŸ¥é“Reduxæä¾›çš„ä¸ä»…ä»…æ˜¯å…¨å±€çŠ¶æ€ã€‚æˆ‘åœ¨è¿™é‡Œæä¾›çš„æ˜¯ä¸€ä¸ªä¼˜é›…çš„å…¨å±€çŠ¶æ€ï¼Œæ²¡æœ‰ä¾èµ–æ€§ï¼Œä½†æ˜¯React 16.8+</p></blockquote><p id="7540" class="pw-post-body-paragraph kr ks it kt b ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln kq im bi lo translated"><span class="l lp lq lr bm ls lt lu lv lw di"> R </span> eact Hooksäº2018å¹´åº•å…¬å¸ƒã€‚ç„¶ååœ¨2019å¹´3æœˆå‘å¸ƒã€‚æœ€è¿‘æˆ‘çœ‹äº†React Confè§†é¢‘ï¼Œå…¶ä¸­<a class="ae kf" href="https://twitter.com/dan_abramov/" rel="noopener ugc nofollow" target="_blank">ä¸¹Â·é˜¿å¸ƒæ‹‰è«å¤«</a>å’Œ<a class="ae kf" href="https://twitter.com/ryanflorence?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor" rel="noopener ugc nofollow" target="_blank">ç‘å®‰Â·å¼—æ´›ä¼¦æ–¯</a>å®£å¸ƒå¹¶å±•ç¤ºäº†é’©å­çš„åŠ›é‡ã€‚Ryanå®ç°äº†ä¸€ä¸ªå¸¦é’©å­çš„Reducerï¼ŒåŒæ—¶æ…¢æ…¢åœ°æ‹†å¼€äº†æ—§çš„Reactç±»ç»„ä»¶ã€‚è¿™æ˜¯è¾‰ç…Œçš„ï¼Œä½ åº”è¯¥çœ‹åˆ°è¿™é‡Œçš„ä¸¤ä¸ªå‘è¨€:(ä½ å¯ä»¥è·³åˆ°ä¸¹çš„ä¸€éƒ¨åˆ†)</p><figure class="lx ly lz ma gt ju"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="3d19" class="pw-post-body-paragraph kr ks it kt b ku md kw kx ky me la lb lc mf le lf lg mg li lj lk mh lm ln kq im bi translated">é™ˆè¿°ä»¥ä¸€äº›é›¶æ•£çš„ç»†èŠ‚ç»“æŸã€‚åœ¨ç›‘å¬çŠ¶æ€å˜åŒ–çš„åŒæ—¶ï¼Œreducerå¦‚ä½•å˜å¾—å…¨å±€å¯ç”¨ï¼Ÿåœ¨è§†é¢‘ç»“æŸæ—¶ï¼Œä»–å®é™…ä¸Šä½å£°è¯´é“:</p><blockquote class="kg"><p id="e28a" class="kh ki it bd kj kk mi mj mk ml mm kq dk translated">ç„¶åä½ åŠ ä¸Š<a class="ae kf" href="https://reactjs.org/docs/context.html" rel="noopener ugc nofollow" target="_blank">ä¸Šä¸‹æ–‡â€¦â€¦</a></p></blockquote><p id="ecd2" class="pw-post-body-paragraph kr ks it kt b ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln kq im bi translated">çªç„¶ï¼Œä¸€ä¸ªæ–°ä¸–ç•Œæ‰“å¼€äº†ã€‚</p><ul class=""><li id="aefb" class="mn mo it kt b ku md ky me lc mp lg mq lk mr kq ms mt mu mv bi translated">åˆ›å»ºReactåº”ç”¨ç¨‹åºã€‚</li><li id="4eef" class="mn mo it kt b ku mw ky mx lc my lg mz lk na kq ms mt mu mv bi translated">ä»Reactå¯¼å…¥useReducerå’ŒuseContextã€‚</li><li id="081e" class="mn mo it kt b ku mw ky mx lc my lg mz lk na kq ms mt mu mv bi translated">åˆ›å»ºä¸€ä¸ªå‡é€Ÿå™¨å¼€å…³ç›’ã€‚</li><li id="5443" class="mn mo it kt b ku mw ky mx lc my lg mz lk na kq ms mt mu mv bi translated">åˆ›å»ºä¸€ä¸ªåˆå§‹çŠ¶æ€ã€‚</li><li id="d335" class="mn mo it kt b ku mw ky mx lc my lg mz lk na kq ms mt mu mv bi translated">å°†çŠ¶æ€ä¼ é€’ç»™ä»»ä½•ä¸€ä¸ªåªæœ‰ä¸€è¡Œä»£ç çš„ç»„ä»¶(ï¼idspnonenote)ã€‚ï¼)çš„ä»£ç ã€‚</li></ul><p id="59cf" class="pw-post-body-paragraph kr ks it kt b ku md kw kx ky me la lb lc mf le lf lg mg li lj lk mh lm ln kq im bi translated">ä½ å¾—åˆ°äº†å…¨å±€çŠ¶æ€ï¼Œæœ¬åœ°å’Œååº”ï¼Mediumä¸Šå‡ºç°äº†å¾ˆå¤šå…³äºuseReducer+useContextè®¾ç½®çš„æ–‡ç« ï¼Œç»™ä½ ä¸€ä¸ªå¸¦æœ‰Reducerçš„å…¨å±€çŠ¶æ€ï¼Œæ²¡æœ‰npm install redux redux-reactã€‚</p><p id="e284" class="pw-post-body-paragraph kr ks it kt b ku md kw kx ky me la lb lc mf le lf lg mg li lj lk mh lm ln kq im bi translated">æˆ‘å¼€å§‹æ…¢æ…¢é‡æ„æˆ‘çš„æŠ€æœ¯é›·è¾¾åä½œåº”ç”¨ï¼Œå°±åƒä¸¹å’ŒåŒ»ç”Ÿå»ºè®®çš„é‚£æ ·ã€‚ç„¶åæˆ‘åšå¾—è¿‡ç«äº†ï¼ŒæŠŠæˆ‘çš„åº”ç”¨ç¨‹åºæ’•æˆäº†ç¢ç‰‡ã€‚æˆ‘æœ‰4ä¸ªä¸åŒçš„StoreContext.jsæ–‡ä»¶è¯•å›¾å®ŒæˆåŒæ ·çš„äº‹æƒ…ï¼Œåœ¨éµå¾ªæŒ‡å—çš„åŒæ—¶æµ‹è¯•ä¸åŒçš„å®ç°ã€‚æˆ‘æœ€ç»ˆå¾—åˆ°çš„æ˜¯è®¸å¤šè§£å†³æ–¹æ¡ˆçš„ç»„åˆã€‚</p><p id="ff91" class="pw-post-body-paragraph kr ks it kt b ku md kw kx ky me la lb lc mf le lf lg mg li lj lk mh lm ln kq im bi translated">è¿™æ˜¯æˆ‘æœ€ç»ˆå¾—å‡ºçš„è§£å†³æ–¹æ¡ˆ</p><h1 id="850b" class="nb nc it bd nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny bi translated">ç”¨é’©å­å’Œä¸Šä¸‹æ–‡å‡å°‘ååº”çŠ¶æ€</h1><p id="8dc0" class="pw-post-body-paragraph kr ks it kt b ku nz kw kx ky oa la lb lc ob le lf lg oc li lj lk od lm ln kq im bi translated">åœ¨æ‚¨çš„é¡¹ç›®ä¸­ï¼Œåˆ›å»º/contextç›®å½•ã€‚æ·»åŠ 3ä¸ªæ–‡ä»¶:actions.jsã€reducers.jsã€StoreContext.jsã€‚æœ‰äº†è¿™3ä¸ªæ–‡ä»¶å’Œä¸€ä¸ªReactç»„ä»¶ï¼Œæ‚¨å°±å¯ä»¥åšå¾ˆå¤šäº‹æƒ…äº†ï¼</p><p id="21dc" class="pw-post-body-paragraph kr ks it kt b ku md kw kx ky me la lb lc mf le lf lg mg li lj lk mh lm ln kq im bi translated">æˆ‘åœ¨ä»£ç æ²™ç®±ä¸­åˆ›å»ºäº†ä¸€ä¸ªæ¼”ç¤ºåº”ç”¨ç¨‹åºã€‚è¿™æ˜¾ç¤ºäº†ä½¿ç”¨é’©å­åªéœ€å‡ è¡Œä»£ç å°±å¯ä»¥è·å¾—ä¸€ä¸ªå…¨å±€çŠ¶æ€å­˜å‚¨ã€‚å¦‚æœä½ å–œæ¬¢äº’åŠ¨ï¼Œçœ‹çœ‹è¿™ä¸ªæ¼”ç¤ºã€‚è¿›ä¸€æ­¥çš„é˜…è¯»åŒ…æ‹¬è¿™ä¸ªé¡¹ç›®æ–‡ä»¶çš„å‰¯æœ¬ã€‚</p><figure class="lx ly lz ma gt ju"><div class="bz fp l di"><div class="oe mc l"/></div></figure><p id="ad2a" class="pw-post-body-paragraph kr ks it kt b ku md kw kx ky me la lb lc mf le lf lg mg li lj lk mh lm ln kq im bi translated">è¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ</p><h2 id="27e5" class="of nc it bd nd og oh dn nh oi oj dp nl lc ok ol np lg om on nt lk oo op nx oq bi translated">actions.js</h2><p id="ba40" class="pw-post-body-paragraph kr ks it kt b ku nz kw kx ky oa la lb lc ob le lf lg oc li lj lk od lm ln kq im bi translated">ä½¿ç”¨å¸¦æœ‰å‰ç¼€â€œuseâ€çš„æŒ‚é’©çº¦å®šå®šä¹‰useActions(stateï¼Œdispatch)ã€‚useAction() { â€¦ }ä¸­å®šä¹‰çš„æ‰€æœ‰å‡½æ•°éƒ½å°†åœ¨useContext()ä¸­çš„æ“ä½œä¸­å¯ç”¨ã€‚åŠ¨ä½œç”¨äºå®šä¹‰æ¯”çº¯ç²¹çš„åˆ†æ´¾(ç±»å‹ã€æœ‰æ•ˆè´Ÿè½½)åŠŸèƒ½æ›´é«˜çº§çš„é€»è¾‘ã€‚</p><pre class="lx ly lz ma gt or os ot ou aw ov bi"><span id="78eb" class="of nc it os b gy ow ox l oy oz">import { types } from "./reducers";</span><span id="3de8" class="of nc it os b gy pa ox l oy oz">export const useActions = (state, dispatch) =&gt; {<br/>  function addTechIfNotInList(newTech) {<br/>    const techIndex = state.techList.indexOf(newTech);<br/>    if (techIndex !== -1) {<br/>      alert("Tech is defined in list");<br/>    } else {<br/>      dispatch({ type: types.ADD_TO_TECH_LIST, payload: newTech });<br/>    }<br/>  }</span><span id="ad8c" class="of nc it os b gy pa ox l oy oz">return {<br/>    addTechIfNotInList<br/>  };<br/>};</span></pre><blockquote class="pb pc pd"><p id="9e29" class="kr ks pe kt b ku md kw kx ky me la lb pf mf le lf pg mg li lj ph mh lm ln kq im bi translated">æœ‰äº†Reduxï¼Œé€»è¾‘åº”è¯¥ä½•å»ä½•ä»å°±æœ‰äº†ä¸€ä¸ªå¾ˆå¥½çš„å¹³è¡¡ï¼›è¿˜åŸè€…æˆ–è¡ŒåŠ¨åˆ›é€ è€…ã€‚æ‰¾åˆ°é€‚åˆä½ çš„æ¨¡å¼ï¼</p></blockquote><h2 id="08b0" class="of nc it bd nd og oh dn nh oi oj dp nl lc ok ol np lg om on nt lk oo op nx oq bi translated">reducers.js</h2><p id="9b9d" class="pw-post-body-paragraph kr ks it kt b ku nz kw kx ky oa la lb lc ob le lf lg oc li lj lk od lm ln kq im bi translated">åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘å®šä¹‰äº†åˆå§‹çŠ¶æ€ã€ç±»å‹å’Œç¼©å‡å™¨æœ¬èº«ã€‚å½“æˆ‘ä»¬ä»åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•åœ°æ–¹è°ƒåº¦ä¸€ä¸ªç±»å‹æ—¶ï¼Œå®ƒå°†åŒ¹é…å¼€å…³æ¡ä»¶ï¼Œå¹¶å¯¹çŠ¶æ€æ‰§è¡Œæ­£ç¡®çš„æ“ä½œã€‚å¦‚æœä½ ç†Ÿæ‚‰Reduxï¼Œè¿™åº”è¯¥å¯¹ä½ æ¥è¯´éå¸¸ç†Ÿæ‚‰ï¼</p><pre class="lx ly lz ma gt or os ot ou aw ov bi"><span id="8523" class="of nc it os b gy ow ox l oy oz">const initialState = {<br/>  techList: ["TypeScript", "React Hooks"]<br/>};</span><span id="fc6e" class="of nc it os b gy pa ox l oy oz">const types = {<br/>  SET_TECH_LIST: "SET_TECH_LIST",<br/>  ADD_TO_TECH_LIST: "ADD_TO_TECH_LIST",<br/>  REMOVE_FROM_TECH_LIST: "REMOVE_FROM_TECH_LIST"<br/>};</span><span id="6982" class="of nc it os b gy pa ox l oy oz">const reducer = (state = initialState, action) =&gt; {<br/>  switch (action.type) {<br/>    case types.SET_TECH_LIST:<br/>      return {<br/>        ...state,<br/>        techList: action.payload<br/>      };<br/>    case types.ADD_TO_TECH_LIST:<br/>      return {<br/>        ...state,<br/>        techList: [...state.techList, action.payload]<br/>      };<br/>    case types.REMOVE_FROM_TECH_LIST:<br/>      return {<br/>        ...state,<br/>        techList: state.techList.filter(<br/>          tech =&gt; tech !== action.payload)<br/>      };<br/>    default:<br/>      throw new Error("Unexpected action");<br/>  }<br/>};<br/>export { initialState, types, reducer };</span></pre><p id="01fe" class="pw-post-body-paragraph kr ks it kt b ku md kw kx ky me la lb lc mf le lf lg mg li lj lk mh lm ln kq im bi translated">æ‚¨å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘å·²ç»é€‰æ‹©åœ¨è¿™ä¸ªç¼©å‡å™¨ä¸­åŒ…å«ä¸€äº›é€»è¾‘ã€‚ç§»é™¤techæ—¶ï¼Œè°ƒåº¦(REMOVE_FROM_TECHï¼ŒtechObj)å°±å¤Ÿäº†ã€‚ç„¶è€Œï¼Œå½“æ·»åŠ æŠ€æœ¯æ—¶ï¼Œå®ƒæ€»æ˜¯å°†å®ƒæ·»åŠ åˆ°çŠ¶æ€ä¸­ã€‚è¿™æ˜¯æˆ‘åœ¨åŠ¨ä½œåˆ›å»ºå™¨ä¸­åˆ›å»ºçš„é€»è¾‘ã€‚</p><blockquote class="pb pc pd"><p id="56db" class="kr ks pe kt b ku md kw kx ky me la lb pf mf le lf pg mg li lj ph mh lm ln kq im bi translated">æ›´é«˜çº§çš„é€»è¾‘åº”è¯¥æ”¾åœ¨åŠ¨ä½œåˆ›å»ºå™¨ä¸­ï¼Œæ¯”å¦‚APIè°ƒç”¨å’Œå…¶ä»–<a class="ae kf" href="https://medium.com/javascript-scene/master-the-javascript-interview-what-is-a-pure-function-d1c076bec976" rel="noopener">å‰¯ä½œç”¨ï¼Œè®©ä½ çš„å‡½æ•°å˜å¾—â€œä¸çº¯ç²¹â€ã€‚</a>reducerä¸­è¿˜å¯ä»¥æ·»åŠ åŸºæœ¬çš„æ•°ç»„ã€å¯¹è±¡å’Œå­—ç¬¦ä¸²æ“ä½œã€‚</p></blockquote><h2 id="6675" class="of nc it bd nd og oh dn nh oi oj dp nl lc ok ol np lg om on nt lk oo op nx oq bi translated">StoreContext.js</h2><p id="b64b" class="pw-post-body-paragraph kr ks it kt b ku nz kw kx ky oa la lb lc ob le lf lg oc li lj lk od lm ln kq im bi translated">è¿™å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨ä¸Šä¸‹æ–‡ä½¿æˆ‘ä»¬çš„å­˜å‚¨å…¨å±€å¯æ£€ç´¢çš„åœ°æ–¹ã€‚è¿™ç›¸å½“äºRedux' createStore()ï¼Œåªæ˜¯â€¦ä¸åŒã€‚</p><p id="a5ec" class="pw-post-body-paragraph kr ks it kt b ku md kw kx ky me la lb lc mf le lf lg mg li lj lk mh lm ln kq im bi translated">è¯¥æ–‡ä»¶ä¸­çš„ä»£ç æ˜¯</p><pre class="lx ly lz ma gt or os ot ou aw ov bi"><span id="6eb4" class="of nc it os b gy ow ox l oy oz">const StoreContext = createContext(initialState);</span><span id="dec5" class="of nc it os b gy pa ox l oy oz">const StoreProvider = ({ children }) =&gt; {<br/><strong class="os iu">  // Get state and dispatch from Reacts new API useReducer. </strong><br/>  const [state, dispatch] = useReducer(reducer, initialState);<br/><strong class="os iu">  // Get actions from useActions and pass it to Context</strong><br/>  const actions = useActions(state, dispatch);</span><span id="2166" class="of nc it os b gy pa ox l oy oz"><strong class="os iu">// Log new state<br/></strong>  useEffect(() =&gt; console.log({ newState: state })},[state]);</span><span id="293f" class="of nc it os b gy pa ox l oy oz"><strong class="os iu">// Render state, dispatch and special case actions<br/></strong>  return (<br/>    &lt;StoreContext.Provider value={{ state, dispatch, actions }}&gt;<br/>      {children}<br/>    &lt;/StoreContext.Provider&gt;<br/>  );<br/>};</span><span id="4abc" class="of nc it os b gy pa ox l oy oz">export { StoreContext, StoreProvider };</span></pre><p id="8fd7" class="pw-post-body-paragraph kr ks it kt b ku md kw kx ky me la lb lc mf le lf lg mg li lj lk mh lm ln kq im bi translated">ç°åœ¨ï¼Œæ‚¨å¯ä»¥åœ¨å¯¼å‡ºçš„StoreProviderçš„æ‰€æœ‰å­ç»„ä»¶ä¸­ä½¿ç”¨å’Œ<strong class="kt iu">ä¸Šä¸‹æ–‡</strong>ã€‚åªéœ€ç”¨useContext(StoreContext)åˆå§‹åŒ–å®ƒï¼Œå¹¶è·å¾—stateã€dispatchã€actionså¯¹è±¡ã€‚</p><h2 id="185d" class="of nc it bd nd og oh dn nh oi oj dp nl lc ok ol np lg om on nt lk oo op nx oq bi translated">App.js</h2><p id="f962" class="pw-post-body-paragraph kr ks it kt b ku nz kw kx ky oa la lb lc ob le lf lg oc li lj lk od lm ln kq im bi translated">æœ‰äº†è¿™äº›è®¾ç½®ï¼Œä½ å¯ä»¥æ¸…ç†ä½ çš„ç»„ä»¶äº†ï¼åªéœ€è¦ä¸€è¡Œä»£ç å°±å¯ä»¥è·å¾—çŠ¶æ€å’Œæ‰€æœ‰æ“ä½œã€‚</p><pre class="lx ly lz ma gt or os ot ou aw ov bi"><span id="d572" class="of nc it os b gy ow ox l oy oz">const { state, dispatch, actions } = useContext(StoreContext);</span></pre><p id="5764" class="pw-post-body-paragraph kr ks it kt b ku md kw kx ky me la lb lc mf le lf lg mg li lj lk mh lm ln kq im bi translated">åªè¦ç¡®ä¿App.jsæ˜¯ä»StoreContext.jså¯¼å‡ºçš„StoreProviderçš„å­å…ƒç´ å³å¯</p><pre class="lx ly lz ma gt or os ot ou aw ov bi"><span id="91c3" class="of nc it os b gy ow ox l oy oz"><strong class="os iu">//index.js</strong><br/>&lt;StoreProvider&gt;&lt;App/&gt;&lt;/StoreProvider&gt;</span></pre></div><div class="ab cl pi pj hx pk" role="separator"><span class="pl bw bk pm pn po"/><span class="pl bw bk pm pn po"/><span class="pl bw bk pm pn"/></div><div class="im in io ip iq"><p id="15e9" class="pw-post-body-paragraph kr ks it kt b ku md kw kx ky me la lb lc mf le lf lg mg li lj lk mh lm ln kq im bi translated">ç°åœ¨ï¼Œæˆ‘å·²ç»èŠ±äº†å¾ˆå¤šæ—¶é—´è¯•å›¾ä¸ºæˆ‘çš„ç”¨ä¾‹è§£å†³è¿™ä¸ªé—®é¢˜ï¼æˆ‘ç°åœ¨å·²ç»åœ¨ä¸€ä¸ªä¸­ç­‰è§„æ¨¡çš„åº”ç”¨ç¨‹åºä¸­å®ç°äº†è¿™ä¸€ç‚¹ï¼Œå¼€å‘è€…ä½“éªŒéå¸¸æ£’ï¼å¦‚æœä½ æœ‰ä»»ä½•æ‰¹è¯„ï¼Œé—®é¢˜æˆ–æ„è§ï¼Œå¹¶æƒ³åˆ†äº«ï¼Œè¯·è¿™æ ·åšï¼æˆ‘ä¸€ç›´åœ¨å¯»æ±‚æ”¹è¿›ğŸŒŸ</p></div></div>    
</body>
</html>