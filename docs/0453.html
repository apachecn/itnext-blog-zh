<html>
<head>
<title>Advanced React/Redux Techniques | How to Use Refs on Connected Components</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">é«˜çº§React/ReduxæŠ€æœ¯|å¦‚ä½•åœ¨è¿æ¥çš„ç»„ä»¶ä¸Šä½¿ç”¨å‚è€ƒ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/advanced-react-redux-techniques-how-to-use-refs-on-connected-components-e27b55c06e34?source=collection_archive---------2-----------------------#2018-03-12">https://itnext.io/advanced-react-redux-techniques-how-to-use-refs-on-connected-components-e27b55c06e34?source=collection_archive---------2-----------------------#2018-03-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4067" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†å¸¦æ‚¨äº†è§£å¦‚ä½•åœ¨Reactç»„ä»¶ä¸Šä½¿ç”¨refsï¼Œè¯¥ç»„ä»¶ä½¿ç”¨React-Redux APIè¿æ¥åˆ°Reduxå­˜å‚¨ã€‚</p><p id="c93f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä½†æ˜¯é¦–å…ˆï¼Œå…³äºå‚è€ƒæ–‡çŒ®çš„ä¸€ç‚¹èƒŒæ™¯â€¦</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/3d004682a0d1510ae00665a5a3ca0387.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ner81Yha3VWgCa_iXGNcg.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">ä¸â€¦ä¸æ˜¯é‚£ç§è£åˆ¤ã€‚</figcaption></figure><h2 id="ea6f" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">ä»€ä¹ˆæ˜¯è£åˆ¤ï¼Ÿ</h2><p id="b215" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨è¿‡å¼•ç”¨ï¼Œæˆ‘å¼ºçƒˆæ¨èä½ é˜…è¯»ä¸€ä¸‹<a class="ae lz" href="https://reactjs.org/docs/refs-and-the-dom.html" rel="noopener ugc nofollow" target="_blank"> Reactæ–‡æ¡£</a>æ¥ç†è§£å®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ä»¥åŠå®ƒä»¬çš„ç”¨é€”ï¼Œä½†æ˜¯ç®€è€Œè¨€ä¹‹ï¼Œå¼•ç”¨æ˜¯ä¸€ç§å­˜å‚¨å¯¹ç»„ä»¶å®ä¾‹ä¸Šçš„å¯¹è±¡çš„<em class="ma">å¼•ç”¨</em>çš„æ–¹å¼ã€‚</p><p id="1f0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å®ƒä»¬å¯ä»¥ç”¨æ¥å­˜å‚¨å¯¹DOMå…ƒç´ æˆ–å¦ä¸€ä¸ªç±»ç»„ä»¶å®ä¾‹çš„å¼•ç”¨ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å¿«é€Ÿæµè§ˆä¸€ä¸‹è¿™ä¸¤ä¸ªç”¨ä¾‹ã€‚</p><h2 id="834f" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">åœ¨DOMå…ƒç´ ä¸Šä½¿ç”¨å¼•ç”¨</h2><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="f3a4" class="lb lc iq mc b gy mg mh l mi mj">class VideoPlayer extends React.Component {</span><span id="dd11" class="lb lc iq mc b gy mk mh l mi mj"> constructor() {<br/>    super();<br/>    this.state = {<br/>      isPlaying: false,<br/>    }<br/>    this.handleVideoClick = this.handleVideoClick.bind(this);<br/>  }<br/>  <br/>  handleVideoClick() {<br/>    if (this.state.isPlaying) {<br/>      this.video.pause();<br/>    }<br/>    else {<br/>      this.video.play();<br/>    }<br/>    this.setState({ isPlaying: !this.state.isPlaying });<br/>  }<br/>  <br/>  render() {<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;video<br/>          ref={video =&gt; this.video = video}<br/>          onClick={this.handleVideoClick}<br/>        &gt;<br/>         &lt;source<br/>            src="some.url"<br/>            type="video/ogg"<br/>         /&gt;<br/>        &lt;/video&gt;<br/>      &lt;/div&gt;<br/>    )<br/>  }<br/>}</span></pre><p id="1149" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">åœ¨è¿™ä¸ªä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªéå¸¸åŸºæœ¬çš„è§†é¢‘æ’­æ”¾å™¨ç»„ä»¶ï¼Œæ¯å½“æ‚¨å•å‡»è§†é¢‘æ—¶ï¼Œå®ƒå°±ä¼šæ’­æ”¾å’Œæš‚åœè§†é¢‘ã€‚å› ä¸ºæˆ‘éœ€è¦ä½¿ç”¨HTML5 videoå…ƒç´ ä¸Šçš„play()å’Œpause()æ–¹æ³•æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥æˆ‘åœ¨componentå®ä¾‹ä¸Šå­˜å‚¨äº†ä¸€ä¸ªå¯¹è¯¥å…ƒç´ çš„å¼•ç”¨ã€‚è¿™æ ·ï¼Œæˆ‘å¯ä»¥æ ¹æ®éœ€è¦åœ¨å•å‡»å¤„ç†ç¨‹åºä¸­è®¿é—®è¿™äº›æ–¹æ³•ã€‚å¾ˆæ¼‚äº®ï¼Œå¯¹å§ï¼Ÿ</p><h2 id="4f47" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">åœ¨å…¶ä»–é›¶éƒ¨ä»¶å®ä¾‹ä¸Šä½¿ç”¨å‚ç…§</h2><p id="ebe7" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">æœ‰æ—¶ï¼Œæ‚¨ä¼šå¸Œæœ›åœ¨å¦ä¸€ä¸ªç»„ä»¶å®ä¾‹ä¸Šä½¿ç”¨refï¼Œè€Œä¸æ˜¯åœ¨DOMå…ƒç´ ä¸Šä½¿ç”¨refã€‚æˆ‘æœ€è¿‘åœ¨Reactå†…éƒ¨éœ€è¦ä½¿ç”¨<a class="ae lz" href="https://www.highcharts.com/" rel="noopener ugc nofollow" target="_blank"> Highcharts </a>æ—¶é‡åˆ°äº†è¿™ä¸ªç”¨ä¾‹ã€‚æ ¹æ®ä»–ä»¬ç½‘ç«™ä¸Šçš„Highchartsåšå®¢,ä½ å¯ä»¥ä½¿ç”¨ä»–ä»¬çš„åº“åœ¨Reactä¸­åˆ›å»ºå›¾è¡¨:</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="84af" class="lb lc iq mc b gy mg mh l mi mj">class HighchartComponent extends React.Component {<br/>  componentDidMount() {<br/>    this.chart = new Highcharts[this.props.type || 'Chart'](<br/>      this.props.container, <br/>      this.props.options<br/>    );<br/>  }<br/>  <br/>  componentWillUnmount() {<br/>    this.chart.destroy();<br/>  }<br/>  <br/>  render() {<br/>    return (<br/>      &lt;div id={this.props.container}&gt;&lt;/div&gt;<br/>    )<br/>  }<br/>}</span></pre><p id="b7b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¦‚æ‚¨æ‰€è§ï¼Œç”±Highchartsç”Ÿæˆçš„å›¾è¡¨å®ä¾‹å­˜å‚¨åœ¨HighchartsComponentå®ä¾‹ä¸­ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨æƒ³åœ¨è¿™ä¸ªç»„ä»¶ä¹‹å¤–è®¿é—®å›¾è¡¨(ä»¥åŠå…è®¸æ‚¨æ“ä½œå›¾è¡¨çš„æ‰€æœ‰æ–¹æ³•)ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬æƒ³è¦åˆ›å»ºä¸€ä¸ªæŒ‰é’®ï¼Œå½“ç‚¹å‡»å®ƒæ—¶ï¼Œä½¿ç”¨å†…ç½®çš„Highcharts APIæ¥é”€æ¯å›¾è¡¨ã€‚</p><p id="73f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¿™å°±æ˜¯è£åˆ¤å¯ä»¥æ´¾ä¸Šç”¨åœºçš„åœ°æ–¹ã€‚</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="afac" class="lb lc iq mc b gy mg mh l mi mj">const highchartsOptions = {<br/>  // ...highcharts options<br/>};</span><span id="e2b4" class="lb lc iq mc b gy mk mh l mi mj">class Container extends React.Component {<br/>  constructor() {<br/>    super();<br/>    this.handleButtonClick = this.handleButtonClick.bind(this);<br/>  }</span><span id="6c0a" class="lb lc iq mc b gy mk mh l mi mj">  handleButtonClick() {<br/>    if (this.highchartsComponent.chart) {<br/>      this.highchartsComponent.chart.destroy();<br/>    }<br/>  }<br/>  <br/>  render() {<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;HighchartsComponent<br/>          container="chart"<br/>          options={highchartsOptions}<br/>          ref={highchartsComponent =&gt;<br/>           this.highchartsComponent = highchartsComponent<br/>          }<br/>        /&gt;<br/>        &lt;button onClick={this.handleButtonClick}&gt;<br/>          Destroy Chart<br/>        &lt;/button&gt;<br/>      &lt;/div&gt;<br/>    )<br/>  }<br/>}</span></pre><p id="4a10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">åœ¨è¿™ä¸ªä»£ç ç‰‡æ®µä¸­ï¼ŒHighchartsComponentä¸Šçš„refå…è®¸æˆ‘åœ¨çˆ¶å®¹å™¨ç»„ä»¶ä¸Šå­˜å‚¨ä¸€ä¸ªå¯¹è¯¥å·²æŒ‚è½½ç»„ä»¶å®ä¾‹çš„å¼•ç”¨ã€‚è¿™å°±æ˜¯æˆ‘é€šè¿‡è°ƒç”¨æŒ‰é’®ç‚¹å‡»å¤„ç†ç¨‹åºä¸­çš„destroy()æ–¹æ³•æ¥è®¿é—®å®ƒçš„chartå±æ€§å¹¶åˆ©ç”¨Highcharts APIçš„æ–¹æ³•ã€‚</p><h2 id="63a4" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">åœ¨è¿æ¥çš„å…ƒä»¶ä¸Šä½¿ç”¨å‚ç…§</h2><p id="2079" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">å¥½å§â€¦é‚£ä¹ˆé€šè¿‡React-Redux connect() APIè¿æ¥åˆ°Redux storeçš„ç»„ä»¶å‘¢ï¼Ÿåº”è¯¥å¤Ÿç®€å•äº†å§ï¼Ÿ</p><p id="8b19" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è®©æˆ‘ä»¬ç»§ç»­å°†å‰ä¸€ä¸ªç¤ºä¾‹ä¸­çš„high chartsç»„ä»¶è¿æ¥åˆ°ä¸€ä¸ªå‡æƒ³çš„Reduxå•†åº—ã€‚</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="3f36" class="lb lc iq mc b gy mg mh l mi mj">connect()(HighchartsComponent);</span></pre><p id="8e24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç„¶åâ€¦æ‰€æœ‰ä¸œè¥¿éƒ½åæ‰äº†ã€‚ğŸ˜­</p><p id="9967" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¿™ä¸å†èµ·ä½œç”¨çš„åŸå› æ˜¯connect()æ˜¯ä¸€ä¸ªæ›´é«˜é˜¶çš„ç»„ä»¶ï¼Œå®ƒæ¥å—æ‚¨æä¾›ç»™å®ƒçš„ä»»ä½•ç»„ä»¶ï¼Œå¹¶è¿”å›ä¸€ä¸ªå…¨æ–°çš„ç»„ä»¶ã€‚å› æ­¤ï¼Œhighcartscomponentä¸Šçš„refç°åœ¨æŒ‡å‘è¿æ¥çš„ç»„ä»¶å®ä¾‹ï¼Œè€Œä¸æ˜¯highcartscomponentå®ä¾‹ã€‚å¦‚æœæˆ‘ä»¬è¯•å›¾è®¿é—®å›¾è¡¨å±æ€§ï¼Œå®ƒè‡ªç„¶ä¼šè¿”å›æœªå®šä¹‰ã€‚</p><p id="5c76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">é‚£ä¹ˆæˆ‘ä»¬èƒ½åšä»€ä¹ˆå‘¢ï¼Ÿå¹¸è¿çš„æ˜¯ï¼ŒReact-Redux APIæä¾›äº†ä¸€ç§è·å–åŒ…è£…ç»„ä»¶å®ä¾‹çš„æ–¹æ³•(åœ¨æœ¬ä¾‹ä¸­ï¼Œæ˜¯æˆ‘ä»¬çš„HighchartsComponent)ã€‚æ‚¨æ‰€è¦åšçš„å°±æ˜¯åœ¨connect()è°ƒç”¨ä¸­å°†withRefé€‰é¡¹è®¾ç½®ä¸ºtrue:</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="aa34" class="lb lc iq mc b gy mg mh l mi mj">connect(null, null, null, { withRef: true })(HighchartsComponent);</span></pre><p id="7527" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨getWrappedInstance()æ–¹æ³•æ¥â€¦æ‚¨çŒœå¯¹äº†â€¦è·å–åŒ…è£…çš„å®ä¾‹ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬ä¹‹å‰çš„ä¾‹å­çœ‹èµ·æ¥åƒè¿™æ ·:</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="1509" class="lb lc iq mc b gy mg mh l mi mj">class Container extends React.Component {<br/>  constructor() {<br/>    super();<br/>    this.handleButtonClick = this.handleButtonClick.bind(this);<br/>  }</span><span id="72c5" class="lb lc iq mc b gy mk mh l mi mj">  handleButtonClick() {<br/>    if (this.highchartsComponent.chart) {<br/>      this.highchartsComponent.chart.destroy();<br/>    }<br/>  }<br/>  <br/>  render() {<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;HighchartsComponent<br/>          container="chart"<br/>          options={chartOption}<br/>          ref={connectedComponent =&gt;<br/>            this.highchartsComponent =<br/>            connectedComponent.getWrappedInstance();<br/>          }<br/>        /&gt;<br/>        &lt;button onClick={this.handleButtonClick}&gt;<br/>          Destroy Chart<br/>        &lt;/button&gt;<br/>      &lt;/div&gt;<br/>    )<br/>  }<br/>}</span></pre><p id="7553" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä¸€åˆ‡æ­£å¸¸ï¼ğŸ‰</p><p id="8f54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">æ›´æ–°</strong>:ä»<code class="fe ml mm mn mc b">react-redux</code> &gt; = v6.0å¼€å§‹ï¼Œ<code class="fe ml mm mn mc b">withRef</code>å’Œ<code class="fe ml mm mn mc b">getWrappedInstance</code>è¢«å¼ƒç”¨ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯<code class="fe ml mm mn mc b">forwardRef</code> <a class="ae lz" href="https://react-redux.js.org/api/connect#forwardref-boolean" rel="noopener ugc nofollow" target="_blank">é€‰é¡¹</a>ï¼Œè¿™ç®€åŒ–äº†äº‹æƒ…ï¼Œå› ä¸ºæ‚¨ä¸å†éœ€è¦è°ƒç”¨getWrappedInstanceæ¥è·å¾—åŒ…è£…çš„ç»„ä»¶å®ä¾‹ã€‚</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/c55590dcb69b2baff779fb1a8e2815e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*q_WZ4r7UjTP8mK3I5dS0IA.jpeg"/></div></figure><p id="8c0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å®Œæ•´ä»£ç ï¼Œè¯·æŸ¥çœ‹<a class="ae lz" href="https://jsfiddle.net/jacobworrel/anqjxq95/30/" rel="noopener ugc nofollow" target="_blank"> JSfiddle </a>ã€‚</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><ol class=""><li id="1ba4" class="mw mx iq jp b jq jr ju jv jy my kc mz kg na kk nb nc nd ne bi translated">å¼•ç”¨ä¸é€‚ç”¨äºåŠŸèƒ½ç»„ä»¶ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰å®ä¾‹ã€‚</li><li id="ef42" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">Reactæ˜ç¡®è­¦å‘Šä¸è¦è¿‡åº¦ä½¿ç”¨refsï¼Œå› ä¸ºå®ƒä»¬é¿å¼€äº†å…¸å‹çš„è‡ªé¡¶å‘ä¸‹çš„æ•°æ®æµï¼Œä½†æ˜¯æˆ‘å‘ç°å®ƒä»¬åœ¨æˆ‘éœ€è¦è®¿é—®ç¬¬ä¸‰æ–¹APIçš„æƒ…å†µä¸‹ç‰¹åˆ«æœ‰ç”¨ã€‚</li></ol></div></div>    
</body>
</html>