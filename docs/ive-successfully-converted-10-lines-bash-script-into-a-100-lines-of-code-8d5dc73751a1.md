# æˆ‘å·²ç»æˆåŠŸåœ°å°† 10 è¡Œ Bash è„šæœ¬è½¬æ¢æˆäº† 100 è¡Œä»£ç 

> åŸæ–‡ï¼š<https://itnext.io/ive-successfully-converted-10-lines-bash-script-into-a-100-lines-of-code-8d5dc73751a1?source=collection_archive---------0----------------------->

![](img/1d1ed2a862091a3a9b30d55b79247a5a.png)

ç…§ç‰‡ç”± [Ales Krivec](https://unsplash.com/@aleskrivec?utm_source=medium&utm_medium=referral) åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„

æˆ‘æœ‰ 10 è¡Œ bash è„šæœ¬ï¼Œç”¨äºåœ¨å‘½ä»¤è¡Œä¸Šæ˜¾ç¤ºè™šæ‹Ÿæœºçš„ä¿¡æ¯ï¼Œä½œä¸ºè™šæ‹Ÿæœºå‘½ä»¤è¡Œç¨‹åºçš„ä¸€éƒ¨åˆ†ã€‚

æ­¤å‘½ä»¤ç”¨äºåœ¨å‘½ä»¤è¡Œä¸­åˆ—å‡ºè™šæ‹Ÿæœºä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
$ vermin ls
VM NAME  IMAGE           CPU  MEM     TAGS
vm_01    ubuntu/bionic   2    4096    spark kafka hadoop
vm_02    ubuntu/bionic   1    1024
vm_03    ubuntu/bionic   1    1024
```

æˆ‘é‡åˆ°çš„é—®é¢˜æ˜¯ï¼Œè¯¥è„šæœ¬ä¸ºæ¯ä¸ªæ˜¾ç¤ºä¿¡æ¯çš„è™šæ‹ŸæœºèŠ±è´¹äº†å¤§çº¦ **150 ms** ã€‚
åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå®ƒèŠ±è´¹äº†å¤§çº¦ **500 æ¯«ç§’ï¼Œ**å¦‚æœæˆ‘æœ‰æ›´å¤šè™šæ‹Ÿæœºï¼Œå®ƒå°†èŠ±è´¹æ›´å¤šæ—¶é—´ã€‚

åœ¨æˆ‘ä»¬ç»§ç»­æˆ‘ä¸ºæ”¹è¿›è„šæœ¬è¿è¡Œæ—¶é—´æ‰€åšçš„å·¥ä½œä¹‹å‰ï¼Œè®©æˆ‘ä»¬å±•ç¤ºä¸€ä¸‹ bash è„šæœ¬:

bash è„šæœ¬ç‰‡æ®µ

ä¸Šé¢çš„è„šæœ¬â€”â€”é™¤äº†è¯»å–ä¸€äº›æ–‡ä»¶â€”â€”è°ƒç”¨å‘½ä»¤`vboxmanage showinfo myvm --machinereadable`,è¿™æ˜¾ç„¶æ˜¯è„šæœ¬ä¸­æœ€è€—æ—¶çš„æŒ‡ä»¤ã€‚

å› æ­¤ï¼Œæˆ‘å†³å®šä¸ºæˆ‘æ‹¥æœ‰çš„æ¯ä¸ªè™šæ‹Ÿæœºå¹¶è¡Œè¿è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œè¿™æ ·å°±ä¸ç”¨èŠ±è´¹(**è™šæ‹Ÿæœºæ•°é‡* 150 æ¯«ç§’)**ï¼Œæ€»æ—¶é—´å¤§çº¦éœ€è¦ 150 æ¯«ç§’ã€‚

æˆ‘å†³å®šä½¿ç”¨ **Golang** ï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥åˆ©ç”¨å®ƒæƒŠäººçš„ goroutines æ¥å¹¶è¡Œè°ƒç”¨æˆ‘æ‰€æ‹¥æœ‰çš„è™šæ‹Ÿæœºçš„`vmboxmanage`å‘½ä»¤ã€‚

ä¸‹é¢æ˜¯[ä»£ç ä¸­ä¸](https://github.com/mhewedy/vermin/blob/6bf3ba223447a0b262faf51bb11cdbb0c1dddbf1/vms/list.go#L83-L103)ç›¸å…³çš„éƒ¨åˆ†:

```
**type** vmInfoList []*vmInfo
....
....numVms := len(vms)

infoList := make(vmInfoList, numVms)
**var** wg sync.WaitGroup
wg.Add(numVms)

**for** i, vmName := **range** vms {
   **go func**(vm string, i int) {
      infoList[i] = getVMInfo(vm)
      wg.Done()
   }(vmName, i)
}wg.Wait()
```

è¿™é‡Œçš„è¦ç‚¹æ˜¯ï¼Œæˆ‘åœ¨è™šæ‹Ÿæœºä¸Šå¾ªç¯ï¼Œå¯¹äºæ¯ä¸€ä¸ªè™šæ‹Ÿæœºï¼Œæˆ‘åœ¨ä¸€ä¸ªè°ƒç”¨å‘½ä»¤`vboxmanage`å¹¶æ‰§è¡Œå…¶ä»– I/O æ“ä½œå¹¶å°†`vmInfo`ç»“æ„è¿”å›ç»™è°ƒç”¨è€…çš„ goroutine(æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªè½»é‡çº§çº¿ç¨‹)ä¸­è°ƒç”¨`getVMInfo`ã€‚

ç„¶åï¼Œæˆ‘ä½¿ç”¨æ¥è‡ªæ¯ä¸ª goroutine çš„**é€šé“**å°†ç»“æœæ”¶é›†åˆ°ä¸€ä¸ª **select** è¯­å¥ä¸­ï¼Œè¯¥è¯­å¥å¸¦æœ‰ä¸€ä¸ªç­‰å¾…ç»“æœçš„å¾ªç¯ï¼Œä¸€æ—¦æˆ‘å¾—åˆ°äº†æ‰€æœ‰ç­‰å¾…çš„ç»“æœï¼Œæˆ‘å°±ä¸­æ–­ã€‚

è¿™å¦‚ä½•æé«˜æˆ‘çš„ç¨‹åºçš„æ€§èƒ½ï¼Ÿ

```
$ time vermin ls
VM NAME  IMAGE           CPU  MEM      TAGS
vm_01    ubuntu/bionic   2    4096     spark kafka hadoop
vm_02    ubuntu/bionic   1    1024
vm_03    ubuntu/bionic   1    1024vm ls 0.14s user 0.12s system 118% cpu 0.219 total
```

å¦‚å›¾æ‰€ç¤ºï¼Œæ€§èƒ½ä» **n * 150 æ¯«ç§’**(åœ¨æœ¬ä¾‹ä¸­å¤§çº¦ä¸º 450 åˆ° 500 æ¯«ç§’)ä¸Šå‡åˆ°å¤§çº¦ 220 æ¯«ç§’ã€‚

æˆ‘åœ¨ 5 ä¸ªè™šæ‹Ÿæœºä¸Šé‡å¤äº†ä¸Šé¢çš„å‘½ä»¤ï¼Œæˆ‘å¾—åˆ°äº†ä¸€ä¸ªç›¸ä¼¼çš„æ•°å­—ã€‚

ä½ å¯ä»¥åœ¨ [GitHub ä¸Šæ‰¾åˆ°å®Œæ•´çš„ 100 å¤šè¡Œä»£ç ã€‚](https://github.com/mhewedy/vm/blob/7d08c983387d6f92784c280490925a7cbc01dd14/vminfo/main.go)

ä½ å¯èƒ½è®¤ä¸º 500 æ¯«ç§’ç”šè‡³ 1 ç§’é’Ÿå¹¶ä¸ç®—é•¿ï¼Œä½†æ˜¯è®©æˆ‘å‘Šè¯‰ä½ ï¼Œ`*docker ps*`æ˜¾ç¤º 10 ä¸ªå®¹å™¨**çš„ä¿¡æ¯éœ€è¦ä¸åˆ° **100 æ¯«ç§’**ã€‚**

åœ¨æˆ‘å®Œæˆä¸Šé¢çš„ç¨‹åºåï¼Œæˆ‘æ„è¯†åˆ° VirtualBox(æˆ‘æ‰€ä¾èµ–çš„)ä½¿ç”¨ä¸€ä¸ª`XML`æ ¼å¼çš„æ–‡ä»¶æ¥å­˜å‚¨å…³äºæ¯ä¸ª VM çš„ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘å¯èƒ½ä¼šå°è¯•è¯»å–å’Œè§£æè¯¥æ–‡ä»¶ï¼Œç”šè‡³ä½¿ç¨‹åºæ›´å…·å“åº”æ€§ã€‚

é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œæˆ‘å†™ bash è„šæœ¬ç”¨äº† 10 ~ 15 åˆ†é’Ÿï¼Œè€Œ go ç¨‹åºèŠ±äº† 1 ~ 2 ä¸ªå°æ—¶:)ã€‚

ä¸‹é¢æ˜¯åŒ…å«æ•´ä¸ªç¨‹åºçš„ GitHub repo:
*(å¦‚æœä½ è®¤ä¸ºæœ‰ç”¨ï¼Œè¯·åœ¨é¡¹ç›®çš„ GitHub é¡µé¢ä¸Šæ‰“ä¸ªæ˜Ÿå·*ğŸš€)

[](https://github.com/mhewedy/vermin) [## mhewedy/å®³è™«

### ç›®å½•:å®³è™«æ˜¯ä¸€ä¸ªæ™ºèƒ½ï¼Œç®€å•å’Œå¼ºå¤§çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äº Linuxï¼ŒWindows å’Œ macOSã€‚å®ƒè¢«è®¾è®¡æˆâ€¦

github.com](https://github.com/mhewedy/vermin) 

æ›´æ–°:

åœ¨æˆ‘ç›´æ¥ä»`.vbox`æ–‡ä»¶ä¸­è¯»å–è™šæ‹Ÿæœºä¿¡æ¯åï¼Œç¨‹åºç°åœ¨æ­£åœ¨è¿è¡Œï¼Œ5 ä¸ªè™šæ‹Ÿæœºåªéœ€è¦ä¸åˆ° **80 æ¯«ç§’**ã€‚

```
$ time vermin ls
VM NAME  IMAGE           CPU  MEM      TAGS
vm_01    ubuntu/bionic   2    4096      spark kafka hadoop
vm_02    ubuntu/bionic   1    1024
vm_03    ubuntu/bionic   1    1024
vm_04    ubuntu/bionic   1    1024
vm_05    ubuntu/bionic   1    1024vm ls  0.03s user 0.03s system 76% cpu 0.077 total
```

æ›´æ–° 2:

æˆ‘å·²ç»æ ¹æ® Reddit ä¸­[è¯„è®ºçš„å»ºè®®ï¼Œå°†ä»£ç ä»ä½¿ç”¨é€šé“å’Œé€‰æ‹©å™¨æ”¹ä¸ºç®€å•ä½¿ç”¨`WaitGroup`ã€‚](https://www.reddit.com/r/golang/comments/gpdmb4/ive_successfully_converted_10_lines_bash_script/)