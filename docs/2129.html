<html>
<head>
<title>Deploying a Rails App to ECS with an Nginx Sidecar Container</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨Nginx Sidecarå®¹å™¨å°†Railsåº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°ECS</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/deploying-a-rails-app-with-an-nginx-sidecar-container-to-ecs-cbc3b0a2c690?source=collection_archive---------1-----------------------#2019-04-05">https://itnext.io/deploying-a-rails-app-with-an-nginx-sidecar-container-to-ecs-cbc3b0a2c690?source=collection_archive---------1-----------------------#2019-04-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/c247c90f26613de8b484b0f9380c52dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6ZxRsoCfJyv-O1Y4JAPraA.png"/></div></div></figure><p id="4900" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æˆ‘çš„ä»»åŠ¡æ˜¯ä¸ºECSéƒ¨ç½²ä¸€ä¸ªrailsåº”ç”¨ç¨‹åºï¼Œitnext.ioä¸Šçš„è¿™ç¯‡æ–‡ç« è®©æˆ‘å®Œæˆäº†80%ã€‚</p><p id="c9a8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æˆ‘æƒ³æˆ‘ä¼šåˆ†äº«æˆ‘ç”¨nginx sidecaråœ¨ECSä¸Šè¿è¡Œè¿™ä¸ªrailsåº”ç”¨ç¨‹åºçš„æœ€åæ­¥éª¤ã€‚</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h1 id="ec41" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">(ä¸€äº›)å·®å¼‚</h1><p id="32ae" class="pw-post-body-paragraph kb kc it kd b ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku mj kw kx ky im bi translated">æˆ‘æ²¡æœ‰ä½¿ç”¨Docker Composeã€‚Docker Composeä¸èƒ½å¾ˆå¥½åœ°ä¸ECSä¸€èµ·è¿è¡Œï¼Œè‡³å°‘ä¸èƒ½ä»¥æˆ‘ä½¿ç”¨å®ƒçš„æ–¹å¼è¿è¡Œã€‚</p><p id="bc0c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">NGINXå’Œæˆ‘çš„Railsåº”ç”¨ç¨‹åºä»ä¸€ä¸ªå…±äº«ç›®å½•åŠ è½½æ–‡ä»¶éœ€è¦å·ã€‚</p><h2 id="9362" class="mk li it bd lj ml mm dn ln mn mo dp lr km mp mq lv kq mr ms lz ku mt mu md mv bi translated">Railsåº”ç”¨ç¨‹åºè®¾ç½®</h2><p id="a7ec" class="pw-post-body-paragraph kb kc it kd b ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku mj kw kx ky im bi translated">é¦–å…ˆï¼Œå‘railsåº”ç”¨ç¨‹åºæ·»åŠ ä¸€ä¸ªdockeræ–‡ä»¶ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="f446" class="mk li it nb b gy nf ng l nh ni">FROM ruby:2.6.1-alpine</span><span id="795d" class="mk li it nb b gy nj ng l nh ni">RUN apk add --update \<br/>    make \<br/>    g++ \<br/>    musl-dev \<br/>    gcc \<br/>    libc-dev \<br/>    file \<br/>    git \<br/>    postgresql-dev \<br/>    tzdata</span><span id="e31e" class="mk li it nb b gy nj ng l nh ni">#Install rails_application</span><span id="0904" class="mk li it nb b gy nj ng l nh ni">ENV APPLICATION_NAME rails_application</span><span id="b543" class="mk li it nb b gy nj ng l nh ni">RUN mkdir -p /var/www/rails_application</span><span id="e661" class="mk li it nb b gy nj ng l nh ni">WORKDIR /var/www/rails_application</span><span id="4750" class="mk li it nb b gy nj ng l nh ni">COPY Gemfile Gemfile.lock /var/www/rails_application/</span><span id="52bc" class="mk li it nb b gy nj ng l nh ni">RUN gem install bundler</span><span id="56f6" class="mk li it nb b gy nj ng l nh ni">RUN bundle install</span><span id="0db9" class="mk li it nb b gy nj ng l nh ni">COPY . .</span><span id="9d86" class="mk li it nb b gy nj ng l nh ni">VOLUME /var/www/rails_application/</span><span id="f743" class="mk li it nb b gy nj ng l nh ni">VOLUME /etc/nginx/</span><span id="47ec" class="mk li it nb b gy nj ng l nh ni">RUN apk del make \<br/>    g++ \<br/>    musl-dev \<br/>    gcc \<br/>    libc-dev \<br/>    file \<br/>    git</span><span id="ca7e" class="mk li it nb b gy nj ng l nh ni">EXPOSE 8080</span><span id="6398" class="mk li it nb b gy nj ng l nh ni">RUN chmod +x app_start.sh</span><span id="6d0b" class="mk li it nb b gy nj ng l nh ni">ENTRYPOINT ["sh", "app_start.sh"]</span></pre><p id="c54c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æˆ‘ä½¿ç”¨äº†alpineå¹¶ç§»é™¤äº†ç¼–è¯‘å™¨ä»¥èŠ‚çœç©ºé—´ã€‚æ­¤å¤–ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°æˆ‘ä½¿ç”¨äº†ä¸€ä¸ªshellè„šæœ¬æ¥å¯åŠ¨åº”ç”¨ç¨‹åºâ€”â€”ç¨åä¼šè¯¦ç»†ä»‹ç»ã€‚</p><h2 id="0d16" class="mk li it bd lj ml mm dn ln mn mo dp lr km mp mq lv kq mr ms lz ku mt mu md mv bi translated">NGINXè®¾ç½®</h2><p id="b2c6" class="pw-post-body-paragraph kb kc it kd b ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku mj kw kx ky im bi translated">æˆ‘åœ¨ä¸€ä¸ªå•ç‹¬çš„repoä¸­è®¾ç½®äº†æˆ‘çš„nginx sidecaråº”ç”¨ç¨‹åºã€‚nginx repoçš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹æ‰€ç¤º:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="8a8c" class="mk li it nb b gy nf ng l nh ni">-rails_application-nginx<br/>    -dockerfile<br/>    -nginx.conf<br/>    -nginx (directory)<br/>        -application.conf</span></pre><p id="4b04" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ä¸‹é¢æ˜¯æˆ‘çš„nginx dockerfileæ–‡ä»¶çš„æ ·å­:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="d93e" class="mk li it nb b gy nf ng l nh ni"># Base image<br/>FROM nginx</span><span id="adbb" class="mk li it nb b gy nj ng l nh ni">RUN apt-get update -qq &amp;&amp; apt-get -y install apache2-utils &amp;&amp; apt-get install -y vim</span><span id="3990" class="mk li it nb b gy nj ng l nh ni"># Copy Nginx config template<br/>COPY nginx/application.conf /etc/nginx/conf.d/default.conf<br/>VOLUME /var/www/rails_application/<br/></span></pre><p id="b31d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ä¸‹é¢æ˜¯nginx.conf:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="5bbf" class="mk li it nb b gy nf ng l nh ni">worker_processes  auto;</span><span id="f915" class="mk li it nb b gy nj ng l nh ni">error_log  /var/log/nginx/error.log warn;<br/>pid        /var/run/nginx.pid;</span><span id="511a" class="mk li it nb b gy nj ng l nh ni">events {<br/>    worker_connections  1024;<br/>}</span><span id="a709" class="mk li it nb b gy nj ng l nh ni">http {<br/>    include       /etc/nginx/mime.types;<br/>    default_type  application/octet-stream;</span><span id="e68a" class="mk li it nb b gy nj ng l nh ni">log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '<br/>                      '$status $body_bytes_sent "$http_referer" '<br/>                      '"$http_user_agent" "$http_x_forwarded_for"';</span><span id="0ec3" class="mk li it nb b gy nj ng l nh ni">access_log /var/log/nginx/access.log  main;</span><span id="7f3f" class="mk li it nb b gy nj ng l nh ni">sendfile        on;</span><span id="b6fc" class="mk li it nb b gy nj ng l nh ni">keepalive_timeout  14;</span><span id="9a8c" class="mk li it nb b gy nj ng l nh ni">proxy_http_version 1.1;</span><span id="7dbd" class="mk li it nb b gy nj ng l nh ni">include conf.d/*.conf;<br/>}</span></pre><p id="5cc2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">è¿™æ˜¯æˆ‘çš„ç”³è¯·ã€‚</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="eea7" class="mk li it nb b gy nf ng l nh ni">server {<br/>    listen       80;</span><span id="af9c" class="mk li it nb b gy nj ng l nh ni">    add_header X-Cache-Status $upstream_cache_status;</span><span id="f9d4" class="mk li it nb b gy nj ng l nh ni">    underscores_in_headers on;</span><span id="9155" class="mk li it nb b gy nj ng l nh ni">    error_page  404              /404.html;<br/>    error_page  403              /403.html;<br/>    error_page  500 502 503 504  /500.html;</span><span id="1300" class="mk li it nb b gy nj ng l nh ni">    location /health-czech {<br/>         return 200 'ok';<br/>        }</span><span id="6e1d" class="mk li it nb b gy nj ng l nh ni">    include  /etc/nginx/mime.types;</span><span id="5e9c" class="mk li it nb b gy nj ng l nh ni">    root  /var/www/rails_application/public;</span><span id="a24d" class="mk li it nb b gy nj ng l nh ni">    location / {<br/>          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br/>          proxy_set_header Host $http_host;</span><span id="49a9" class="mk li it nb b gy nj ng l nh ni">    if (-f $request_filename) {<br/>            break;<br/>         }</span><span id="180c" class="mk li it nb b gy nj ng l nh ni">    if ( !-f $request_filename ) {<br/>        proxy_pass <a class="ae kz" href="http://127.0.0.1:8080" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8080</a>;<br/>        break;<br/>       }<br/>    }<br/> }</span></pre><h1 id="174b" class="lh li it bd lj lk nk lm ln lo nl lq lr ls nm lu lv lw nn ly lz ma no mc md me bi translated">è®¾ç½®ECS</h1><p id="a6a8" class="pw-post-body-paragraph kb kc it kd b ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku mj kw kx ky im bi translated">ç¬¬ä¸€ä»¶äº‹æ˜¯å°†åº”ç”¨ç¨‹åºæ¨é€åˆ°ECR(å¼¹æ€§å®¹å™¨æ³¨å†Œä¸­å¿ƒ)ã€‚åœ¨æ‚¨çš„AWSå¸æˆ·ä¸­ï¼Œå¯¼èˆªåˆ°ECRï¼Œæˆ–è€…åªéœ€ç‚¹å‡»æ­¤é“¾æ¥å¹¶ä»”ç»†æ£€æŸ¥æ‚¨æ˜¯å¦åœ¨æ­£ç¡®çš„åœ°åŒº:ã€https://us-west-2.console.aws.amazon.com/ecr/repositories T2ã€‘</p><p id="c816" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ä¸€æ—¦æ‚¨åˆ›å»ºäº†æ–°çš„å›è´­åè®®ï¼Œå¦‚æœæ‚¨å®‰è£…äº†AWS CLIï¼Œé€šè¿‡â€œ<strong class="kd iu">æŸ¥çœ‹æ¨é€å‘½ä»¤</strong>â€æŒ‰é’®ä¸Šä¼ æ˜¯ä¸€ä¸ªç®€å•çš„é€‰é¡¹ã€‚æˆ‘æœ‰ä¸€ä¸ªç”¨äºæ›´æ–°æˆ‘çš„å›è´­çš„å°è„šæœ¬(æ³¨æ„:æˆ‘é€šè¿‡é…ç½®æ–‡ä»¶å‘½ä»¤è®¾ç½®æˆ‘çš„åœ°åŒº):</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="dd48" class="mk li it nb b gy nf ng l nh ni">#!/bin/bash</span><span id="bf7b" class="mk li it nb b gy nj ng l nh ni">if (( "$#" != 1 ))<br/>then<br/>    echo "Usage:<br/>./ecr_push [environment]"<br/>exit 1<br/>fi</span><span id="175d" class="mk li it nb b gy nj ng l nh ni">if [[ $@ != acceptance &amp;&amp; $@ != staging &amp;&amp; $@ != production ]] ;<br/>then<br/>  echo "Environment must be either Acceptance, Staging or Production."<br/>  exit 1<br/>elif [[ $@ = staging || acceptance ]] ;<br/>then<br/> AWS_ACCOUNT=XXXXXXXXXXXX<br/>elif [[ $@ = production ]] ;<br/>then<br/>  AWS_ACCOUNT=XXXXXXXXXXXX<br/>fi</span><span id="1e6c" class="mk li it nb b gy nj ng l nh ni">REPO="$AWS_ACCOUNT.dkr.ecr.us-west-2.amazonaws.com/rails_application-$@"<br/>IMAGE=$REPO:latest-$@</span><span id="7527" class="mk li it nb b gy nj ng l nh ni">$(aws ecr get-login --no-include-email --region $AWS_REGION)<br/>docker build -t $IMAGE .<br/>docker push $IMAGE</span></pre><p id="262e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ä¸€æ—¦æ‚¨çš„NGINXå’ŒRailsåº”ç”¨ç¨‹åºreposè¢«æ·»åŠ åˆ°ECRï¼Œæ‚¨å°±å¯ä»¥è®¾ç½®<strong class="kd iu">ä»»åŠ¡å®šä¹‰</strong>ã€‚æ‚¨å°†é¢ä¸´çš„ç¬¬ä¸€ä¸ªé€‰æ‹©æ˜¯FARGATEæˆ–EC2ã€‚æˆ‘å¿…é¡»æ»¡è¶³çš„ä¸€ä¸ªè¦æ±‚æ˜¯èƒ½å¤Ÿsshåˆ°è¿è¡Œæˆ‘çš„railså’Œnginxåº”ç”¨çš„å®¹å™¨ä¸­ï¼Œæ‰€ä»¥æˆ‘ç”¨EC2ï¼Œå› ä¸ºä½ ä¸èƒ½sshåˆ°fargateã€‚</p><p id="393b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">å¦‚æœæ‚¨ä»¥å‰ä½¿ç”¨è¿‡ECSï¼Œæ‚¨å¯èƒ½å·²ç»æœ‰äº†ä¸€ä¸ªå¯ä¾›é€‰æ‹©çš„ä»»åŠ¡è§’è‰²ã€‚AWSè‡ªåŠ¨ç”Ÿæˆçš„é‚£ä¸ªå«åšâ€œ<strong class="kd iu">ecstaxecutionrole</strong>â€ã€‚</p><p id="c5cf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ä¸ºäº†è®©æ‚¨çš„å®¹å™¨åœ¨åŒä¸€å®ä¾‹ä¸Šç›¸äº’é€šä¿¡ï¼Œæ‚¨å¿…é¡»é€‰æ‹©â€œ<strong class="kd iu">ä¸»æœº</strong>â€ä½œä¸º<strong class="kd iu">ç½‘ç»œæ¨¡å¼</strong>ã€‚</p><p id="189d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æ¥ä¸‹æ¥ï¼Œåœ¨åº•éƒ¨ï¼Œç‚¹å‡»â€œæ·»åŠ éŸ³é‡â€æŒ‰é’®ã€‚ç»™è¯¥å·èµ·ä¸€ä¸ª<strong class="kd iu">å</strong>ï¼Œä½†æ˜¯æ·»åŠ <strong class="kd iu">è·¯å¾„</strong>æ˜¯ä¸å¿…è¦çš„ã€‚</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/992a0953c141a646c0fbdc958b00bdfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SD6OPCz_uVeWZX1Hz8qUXw.png"/></div></div></figure><p id="814c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è®¾ç½®æˆ‘ä»¬çš„å®¹å™¨ã€‚æˆ‘æ‰“ç®—ä½¿ç”¨â€œt3.microâ€å®ä¾‹æ¥è¿è¡Œå®¹å™¨ï¼Œå› æ­¤æˆ‘ç›¸åº”åœ°æŒ‡å®šäº†CPUå•å…ƒå’Œå†…å­˜åˆ†é…ã€‚æˆ‘ä¼šè®©æˆªå›¾åšå¤§éƒ¨åˆ†çš„è§£é‡Šã€‚</p><h2 id="5670" class="mk li it bd lj ml mm dn ln mn mo dp lr km mp mq lv kq mr ms lz ku mt mu md mv bi translated">Rails _åº”ç”¨ç¨‹åºå®¹å™¨</h2><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nq"><img src="../Images/39d008e45f00be9d6f3caae9da6d1513.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QgSrqnE5q4_SuyRfg2Q4tg.png"/></div></div></figure><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nr"><img src="../Images/4e4b36f276c3403a8e200f72336f4f6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kn5o3AZj-SG-d0E0Pd1-jQ.png"/></div></div></figure><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ns"><img src="../Images/b73e4d14fdd9339839827fd360dbb837.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TyGyOSWikjKczRwoSxWFtw.png"/></div></div></figure><h2 id="bcf2" class="mk li it bd lj ml mm dn ln mn mo dp lr km mp mq lv kq mr ms lz ku mt mu md mv bi translated">NGINXå®¹å™¨</h2><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nt"><img src="../Images/6a998441e8dcf8a9c000d7115b1753c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nZLKTh7t3upch9UfG_hv6g.png"/></div></div></figure><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nu"><img src="../Images/038bdfa4b366316918cd3a35bf870aec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kFxUeJkxuUy5UB5s_B8gLQ.png"/></div></div></figure><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nv"><img src="../Images/c8131dc55c288539de7ce9fc238bc96c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Gva0Au2CdYpxtkexnth1Q.png"/></div></div></figure><p id="a7fa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ä¸€äº›å¤§çš„è¦ç‚¹å¦‚ä¸‹:<br/>rails _ applicationå®¹å™¨å°†ä½¿ç”¨ç«¯å£8080ï¼Œnginxå®¹å™¨è¢«åˆ†é…äº†ç«¯å£80ã€‚<br/>ä¸¤ä¸ªå®¹å™¨éƒ½å°†å…±äº«rails_applicationå·ï¼Œå¹¶å°†/var/www/rails_applicationä½œä¸ºæŒ‚è½½è·¯å¾„ã€‚</p><p id="42e8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">å¦å¤–ï¼Œè¯·æ³¨æ„èµ·å§‹å‹è¾¹ã€‚Nginxç”¨é€”:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="0536" class="mk li it nb b gy nf ng l nh ni">nginx,-g,daemon off;</span></pre><p id="0e03" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">å½“railsåº”ç”¨ç¨‹åºä½¿ç”¨å…¥å£ç‚¹é€‰é¡¹å¹¶è¿è¡Œè¿™ä¸ªè„šæœ¬æ—¶:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="80b9" class="mk li it nb b gy nf ng l nh ni">sh,app_start.sh</span></pre><p id="dceb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">è¿™ä¸ªè„šæœ¬æ˜¯rails_application repoçš„ä¸€éƒ¨åˆ†ï¼Œéå¸¸ç®€å•:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="5d47" class="mk li it nb b gy nf ng l nh ni">#!/bin/sh<br/>bundle exec rake assets:precompile<br/>bundle exec puma -C config/puma.rb</span></pre><p id="453e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">è¿™ä¸ªç‰¹æ®Šçš„railsåº”ç”¨ç¨‹åºéœ€è¦é¢„ç¼–è¯‘é™æ€èµ„äº§ï¼Œç„¶åé€šè¿‡pumaå¯åŠ¨åº”ç”¨ç¨‹åºã€‚å…¶ä»–ä¸éœ€è¦èµ„äº§é¢„ç¼–è¯‘çš„railsåº”ç”¨ç¨‹åºå¯ä»¥åœ¨ä»»åŠ¡å®šä¹‰çš„ç¯å¢ƒéƒ¨åˆ†ä½¿ç”¨å‘½ä»¤å­—æ®µï¼Œè€Œä¸æ˜¯å…¥å£ç‚¹ï¼Œå‘½ä»¤å¦‚ä¸‹:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="6973" class="mk li it nb b gy nf ng l nh ni">bundle,exec,puma,-t,0:5,-w,4,-b,tcp://127.0.0.1:8080</span></pre><p id="0663" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">å¦‚æœæ‚¨ä¸æƒ³é€šè¿‡puma.rbæ–‡ä»¶è®¾ç½®çº¿ç¨‹å’Œå·¥ä½œçº¿ç¨‹ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p><h2 id="a392" class="mk li it bd lj ml mm dn ln mn mo dp lr km mp mq lv kq mr ms lz ku mt mu md mv bi translated">é›†ç¾¤éƒ¨ç½²</h2><p id="58b6" class="pw-post-body-paragraph kb kc it kd b ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku mj kw kx ky im bi translated">å½“è®¾ç½®æ‚¨çš„é›†ç¾¤æ—¶ï¼Œæ‚¨å°†é€‰æ‹©<strong class="kd iu"> EC2 Linux +ç½‘ç»œ</strong>æ¨¡æ¿é€‰é¡¹ã€‚</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nw"><img src="../Images/45f12ca1b219824907b2b9eb0540fec8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aDnyvlpeczjiLlLD35YlMA.png"/></div></div></figure><p id="eb66" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ä¸€æ—¦æ‚¨é…ç½®äº†æ‚¨çš„é›†ç¾¤ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿå¯åŠ¨ä¸€ä¸ªæ–°çš„ä»»åŠ¡ã€‚(æ³¨æ„:å¯¹äºæœ¬æ•™ç¨‹ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯<strong class="kd iu">ä»»åŠ¡</strong>é€‰é¡¹ï¼Œè€Œä¸æ˜¯è®¾ç½®<strong class="kd iu">æœåŠ¡</strong>ï¼Œè¿™éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯å¯¹äºè‡ªåŠ¨ç¼©æ”¾ï¼Œä½†éœ€è¦é¢å¤–çš„è§£é‡Š)ã€‚</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nx"><img src="../Images/935e9bb10cafafc2a7a0fe96661ccfd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HBXpT6WU5x__g5-MtXV3lQ.png"/></div></div></figure><p id="6710" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">åœ¨<strong class="kd iu">è¿è¡Œä»»åŠ¡</strong>é…ç½®é¡µé¢ï¼Œé€‰æ‹©<strong class="kd iu"> EC2 </strong>ä½œä¸ºå¯åŠ¨ç±»å‹ï¼Œç„¶åé€‰æ‹©æ‚¨åˆšåˆšåˆ›å»ºçš„ä»»åŠ¡å®šä¹‰ã€‚é›†ç¾¤åº”è¯¥æ˜¯é¢„å…ˆé€‰æ‹©çš„ï¼Œå¹¶ä¸”æ˜¯æ­£ç¡®çš„ï¼Œå› æ­¤æ‚¨åªéœ€ç‚¹å‡»é¡µé¢å³ä¸‹è§’çš„è¿è¡Œä»»åŠ¡æŒ‰é’®ã€‚å¦‚æœæ‚¨å¾—åˆ°ä¸€ä¸ªâ€œRun tasks failedâ€é”™è¯¯ï¼Œå¾ˆå¯èƒ½æ˜¯æ‚¨çš„ä»»åŠ¡å®šä¹‰çš„CPU/RAMåˆ†é…å’ŒEC2å®ä¾‹ç±»å‹é€‰é¡¹ä¹‹é—´çš„é—®é¢˜ã€‚</p><p id="4db5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">å¸Œæœ›æ‚¨ä¸ä¼šé‡åˆ°ä»»ä½•é˜»ç¢ï¼Œå¹¶ä¸”æ‚¨çš„ä»»åŠ¡çš„â€œæœ€åçŠ¶æ€â€æ˜¯<strong class="kd iu">æ­£åœ¨è¿è¡Œ</strong>ï¼</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/c6e2b68c955467d419a55440d9da9568.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*z6ZRamVS924Bf17ZNtfsFQ.png"/></div></figure><p id="b84d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">å‡è®¾æ‚¨å·²ç»è®¾ç½®äº†è´Ÿè½½å¹³è¡¡å™¨å’Œç›®æ ‡ç»„ï¼Œå‘è¯¥ç›®æ ‡ç»„æ·»åŠ äº†æ–°çš„ECSå®¹å™¨å®ä¾‹ï¼Œæ­£ç¡®è®¾ç½®äº†è¯¥ç›®æ ‡ç»„çš„å¥åº·æ£€æŸ¥è·¯å¾„(åœ¨å¯èƒ½çš„æƒ…å†µä¸‹æ˜¯â€œ/health-czechâ€)ï¼Œå¹¶æ­£ç¡®é…ç½®äº†æ‚¨çš„å®‰å…¨ç»„ï¼Œé‚£ä¹ˆæ‚¨çš„åº”ç”¨ç¨‹åºåº”è¯¥å·²ç»å¯åŠ¨å¹¶å¯è®¿é—®ã€‚</p><p id="5086" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">è¡ŒåŠ¨æ„‰å¿«ğŸ˜Š</p></div></div>    
</body>
</html>