<html>
<head>
<title>Kong Proof-of-Concept using Minikube</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kongä½¿ç”¨Minikubeè¿›è¡Œæ¦‚å¿µéªŒè¯</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/kong-proof-of-concept-using-minikube-5f8ca932083f?source=collection_archive---------5-----------------------#2019-11-26">https://itnext.io/kong-proof-of-concept-using-minikube-5f8ca932083f?source=collection_archive---------5-----------------------#2019-11-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><h1 id="3089" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">å¦‚ä½•åœ¨å¤§çº¦15åˆ†é’Ÿå†…å®Œæˆæ¦‚å¿µéªŒè¯</h1><p id="61f6" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">æœ¬æŒ‡å—æ˜¯å¯¹æˆ‘ä¹‹å‰çš„ä¸€ä¸ªæ•…äº‹çš„æ›´æ–°ã€‚</p><p id="a11b" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">ä¸ºä»€ä¹ˆæ˜¯å¦ä¸€ä¸ªå‘å¯¼ï¼Ÿå› ä¸ºå®ƒä»¥æ›´ç®€å•çš„æ–¹å¼è§£å†³äº†åŒæ ·çš„é—®é¢˜ã€‚<br/>ä¸€èˆ¬æ¥è¯´ï¼Œç®€åŒ–æ˜¯æå–ä¿¡æ¯çš„è‰ºæœ¯ã€‚è¿™éƒ½æ˜¯å…³äºç»„ç»‡æƒ³æ³•å’Œæ¦‚å¿µï¼Œåªæå–æœ‰æ„ä¹‰çš„éƒ¨åˆ†ã€‚</p><p id="fb9e" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">æœ¬æŒ‡å—å°†å¸¦æ‚¨äº†è§£ä¸€ä¸ªä»å¤´å¼€å§‹è®¾ç½®APIç½‘å…³çš„å·¥ä½œç¤ºä¾‹ï¼Œè¯¥ç½‘å…³å°†ä½¿ç”¨JWTå’ŒACLæ¥æˆæƒç”¨æˆ·è®¿é—®ç«¯ç‚¹ã€‚å…¶ä»–éƒ¨åˆ†å¯å‚è€ƒ<a class="ae lm" href="https://docs.konghq.com/" rel="noopener ugc nofollow" target="_blank">å­”ä¼˜ç§€æ–‡æ¡£</a>ã€‚</p><blockquote class="ls lt lu"><p id="c96c" class="ko kp lv kq b kr ln kt ku kv lo kx ky lw lp lb lc lx lq lf lg ly lr lj lk ll im bi translated">"ç®€å•æ˜¯æœ€é«˜çº§çš„å¤æ‚ã€‚"è±æ˜‚çº³å¤šÂ·è¾¾Â·èŠ¬å¥‡(1452-1519)</p></blockquote><h1 id="109f" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">ä¸Šä¸‹æ–‡:ç ”ç©¶ä¸åŒçš„APIç½‘å…³</h1><p id="ad46" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">åœ¨Sumupä¸Šï¼Œæˆ‘ä»¬å¸Œæœ›ç ”ç©¶ä¸åŒçš„APIç½‘å…³ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ­£åœ¨æ„å»ºAPIæœåŠ¡ï¼Œéœ€è¦åŸºäºè§’è‰²å…è®¸æˆ–é™åˆ¶æŸäº›è°ƒç”¨ï¼Œä½¿ç”¨JWTsã€é€Ÿç‡é™åˆ¶ç­‰èº«ä»½éªŒè¯ä»¤ç‰Œã€‚ç®€è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›å¾®æœåŠ¡è¯·æ±‚ç½‘å…³ï¼Œé€šè¿‡æ’ä»¶å¤„ç†è´Ÿè½½å¹³è¡¡ã€æ—¥å¿—è®°å½•ã€è®¤è¯ã€é€Ÿç‡é™åˆ¶ã€è½¬æ¢ç­‰ç­‰ã€‚<a class="ae lm" href="https://konghq.com/wp-content/uploads/2019/01/GigaOm-API-Platform-Benchmark-Kong-Apigee-1-25-19-1.pdf" rel="noopener ugc nofollow" target="_blank">å½“ç„¶è¿™ä¸ªåº”è¯¥å¯ä»¥ç¼©æ”¾</a>ã€‚</p><p id="14b9" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">æˆ‘å’Œ@limoges å†³å®šå»ºç«‹ä¸€ä¸ªå¿«é€Ÿçš„æ¦‚å¿µéªŒè¯æ¥å±•ç¤ºåƒKongè¿™æ ·çš„å·¥å…·çš„èƒ½åŠ›ã€‚è¿™ç¯‡æ–‡ç« æ˜¯åœ¨ä»–çš„å¸®åŠ©ä¸‹å®Œæˆå’Œå®¡é˜…çš„ã€‚</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi lz"><img src="../Images/280b22f905d8b9e25c27ca3cfeb6bc38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BvWSxhKOISHh55hI"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">â€œè€åŠæ³•â€å¯¹å­”</figcaption></figure><blockquote class="ls lt lu"><p id="b857" class="ko kp lv kq b kr ln kt ku kv lo kx ky lw lp lb lc lx lq lf lg ly lr lj lk ll im bi translated">å…³äºæ’ä»¶å’Œé›†æˆçš„æ›´å¤šä¿¡æ¯ï¼Œä½ å¯ä»¥æŸ¥çœ‹<a class="ae lm" href="https://docs.konghq.com/hub/" rel="noopener ugc nofollow" target="_blank"> Kong Hub </a>ã€‚</p></blockquote><h1 id="af74" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">ä¸ºå­”åšä¸€ä¸ªå±•ç¤º</h1><p id="4bf6" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">åœ¨è¿›ä¸€æ­¥è®¨è®ºAPIç½‘å…³ä¹‹å‰ï¼Œæˆ‘ä»¬å¸Œæœ›åˆ›å»ºä¸€ä¸ªæ¦‚å¿µéªŒè¯ï¼Œä»¥ä¾¿å¯¹é—®é¢˜ç©ºé—´å’Œå¯ç”¨å·¥å…·è¿›è¡Œè‡ªæˆ‘æ•™è‚²ã€‚</p><p id="99e0" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">æœ¬æŒ‡å—æ˜¯ä¸€ä¸ªç®€çŸ­çš„ç¤ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•åœ¨ä¸€ä¸ªç¤ºä¾‹åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨setup Kongã€‚åœ¨SumUpï¼Œæˆ‘ä»¬åœ¨Kubernetesä¸­è¿è¡Œåº”ç”¨ç¨‹åºï¼Œå› æ­¤æˆ‘ä»¬å¸Œæœ›åœ¨Kubernetesé›†ç¾¤ä¸Šè¿›è¡Œæ¦‚å¿µéªŒè¯ã€‚</p><p id="019b" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">è¿™ä¸ªæ¦‚å¿µéªŒè¯å°†å¸®åŠ©æˆ‘ä»¬æ¢ç´¢APIç½‘å…³çš„æ‰€æœ‰<em class="lv">éåŠŸèƒ½æ€§éœ€æ±‚</em>ã€‚</p><p id="fb13" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">ä¸¥è‚ƒåœ°è¯´ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„ç¯å¢ƒï¼Œåªæ˜¯ä¸€ç§å¿«é€Ÿè€Œè‚®è„çš„æ–¹å¼æ¥åˆ›å»ºä»–ä»¬å¯ä»¥ç”¨æ¥å¼€å‘çš„å¼€å‘äººå‘˜æ²™ç®±ã€‚</p><h1 id="34bd" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">1.ä½¿ç”¨Minikubeåˆ›å»ºæˆ‘ä»¬çš„â€œé›†ç¾¤â€</h1><p id="4fd8" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">æˆ‘ä»¬å°†ä½¿ç”¨minikube-version 1.15.6ï¼Œå› ä¸º1.16ä¸Šçš„ä¸€äº›apiè¢«å¼ƒç”¨</p><pre class="ma mb mc md gt mp mq mr ms aw mt bi"><span id="a87c" class="mu jr it mq b gy mv mw l mx my"><strong class="mq iu">&gt; minikube start --kubernetes-version v1.15.6</strong><br/>ğŸ˜„  minikube v1.5.2 on Ubuntu 19.10<br/>âœ¨  Automatically selected the 'virtualbox' driver (alternates: [none])<br/>ğŸ”¥  Creating virtualbox VM (CPUs=2, Memory=2000MB, Disk=20000MB) ...<br/>ğŸ³  Preparing Kubernetes v1.15.6 on Docker '18.09.9' ...<br/>ğŸ’¾  Downloading kubeadm v1.15.6<br/>ğŸ’¾  Downloading kubelet v1.15.6<br/>ğŸšœ  Pulling images ...<br/>ğŸš€  Launching Kubernetes ... <br/>âŒ›  Waiting for: apiserver<br/>ğŸ„  Done! kubectl is now configured to use "minikube"</span></pre><h1 id="0cae" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">2.åœ¨æˆ‘ä»¬çš„é›†ç¾¤ä¸Šè®¾ç½®Helm v2</h1><p id="0ca1" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">æˆ‘ä»¬å¸Œæœ›ä½¿ç”¨Kong helmå›¾è¡¨æ¥ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬çš„é›†ç¾¤ä¸Šå®‰è£…Tiller (Helmçš„æœåŠ¡å™¨ç«¯ç»„ä»¶)ã€‚</p><pre class="ma mb mc md gt mp mq mr ms aw mt bi"><span id="04cc" class="mu jr it mq b gy mv mw l mx my"><strong class="mq iu">&gt; curl -L </strong><a class="ae lm" href="https://git.io/get_helm.sh" rel="noopener ugc nofollow" target="_blank"><strong class="mq iu">https://git.io/get_helm.sh</strong></a><strong class="mq iu"> | bash # Install helm</strong></span><span id="0cc3" class="mu jr it mq b gy mz mw l mx my"><strong class="mq iu">&gt; helm init # Setup Tiller</strong><br/>Helm v2.16.1 <br/>Run 'helm init' to configure helm.<br/>$HELM_HOME has been configured at /home/pablo/.helm.</span><span id="8541" class="mu jr it mq b gy mz mw l mx my">Tiller (the Helm server-side component) has been installed into your Kubernetes Cluster.</span></pre><h1 id="6e8e" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">3.è®¾ç½®å­”</h1><p id="f132" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">ç¬¬ä¸€æ­¥æ˜¯ç®€å•åœ°ç”¨<a class="ae lm" href="https://hub.helm.sh/charts/stable/kong" rel="noopener ugc nofollow" target="_blank">èˆµå›¾</a>å®‰è£…<a class="ae lm" href="https://konghq.com/" rel="noopener ugc nofollow" target="_blank">å­”</a>ã€‚å› ä¸ºæˆ‘ä»¬æ˜¯å¥½å…¬æ°‘ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†æŠŠä¸Kongç›¸å…³çš„æ‰€æœ‰å†…å®¹æ”¾åœ¨ä¸€ä¸ªåä¸º<em class="lv"> kong </em>çš„åç§°ç©ºé—´ä¸­ã€‚</p><pre class="ma mb mc md gt mp mq mr ms aw mt bi"><span id="7507" class="mu jr it mq b gy mv mw l mx my"><strong class="mq iu">&gt; kubectl create ns kong</strong></span><span id="8f7b" class="mu jr it mq b gy mz mw l mx my"><strong class="mq iu">&gt; helm install --version 0.26.1 \<br/>--name kong stable/kong \<br/>--namespace kong \<br/>--set ingressController.enabled=true \<br/>--set image.tag=1.4 \<br/>--set admin.useTLS=false</strong></span></pre><p id="8990" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">å­”æŒèˆµå›¾å®‰è£…ä¼šç»™ä½ ä¸€ä¸ªè·å–<em class="lv">ä»£ç†</em>åœ°å€å’Œ<em class="lv">ç®¡ç†</em>åœ°å€çš„å‘½ä»¤ã€‚æ­£å¦‚æ‚¨å¯èƒ½å·²ç»çŸ¥é“çš„ï¼Œä»£ç†åœ°å€å°†è¢«ç”¨ä½œæ‚¨çš„æœåŠ¡çš„å…¥å£ç‚¹ï¼Œè€Œ<em class="lv"> Admin </em>è®©æ‚¨å¯ä»¥è®¿é—®Kong HTTP APIã€‚</p><pre class="ma mb mc md gt mp mq mr ms aw mt bi"><span id="0782" class="mu jr it mq b gy mv mw l mx my"><strong class="mq iu">&gt; kubectl get services --namespace kong</strong><br/>NAME                        TYPE        ...<br/>kong-kong-admin             NodePort    ...<br/>kong-kong-proxy             NodePort    ...<br/>kong-postgresql             ClusterIP   ...<br/>kong-postgresql-headless    ClusterIP   ...</span></pre><p id="c4e3" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">å› ä¸ºæˆ‘ä»¬ä¼šå¤šæ¬¡å¼•ç”¨<em class="lv">ç®¡ç†</em>å’Œ<em class="lv">ä»£ç†</em>åœ°å€ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å¯¼å‡ºå®ƒä»¬ã€‚</p><pre class="ma mb mc md gt mp mq mr ms aw mt bi"><span id="ab12" class="mu jr it mq b gy mv mw l mx my"><strong class="mq iu">&gt; export PROXY_ADDR=$(minikube service -n kong kong-kong-proxy --url | head -1)</strong></span><span id="0d69" class="mu jr it mq b gy mz mw l mx my"><strong class="mq iu">&gt; export ADMIN_ADDR=$(minikube service -n kong kong-kong-admin --url | head -1)</strong></span><span id="ecf3" class="mu jr it mq b gy mz mw l mx my"><strong class="mq iu">&gt; echo $PROXY_ADDR # This will differ for you.</strong><br/><a class="ae lm" href="http://192.168.64.7:30076" rel="noopener ugc nofollow" target="_blank">http://192.168.64.7:30076</a></span><span id="2272" class="mu jr it mq b gy mz mw l mx my"><strong class="mq iu">&gt; curl -i $PROXY_ADDR</strong><br/>HTTP/1.1 404 Not Found<br/>Date: Mon, 25 Nov 2019 16:50:59 GMT<br/>Content-Type: application/json; charset=utf-8<br/>Connection: keep-alive<br/>Content-Length: 48<br/>X-Kong-Response-Latency: 2<br/>Server: kong/1.4.0<br/>{â€œmessageâ€:â€no Route matched with those valuesâ€}%</span></pre><p id="73a1" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">å› ä¸ºæˆ‘ä»¬æ²¡æœ‰åœ¨é›†ç¾¤ä¸Šè¿è¡ŒhttpæœåŠ¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ª404ã€‚</p><h1 id="75d8" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">4.è®¾ç½®KONGA(å¯é€‰)</h1><p id="20c5" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">Kongaæ˜¯ä¸€ä¸ªä¼˜ç§€çš„å›¾å½¢åŒ–ç®¡ç†ç•Œé¢ï¼Œç”¨äºç®¡ç†Kongï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„æ¸…å•ç®€å•åœ°è®¾ç½®å®ƒã€‚</p><pre class="ma mb mc md gt mp mq mr ms aw mt bi"><span id="86b7" class="mu jr it mq b gy mv mw l mx my"># We can create a file containing this manifest <br/># or pipe it to `kubectl`.<br/>apiVersion: extensions/v1beta1<br/>kind: Deployment<br/>metadata:<br/>  name: konga<br/>  namespace: kong<br/>spec:<br/>  replicas: 1<br/>  template:<br/>    metadata:<br/>      labels:<br/>        name: konga<br/>        app: konga<br/>    spec:<br/>      containers:<br/>      - name: konga<br/>        image: pantsel/konga<br/>        ports:<br/>        - containerPort: 1337<br/>        env:<br/>          - name: NO_AUTH<br/>            value: "true"<br/>---<br/>apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: konga-svc<br/>  namespace: kong<br/>spec:<br/>  type: NodePort<br/>  ports:<br/>  - name: kong-proxy<br/>    port: 1337<br/>    targetPort: 1337<br/>    nodePort: 30338<br/>    protocol: TCP<br/>  selector:<br/>    app: konga</span></pre><p id="4ff4" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">å› ä¸ºæˆ‘ä»¬å°†é€šè¿‡æµè§ˆå™¨æŸ¥çœ‹Kongaï¼Œæ‰€ä»¥è®©æˆ‘ä»¬è·å–é‚£ä¸ªåœ°å€ã€‚</p><pre class="ma mb mc md gt mp mq mr ms aw mt bi"><span id="2f15" class="mu jr it mq b gy mv mw l mx my">export KONGA_ADDR=$(minikube service -n kong konga-svc â€” url | head -1)</span></pre><p id="8935" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€<code class="fe na nb nc mq b">$KONG_ADDR</code>ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸è®¾ç½®ä¸<em class="lv">å­”ç®¡ç†HTTP API </em>çš„è¿æ¥ã€‚</p><p id="95df" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">æˆ‘ä»¬å¯ä»¥ç»™è¿™ä¸ªè¿æ¥èµ·ä¸€ä¸ªåå­—ï¼Œå¹¶å°†URLè®¾ç½®ä¸º<code class="fe na nb nc mq b">$ADMIN_ADDR</code>ã€‚</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi nd"><img src="../Images/a889c57e2e2ad174fa3177c2d0c05261.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9XIWvdj2UDro0QuPhSKMuQ.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">åŠ è½½Kongaä»ªè¡¨æ¿</figcaption></figure><h1 id="86a1" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">5.å®‰è£…HTTPåº”ç”¨ç¨‹åº</h1><p id="1d45" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">å› ä¸ºæˆ‘ä»¬æœ€æ„Ÿå…´è¶£çš„æ˜¯HTTPè¯·æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç®€å•çš„echo-serveråº”ç”¨ç¨‹åºï¼Œå®ƒåªæ˜¯å°†HTTPè¯·æ±‚æ‰“å°å›ç»™æˆ‘ä»¬ï¼Œå¹¶é™„å¸¦ä¸€äº›å…³äºpodsä¹‹ç±»çš„å…¶ä»–ç»†èŠ‚ã€‚</p><p id="c367" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">æˆ‘ä»¬å°†åº”ç”¨ç¨‹åºæ”¾åœ¨Kongåé¢ï¼Œå¹¶ä½¿ç”¨Kongçš„å…¥å£ç±»ã€‚</p><pre class="ma mb mc md gt mp mq mr ms aw mt bi"><span id="7f34" class="mu jr it mq b gy mv mw l mx my"><strong class="mq iu">&gt; curl -sL bit.ly/echo-server | kubectl apply -f -</strong><br/>service/echo created<br/>deployment.apps/echo created</span></pre><h2 id="0a7f" class="mu jr it bd js ne nf dn jw ng nh dp ka kz ni nj ke ld nk nl ki lh nm nn km no bi translated">ä½¿ç”¨Kongä»£ç†(éœ€è¦æ£€æŸ¥ä¸‹çº§)</h2><p id="2822" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">åˆ›å»ºä¸€ä¸ªå…¥å£è§„åˆ™æ¥ä»£ç†ä¹‹å‰åˆ›å»ºçš„echoæœåŠ¡å™¨:</p><pre class="ma mb mc md gt mp mq mr ms aw mt bi"><span id="e198" class="mu jr it mq b gy mv mw l mx my"><strong class="mq iu">&gt; echo "<br/>apiVersion: extensions/v1beta1<br/>kind: Ingress<br/>metadata:<br/>  name: demo<br/>  annotations:<br/>    # This annotation is optional since the ingress class will<br/>    # default to "kong" behind the scene.<br/>    # You can validate the right ingress is being used by the<br/>    # `X-Kong-Upstream-Latency` header being added to requests.<br/>    </strong><a class="ae lm" href="http://kubernetes.io/ingress.class" rel="noopener ugc nofollow" target="_blank"><strong class="mq iu">kubernetes.io/ingress.class</strong></a><strong class="mq iu">: "kong"<br/>spec:<br/>  rules:<br/>  - http:<br/>      paths:<br/>      - path: /foo<br/>        backend:<br/>          serviceName: echo<br/>          servicePort: 80<br/>" | kubectl apply -f -</strong><br/>ingress.extensions/demo created</span></pre><p id="12ba" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">éªŒè¯å…¥å£æ­£åœ¨å·¥ä½œ:<br/> <em class="lv">(æ³¨æ„å­”å…¥å£å‘å›çš„</em> <code class="fe na nb nc mq b"><em class="lv">X-Kong-*</em></code> <em class="lv">å“åº”å¤´ã€‚)</em></p><pre class="ma mb mc md gt mp mq mr ms aw mt bi"><span id="2043" class="mu jr it mq b gy mv mw l mx my">&gt; <strong class="mq iu">curl -i $PROXY_IP/foo   </strong><br/>HTTP/1.1 200 OK<br/>Content-Type: text/plain; charset=UTF-8<br/>Transfer-Encoding: chunked<br/>Connection: keep-alive<br/>Date: Mon, 25 Nov 2019 17:19:13 GMT<br/>Server: echoserver<br/><em class="lv">X-Kong-Upstream-Latency: 4<br/>X-Kong-Proxy-Latency: 4</em><br/>Via: kong/1.4.0</span><span id="5a22" class="mu jr it mq b gy mz mw l mx my">Hostname: echo-599d77c5c7-m9zbh</span><span id="4b0d" class="mu jr it mq b gy mz mw l mx my">Pod Information:<br/> node name: minikube<br/> pod name: echo-599d77c5c7-m9zbh<br/> pod namespace: default<br/> pod IP: 172.17.0.15</span><span id="baf6" class="mu jr it mq b gy mz mw l mx my">Server values:<br/> server_version=nginx: 1.12.2 - lua: 10010</span><span id="14ee" class="mu jr it mq b gy mz mw l mx my">Request Information:<br/> client_address=172.17.0.14<br/> method=GET<br/> real path=/<br/> query=<br/> request_version=1.1<br/> request_scheme=http<br/> request_uri=<a class="ae lm" href="http://192.168.99.110:8080/" rel="noopener ugc nofollow" target="_blank">http://192.168.99.110:8080/</a></span><span id="6710" class="mu jr it mq b gy mz mw l mx my">Request Headers:<br/> accept=*/*  <br/> connection=keep-alive  <br/> host=192.168.99.110:30400  <br/> user-agent=curl/7.65.3  <br/> x-forwarded-for=172.17.0.1  <br/> x-forwarded-host=192.168.99.110  <br/> x-forwarded-port=8000  <br/> x-forwarded-proto=http  <br/> x-real-ip=172.17.0.1</span><span id="0247" class="mu jr it mq b gy mz mw l mx my">Request Body:<br/> -no body in request-</span></pre><h1 id="259f" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">5.è®¾ç½®æˆæƒ</h1><blockquote class="ls lt lu"><p id="2b69" class="ko kp lv kq b kr ln kt ku kv lo kx ky lw lp lb lc lx lq lf lg ly lr lj lk ll im bi translated"><a class="ae lm" href="https://docs.konghq.com/hub/kong-inc/acl/" rel="noopener ugc nofollow" target="_blank"> <em class="it"> ACL </em> </a> <em class="it">(è®¿é—®æ§åˆ¶åˆ—è¡¨)<br/>é€šè¿‡å°†ä½¿ç”¨ä»»æ„ACLç»„åçš„æ¶ˆè´¹è€…åˆ—å…¥ç™½åå•æˆ–é»‘åå•æ¥é™åˆ¶å¯¹æœåŠ¡æˆ–è·¯ç”±çš„è®¿é—®ã€‚è¯¥æ’ä»¶è¦æ±‚å·²ç»åœ¨æœåŠ¡æˆ–è·¯ç”±ä¸Šå¯ç”¨äº†</em> <a class="ae lm" href="https://docs.konghq.com/about/faq/#how-can-i-add-authentication-to-a-microservice-api" rel="noopener ugc nofollow" target="_blank"> <em class="it">è®¤è¯æ’ä»¶</em> </a> <em class="it">ã€‚</em></p><p id="407d" class="ko kp lv kq b kr ln kt ku kv lo kx ky lw lp lb lc lx lq lf lg ly lr lj lk ll im bi translated"><em class="it">J</em><a class="ae lm" href="https://docs.konghq.com/hub/kong-inc/jwt/" rel="noopener ugc nofollow" target="_blank"><em class="it">WT</em></a><em class="it">(JSON Webä»¤ç‰Œ)<br/>éªŒè¯åŒ…å«HS256æˆ–RS256ç­¾åçš„JSON Webä»¤ç‰Œçš„è¯·æ±‚(å¦‚</em><a class="ae lm" href="https://tools.ietf.org/html/rfc7519" rel="noopener ugc nofollow" target="_blank"><em class="it">RFC 7519</em></a><em class="it">ä¸­æ‰€æŒ‡å®š)ã€‚æ‚¨çš„æ¯ä¸ªæ¶ˆè´¹è€…éƒ½å°†æ‹¥æœ‰JWTå‡­è¯(å…¬é’¥å’Œç§é’¥)ï¼Œå¿…é¡»ä½¿ç”¨è¿™äº›å‡­è¯æ¥ç­¾ç½²ä»–ä»¬çš„jwtã€‚</em></p></blockquote><p id="b5fb" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¿…é¡»é‡‡å–5ä¸ªæ­¥éª¤:</p><ol class=""><li id="3937" class="np nq it kq b kr ln kv lo kz nr ld ns lh nt ll nu nv nw nx bi translated">åˆ›å»ºä¸€ä¸ªåä¸º<strong class="kq iu"> helloçš„æ¶ˆè´¹è€…ã€‚</strong></li><li id="6a58" class="np nq it kq b kr ny kv nz kz oa ld ob lh oc ll nu nv nw nx bi translated">å°†<strong class="kq iu">ä½ å¥½</strong>æ·»åŠ åˆ°ä¸€ä¸ªç¾¤ä¸­ï¼Œæˆ‘ä»¬å°†å…¶å‘½åä¸º<strong class="kq iu">å…è®¸</strong>ã€‚</li><li id="c9cc" class="np nq it kq b kr ny kv nz kz oa ld ob lh oc ll nu nv nw nx bi translated">ç»™æ¶ˆè´¹è€…å¢åŠ ä¸€ä¸ªJWTã€‚</li><li id="3186" class="np nq it kq b kr ny kv nz kz oa ld ob lh oc ll nu nv nw nx bi translated">å°†JWTæ’ä»¶æ·»åŠ åˆ°è·¯çº¿ä¸­ã€‚</li><li id="6966" class="np nq it kq b kr ny kv nz kz oa ld ob lh oc ll nu nv nw nx bi translated">å°†ACLæ’ä»¶æ·»åŠ åˆ°è·¯ç”±ä¸­ã€‚</li></ol><p id="8b0b" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">å› æ­¤ï¼Œè®©æˆ‘ä»¬ä»åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…å¼€å§‹:</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi od"><img src="../Images/dbbb2c47104ef868456b5530e61fd0d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*T7UWVUHeQLq_5QjgMVGhag.png"/></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">ä½¿ç”¨Kongaåˆ›å»ºæ–°æ¶ˆè´¹è€…</figcaption></figure><p id="fb42" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">ç„¶åï¼Œæˆ‘ä»¬å°†æˆ‘ä»¬çš„ä½¿ç”¨ä¸æˆ‘ä»¬åˆ›å»ºçš„ç»„ç›¸å…³è”:</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi oe"><img src="../Images/58022b5d7d20507fbf8b34750342cbcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OXZDlSbDMTVVjKgP-WKiOQ.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">åœ¨æ¶ˆè´¹è€…é¢æ¿ä¸‹å¯ä»¥æ‰¾åˆ°ç»„</figcaption></figure><p id="3003" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">ç„¶åï¼Œæˆ‘ä»¬ä¸ºæ¶ˆè´¹è€…åˆ›å»ºä¸€ä¸ªJWTï¼›ç¼ºçœå€¼æ˜¯å¯å–çš„ï¼Œå¦åˆ™æ‚¨å°†ç©å¼„å¯†é’¥å’Œå£°æ˜:</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi oe"><img src="../Images/9c3bdddee17d08abbe8ada7e0c70d88c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*icggwvPHN4xf0IyRcKGxxw.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">ä»€ä¹ˆéƒ½ä¸åšï¼Œåªéœ€æŒ‰æäº¤</figcaption></figure><p id="f82d" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">å¤ªå¥½äº†ã€‚æ¶ˆè´¹è€…è®¾ç½®å®Œæˆã€‚ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹è·¯çº¿ã€‚</p><p id="18d6" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">æˆ‘ä»¬æ·»åŠ ACLæ’ä»¶ï¼Œå¹¶å°†ä¹‹å‰åˆ›å»ºçš„ç»„åˆ—å…¥ç™½åå•:</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi of"><img src="../Images/fef83ebdb5b2e7e0479035fc4bdcb51d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JgwgkspBsrUMQSRIWfZn8g.png"/></div></div></figure><p id="203e" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">ç„¶åæˆ‘ä»¬æ·»åŠ JWTæ’ä»¶:<br/>(è¿™æ˜¯å”¯ä¸€çš„å…³é”®æ­¥éª¤ã€‚æ‚¨ç»å¯¹éœ€è¦<strong class="kq iu">æˆæƒ</strong>å¤´åç§°ï¼Œå¦åˆ™åœ¨HTTPå¤´ä¸­è®¾ç½®ä»¤ç‰Œå°†ä¸èµ·ä½œç”¨ã€‚)</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi og"><img src="../Images/3e57c2ed8d2d32515de3e06c3e4545be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gR_iVV1QinIiKkIfgxVAgw.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">ç¡®ä¿åœ¨æ ‡é¢˜åç§°ä¸­æ·»åŠ <strong class="bd js">æˆæƒ</strong></figcaption></figure><p id="a5cd" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">å°±æ˜¯è¿™æ ·ã€‚æˆ‘ä»¬å·²ç»è®¾ç½®äº†ä½¿ç”¨ACL+JWTçš„è·¯ç”±ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯ä½¿ç”¨å®ƒã€‚è®©æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ç«¯ç‚¹:</p><pre class="ma mb mc md gt mp mq mr ms aw mt bi"><span id="0e34" class="mu jr it mq b gy mv mw l mx my"><strong class="mq iu">&gt; curl -i $PROXY_ADDR/foo</strong><br/>HTTP/1.1 401 Unauthorized<br/>Date: Tue, 26 Nov 2019 14:11:27 GMT<br/>Content-Type: application/json; charset=utf-8<br/>Connection: keep-alive<br/>Content-Length: 26<br/>X-Kong-Response-Latency: 8<br/>Server: kong/1.4.0</span><span id="1b23" class="mu jr it mq b gy mz mw l mx my">{"message":"Unauthorized"}</span></pre><p id="f027" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">å¤ªå¥½äº†ã€‚æ‰€ä»¥ç°åœ¨æˆ‘ä»¬éœ€è¦å¾—åˆ°ä»¤ç‰Œã€‚<br/>å‰å¾€<a class="ae lm" href="https://jwt.io/" rel="noopener ugc nofollow" target="_blank"> jwt.io </a>å¹¶ä½¿ç”¨ç¥å¥‡å·¥å…·:</p><p id="e0f8" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">1.åœ¨æœ‰æ•ˆè´Ÿè½½ä¸­:å°†<code class="fe na nb nc mq b">iss</code>è®¾ç½®ä¸ºæ‚¨çš„æ¶ˆè´¹è€…çš„JWTå‡­è¯ä¸­çš„<code class="fe na nb nc mq b">key</code>çš„å€¼ã€‚</p><p id="e91c" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">2.åœ¨éªŒè¯ç­¾åä¸­:å°†<code class="fe na nb nc mq b">secret</code>è®¾ç½®ä¸º<code class="fe na nb nc mq b">secret</code>çš„å€¼ï¼Œè¿™ä¹Ÿå¯ä»¥åœ¨æ¶ˆè´¹è€…çš„JWTå‡­è¯ä¸­æ‰¾åˆ°ã€‚</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/7f302ea619de8e23f4657f62fc904326.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*KXUHn8H93u5DpHkj8g7CQw.png"/></div></figure><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi oi"><img src="../Images/6271dfbfe69c9befaf63f5eb2a3b8928.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1rZuLvkWunjquCSBpZtoBA.png"/></div></div></figure><p id="a37e" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">ç°åœ¨ï¼Œæˆ‘ä»¬æ¥è¯•è¯•è¿™ä¸ª:</p><pre class="ma mb mc md gt mp mq mr ms aw mt bi"><span id="5c8a" class="mu jr it mq b gy mv mw l mx my">â€º curl -i -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJWVGlIeWNGUGszbzdJQkhTZVhlQ2xwYXpsWGxnTWNqOCJ9.XODg0ay6fioNZZqkPiVW_u0N_4UpZgHqX3cVevAzSXo' $PROXY_ADDR/foo<br/>HTTP/1.1 200 OK<br/>Content-Type: text/plain; charset=UTF-8<br/>Transfer-Encoding: chunked<br/>Connection: keep-alive<br/>Date: Tue, 26 Nov 2019 10:22:19 GMT<br/>Server: echoserver<br/>X-Kong-Upstream-Latency: 4<br/>X-Kong-Proxy-Latency: 12<br/>Via: kong/1.4.0</span><span id="d4bc" class="mu jr it mq b gy mz mw l mx my">Hostname: echo-599d77c5c7-ktlr7</span><span id="84bf" class="mu jr it mq b gy mz mw l mx my">Pod Information:<br/>        node name:      minikube<br/>        pod name:       echo-599d77c5c7-ktlr7<br/>        pod namespace:  default<br/>        pod IP: 172.17.0.15</span><span id="987e" class="mu jr it mq b gy mz mw l mx my">Server values:<br/>        server_version=nginx: 1.12.2 - lua: 10010</span><span id="0620" class="mu jr it mq b gy mz mw l mx my">Request Information:<br/>        client_address=172.17.0.12<br/>        method=GET<br/>        real path=/<br/>        query=<br/>        request_version=1.1<br/>        request_scheme=http<br/>        request_uri=<a class="ae lm" href="http://192.168.64.7:8080/" rel="noopener ugc nofollow" target="_blank">http://192.168.64.7:8080/</a></span><span id="7432" class="mu jr it mq b gy mz mw l mx my">Request Headers:<br/>        accept=*/*<br/>        authorization=Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJWVGlIeWNGUGszbzdJQkhTZVhlQ2xwYXpsWGxnTWNqOCJ9.XODg0ay6fioNZZqkPiVW_u0N_4UpZgHqX3cVevAzSXo<br/>        connection=keep-alive<br/>        host=192.168.64.7:30585<br/>        user-agent=curl/7.54.0<br/>        x-consumer-groups=baddies-allowed<br/>        x-consumer-id=5ed91a70-12fe-450f-b0a1-3dbbbe9a7997<br/>        x-consumer-username=baddies<br/>        x-forwarded-for=172.17.0.1<br/>        x-forwarded-host=192.168.64.7<br/>        x-forwarded-port=8000<br/>        x-forwarded-proto=http<br/>        x-real-ip=172.17.0.1</span><span id="f0f0" class="mu jr it mq b gy mz mw l mx my">Request Body:<br/>        -no body in request-</span></pre><p id="dc1a" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">å¤§è·æˆåŠŸï¼</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi oj"><img src="../Images/d60ee56a63ef9c7687af3d3f4f5b9935.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NfnYWlxONWOJrBDbZEWvtg.png"/></div></div></figure><p id="b622" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">æ‰€ä»¥ï¼Œå°±è¿™æ ·äº†ã€‚æˆ‘å¸Œæœ›ä½ è§‰å¾—å®ƒæœ‰ç”¨ï¼Œå¹¶ä¸”æ­¥éª¤å®¹æ˜“éµå¾ªã€‚å¦‚æœæˆ‘é—æ¼äº†ä»€ä¹ˆï¼Œè¯·è¯„è®ºå’Œ/æˆ–æé—®â€”â€”å¾ˆé«˜å…´å¾—åˆ°åé¦ˆã€‚</p></div></div>    
</body>
</html>