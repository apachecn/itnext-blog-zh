<html>
<head>
<title>Build a Twitter Leaderboard app with Redis and AWS Lambda (part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ç”¨Rediså’ŒAWS Lambdaæ„å»ºä¸€ä¸ªTwitteræ’è¡Œæ¦œåº”ç”¨ç¨‹åº(ç¬¬2éƒ¨åˆ†)</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/build-a-twitter-leaderboard-app-with-redis-and-aws-lambda-part-2-b5265d83d084?source=collection_archive---------1-----------------------#2022-06-03">https://itnext.io/build-a-twitter-leaderboard-app-with-redis-and-aws-lambda-part-2-b5265d83d084?source=collection_archive---------1-----------------------#2022-06-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4073" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">AWS CDKä»£ç æ¼”ç»ƒ</h2></div><p id="c318" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è¿™æ˜¯è¿™ä¸ªç”±ä¸¤éƒ¨åˆ†ç»„æˆçš„ç³»åˆ—çš„ç¬¬äºŒç¯‡åšæ–‡ï¼Œå®ƒä½¿ç”¨ä¸€ä¸ªå®é™…çš„åº”ç”¨ç¨‹åºæ¥æ¼”ç¤ºå¦‚ä½•å°†Redisä¸AWS Lambdaé›†æˆã€‚ç¬¬ä¸€éƒ¨åˆ†æ˜¯å…³äºè§£å†³æ–¹æ¡ˆæ¦‚è¿°å’Œéƒ¨ç½²ï¼Œå¸Œæœ›æ‚¨èƒ½å¤Ÿç«¯åˆ°ç«¯åœ°è¿›è¡Œæµ‹è¯•ã€‚</p><div class="lb lc gp gr ld le"><a rel="noopener  ugc nofollow" target="_blank" href="/build-a-twitter-leaderboard-app-with-redis-and-aws-lambda-part-1-670e7a8c6a91"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd ir gy z fp lj fr fs lk fu fw ip bi translated">ç”¨Rediså’ŒAWS Lambdaæ„å»ºä¸€ä¸ªTwitteræ’è¡Œæ¦œåº”ç”¨ç¨‹åº(ç¬¬1éƒ¨åˆ†)</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">ä½ å¥½ï¼Œæ¬¢è¿ğŸ‘‹ğŸ¼è¿™ä¸ªç”±ä¸¤éƒ¨åˆ†ç»„æˆçš„åšå®¢ç³»åˆ—ä½¿ç”¨ä¸€ä¸ªç®€å•è€Œå®ç”¨çš„åº”ç”¨ç¨‹åºæ¥æ¼”ç¤ºå¦‚ä½•â€¦</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">itnext.io</p></div></div><div class="ln l"><div class="lo l lp lq lr ln ls lt le"/></div></div></a></div><p id="c53e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æ­£å¦‚æ‰€æ‰¿è¯ºçš„ï¼Œç¬¬äºŒéƒ¨åˆ†(è¿™ä¸€éƒ¨åˆ†)å°†æ¶µç›–åŸºç¡€è®¾æ–½æ–¹é¢(å…·ä½“æ¥è¯´æ˜¯IaaC)ï¼Œå®ƒç”±ä¸‰ä¸ª(CDK) <a class="ae lu" href="https://docs.aws.amazon.com/cdk/v2/guide/stacks.html" rel="noopener ugc nofollow" target="_blank">å †æ ˆ</a>(åœ¨å•ä¸ª<a class="ae lu" href="https://docs.aws.amazon.com/cdk/v2/guide/apps.html" rel="noopener ugc nofollow" target="_blank"> CDKåº”ç”¨</a>çš„ä¸Šä¸‹æ–‡ä¸­)ç»„æˆã€‚</p><p id="2f30" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æˆ‘å°†æä¾›ä¸€ä¸ªç”¨Goç¼–å†™çš„CDKä»£ç çš„æ¼”ç¤ºï¼Œæ„Ÿè°¢<a class="ae lu" href="https://docs.aws.amazon.com/cdk/v2/guide/work-with-cdk-go.html" rel="noopener ugc nofollow" target="_blank"> CDK Goæ”¯æŒ</a>(åœ¨æ’°å†™æœ¬æ–‡æ—¶æ˜¯å¼€å‘è€…é¢„è§ˆç‰ˆ)ã€‚</p><h1 id="351d" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">CDKä»£ç éå†</h1><p id="fd12" class="pw-post-body-paragraph kf kg iq kh b ki mn jr kk kl mo ju kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">è®©æˆ‘ä»¬ä¸€æ¬¡æ‹¿ä¸€å </p><blockquote class="ms mt mu"><p id="9612" class="kf kg mv kh b ki kj jr kk kl km ju kn mw kp kq kr mx kt ku kv my kx ky kz la ij bi translated"><em class="iq">è¯·æ³¨æ„ï¼Œä¸ºäº†ç®€æ´èµ·è§ï¼Œä¸€äº›ä»£ç å·²ç»è¢«ç¼–è¾‘/çœç•¥â€”â€”æ‚¨å¯ä»¥éšæ—¶åœ¨</em><a class="ae lu" href="https://github.com/abhirockzz/twitter-leaderboard-app" rel="noopener ugc nofollow" target="_blank"><em class="iq">GitHub repo</em></a>ä¸­æŸ¥é˜…å®Œæ•´çš„ä»£ç </p></blockquote><h2 id="1054" class="mz lw iq bd lx na nb dn mb nc nd dp mf ko ne nf mh ks ng nh mj kw ni nj ml nk bi translated">ä»åŸºç¡€æ¶æ„å †æ ˆå¼€å§‹</h2><pre class="nl nm nn no gt np nq nr ns aw nt bi"><span id="3e9d" class="mz lw iq nq b gy nu nv l nw nx">stack := awscdk.NewStack(scope, &amp;id, &amp;sprops)<br/>vpc = awsec2.NewVpc(stack, jsii.String("demo-vpc"), nil)</span><span id="0366" class="mz lw iq nq b gy ny nv l nw nx">authInfo := map[string]interface{}{"Type": "password", "Passwords": []string{memorydbPassword}}<br/>user = awsmemorydb.NewCfnUser(stack, jsii.String("demo-memorydb-user"), &amp;awsmemorydb.CfnUserProps{UserName: jsii.String("demo-user"), AccessString: jsii.String(accessString), AuthenticationMode: authInfo})<br/>acl := awsmemorydb.NewCfnACL(stack, jsii.String("demo-memorydb-acl"), &amp;awsmemorydb.CfnACLProps{AclName: jsii.String("demo-memorydb-acl"), UserNames: &amp;[]*string{user.UserName()}})</span><span id="cb99" class="mz lw iq nq b gy ny nv l nw nx"><em class="mv">//snip .....</em></span><span id="3e48" class="mz lw iq nq b gy ny nv l nw nx">subnetGroup := awsmemorydb.NewCfnSubnetGroup(stack, jsii.String("demo-memorydb-subnetgroup"), &amp;awsmemorydb.CfnSubnetGroupProps{SubnetGroupName: jsii.String("demo-memorydb-subnetgroup"), SubnetIds: &amp;subnetIDsForSubnetGroup})</span><span id="26ac" class="mz lw iq nq b gy ny nv l nw nx">memorydbSecurityGroup = awsec2.NewSecurityGroup(stack, jsii.String("memorydb-demo-sg"), &amp;awsec2.SecurityGroupProps{Vpc: vpc, SecurityGroupName: jsii.String("memorydb-demo-sg"), AllowAllOutbound: jsii.Bool(true)})</span><span id="6587" class="mz lw iq nq b gy ny nv l nw nx">memorydbCluster = awsmemorydb.NewCfnCluster(<em class="mv">//... details omitted)</em></span><span id="0e38" class="mz lw iq nq b gy ny nv l nw nx"><em class="mv">//...snip</em></span><span id="6662" class="mz lw iq nq b gy ny nv l nw nx">twitterIngestFunctionSecurityGroup = awsec2.NewSecurityGroup(<em class="mv">//... details omitted)</em><br/>twitterLeaderboardFunctionSecurityGroup = awsec2.NewSecurityGroup(<em class="mv">//... details omitted)</em></span><span id="e5d4" class="mz lw iq nq b gy ny nv l nw nx">memorydbSecurityGroup.AddIngressRule(<em class="mv">//... details omitted)</em><br/>memorydbSecurityGroup.AddIngressRule(<em class="mv">//... details omitted)</em></span></pre><p id="6dae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æ€»ç»“ä¸€ä¸‹:</p><ul class=""><li id="b5bc" class="nz oa iq kh b ki kj kl km ko ob ks oc kw od la oe of og oh bi translated">åˆ›å»ºVPCå’Œç›¸å…³ç»„ä»¶çš„ä¸€è¡Œä»£ç ï¼</li><li id="19fe" class="nz oa iq kh b ki oi kl oj ko ok ks ol kw om la oe of og oh bi translated">æˆ‘ä»¬ä¸ºMemoryDBé›†ç¾¤åˆ›å»ºACLã€ç”¨æˆ·ã€å­ç½‘ç»„ï¼Œå¹¶åœ¨ä½¿ç”¨<code class="fe on oo op nq b">awsmemorydb.NewCfnCluster</code>åˆ›å»ºé›†ç¾¤æ—¶å¼•ç”¨å®ƒä»¬</li><li id="401f" class="nz oa iq kh b ki oi kl oj ko ok ks ol kw om la oe of og oh bi translated">æˆ‘ä»¬è¿˜åˆ›å»ºæ‰€éœ€çš„å®‰å…¨ç»„â€”â€”å®ƒä»¬çš„ä¸»è¦ä½œç”¨æ˜¯å…è®¸Lambdaå‡½æ•°è®¿é—®MemoryDB(æˆ‘ä»¬æŒ‡å®šæ˜¾å¼çš„å…¥ç«™è§„åˆ™æ¥å®ç°è¿™ä¸€ç‚¹)</li><li id="4b66" class="nz oa iq kh b ki oi kl oj ko ok ks ol kw om la oe of og oh bi translated">ä¸€ä¸ªç”¨äºå†…å­˜æ•°æ®åº“é›†ç¾¤</li><li id="e15d" class="nz oa iq kh b ki oi kl oj ko ok ks ol kw om la oe of og oh bi translated">ä¸¤ä¸ªLambdaå‡½æ•°å„ä¸€ä¸ª</li></ul><h2 id="5c7b" class="mz lw iq bd lx na nb dn mb nc nd dp mf ko ne nf mh ks ng nh mj kw ni nj ml nk bi translated">ä¸‹ä¸€ä¸ªå †æ ˆéƒ¨ç½²äº†tweetsæ‘„å–LambdaåŠŸèƒ½</h2><pre class="nl nm nn no gt np nq nr ns aw nt bi"><span id="b715" class="mz lw iq nq b gy nu nv l nw nx"><em class="mv">//....</em></span><span id="1adb" class="mz lw iq nq b gy ny nv l nw nx">memoryDBEndpointURL := fmt.Sprintf("%s:%s", *memorydbCluster.AttrClusterEndpointAddress(), strconv.Itoa(int(*memorydbCluster.Port())))</span><span id="4206" class="mz lw iq nq b gy ny nv l nw nx">lambdaEnvVars := &amp;map[string]*string{"MEMORYDB_ENDPOINT": jsii.String(memoryDBEndpointURL), "MEMORYDB_USER": user.UserName(), "MEMORYDB_PASSWORD": jsii.String(getMemorydbPassword()), "TWITTER_API_KEY": jsii.String(getTwitterAPIKey()), "TWITTER_API_SECRET": jsii.String(getTwitterAPISecret()), "TWITTER_ACCESS_TOKEN": jsii.String(getTwitterAccessToken()), "TWITTER_ACCESS_TOKEN_SECRET": jsii.String(getTwitterAccessTokenSecret())}</span><span id="403b" class="mz lw iq nq b gy ny nv l nw nx">awslambda.NewDockerImageFunction(stack, jsii.String("lambda-memorydb-func"), &amp;awslambda.DockerImageFunctionProps{FunctionName: jsii.String(tweetIngestionFunctionName), Environment: lambdaEnvVars, Timeout: awscdk.Duration_Seconds(jsii.Number(20)), Code: awslambda.DockerImageCode_FromImageAsset(jsii.String(tweetIngestionFunctionPath), nil), Vpc: vpc, VpcSubnets: &amp;awsec2.SubnetSelection{Subnets: vpc.PrivateSubnets()}, SecurityGroups: &amp;[]awsec2.ISecurityGroup{twitterIngestFunctionSecurityGroup}})</span><span id="4ae5" class="mz lw iq nq b gy ny nv l nw nx"><em class="mv">//....</em></span></pre><p id="93cf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å’Œä¹‹å‰çš„æ ˆç›¸æ¯”è¿˜æ˜¯æŒºç®€å•çš„ã€‚æˆ‘ä»¬å®šä¹‰Lambdaå‡½æ•°æ‰€éœ€çš„ç¯å¢ƒå˜é‡(åŒ…æ‹¬Twitter APIå‡­è¯),å¹¶å°†å…¶éƒ¨ç½²ä¸ºDockeræ˜ åƒã€‚</p><p id="9f72" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å¯¹äºè¦æ‰“åŒ…æˆDockeræ˜ åƒçš„å‡½æ•°ï¼Œæˆ‘ä½¿ç”¨äº†<a class="ae lu" href="https://gallery.ecr.aws/lambda/go" rel="noopener ugc nofollow" target="_blank"> Go:1.xåŸºç¡€æ˜ åƒ</a>ã€‚ä½†æ˜¯ï¼Œä½ ä¹Ÿå¯ä»¥æ¢ç´¢å…¶ä»–é€‰æ‹©ã€‚åœ¨éƒ¨ç½²æœŸé—´ï¼ŒDockeræ˜ åƒåœ¨æœ¬åœ°æ„å»ºï¼Œè¢«æ¨é€åˆ°ä¸€ä¸ª<a class="ae lu" href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/Registries.html" rel="noopener ugc nofollow" target="_blank">ç§æœ‰ECRæ³¨å†Œè¡¨</a>ï¼Œæœ€åLambdaå‡½æ•°è¢«åˆ›å»ºâ€”â€”æ‰€æœ‰è¿™ä¸€åˆ‡ï¼Œåªéœ€å‡ è¡Œä»£ç ï¼</p><blockquote class="ms mt mu"><p id="9413" class="kf kg mv kh b ki kj jr kk kl km ju kn mw kp kq kr mx kt ku kv my kx ky kz la ij bi translated"><em class="iq">è¯·æ³¨æ„ï¼ŒMemoryDBé›†ç¾¤å’Œå®‰å…¨ç»„æ˜¯ä»ä»¥å‰çš„å †æ ˆä¸­è‡ªåŠ¨å¼•ç”¨/æŸ¥æ‰¾çš„(ä¸æ˜¯é‡æ–°åˆ›å»ºçš„ï¼).</em></p></blockquote><h2 id="5d03" class="mz lw iq bd lx na nb dn mb nc nd dp mf ko ne nf mh ks ng nh mj kw ni nj ml nk bi translated">æœ€åï¼Œç¬¬ä¸‰ä¸ªå †æ ˆè´Ÿè´£æ’è¡Œæ¦œLambdaå‡½æ•°</h2><p id="84a3" class="pw-post-body-paragraph kf kg iq kh b ki mn jr kk kl mo ju kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">å®ƒä¸å‰ä¸€ä¸ªéå¸¸ç›¸ä¼¼ï¼Œé™¤äº†æ·»åŠ äº†Lambdaå‡½æ•°URL ( <code class="fe on oo op nq b">awslambda.NewFunctionUrl</code>)ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒä½œä¸ºå †æ ˆçš„è¾“å‡º:</p><pre class="nl nm nn no gt np nq nr ns aw nt bi"><span id="2cd3" class="mz lw iq nq b gy nu nv l nw nx"><em class="mv">//....</em><br/>memoryDBEndpointURL := fmt.Sprintf("%s:%s", *memorydbCluster.AttrClusterEndpointAddress(), strconv.Itoa(int(*memorydbCluster.Port())))</span><span id="3250" class="mz lw iq nq b gy ny nv l nw nx">lambdaEnvVars := &amp;map[string]*string{"MEMORYDB_ENDPOINT": jsii.String(memoryDBEndpointURL), "MEMORYDB_USERNAME": user.UserName(), "MEMORYDB_PASSWORD": jsii.String(getMemorydbPassword())}</span><span id="b398" class="mz lw iq nq b gy ny nv l nw nx">function := awslambda.NewDockerImageFunction(stack, jsii.String("twitter-hashtag-leaderboard"), &amp;awslambda.DockerImageFunctionProps{FunctionName: jsii.String(hashtagLeaderboardFunctionName), Environment: lambdaEnvVars, Code: awslambda.DockerImageCode_FromImageAsset(jsii.String(hashtagLeaderboardFunctionPath), nil), Timeout: awscdk.Duration_Seconds(jsii.Number(5)), Vpc: vpc, VpcSubnets: &amp;awsec2.SubnetSelection{Subnets: vpc.PrivateSubnets()}, SecurityGroups: &amp;[]awsec2.ISecurityGroup{twitterLeaderboardFunctionSecurityGroup}})</span><span id="2d5a" class="mz lw iq nq b gy ny nv l nw nx">funcURL := awslambda.NewFunctionUrl(stack, jsii.String("func-url"), &amp;awslambda.FunctionUrlProps{AuthType: awslambda.FunctionUrlAuthType_NONE, Function: function})</span><span id="b000" class="mz lw iq nq b gy ny nv l nw nx">awscdk.NewCfnOutput(stack, jsii.String("Function URL"), &amp;awscdk.CfnOutputProps{Value: funcURL.Url()})</span></pre><p id="7589" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è¿™ç¯‡åšæ–‡åˆ°æ­¤ä¸ºæ­¢ã€‚ä»¥AWS Go CDK v2å‚è€ƒçš„é“¾æ¥ç»“æŸ:</p><ul class=""><li id="45c9" class="nz oa iq kh b ki kj kl km ko ob ks oc kw od la oe of og oh bi translated">å¯¹äºmemory dbâ€”<a class="ae lu" href="https://pkg.go.dev/github.com/aws/aws-cdk-go/awscdk/v2@v2.24.1/awsmemorydb" rel="noopener ugc nofollow" target="_blank">https://pkg . go . dev/github . com/AWS/AWS-CDK-go/AWS CDK/v2/AWS memory db</a></li><li id="0244" class="nz oa iq kh b ki oi kl oj ko ok ks ol kw om la oe of og oh bi translated">å¯¹äºLambdaâ€”<a class="ae lu" href="https://pkg.go.dev/github.com/aws/aws-cdk-go/awscdk/v2@v2.24.1/awslambda" rel="noopener ugc nofollow" target="_blank">https://pkg . go . dev/github . com/AWS/AWS-CDK-go/AWS CDK/v2/AWS Lambda</a></li><li id="9882" class="nz oa iq kh b ki oi kl oj ko ok ks ol kw om la oe of og oh bi translated">å¯¹äºVPCç­‰ã€‚â€”<a class="ae lu" href="https://pkg.go.dev/github.com/aws/aws-cdk-go/awscdk/v2@v2.24.1/awsec2" rel="noopener ugc nofollow" target="_blank">https://pkg . go . dev/github . com/AWS/AWS-CDK-go/AWS CDK/v2/AWS ec2</a></li><li id="5d37" class="nz oa iq kh b ki oi kl oj ko ok ks ol kw om la oe of og oh bi translated">https://pkg.go.dev/github.com/aws/aws-cdk-go/awscdk/v2 AWS CDK V2<a class="ae lu" href="https://pkg.go.dev/github.com/aws/aws-cdk-go/awscdk/v2" rel="noopener ugc nofollow" target="_blank"/></li></ul><p id="4bc5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è¿™ä¸ªä¸¤éƒ¨åˆ†ç³»åˆ—åˆ°æ­¤ç»“æŸã€‚è¯·ç»§ç»­å…³æ³¨ï¼Œä¸€å¦‚æ—¢å¾€ï¼Œå¿«ä¹ç¼–ç ï¼</p></div></div>    
</body>
</html>