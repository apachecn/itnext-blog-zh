<html>
<head>
<title>React Hooks â€” designing a simple forms API â€” part 3 â€” validation and a running example!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">react Hooksâ€”â€”è®¾è®¡ç®€å•çš„è¡¨å•APIâ€”â€”ç¬¬3éƒ¨åˆ†â€”â€”éªŒè¯å’Œè¿è¡Œç¤ºä¾‹ï¼</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/react-hooks-designing-a-simple-forms-api-part-3-validation-and-a-running-example-18b835a3b817?source=collection_archive---------4-----------------------#2019-04-01">https://itnext.io/react-hooks-designing-a-simple-forms-api-part-3-validation-and-a-running-example-18b835a3b817?source=collection_archive---------4-----------------------#2019-04-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="cc89" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨æœ¬ç³»åˆ—çš„ç¬¬1éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº†å¦‚ä½•ä½¿ç”¨Reacté’©å­æ¥è®¾è®¡ä¸€ä¸ªReactè¡¨å•åº“ã€‚ç¬¬1éƒ¨åˆ†ä»‹ç»äº†è¿™ä¸ªåº“çš„åŠ¨æœºå’Œä¸€äº›æ€»ä½“è®¾è®¡ç›®æ ‡ã€‚</p><p id="b83f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨æœ¬ç³»åˆ—çš„ç¬¬2éƒ¨åˆ†<a class="ae ko" href="https://medium.com/@shanplourde/react-hooks-designing-a-simple-forms-api-part-2-1fe5d12f23d9" rel="noopener">ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª<code class="fe kp kq kr ks b">useInput</code>é’©å­ï¼Œå›é¡¾äº†æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆçš„çŠ¶æ€ç®¡ç†ï¼Œåˆå¹¶äº†ä¸€äº›é¢å¤–çš„æµ‹è¯•ï¼Œå¹¶ä¸”æ›´è¯¦ç»†åœ°å›é¡¾äº†æµ‹è¯•ç­–ç•¥ã€‚</a></p><p id="f5a1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨ç¬¬3éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºéªŒè¯ã€å¼‚æ­¥éªŒè¯å’Œå¼‚æ­¥è¡¨å•æäº¤ã€‚æˆ‘ä»¬è¿˜å°†ç¡®ä¿æ¶µç›–å¼‚æ­¥å•å…ƒæµ‹è¯•ï¼Œå¹¶æ›´æ–°æˆ‘ä»¬çš„æ ·æœ¬è¡¨å•ã€‚ä¸€æ—¦æˆ‘ä»¬æœ‰äº†è¿™äº›éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°±åŸºæœ¬ä¸Šæ„å»ºäº†åŸºäºReact hooksçš„è¡¨å•APIçš„æ‰€æœ‰å…³é”®å…ƒç´ ã€‚</p><p id="0e64" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¯¹äº†ï¼Œ<a class="ae ko" rel="noopener ugc nofollow" target="_blank" href="/react-hooks-designing-a-simple-forms-api-part-4-scaling-to-other-input-types-e738db0a3fc3">ç¬¬å››éƒ¨</a>ä¸Šçº¿äº†ğŸ’ªã€‚</p><p id="29b1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è®©æˆ‘ä»¬å¼€å§‹å§ï¼</p><h1 id="46c2" class="kt ku it bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">å·¥ä½œç¤ºä¾‹</h1><p id="6098" class="pw-post-body-paragraph jq jr it js b jt lr jv jw jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn im bi translated">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘è¿˜æ²¡æœ‰å‘å¸ƒæˆ‘ä»¬APIçš„è¿è¡Œç¤ºä¾‹ï¼Œå› ä¸ºå®ƒç¼ºå°‘ä¸€äº›å…³é”®ç‰¹æ€§ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å®Œæˆè¡¨å•APIçš„æ‰€æœ‰å…³é”®å…ƒç´ ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬æ‰€å»ºç«‹çš„ä¸€åˆ‡çš„æ¼”ç¤ºã€‚</p><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="mb mc l"/></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">ç¤ºä¾‹è¡¨å•å±•ç¤ºäº†æˆ‘ä»¬å°†åœ¨ç¬¬3éƒ¨åˆ†ä¸­å¼€å‘çš„æ‰€æœ‰è¡¨å•ç‰¹æ€§</figcaption></figure><p id="ad03" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä¸‹é¢å±•ç¤ºäº†æˆ‘ä»¬çš„æ ‡å‡†HTMLè¡¨å•è§£å†³æ–¹æ¡ˆã€‚å¦‚æœä½ æ£€æŸ¥ä¸€ä¸‹HTMLï¼Œä½ ä¼šçœ‹åˆ°æˆ‘ä»¬åªæ˜¯ä½¿ç”¨å¸¸è§„çš„æ—§çš„<code class="fe kp kq kr ks b">&lt;form /&gt;</code>ã€<code class="fe kp kq kr ks b">&lt;label /&gt;</code>å’Œ<code class="fe kp kq kr ks b">&lt;input /&gt;</code>æ ‡ç­¾ã€‚<code class="fe kp kq kr ks b">useForm</code>æä¾›è¡¨å•çš„åŠŸèƒ½éœ€æ±‚ã€‚UIç”±æœ€ç»ˆè¡¨å•åˆ›å»ºè€…æ¥å®ç°ã€‚</p><p id="7345" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" href="https://github.com/shanplourde/react-hooks-form-util" rel="noopener ugc nofollow" target="_blank">å®Œæ•´çš„è§£å†³æ–¹æ¡ˆå¯ä»¥åœ¨æˆ‘çš„github </a>ä¸­æ‰¾åˆ°ã€‚æ¼”ç¤ºä¸­æœ‰å¾ˆå¤šæ ·æ¿æ–‡ä»¶ï¼Œä½†æˆ‘å¸Œæœ›åœ¨è¿™ä¸€ç‚¹ä¸Šæœ‰éå¸¸æ˜ç¡®çš„ä¾‹å­ã€‚è¯·æ³¨æ„ï¼Œç”±äºCodeSandboxè®¾è®¡å†³å®šä¸æ”¯æŒä»<code class="fe kp kq kr ks b">package.json</code>åŠ è½½<code class="fe kp kq kr ks b">devDependencies</code>ï¼Œæµ‹è¯•æ­¤æ—¶ä¸ä¼šé€šè¿‡CodeSandboxã€‚</p><h1 id="70fd" class="kt ku it bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">è®¾è®¡å…¬å…±APIä»¥æ”¯æŒ<code class="fe kp kq kr ks b">validation</code></h1><p id="9537" class="pw-post-body-paragraph jq jr it js b jt lr jv jw jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn im bi translated">æˆ‘å‘ç°åœ¨è®¾è®¡React hooks APIæ—¶ï¼Œæœ€å¥½çš„èµ·ç‚¹æ˜¯é¦–å…ˆç†è§£ä½ å¸Œæœ›å®ƒåšä»€ä¹ˆï¼Œç„¶åä½ å°†å¦‚ä½•ä½¿ç”¨å®ƒã€‚å°½æ—©ç¼–å†™å•å…ƒæµ‹è¯•æœ‰åŠ©äºæ”¹è¿›APIã€‚</p><h2 id="b899" class="mh ku it bd kv mi mj dn kz mk ml dp ld kb mm mn lh kf mo mp ll kj mq mr lp ms bi translated">æˆ‘ä»¬å¸Œæœ›éªŒè¯åšä»€ä¹ˆï¼Ÿ</h2><ul class=""><li id="6f1c" class="mt mu it js b jt lr jx ls kb mv kf mw kj mx kn my mz na nb bi translated">æ”¯æŒå¤šç§å¼€ç®±å³ç”¨çš„éªŒè¯ï¼Œå¦‚requiredã€emailç­‰ã€‚</li><li id="e6d7" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">æ”¯æŒè‡ªå®šä¹‰éªŒè¯</li><li id="0749" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">ä½¿æ–°çš„éªŒè¯æ˜“äºæ·»åŠ </li><li id="2151" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">æ”¯æŒå¼‚æ­¥éªŒè¯</li><li id="c012" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">æ”¯æŒå¯é€‰çš„è¾“å…¥æ¨¡ç³ŠéªŒè¯</li><li id="415d" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">è¡¨å•æäº¤æ—¶åº”æ”¯æŒéªŒè¯</li></ul><h2 id="77f6" class="mh ku it bd kv mi mj dn kz mk ml dp ld kb mm mn lh kf mo mp ll kj mq mr lp ms bi translated">éªŒè¯æœªæ¥ç¾å¥½ç”Ÿæ´»</h2><ul class=""><li id="a187" class="mt mu it js b jt lr jx ls kb mv kf mw kj mx kn my mz na nb bi translated">onBlurå¼‚æ­¥éªŒè¯å¯èƒ½éœ€è¦æ”¯æŒå–æ¶ˆ</li><li id="df12" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">onBlurå¼‚æ­¥éªŒè¯å¯èƒ½å¸Œæœ›åœ¨è¿è¡Œå¼‚æ­¥æ“ä½œä¹‹å‰æ”¯æŒå»¶è¿Ÿâ€”â€”æ¯”å¦‚ä¸€ä¸ª<a class="ae ko" href="https://levelup.gitconnected.com/debounce-in-javascript-improve-your-applications-performance-5b01855e086" rel="noopener ugc nofollow" target="_blank">å»æŠ–ç®—æ³•</a></li><li id="a17d" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">å¯ä»¥å¢å¼ºAPIä»¥å‡å°‘æ ·æ¿æ–‡ä»¶</li><li id="e0a3" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">APIå¯ä»¥é€šè¿‡JSONæ¨¡å¼åº“æ”¯æŒæ¨¡å¼éªŒè¯</li><li id="d55c" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">æ›´å¤§çš„æµ‹è¯•è¦†ç›–èŒƒå›´</li></ul><h2 id="8043" class="mh ku it bd kv mi mj dn kz mk ml dp ld kb mm mn lh kf mo mp ll kj mq mr lp ms bi translated">æˆ‘ä»¬å¸Œæœ›æ¶ˆè´¹è€…å¦‚ä½•ä½¿ç”¨éªŒè¯ï¼Ÿ</h2><p id="f241" class="pw-post-body-paragraph jq jr it js b jt lr jv jw jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn im bi translated">éµå¾ªç¬¬2éƒ¨åˆ†ä¸­æè¿°çš„ç›¸åŒçš„<code class="fe kp kq kr ks b">useInput</code>å“²å­¦ï¼Œå…¶ä¸­<code class="fe kp kq kr ks b">useInput</code>ä»è¡¨å•åˆ›å»ºè€…ä¸­æŠ½è±¡å‡ºæ¥ï¼ŒéªŒè¯ä¹Ÿå°†è¢«æŠ½è±¡å‡ºæ¥ã€‚<code class="fe kp kq kr ks b">useForm</code>çš„æœ€ç»ˆç”¨æˆ·å°†é€šè¿‡<code class="fe kp kq kr ks b">useForm</code> APIé…ç½®ä»–ä»¬çš„è¾“å…¥éªŒè¯ã€‚</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/0c5fe7eb55c12454e86560cb1793eca1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V8n9PLzfKTsY3xlQE2-D-w.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">å›¾1-ä½¿ç”¨è¡¨å•å’ŒéªŒè¯çŠ¶æ€ç®¡ç†ä»¥åŠAPIä½¿ç”¨</figcaption></figure><p id="2e85" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¦‚å›¾1æ‰€ç¤ºï¼Œæˆ‘å¸Œæœ›è¡¨å•æ¶ˆè´¹è€…ç›´æ¥ä½¿ç”¨<code class="fe kp kq kr ks b">useForm</code>é’©å­è¿›è¡ŒéªŒè¯ï¼Œå¹¶è®©<code class="fe kp kq kr ks b">useForm</code>ç›´æ¥å¤„ç†ç®¡ç†æ•´ä½“è¡¨å•éªŒè¯å’Œå•ä¸ªè¡¨å•å­—æ®µéªŒè¯ã€‚<code class="fe kp kq kr ks b">useForm</code>å°†é…ç½®éœ€è¦åœ¨è¾“å…¥æ¨¡ç³Šå’Œè¡¨å•æäº¤æ—¶è§¦å‘çš„éªŒè¯ã€‚<code class="fe kp kq kr ks b">useForm</code>å°†å‘è¡¨å•åˆ›å»ºè€…æä¾›æ­¤éªŒè¯çŠ¶æ€ã€‚è¿™å°†å…è®¸è¡¨å•åˆ›å»ºè€…:</p><ul class=""><li id="9a96" class="mt mu it js b jt ju jx jy kb no kf np kj nq kn my mz na nb bi translated">åŸºäºå•ä¸ªè¾“å…¥æŸ¥è¯¢éªŒè¯é”™è¯¯</li><li id="bf0c" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">æŸ¥è¯¢æ•´ä½“è¡¨å•æœ‰æ•ˆæ€§</li><li id="71c4" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">åœ¨è¡¨å•åˆ›å»ºè€…çš„<code class="fe kp kq kr ks b">onSubmit</code>å›è°ƒæœŸé—´ï¼Œè¡¨å•åˆ›å»ºè€…å¯ä»¥æ£€æŸ¥æ•´ä½“æœ‰æ•ˆæ€§ï¼Œå¹¶å†³å®šæ˜¯å¦è¦æäº¤è¡¨å•æ•°æ®</li><li id="25fd" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">æŸ¥è¯¢å¼‚æ­¥éªŒè¯å½“å‰æ˜¯å¦æ­£åœ¨è¿è¡Œ(ä¾‹å¦‚ï¼Œè¡¨å•åˆ›å»ºè€…å¯ä»¥é˜»æ­¢é¢å¤–çš„è¡¨å•æäº¤)</li></ul><p id="30ee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ­¤å¤–ï¼Œè¡¨å•åˆ›å»ºè€…åº”è¯¥èƒ½å¤Ÿ:</p><ul class=""><li id="baf7" class="mt mu it js b jt ju jx jy kb no kf np kj nq kn my mz na nb bi translated">å¼‚æ­¥éªŒè¯æˆ–æäº¤è¿è¡Œæ—¶é˜»æ­¢è¡¨å•æäº¤</li><li id="e818" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">å¯ä»¥é€‰æ‹©å…è®¸è¾“å…¥å­˜å‚¨æ— æ•ˆæ•°æ®ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©é˜»æ­¢è¾“å…¥å­˜å‚¨æ— æ•ˆæ•°æ®ï¼Œè¿™å–å†³äºè¾“å…¥å¦‚ä½•ä½œç”¨äºéªŒè¯çŠ¶æ€</li><li id="bdf5" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">æ ¹æ®è¡¨å•çš„è®¾è®¡ï¼Œæäº¤æˆ–é˜»æ­¢æäº¤æ— æ•ˆè¡¨å•</li></ul><h2 id="ee61" class="mh ku it bd kv mi mj dn kz mk ml dp ld kb mm mn lh kf mo mp ll kj mq mr lp ms bi translated">çŠ¶æ€ç®¡ç†è®¾è®¡</h2><p id="8916" class="pw-post-body-paragraph jq jr it js b jt lr jv jw jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn im bi translated">å¦‚å›¾1æ‰€ç¤ºï¼Œ<code class="fe kp kq kr ks b">useInput</code>ä¸ä¼šç®¡ç†ä»»ä½•ç±»å‹çš„éªŒè¯çŠ¶æ€ã€‚æˆ‘æ›´å–œæ¬¢ç”¨<code class="fe kp kq kr ks b">useInput</code>é’©å­æ¥ç®¡ç†è¾“å…¥çŠ¶æ€å’Œè¾“å…¥UIçŠ¶æ€(åŸå§‹çš„ï¼Œå·²è®¿é—®çš„)ã€‚</p><p id="4476" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘æ›´å–œæ¬¢ç”¨<code class="fe kp kq kr ks b">useForm</code>æ¥ç®¡ç†éªŒè¯çŠ¶æ€ã€‚æˆ‘çš„ç›´è§‰å‘Šè¯‰æˆ‘ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªéªŒè¯æŒ‚é’©<em class="nr"/><strong class="js iu"><em class="nr"/></strong>ï¼Œä½†æ˜¯æˆ‘ç°åœ¨çœ‹ä¸åˆ°è¿™ä¸ªéœ€è¦ã€‚</p><p id="4ad5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">æ•´ä½“UIéªŒè¯çŠ¶æ€</strong></p><p id="eaee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe kp kq kr ks b">useForm</code>é€šè¿‡<code class="fe kp kq kr ks b">uiState</code>å±æ€§è·Ÿè¸ªæ•´ä¸ªè¡¨å•çš„æœ‰æ•ˆæ€§çŠ¶æ€ã€‚ä¸€ä¸ªä¾‹å­:<code class="fe kp kq kr ks b">{â€œisValidatingâ€:false,â€isValidâ€:true,â€isSubmittingâ€:false}</code>ã€‚ä¸€æ—¦è¯„ä¼°äº†æ‰€æœ‰éªŒè¯ï¼Œå°†åœ¨æäº¤è¡¨å•æ—¶é‡æ–°è¯„ä¼°æ•´ä¸ªè¡¨å•çš„æœ‰æ•ˆæ€§ã€‚<code class="fe kp kq kr ks b">isValidating</code>è·Ÿè¸ªå¼‚æ­¥éªŒè¯æ˜¯å¦æ­£åœ¨è¿è¡Œã€‚<code class="fe kp kq kr ks b">isValid</code>è·Ÿè¸ªæ‰€æœ‰è¾“å…¥æ˜¯å¦æœ‰æ•ˆã€‚</p><p id="17b2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">ä¸ªäººè¾“å…¥éªŒè¯çŠ¶æ€</strong></p><p id="7684" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe kp kq kr ks b">useForm</code>é€šè¿‡<code class="fe kp kq kr ks b">formValidity</code>å±æ€§è·Ÿè¸ªå•ä¸ªéªŒè¯å™¨çš„éªŒè¯çŠ¶æ€ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹å€¼ä¸­ï¼Œ<code class="fe kp kq kr ks b">formValidity</code>æœ‰3ä¸ªå­—æ®µï¼Œ<code class="fe kp kq kr ks b">firstName</code>ã€<code class="fe kp kq kr ks b">lastName</code>å’Œ<code class="fe kp kq kr ks b">email</code>ï¼Œå®ƒä»¬éƒ½è¢«æ ‡è®°ä¸ºæœ‰æ•ˆ:</p><pre class="lw lx ly lz gt ns ks nt nu aw nv bi"><span id="32d3" class="mh ku it ks b gy nw nx l ny nz">{"firstName":{"field":"firstName","valid":true},"lastName":{"field":"lastName","valid":true},"email":{"field":"email","valid":true}}</span></pre><p id="092c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­,<code class="fe kp kq kr ks b">lastName</code>å­—æ®µè¢«æ ‡è®°ä¸ºæ— æ•ˆï¼Œè€Œ<code class="fe kp kq kr ks b">errors</code>å±æ€§æ˜¯ä¸€ä¸ªå¤±è´¥çš„éªŒè¯é›†åˆâ€”â€”åœ¨æœ¬ä¾‹ä¸­æ˜¯å¿…éœ€çš„ã€‚<code class="fe kp kq kr ks b">email</code>å­—æ®µè¢«æ ‡è®°ä¸ºæ— æ•ˆï¼ŒéªŒè¯å¤±è´¥çš„æ˜¯INVALID_EMAIL:</p><pre class="lw lx ly lz gt ns ks nt nu aw nv bi"><span id="7878" class="mh ku it ks b gy nw nx l ny nz">{"firstName":{"field":"firstName","valid":true},"lastName":{"field":"lastName","valid":false,"errors":["REQUIRED"]},"email":{"field":"email","valid":false,"errors":["INVALID_EMAIL"]}}</span></pre><p id="b8f3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä½¿ç”¨<code class="fe kp kq kr ks b">formValidity</code>å±æ€§ï¼Œé”™è¯¯è¢«è®¾è®¡ä¸ºæ”¯æŒå¤šä¸ªéªŒè¯ã€‚ç„¶è€Œï¼Œæˆ‘å¯¹éªŒè¯çš„åå¥½æ˜¯ä¸€æ—¦ä¸€ä¸ªå¤±è´¥å°±åœæ­¢è¯„ä¼°å®ƒä»¬ã€‚æˆ‘ç›¸ä¿¡è¿™æé«˜äº†UIæ€§èƒ½ï¼Œå‡å°‘äº†ä¸å¿…è¦çš„ç½‘ç»œå¾€è¿”ï¼Œç­‰ç­‰ã€‚æ‰€ä»¥è¿™åœ¨æœªæ¥å¯èƒ½ä¼šæ”¹å˜ï¼Œä½†æˆ‘å–œæ¬¢å®ƒæä¾›çš„å¯ä¼¸ç¼©æ€§ã€‚</p><p id="1fa8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¡¨å•åˆ›å»ºè€…å¯ä»¥å†³å®šåœ¨å‘ç”ŸéªŒè¯é”™è¯¯æ—¶å‘æœ€ç»ˆç”¨æˆ·æ˜¾ç¤ºå“ªäº›é”™è¯¯å†…å®¹ã€‚</p><p id="3d95" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">è·Ÿè¸ªå¼‚æ­¥è¾“å…¥éªŒè¯çš„çŠ¶æ€</strong></p><p id="9fb1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe kp kq kr ks b">formValidity</code>å±æ€§ä¹Ÿè·Ÿè¸ªå¼‚æ­¥éªŒè¯çŠ¶æ€ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºåä¸º<code class="fe kp kq kr ks b">custom</code>çš„å­—æ®µå½“å‰æ— æ•ˆã€‚é™¤äº†æ— æ•ˆä¹‹å¤–ï¼Œè¯¥å­—æ®µè¿˜è¢«å†æ¬¡å¼‚æ­¥éªŒè¯ï¼Œå¦‚<code class="fe kp kq kr ks b">isValidating: true</code>å±æ€§æ‰€ç¤ºã€‚å½“<code class="fe kp kq kr ks b">isValidating</code>ä¸ºçœŸæ—¶ï¼Œæ·»åŠ <code class="fe kp kq kr ks b">value</code>å±æ€§ï¼Œå¦‚æœè¾“å…¥å€¼ä»ç„¶ç›¸åŒï¼Œåˆ™å…è®¸å¿½ç•¥é‡å çš„å¼‚æ­¥onBluréªŒè¯ã€‚</p><pre class="lw lx ly lz gt ns ks nt nu aw nv bi"><span id="be2c" class="mh ku it ks b gy nw nx l ny nz">{"field":"custom","valid":false,"errors":["CUSTOM_ASYNC_ERROR"],"isValidating":true,"value":"custom"}</span></pre><p id="4edd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">æœªæ¥é‡æ„çš„è€ƒè™‘äº‹é¡¹</strong></p><p id="526c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨æ¨¡ç³Šæ—¶è§¦å‘çš„å¼‚æ­¥éªŒè¯çš„ç†æƒ³é•¿æœŸè®¾è®¡è¿˜åº”è¯¥åŒ…æ‹¬å»æŠ–åŠ¨å’Œæ‰¿è¯ºå–æ¶ˆï¼Œå› ä¸ºè¿™äº›å°†æœ‰åŠ©äºé˜²æ­¢è¿‡å¤šçš„å¼‚æ­¥éªŒè¯åœ¨è¾“å…¥æ¨¡ç³Šæ—¶è§¦å‘ã€‚</p><p id="6f47" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¦‚æœåœ¨ä»¥åçš„æŸä¸ªæ—¶åˆ»ï¼Œå¾ˆæ˜æ˜¾éœ€è¦è¿›ä¸€æ­¥çš„æŠ½è±¡ï¼Œé‚£ä¹ˆéªŒè¯å¯ä»¥ä»<code class="fe kp kq kr ks b">useForm</code>ä¸­æŠ½è±¡å‡ºæ¥ã€‚æˆ‘é€šå¸¸æ›´å–œæ¬¢æŒç»­é‡æ„ï¼Œè€Œä¸æ˜¯åœ¨æ„¿æ™¯ä¸å®Œå…¨æ¸…æ™°çš„æƒ…å†µä¸‹ä»ä¸€å¼€å§‹å°±è¿‡åº¦å·¥ç¨‹åŒ–ã€‚</p><p id="ea7a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¾“å…¥è¡¨å•å°†é€šè¿‡<code class="fe kp kq kr ks b">useForm</code>é’©å­æ¥æ”¶æ‰€æœ‰çš„éªŒè¯çŠ¶æ€ã€‚</p><h2 id="4d64" class="mh ku it bd kv mi mj dn kz mk ml dp ld kb mm mn lh kf mo mp ll kj mq mr lp ms bi translated">æºä»£ç å’Œè¯´æ˜</h2><p id="37f7" class="pw-post-body-paragraph jq jr it js b jt lr jv jw jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn im bi translated">ä¸ºäº†è·å¾—åŸºæœ¬çš„éªŒè¯æ”¯æŒï¼Œéœ€è¦å¯¹æºä»£ç è¿›è¡Œå¤§é‡çš„ä¿®æ”¹ã€‚æœ¬èŠ‚å°†å›é¡¾ä¸€éƒ¨åˆ†ä»£ç å˜æ›´ï¼Œä½†æ˜¯æ•´ä¸ªè§£å†³æ–¹æ¡ˆå¯ä»¥åœ¨github ä¸­å›é¡¾ã€‚</p><p id="8927" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> validators.js </strong></p><p id="fc99" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe kp kq kr ks b">validators.js</code>æ˜¯ä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªAPIæ¥åˆ›å»ºæ–°çš„éªŒè¯å™¨ï¼Œå¹¶æä¾›äº†ä¸€äº›ç°æˆçš„è‚¡ç¥¨éªŒè¯å™¨ã€‚å…³äºè®¾è®¡å’Œå®ç°çš„ä¸€äº›è®¾è®¡:</p><ul class=""><li id="d688" class="mt mu it js b jt ju jx jy kb no kf np kj nq kn my mz na nb bi translated">è¡¨å•åº“çš„æœ€ç»ˆç”¨æˆ·å°†ä½¿ç”¨å¯¼å‡ºçš„<code class="fe kp kq kr ks b">createValidator</code>ï¼Œä»¥åŠåº“å­˜çš„<code class="fe kp kq kr ks b">email</code>å’Œ<code class="fe kp kq kr ks b">required</code>éªŒè¯å™¨</li><li id="a518" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated"><code class="fe kp kq kr ks b">createValidator</code>å‡½æ•°è¿”å›ä¸€ä¸ªå¸¦æœ‰<code class="fe kp kq kr ks b">validate</code>å‡½æ•°çš„å¯¹è±¡ï¼Œè¿™ä¸ªå‡½æ•°å°†è¢«<code class="fe kp kq kr ks b">useForm</code>é’©å­ä½¿ç”¨</li><li id="eb4b" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">åœ¨è¡¨å•æäº¤ä¹‹å‰ï¼Œ<code class="fe kp kq kr ks b">useForm</code>é’©å­å°†ä½¿ç”¨<code class="fe kp kq kr ks b">runValidators</code>å‡½æ•°æ¥è¿è¡Œè¡¨å•ä¸Šçš„æ‰€æœ‰éªŒè¯å™¨</li><li id="12ab" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated"><code class="fe kp kq kr ks b">useForm</code>é’©å­å°†ä¿å­˜æ‰€æœ‰éªŒè¯å™¨çš„é›†åˆ</li><li id="0848" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">è™½ç„¶<code class="fe kp kq kr ks b">useForm</code>é’©å­å°†æ˜¯<code class="fe kp kq kr ks b">validate</code>å‡½æ•°çš„æ¶ˆè´¹è€…ï¼Œä½†æ˜¯æœ€ç»ˆç”¨æˆ·ä¹Ÿå¯ä»¥ä½¿ç”¨<code class="fe kp kq kr ks b">validate</code>åº“</li><li id="ee06" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">è¿˜éœ€è¦ä¸€äº›ä¸éªŒè¯ç›¸å…³çš„ä¸œè¥¿ï¼Œæ¯”å¦‚â€œéªŒè¯å™¨åº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™è§¦å‘â€ã€‚ä¸ºäº†é™åˆ¶è¯¥æ–‡ä»¶çš„è´£ä»»ï¼Œè¿™äº›å°†æ˜¯<code class="fe kp kq kr ks b">useForm</code>é’©å­çš„è´£ä»»ã€‚</li><li id="89b2" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated"><code class="fe kp kq kr ks b">validate</code>å°†é˜»å¡å¼‚æ­¥éªŒè¯å‡½æ•°ï¼Œç›´åˆ°å®ƒä»¬è¿”å›</li><li id="1498" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">å¦‚æœvalidateå‡½æ•°å‡ºé”™ï¼Œ<code class="fe kp kq kr ks b">validate</code>å°†è¿”å›<code class="fe kp kq kr ks b">undeterminedValidations</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªæœªèƒ½å®Œæˆçš„éªŒè¯å™¨çš„é›†åˆã€‚<code class="fe kp kq kr ks b">useForm</code>é’©å­çš„æœ€ç»ˆç”¨æˆ·å¯ä»¥æ£€æŸ¥è¿™ä¸ªé›†åˆå¹¶å†³å®šæ˜¯å¦æäº¤ä¸€ä¸ªè¡¨å•</li><li id="bbb8" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">æˆ‘ä»¬ä½¿ç”¨<code class="fe kp kq kr ks b"><a class="ae ko" href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous/Async_await" rel="noopener ugc nofollow" target="_blank">async</a></code> <a class="ae ko" href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous/Async_await" rel="noopener ugc nofollow" target="_blank"> / </a> <code class="fe kp kq kr ks b"><a class="ae ko" href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous/Async_await" rel="noopener ugc nofollow" target="_blank">await</a></code>ä½¿æˆ‘ä»¬çš„å¼‚æ­¥ä»£ç æ›´å…·å¯è¯»æ€§</li></ul><pre class="lw lx ly lz gt ns ks nt nu aw nv bi"><span id="0b5d" class="mh ku it ks b gy nw nx l ny nz">export const constants = {<br/>  undetermined: "undetermined"<br/>};</span><span id="5868" class="mh ku it ks b gy oa nx l ny nz">export const runValidators = async ({<br/>  field,<br/>  validators,<br/>  eventType,<br/>  value<br/>}) =&gt; {<br/>  const valPromises = [];<br/>  validators<br/>    .filter(validator =&gt; {<br/>      return validator.when.some(whenItem =&gt; whenItem === eventType);<br/>    })<br/>    .forEach(async validator =&gt; {<br/>      valPromises.push(validator.validate(value));<br/>    });<br/>  const validationResults = await Promise.all(valPromises);<br/>  const validationErrors = validationResults.filter(<br/>    result =&gt; !result.valid &amp;&amp; !result.undeterminedValidation<br/>  );<br/>  const undeterminedValidations = validationResults<br/>    .filter(<br/>      result =&gt;<br/>        result.undeterminedValidation &amp;&amp;<br/>        result.undeterminedValidation.length &gt; 0<br/>    )<br/>    .map(validation =&gt; validation.undeterminedValidation);<br/>  const undetermined =<br/>    undeterminedValidations.length === 0<br/>      ? null<br/>      : {<br/>          undeterminedValidations<br/>        };</span><span id="a968" class="mh ku it ks b gy oa nx l ny nz">if (validationErrors.length === 0)<br/>    return { field, valid: true, ...undetermined };<br/>  return {<br/>    field,<br/>    valid: false,<br/>    errors: validationErrors.map(error =&gt; error.error),<br/>    ...undetermined<br/>  };<br/>};</span><span id="afdd" class="mh ku it ks b gy oa nx l ny nz">/**<br/> * Returns a new validator definition<br/> * <a class="ae ko" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> {*} validateFn - validation function. Receives<br/> *        value<br/> * <a class="ae ko" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> {*} error - Error constant if validation fails<br/> *            Readable copy would be provided by application<br/> */<br/>export const createValidator = ({ validateFn, error = "ERROR_KEY" }) =&gt; {<br/>  return {<br/>    validate: async text =&gt; {<br/>      try {<br/>        const isValid = await validateFn(text);<br/>        if (typeof isValid === "boolean" &amp;&amp; isValid) {<br/>          return { valid: true };<br/>        }<br/>        return { valid: false, error };<br/>      } catch {<br/>        return { undeterminedValidation: error };<br/>      }<br/>    }<br/>  };<br/>};</span><span id="66ad" class="mh ku it ks b gy oa nx l ny nz">/**<br/> * A required field validator that fires on blur and submit<br/> */<br/>export const required = createValidator({<br/>  validateFn: text =&gt; (text || "").length &gt; 0,<br/>  error: "REQUIRED"<br/>});</span><span id="6bf5" class="mh ku it ks b gy oa nx l ny nz">/**<br/> * An email validator that fires on blur and submit<br/> */<br/>export const email = createValidator({<br/>  validateFn: text =&gt; {<br/>    const re = /^(([^&lt;&gt;()[\]\\.,;:\s@"]+(\.[^&lt;&gt;()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;<br/>    return !text || re.test(String(text).toLowerCase());<br/>  },<br/>  error: "INVALID_EMAIL"<br/>});</span></pre><p id="4ab4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> validators.test.js </strong></p><p id="e95b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe kp kq kr ks b">validators.test.js</code>åŒ…æ‹¬è¦†ç›–<code class="fe kp kq kr ks b">validations.js</code>æ–‡ä»¶çš„å•å…ƒæµ‹è¯•ã€‚å®Œæ•´çš„æµ‹è¯•æ–‡ä»¶å¯ä»¥åœ¨github repoä¸­æ‰¾åˆ°ã€‚</p><ul class=""><li id="7549" class="mt mu it js b jt ju jx jy kb no kf np kj nq kn my mz na nb bi translated">æˆ‘ä»¬æ­£åœ¨æµ‹è¯•åŒæ­¥å’Œå¼‚æ­¥éªŒè¯é€»è¾‘</li><li id="cd55" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">æˆ‘ä»¬æ­£åœ¨æµ‹è¯•validations.jsæ–‡ä»¶çš„æ‰€æœ‰è·¯å¾„å’ŒçŠ¶æ€</li></ul><p id="1457" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">ä½¿ç”¨å½¢å¼. js </strong></p><p id="f030" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä¸éªŒè¯ç›¸å…³çš„æ›´æ–°åœ¨ä¸‹é¢çš„<code class="fe kp kq kr ks b">useForm</code>ä¸­ä»¥ç²—ä½“æ˜¾ç¤ºã€‚</p><ul class=""><li id="444d" class="mt mu it js b jt ju jx jy kb no kf np kj nq kn my mz na nb bi translated"><code class="fe kp kq kr ks b">useForm</code>ç”¨<code class="fe kp kq kr ks b">formValidity</code>çŠ¶æ€å¯¹è±¡è·Ÿè¸ªæœ‰æ•ˆçŠ¶æ€ã€‚åœ¨<code class="fe kp kq kr ks b">formValidity</code>ä¸­ï¼Œæ¯ä¸ªè¾“å…¥å­—æ®µéƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„é”®</li><li id="7417" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">è¡¨å•çš„æ•´ä½“UIçŠ¶æ€è·Ÿè¸ª<code class="fe kp kq kr ks b">isValidating</code>å’Œ<code class="fe kp kq kr ks b">isValid</code>ã€‚è¿™äº›å…è®¸è¡¨å•åˆ›å»ºè€…è·Ÿè¸ªéªŒè¯æ˜¯å¦æ­£åœ¨è¿è¡Œï¼Œä»¥åŠè¡¨å•æ•´ä½“æ˜¯å¦æœ‰æ•ˆ</li><li id="e808" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated"><code class="fe kp kq kr ks b">onSubmit</code>æ°¸ä¸å±è”½ã€‚é˜»æ­¢æäº¤ç”±è¡¨å•ä½œè€…å†³å®šã€‚è¡¨å•ä½œè€…æ¥æ”¶éªŒè¯çŠ¶æ€</li><li id="fe67" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated"><code class="fe kp kq kr ks b">onInputBlur</code>æ‰§è¡Œä¸€ä¸ªç®€å•çš„æµ‹è¯•ï¼Œå¦‚æœå¼‚æ­¥éªŒè¯å½“å‰æ­£åœ¨ä½¿ç”¨ç›¸åŒçš„æµ‹è¯•å€¼è¿›è¡Œï¼Œè¯¥æµ‹è¯•å¯é˜²æ­¢å¼‚æ­¥éªŒè¯å†æ¬¡è¿è¡Œ</li></ul><pre class="lw lx ly lz gt ns ks nt nu aw nv bi"><span id="9ca1" class="mh ku it ks b gy nw nx l ny nz">import { useState } from "react";<br/>import { useInput } from "./use-input";<br/><strong class="ks iu">import { runValidators } from "./validators";</strong></span><span id="9e38" class="mh ku it ks b gy oa nx l ny nz">export const defaultFormProps = {<br/>  autoComplete: "on"<br/>};</span><span id="8458" class="mh ku it ks b gy oa nx l ny nz">export const useForm = (name, initialState = {}) =&gt; {<br/>  const [formValues] = useState({<br/>    ...initialState<br/>  });<br/><strong class="ks iu">  const [formValidity, setFormValidity] = useState({});<br/>  const [validators] = useState({});<br/></strong>  const [uiState, setUiState] = useState({<br/><strong class="ks iu">    isValidating: false,<br/>    isValid: true,<br/></strong>    isSubmitting: false<br/>  });<br/>  const [inputs] = useState({});</span><span id="daa9" class="mh ku it ks b gy oa nx l ny nz"><strong class="ks iu">const validateAll = async () =&gt; {<br/>    const promises = [];<br/>    let newUiState = { ...uiState };</strong></span><span id="3d73" class="mh ku it ks b gy oa nx l ny nz"><strong class="ks iu">Object.keys(validators).forEach(async field =&gt; {<br/>      promises.push(<br/>        runValidators({<br/>          field,<br/>          validators: validators[field],<br/>          eventType: "onBlur",<br/>          value: inputs[field].value<br/>        })<br/>      );<br/>    });</strong></span><span id="c25f" class="mh ku it ks b gy oa nx l ny nz"><strong class="ks iu">newUiState = {<br/>      ...newUiState,<br/>      isValidating: true<br/>    };<br/>    setUiState(newUiState);</strong></span><span id="ba01" class="mh ku it ks b gy oa nx l ny nz"><strong class="ks iu">const results = await Promise.all(promises);<br/>    results.forEach(result =&gt; {<br/>      formValidity[result.field] = result;<br/>    });</strong></span><span id="92be" class="mh ku it ks b gy oa nx l ny nz"><strong class="ks iu">setUiState({ ...newUiState, isValidating: false });<br/>  };</strong></span><span id="5562" class="mh ku it ks b gy oa nx l ny nz">const onSubmit = async (evt, props) =&gt; {<br/>    evt.preventDefault();<br/>    let newUiState = { ...uiState };<br/>    try {<br/><strong class="ks iu">      await validateAll();<br/>      const isFormValid = !Object.keys(formValidity).some(<br/>        field =&gt; !formValidity[field].valid<br/>      );</strong></span><span id="905c" class="mh ku it ks b gy oa nx l ny nz">newUiState = {<br/>        ...newUiState,<br/>        isSubmitting: true,<br/><strong class="ks iu">        isValid: isFormValid<br/></strong>      };<br/>      setUiState(newUiState);<br/>      if (props.onSubmit) {<br/>        await props.onSubmit({ evt, formValues });<br/>      }<br/>      setUiState({ ...newUiState, isSubmitting: false });<br/>    } catch {<br/>      setUiState({ ...newUiState, isSubmitting: false });<br/>    }<br/>  };</span><span id="4c0f" class="mh ku it ks b gy oa nx l ny nz">const getFormProps = (props = {}) =&gt; ({<br/>    ...defaultFormProps,<br/>    ...props,<br/>    onSubmit: evt =&gt; onSubmit(evt, props)<br/>  });</span><span id="ed92" class="mh ku it ks b gy oa nx l ny nz">const onInputChange = (name, value) =&gt; {<br/>    formValues[name] = value;<br/>  };</span><span id="6d34" class="mh ku it ks b gy oa nx l ny nz"><strong class="ks iu">const onInputBlur = async (name, value) =&gt; {<br/>    if (validators[name]) {<br/>      if (<br/>        formValidity[name] &amp;&amp;<br/>        formValidity[name].isValidating &amp;&amp;<br/>        formValidity[name].value === value<br/>      ) {<br/>        // No need to do anything at this point since validator is already running<br/>        return;<br/>      }<br/>      setFormValidity({<br/>        ...formValidity,<br/>        [name]: { ...formValidity[name], isValidating: true, value }<br/>      });<br/>      const validationResults = await runValidators({<br/>        field: name,<br/>        validators: validators[name],<br/>        eventType: "onBlur",<br/>        value<br/>      });<br/>      setFormValidity({ ...formValidity, [name]: validationResults });<br/>    }<br/>  };</strong></span><span id="2c1d" class="mh ku it ks b gy oa nx l ny nz">const addInput = ({ name, value<strong class="ks iu">, validators: inputValidators = []</strong> }) =&gt; {<br/>    const input = useInput({<br/>      name,<br/>      value,<br/>      props: { onChange: onInputChange, onBlur: onInputBlur }<br/>    });<br/>    inputs[name] = input;<br/>    formValues[name] = value;<br/><strong class="ks iu">    validators[name] = inputValidators;</strong><br/>    return input;<br/>  };</span><span id="0445" class="mh ku it ks b gy oa nx l ny nz">return {<br/>    getFormProps,<br/>    formValues,<br/><strong class="ks iu">    formValidity,</strong><br/>    uiState,<br/>    inputs,<br/>    api: {<br/>      addInput<br/>    }<br/>  };<br/>};</span></pre><p id="27b8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> use-form.test.js </strong></p><p id="4906" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ·»åŠ äº†ä¸éªŒè¯ç›¸å…³çš„use-form.test.jsæ›´æ–°ï¼Œå¯ä»¥åœ¨githubèµ„æºåº“ä¸­æ‰¾åˆ°ã€‚ä¸‹é¢æ˜¾ç¤ºäº†use-form.test.jsä¸­çš„ä¸€ä¸ªæµ‹è¯•ã€‚å®ƒå±•ç¤ºäº†æˆ‘ä»¬å¦‚ä½•åœ¨è§¦å‘æ¨¡ç³Šçš„å¼‚æ­¥éªŒè¯è¿‡ç¨‹ä¸­æµ‹è¯•çŠ¶æ€å˜åŒ–ã€‚</p><pre class="lw lx ly lz gt ns ks nt nu aw nv bi"><span id="63fc" class="mh ku it ks b gy nw nx l ny nz">it("should be able to add an input with valid asynchronous validation and get correct formValidity input state", async () =&gt; {<br/>    const customValidator = createValidator({<br/>      validateFn: async text =&gt;<br/>        await new Promise(resolve =&gt; {<br/>          setTimeout(() =&gt; resolve(true), 1);<br/>        }),<br/>      error: "CUSTOM_ASYNC_ERROR"<br/>    });</span><span id="0363" class="mh ku it ks b gy oa nx l ny nz">const { result, waitForNextUpdate } = renderHook(() =&gt; useForm());</span><span id="2622" class="mh ku it ks b gy oa nx l ny nz">renderHook(() =&gt;<br/>      result.current.api.addInput({<br/>        name: "test",<br/>        value: "",<br/>        validators: [{ ...customValidator, when: ["onBlur"] }]<br/>      })<br/>    );<br/>    await result.current.inputs.test.getInputProps().onBlur({<br/>      preventDefault: noop,<br/>      target: {<br/>        value: ""<br/>      }<br/>    });<br/>    expect(result.current.formValidity).toEqual({<br/>      test: { isValidating: true, value: "" }<br/>    });</span><span id="8c7d" class="mh ku it ks b gy oa nx l ny nz">jest.runAllTimers();<br/>    await waitForNextUpdate();</span><span id="1996" class="mh ku it ks b gy oa nx l ny nz">expect(result.current.formValidity).toEqual({<br/>      test: { field: "test", valid: true }<br/>    });<br/>  });</span></pre><h1 id="6b14" class="kt ku it bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">æ‘˜è¦</h1><p id="f5bb" class="pw-post-body-paragraph jq jr it js b jt lr jv jw jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn im bi translated">åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®¾è®¡äº†åŸºæœ¬çš„è¾“å…¥éªŒè¯æ”¯æŒï¼Œä¿®æ”¹äº†<code class="fe kp kq kr ks b">useForm</code>é’©å­æ¥æ”¯æŒå®ƒï¼Œå†³å®šäº†éªŒè¯çŠ¶æ€è§£å†³æ–¹æ¡ˆï¼Œæ·»åŠ äº†é€‚å½“çš„æµ‹è¯•è¦†ç›–ï¼Œå¹¶æ‰©å±•äº†æˆ‘ä»¬çš„è¡¨å•ç¤ºä¾‹ã€‚</p><p id="0a2b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨åé¢çš„éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå…¶ä»–ä¸»é¢˜ï¼Œæ¯”å¦‚å‡å°‘æ ·æ¿æ–‡ä»¶ã€ä»JSONæ¨¡å¼æ·»åŠ éªŒè¯ã€æ‰¿è¯ºå–æ¶ˆã€å»æŠ–åŠ¨ã€é’©å­æ€§èƒ½è€ƒè™‘å’Œå…¶ä»–è®¾è®¡ä¼˜åŒ–ã€‚</p><p id="a8b3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜ã€åé¦ˆæˆ–å»ºè®®ï¼Œæˆ–è€…æ‚¨å¸Œæœ›æˆ‘ä»‹ç»æœ¬ç³»åˆ—ä¸­çš„å…¶ä»–å†…å®¹ï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚</p></div></div>    
</body>
</html>