<html>
<head>
<title>Single-line persistence definitions in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swiftä¸­çš„å•è¡ŒæŒä¹…æ€§å®šä¹‰</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/single-line-persistence-definitions-in-swift-31f32a1dd2aa?source=collection_archive---------1-----------------------#2018-10-02">https://itnext.io/single-line-persistence-definitions-in-swift-31f32a1dd2aa?source=collection_archive---------1-----------------------#2018-10-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4bce" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">å…³äºå¦‚ä½•å‡å°‘ç”¨æˆ·é»˜è®¤/é’¥åŒ™ä¸²è®¿é—®ä»£ç ï¼Œæœ‰å¾ˆå¤šæƒ³æ³•ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªæˆ‘ä¸€ç›´åœ¨ä½¿ç”¨çš„ç®€å•è€Œä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e77c109e10e96edfc576daac609ba560.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qrm6NliqLh2Fy5ZSCkm3eQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">ä¸‹é¢æ˜¯æˆ‘ä»¬å°†è¦å®Œæˆçš„ä»»åŠ¡(ä¸è¦æ‹…å¿ƒï¼Œå®šä¹‰ä¸éœ€è¦æ˜¯é™æ€çš„ï¼)</figcaption></figure><p id="3746" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">ä¸€ä¸ªå¥½çš„é”®å€¼å­˜å‚¨è§£å†³æ–¹æ¡ˆåº”è¯¥å…·æœ‰ä»¥ä¸‹ç‰¹æ€§:</p><ul class=""><li id="76c7" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">å¼ºç±»å‹è®¿é—®</li><li id="0681" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">æ‰€æœ‰å¯èƒ½çš„é’¥åŒ™éƒ½åœ¨ä¸€ä¸ªåœ°æ–¹</li><li id="ad11" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">å¼€å‘äººå‘˜ä¸åº”è¯¥éœ€è¦æ‰‹åŠ¨ç¼–å†™setterså’Œgettersã€‚</li><li id="fbf6" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">å•†åº—çš„ä½ç½®åº”è¯¥å¾ˆå®¹æ˜“æ”¹å˜(ä¾‹å¦‚ï¼Œä½ åº”è¯¥èƒ½å¤Ÿå†³å®šå°†ä¸€ä¸ªå€¼ä»<code class="fe mf mg mh mi b">UserDefaults</code>ç§»åŠ¨åˆ°é’¥åŒ™é“¾ä¸­ï¼Œè€Œä¸éœ€è¦å¤ªå¤šé¢å¤–çš„åŠªåŠ›)</li><li id="edf1" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">å¯¹å­˜å‚¨çš„å¼•ç”¨åº”è¯¥æ ‡è®°ä¸ºåªè¯»</li></ul><p id="61fb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">å€ŸåŠ©æ³›å‹å’Œ<code class="fe mf mg mh mi b">ExpressibleByStringLiteral</code>çš„åŠ›é‡ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œå®ƒä¸ä¾èµ–äºæŸå¤„å­˜åœ¨çš„å¸¦æœ‰é”®åˆ—è¡¨æˆ–æ‰‹åŠ¨è®¿é—®å™¨åˆ—è¡¨çš„æšä¸¾ã€‚</p><h2 id="5290" class="mj mk iq bd ml mm mn dn mo mp mq dp mr le ms mt mu li mv mw mx lm my mz na nb bi translated">æ‰€æœ‰é”®å€¼å­˜å‚¨çš„å…±åŒç‚¹</h2><p id="ad6e" class="pw-post-body-paragraph kv kw iq kx b ky nc jr la lb nd ju ld le ne lg lh li nf lk ll lm ng lo lp lq ij bi translated">æ‰€æœ‰é”®å€¼å­˜å‚¨è§£å†³æ–¹æ¡ˆéƒ½èƒ½å¤Ÿå­˜å‚¨åŸè¯­å¯¹è±¡ã€‚è®©æˆ‘ä»¬æŠŠè¿™çœ‹ä½œæ˜¯æœªæ¥å®ç°çš„å…±åŒæ ‡å‡†ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰€æœ‰å­˜å‚¨çš„å¯¹è±¡éƒ½åº”è¯¥èƒ½å¤ŸæŠŠå®ƒä»¬è‡ªå·±è¡¨ç¤ºä¸ºåŸè¯­ã€‚</p><pre class="kg kh ki kj gt nh mi ni nj aw nk bi"><span id="fdb4" class="mj mk iq mi b gy nl nm l nn no">protocol StoredObject {<br/>    associatedtype Primitive<br/>    func toPrimitive() -&gt; Primitive?<br/>    static func from(primitive: Primitive) -&gt; Self?<br/>}</span></pre><p id="564a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">å¦‚æœæˆ‘ä»¬æƒ³å­˜å‚¨ä¸€ä¸ªåŸè¯­ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°éµå¾ªè¿™ä¸ªåè®®:</p><pre class="kg kh ki kj gt nh mi ni nj aw nk bi"><span id="d332" class="mj mk iq mi b gy nl nm l nn no">extension String: StoredObject {<br/>    <br/>    typealias Primitive = String<br/>    <br/>    func toPrimitive() -&gt; Primitive? {<br/>        return self<br/>    }<br/>    <br/>    static func from(primitive: Primitive) -&gt; Primitive? {<br/>        return primitive<br/>    }<br/>}</span></pre><p id="b6c4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">å®é™…ä¸Šï¼Œä½ çŸ¥é“å—ï¼Œæˆ‘ä»¬ä¸æƒ³é‡å¤<code class="fe mf mg mh mi b">Int</code>ã€<code class="fe mf mg mh mi b">Float</code>ã€<code class="fe mf mg mh mi b">Bool</code>ç­‰æ‰€æœ‰ä»£ç ã€‚è®©æˆ‘ä»¬åˆ›å»ºå¦ä¸€ä¸ªåè®®æ¥å®ç°è¿™ä¸¤ä¸ªç®€å•çš„åŠŸèƒ½:</p><pre class="kg kh ki kj gt nh mi ni nj aw nk bi"><span id="6696" class="mj mk iq mi b gy nl nm l nn no">protocol StoredAsSelf: StoredObject where Primitive == Self { }<br/><br/>extension StoredAsSelf {<br/>    <br/>    func toPrimitive() -&gt; Primitive? {<br/>        return self<br/>    }<br/>    <br/>    static func from(primitive: Primitive) -&gt; Primitive? {<br/>        return primitive<br/>    }<br/>}</span></pre><p id="043d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">æ‰€ä»¥ç°åœ¨å¯¹äºæˆ‘ä»¬æƒ³è¦å­˜å‚¨çš„åŸºæœ¬ç±»å‹ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯:</p><pre class="kg kh ki kj gt nh mi ni nj aw nk bi"><span id="8fd5" class="mj mk iq mi b gy nl nm l nn no">extension String: StoredAsSelf {<br/>    typealias Primitive = String<br/>}<br/><br/>extension Int: StoredAsSelf {<br/>    typealias Primitive = Int<br/>}<br/><br/>extension Float: StoredAsSelf {<br/>    typealias Primitive = Float<br/>}</span></pre><p id="5edd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">å¤ªå¥½äº†ï¼å¦‚æœæ‚¨æƒ³è¦å­˜å‚¨ä¸€ä¸ªéåŸè¯­ç±»å‹(ä¾‹å¦‚ä¸€ä¸ª<code class="fe mf mg mh mi b">Date</code>)ï¼Œåªéœ€é€šè¿‡å°†å…¶åˆ†è§£æˆä¸€ä¸ªåŸè¯­æ¥éµå¾ªåè®®:</p><pre class="kg kh ki kj gt nh mi ni nj aw nk bi"><span id="4d8a" class="mj mk iq mi b gy nl nm l nn no">extension Date: StoredObject {<br/><br/>    typealias Primitive = TimeInterval<br/><br/>    func toPrimitive() -&gt; Primitive? {<br/>        return timeIntervalSince1970<br/>    }<br/><br/>    static func from(primitive: Primitive) -&gt; Date? {<br/>        return Date(timeIntervalSince1970: primitive)<br/>    }<br/>}</span></pre><p id="0d44" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">å¾ˆç®€å•ï¼</p><h2 id="c1cc" class="mj mk iq bd ml mm mn dn mo mp mq dp mr le ms mt mu li mv mw mx lm my mz na nb bi translated">é€šç”¨å­˜å‚¨åŒ…è£…</h2><p id="d6b8" class="pw-post-body-paragraph kv kw iq kx b ky nc jr la lb nd ju ld le ne lg lh li nf lk ll lm ng lo lp lq ij bi translated">å¯¹äºæˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„æ¯ä¸ªå­˜å‚¨è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬åº”è¯¥åˆ¶ä½œä¸€ä¸ªå¼ºç±»å‹çš„åŒ…è£…å™¨ã€‚æˆ‘å°†ä½¿ç”¨<code class="fe mf mg mh mi b">UserDefaults</code>ä½œä¸ºä¾‹å­ï¼Œä½†æ˜¯æ‚¨å½“ç„¶å¯ä»¥ä¸ºä»»ä½•ç¬¬ä¸‰æ–¹è§£å†³æ–¹æ¡ˆå®ç°å®ƒã€‚</p><p id="4c5e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe mf mg mh mi b">ExpressibleByStringLiteral</code>å…è®¸æˆ‘ä»¬ç”¨å­—ç¬¦ä¸²å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ã€‚è¿™éå¸¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸æˆ‘ä»¬çš„<code class="fe mf mg mh mi b">StoredObject</code>é…å¯¹çš„é”®ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ³›å‹æ¥æ¨æ–­<code class="fe mf mg mh mi b">StoredObject</code>çš„ç±»å‹ã€‚ä½†æ˜¯å¦‚æœä½ ä»¥å‰ä½¿ç”¨è¿‡<code class="fe mf mg mh mi b">ExpressibleByStringLiteral</code>ï¼Œä½ ä¼šçŸ¥é“æœ‰ä¸‰ä¸ªåˆå§‹åŒ–å™¨éœ€è¦å®ç°:<code class="fe mf mg mh mi b">init(stringLiteral:)</code>ã€<code class="fe mf mg mh mi b">init(unicodeScalarLiteral:)</code>å’Œ<code class="fe mf mg mh mi b">init(extendedGraphemeClusterLiteral:)</code>ã€‚åœ¨æˆ‘çœ‹æ¥è¿™æ˜¯ä¸å¿…è¦çš„ï¼Œæ‰€ä»¥(å†æ¬¡)è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåè®®æ¥æ‚„æ‚„åœ°å®ç°åä¸¤ä¸ª:</p><pre class="kg kh ki kj gt nh mi ni nj aw nk bi"><span id="0717" class="mj mk iq mi b gy nl nm l nn no">protocol StringLiteralBoilerplate {<br/>    init(stringLiteral value: String)<br/>}<br/><br/>extension StringLiteralBoilerplate {<br/>    typealias StringLiteralType = String<br/><br/>    init(unicodeScalarLiteral value: String) {<br/>        self.init(stringLiteral: value)<br/>    }<br/><br/>    init(extendedGraphemeClusterLiteral value: String) {<br/>        self.init(stringLiteral: value)<br/>    }<br/>}</span></pre><p id="9985" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">ç°åœ¨å‰©ä¸‹çš„å°±æ˜¯åˆ›å»ºæˆ‘ä»¬çš„å­˜å‚¨åŒ…è£…å™¨äº†ã€‚å®ƒå°†æœ‰ä¸€ä¸ªå¿…é¡»æ˜¯<code class="fe mf mg mh mi b">StoredObject</code>çš„æ³›å‹ç±»å‹ï¼Œå¹¶ä¸”å®ƒå°†å®Œæˆ<code class="fe mf mg mh mi b">ExpressibleByStringLiteral</code>çš„å®ç°:</p><pre class="kg kh ki kj gt nh mi ni nj aw nk bi"><span id="6e60" class="mj mk iq mi b gy nl nm l nn no">struct Storable&lt;Object&gt;: ExpressibleByStringLiteral, StringLiteralBoilerplate where Object: StoredObject {<br/><br/>    private let key: String<br/>    private let store = UserDefaults.standard</span><span id="1ae9" class="mj mk iq mi b gy np nm l nn no">    init(stringLiteral value: String) {<br/>        self.key = value<br/>    }<br/><br/>    var value: Object? {<br/>        set {<br/>            store.set(newValue?.toPrimitive(), forKey: key)<br/>        }<br/>        get {<br/>            guard let p = store.value(forKey: key) as? Object.Primitive else { return nil }<br/>            return Object.from(primitive: p)<br/>        }<br/>    }<br/>}</span></pre><p id="bfdf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">åŒæ ·ï¼Œä½ ä¸éœ€è¦åœ¨è¿™é‡Œä½¿ç”¨<code class="fe mf mg mh mi b">UserDefaults</code>â€”â€”å¦‚æœä½ ä¹Ÿéœ€è¦é’¥åŒ™é“¾å­˜å‚¨ï¼Œç®€å•åœ°åˆ›å»ºå¦ä¸€ä¸ªç±»ä¼¼çš„ç»“æ„<code class="fe mf mg mh mi b">KeychainStorable</code>,å¹¶é€‚å½“åœ°å¡«å……å®ƒï¼</p><h2 id="a970" class="mj mk iq bd ml mm mn dn mo mp mq dp mr le ms mt mu li mv mw mx lm my mz na nb bi translated">æŠŠæ‰€æœ‰çš„æ”¾åœ¨ä¸€èµ·</h2><p id="8434" class="pw-post-body-paragraph kv kw iq kx b ky nc jr la lb nd ju ld le ne lg lh li nf lk ll lm ng lo lp lq ij bi translated">æˆ‘å·²ç»åœ¨å‡ ä¸ªåº”ç”¨ç¨‹åºä¸­è®¾ç½®äº†æˆ‘çš„æŒä¹…æ€§å®šä¹‰ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><pre class="kg kh ki kj gt nh mi ni nj aw nk bi"><span id="3bce" class="mj mk iq mi b gy nl nm l nn no">struct Persistence {<br/>    <br/>    struct TabBar {<br/>        var infoiewDate: Storable&lt;Date&gt; = "t.viewDate.info"<br/>        var diaryViewDate: Storable&lt;Date&gt; = "t.viewDate.diary"<br/>        var messagesViewDate: Storable&lt;Date&gt; = "t.viewDate.mess"<br/>    }</span><span id="60f6" class="mj mk iq mi b gy np nm l nn no">    struct Utility {<br/>        var upgradeAlertIgnored: Storable&lt;Bool&gt; = "u.upgradeIgnored"<br/>        var token: KeychainStorable&lt;String&gt; = "u.token"<br/>        var graphData: RAMStorable&lt;[Graph.Body]&gt; = "u.graphData"<br/>    }</span><span id="ab13" class="mj mk iq mi b gy np nm l nn no">    ...<br/>}</span></pre><p id="d19f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">ç„¶åï¼Œåœ¨éœ€è¦è¯»å–å­˜å‚¨æ•°æ®çš„ç±»ä¸­ï¼Œå®ä¾‹åŒ–æ‚¨éœ€è¦çš„é¡¹ç›®ç»„:</p><pre class="kg kh ki kj gt nh mi ni nj aw nk bi"><span id="f1d4" class="mj mk iq mi b gy nl nm l nn no">private var persistence = Persistence.Utility()</span><span id="22ce" class="mj mk iq mi b gy np nm l nn no">...</span><span id="8d26" class="mj mk iq mi b gy np nm l nn no">persistence.upgradeAlertIgnored.value = true <em class="nq">// set/get using .value</em></span></pre><p id="c622" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">æ­¤å¤–ï¼Œåœ¨å®šä¹‰ç»„æ—¶ä½¿ç”¨<code class="fe mf mg mh mi b">struct</code>çš„ä¸€ä¸ªå¥½çš„å‰¯ä½œç”¨æ˜¯ï¼Œå¦‚æœåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ä½¿ç”¨<code class="fe mf mg mh mi b">let</code>ï¼Œé‚£ä¹ˆä½ çš„æŒä¹…æ€§å¼•ç”¨å°†æ˜¯åªè¯»çš„ï¼å½“ç„¶ï¼Œå¦‚æœæœ‰ä¸€å¤©ä½ å†³å®šå°†ä¸€ä¸ªç‰¹å®šçš„å€¼å­˜å‚¨åœ¨Keychainä¸­ï¼Œè€Œä¸æ˜¯å­˜å‚¨åœ¨<code class="fe mf mg mh mi b">UserDefaults</code>ä¸­ï¼Œä½ å¯ä»¥ç®€å•åœ°æ”¹å˜å­˜å‚¨ç»“æ„çš„åç§°ã€‚</p><p id="b77a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">æœ€åï¼Œç”±äºå¯¹å­˜å‚¨çš„è®¿é—®å®é™…ä¸Šæ˜¯å•ä¾‹å¼çš„ï¼Œæ‰€ä»¥åœ¨ç¼–å†™å•å…ƒæµ‹è¯•æ—¶ä¸ä¼šæœ‰ä»»ä½•é—®é¢˜â€”â€”åªéœ€åˆ›å»ºæŒä¹…æ€§ç»„çš„å¦ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æ ¹æ®éœ€è¦æ–­è¨€å€¼ã€‚</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/f6a5aa9a2e7e092860eef1e862de38d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*agHOaM5DKsiIq67zIs9eEw.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">è¿‡å»å‡ ä¸ªæœˆæˆ‘ä¸€ç›´åœ¨ä¸œäº¬å·¥ä½œï¼æˆ‘æ·»åŠ è¿™å¼ ç…§ç‰‡æ˜¯å› ä¸ºa)æˆ‘å–œæ¬¢å®ƒï¼Œb) Mediumä¸è®©æˆ‘é€‰æ‹©ç¬¬ä¸€å¼ å›¾ç‰‡ä½œä¸ºç‰¹è‰²å›¾ç‰‡ï¼Œé™¤éæœ‰ç¬¬äºŒå¼ ğŸ˜‰</figcaption></figure></div></div>    
</body>
</html>