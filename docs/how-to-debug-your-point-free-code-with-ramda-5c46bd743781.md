# å¦‚ä½•ç”¨ Ramda è°ƒè¯•ä½ çš„æ— ç‚¹ä»£ç 

> åŸæ–‡ï¼š<https://itnext.io/how-to-debug-your-point-free-code-with-ramda-5c46bd743781?source=collection_archive---------2----------------------->

![](img/77d858e3381918ec3971a0d7781bfa0a.png)

å¤§çº¦å…­ä¸ªæœˆå‰ï¼Œæˆ‘å¼€å§‹åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ä½¿ç”¨ [Ramda](https://ramdajs.com/) ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºç¼–å†™å‡½æ•°å¼ JavaScript çš„åº“ï¼Œæ€»çš„æ¥è¯´ï¼Œæˆ‘è®¤ä¸ºå®ƒå¸®åŠ©æˆ‘ç¼–å†™äº†æ›´ç®€å•ã€æ›´å®¹æ˜“æ¨ç†ã€æ›´ä¸å®¹æ˜“å‡ºé”™çš„ä»£ç ã€‚è¿™æœ‰å¤šç§åŸå› ï¼Œç‰¹åˆ«æ˜¯ä¸å˜æ€§æ˜¯å…¶è®¾è®¡çš„æ ¸å¿ƒï¼Œå®ƒé€šè¿‡åŠŸèƒ½ç»„åˆé¼“åŠ±å¯é‡ç”¨æ€§ã€‚ç„¶è€Œï¼Œæ— è®ºä½ æ˜¯ä¸€ä¸ªå¤šä¹ˆä¼˜ç§€çš„ç¨‹åºå‘˜ï¼Œä½ éƒ½ä¸å¯é¿å…åœ°ä¼šé‡åˆ°é”™è¯¯ï¼Œå½“ä½ é‡åˆ°é”™è¯¯æ—¶ï¼Œä½ é€šå¸¸å¸Œæœ›è¿™ç§ä½“éªŒå°½å¯èƒ½çš„é¡ºç•…ã€‚

å¦‚æœä½ åƒæˆ‘ä¸€æ ·ï¼Œå–œæ¬¢åˆ°å¤„ç²˜è´´`console.log`è¯­å¥æ¥å¼„æ¸…æ¥šå‘ç”Ÿäº†ä»€ä¹ˆ(æˆ‘çŸ¥é“ï¼Œæˆ‘çŸ¥é“â€”â€”æˆ‘åº”è¯¥ä½¿ç”¨æˆ‘çš„è°ƒè¯•å™¨)ï¼Œé‚£ä¹ˆä»å‘½ä»¤å¼ç¼–ç¨‹æ–¹å¼åˆ°å£°æ˜å¼ç¼–ç¨‹æ–¹å¼çš„èŒƒå¼è½¬å˜å¯èƒ½ä¼šåœ¨ä¸€å¼€å§‹è®©ä½ æ„Ÿåˆ°å›°æƒ‘ï¼Œç‰¹åˆ«æ˜¯å¦‚æœä½ è¯•å›¾åšä¸€äº›[æ²¡æœ‰è¦ç‚¹çš„äº‹æƒ…](http://randycoulman.com/blog/2016/06/21/thinking-in-ramda-pointfree-style/)ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†å­¦ä¹ ä¸€ä¸ªç®€å•çš„æŠ€å·§ï¼Œå®ƒå…è®¸ä½ çª¥è§†ä½ çš„ç¨‹åºï¼Œå¹¶è§‚å¯Ÿç¨‹åºä¸­ä»»ä½•ç»™å®šæ­¥éª¤çš„å€¼ã€‚

## æŠŠå®ƒæ’åœ¨ä½ çš„çƒŸæ–—é‡ŒæŠ½å§

åœ¨ Ramda ä¸­ï¼Œæ‚¨ä¼šç»å¸¸å‘ç°è‡ªå·±é€šè¿‡ç®¡é“å°†ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°ï¼Œä»¥ä¾¿å¯¹ç»™å®šçš„è¾“å…¥åº”ç”¨ä¸€ç³»åˆ—è½¬æ¢ã€‚Ramda æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„`[pipe](https://ramdajs.com/docs/#pipe)`å‡½æ•°æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚

```
const add1AndMultiplyBy2 = R.pipe(
  x => x + 1,
  x => x * 2,
);add1AndMultiplyBy2(1); // returns 4
```

è®©æˆ‘ä»¬å‡è®¾è¿™ä¸¤ä¸ª lambdas å®é™…ä¸Šæ˜¯å¯é‡ç”¨çš„ï¼Œå¹¶åœ¨æˆ‘ä»¬çš„ç®¡é“å¤–éƒ¨å°†å®ƒä»¬å®šä¹‰ä¸ºç‹¬ç«‹çš„å®ç”¨ç¨‹åºã€‚

```
const add1 = x => x + 1;
const multiplyBy2 = x => x * 2;
```

ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿æˆ‘ä»¬çš„`add1AndMultiplyBy2`å‡½æ•°å®Œå…¨æ— ç‚¹ã€‚

```
const add1AndMultiplyBy2 = R.pipe(
  add1,
  multiplyBy2,
);
```

å¤ªå¥½äº†â€”â€”ç°åœ¨æˆ‘ä»¬æœ‰äº†å¹²å‡€ã€ä¼˜é›…çš„ä»£ç ï¼Œå®ƒå¯¹æ¯ä¸€æ­¥å‘ç”Ÿçš„äº‹æƒ…éƒ½æ˜¯é€æ˜çš„ã€‚ä¼šå‡ºä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ

é‚£ä¹ˆï¼Œå¦‚æœåœ¨æˆ‘ä»¬ä¸çŸ¥é“çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„`add1AndMultiplyBy2`å‡½æ•°è¢«ç”¨å­—ç¬¦ä¸²`'1'`è€Œä¸æ˜¯æ•°å­—`1`è°ƒç”¨ï¼Œä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ

```
add1AndMultiplyBy2('1'); // returns 22
```

æ²¡é”™â€”è¿™å°†è¿”å›æ•°å­—`22`ã€‚å‘ä»»ä½•æœ¬èƒ½åœ°çŸ¥é“è¿™ä¸€ç‚¹çš„äººè„±å¸½è‡´æ•¬ã€‚å¯¹äºå…¶ä»–æƒ³çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆçš„äººï¼Œè®©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹åœ¨æ²¡æœ‰ç®¡é“çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•ç”¨æ™®é€šçš„ JavaScript ç¼–å†™æˆ‘ä»¬çš„å‡½æ•°ã€‚

```
function add1AndMultiplyBy2 (num) {
  const plus1 = add1(num);
  const plus1Times2 = multiplyBy2(plus1); return plus1Times2;
}
```

ä¸ºäº†å¼„æ¸…è¿™ä¸ªç¥ç§˜çš„`22`çš„çœŸç›¸ï¼Œæ‚¨å¯èƒ½è¦åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯åœ¨å¯¹`add1`çš„è°ƒç”¨åè´´ä¸€ä¸ª`console.log`æ¥è§‚å¯Ÿå®ƒçš„è¿”å›å€¼ã€‚

```
function add1AndMultiplyBy2 (num) {
  const plus1 = add1(num);
  console.log(plus1); // logs '11'
  const plus1Times2 = multiplyBy2(plus1); return plus1Times2;
}
```

å•Šå“ˆï¼ç‹¡çŒ¾ï¼Œç‹¡çŒ¾çš„ JavaScriptï¼å®ƒå°†æ•°å­—`1`ä¸å­—ç¬¦ä¸²`'1'`è¿æ¥åœ¨ä¸€èµ·ï¼Œäº§ç”Ÿ`'11'`ï¼Œç„¶åä¼ é€’ç»™æˆ‘ä»¬çš„`multiplyBy2`å‡½æ•°ï¼Œé€šè¿‡ç±»å‹å¼ºåˆ¶çš„é­”åŠ›ï¼Œäº§ç”Ÿæˆ‘ä»¬çš„æœ€ç»ˆè¿”å›å€¼`22`ã€‚è°œå›¢è§£å¼€äº†ã€‚

å¾ˆå¥½â€”â€”ä½†æ˜¯å½“ä½¿ç”¨ Ramda æ—¶ï¼Œå¦‚ä½•å¾—å‡ºè¿™ä¸ªä¸å¤ªæ˜æ˜¾çš„ç»“è®ºå‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬ä½¿ç”¨æ¼‚äº®çš„`pipe`å›åˆ°æ›´ç®€æ´çš„`add1AndMultiplyBy2`ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä¼šæ³¨æ„åˆ°æ²¡æœ‰åœ°æ–¹å¯ä»¥ç²˜è´´`console.log`ã€‚

## R.tap()æ¥æ•‘æ´ï¼

å¹¸è¿çš„æ˜¯ï¼ŒRamda æä¾›äº†ä¸€ä¸ªåä¸º`[tap](https://ramdajs.com/docs/#tap)`çš„å‡½æ•°ï¼Œå®ƒç”¨ä¸€ä¸ªæä¾›çš„å€¼è¿è¡Œä¸€ä¸ªç»™å®šçš„å‡½æ•°ï¼Œç„¶åè¿”å›å€¼ï¼Œä¸å˜ã€‚

å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ª`[identity](https://ramdajs.com/docs/#identity)`å‡½æ•°(å®ƒé™¤äº†è¿”å›æä¾›ç»™å®ƒçš„å€¼ä¹‹å¤–ä»€ä¹ˆä¹Ÿä¸åš)ï¼Œä½†æ˜¯å…·æœ‰æ‰§è¡Œä¸€äº›å‰¯ä½œç”¨çš„èƒ½åŠ›ã€‚

é‚£ä¹ˆè¿™æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥`console.log`ç®¡é“ä¸­ä»»ä½•ç»™å®šæ­¥éª¤çš„å€¼ï¼Œä»¥è§‚å¯Ÿå‡ºé—®é¢˜æ—¶å‘ç”Ÿäº†ä»€ä¹ˆã€‚

```
const add1AndMultiplyBy2 = R.pipe(
  add1,
  R.tap(x => console.log('WTF', x)), // logs 'WTF' and '11'
  multiplyBy2,
);add1AndMultiplyBy2('1'); // returns 22
```

è¿™ä¸€åˆ‡ï¼Œ*æ²¡æœ‰æ‰“ç ´æˆ‘ä»¬çš„ç®¡é“*ã€‚

è¿™æœ€åä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬åœ¨è°ƒç”¨`add1`åç®€å•åœ°ä¼ é€’`console.log`ä½œä¸º`pipe`ä¸­çš„ä¸‹ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å®é™…ä¸Šä¼šæ”¹å˜æœ€ç»ˆç»“æœï¼Œå› ä¸º`console.log`è¿”å›`undefined`ã€‚

```
const add1AndMultiplyBy2 = R.pipe(
  add1,
  console.log, // returns undefined
  multiplyBy2, // undefined * 2??
);add1AndMultiplyBy2('1'); // returns NaN, duh
```

è¿™å¯èƒ½ä¼šå¯¼è‡´æ›´å¤šçš„æ··ä¹±ï¼Œç‰¹åˆ«æ˜¯å› ä¸ºåœ¨ç®¡é“ä¸­é—´è¿”å›`undefined`ç»å¸¸ä¼šæŠ›å‡ºä¸€ä¸ªå¤§é”™è¯¯ï¼Œè¿™æ—¶ä½ å¯èƒ½ä¼šå¿ä¸ä½å¼€å§‹æ‹”å¤´å‘ã€‚

## åŒ…è£…ä¸œè¥¿

ç”±äºä½¿ç”¨`tap`å°†ä¸€äº›ä¸œè¥¿è®°å½•åˆ°æ§åˆ¶å°å¯¹äºè°ƒè¯•æ¥è¯´éå¸¸å®ç”¨ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ç»§ç»­ä¸ºè¿™ä¸ªç‰¹æ®Šçš„ç”¨ä¾‹åˆ›å»ºä¸€ä¸ªåŒ…è£…å™¨ã€‚

```
const log = msg => R.tap(x => console.log(msg, x));
```

ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨ç®¡é“å‡½æ•°ä¸­çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨æˆ‘ä»¬æ–¹ä¾¿çš„`log`å‡½æ•°ï¼Œå°±åƒæˆ‘ä»¬ä½¿ç”¨å¸¸è§„çš„`console.log`ä¸€æ ·ï¼Œç”šè‡³ä¸éœ€è¦è®°ä½`tap`æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

```
const add1AndMultiplyBy2 = R.pipe(
  add1,
  log('value after add1: '), // logs "value after add1: 11"
  multiplyBy2,
);add1AndMultiplyBy2('1');
```

å°±è¿™æ ·ç»“æŸäº†ï¼ğŸ˜

1.  å…³äº JavaScript ä¸­ç±»å‹å¼ºåˆ¶çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥é˜…å‡¯å°”Â·è¾›æ™®æ£®çš„[ç±»å‹å’Œè¯­æ³•](https://github.com/getify/You-Dont-Know-JS/blob/master/types%20&%20grammar/README.md#you-dont-know-js-types--grammar)ä¸€ä¹¦ã€‚