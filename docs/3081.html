<html>
<head>
<title>How to use custom Storage Classes in Kubernetes?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•åœ¨Kubernetesä¸­ä½¿ç”¨è‡ªå®šä¹‰å­˜å‚¨ç±»ï¼Ÿ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/how-to-use-custom-storage-classes-in-kubernetes-edc568acfdfe?source=collection_archive---------2-----------------------#2019-09-30">https://itnext.io/how-to-use-custom-storage-classes-in-kubernetes-edc568acfdfe?source=collection_archive---------2-----------------------#2019-09-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/7d05922fd8120222262f47d2c6774c20.png" data-original-src="https://miro.medium.com/v2/resize:fit:256/format:webp/1*eSCMesxcnB0AlOxxGDJaDQ.png"/></div></figure><p id="99ce" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">å¤§å¤šæ•°Kubernetesäº§å“éƒ½æä¾›äº†ç°æˆçš„é»˜è®¤å­˜å‚¨ç±»ï¼Œä»¥ç®€åŒ–åŠ¨æ€å­˜å‚¨ä¾›åº”è¿‡ç¨‹ã€‚</p><p id="6751" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">ä½†æ˜¯ï¼Œå¦‚æœæ‚¨æœ‰å®šåˆ¶éœ€æ±‚å‘¢ï¼Ÿåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•åˆ›å»ºè‡ªå·±çš„å­˜å‚¨ç±»æ¥æ»¡è¶³æ‚¨çš„éœ€æ±‚ã€‚ç¤ºä¾‹åœºæ™¯åŸºäºä¸€ä¸ª<a class="ae ks" href="https://docs.microsoft.com/azure/aks/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> Azure KubernetesæœåŠ¡</a>ï¼Œä½†æ˜¯åº”è¯¥é€‚ç”¨äºä»»ä½•Kubernetesæä¾›å•†ã€‚</p><blockquote class="kt ku kv"><p id="84dd" class="ju jv kw jw b jx jy jz ka kb kc kd ke kx kg kh ki ky kk kl km kz ko kp kq kr ij bi translated"><em class="iq">ä»£ç åœ¨</em> <a class="ae ks" href="https://github.com/abhirockzz/kubernetes-custom-storageclass" rel="noopener ugc nofollow" target="_blank"> <em class="iq"> GitHub </em> </a>ä¸Šæœ‰</p></blockquote><p id="4a74" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae ks" rel="noopener ugc nofollow" target="_blank" href="/tutorial-basics-of-kubernetes-volumes-part-2-b2ea6f397402">â€œæ•™ç¨‹:Kuberneteså·çš„åŸºç¡€çŸ¥è¯†(ç¬¬2éƒ¨åˆ†)â€</a>åšå®¢æ–‡ç« æ¢è®¨äº†Kuberneteså­˜å‚¨ç±»ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªåˆ©ç”¨é»˜è®¤å€¼<code class="fe la lb lc ld b">StorageClass</code>çš„ç¤ºä¾‹ã€‚è¦ä½¿ç”¨Kubernetesé›†ç¾¤ä¸­çš„é»˜è®¤å­˜å‚¨ç±»è§¦å‘åŠ¨æ€é…ç½®ï¼Œåªéœ€<strong class="jw ir">ä»æ‚¨çš„<code class="fe la lb lc ld b">PersistentVolumeClaim</code>ä¸­æ’é™¤</strong>å±æ€§<code class="fe la lb lc ld b">storageClass</code>ã€‚ä¾‹å¦‚ï¼Œ<a class="ae ks" href="https://azure.microsoft.com/services/storage/disks/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> Azure KubernetesæœåŠ¡</a>åŒ…å«ä¸¤ä¸ªé¢„æ’­ç§çš„å­˜å‚¨ç±»ï¼Œ</p><p id="706f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œ<code class="fe la lb lc ld b">kubectl get storageclass</code>å‘½ä»¤è¿›è¡Œæ£€æŸ¥</p><pre class="le lf lg lh gt li ld lj lk aw ll bi"><span id="3567" class="lm ln iq ld b gy lo lp l lq lr">NAME                PROVISIONER                AGE<br/>default (default)   kubernetes.io/azure-disk   6d10h<br/>managed-premium     kubernetes.io/azure-disk   6d10h</span></pre><ul class=""><li id="7919" class="ls lt iq jw b jx jy kb kc kf lu kj lv kn lw kr lx ly lz ma bi translated"><code class="fe la lb lc ld b">default</code>å­˜å‚¨ç±»:æä¾›ç”±æ ‡å‡†ç¡¬ç›˜æ”¯æŒçš„æ ‡å‡†<a class="ae ks" href="https://docs.microsoft.com/azure/virtual-machines/windows/disks-types?WT.mc_id=medium-blog-abhishgu#standard-hdd" rel="noopener ugc nofollow" target="_blank"> Azureç£ç›˜</a></li><li id="8f7a" class="ls lt iq jw b jx mb kb mc kf md kj me kn mf kr lx ly lz ma bi translated"><code class="fe la lb lc ld b">managed-premium</code>å­˜å‚¨ç±»:æä¾›ç”±é«˜çº§å›ºæ€ç¡¬ç›˜æ”¯æŒçš„é«˜çº§<a class="ae ks" href="https://docs.microsoft.com/azure/virtual-machines/windows/disks-types?WT.mc_id=medium-blog-abhishgu#premium-ssd" rel="noopener ugc nofollow" target="_blank"> Azureç£ç›˜</a></li></ul><p id="907c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">ä¸‹é¢æ˜¯<code class="fe la lb lc ld b">default</code>å­˜å‚¨ç±»è§„èŒƒçš„æ ·å­(è¿™æ˜¯é€šè¿‡åœ¨æˆ‘çš„AKSé›†ç¾¤ä¸Šæ‰§è¡Œ<code class="fe la lb lc ld b">kubectl get sc/default</code>è·å¾—çš„ä¸€ä¸ªå¾®è°ƒç‰ˆæœ¬)</p><pre class="le lf lg lh gt li ld lj lk aw ll bi"><span id="30b4" class="lm ln iq ld b gy lo lp l lq lr">apiVersion: storage.k8s.io/v1<br/>kind: StorageClass<br/>metadata:<br/>  labels:<br/>    kubernetes.io/cluster-service: "true"<br/>  name: default<br/>parameters:<br/>  cachingmode: ReadOnly<br/>  kind: Managed<br/>  storageaccounttype: Standard_LRS<br/>provisioner: kubernetes.io/azure-disk<br/>reclaimPolicy: Delete<br/>volumeBindingMode: Immediate</span></pre><h1 id="b73b" class="mg ln iq bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated">å¥½å§ï¼Œé‚£åˆæ€æ ·ï¼Ÿ</h1><figure class="le lf lg lh gt jr gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/68ddb2d6075d8793d5986df91633af76.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*UPA5ZdBKXoDJkwqM.gif"/></div></figure><p id="e3b4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">æˆ‘ä¹‹æ‰€ä»¥å¼ºè°ƒè¿™ä¸€ç‚¹ï¼Œæ˜¯å› ä¸ºæˆ‘å¸Œæœ›æ‚¨æ³¨æ„ä»¥ä¸‹å±æ€§ã€å®ƒä»¬çš„å€¼ä»¥åŠå®ƒä»¬çš„å«ä¹‰</p><ul class=""><li id="69e8" class="ls lt iq jw b jx jy kb kc kf lu kj lv kn lw kr lx ly lz ma bi translated"><code class="fe la lb lc ld b">volumeBindingMode: Immediate</code> -è¯¥è®¾ç½®æ„å‘³ç€ä¸€æ—¦<code class="fe la lb lc ld b">PersistentVolumeClaim</code>è¢«åˆ›å»ºï¼Œå°±è§¦å‘<code class="fe la lb lc ld b">PersistentVolume</code>åˆ›å»ºï¼Œç„¶åæ˜¯å­˜å‚¨ä»‹è´¨(åœ¨æœ¬ä¾‹ä¸­ä¸ºAzureç£ç›˜)ä¾›åº”ã€‚</li><li id="69d3" class="ls lt iq jw b jx mb kb mc kf md kj me kn mf kr lx ly lz ma bi translated"><code class="fe la lb lc ld b">reclaimPolicy: Delete</code> -é€šè¿‡è¿™ä¸ªè®¾ç½®ï¼Œä¸€æ—¦åˆ é™¤äº†ä¸€ä¸ª<code class="fe la lb lc ld b">PersistentVolumeClaim</code>ï¼Œå®ƒä¹Ÿä¼šè§¦å‘ç›¸åº”çš„<code class="fe la lb lc ld b">PersistentVolume</code>å’ŒAzureç£ç›˜çš„ç§»é™¤ã€‚å¦‚æœæ‚¨æ‰“ç®—ä¿ç•™è¿™äº›æ•°æ®ç”¨äºå¤‡ä»½ã€å…¶ä»–åº”ç”¨ç­‰ï¼Œæ‚¨å°†ä¼šå¤§åƒä¸€æƒŠã€‚</li></ul><blockquote class="kt ku kv"><p id="5039" class="ju jv kw jw b jx jy jz ka kb kc kd ke kx kg kh ki ky kk kl km kz ko kp kq kr ij bi translated"><em class="iq"/><code class="fe la lb lc ld b"><em class="iq">reclaimPolicy: Delete</em></code><em class="iq"/><code class="fe la lb lc ld b"><em class="iq">volumeBindingMode: Immediate</em></code><em class="iq">éƒ½æ˜¯é»˜è®¤è®¾ç½®</em></p></blockquote><h1 id="0f55" class="mg ln iq bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated">è¦†ç›–volumeBindingMode</h1><p id="4a93" class="pw-post-body-paragraph ju jv iq jw b jx ne jz ka kb nf kd ke kf ng kh ki kj nh kl km kn ni kp kq kr ij bi translated">æœ‰æ•ˆå€¼åŒ…æ‹¬<code class="fe la lb lc ld b">Immediate</code>å’Œ<code class="fe la lb lc ld b">WaitForFirstConsumer</code>ã€‚ç”¨<code class="fe la lb lc ld b">WaitForFirstConsumer</code>è¦†ç›–é»˜è®¤å€¼å°†ä¼šå»¶è¿Ÿ<code class="fe la lb lc ld b">PersistentVolume</code>çš„ç»‘å®šå’Œä¾›åº”ï¼Œç›´åˆ°ä½¿ç”¨<code class="fe la lb lc ld b">PersistentVolumeClaim</code>çš„<code class="fe la lb lc ld b">Pod</code>(ä¹Ÿå°±æ˜¯æ‚¨çš„åº”ç”¨ç¨‹åº)è¢«åˆ›å»ºã€‚</p><h1 id="9fa4" class="mg ln iq bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated">è¦†ç›–å›æ”¶ç­–ç•¥</h1><p id="e454" class="pw-post-body-paragraph ju jv iq jw b jx ne jz ka kb nf kd ke kf ng kh ki kj nh kl km kn ni kp kq kr ij bi translated">ä»ç„¶è¦†ç›–é»˜è®¤å€¼<code class="fe la lb lc ld b">Retain</code>ï¼Œåœ¨<code class="fe la lb lc ld b">PersistentVolumeClaim</code>ç§»é™¤ååˆ é™¤<code class="fe la lb lc ld b">PersistentVolume</code>ï¼Œä½†ç¡®ä¿å®é™…å­˜å‚¨ä»‹è´¨æœªè¢«æ¸…é™¤ã€‚</p><blockquote class="kt ku kv"><p id="ff04" class="ju jv kw jw b jx jy jz ka kb kc kd ke kx kg kh ki ky kk kl km kz ko kp kq kr ij bi translated"><em class="iq">æ³¨æ„</em> <code class="fe la lb lc ld b"><em class="iq">Recycle</em></code> <em class="iq">æ˜¯</em> <code class="fe la lb lc ld b"><em class="iq">reclaimPolicy</em></code>çš„å¼ƒç”¨é€‰é¡¹</p></blockquote><h1 id="6501" class="mg ln iq bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated">åŠ¨æ‰‹æ“ä½œ:åˆ›å»ºå’Œä½¿ç”¨è‡ªå®šä¹‰å­˜å‚¨ç±»</h1><p id="6d88" class="pw-post-body-paragraph ju jv iq jw b jx ne jz ka kb nf kd ke kf ng kh ki kj nh kl km kn ni kp kq kr ij bi translated">è¦è·Ÿè¿›ï¼Œæ‚¨éœ€è¦:</p><ul class=""><li id="08c5" class="ls lt iq jw b jx jy kb kc kf lu kj lv kn lw kr lx ly lz ma bi translated">ä¸€ä¸ª<a class="ae ks" href="https://docs.microsoft.com/azure/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">å¾®è½¯Azureè´¦æˆ·</a>â€”â€”å»æ³¨å†Œä¸€ä¸ªå…è´¹è´¦æˆ·å§ï¼</li><li id="80ba" class="ls lt iq jw b jx mb kb mc kf md kj me kn mf kr lx ly lz ma bi translated"><a class="ae ks" href="https://azure.microsoft.com/services/kubernetes-service/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> Azure KubernetesæœåŠ¡(AKS)é›†ç¾¤</a> â€”æœ¬åšå®¢å°†æŒ‡å¯¼æ‚¨åˆ›å»ºä¸€ä¸ªé›†ç¾¤</li><li id="c8cd" class="ls lt iq jw b jx mb kb mc kf md kj me kn mf kr lx ly lz ma bi translated">Azure CLIæˆ–Azure Cloud Shellâ€”â€”å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£…Azure CLI ï¼Œä½ å¯ä»¥é€‰æ‹©å®‰è£…å®ƒ(åº”è¯¥å¾ˆå¿«ï¼)æˆ–è€…ç›´æ¥ä»ä½ çš„æµè§ˆå™¨ä½¿ç”¨<a class="ae ks" href="https://azure.microsoft.com/features/cloud-shell/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> Azureäº‘å£³</a>ã€‚</li><li id="a56f" class="ls lt iq jw b jx mb kb mc kf md kj me kn mf kr lx ly lz ma bi translated"><code class="fe la lb lc ld b"><a class="ae ks" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" rel="noopener ugc nofollow" target="_blank">kubectl</a></code>ä¸æ‚¨çš„AKSé›†ç¾¤äº¤äº’(å¦‚æœæ‚¨ä½¿ç”¨Azure Cloud Shellï¼Œåˆ™ä¸éœ€è¦)</li></ul><h2 id="e857" class="lm ln iq bd mh nj nk dn ml nl nm dp mp kf nn no mt kj np nq mx kn nr ns nb nt bi translated">Kubernetesé›†ç¾¤è®¾ç½®</h2><p id="7c38" class="pw-post-body-paragraph ju jv iq jw b jx ne jz ka kb nf kd ke kf ng kh ki kj nh kl km kn ni kp kq kr ij bi translated">ä½ åªéœ€è¦ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥åœ¨Azureä¸Šå»ºç«‹ä¸€ä¸ªKubernetesé›†ç¾¤ã€‚ä½†æ˜¯ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªèµ„æºç»„</p><pre class="le lf lg lh gt li ld lj lk aw ll bi"><span id="947f" class="lm ln iq ld b gy lo lp l lq lr">export AZURE_SUBSCRIPTION_ID=[to be filled]<br/>export AZURE_RESOURCE_GROUP=[to be filled]<br/>export AZURE_REGION=[to be filled] (e.g. southeastasia)</span></pre><p id="8c7a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">åˆ‡æ¢åˆ°æ‚¨çš„è®¢é˜…å¹¶è°ƒç”¨<code class="fe la lb lc ld b">az group create</code></p><pre class="le lf lg lh gt li ld lj lk aw ll bi"><span id="655e" class="lm ln iq ld b gy lo lp l lq lr">az account set -s $AZURE_SUBSCRIPTION_ID<br/>az group create -l $AZURE_REGION -n $AZURE_RESOURCE_GROUP</span></pre><p id="72dd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">æ‚¨ç°åœ¨å¯ä»¥è°ƒç”¨<code class="fe la lb lc ld b">az aks create</code>æ¥åˆ›å»ºæ–°çš„é›†ç¾¤</p><blockquote class="kt ku kv"><p id="49a3" class="ju jv kw jw b jx jy jz ka kb kc kd ke kx kg kh ki ky kk kl km kz ko kp kq kr ij bi translated">ä¸ºäº†ç®€å•èµ·è§ï¼Œä¸‹é¢çš„å‘½ä»¤åˆ›å»ºäº†ä¸€ä¸ªå•èŠ‚ç‚¹é›†ç¾¤ã€‚æ ¹æ®æ‚¨çš„è¦æ±‚éšæ„æ›´æ”¹è§„æ ¼</p></blockquote><pre class="le lf lg lh gt li ld lj lk aw ll bi"><span id="4aad" class="lm ln iq ld b gy lo lp l lq lr">export AKS_CLUSTER_NAME=[to be filled]</span><span id="b2ab" class="lm ln iq ld b gy nu lp l lq lr">az aks create --resource-group $AZURE_RESOURCE_GROUP --name $AKS_CLUSTER_NAME --node-count 1 --node-vm-size Standard_B2s --node-osdisk-size 30 --generate-ssh-keys</span></pre><p id="e868" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">ä½¿ç”¨<code class="fe la lb lc ld b">az aks get-credentials</code>è·å–AKSé›†ç¾¤å‡­è¯â€”â€”å› æ­¤ï¼Œ<code class="fe la lb lc ld b">kubectl</code>ç°åœ¨å°†æŒ‡å‘æ‚¨çš„æ–°é›†ç¾¤ã€‚ä½ å¯ä»¥è¯å®è¿™ä¸€ç‚¹</p><pre class="le lf lg lh gt li ld lj lk aw ll bi"><span id="3e59" class="lm ln iq ld b gy lo lp l lq lr">az aks get-credentials --resource-group $AZURE_RESOURCE_GROUP --name $AKS_CLUSTER_NAME<br/>kubectl get nodes</span></pre><blockquote class="kt ku kv"><p id="bddc" class="ju jv kw jw b jx jy jz ka kb kc kd ke kx kg kh ki ky kk kl km kz ko kp kq kr ij bi translated"><em class="iq">å¦‚æœæ‚¨å¯¹ä½¿ç”¨</em><a class="ae ks" href="https://azure.microsoft.com/services/kubernetes-service/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"><em class="iq">Azure</em></a><em class="iq">å­¦ä¹ Kuberneteså’ŒContainersæ„Ÿå…´è¶£ï¼Œä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹æ˜¯ä½¿ç”¨æ–‡æ¡£ä¸­çš„</em> <a class="ae ks" href="https://docs.microsoft.com/azure/aks/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> <em class="iq">å¿«é€Ÿå…¥é—¨ã€æ•™ç¨‹å’Œä»£ç ç¤ºä¾‹</em> </a> <em class="iq">æ¥ç†Ÿæ‚‰è¯¥æœåŠ¡ã€‚æˆ‘ä¹Ÿå¼ºçƒˆæ¨èæŸ¥çœ‹ä¸€ä¸‹</em> <a class="ae ks" href="https://azure.microsoft.com/resources/kubernetes-learning-path/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> <em class="iq"> 50å¤©Kuberneteså­¦ä¹ è·¯å¾„</em> </a> <em class="iq">ã€‚é«˜çº§ç”¨æˆ·å¯èƒ½å¸Œæœ›å‚è€ƒ</em> <a class="ae ks" href="https://docs.microsoft.com/azure/aks/best-practices?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> <em class="iq"> Kubernetesæœ€ä½³å®è·µ</em> </a> <em class="iq">æˆ–è§‚çœ‹ä¸€äº›</em> <a class="ae ks" href="https://azure.microsoft.com/resources/videos/index/?services=kubernetes-service&amp;WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> <em class="iq">è§†é¢‘</em> </a> <em class="iq">ä»¥äº†è§£æ¼”ç¤ºã€ä¸»è¦ç‰¹æ€§å’ŒæŠ€æœ¯ä¼šè®®ã€‚</em></p></blockquote><h1 id="3ed5" class="mg ln iq bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated">æµ‹è¯•ä¸€ä¸‹â€¦</h1><p id="5a40" class="pw-post-body-paragraph ju jv iq jw b jx ne jz ka kb nf kd ke kf ng kh ki kj nh kl km kn ni kp kq kr ij bi translated">åˆ›å»ºå­˜å‚¨ç±»å¹¶ç¡®è®¤å…¶å·²åˆ›å»º</p><pre class="le lf lg lh gt li ld lj lk aw ll bi"><span id="a1c4" class="lm ln iq ld b gy lo lp l lq lr">kubectl apply -f https://raw.githubusercontent.com/abhirockzz/kubernetes-custom-storageclass/master/custom-storage-class.yaml<br/>    kubectl get sc</span></pre><blockquote class="kt ku kv"><p id="3ec9" class="ju jv kw jw b jx jy jz ka kb kc kd ke kx kg kh ki ky kk kl km kz ko kp kq kr ij bi translated"><em class="iq">ä¸ºäº†ç®€å•èµ·è§ï¼ŒYAMLæ–‡ä»¶ç›´æ¥ä»</em><a class="ae ks" href="https://github.com/abhirockzz/kubernetes-custom-storageclass" rel="noopener ugc nofollow" target="_blank"><em class="iq">GitHub repo</em></a><em class="iq">ä¸­å¼•ç”¨ï¼Œä½†æ˜¯ä½ ä¹Ÿå¯ä»¥å°†æ–‡ä»¶ä¸‹è½½åˆ°ä½ çš„æœ¬åœ°æœºå™¨ä¸Šï¼Œä»¥åŒæ ·çš„æ–¹å¼ä½¿ç”¨å®ƒã€‚</em></p></blockquote><p id="3970" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">æ‚¨åº”è¯¥ä¼šçœ‹åˆ°æ–°çš„å­˜å‚¨ç±»</p><pre class="le lf lg lh gt li ld lj lk aw ll bi"><span id="eeb0" class="lm ln iq ld b gy lo lp l lq lr">NAME                            PROVISIONER                AGE<br/>azuredisk-custom-storageclass   kubernetes.io/azure-disk   4s<br/>default (default)               kubernetes.io/azure-disk   2d10h<br/>managed-premium                 kubernetes.io/azure-disk   2d10h</span></pre><p id="46d3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">åˆ›å»º<code class="fe la lb lc ld b">PersistentVolumeClaim</code></p><pre class="le lf lg lh gt li ld lj lk aw ll bi"><span id="8a01" class="lm ln iq ld b gy lo lp l lq lr">kubectl apply -f https://raw.githubusercontent.com/abhirockzz/kubernetes-custom-storageclass/master/pvc.yaml<br/>    kubectl get pvc/app-pvc</span></pre><p id="5baa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">æ‚¨ä¼šæ³¨æ„åˆ°<code class="fe la lb lc ld b">STATUS</code>æ˜¯<code class="fe la lb lc ld b">Pending</code>ï¼Œè¿™æ„å‘³ç€å®ƒè¿˜æ²¡æœ‰ä¸<code class="fe la lb lc ld b">PersistentVolume</code>ç›¸å…³è”ã€‚</p><pre class="le lf lg lh gt li ld lj lk aw ll bi"><span id="0a90" class="lm ln iq ld b gy lo lp l lq lr">NAME      STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS                    AGE<br/>app-pvc   Pending                                      azuredisk-custom-storageclass   10s</span></pre><p id="afc4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">åˆ›é€ ä¸€ä¸ª<code class="fe la lb lc ld b">Deployment</code>(å°†åˆ›é€ ä¸€ä¸ª<code class="fe la lb lc ld b">Pod</code>)</p><pre class="le lf lg lh gt li ld lj lk aw ll bi"><span id="80f7" class="lm ln iq ld b gy lo lp l lq lr">kubectl apply -f <a class="ae ks" href="https://raw.githubusercontent.com/abhirockzz/kubernetes-custom-storageclass/master/deployment.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/abhirockzz/kubernetes-custom-storageclass/master/deployment.yaml</a></span></pre><blockquote class="kt ku kv"><p id="56a8" class="ju jv kw jw b jx jy jz ka kb kc kd ke kx kg kh ki ky kk kl km kz ko kp kq kr ij bi translated"><code class="fe la lb lc ld b"><em class="iq">Pod</em></code> <em class="iq">ä¼šåœ¨ä¸€æ®µæ—¶é—´å†…è¿‡æ¸¡åˆ°</em> <code class="fe la lb lc ld b"><em class="iq">Running</em></code> <em class="iq">çŠ¶æ€</em></p></blockquote><p id="0d88" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">ä¸€æ—¦åˆ°äº†<code class="fe la lb lc ld b">Running</code>ï¼Œå†æ¬¡æ£€æŸ¥<code class="fe la lb lc ld b">PersistentVolumeClaim</code></p><pre class="le lf lg lh gt li ld lj lk aw ll bi"><span id="c479" class="lm ln iq ld b gy lo lp l lq lr">kubectl get pvc/app-pvc</span></pre><p id="dd66" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><code class="fe la lb lc ld b">STATUS</code>ä¼šå˜æˆ<code class="fe la lb lc ld b">Bound</code>ã€‚ä½œä¸º<code class="fe la lb lc ld b">Pod</code>åˆ›å»ºçš„ç»“æœï¼Œä½¿ç”¨<code class="fe la lb lc ld b">PersistentVolumeClaim</code> ( <code class="fe la lb lc ld b">azuredisk-custom-storageclass</code>)ä¸­æåˆ°çš„<code class="fe la lb lc ld b">StorageClass</code>åˆ†æå­˜å‚¨è¯·æ±‚å¹¶è§¦å‘åŠ¨æ€é…ç½®ã€‚å› æ­¤ï¼ŒAzureç£ç›˜æ˜¯éšç€<code class="fe la lb lc ld b">PersistentVolume</code>çš„åˆ›å»ºåŠå…¶ä¸<code class="fe la lb lc ld b">PersistentVolumeClaim</code>çš„å…³è”ä¸€èµ·æä¾›çš„ã€‚</p><pre class="le lf lg lh gt li ld lj lk aw ll bi"><span id="b641" class="lm ln iq ld b gy lo lp l lq lr">NAME      STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS                    AGE<br/>app-pvc   Bound    pvc-83020049-e107-11e9-93ab-025752f370d3   1Gi        RWO            azuredisk-custom-storageclass   4m53s</span></pre><blockquote class="kt ku kv"><p id="05ff" class="ju jv kw jw b jx jy jz ka kb kc kd ke kx kg kh ki ky kk kl km kz ko kp kq kr ij bi translated"><em class="iq">è¿™ä¸€åˆ‡å‘ç”Ÿåœ¨</em> <strong class="jw ir"> <em class="iq">ä¹‹å</em> </strong> <em class="iq">æˆ‘ä»¬çš„appè¢«éƒ¨ç½²ï¼Œå¤šäºäº†</em> <code class="fe la lb lc ld b"><em class="iq">WaitForFirstConsumer</em></code> <em class="iq">è®¾ç½®ä¸º</em> <code class="fe la lb lc ld b"><em class="iq">volumeBindingMode</em></code> <em class="iq">å±æ€§ã€‚</em></p></blockquote><p id="cb8e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">ä½¿ç”¨<code class="fe la lb lc ld b">kubectl get pv</code>è¿›è¡Œç¡®è®¤</p><pre class="le lf lg lh gt li ld lj lk aw ll bi"><span id="c467" class="lm ln iq ld b gy lo lp l lq lr">NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                    STORAGECLASS                    REASON   AGE<br/>pvc-83020049-e107-11e9-93ab-025752f370d3   1Gi        RWO            Retain           Bound    default/app-pvc          azuredisk-custom-storageclass            4m46s</span></pre><p id="0fd1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">å½“ç„¶ï¼Œè¿˜ä¼šåˆ›å»ºä¸€ä¸ªAzureç£ç›˜ã€‚ä¸ºäº†æ£€æŸ¥ï¼Œ</p><pre class="le lf lg lh gt li ld lj lk aw ll bi"><span id="8319" class="lm ln iq ld b gy lo lp l lq lr">AKS_NODE_RESOURCE_GROUP=$(az aks show --resource-group $AZURE_RESOURCE_GROUP --name $AKS_CLUSTER_NAME --query nodeResourceGroup -o tsv)</span><span id="7eb7" class="lm ln iq ld b gy nu lp l lq lr">az disk list -g $AKS_NODE_RESOURCE_GROUP</span></pre><p id="1fa6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><code class="fe la lb lc ld b">tags</code>éƒ¨åˆ†çœ‹èµ·æ¥ç±»ä¼¼äº</p><pre class="le lf lg lh gt li ld lj lk aw ll bi"><span id="e85c" class="lm ln iq ld b gy lo lp l lq lr">"tags": {<br/>      "created-by": "kubernetes-azure-dd",<br/>      "kubernetes.io-created-for-pv-name": "pvc-83020049-e107-11e9-93ab-025752f370d3",<br/>      "kubernetes.io-created-for-pvc-name": "app-pvc",<br/>      "kubernetes.io-created-for-pvc-namespace": "default"<br/>}</span></pre><h1 id="50d7" class="mg ln iq bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated">åˆ é™¤åº”ç”¨ç¨‹åºå’Œæ°¸ä¹…å·å£°æ˜</h1><p id="e038" class="pw-post-body-paragraph ju jv iq jw b jx ne jz ka kb nf kd ke kf ng kh ki kj nh kl km kn ni kp kq kr ij bi translated">è®©æˆ‘ä»¬åˆ é™¤åº”ç”¨ç¨‹åºå’Œ<code class="fe la lb lc ld b">PersistentVolumeClaim</code>ã€‚</p><pre class="le lf lg lh gt li ld lj lk aw ll bi"><span id="bb65" class="lm ln iq ld b gy lo lp l lq lr">kubectl delete -f deployment.yaml<br/>kubectl delete -f pvc.yaml</span></pre><p id="d19f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">ä½¿ç”¨<code class="fe la lb lc ld b">kubectl get pv</code>æ£€æŸ¥<code class="fe la lb lc ld b">PersistentVolume</code>â€”â€”ä½ ä¼šçœ‹åˆ°<code class="fe la lb lc ld b">STATUS</code>ç°åœ¨å·²ç»å˜æˆäº†<code class="fe la lb lc ld b">Released</code>(ä»<code class="fe la lb lc ld b">Bound</code>)ã€‚ç¡®è®¤Azureç£ç›˜ä»ç„¶å­˜åœ¨</p><pre class="le lf lg lh gt li ld lj lk aw ll bi"><span id="278a" class="lm ln iq ld b gy lo lp l lq lr">az disk list -g $AKS_NODE_RESOURCE_GROUP</span></pre><p id="bd9d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">ç¡®å®å¦‚æ­¤ã€‚åŸå› æ˜¯æˆ‘ä»¬é€šè¿‡ä½¿ç”¨è‡ªå®šä¹‰å­˜å‚¨ç±»å°†<code class="fe la lb lc ld b">reclaimPolicy</code>è®¾ç½®ä¸º<code class="fe la lb lc ld b">Retain</code>è¦†ç›–äº†é»˜è®¤è¡Œä¸º</p><p id="3043" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">å®Œæˆåï¼Œæ‚¨å¯ä»¥åˆ é™¤èµ„æºç»„ï¼Œè¿™å°†ä¾æ¬¡åˆ é™¤AKSé›†ç¾¤å’Œå…³è”çš„Azureç£ç›˜</p><h1 id="078d" class="mg ln iq bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated">æ‰“æ‰«å«ç”Ÿ</h1><pre class="le lf lg lh gt li ld lj lk aw ll bi"><span id="da85" class="lm ln iq ld b gy lo lp l lq lr">az group delete --name $AZURE_RESOURCE_GROUP --yes --no-wait</span></pre><p id="b081" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">è¿™ä¸ªåšå®¢åˆ°æ­¤ä¸ºæ­¢ã€‚æˆ‘çœŸçš„å¸Œæœ›ä½ è§‰å¾—æœ‰ç”¨ï¼ğŸ˜ƒè¯·åœ¨<a class="ae ks" href="https://twitter.com/abhi_tweeter" rel="noopener ugc nofollow" target="_blank"> Twitter </a>ä¸Šå–œæ¬¢ã€å…³æ³¨å¹¶è”ç³»æˆ‘ï¼Œä»¥è·å¾—åé¦ˆ/å»ºè®®ï¼Œæˆ–è€…éšæ—¶å‘è¡¨è¯„è®ºğŸ‘‡ğŸ‘‡</p><figure class="le lf lg lh gt jr"><div class="bz fp l di"><div class="nv nw l"/></div></figure></div></div>    
</body>
</html>