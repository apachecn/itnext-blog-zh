<html>
<head>
<title>Goodbye Sealed Secrets, hello SOPS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å†è§å¯†å°çš„ç§˜å¯†ï¼Œä½ å¥½SOPS</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/goodbye-sealed-secrets-hello-sops-3ee6a92662bb?source=collection_archive---------0-----------------------#2022-07-30">https://itnext.io/goodbye-sealed-secrets-hello-sops-3ee6a92662bb?source=collection_archive---------0-----------------------#2022-07-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/5f2bb41d01c1418ec43179e09ad16c11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KZbmpPjlYp3-D8KDKpV0aA.png"/></div></div></figure><div class=""/><div class=""><h2 id="c1d4" class="pw-subtitle-paragraph jy ja jb bd b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp dk translated">æœ¬æ•™ç¨‹å°†ä¸ºæ‚¨æä¾›åœ¨shellã€Kubernetesã€Helmå’ŒVisual Studioä»£ç ä¸­è®¾ç½®sopçš„æ‰€æœ‰æ­¥éª¤å’Œå‘½ä»¤ã€‚</h2></div><p id="9be3" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">æˆ‘ä»¬å‡è®¾æ‚¨åœ¨Windowsä¸Šä½¿ç”¨WSLä½œä¸ºLinuxç¯å¢ƒã€‚æˆ‘ä»¬å°†åœ¨ä¸¤è€…ä¸­è®¾ç½®æ ‡å‡†æ“ä½œç¨‹åºã€‚</p><p id="d777" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">æƒ³ä¸€å¤´æ‰è¿›å»å—ï¼Ÿç‚¹å‡»<a class="ae lm" href="#8f5b" rel="noopener ugc nofollow">è¿™é‡Œ</a>ç›´æ¥è·³è½¬åˆ°å®‰è£…éƒ¨åˆ†ã€‚</p><p id="d0b9" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">å®‰è£…ç›–:</p><ul class=""><li id="966f" class="ln lo jb ks b kt ku kw kx kz lp ld lq lh lr ll ls lt lu lv bi translated">å£³</li><li id="e3c2" class="ln lo jb ks b kt lw kw lx kz ly ld lz lh ma ll ls lt lu lv bi translated">èˆµ</li><li id="8de6" class="ln lo jb ks b kt lw kw lx kz ly ld lz lh ma ll ls lt lu lv bi translated">Visual Studioä»£ç </li></ul><h1 id="3ad9" class="mb mc jb bd md me mf mg mh mi mj mk ml kh mm ki mn kk mo kl mp kn mq ko mr ms bi translated">ä»€ä¹ˆæ˜¯sop</h1><p id="a658" class="pw-post-body-paragraph kq kr jb ks b kt mt kc kv kw mu kf ky kz mv lb lc ld mw lf lg lh mx lj lk ll ij bi translated">Sops æ˜¯ä¸€ä¸ªèƒ½å¤ŸåŠ å¯†é…ç½®æ–‡ä»¶çš„äºŒè¿›åˆ¶ç¨‹åºã€‚ä½†æ˜¯Sopsç†è§£æ ¼å¼(JSONã€YAMLã€INIç­‰),å¹¶ä¸”åªåŠ å¯†æ¯ä¸€è¡Œçš„å€¼(åœ¨ä¸€ä¸ªé”®/å€¼å¯¹ä¸­),è€Œä¸æ˜¯åŠ å¯†æ•´ä¸ªæ–‡ä»¶ã€‚</p><blockquote class="my mz na"><p id="6026" class="kq kr nb ks b kt ku kc kv kw kx kf ky nc la lb lc nd le lf lg ne li lj lk ll ij bi translated">ç›®çš„æ˜¯å°†åŒ…å«æ•æ„Ÿä¿¡æ¯çš„åŠ å¯†é…ç½®å­˜å‚¨åˆ°æ‚¨çš„ç‰ˆæœ¬ç³»ç»Ÿ(Gitã€SVNç­‰)ä¸­ï¼Œç„¶åèƒ½å¤Ÿæ¯«ä¸è´¹åŠ›åœ°ä½¿ç”¨è¿™äº›åŠ å¯†æ–‡ä»¶ã€‚</p></blockquote><p id="ab81" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">sopæä¾›äº†ä»¥ä¸‹ä¼˜åŠ¿:</p><ol class=""><li id="ce3c" class="ln lo jb ks b kt ku kw kx kz lp ld lq lh lr ll nf lt lu lv bi translated">åŠ å¯†å€¼è€Œéå¯†é’¥<br/>â€“å³ä½¿åŠ å¯†ä¹Ÿèƒ½ä¿ç•™æ–‡ä»¶ç»“æ„</li><li id="ac79" class="ln lo jb ks b kt lw kw lx kz ly ld lz lh ma ll nf lt lu lv bi translated">å°†åŠ å¯†æ–‡ä»¶å®‰å…¨ä¿å­˜åˆ°Git</li><li id="16a5" class="ln lo jb ks b kt lw kw lx kz ly ld lz lh ma ll nf lt lu lv bi translated">æ— ç¼ç¼–è¾‘åŠ å¯†æ–‡ä»¶<br/>â€“Sopså°†åœ¨æ‚¨æœ€å–œæ¬¢çš„æ–‡æœ¬ç¼–è¾‘å™¨ä¸­æ‰“å¼€æ–‡ä»¶çš„æœªåŠ å¯†ç‰ˆæœ¬<br/>â€“ä¿å­˜æ—¶ï¼Œæ–‡ä»¶å°†è‡ªåŠ¨ä½¿ç”¨æ–°å†…å®¹é‡æ–°åŠ å¯†</li><li id="10fa" class="ln lo jb ks b kt lw kw lx kz ly ld lz lh ma ll nf lt lu lv bi translated">åŠ å¯†ç‰¹å®šçš„å¯†é’¥ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ–‡ä»¶<br/>â€“éå¸¸é€‚åˆåŒ…å«å°‘é‡æ•æ„Ÿä¿¡æ¯çš„é•¿é…ç½®æ–‡ä»¶ã€‚</li><li id="3f45" class="ln lo jb ks b kt lw kw lx kz ly ld lz lh ma ll nf lt lu lv bi translated">ä½¿ç”¨æ‰€æœ‰çš„é…ç½®æ–‡ä»¶ï¼Œè€Œä¸ä»…ä»…æ˜¯Kubernetesçš„ç§˜å¯†<br/>â€”â€”å¯ä»¥åŠ å¯†ä½ çš„å¤´ç›”çš„<code class="fe ng nh ni nj b">values.yaml</code>æ–‡ä»¶ï¼Œä»¥å®‰å…¨åœ°å­˜å‚¨å…¶ä¸­çš„æ•æ„Ÿæ•°æ®(å¯†ç ç­‰)</li><li id="0147" class="ln lo jb ks b kt lw kw lx kz ly ld lz lh ma ll nf lt lu lv bi translated">Kubernetesä¸­ä¸éœ€è¦åç«¯<br/>-å”¯ä¸€çš„è¦æ±‚æ˜¯åœ¨æœ¬åœ°å®‰è£…sop<br/>-ç®¡ç†åŠ å¯†æ–‡ä»¶å°†åœ¨æœ¬åœ°å®Œæˆ</li><li id="cdd7" class="ln lo jb ks b kt lw kw lx kz ly ld lz lh ma ll nf lt lu lv bi translated">æ‰€æœ‰ä¸»è¦å·¥å…·éƒ½æœ‰æ’ä»¶æ¥æ”¯æŒsopå·¥ä½œ</li></ol><h2 id="cb24" class="nk mc jb bd md nl nm dn mh nn no dp ml kz np nq mn ld nr ns mp lh nt nu mr nv bi translated">SopsåŠ å¯†ç¤ºä¾‹</h2><p id="7dc8" class="pw-post-body-paragraph kq kr jb ks b kt mt kc kv kw mu kf ky kz mv lb lc ld mw lf lg lh mx lj lk ll ij bi translated">å‡è®¾æˆ‘ä»¬æœ‰è¿™ä¸ªç»å…¸çš„Kubernetesç§˜å¯†ã€‚ç§˜å¯†å€¼ä¸åŠ å¯†ï¼Œè€Œåªç¼–ç ä¸ºbase64ã€‚</p><pre class="nw nx ny nz gt oa nj ob oc aw od bi"><span id="2261" class="nk mc jb nj b gy oe of l og oh"><strong class="nj jc">apiVersion</strong>: v1<br/><strong class="nj jc">data</strong>:<br/>  <strong class="nj jc">secret_value</strong>: U29wcyBydWxlcw== ğŸ“–<br/><strong class="nj jc">kind</strong>: Secret<br/><strong class="nj jc">metadata</strong>:<br/>  <strong class="nj jc">creationTimestamp</strong>: null<br/>  <strong class="nj jc">name</strong>: my-secret<br/>  <strong class="nj jc">namespace</strong>: default</span></pre><p id="d3ea" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">æ¥å—sopåï¼Œä½ ä¼šå¾—åˆ°:</p><pre class="nw nx ny nz gt oa nj ob oc aw od bi"><span id="8039" class="nk mc jb nj b gy oe of l og oh"><strong class="nj jc">apiVersion</strong>: ENC[AES256_GCM,data:PFk=,iv:,[...]tag:G9mg==,type:str]ğŸ”’<br/><strong class="nj jc">data</strong>:<br/>    <strong class="nj jc">secret_value</strong>: ENC[AES256_GCM,data:Ex2KhoAlCG4w==,[...]ğŸ”’<br/><strong class="nj jc">kind</strong>: ENC[AES256_GCM,data:eW1JrnrV,[...]ğŸ”’<br/><strong class="nj jc">metadata</strong>:<br/>    <strong class="nj jc">creationTimestamp</strong>: null<br/>    <strong class="nj jc">name</strong>: ENC[AES256_GCM,data:fkWXVtQS/C62,iv:GCTfamtu4ixP4w=[...]ğŸ”’<br/>    <strong class="nj jc">namespace</strong>: ENC[AES256_GCM,data:J96kuhjMUA==,iv:QZMnvDGqX[...]ğŸ”’<br/><strong class="nj jc">sops</strong>:<br/>[...]</span></pre><p id="317c" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">å¦‚æ‚¨æ‰€è§ï¼Œæ‰€æœ‰çš„å€¼éƒ½è¢«åŠ å¯†äº†ã€‚ä½†æ˜¯å¯†é’¥ä»ç„¶æ˜¯æ˜æ–‡ã€‚</p><p id="803f" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">sopä¹Ÿå¯ä»¥æ ¹æ®ä½ ç»™å®ƒçš„å¯†é’¥åŠ å¯†ç‰¹å®šçš„å€¼ã€‚<br/>è¿™é‡Œï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦<strong class="ks jc">ä»…</strong>åŠ å¯†â€œsecret_valueâ€å¯†é’¥:</p><pre class="nw nx ny nz gt oa nj ob oc aw od bi"><span id="dae0" class="nk mc jb nj b gy oe of l og oh"><strong class="nj jc">apiVersion</strong>: v1ğŸ“–<br/><strong class="nj jc">data</strong>:<br/>    <strong class="nj jc">secret_value</strong>: ENC[AES256_GCM,data:9VBm+32QSCOaU+9exohSg==[...]ğŸ”’<br/><strong class="nj jc">kind</strong>: SecretğŸ“–<br/><strong class="nj jc">metadata</strong>:<br/>    <strong class="nj jc">creationTimestamp</strong>: null<br/>    <strong class="nj jc">name</strong>: my-secretğŸ“–<br/>    <strong class="nj jc">namespace</strong>: defaultğŸ“–<br/><strong class="nj jc">sops</strong>:<br/>[...]</span></pre><p id="805d" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">åªæœ‰â€œsecret_valueâ€å€¼è¢«åŠ å¯†ã€‚æ–‡ä»¶çš„å…¶ä½™éƒ¨åˆ†ä¿æŒä¸å˜ã€‚</p><h1 id="89c7" class="mb mc jb bd md me mf mg mh mi mj mk ml kh mm ki mn kk mo kl mp kn mq ko mr ms bi translated">ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸å†ä½¿ç”¨å¯†å°çš„ç§˜å¯†</h1><h2 id="0940" class="nk mc jb bd md nl nm dn mh nn no dp ml kz np nq mn ld nr ns mp lh nt nu mr nv bi translated">å®ƒæ˜¯åšä»€ä¹ˆçš„ï¼Ÿ</h2><p id="3418" class="pw-post-body-paragraph kq kr jb ks b kt mt kc kv kw mu kf ky kz mv lb lc ld mw lf lg lh mx lj lk ll ij bi translated">æˆ‘ä»¬å·²ç»ä½¿ç”¨å¯†å°æœºå¯†ä¸€å¹´äº†ï¼Œä½†ç°åœ¨æ˜¯æ”¹å˜çš„æ—¶å€™äº†ã€‚è¿™é¡¹(å¾ˆé…·çš„)æŠ€æœ¯å…è®¸ä½ åœ¨ç£ç›˜ä¸ŠåŠ å¯†ä¸€ä¸ªKubernetesç§˜å¯†ï¼Œç„¶ååœ¨GITä¸Šæäº¤ã€‚è¿™æ ·ï¼Œå³ä½¿é»‘å®¢å¾—åˆ°äº†ä½ çš„å­˜å‚¨åº“ï¼Œä»–ä¹Ÿæ— æ³•è®¿é—®ä½ çš„ç§˜å¯†å†…å®¹ã€‚</p><h2 id="90e9" class="nk mc jb bd md nl nm dn mh nn no dp ml kz np nq mn ld nr ns mp lh nt nu mr nv bi translated">ä¸ºä»€ä¹ˆä¸å®Œç¾ï¼Ÿ</h2><p id="8c64" class="pw-post-body-paragraph kq kr jb ks b kt mt kc kv kw mu kf ky kz mv lb lc ld mw lf lg lh mx lj lk ll ij bi translated">SealedSecretå¯¹äºå¾ˆå¤šç”¨ä¾‹æ¥è¯´éƒ½å¾ˆæ£’ã€‚ä½†åœ¨æˆ‘ä»¬çœ‹æ¥ï¼Œå®ƒç¡®å®æœ‰äº›ä¸è¶³:</p><ul class=""><li id="a88c" class="ln lo jb ks b kt ku kw kx kz lp ld lq lh lr ll ls lt lu lv bi translated">å¿…é¡»åœ¨é›†ç¾¤ä¸­å®‰è£…åç«¯</li><li id="e11e" class="ln lo jb ks b kt lw kw lx kz ly ld lz lh ma ll ls lt lu lv bi translated">è¯ä¹¦è½®æ¢å¯èƒ½ä¼šå˜å¾—å¤æ‚</li><li id="910f" class="ln lo jb ks b kt lw kw lx kz ly ld lz lh ma ll ls lt lu lv bi translated">é»˜è®¤åŠ å¯†æ¨¡å¼ä¸å…è®¸å°†æœºå¯†ä»ä¸€ä¸ªåç§°ç©ºé—´ç§»åŠ¨åˆ°å¦ä¸€ä¸ªåç§°ç©ºé—´</li><li id="610e" class="ln lo jb ks b kt lw kw lx kz ly ld lz lh ma ll ls lt lu lv bi translated">åœ¨Kubernetesé›†ç¾¤ä¸Šï¼Œç”Ÿæˆçš„ç§˜å¯†ä»ç„¶æ˜¯æ˜æ–‡</li></ul><p id="82b2" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><strong class="ks jc">ä½†æ˜¯æœ€æœ‰é—®é¢˜çš„éƒ¨åˆ†æ˜¯â€¦â€¦</strong></p><blockquote class="my mz na"><p id="e4dc" class="kq kr nb ks b kt ku kc kv kw kx kf ky nc la lb lc nd le lf lg ne li lj lk ll ij bi translated">æˆ‘ä»¬å°†æ•æ„Ÿæ•°æ®ä»¥çº¯æ–‡æœ¬å½¢å¼å­˜å‚¨åœ¨èˆµå›¾ä¸­ï¼Œä¾‹å¦‚èˆµå›¾çš„â€œvalues.yamlâ€ä¸­çš„å¯†ç ã€‚<strong class="ks jc">è¿™æ ¹æœ¬ä¸åœ¨ä¿å¯†èŒƒå›´å†…ã€‚</strong></p></blockquote><h1 id="8f5b" class="mb mc jb bd md me mf mg mh mi mj mk ml kh mm ki mn kk mo kl mp kn mq ko mr ms bi translated">å®‰è£…æ ‡å‡†æ“ä½œç¨‹åº</h1><h2 id="dfbc" class="nk mc jb bd md nl nm dn mh nn no dp ml kz np nq mn ld nr ns mp lh nt nu mr nv bi translated">åœ¨WSLä¸Šå®‰è£…SopsäºŒè¿›åˆ¶æ–‡ä»¶</h2><p id="e4e3" class="pw-post-body-paragraph kq kr jb ks b kt mt kc kv kw mu kf ky kz mv lb lc ld mw lf lg lh mx lj lk ll ij bi translated">ä¸‹è½½linuxçš„äºŒè¿›åˆ¶æ–‡ä»¶:<a class="ae lm" href="https://github.com/mozilla/sops/releases" rel="noopener ugc nofollow" target="_blank">https://github.com/mozilla/sops/releases</a></p><pre class="nw nx ny nz gt oa nj ob oc aw od bi"><span id="a4b8" class="nk mc jb nj b gy oe of l og oh">$ wget &lt;URL_OF_THE_BIN_FROM_GITHUB&gt;<br/>$ sudo mv sops-&lt;VERSION&gt; /usr/local/bin/sops</span></pre><h2 id="006c" class="nk mc jb bd md nl nm dn mh nn no dp ml kz np nq mn ld nr ns mp lh nt nu mr nv bi translated">å®‰è£…å¹´é¾„</h2><figure class="nw nx ny nz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oi"><img src="../Images/b3e3f4e94bdf04f655711cc54636b9f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2Wj6BlrIcYwgNQw-.png"/></div></div></figure><p id="03dc" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">Sopsæœ¬èº«å¹¶ä¸åŠ å¯†ã€‚å®ƒåˆ©ç”¨äº†å…¶ä»–åŠ å¯†æŠ€æœ¯ï¼Œå¦‚PGPã€AGEã€GCP KMSã€Azure key vaultã€Hashicorp Vaultç­‰</p><p id="6560" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">ç”±äºPGPæœ‰ç‚¹è¿‡æ—¶ï¼Œæˆ‘ä»¬å°†å®‰è£…æ–°çš„ç‰ˆæœ¬:<strong class="ks jc">å¹´é¾„</strong></p><p id="d6d2" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">å¹´é¾„æ˜¯åŠ å¯†æ–‡ä»¶çš„å·¥å…·ã€‚å®ƒä¸å…³å¿ƒæ–‡ä»¶æœ¬èº«çš„æ ¼å¼ã€‚ä¸ºäº†åªåŠ å¯†æ–‡ä»¶çš„å€¼æˆ–éƒ¨åˆ†ï¼Œæˆ‘ä»¬éœ€è¦ä¾èµ–sopã€‚å¹´é¾„åªæ˜¯Sopsä¼šç”¨çš„ä¸€ä¸ªå·¥å…·ã€‚</p><p id="39cf" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">è®©æˆ‘ä»¬å®‰è£…å¹´é¾„â€¦</p><pre class="nw nx ny nz gt oa nj ob oc aw od bi"><span id="9f97" class="nk mc jb nj b gy oe of l og oh">$ AGE_VERSION=$(curl -s "<a class="ae lm" href="https://api.github.com/repos/FiloSottile/age/releases/latest" rel="noopener ugc nofollow" target="_blank">https://api.github.com/repos/FiloSottile/age/releases/latest</a>" | grep -Po '"tag_name": "(v.*)"' |grep -Po '[0-9].*[0-9]')</span><span id="b532" class="nk mc jb nj b gy oj of l og oh">$ curl -Lo age.tar.gz "<a class="ae lm" href="https://github.com/FiloSottile/age/releases/latest/download/age-v${AGE_VERSION}-linux-amd64.tar.gz" rel="noopener ugc nofollow" target="_blank">https://github.com/FiloSottile/age/releases/latest/download/age-v${AGE_VERSION}-linux-amd64.tar.gz</a>"</span><span id="1d2c" class="nk mc jb nj b gy oj of l og oh">$ tar xf age.tar.gz</span><span id="c6b2" class="nk mc jb nj b gy oj of l og oh">$ sudo mv age/age /usr/local/bin</span><span id="dc57" class="nk mc jb nj b gy oj of l og oh">$ sudo mv age/age-keygen /usr/local/bin</span></pre><h2 id="3eab" class="nk mc jb bd md nl nm dn mh nn no dp ml kz np nq mn ld nr ns mp lh nt nu mr nv bi translated">ç”Ÿæˆå…¬é’¥å’Œç§é’¥</h2><p id="b2f6" class="pw-post-body-paragraph kq kr jb ks b kt mt kc kv kw mu kf ky kz mv lb lc ld mw lf lg lh mx lj lk ll ij bi translated">æ—¢ç„¶Ageå·²ç»å®‰è£…ï¼Œæ‚¨å¿…é¡»åˆ›å»ºä¸€ä¸ªå…¬é’¥å’Œä¸€ä¸ªç§é’¥ã€‚</p><pre class="nw nx ny nz gt oa nj ob oc aw od bi"><span id="1fbc" class="nk mc jb nj b gy oe of l og oh">$ age-keygen -o key.txt</span><span id="c879" class="nk mc jb nj b gy oj of l og oh">$ cat key.txt<br/># created: 2022-07-30T17:02:43+02:00<br/># public key: age1rdje4gwnm2cc6uu6lvggzjj8gktu4cw5ng8yyjhrluwvqq387cls58dsy4<br/>AGE-SECRET-KEY-18LMDYJRYZMRM52CYQA9MZW79M85CPR0HJHCASXF5ADT03KJ290HS88599E</span><span id="100f" class="nk mc jb nj b gy oj of l og oh">$ mkdir ~/.sops</span><span id="ea07" class="nk mc jb nj b gy oj of l og oh">$ mv ./key.txt ~/.sops</span></pre><p id="a4c1" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">ç”±Ageåˆ›å»ºçš„â–¶ï¸Theç§é’¥å’Œå…¬é’¥å­˜å‚¨åœ¨æ–‡ä»¶<code class="fe ng nh ni nj b">key.txt</code>ä¸­ã€‚æˆ‘ä»¬å°†è¿™ä¸ªæ–‡ä»¶ç§»åŠ¨åˆ°ä¸»æ–‡ä»¶å¤¹ä¸­çš„ä¸€ä¸ª<code class="fe ng nh ni nj b">.sops</code>ç›®å½•ä¸­ã€‚</p><p id="09de" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">ä¸ºäº†å‘Šè¯‰sopä¸€åˆ‡éƒ½åœ¨å“ªé‡Œï¼Œå°†è¿™äº›ENVå˜é‡æ·»åŠ åˆ°æ‚¨çš„shellé…ç½®ä¸­(<code class="fe ng nh ni nj b">~/.bashrc</code>æˆ–<code class="fe ng nh ni nj b">~/.zshrc</code></p><pre class="nw nx ny nz gt oa nj ob oc aw od bi"><span id="023d" class="nk mc jb nj b gy oe of l og oh">export SOPS_AGE_KEY_FILE=$HOME/.sops/key.txt<br/>export EDITOR=nano # Replace by your favorite editor</span></pre><p id="0ed0" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">åœ¨ç»§ç»­ä¹‹å‰ä¸è¦å¿˜è®°<code class="fe ng nh ni nj b">source</code>æ‚¨çš„shellé…ç½®æ–‡ä»¶ï¼Œæˆ–è€…è‡³å°‘æ‰“å¼€ä¸€ä¸ªæ–°çš„shellã€‚</p><h2 id="a913" class="nk mc jb bd md nl nm dn mh nn no dp ml kz np nq mn ld nr ns mp lh nt nu mr nv bi translated">æµ‹è¯•sopå’ŒAgeæ­£åœ¨å·¥ä½œ</h2><p id="fcc8" class="pw-post-body-paragraph kq kr jb ks b kt mt kc kv kw mu kf ky kz mv lb lc ld mw lf lg lh mx lj lk ll ij bi translated">è®©æˆ‘ä»¬åŠ å¯†ä¸€ä¸ªæ–‡ä»¶â€¦</p><pre class="nw nx ny nz gt oa nj ob oc aw od bi"><span id="a410" class="nk mc jb nj b gy oe of l og oh"># Creating a test file<br/>$ echo "my-key: my-value" &gt; config.yaml</span><span id="0587" class="nk mc jb nj b gy oj of l og oh"># Encrypting the file<br/>sops --encrypt --age $(cat ~/.sops/key.txt |grep -oP "public key: \K(.*)") ./config.yaml</span></pre><p id="5134" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">â–¶ï¸:æˆ‘ä»¬ä½¿ç”¨äº†<code class="fe ng nh ni nj b">--age</code>å‚æ•°æ¥æŒ‡å®šä½¿ç”¨ä»€ä¹ˆå…¬é’¥ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä¾é bashåœ¨è¿è¡Œæ—¶æ›¿æ¢å‡ºç°åœ¨<code class="fe ng nh ni nj b">key.txt</code>ä¸­çš„å…¬é’¥ã€‚</p><p id="a24c" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">ç°åœ¨ï¼Œè¦å°†æ–‡ä»¶ä¿å­˜åˆ°ç£ç›˜ï¼Œåªéœ€ç®€å•çš„å³é‡å®šå‘å³å¯:</p><pre class="nw nx ny nz gt oa nj ob oc aw od bi"><span id="fb1d" class="nk mc jb nj b gy oe of l og oh">$ sops --encrypt --age $(cat ~/.sops/key.txt |grep -oP "public key: \K(.*)") ./config.yaml &gt; config_enc.yaml</span><span id="590c" class="nk mc jb nj b gy oj of l og oh">$ cat config_enc.yaml<br/>my-key: ENC[AES256_GCM,data:Jw1oRQcV8=,tag:Tzd/oUQ[...]==,type:str]<br/>sops:<br/>[...]</span><span id="bfca" class="nk mc jb nj b gy oj of l og oh"># Edit the file using Sops<br/>$ sops config_enc.yaml<br/>&lt;Your favorite editor should have opened&gt;<br/>&lt;The file in front of you should be unencrypted&gt;<br/>&lt;When saving, modifications you made will be encrypted&gt;</span></pre><blockquote class="my mz na"><p id="322c" class="kq kr nb ks b kt ku kc kv kw kx kf ky nc la lb lc nd le lf lg ne li lj lk ll ij bi translated">åŠ¨æ€è§£å¯†å’Œé‡æ–°åŠ å¯†æ˜¯ä¸€ä¸ªæå¥½çš„ç‰¹æ€§ã€‚ä½ ç”šè‡³ä¸çŸ¥é“æ–‡ä»¶è¢«åŠ å¯†äº†ã€‚éƒ½æ˜¯è‡ªåŠ¨çš„ï¼</p></blockquote><h1 id="76e0" class="mb mc jb bd md me mf mg mh mi mj mk ml kh mm ki mn kk mo kl mp kn mq ko mr ms bi translated">é…ç½®å·¥å…·</h1><h2 id="c9d0" class="nk mc jb bd md nl nm dn mh nn no dp ml kz np nq mn ld nr ns mp lh nt nu mr nv bi translated">å‘æ‚¨çš„è§£é‡Šå™¨æ·»åŠ åˆ«å</h2><p id="4631" class="pw-post-body-paragraph kq kr jb ks b kt mt kc kv kw mu kf ky kz mv lb lc ld mw lf lg lh mx lj lk ll ij bi translated">è¿™åº”è¯¥å¯ä»¥æ¯«ä¸è´¹åŠ›åœ°åœ¨bashå’Œzshä¸Šè¿è¡Œã€‚</p><p id="dce0" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">ç”±äºåŠ å¯†æ–‡ä»¶çš„è¯­æ³•æœ‰ç‚¹ç¹ç(å› ä¸ºä½ å¿…é¡»å°†Ageå…¬é’¥ä¼ é€’ç»™Sops ),æˆ‘ä»¬å‡†å¤‡äº†ä¸€ä¸ªåˆ«åï¼Œå¯ä»¥æ·»åŠ åˆ°ä½ çš„<code class="fe ng nh ni nj b">.bashrc</code>æˆ–<code class="fe ng nh ni nj b">.zshrc</code></p><pre class="nw nx ny nz gt oa nj ob oc aw od bi"><span id="9b52" class="nk mc jb nj b gy oe of l og oh">function cypher {<br/>    filename=$(basename -- "$1")<br/>    extension="${filename##*.}"<br/>    filename="${filename%.*}"<br/>    sops --encrypt --age $(cat ~/.sops/key.txt |grep -oP "public key: \K(.*)") $2 $3 $1 &gt; "$filename.enc.$extension"<br/>}</span></pre><p id="3901" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">è¯·è®°ä½ï¼Œåœ¨å°è¯•æ–°åˆ«åä¹‹å‰ï¼Œè¯·å§‹ç»ˆ<code class="fe ng nh ni nj b">source</code>ä¿å­˜æ‚¨çš„ä¸ªäººèµ„æ–™ã€‚</p><p id="29a2" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><strong class="ks jc">ç”¨æ³•:</strong></p><pre class="nw nx ny nz gt oa nj ob oc aw od bi"><span id="a34f" class="nk mc jb nj b gy oe of l og oh"># Creating test files<br/>$ echo "some_key: some_value" &gt; test_alias.yaml</span><span id="2e3d" class="nk mc jb nj b gy oj of l og oh"># Encrypting<br/>$ cypher test_alias.yaml</span><span id="8e8b" class="nk mc jb nj b gy oj of l og oh">$ ls<br/>test_alias.enc.yaml</span></pre></div><div class="ab cl ok ol hu om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="ij ik il im in"><p id="b87a" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">æ‚¨ä¹Ÿå¯ä»¥æ›´æ–°åˆ«åä»¥å°±åœ°ç¼–è¾‘æ–‡ä»¶ï¼Œè€Œä¸ç”Ÿæˆæ–°æ–‡ä»¶ã€‚è¿™åº”è¯¥æ˜¯è¿™æ ·çš„:</p><pre class="nw nx ny nz gt oa nj ob oc aw od bi"><span id="da72" class="nk mc jb nj b gy oe of l og oh">function cypher_inplace {<br/>    sops --encrypt --in-place --age $(cat ~/.sops/key.txt |grep -oP "public key: \K(.*)") $2 $3 $1<br/>}</span></pre></div><div class="ab cl ok ol hu om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="ij ik il im in"><p id="6bb9" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">è¦ä»…åŠ å¯†æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œå¿…é¡»ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ˜¾å¼å¯†é’¥ã€‚ä½ <strong class="ks jc">ä¸éœ€è¦</strong>æˆä¸ºæ­£åˆ™è¡¨è¾¾å¼å¤§å¸ˆæ¥å®ç°è¿™ä¸€ç‚¹ã€‚çœ‹çœ‹è¿™ä¸ªä¾‹å­:</p><pre class="nw nx ny nz gt oa nj ob oc aw od bi"><span id="ce0c" class="nk mc jb nj b gy oe of l og oh">$ echo "key1: value1" &gt;  test_regex.yaml<br/>$ echo "key2: value2" &gt;&gt; test_regex.yaml<br/>$ echo "key3: value3" &gt;&gt; test_regex.yaml</span><span id="5d95" class="nk mc jb nj b gy oj of l og oh">$ cat test_regex.yaml<br/>key1: value1<br/>key2: value2<br/>key3: value3</span><span id="ad18" class="nk mc jb nj b gy oj of l og oh">$ cypher test_regex.yaml  --encrypted-regex='^(key1|key3)$'</span><span id="2943" class="nk mc jb nj b gy oj of l og oh">$ cat test_regex.enc.yaml<br/>key1: ENC[AES256_GCM,[...]tag:qHy9z22CIxcb9ykpPAWikQ==,type:str]<br/>key2: value2<br/>key3: ENC[AES256_GCM,data:3Faqn,[...]tag:1VB3/wrLekmg==,type:str]</span></pre><p id="e8da" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">å¦‚æ‚¨æ‰€è§ï¼Œåªæœ‰<code class="fe ng nh ni nj b">key1</code>å’Œ<code class="fe ng nh ni nj b">key3</code>çš„å€¼è¢«åŠ å¯†ã€‚<code class="fe ng nh ni nj b">key2</code>ä¸€ç›´ä¿æŒåŸæ ·ã€‚</p><blockquote class="my mz na"><p id="46e0" class="kq kr nb ks b kt ku kc kv kw kx kf ky nc la lb lc nd le lf lg ne li lj lk ll ij bi translated">æ‚¨å¯ä»¥æ·»åŠ ä»»ä½•æƒ³è¦çš„é”®ï¼Œç”¨<code class="fe ng nh ni nj b">|</code>åˆ†éš”ã€‚ä¾‹å¦‚<code class="fe ng nh ni nj b">--encrypted-regex='^(&lt;a_first_key&gt;|&lt;a_second_key&gt;|&lt;a_third_key&gt;)$</code></p></blockquote><h2 id="42a4" class="nk mc jb bd md nl nm dn mh nn no dp ml kz np nq mn ld nr ns mp lh nt nu mr nv bi translated">ä¸ºVisual Studioä»£ç å®‰è£…sop</h2><p id="4dff" class="pw-post-body-paragraph kq kr jb ks b kt mt kc kv kw mu kf ky kz mv lb lc ld mw lf lg lh mx lj lk ll ij bi translated">æ­£å¦‚æˆ‘ä»¬æ‰€è§ï¼ŒSopså…è®¸æ— ç¼ç¼–è¾‘åŠ å¯†æ–‡ä»¶ã€‚Visual Studioä»£ç ä¹Ÿå¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œåªè¦å®ƒæœ‰ä¸€ä¸ªSopsæ’ä»¶ã€‚</p><ol class=""><li id="894c" class="ln lo jb ks b kt ku kw kx kz lp ld lq lh lr ll nf lt lu lv bi translated">ä¸‹è½½é€‚ç”¨äºWindowsçš„SopsäºŒè¿›åˆ¶æ–‡ä»¶(æˆ–è€…ä»»ä½•è¿è¡ŒVSä»£ç çš„æ“ä½œç³»ç»Ÿ)<br/>-<a class="ae lm" href="https://github.com/mozilla/sops/releases" rel="noopener ugc nofollow" target="_blank">https://github.com/mozilla/sops/releases</a></li><li id="1a90" class="ln lo jb ks b kt lw kw lx kz ly ld lz lh ma ll nf lt lu lv bi translated">å°†äºŒè¿›åˆ¶æ–‡ä»¶æ·»åŠ åˆ°æ“ä½œç³»ç»Ÿè·¯å¾„<br/>â€”â€”åœ¨Windowsä¸Šæ˜¯<code class="fe ng nh ni nj b">c:\Windows\system32</code><br/>â€”â€”å°†å…¶é‡å‘½åä¸º<code class="fe ng nh ni nj b">sops.exe</code></li><li id="1df8" class="ln lo jb ks b kt lw kw lx kz ly ld lz lh ma ll nf lt lu lv bi translated">åœ¨VScodeä¸Šï¼Œä¸‹è½½Sopsæ’ä»¶<a class="ae lm" href="http://twitter.com/signageos/vscode-sops" rel="noopener ugc nofollow" target="_blank"> @signageos/vscode-sops </a>ã€‚<br/> -ä½ ä¸éœ€è¦è¿™ä¹ˆåšï¼Œä½†æ˜¯ï¼Œè¦åœ¨VScodeä¸­é…ç½®æ’ä»¶ï¼Œè¯·è½¬åˆ°<code class="fe ng nh ni nj b">file &gt; preferences &gt; settings &gt; plugins &gt; Sops</code></li><li id="9a68" class="ln lo jb ks b kt lw kw lx kz ly ld lz lh ma ll nf lt lu lv bi translated">å°†å®‰è£…åœ¨linux (WSL)ä¸Šçš„å¯†é’¥å¤åˆ¶åˆ°Windowsåˆ†åŒº</li></ol><pre class="nw nx ny nz gt oa nj ob oc aw od bi"><span id="69ce" class="nk mc jb nj b gy oe of l og oh">$ mkdir /mnt/c/Users/&lt;YOUR_WINDOWS_USERNAME&gt;/AppData/Roaming/sops/age -p</span><span id="d2a2" class="nk mc jb nj b gy oj of l og oh">$ cp ~/.sops/key.txt /mnt/c/Users/&lt;YOUR_WINDOWS_USERNAME&gt;/AppData/Roaming/sops/age/keys.txt</span></pre><p id="9654" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">â–¶ï¸è·¯å¾„<code class="fe ng nh ni nj b">AppData/Roaming/sops/age</code>æ˜¯VSCodeæœŸæœ›ä½ çš„å¯†é’¥æ‰€åœ¨çš„åœ°æ–¹ã€‚å¦‚æœéœ€è¦ï¼Œå¯ä»¥åœ¨æ’ä»¶è®¾ç½®ä¸­è¿›è¡Œé…ç½®ã€‚</p><h2 id="9100" class="nk mc jb bd md nl nm dn mh nn no dp ml kz np nq mn ld nr ns mp lh nt nu mr nv bi translated">å®‰è£…èˆµçš„æ ‡å‡†æ“ä½œç¨‹åº</h2><p id="fce6" class="pw-post-body-paragraph kq kr jb ks b kt mt kc kv kw mu kf ky kz mv lb lc ld mw lf lg lh mx lj lk ll ij bi translated">Sopsçš„ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜ç‚¹æ˜¯ï¼Œä½ å¯ä»¥æŠŠçº¯æ–‡æœ¬çš„æ•æ„Ÿæ•°æ®æ”¾åœ¨ä½ çš„èˆµå›¾çš„<code class="fe ng nh ni nj b">values.yaml</code>ä¸­ï¼Œç„¶åç®€å•åœ°è®©SopsåŠ å¯†æ–‡ä»¶ã€‚</p><p id="3171" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">â—å› æ­¤ï¼Œè¯¥æ–‡ä»¶ä¸èƒ½ç›´æ¥ä¸å¤´ç›”ä¸€èµ·ä½¿ç”¨ï¼Œå› ä¸ºå®ƒæœ¬èº«ä¸èƒ½è¯»å–åŠ å¯†æ–‡ä»¶â€¦ <br/> â–¶ï¸ï¸è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ åº”è¯¥å®‰è£…è¿™ä¸ªå¤´ç›”æ’ä»¶ã€‚å®ƒå…è®¸ä½¿ç”¨æ‰€æœ‰ç»å…¸çš„helmå‘½ä»¤ï¼Œä½†å½“é‡åˆ°åŠ å¯†æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨è§£å¯†å¹¶ç»§ç»­å®‰è£…è¿‡ç¨‹ã€‚</p><pre class="nw nx ny nz gt oa nj ob oc aw od bi"><span id="a33b" class="nk mc jb nj b gy oe of l og oh">$ helm plugin install <a class="ae lm" href="https://github.com/jkroepke/helm-secrets" rel="noopener ugc nofollow" target="_blank">https://github.com/jkroepke/helm-secrets</a> --version v3.14.0</span></pre><p id="b34c" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">è¦ä½¿ç”¨è¿™ä¸ªæ’ä»¶ï¼Œä½ åªéœ€åœ¨helmäºŒè¿›åˆ¶æ–‡ä»¶åæ·»åŠ å•è¯<code class="fe ng nh ni nj b">secrets</code>ã€‚<br/>ä¾‹å¦‚ï¼Œå½“å®‰è£…å¸¦æœ‰åŠ å¯†<code class="fe ng nh ni nj b">values.yaml</code>çš„èˆµå›¾æ—¶:</p><pre class="nw nx ny nz gt oa nj ob oc aw od bi"><span id="3ad1" class="nk mc jb nj b gy oe of l og oh">$ helm secrets install minecraft-server itzg/minecraft</span></pre><h2 id="e49b" class="nk mc jb bd md nl nm dn mh nn no dp ml kz np nq mn ld nr ns mp lh nt nu mr nv bi translated">ä¸ºKubectlå®‰è£…sop</h2><p id="03bb" class="pw-post-body-paragraph kq kr jb ks b kt mt kc kv kw mu kf ky kz mv lb lc ld mw lf lg lh mx lj lk ll ij bi translated">ç›®å‰è¿˜æ²¡æœ‰ä»€ä¹ˆå¥½çš„è§£å†³æ–¹æ¡ˆæ¥æ··åˆkubectlå’Œsopsã€‚ä½†æ˜¯é€šè¿‡ç®¡é“å°†sopè¾“å‡ºåˆ°<code class="fe ng nh ni nj b">kubectl apply</code>éå¸¸ç®€å•ã€‚</p><pre class="nw nx ny nz gt oa nj ob oc aw od bi"><span id="27dd" class="nk mc jb nj b gy oe of l og oh">$ sops -d &lt;ENCRYPTED_FILE&gt;.yaml | kubectl apply -f -</span></pre></div><div class="ab cl ok ol hu om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="ij ik il im in"><p id="b101" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">æ„Ÿè°¢æ‚¨éµå¾ªæœ¬æ•™ç¨‹ã€‚å¦‚æœè¿™æœ‰åŠ©äºæ‚¨è®¾ç½®Sopså®‰è£…ï¼Œè¯·è€ƒè™‘æä¾›ğŸ‘ã€‚</p><p id="f9ea" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">ä½œè€…:è‰¾ç±³è‰Â·å…°æ–¯æ´›ç‰¹</p><p id="f37b" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><a class="ae lm" href="https://stackoverflow.com/users/5512455/doctor" rel="noopener ugc nofollow" target="_blank">å †æ ˆæº¢å‡º</a></p><p id="5484" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">éœ€è¦Kubernetesä¸Šçš„æœåŠ¡åŠŸèƒ½ï¼Ÿä¸è¦å†è¯´äº†ï¼ç°åœ¨å°±ç»“å¸<a class="ae lm" href="https://github.com/rememberSoftwares/gitfaas" rel="noopener ugc nofollow" target="_blank"> Gitfaas </a>ï¼å¯¹æ‰€æœ‰äººå…è´¹ï¼Œå¯¹æ‰€æœ‰äººå¼€æºã€‚</p></div></div>    
</body>
</html>