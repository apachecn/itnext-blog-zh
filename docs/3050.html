<html>
<head>
<title>How to add persistent storage to your Kubernetes apps using Azure Disk</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•ä½¿ç”¨Azure Diskå‘æ‚¨çš„Kubernetesåº”ç”¨æ·»åŠ æŒä¹…å­˜å‚¨</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/how-to-add-persistent-storage-to-your-kubernetes-apps-using-azure-disk-5eb081c1a31?source=collection_archive---------2-----------------------#2019-09-23">https://itnext.io/how-to-add-persistent-storage-to-your-kubernetes-apps-using-azure-disk-5eb081c1a31?source=collection_archive---------2-----------------------#2019-09-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/9cd931e2b34723530f2732b9162fdeab.png" data-original-src="https://miro.medium.com/v2/resize:fit:256/format:webp/1*1Cc99RF4vtCSKaHDgz_iyQ.png"/></div></figure><p id="3257" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå¦‚ä½•ä½¿ç”¨<a class="ae ks" href="https://azure.microsoft.com/services/storage/disks/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> Azure Disk </a>ä½œä¸ºéƒ¨ç½²åˆ°<a class="ae ks" href="https://azure.microsoft.com/services/kubernetes-service/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> Azure KubernetesæœåŠ¡</a>çš„åº”ç”¨çš„å­˜å‚¨ä»‹è´¨ã€‚</p><p id="bb59" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">æ‚¨å°†:</p><ul class=""><li id="37ee" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr ky kz la lb bi translated">åœ¨Azureä¸Šè®¾ç½®Kubernetesé›†ç¾¤</li><li id="6f64" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">åˆ›å»ºä¸€ä¸ªAzureç£ç›˜å’Œç›¸åº”çš„<code class="fe lh li lj lk b">PersistentVolume</code></li><li id="41ef" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">ä¸ºåº”ç”¨ç¨‹åº<code class="fe lh li lj lk b">Deployment</code>åˆ›å»ºä¸€ä¸ª<code class="fe lh li lj lk b">PersistentVolumeClaim</code></li><li id="e9a7" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">æµ‹è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•ç«¯åˆ°ç«¯å·¥ä½œçš„</li></ul><h1 id="0614" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">æ¦‚è§‚</h1><p id="5f02" class="pw-post-body-paragraph ju jv iq jw b jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn mn kp kq kr ij bi translated">æ‚¨å¯ä»¥ä½¿ç”¨Kubernetes <code class="fe lh li lj lk b">Volume</code> sä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæä¾›å­˜å‚¨ã€‚Kubernetesæ”¯æŒå¤šç§ç±»å‹çš„å·ã€‚å°†å®ƒä»¬åˆ†ç±»çš„ä¸€ç§æ–¹æ³•å¦‚ä¸‹</p><ul class=""><li id="a7d2" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr ky kz la lb bi translated"><strong class="jw ir">çŸ­æš‚çš„</strong> â€” <code class="fe lh li lj lk b">Volume</code>ä¸<code class="fe lh li lj lk b">Pod</code>å¯¿å‘½ç´§å¯†ç›¸å…³(å¦‚<code class="fe lh li lj lk b">emptyDir</code>å·)ï¼Œå³å¦‚æœ<code class="fe lh li lj lk b">Pod</code>è¢«ç§»é™¤(å‡ºäºä»»ä½•åŸå› )ï¼Œå®ƒä»¬å°†è¢«åˆ é™¤ã€‚</li><li id="eaef" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><strong class="jw ir">æŒä¹…æ€§</strong> â€” <code class="fe lh li lj lk b">Volume</code>ç”¨äºé•¿æœŸå­˜å‚¨ï¼Œç‹¬ç«‹äº<code class="fe lh li lj lk b">Pod</code>æˆ–<code class="fe lh li lj lk b">Node</code>ç”Ÿå‘½å‘¨æœŸã€‚åœ¨æ‰˜ç®¡Kubernetesäº§å“çš„æƒ…å†µä¸‹ï¼Œè¿™å¯èƒ½æ˜¯<code class="fe lh li lj lk b">NFS</code>æˆ–åŸºäºäº‘çš„å­˜å‚¨ï¼Œå¦‚Azure KubernetesæœåŠ¡ã€Google Kuberneteså¼•æ“ç­‰ã€‚</li></ul><p id="221b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Kuberneteså¯ä»¥é€šè¿‡<code class="fe lh li lj lk b">static</code>æˆ–<code class="fe lh li lj lk b">dynamic</code>æ–¹å¼è¿›è¡Œé…ç½®ã€‚åœ¨â€œé™æ€â€æ¨¡å¼ä¸‹ï¼Œæ‰‹åŠ¨åˆ›å»ºå­˜å‚¨ä»‹è´¨ï¼Œä¾‹å¦‚Azureç£ç›˜ï¼Œç„¶åä½¿ç”¨å¦‚ä¸‹çš„<code class="fe lh li lj lk b">Pod</code>è§„èŒƒè¿›è¡Œå¼•ç”¨:</p><pre class="mo mp mq mr gt ms lk mt mu aw mv bi"><span id="1218" class="mw lm iq lk b gy mx my l mz na">volumes:<br/>        - name: azure<br/>            azureDisk:<br/>            kind: Managed<br/>            diskName: myAKSDisk<br/>            diskURI: /subscriptions/&lt;subscriptionID&gt;/resourceGroups/MC_myAKSCluster_myAKSCluster_eastus/providers/Microsoft.Compute/disks/myAKSDisk</span></pre><blockquote class="nb nc nd"><p id="2ddd" class="ju jv ne jw b jx jy jz ka kb kc kd ke nf kg kh ki ng kk kl km nh ko kp kq kr ij bi translated"><em class="iq">æˆ‘å¼ºçƒˆæ¨èé˜…è¯»å…³äºå¦‚ä½•</em> <a class="ae ks" href="https://docs.microsoft.com/azure/aks/azure-disk-volume?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> <em class="iq">â€œåœ¨Azure KubernetesæœåŠ¡(AKS)ä¸­æ‰‹åŠ¨åˆ›å»ºå’Œä½¿ç”¨å¸¦æœ‰Azureç£ç›˜çš„å·â€çš„ä¼˜ç§€æ•™ç¨‹</em> </a></p></blockquote><h1 id="ff19" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">æœ‰æ²¡æœ‰æ›´å¥½çš„åŠæ³•ï¼Ÿ</h1><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/bb1365afa141f04bd81a1306c3221c58.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*C3sS7kBW19Q_Setj.gif"/></div></figure><p id="fb34" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">åœ¨ä¸Šé¢çš„<code class="fe lh li lj lk b">Pod</code>æ¸…å•ä¸­ï¼Œå­˜å‚¨ä¿¡æ¯ç›´æ¥åœ¨<code class="fe lh li lj lk b">Pod</code>ä¸­æŒ‡å®š(ä½¿ç”¨<code class="fe lh li lj lk b">volumes</code>éƒ¨åˆ†)ã€‚è¿™æ„å‘³ç€å¼€å‘äººå‘˜éœ€è¦çŸ¥é“å­˜å‚¨ä»‹è´¨çš„æ‰€æœ‰ç»†èŠ‚ï¼Œä¾‹å¦‚åœ¨Azure Diskçš„æƒ…å†µä¸‹â€”â€”<code class="fe lh li lj lk b">diskName</code>ã€<code class="fe lh li lj lk b">diskURI</code>(ç£ç›˜èµ„æºURI)ï¼Œå®ƒæ˜¯<code class="fe lh li lj lk b">kind</code>(ç±»å‹)ã€‚è¿™é‡Œè‚¯å®šæœ‰æ”¹è¿›çš„ä½™åœ°ï¼Œå°±åƒè½¯ä»¶ä¸­çš„å¤§å¤šæ•°äº‹æƒ…ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨æŒä¹…å·å’ŒæŒä¹…å·å£°æ˜çš„æ¦‚å¿µï¼Œé€šè¿‡å¦ä¸€ä¸ªå±‚æ¬¡çš„é—´æ¥æˆ–æŠ½è±¡æ¥å®ç°ã€‚</p><p id="d8d8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">å…³é”®æ€æƒ³å›´ç»•ç€â€œèŒè´£åˆ†ç¦»â€ä»¥åŠå°†å­˜å‚¨åˆ›å»º/ç®¡ç†ä¸å…¶ä½¿ç”¨åˆ†ç¦»å¼€æ¥:</p><ul class=""><li id="688e" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr ky kz la lb bi translated">å½“ä¸€ä¸ªåº”ç”¨ç¨‹åºéœ€è¦æŒä¹…å­˜å‚¨æ—¶ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡åœ¨podè§„èŒƒä¸­â€œå£°æ˜â€æ¥è¯·æ±‚â€”â€”è¿™æ˜¯é€šè¿‡ä½¿ç”¨<code class="fe lh li lj lk b">PersistentVolumeClaim</code>æ¥å®Œæˆçš„</li><li id="a16a" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">å®é™…çš„å­˜å‚¨é…ç½®ï¼Œä¾‹å¦‚åˆ›å»ºAzureç£ç›˜(ä½¿ç”¨azure CLIã€é—¨æˆ·ç­‰)ã€‚)å¹¶åœ¨Kubernetesé›†ç¾¤ä¸­è¡¨ç¤ºå®ƒ(ä½¿ç”¨<code class="fe lh li lj lk b">PersistentVolume</code>)å¯ä»¥ç”±å¦ä¸€ä¸ªå®ä½“æ¥å®Œæˆï¼Œæ¯”å¦‚ç®¡ç†å‘˜</li></ul><p id="f66d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">è®©æˆ‘ä»¬çœ‹çœ‹è¿™æ˜¯æ€ä¹ˆå›äº‹ï¼</p><h1 id="ee25" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">å…ˆå†³æ¡ä»¶:</h1><p id="f93e" class="pw-post-body-paragraph ju jv iq jw b jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn mn kp kq kr ij bi translated">æ‚¨å°†éœ€è¦ä»¥ä¸‹å†…å®¹:</p><ul class=""><li id="e300" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr ky kz la lb bi translated"><a class="ae ks" href="https://docs.microsoft.com/azure/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">å¾®è½¯Azureè´¦æˆ·</a>â€”<a class="ae ks" href="https://azure.microsoft.com/free/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">æ³¨å†Œä¸€ä¸ªå…è´¹è´¦æˆ·å§ï¼</a></li><li id="c1da" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" href="https://azure.microsoft.com/services/kubernetes-service/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> Azure KubernetesæœåŠ¡(AKS)é›†ç¾¤</a>â€”â€”æœ¬åšå®¢å°†æŒ‡å¯¼æ‚¨åˆ›å»ºä¸€ä¸ªé›†ç¾¤</li><li id="d2c4" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">Azure CLIæˆ–Azure Cloud Shellâ€”â€”å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£…Azure CLI ï¼Œä½ å¯ä»¥é€‰æ‹©å®‰è£…å®ƒ(åº”è¯¥å¾ˆå¿«ï¼)æˆ–è€…ç›´æ¥ä»ä½ çš„æµè§ˆå™¨ä½¿ç”¨<a class="ae ks" href="https://azure.microsoft.com/features/cloud-shell/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> Azureäº‘å£³</a>ã€‚</li><li id="5135" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><code class="fe lh li lj lk b"><a class="ae ks" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" rel="noopener ugc nofollow" target="_blank">kubectl</a></code>ä¸ä½ çš„AKSé›†ç¾¤è¿›è¡Œäº¤äº’</li></ul><blockquote class="nb nc nd"><p id="fb9f" class="ju jv ne jw b jx jy jz ka kb kc kd ke nf kg kh ki ng kk kl km nh ko kp kq kr ij bi translated"><em class="iq">åœ¨ä½ çš„Macä¸Šï¼Œä½ å¯ä»¥å®‰è£…</em> <code class="fe lh li lj lk b"><em class="iq">kubectl</em></code> <em class="iq">å¦‚ä¸‹:</em></p></blockquote><pre class="mo mp mq mr gt ms lk mt mu aw mv bi"><span id="5f35" class="mw lm iq lk b gy mx my l mz na">curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s <a class="ae ks" href="https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/darwin/amd64/kubectl" rel="noopener ugc nofollow" target="_blank">https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/darwin/amd64/kubectl</a></span><span id="9d1b" class="mw lm iq lk b gy nj my l mz na">chmod +x ./kubectl</span><span id="a67f" class="mw lm iq lk b gy nj my l mz na">sudo mv ./kubectl /usr/local/bin/kubectl</span></pre><p id="1016" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">ä»£ç å¯ä»¥åœ¨GitHub çš„<a class="ae ks" href="https://github.com/abhirockzz/aks-azuredisk-static-pv" rel="noopener ugc nofollow" target="_blank">ä¸Šæ‰¾åˆ°ã€‚è¯·åœ¨ç»§ç»­ä¹‹å‰å…‹éš†è¯¥å­˜å‚¨åº“</a></p><pre class="mo mp mq mr gt ms lk mt mu aw mv bi"><span id="ff66" class="mw lm iq lk b gy mx my l mz na">git clone https://github.com/abhirockzz/aks-azuredisk-static-pv<br/>cd aks-azuredisk-static-pv</span></pre><h1 id="3d78" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">Kubernetesé›†ç¾¤è®¾ç½®</h1><p id="3ae7" class="pw-post-body-paragraph ju jv iq jw b jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn mn kp kq kr ij bi translated">ä½ åªéœ€è¦ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥åœ¨Azureä¸Šå»ºç«‹ä¸€ä¸ªKubernetesé›†ç¾¤ã€‚ä½†æ˜¯ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªèµ„æºç»„</p><pre class="mo mp mq mr gt ms lk mt mu aw mv bi"><span id="124b" class="mw lm iq lk b gy mx my l mz na">export AZURE_SUBSCRIPTION_ID=[to be filled]<br/>export AZURE_RESOURCE_GROUP=[to be filled]<br/>export AZURE_REGION=[to be filled] (e.g. southeastasia)</span></pre><p id="52d9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">åˆ‡æ¢åˆ°æ‚¨çš„å¥—é¤å¹¶è°ƒç”¨<code class="fe lh li lj lk b">az group create</code></p><pre class="mo mp mq mr gt ms lk mt mu aw mv bi"><span id="8a49" class="mw lm iq lk b gy mx my l mz na">az account set -s $AZURE_SUBSCRIPTION_ID<br/>az group create -l $AZURE_REGION -n $AZURE_RESOURCE_GROUP</span></pre><p id="5a74" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">æ‚¨ç°åœ¨å¯ä»¥è°ƒç”¨<code class="fe lh li lj lk b">az aks create</code>æ¥åˆ›å»ºæ–°çš„é›†ç¾¤</p><blockquote class="nb nc nd"><p id="89ca" class="ju jv ne jw b jx jy jz ka kb kc kd ke nf kg kh ki ng kk kl km nh ko kp kq kr ij bi translated">ä¸ºäº†ç®€å•èµ·è§ï¼Œä¸‹é¢çš„å‘½ä»¤åˆ›å»ºäº†ä¸€ä¸ªå•èŠ‚ç‚¹é›†ç¾¤ã€‚æ ¹æ®æ‚¨çš„è¦æ±‚éšæ„æ›´æ”¹è§„æ ¼</p></blockquote><pre class="mo mp mq mr gt ms lk mt mu aw mv bi"><span id="68f8" class="mw lm iq lk b gy mx my l mz na">export AKS_CLUSTER_NAME=[to be filled]</span><span id="c5e1" class="mw lm iq lk b gy nj my l mz na">az aks create --resource-group $AZURE_RESOURCE_GROUP --name $AKS_CLUSTER_NAME --node-count 1 --node-vm-size Standard_B2s --node-osdisk-size 30 --generate-ssh-keys</span></pre><p id="cd1d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">ä½¿ç”¨<code class="fe lh li lj lk b">az aks get-credentials</code>è·å–AKSé›†ç¾¤å‡­è¯â€”â€”å› æ­¤ï¼Œ<code class="fe lh li lj lk b">kubectl</code>ç°åœ¨å°†æŒ‡å‘æ‚¨çš„æ–°é›†ç¾¤ã€‚ä½ å¯ä»¥è¯å®è¿™ä¸€ç‚¹</p><pre class="mo mp mq mr gt ms lk mt mu aw mv bi"><span id="221f" class="mw lm iq lk b gy mx my l mz na">az aks get-credentials --resource-group $AZURE_RESOURCE_GROUP --name $AKS_CLUSTER_NAME</span><span id="a4d5" class="mw lm iq lk b gy nj my l mz na">kubectl get nodes</span></pre><blockquote class="nb nc nd"><p id="c179" class="ju jv ne jw b jx jy jz ka kb kc kd ke nf kg kh ki ng kk kl km nh ko kp kq kr ij bi translated"><em class="iq">å¦‚æœæ‚¨å¯¹ä½¿ç”¨</em><a class="ae ks" href="https://azure.microsoft.com/services/kubernetes-service/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"><em class="iq">Azure</em></a><em class="iq">å­¦ä¹ Kuberneteså’ŒContainersæ„Ÿå…´è¶£ï¼Œä¸€ä¸ªå¥½çš„èµ·ç‚¹æ˜¯ä½¿ç”¨æ–‡æ¡£ä¸­çš„</em> <a class="ae ks" href="https://docs.microsoft.com/azure/aks/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> <em class="iq">å¿«é€Ÿå…¥é—¨ã€æ•™ç¨‹å’Œä»£ç ç¤ºä¾‹</em> </a> <em class="iq">æ¥ç†Ÿæ‚‰è¯¥æœåŠ¡ã€‚æˆ‘ä¹Ÿå¼ºçƒˆæ¨èæŸ¥çœ‹ä¸€ä¸‹</em> <a class="ae ks" href="https://azure.microsoft.com/resources/kubernetes-learning-path/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> <em class="iq"> 50å¤©Kuberneteså­¦ä¹ è·¯å¾„</em> </a> <em class="iq">ã€‚é«˜çº§ç”¨æˆ·å¯èƒ½å¸Œæœ›å‚è€ƒ</em> <a class="ae ks" href="https://docs.microsoft.com/azure/aks/best-practices?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> <em class="iq"> Kubernetesæœ€ä½³å®è·µ</em> </a> <em class="iq">æˆ–è§‚çœ‹ä¸€äº›</em> <a class="ae ks" href="https://azure.microsoft.com/resources/videos/index/?services=kubernetes-service&amp;WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> <em class="iq">è§†é¢‘</em> </a> <em class="iq">ä»¥äº†è§£æ¼”ç¤ºã€ä¸»è¦ç‰¹æ€§å’ŒæŠ€æœ¯ä¼šè®®ã€‚</em></p></blockquote><h1 id="7843" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">ä¸ºæŒä¹…å­˜å‚¨åˆ›å»ºAzureç£ç›˜</h1><p id="f632" class="pw-post-body-paragraph ju jv iq jw b jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn mn kp kq kr ij bi translated">Azure Kubernetesé›†ç¾¤å¯ä»¥ä½¿ç”¨Azureç£ç›˜æˆ–Azureæ–‡ä»¶ä½œä¸ºæ•°æ®å·ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢Azureç£ç›˜ã€‚ä½ å¯ä»¥é€‰æ‹©ç”±æ ‡å‡†ç¡¬ç›˜æˆ–<a class="ae ks" href="https://docs.microsoft.com/azure/virtual-machines/windows/disks-types?WT.mc_id=medium-blog-abhishgu#premium-ssd" rel="noopener ugc nofollow" target="_blank">é«˜çº§å›ºæ€ç¡¬ç›˜</a>æ”¯æŒçš„<a class="ae ks" href="https://docs.microsoft.com/azure/virtual-machines/windows/disks-types?WT.mc_id=medium-blog-abhishgu#standard-hdd" rel="noopener ugc nofollow" target="_blank"> Azureç¡¬ç›˜</a></p><p id="cc6c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">è·å–AKSèŠ‚ç‚¹èµ„æºç»„</p><pre class="mo mp mq mr gt ms lk mt mu aw mv bi"><span id="724c" class="mw lm iq lk b gy mx my l mz na">AKS_NODE_RESOURCE_GROUP=$(az aks show --resource-group $AZURE_RESOURCE_GROUP --name $AKS_CLUSTER_NAME --query nodeResourceGroup -o tsv)</span></pre><p id="498e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">åœ¨èŠ‚ç‚¹èµ„æºç»„ä¸­åˆ›å»ºAzureç£ç›˜</p><pre class="mo mp mq mr gt ms lk mt mu aw mv bi"><span id="4d15" class="mw lm iq lk b gy mx my l mz na">export AZURE_DISK_NAME=&lt;enter-azure-disk-name&gt;</span><span id="4b2d" class="mw lm iq lk b gy nj my l mz na">az disk create --resource-group $AKS_NODE_RESOURCE_GROUP --name $AZURE_DISK_NAME --size-gb 2 --query id --output tsv</span></pre><blockquote class="nb nc nd"><p id="4035" class="ju jv ne jw b jx jy jz ka kb kc kd ke nf kg kh ki ng kk kl km nh ko kp kq kr ij bi translated"><em class="iq">æˆ‘ä»¬æ­£åœ¨åˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º2 GBçš„ç£ç›˜</em></p></blockquote><p id="8131" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">æ‚¨å°†è·å¾—Azureç£ç›˜çš„èµ„æºIDä½œä¸ºå“åº”ï¼Œè¿™å°†åœ¨ä¸‹ä¸€æ­¥ä½¿ç”¨</p><pre class="mo mp mq mr gt ms lk mt mu aw mv bi"><span id="ab56" class="mw lm iq lk b gy mx my l mz na">/subscriptions/3a06a10f-ae29-4242-b6a7-dda0ea91d342/resourceGroups/MC_testaks_foo-aks_southeastasia/providers/Microsoft.Compute/disks/my-test-disk</span></pre><h1 id="e159" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°Kubernetes</h1><p id="f593" class="pw-post-body-paragraph ju jv iq jw b jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn mn kp kq kr ij bi translated"><code class="fe lh li lj lk b">azure-disk-persistent-volume.yaml</code>æ–‡ä»¶åŒ…å«äº†<code class="fe lh li lj lk b">PersistentVolume</code>çš„è¯¦ç»†ä¿¡æ¯ã€‚æˆ‘ä»¬åˆ›å»ºå®ƒæ˜¯ä¸ºäº†åœ¨AKSé›†ç¾¤ä¸­æ˜ å°„Azureç£ç›˜ã€‚</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="nk nl l"/></div></figure><blockquote class="nb nc nd"><p id="0e79" class="ju jv ne jw b jx jy jz ka kb kc kd ke nf kg kh ki ng kk kl km nh ko kp kq kr ij bi translated"><em class="iq">æ³¨æ„ï¼Œå®¹é‡(</em> <code class="fe lh li lj lk b"><em class="iq">spec.capacity.storage</em></code> <em class="iq">)æ˜¯2 GBï¼Œä¸æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„Azureç£ç›˜çš„å®¹é‡ç›¸åŒ</em></p></blockquote><p id="81f7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">ç”¨Azureç£ç›˜ä¿¡æ¯æ›´æ–°<code class="fe lh li lj lk b">azure-disk-persistent-volume.yaml</code></p><ul class=""><li id="8c3f" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr ky kz la lb bi translated"><code class="fe lh li lj lk b">diskName</code> -æ‚¨ä¹‹å‰é€‰æ‹©çš„Azureç£ç›˜çš„åç§°</li><li id="a7fa" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><code class="fe lh li lj lk b">diskURI</code>-Azureç£ç›˜çš„èµ„æºID</li></ul><p id="b756" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">åˆ›å»º<code class="fe lh li lj lk b">PersistentVolume</code></p><pre class="mo mp mq mr gt ms lk mt mu aw mv bi"><span id="46f8" class="mw lm iq lk b gy mx my l mz na">kubectl apply -f azure-disk-persistent-volume.yaml</span><span id="dcf6" class="mw lm iq lk b gy nj my l mz na">persistentvolume/azure-disk-pv created</span></pre><p id="015d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»º<code class="fe lh li lj lk b">PersistentVolumeClaim</code>ï¼Œæˆ‘ä»¬å°†åœ¨<code class="fe lh li lj lk b">Pod</code>è§„èŒƒä¸­ä½¿ç”¨å®ƒä½œä¸ºå‚è€ƒ</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="nk nl l"/></div></figure><blockquote class="nb nc nd"><p id="de9c" class="ju jv ne jw b jx jy jz ka kb kc kd ke nf kg kh ki ng kk kl km nh ko kp kq kr ij bi translated"><em class="iq">æˆ‘ä»¬è¯·æ±‚2 GBçš„å­˜å‚¨ç©ºé—´(ä½¿ç”¨</em> <code class="fe lh li lj lk b"><em class="iq">resources.request.storage</em></code> <em class="iq"> ) </em></p></blockquote><p id="a839" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">è¦åˆ›å»ºå®ƒ:</p><pre class="mo mp mq mr gt ms lk mt mu aw mv bi"><span id="e1a5" class="mw lm iq lk b gy mx my l mz na">kubectl apply -f azure-disk-persistent-volume-claim.yaml</span><span id="f503" class="mw lm iq lk b gy nj my l mz na">persistentvolumeclaim/azure-disk-pvc created</span></pre><p id="1cdb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">æ£€æŸ¥<code class="fe lh li lj lk b">PersistentVolume</code></p><pre class="mo mp mq mr gt ms lk mt mu aw mv bi"><span id="3e21" class="mw lm iq lk b gy mx my l mz na">kubectl get pv/azure-disk-pv<br/></span><span id="c16e" class="mw lm iq lk b gy nj my l mz na">NAME  CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM    STORAGECLASS   REASON   AGE<br/>azure-disk-pv   2Gi        RWO            Retain           Bound    default/azure-disk-pvc            8m35s</span></pre><p id="e8ec" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">æ£€æŸ¥<code class="fe lh li lj lk b">PersistentVolumeClaim</code></p><pre class="mo mp mq mr gt ms lk mt mu aw mv bi"><span id="c45d" class="mw lm iq lk b gy mx my l mz na">kubectl get pvc/azure-disk-pvc</span><span id="05a5" class="mw lm iq lk b gy nj my l mz na">NAME             STATUS   VOLUME          CAPACITY   ACCESS MODES   STORAGECLASS   AGE<br/>azure-disk-pvc   Bound    azure-disk-pv   2Gi        RWO                           9m55s</span></pre><blockquote class="nb nc nd"><p id="f776" class="ju jv ne jw b jx jy jz ka kb kc kd ke nf kg kh ki ng kk kl km nh ko kp kq kr ij bi translated"><em class="iq">æ³¨æ„(åœ¨ä¸Šè¿°è¾“å‡ºçš„</em> <code class="fe lh li lj lk b"><em class="iq">STATUS</em></code> <em class="iq">éƒ¨åˆ†)çš„</em> <code class="fe lh li lj lk b"><em class="iq">PersistentVolume</em></code> <em class="iq">å’Œ</em> <code class="fe lh li lj lk b"><em class="iq">PersistentVolumeClaim</em></code> <em class="iq">æ˜¯ç›¸äº’</em> <code class="fe lh li lj lk b"><em class="iq">Bound</em></code> <em class="iq"/></p></blockquote><h1 id="2d56" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">è¯•éªŒ</h1><p id="1e70" class="pw-post-body-paragraph ju jv iq jw b jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn mn kp kq kr ij bi translated">ä¸ºäº†è¿›è¡Œæµ‹è¯•ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªç®€å•çš„Goåº”ç”¨ç¨‹åºã€‚å®ƒæ‰€åšçš„åªæ˜¯å°†æ—¥å¿—è¯­å¥æ¨é€åˆ°<code class="fe lh li lj lk b">/mnt/logs</code>ä¸­çš„ä¸€ä¸ªæ–‡ä»¶<code class="fe lh li lj lk b">logz.out</code>â€”â€”è¿™æ˜¯æŒ‚è½½åˆ°<code class="fe lh li lj lk b">Pod</code>ä¸­çš„è·¯å¾„</p><pre class="mo mp mq mr gt ms lk mt mu aw mv bi"><span id="ef90" class="mw lm iq lk b gy mx my l mz na">func main() {<br/>    ticker := time.NewTicker(3 * time.Second)<br/>    exit := make(chan os.Signal, 1)<br/>    signal.Notify(exit, syscall.SIGTERM, syscall.SIGINT)<br/>    for {<br/>        select {<br/>        case t := &lt;-ticker.C:<br/>            logToFile(t.String())<br/>        case &lt;-exit:<br/>            err := os.Remove(fileLoc + fileName)<br/>            if err != nil {<br/>                log.Println("unable to delete log file")<br/>            }<br/>            os.Exit(1)<br/>        }<br/>    }<br/>}</span></pre><p id="485b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">å°†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåˆ›å»ºä¸º<code class="fe lh li lj lk b">Deployment</code></p><pre class="mo mp mq mr gt ms lk mt mu aw mv bi"><span id="3e42" class="mw lm iq lk b gy mx my l mz na">kubectl apply -f app-deployment.yaml</span></pre><p id="64e0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œä½¿éƒ¨ç½²å¤„äº<code class="fe lh li lj lk b">Running</code>çŠ¶æ€</p><pre class="mo mp mq mr gt ms lk mt mu aw mv bi"><span id="feb2" class="mw lm iq lk b gy mx my l mz na">kubectl get pods -l=app=logz</span><span id="e001" class="mw lm iq lk b gy nj my l mz na">NAME                               READY   STATUS    RESTARTS   AGE<br/>logz-deployment-59b75bc786-wt98d   1/1     Running   0          15s</span></pre><p id="6f32" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">ä¸ºäº†ç¡®è®¤ï¼Œæ£€æŸ¥<code class="fe lh li lj lk b">Pod</code>ä¸­çš„<code class="fe lh li lj lk b">/mnt/logs/logz.out</code></p><pre class="mo mp mq mr gt ms lk mt mu aw mv bi"><span id="531b" class="mw lm iq lk b gy mx my l mz na">kubectl exec -it $(kubectl get pods -l=app=logz --output=jsonpath={.items..metadata.name}) -- tail -f /mnt/logs/logz.out</span></pre><p id="fd29" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">æ‚¨å°†æ¯3ç§’é’Ÿçœ‹åˆ°ä¸€æ¬¡æ—¥å¿—(åªæœ‰æ—¶é—´æˆ³)ã€‚è¿™æ˜¯å› ä¸ºAzureç£ç›˜å­˜å‚¨å·²ç»å®‰è£…åœ¨æ‚¨çš„<code class="fe lh li lj lk b">Pod</code>ä¸­</p><pre class="mo mp mq mr gt ms lk mt mu aw mv bi"><span id="4ef3" class="mw lm iq lk b gy mx my l mz na">2019-09-23 10:00:18.308746334 +0000 UTC m=+3.002071866<br/>2019-09-23 10:00:21.308779348 +0000 UTC m=+6.002104880<br/>2019-09-23 10:00:24.308771261 +0000 UTC m=+9.002096693<br/>2019-09-23 10:00:27.308778874 +0000 UTC m=+12.002104406<br/>2019-09-23 10:00:30.308804587 +0000 UTC m=+15.002130219</span></pre><p id="18ac" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">ä¸€æ—¦ä½ å®Œæˆäº†æµ‹è¯•ï¼Œä½ å¯ä»¥åˆ é™¤èµ„æºä»¥èŠ‚çœæˆæœ¬ã€‚</p><h1 id="a574" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">æ‰“æ‰«å«ç”Ÿ</h1><pre class="mo mp mq mr gt ms lk mt mu aw mv bi"><span id="b6d9" class="mw lm iq lk b gy mx my l mz na">az group delete --name $AZURE_RESOURCE_GROUP --yes --no-wait</span></pre><blockquote class="nb nc nd"><p id="2c90" class="ju jv ne jw b jx jy jz ka kb kc kd ke nf kg kh ki ng kk kl km nh ko kp kq kr ij bi translated"><em class="iq">è¿™å°†åˆ é™¤èµ„æºç»„</em>ä¸‹çš„æ‰€æœ‰èµ„æº</p></blockquote><p id="53d1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">è¿™ä¸ªåšå®¢åˆ°æ­¤ä¸ºæ­¢ï¼æ‚¨çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨æ ‡å‡†çš„KubernetesåŸè¯­(å¦‚<code class="fe lh li lj lk b">PersistentVolume</code>å’Œ<code class="fe lh li lj lk b">PersistentVolume</code>)å°†Azure Diskå®ä¾‹é™„åŠ å’Œå®‰è£…åˆ°åœ¨AKSä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚æ•¬è¯·å…³æ³¨æ›´å¤šå†…å®¹ğŸ˜ƒğŸ˜ƒ</p><p id="4f23" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">æˆ‘çœŸçš„å¸Œæœ›ä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œå¹¶ä»ä¸­å­¦åˆ°äº†ä¸€äº›ä¸œè¥¿ï¼å¦‚æœä½ åšäº†ï¼Œè¯·å–œæ¬¢å¹¶è·Ÿéšã€‚å¾ˆé«˜å…´é€šè¿‡<a class="ae ks" href="https://twitter.com/abhi_tweeter" rel="noopener ugc nofollow" target="_blank"> Twitter </a>è·å¾—åé¦ˆï¼Œæˆ–è€…å‘è¡¨è¯„è®ºğŸ‘‡ğŸ‘‡</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="nk nl l"/></div></figure></div></div>    
</body>
</html>