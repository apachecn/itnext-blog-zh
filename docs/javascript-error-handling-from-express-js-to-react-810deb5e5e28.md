# ä» Express.js åˆ° React çš„ JavaScript é”™è¯¯å¤„ç†

> åŸæ–‡ï¼š<https://itnext.io/javascript-error-handling-from-express-js-to-react-810deb5e5e28?source=collection_archive---------0----------------------->

## å› ä¸ºé”™è¯¯æ˜¯å¿…ç„¶ä¼šå‘ç”Ÿçš„ï¼Œæˆ‘ä»¬éœ€è¦æ­£ç¡®åœ°å¤„ç†å®ƒä»¬ã€‚

![](img/9bf320bb2389ea8d396f199eb6a82713.png)

ç…§ç‰‡ç”±[æ°ç±³è¡—](https://unsplash.com/@jamie452?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)åœ¨ [Unsplash](https://unsplash.com/s/photos/something-went-wrong?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

# ä»‹ç»

æˆ‘å·²ç»ç”¨äº†ä¸€æ•´å¥— [MERN (MySQLã€Expressã€React å’Œ Node.js)é¡¹ç›®](https://github.com/paigen11/mysql-registration-passport)æ¥å†™äº†ä¸€å¤§å †åšæ–‡ã€‚éšç€æˆ‘æ…¢æ…¢åœ°æ„å»ºå®ƒå¹¶æ·»åŠ æ›´å¤šçš„åŠŸèƒ½ï¼Œæˆ‘å­¦åˆ°äº†è®¸å¤šå€¼å¾—åˆ†äº«çš„æ–°ä¸œè¥¿ï¼Œä»¥å¸®åŠ©å…¶ä»–å¼€å‘äººå‘˜é¿å¼€æˆ‘åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­é‡åˆ°çš„éšœç¢ã€‚

è¿‡å»çš„ä¸»é¢˜åŒ…æ‹¬ä½¿ç”¨ [Sequelize](https://medium.com/@paigen11/sequelize-the-orm-for-sql-databases-with-nodejs-daa7c6d5aca3) ä½œä¸º MySQL æ•°æ®åº“çš„ ORMï¼Œä½¿ç”¨ [PassportJS å’Œ JWT](/implementing-json-web-tokens-passport-js-in-a-javascript-application-with-react-b86b1f313436) è¿›è¡Œè®¤è¯å’Œä¿æŠ¤è·¯ç”±ï¼Œä½¿ç”¨ [Nodemailer](/password-reset-emails-in-your-react-app-made-easy-with-nodemailer-bb27968310d7) é€šè¿‡ç”µå­é‚®ä»¶æä¾›å¯†ç é‡ç½®åŠŸèƒ½ï¼Œç­‰ç­‰ã€‚è€å®è¯´ï¼Œé€šè¿‡æ„å»ºè¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œåªæ˜¯ä¸ºäº†å­¦ä¹ æ›´å¤šçš„èŠ‚ç‚¹ã€æ›´å¤šçš„ååº”ã€æ›´å¤šçš„æ ¸å¿ƒ JavaScriptï¼Œæ•™ä¼šäº†æˆ‘å¾ˆå¤šã€‚

å¦‚æœä½ æƒ³çœ‹æˆ‘å…³äºè¿™ä¸ªå›è´­å’Œä»£ç æœ¬èº«çš„å…¶ä½™å¸–å­ï¼Œæˆ‘ä¼šåœ¨æœ¬æ–‡åº•éƒ¨é“¾æ¥åˆ°å®ƒä»¬ã€‚

ä»Šå¤©çš„å¸–å­ä¹Ÿä¸ä¾‹å¤–ã€‚

> ä»Šå¤©æˆ‘å°†è®¨è®ºå¦‚ä½•æ­£ç¡®å¤„ç† JavaScript åº”ç”¨ç¨‹åºä¸¤ç«¯çš„é”™è¯¯:ä»åœ¨ Express ä¸­çš„æœåŠ¡å™¨ç«¯æŠ›å‡ºé”™è¯¯ï¼Œåˆ°ä½¿ç”¨ React å’Œ Axios åœ¨å®¢æˆ·ç«¯æ•æ‰å’Œå¤„ç†é”™è¯¯ã€‚

# å¿«é€Ÿé”™è¯¯å¤„ç†

å› ä¸ºæœåŠ¡å™¨ç«¯æ˜¯å¤§å¤šæ•°é”™è¯¯å‘ç”Ÿçš„åœ°æ–¹ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿå°†ä» Node.js / Express æœåŠ¡å™¨ä»£ç å¼€å§‹ã€‚

æˆ‘å¿…é¡»æ‰¿è®¤ï¼Œåœ¨ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´é‡Œï¼Œåœ¨æ„å»ºè¿™ä¸ªåº”ç”¨ç¨‹åºçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä» Express æœåŠ¡å™¨ä¼ å›äº† [HTTP 200 çŠ¶æ€](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status)(OK çŠ¶æ€)ä»£ç ï¼Œå³ä½¿åœ¨æ•°æ®åº“ä¸­æ²¡æœ‰å‘ç°åƒä¸¢å¤± JWT ä»¤ç‰Œæˆ–ç”¨æˆ· ID è¿™æ ·çš„é”™è¯¯ã€‚

*ä¸å½“è¡¨è¾¾é”™è¯¯å¤„ç†ç¤ºä¾‹*

```
res.status(200).json('404 - no user exists in db to update');
```

æˆ‘è¿™æ ·åšæ˜¯å› ä¸ºæˆ‘ä¸ä»…æƒ³å‘é€ 401(æœªæˆæƒ)æˆ– 403(ç¦æ­¢)HTTP çŠ¶æ€ä»£ç ï¼Œè€Œä¸”è¿˜æƒ³å‘é€ä¸€æ¡ä¹¦é¢æ¶ˆæ¯ï¼Œè¯´æ˜æœåŠ¡å™¨ç«¯åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆé”™è¯¯ï¼Œåœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œï¼Œæˆ‘éƒ½æ‰¾ä¸åˆ°å¦‚ä½•ä½¿ç”¨ Express æ¥å®ç°è¿™ä¸¤ä¸ªç›®çš„ã€‚

è¦ä¹ˆé€šè¿‡`res.json('This is an error message the client can read')`å‘é€ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯ï¼Œå¸¦æœ‰ 200 HTTP çŠ¶æ€ï¼Œ*è¦ä¹ˆ*å‘é€ä¸€ä¸ª 401 æˆ– 403 HTTP çŠ¶æ€ï¼Œæ²¡æœ‰å…³äº`res.status(401)`å®é™…ä¸Šå‡ºäº†ä»€ä¹ˆé—®é¢˜çš„è¿›ä¸€æ­¥ä¿¡æ¯ã€‚

ç»ˆäºæœ‰ä¸€å¤©ï¼Œæˆ‘åœ¨ [Express æ–‡æ¡£](https://expressjs.com/en/guide/error-handling.html)ä¸­æ‰¾åˆ°äº†æˆ‘ä¸€ç›´åœ¨å¯»æ‰¾çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™ä¸ªæ–‡æ¡£æœ‰å¾ˆå¤šã€‚è¿™çœŸçš„æ²¡æœ‰æˆ‘æƒ³è±¡çš„é‚£ä¹ˆæ£˜æ‰‹â€”â€”è¿™ç±»ä¼¼äºå½“äº‹æƒ…è¿›å±•é¡ºåˆ©æ—¶æˆ‘å‘é€ä¸€æ¡æ¶ˆæ¯å’Œä¸€ä¸ª 200 HTTP çŠ¶æ€ï¼Œå°±åƒè¿™æ ·:

*å¿«é€’æˆåŠŸçŠ¶æ€ç æŠ¥æ–‡ç¤ºä¾‹*

```
res.status(200).send({ message: 'user created' });
```

æˆ‘å¯ä»¥ç”¨é”™è¯¯çŠ¶æ€å’Œæ¶ˆæ¯åšåŒæ ·çš„äº‹æƒ…ã€‚

*è¡¨ç¤ºæ•…éšœçŠ¶æ€ä»£ç å’Œä¿¡æ¯ç¤ºä¾‹*

```
res.status(401).send('no user exists in db to update');
```

ä»…ä»…é€šè¿‡ä» Express çš„`.json()`åˆ‡æ¢åˆ°`.send()`æ–¹æ³•ï¼Œå°±æ„å‘³ç€æˆ‘å¯ä»¥å°† HTTP é”™è¯¯ä»£ç *å’Œ*ä¿¡æ¯æ¶ˆæ¯é“¾æ¥åœ¨ä¸€èµ·ï¼Œä¾›å®¢æˆ·ç«¯è§£å¯†ï¼Œç„¶ååœ¨æµè§ˆå™¨ç«¯è¿›è¡Œé€‚å½“çš„å¤„ç†ã€‚ğŸ˜„

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ`[.send()](https://expressjs.com/en/api.html#res.send)`å¯ä»¥åœ¨ JavaScript ä¸­å¤„ç†å¯¹è±¡ã€å­—ç¬¦ä¸²æˆ–æ•°ç»„ã€‚æˆåŠŸæ¶ˆæ¯ç¤ºä¾‹æ˜¯ä¸€ä¸ªå…·æœ‰å±æ€§`message`çš„å¯¹è±¡ï¼Œè€Œå¤±è´¥å“åº”åªæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå› ä¸ºåœ¨æˆåŠŸå“åº”çš„æƒ…å†µä¸‹ï¼Œåƒæ¶ˆæ¯ã€JSON Web ä»¤ç‰Œæˆ–å…¶ä»–æ•°æ®å¯èƒ½ä¼šä»æœåŠ¡å™¨å‘é€åˆ°å®¢æˆ·æœºã€‚ç„¶è€Œï¼Œæˆ‘çš„é”™è¯¯åªéœ€è¦ä¸€ä¸ª HTTP å“åº”å’Œå­—ç¬¦ä¸²å½¢å¼çš„é”™è¯¯æ¶ˆæ¯ã€‚åªæ˜¯ä¸ºäº†è®©ä½ çŸ¥é“æœªæ¥ã€‚ğŸ™‚

ä¸‹é¢æ˜¯æˆ‘çš„åº”ç”¨ç¨‹åºä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ç«¯è·¯ç”±çš„ä¾‹å­ï¼Œå±•ç¤ºäº†å½“ç”¨æˆ·è¯•å›¾åœ¨ç™»å½•æ—¶æ›´æ–°ä»–ä»¬çš„ä¸ªäººä¿¡æ¯æ—¶å‘é€æˆåŠŸæˆ–å¤±è´¥çš„å®Œæ•´å®ç°ã€‚(æˆ‘é€‰æ‹©å°†å®ƒä½œä¸ºæ¥è‡ª VS ä»£ç çš„æ ¼å¼è‰¯å¥½ä¸”çªå‡ºæ˜¾ç¤ºçš„å›¾åƒå’Œå¯å¤åˆ¶çš„ä»£ç ç‰‡æ®µåŒ…å«åœ¨å†…)ã€‚

`updateUser.js`

![](img/237db5241f32f02799a0e1df7262b61f.png)

js æ˜¯æœåŠ¡å™¨ç«¯çš„è·¯ç”±ï¼Œå®ƒå¯ä»¥æ›´æ–°ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ä¸æ›´æ–°ã€‚

```
module*.*exports = (app) => {
  *app.put*('/updateUser', (req, res, next) => {
    *passport.authenticate*('jwt', { session: false }, (err, user, info) => {
      if (err) {
        console*.*error(err);
      }
      if (info !== undefined) {
        console*.*error(*info.*message);
        *res.status*(403)*.send*(*info.*message);
      } else {
        *User.findOne*({
          where: {
            username: *req.body.*username,
          },
        })*.then*((userInfo) => {
          if (userInfo != null) {
            console*.*log('user found in db');
            userInfo
              *.update*({
                first_name: *req.body.*first_name,
                last_name: *req.body.*last_name,
                email: *req.body.*email,
             })
            *.then*(() => {
              console*.*log('user updated');
              *res.status*(200)*.send*({ auth: true, message: 'user updated' });
            });
         } else {
          console*.*error('no user exists in db to update');
          *res.status*(401)*.send*('no user exists in db to update');
         }
       });
      }
    })(req, res, next);
  });
};
```

è®©æˆ‘å¿«é€Ÿåˆ†æä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶ä¸­å‘ç”Ÿäº†ä»€ä¹ˆã€‚

å½“è·¯ç”±è¢«ç‚¹å‡»æ—¶å‘ç”Ÿçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ PassportJS æ¥ç®¡å¹¶æ£€æŸ¥ç”¨æˆ·çš„ JSON Web ä»¤ç‰Œæ˜¯å¦å­˜åœ¨å’Œæœ‰æ•ˆï¼Œè¿™å‘ç”Ÿåœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶åœ¨å¦ä¸€ä¸ª[åšå®¢](/implementing-json-web-tokens-passport-js-in-a-javascript-application-with-react-b86b1f313436)å¸–å­ä¸­æ¶‰åŠï¼Œæ‰€ä»¥æˆ‘ç°åœ¨ä¸ä¼šæ·±å…¥è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚

ä¸€æ—¦ç”¨æˆ·é€šè¿‡äº†èº«ä»½éªŒè¯ï¼Œè¯¥è·¯ç”±å°±ä¼šå°è¯•åœ¨ MySQL æ•°æ®åº“ä¸­æ‰¾åˆ°é‚£ä¸ª`username`,å¦‚æœæ‰¾åˆ°äº†ï¼Œå°±ä¼šæ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶å‘å›ä¸€æ¡ HTTP status 200 çš„æˆåŠŸæ¶ˆæ¯å’Œä¸€æ¡`'user updated'`æ¶ˆæ¯ã€‚

å¦‚æœåœ¨æ•°æ®åº“ä¸­æ²¡æœ‰æ‰¾åˆ°`username`ï¼ŒæœåŠ¡å™¨ä¼šè®°å½•ç”¨æˆ·ä¸å­˜åœ¨çš„é”™è¯¯ï¼Œå¹¶å‘å› 401 HTTP çŠ¶æ€å’Œæ¶ˆæ¯`'no user exists in db to update'`ã€‚

è¿™å°±æ˜¯æ‚¨åœ¨æŸ¥çœ‹æ—¥å¿—æ—¶çœ‹åˆ°çš„æœåŠ¡å™¨ç«¯æ§åˆ¶å°ä¸Šè®°å½•çš„å†…å®¹ã€‚

## æœåŠ¡å™¨æ—¥å¿—ä¸­çš„é”™è¯¯å¿«é€ŸæŠ›å‡º

![](img/b0fc06f0427a44cc9378ea30e4f3a898.png)

å°†é”™è¯¯æ‰“å°åˆ°æœåŠ¡å™¨çš„æ§åˆ¶å°å¹¶å‘é€åˆ°å®¢æˆ·ç«¯

å°±é”™è¯¯å¤„ç†è€Œè¨€ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨çš„ä¸»è¦ä»£ç æ˜¯æ–‡ä»¶åº•éƒ¨çš„è¿™ä¸ªä»£ç å—ã€‚

![](img/8d5bcb147f97fc9254f9ff1ff8cbf6a6.png)

è´Ÿè´£å‘æµè§ˆå™¨å‘é€é”™è¯¯çŠ¶æ€å’Œæ¶ˆæ¯çš„ä»£ç ã€‚

è¿™å°±æ˜¯ä» Express å‘æµè§ˆå™¨æˆåŠŸå‘é€é”™è¯¯çŠ¶æ€ä»£ç å’Œæ¶ˆæ¯çš„å…¨éƒ¨å†…å®¹ã€‚ç°åœ¨æˆ‘ä»¬æ¥è°ˆè°ˆæµè§ˆå™¨æ˜¯å¦‚ä½•å¤„ç†è¿™äº›é”™è¯¯çš„ã€‚

# React & Axios é”™è¯¯å¤„ç†

å¯¹äºæˆ‘çš„å…¨æ ˆåº”ç”¨ç¨‹åºçš„å®¢æˆ·ç«¯ï¼Œæˆ‘é€‰æ‹©ä½¿ç”¨éå¸¸æµè¡Œçš„åŸºäº promise çš„ HTTP åº“ [Axios](https://www.npmjs.com/package/axios) ï¼Œè€Œä¸æ˜¯æµè§ˆå™¨çš„æœ¬æœº [fetch API](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch) ï¼Œå› ä¸ºæˆ‘å‘ç°å®ƒæ›´å®¹æ˜“ä½¿ç”¨ã€‚è¿™ä¸ªä¾‹å­å°†ä½¿ç”¨ Axios æ˜¾ç¤ºæ‰€æœ‰ HTTP è¯·æ±‚å’Œé”™è¯¯å¤„ç†ã€‚

æ­£å¦‚æˆ‘åœ¨æ…¢æ…¢æ”¹è¿›æœåŠ¡å™¨ç«¯çš„é”™è¯¯å¤„ç†ä¸€æ ·ï¼Œéšç€åº”ç”¨ç¨‹åºçš„å‘å±•å’Œæ”¹è¿›ï¼Œæˆ‘ä¹Ÿåœ¨æ”¹è¿›å®¢æˆ·ç«¯çš„é”™è¯¯å¤„ç†ã€‚

åœ¨æˆ‘æ­£ç¡®å¤„ç†æœåŠ¡å™¨æŠ›å‡ºçš„é”™è¯¯ä¹‹å‰ï¼Œæˆ‘æ‰€åšçš„å°±æ˜¯è§£é‡Šé”™è¯¯ã€‚

*å¯¹ä»æœåŠ¡å™¨å‘å®¢æˆ·ç«¯æŠ›å‡ºçš„é”™è¯¯å¤„ç†ä¸å½“çš„ä¾‹å­*

```
 .catch(error => {        
    console.log(error.data);             
    this.setState({         
      loadingUser: false,         
      error: true,       
    });
  });
```

æˆ‘ä¼šå°è¯•æ•æ‰ä¸€ä¸ªé”™è¯¯ï¼Œå°†å…¶æ¶ˆæ¯è®°å½•åˆ°æ§åˆ¶å°ï¼Œç„¶åç›¸åº”åœ°è®¾ç½® React åº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚å¯¹äºä¸€ä¸ªå¼€å§‹æ¥è¯´å¹¶ä¸å¯æ€•ï¼Œä½†æ˜¯å¯¹äºä¸€ä¸ªæœ€ç»ˆçš„è§£å†³æ–¹æ¡ˆæ¥è¯´ä¹Ÿä¸å¤ªå¥½â€”â€”å½“æˆ‘è¯•å›¾ç”¨ä¸€æ¡æ¶ˆæ¯æŠ›å‡ºä¸€ä¸ª 200 HTTP çŠ¶æ€ä¹‹å¤–çš„ä¸œè¥¿æ—¶ï¼Œå®¢æˆ·ç«¯å°±ä¼šåœ¨`catch()`å—ä¸­å´©æºƒã€‚

å°±åƒæœåŠ¡å™¨ç«¯ä¸€æ ·ï¼Œæˆ‘ç»ˆäºåŒå€¦äº†æˆ‘æ­£åœ¨åšçš„è¿™ç§åŠç”Ÿä¸ç†Ÿçš„é”™è¯¯å¤„ç†ï¼Œå¹¶æ‰¾åˆ°äº†ä¸€äº›æ›´å¥½çš„å…³äºåº“å¸Œæœ›ä½ å¦‚ä½•å¤„ç†é”™è¯¯çš„ Axios æ–‡æ¡£ï¼Œè¿™æ˜¯æˆ‘ä»¥å‰å¿½ç•¥çš„ã€‚

äº‹å®è¯æ˜ï¼Œä½¿ç”¨ Axios è¯»å–å’Œå¤„ç†é”™è¯¯çš„æ–¹æ³•å®é™…ä¸Šæ˜¯`error.response.data`ï¼Œè€Œä¸ä»…ä»…æ˜¯`catch()`å‡½æ•°ä¸­çš„`error.data`ã€‚å®ƒæ²¡æœ‰è¢«å¾ˆå¥½åœ°å¼ºè°ƒï¼Œä½†æ˜¯æ–‡æ¡£æŒ‡å‡º:

```
 catch(error => {
  if(error.response) { 
    /* the request was made and the server responded
    with a status code that falls out of the range of 2xx */
    console.log(error.response.data)
  }
}
```

æœ‰äº†è¿™ä¸€å‘ç°ï¼Œåœ¨å®¢æˆ·ç«¯æ•æ‰é”™è¯¯çªç„¶å˜å¾—æ›´åŠ å®¹æ˜“å’Œæ›´å…·æè¿°æ€§ã€‚

Axios è§£é‡Šæ¥è‡ªæœåŠ¡å™¨çš„æˆåŠŸå“åº”çš„æ–¹å¼ä¸è§£é‡Šé”™è¯¯ä»£ç çš„æ–¹å¼å‡ ä¹å®Œå…¨ç›¸åŒã€‚

*Axios æˆåŠŸå“åº”å¤„ç†*

```
try {      
  const response = await axios.get('api/findUser', {
    params: {          
      username,        
    },        
    headers: { Authorization: `JWT ${accessString}` },      
  });      
  console.log(response.data); 
  // this.setState and so on after response is received...
}
```

*Axios æ•…éšœå“åº”å¤„ç†*

```
catch (error) {      
  console.log(error.response.data);      
  this.setState({        
    loadingUser: false,        
    error: true,      
  });    
}
```

äº‹å®è¯æ˜ï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œæ›´æ–°æ‰€æœ‰çš„`catch()`å—ä»¥æ¥å—è¿™ç§æ–°çš„é”™è¯¯æ ¼å¼æ¯”æˆ‘é¢„æœŸçš„è¦å®¹æ˜“å¾—å¤šã€‚

åŒæ ·ï¼Œè¿™æ˜¯æ–‡ä»¶ä¸­çš„ä¸€ä¸ªå¤§ç‰‡æ®µï¼Œç”¨æˆ·ä»å®¢æˆ·ç«¯æ›´æ–°ä»–ä»¬çš„æ•°æ®ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚

`UpdateProfile.js`

![](img/4ff4c8572e4e5a6046254d12472c815e.png)

js æ˜¾ç¤ºäº†å‘é€åˆ°æœåŠ¡å™¨çš„å®¢æˆ·ç«¯æ›´æ–°è¯·æ±‚ï¼Œå®ƒå¯ä»¥å·¥ä½œï¼Œä¹Ÿå¯ä»¥ä¸å·¥ä½œã€‚

```
*updateUser* = *async* (e) => {
  const *accessString* = *localStorage.getItem*('JWT');
  if (accessString === null) {
    this*.setState*({
      loadingUser: false,
      error: true,
    });
  }
  const{
    *first_name*, *last_name*, *email*, *username* }= *this.state*;
  *e.preventDefault*();
  *try* {
    const *response* = *await axios.put*(
      'http://localhost:3003/updateUser',
      {
        first_name,
        last_name,
        email,
        username,
      },
      {
        *headers*:{ *Authorization*:`*JWT* ${accessString}`},
      },
    );
    // *eslint-disable-next-line no-unused-vars* console*.*log(*response.*data);
    this*.setState*({
      updated: true,
      error: false,
    });
  } *catch* (error) {
    console*.*log(*error.response.*data);
    this*.setState*({
      loadingUser: false,
      error: true,
    });
  }
};
```

ä¸‹é¢æ˜¯è¿™ä¸ªå‡½æ•°è°ƒç”¨ä¸­å‘ç”Ÿçš„æƒ…å†µã€‚

é¦–å…ˆï¼Œ`updateUser()`ä»å…ˆå‰æ·»åŠ çš„æœ¬åœ°å­˜å‚¨ä¸­å–å‡º JWT ä»¤ç‰Œã€‚

å¦‚æœæ‰¾åˆ°äº†ä»¤ç‰Œï¼ŒAxios å°†æ„å»ºåŒ…å«æ‰€æœ‰ç”¨æˆ·æ–°ä¿¡æ¯çš„ PUT è¯·æ±‚çš„`body`,å¹¶å°†`header`è®¾ç½®ä¸ºæœåŠ¡å™¨è®¤è¯æ‰€éœ€çš„ JWT ä»¤ç‰Œã€‚

æœ€åï¼Œå“åº”è¦ä¹ˆä»¥æˆåŠŸæ›´æ–°çš„å½¢å¼è¿”å›ï¼Œè¦ä¹ˆä»¥å¤±è´¥çš„å½¢å¼è¿”å›ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹,`error.response.data`è¢«è®°å½•åˆ°æ§åˆ¶å°ï¼Œä»¥å¸®åŠ©å¼€å‘äººå‘˜æ‰¾å‡ºé—®é¢˜æ‰€åœ¨ï¼Œåº”ç”¨ç¨‹åºçš„çŠ¶æ€è¢«è®¾ç½®ä¸º`error`,ä»¥å¸®åŠ©ç”¨æˆ·äº†è§£å‘ç”Ÿäº†ä»€ä¹ˆã€‚

è¿™æ˜¯å½“å¤±è´¥çš„è¯·æ±‚å‘å‡ºæ—¶ï¼Œå¦‚æœå¼€å‘å·¥å…·æ§åˆ¶å°æ˜¯æ‰“å¼€çš„ï¼Œç”¨æˆ·å°†ä¼šçœ‹åˆ°çš„ã€‚

## æ§åˆ¶å°æ—¥å¿—ä¸­å‡ºç°é”™è¯¯ååº”

![](img/a180e2116e5e4687d28b5029a724ddf0.png)

å¼€å‘äººå‘˜å°†åœ¨æµè§ˆå™¨çš„å¼€å‘äººå‘˜å·¥å…·æ§åˆ¶å°ä¸­çœ‹åˆ°çš„é”™è¯¯ã€‚

å®¢æˆ·æœºçœ‹åˆ°ç”¨æˆ·å‘å›çš„ 401 çŠ¶æ€ä»£ç ï¼Œä»¥åŠæ¥è‡ªæœåŠ¡å™¨çš„æ¶ˆæ¯ï¼Œè¡¨æ˜åœ¨æ•°æ®åº“ä¸­æ²¡æœ‰æ‰¾åˆ°å…·æœ‰åŒ¹é…ç”¨æˆ·åçš„ç”¨æˆ·ã€‚

å®ç°è¿™ä¸€ç‚¹çš„ä»£ç å°±æ˜¯è¿™æ®µä»£ç ã€‚

![](img/6700aaa4d2c1bf320b942d8d5ffaad9f.png)

è´Ÿè´£åœ¨å®¢æˆ·ç«¯è§£é‡Šå¹¶å¤„ç†é”™è¯¯çš„ä»£ç ã€‚

è¿™å°±ç»“æŸäº†æˆ‘å¯¹å®¢æˆ·æœºå¦‚ä½•å¤„ç†å’Œæ˜¾ç¤ºæœåŠ¡å™¨æŠ›å‡ºçš„é”™è¯¯çš„è§£é‡Šã€‚å†è¯´ä¸€æ¬¡ï¼Œè¿™å¹¶ä¸å¤ªéš¾ç†è§£ï¼Œä½†æ˜¯å°†æ‰€æœ‰è¿™äº›æ”¾åœ¨ä¸€èµ·æœ‰æ—¶ä¼šè¯æ˜æ˜¯æœ€æ£˜æ‰‹çš„éƒ¨åˆ†ã€‚

# ç»“è®º

ä»£ç ä¸­çš„é”™è¯¯å°±åƒæ­»äº¡å’Œç¨æ”¶ä¸€æ ·ï¼Œå®ƒä»¬æ³¨å®šä¼šå‘ç”Ÿã€‚ä½œä¸ºå¼€å‘äººå‘˜ï¼Œæˆ‘ä»¬çš„å·¥ä½œæ˜¯ç¡®ä¿æˆ‘ä»¬çŸ¥é“å®ƒä»¬ä½•æ—¶å‘ç”Ÿï¼Œå¹¶ä¼˜é›…åœ°å¤„ç†å®ƒä»¬ï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥å¯¹æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæœ‰è‰¯å¥½çš„ä½“éªŒã€‚

å°½ç®¡è¿™ç§ç±»å‹çš„äº‹æƒ…å¾ˆå¸¸è§å¹¶ä¸”éå¸¸é‡è¦ï¼Œä½†æ˜¯æœ‰æ—¶å…³äºè¿™ç§é”™è¯¯å¤„ç†çš„æ–‡æ¡£è¢«éšè—å¾—å¾ˆæ·±ï¼Œæˆ–è€…å¯¹äºæ‰€æä¾›çš„åŸºæœ¬ä»£ç ç‰‡æ®µæ¥è¯´æœ‰ç‚¹ç¥ç§˜ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»Šå¤©æƒ³è¯¦ç»†æè¿°æˆ‘æ˜¯å¦‚ä½•å°†é”™è¯¯ä»£ç å’Œæ¶ˆæ¯ä» Express ä¸€ç›´ä¼ é€’åˆ° React å‰ç«¯ä½¿ç”¨çš„ Axios åº“çš„åŸå› ã€‚

è¿‡å‡ å‘¨å†æ¥çœ‹çœ‹ï¼Œæˆ‘ä¼šå†™æ›´å¤šå…³äº JavaScriptã€Reactã€ES6 æˆ–å…¶ä»–ä¸ web å¼€å‘ç›¸å…³çš„ä¸œè¥¿ã€‚è·Ÿç€æˆ‘ï¼Œè¿™æ ·ä½ å°±ä¸ä¼šé”™è¿‡äº†ï¼

æ„Ÿè°¢æ‚¨çš„é˜…è¯»ï¼Œæˆ‘å¸Œæœ›æˆ‘å·²ç»ä¸ºæ‚¨æä¾›äº†ä¸€äº›å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œå¸®åŠ©æ‚¨å°†æ¥åœ¨è‡ªå·±çš„å…¨æ ˆ JavaScript åº”ç”¨ç¨‹åºä¸­å¤„ç†é”™è¯¯ã€‚ä¼šå‡ºç°é”™è¯¯ï¼Œè®©æˆ‘ä»¬å¥½å¥½å¤„ç†å®ƒä»¬ã€‚

å¦‚æœä½ å–œæ¬¢è¯»è¿™ç¯‡æ–‡ç« ï¼Œä½ å¯èƒ½ä¹Ÿä¼šå–œæ¬¢æˆ‘çš„å…¶ä»–ä½œå“:

*   [Sequelize:åƒçŒ«é¼¬ï¼Œä½†ä¸æ˜¯ SQL](https://medium.com/@paigen11/sequelize-the-orm-for-sql-databases-with-nodejs-daa7c6d5aca3)
*   [ä½¿ç”¨ Docker & Docker Compose æ”¹è¿›æ‚¨çš„å…¨æ ˆåº”ç”¨å¼€å‘](https://medium.com/@paigen11/using-docker-docker-compose-to-improve-your-full-stack-application-development-1e41280748f4)
*   [ç”¨ React](/implementing-json-web-tokens-passport-js-in-a-javascript-application-with-react-b86b1f313436) åœ¨ JavaScript åº”ç”¨ä¸­å®ç° JSON Web ä»¤ç‰Œ& Passport.js
*   [ä½¿ç”¨ Nodemailer ç®€åŒ– React åº”ç”¨ç¨‹åºä¸­çš„å¯†ç é‡ç½®ç”µå­é‚®ä»¶](/password-reset-emails-in-your-react-app-made-easy-with-nodemailer-bb27968310d7)
*   [åœ¨ JavaScript åº”ç”¨ç¨‹åºä¸­è®¾ç½® Swagger è¿›è¡Œ API æµ‹è¯•](/setting-up-swagger-in-a-node-js-application-d3c4d7aa56d4)
*   [ESLint å¦‚ä½•è®©æˆ‘æˆä¸ºæ›´å¥½çš„ React å¼€å‘äººå‘˜](/how-eslint-makes-me-a-better-react-developer-237fb14c00ae)

# å‚è€ƒèµ„æ–™å’Œæ›´å¤šèµ„æº

*   https://github.com/paigen11/mysql-registration-passport github repoã€MERN stack ç”¨æˆ·æ³¨å†Œé¡¹ç›®:
*   HTTP å“åº”çŠ¶æ€ä»£ç ï¼ŒMDN æ–‡æ¡£:[https://developer.mozilla.org/en-US/docs/Web/HTTP/Status](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status)
*   Axiosï¼Œé”™è¯¯å¤„ç†æ–‡æ¡£:ã€https://github.com/axios/axios#handling-errors 
*   å¿«é€’ï¼Œé”™è¯¯å¤„ç†æ–‡æ¡£:ã€https://expressjs.com/en/guide/error-handling.html 