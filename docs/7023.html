<html>
<head>
<title>A Complete Guide to gRPC-Web with Angular and .NET</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">gRPC-Webå¸¦è§’åº¦å’Œè§’åº¦çš„å®Œå…¨æŒ‡å—ã€‚ç½‘</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/a-complete-guide-to-grpc-web-with-angular-and-net-c4ae2500bd24?source=collection_archive---------0-----------------------#2022-05-19">https://itnext.io/a-complete-guide-to-grpc-web-with-angular-and-net-c4ae2500bd24?source=collection_archive---------0-----------------------#2022-05-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/00fe9d3f50b6b6889ff43797a3410bf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wmjrR1fmiUZf9umQn4QOiA.png"/></div></div></figure><p id="67f3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">åœ¨æœ¬å¸–ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªgRPCæ¼”ç¤ºï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªä½¿ç”¨ç½‘å…³çš„æœåŠ¡å™¨å’Œä¸¤ä¸ªå®¢æˆ·ç«¯ã€‚å‡€ï¼Œæœ‰è§’)ã€‚æˆ‘ä»¬è¿˜å°†è®¨è®ºåœ¨æ„å»ºgRPCæœåŠ¡å™¨å’Œå®¢æˆ·æœºæ—¶å¯èƒ½ä¼šé‡åˆ°çš„ä¸€äº›å¸¸è§é—®é¢˜ã€‚</p><h2 id="c3b6" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated"><strong class="ak">ä»€ä¹ˆæ˜¯gRPCï¼Ÿ</strong></h2><p id="14f8" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾ä¸€ç§æé«˜åº”ç”¨ç¨‹åºæ€§èƒ½çš„æ–¹æ³•ï¼Œæ‚¨å¯èƒ½ä¼šè€ƒè™‘ä½¿ç”¨gRPCã€‚gRPCæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€å¼€æºçš„é€šç”¨RPCæ¡†æ¶ï¼Œå¯ä»¥åœ¨ä»»ä½•ç¯å¢ƒä¸­è¿è¡Œã€‚gRPCåŸºäºè¿œç¨‹è¿‡ç¨‹è°ƒç”¨(RPC)çš„æ¦‚å¿µã€‚RPCæ˜¯ä¸¤ä¸ªç³»ç»Ÿä¹‹é—´å…è®¸å®ƒä»¬äº¤æ¢ä¿¡æ¯çš„ä¸€ç§é€šä¿¡æ–¹æ³•ã€‚å®ƒä¹Ÿæ˜¯è¯­è¨€ä¸å¯çŸ¥çš„ï¼Œå› æ­¤æ‚¨å¯ä»¥å°†å®ƒç”¨äºä»»ä½•ç¼–ç¨‹è¯­è¨€ï¼Œå¹¶ä½¿æ„å»ºè¿æ¥ç³»ç»Ÿå˜å¾—å®¹æ˜“ã€‚</p><p id="6a1d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">GRPCä½¿ç”¨HTTP/2ä½œä¸ºå®ƒçš„ä¼ è¾“å±‚ï¼Œä¸ä¼ ç»Ÿçš„HTTP/1.1ç›¸æ¯”ï¼Œå®ƒæœ‰å‡ ä¸ªä¼˜ç‚¹ã€‚HTTP/2æ˜¯ä¸€ç§äºŒè¿›åˆ¶åè®®ï¼Œå®ƒé€šè¿‡å•ä¸ªè¿æ¥å¤šè·¯ä¼ è¾“è¯·æ±‚å’Œå“åº”ï¼Œå¹¶ä½¿ç”¨æŠ¥å¤´å‹ç¼©æ¥å‡å°‘å¼€é”€ã€‚è¿™ä½¿å¾—å®ƒæ¯”HTTP/1.1æ›´æœ‰æ•ˆï¼Œå¹¶å…è®¸æ›´ä½çš„å»¶è¿Ÿå’Œæ›´é«˜çš„ååé‡ã€‚</p><p id="125d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¦å¤–ï¼ŒGRPCä½¿ç”¨<a class="ae lu" href="https://developers.google.com/protocol-buffers" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">åè®®ç¼“å†²åŒº</strong> </a>ä½œä¸ºå…¶æ¥å£æè¿°è¯­è¨€ã€‚è¿™å…è®¸è¿›è¡Œå¼ºç±»å‹æ£€æŸ¥å’Œé«˜æ•ˆçš„æ•°æ®åºåˆ—åŒ–ã€‚å®ƒè¿˜ä½¿å¾—APIéšç€æ—¶é—´çš„æ¨ç§»è€Œå‘å±•å˜å¾—å®¹æ˜“ï¼Œè€Œä¸ä¼šç ´åå‘åå…¼å®¹æ€§ã€‚</p><p id="3752" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ä½¿ç”¨Grpcæœ‰è®¸å¤šå¥½å¤„ï¼Œä½†å…¶ä¸­ä¸€äº›æœ€æ˜¾è‘—çš„å¥½å¤„åŒ…æ‹¬:</p><blockquote class="lv lw lx"><p id="1715" class="jy jz ly ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated"><strong class="ka ir">è½»é‡çº§æ¶ˆæ¯ã€‚</strong>æ ¹æ®è°ƒç”¨çš„ç±»å‹ï¼Œç‰¹å®šäºgRPCçš„æ¶ˆæ¯åœ¨å¤§å°ä¸Šæ¯”JSONæ¶ˆæ¯å°30%<a class="ae lu" href="https://auth0.com/blog/beating-json-performance-with-protobuf/#:~:text=JSON%20messages%20are%20exchanged%20in,define%20and%20exchange%20these%20messages." rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"/></a>ã€‚</p><p id="2ea4" class="jy jz ly ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated"><strong class="ka ir">é«˜æ€§èƒ½</strong>ã€‚é€šè¿‡ä¸åŒçš„è¯„æµ‹ï¼ŒgRPCæ¯”REST+JSONé€šä¿¡å¿«<a class="ae lu" href="https://dzone.com/articles/is-protobuf-5x-faster-than-json" rel="noopener ugc nofollow" target="_blank"> 5 </a>ã€<a class="ae lu" href="https://medium.com/@EmperorRXF/evaluating-performance-of-rest-vs-grpc-1b8bdf0b22da" rel="noopener"> 7 </a>ï¼Œç”šè‡³<a class="ae lu" href="https://docs.microsoft.com/en-us/dotnet/architecture/cloud-native/grpc" rel="noopener ugc nofollow" target="_blank"> 8 </a>å€ã€‚</p><p id="343c" class="jy jz ly ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated"><strong class="ka ir">å†…ç½®ä»£ç ç”Ÿæˆ</strong>ã€‚gRPCæ‹¥æœ‰ä¸åŒç¼–ç¨‹è¯­è¨€çš„è‡ªåŠ¨åŒ–ä»£ç ç”Ÿæˆï¼ŒåŒ…æ‹¬<a class="ae lu" href="https://www.altexsoft.com/blog/engineering/pros-and-cons-of-java-programming/" rel="noopener ugc nofollow" target="_blank"> Java </a>ï¼ŒC++ï¼ŒPythonï¼ŒGoï¼Œ<a class="ae lu" href="https://www.altexsoft.com/blog/engineering/pros-and-cons-of-flutter-app-development/" rel="noopener ugc nofollow" target="_blank"> Dart </a>ï¼Œ<a class="ae lu" href="https://www.altexsoft.com/blog/engineering/swift-vs-objective-c-out-with-the-old-in-with-the-new/" rel="noopener ugc nofollow" target="_blank"> Objective-C </a>ï¼ŒRubyç­‰ç­‰ã€‚"</p><p id="9fd8" class="jy jz ly ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated"><strong class="ka ir">æ›´å¤šè¿æ¥é€‰é¡¹</strong>ã€‚RESTå…³æ³¨äºè¯·æ±‚-å“åº”æ¶æ„ï¼Œè€ŒgRPCé€šè¿‡äº‹ä»¶é©±åŠ¨çš„æ¶æ„ä¸º<a class="ae lu" href="https://www.altexsoft.com/blog/real-time-analytics/" rel="noopener ugc nofollow" target="_blank">æ•°æ®æµ</a>æä¾›æ”¯æŒ:æœåŠ¡å™¨ç«¯æµã€å®¢æˆ·ç«¯æµå’ŒåŒå‘æµ</p></blockquote><p id="4cfc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æ¥æº:<a class="ae lu" href="https://www.altexsoft.com/blog/what-is-grpc/" rel="noopener ugc nofollow" target="_blank">https://www.altexsoft.com/blog/what-is-grpc/</a></p><p id="19fc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªgRPCæœåŠ¡å™¨ã€‚NETå’Œä¸¤ä¸ªå®¢æˆ·ç«¯(Angularï¼Œã€‚NET)åœ¨æœ¬æ–‡ä¸­ã€‚</p><p id="dcf1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å› ä¸ºè®¸å¤šæµè§ˆå™¨çš„å®¢æˆ·ç«¯ä¸æ”¯æŒgRPCï¼Œæˆ‘ä»¬å°†ä¸ºgRPC-webé…ç½®æˆ‘ä»¬çš„æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼Œè¿™ä¸gRPCä¸åŒã€‚å®ƒåªå­˜åœ¨äºæµè§ˆå™¨ä¸­ï¼Œåœ¨æµè§ˆå™¨ä¸­å……å½“gRPCå’Œæ‚¨çš„åº”ç”¨ç¨‹åºä¹‹é—´çš„è½¬æ¢å±‚ã€‚gRPC-webä¸­çš„â€œWebâ€å®¢æˆ·æœºé€šè¿‡HTTP 1.1æˆ–HTTP/2æ¥æ”¶è¯·æ±‚ï¼Œç„¶åé€šè¿‡ä»£ç†å‘é€è¯·æ±‚ã€‚ä½ å¯ä»¥åœ¨<a class="ae lu" href="https://blog.getambassador.io/understanding-grpc-and-grpc-web-8a4d43f58480" rel="noopener ugc nofollow" target="_blank">è¿™ç¯‡</a>å¸–å­ä¸­æ‰¾åˆ°æ›´å¤šç»†èŠ‚ã€‚</p><h2 id="c9dd" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated"><strong class="ak">ç”¨æ„å»ºgRPCæœåŠ¡å™¨ã€‚ç½‘ç»œ</strong></h2><p id="014d" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ã€‚NETåº”ç”¨ç¨‹åºï¼Œä»£ç å†™åœ¨ä¸‹é¢ã€‚</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="59f6" class="kw kx iq mh b gy ml mm l mn mo">dotnet new web -o gRPC.Web.Server</span></pre><p id="98bb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç„¶åï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…Grpcã€‚AspNetCoreå’ŒGrpcã€‚AspNetCoreæ‰“åŒ…åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œä»¥ä¾¿èƒ½å¤Ÿä½¿ç”¨Grpcç‰¹æ€§ã€‚</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="da67" class="kw kx iq mh b gy ml mm l mn mo">dotnet add gRPC.Web.Server.csproj package Grpc.AspNetCore<br/>dotnet add gRPC.Web.Server.csproj package Grpc.AspNetCore.Web</span></pre><h2 id="453e" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated"><strong class="ak">åˆ›å»ºåŸå‹æ–‡ä»¶</strong></h2><p id="1c76" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">ä¼—æ‰€å‘¨çŸ¥ï¼ŒgRPCä½¿ç”¨ã€‚protoæ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®šä¹‰æˆ‘ä»¬çš„protobufæ–‡ä»¶ï¼Œä¾›å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä½¿ç”¨ã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸ºâ€œProtosâ€çš„ç›®å½•ï¼Œå¹¶åœ¨é‚£é‡Œåˆ›å»ºä¸€ä¸ªåä¸ºâ€œstream.protoâ€çš„ç®€å•protobufæ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="90d1" class="kw kx iq mh b gy ml mm l mn mo">syntax = "proto3";<br/><br/>service StreamService {<br/>  rpc FetchResponse (Request) returns (stream Response) {}<br/>}<br/><br/>message Request {<br/>  int32 id = 1;<br/>}<br/><br/>message Response {<br/>  string result = 1;<br/>}</span></pre><p id="5c55" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºprotoæ–‡ä»¶çš„ä¿¡æ¯ï¼Œä½ å¯ä»¥è®¿é—®è¿™ä¸ªèµ„æºã€‚</p><p id="cf81" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">åˆ›å»ºåŸå‹æ–‡ä»¶åï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶å®šä¹‰åˆ°æˆ‘ä»¬çš„ã€‚csprojæ–‡ä»¶å°†èƒ½å¤Ÿä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥ç»§æ‰¿å’Œè¦†ç›–ã€‚</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="81e9" class="kw kx iq mh b gy ml mm l mn mo">&lt;ItemGroup&gt;</span><span id="c760" class="kw kx iq mh b gy mp mm l mn mo">    &lt;Protobuf Include="Protos\stream.proto" GrpcServices="Server" /&gt;</span><span id="6b1a" class="kw kx iq mh b gy mp mm l mn mo">&lt;/ItemGroup&gt;</span></pre><blockquote class="lv lw lx"><p id="1370" class="jy jz ly ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated">æ³¨æ„:é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code class="fe mq mr ms mh b">&lt;Protobuf&gt;</code>å¼•ç”¨ç”Ÿæˆä¸€ä¸ªå…·ä½“çš„å®¢æˆ·ç«¯å’Œä¸€ä¸ªæœåŠ¡åŸºç±»ã€‚å¼•ç”¨å…ƒç´ çš„<code class="fe mq mr ms mh b">GrpcServices</code>å±æ€§å¯ä»¥ç”¨æ¥é™åˆ¶C#èµ„äº§çš„ç”Ÿæˆã€‚æœ‰æ•ˆçš„<code class="fe mq mr ms mh b">GrpcServices</code>é€‰é¡¹æœ‰:ä¸¤è€…(ä¸å­˜åœ¨æ—¶é»˜è®¤)ã€æœåŠ¡å™¨ã€å®¢æˆ·ç«¯å’Œæ— ã€‚</p></blockquote><p id="b316" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">åœ¨æ‰§è¡Œäº†<strong class="ka ir"> dotnet build </strong>å‘½ä»¤åï¼Œæˆ‘ä»¬åº”è¯¥ä¼šçœ‹åˆ°obj/Debug/net*æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆçš„ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/c4c43c62aa33bc550ae28bfa9f3bfa28.png" data-original-src="https://miro.medium.com/v2/resize:fit:632/format:webp/1*GhAiGxdHWp14L4zevOL0Rw.png"/></div></figure><h2 id="ba69" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">å®ç°ç”Ÿæˆçš„ç±»</h2><p id="708b" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">è®©æˆ‘ä»¬åˆ›å»ºå®ç°æˆ‘ä»¬çš„æœåŠ¡æ–¹æ³•çš„<code class="fe mq mr ms mh b">StreamImplService</code>ã€‚<code class="fe mq mr ms mh b">FetchResponse</code>æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ç«¯çš„æµRPCï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å‘æˆ‘ä»¬çš„å®¢æˆ·ç«¯å‘å›å¤šä¸ª<code class="fe mq mr ms mh b">Response</code>åè®®ç¼“å†²åŒºã€‚</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="23b6" class="kw kx iq mh b gy ml mm l mn mo">using Grpc.Core;<br/><br/>public class StreamImplService: StreamService.StreamServiceBase {<br/>    <br/>    private readonly List&lt;string&gt; _messages = new List&lt;string&gt;()<br/>    {<br/>      "Hello",<br/>      "World",<br/>      "!"<br/>    };<br/>    <br/>    public override async Task FetchResponse(<br/>        Request request, <br/>        IServerStreamWriter&lt;Response&gt; responseStream, <br/>        ServerCallContext context)<br/>    {<br/>        while (!context.CancellationToken.IsCancellationRequested)<br/>        {<br/>            foreach (var message in _messages)<br/>            {<br/>                await responseStream.WriteAsync(new Response()<br/>                {<br/>                    Result = message<br/>                });<br/><br/>                Thread.Sleep(750);<br/>            }<br/>        }<br/>    }<br/>}</span></pre><p id="5379" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘ä»¬æ²¡æœ‰è¿”å›ç®€å•çš„å“åº”ï¼Œè€Œæ˜¯ä½¿ç”¨å¼‚æ­¥æ–¹æ³•<code class="fe mq mr ms mh b">WriteAsync</code>å°†å“åº”å†™å…¥å¼‚æ­¥æµ<code class="fe mq mr ms mh b">IServerStreamWriter</code>ï¼ŒåŒæ—¶ä¸è¯·æ±‚å–æ¶ˆä»¤ç‰Œã€‚æˆ‘ä»¬çš„è¯·æ±‚æ¨¡å‹åŒ…å«ä¸€ä¸ªIdå±æ€§ï¼Œä½†æ˜¯æ­¤æ—¶æˆ‘ä¸ä¼šå¯¹è¿™ä¸ªå€¼åšä»»ä½•äº‹æƒ…ã€‚</p><p id="32fc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æˆ‘ä»¬éœ€è¦å¦‚ä¸‹é…ç½®Program.cs(ä»¥å‰ç‰ˆæœ¬ä¸ºStartup.cs)ã€‚</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="ace7" class="kw kx iq mh b gy ml mm l mn mo">var builder = WebApplication.CreateBuilder(args);<br/><br/>builder.Services.AddGrpc();</span><span id="9609" class="kw kx iq mh b gy mp mm l mn mo">var app = builder.Build();</span><span id="22f0" class="kw kx iq mh b gy mp mm l mn mo">app.UseGrpcWeb();<br/><br/>app.MapGrpcService&lt;StreamImplService&gt;().EnableGrpcWeb();<br/><br/>app.Run();</span></pre><blockquote class="lv lw lx"><p id="fea6" class="jy jz ly ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated">å¯¹äºä»¥å‰çš„ç‰ˆæœ¬:</p></blockquote><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="07df" class="kw kx iq mh b gy ml mm l mn mo">services.AddGrpc();</span><span id="9f5e" class="kw kx iq mh b gy mp mm l mn mo">app.UseGrpcWeb();</span><span id="f61c" class="kw kx iq mh b gy mp mm l mn mo">app.UseEndpoints(endpoints =&gt;<br/>            {</span><span id="18e7" class="kw kx iq mh b gy mp mm l mn mo">                endpoints.MapGrpcService&lt;StreamImplService&gt;().EnableGrpcWeb();</span><span id="db56" class="kw kx iq mh b gy mp mm l mn mo">           });</span></pre><blockquote class="lv lw lx"><p id="2dd1" class="jy jz ly ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated"><a class="ae lu" href="https://docs.microsoft.com/en-Us/aspnet/core/grpc/troubleshoot?view=aspnetcore-6.0#unable-to-start-aspnet-core-grpc-app-on-macos" rel="noopener ugc nofollow" target="_blank">æ ¹æ®å¾®è½¯</a> gRPCæ¨¡æ¿é»˜è®¤ä½¿ç”¨TLSï¼Œè€ŒKestrelåœ¨macOSç³»ç»Ÿä¸Šä¸æ”¯æŒå¸¦TLSçš„HTTP/2ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è¯´macOSä¸æ”¯æŒå¸¦TLSçš„ASP.NETæ ¸å¿ƒgRPCï¼Œéœ€è¦é¢å¤–çš„é…ç½®æ‰èƒ½ä½¿ç”¨HTTP2ã€‚<strong class="ka ir">æ³¨æ„:å¦‚æœä½ æƒ³ä½¿ç”¨gRPC-webï¼Œè¿™ä¸ªé…ç½®åªé€‚ç”¨äºgRPCï¼Œå› ä¸ºåœ¨è¿™ç¯‡æ–‡ç« ä¸­æ²¡æœ‰å¿…è¦è¿™æ ·åšã€‚</strong></p></blockquote><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="9273" class="kw kx iq mh b gy ml mm l mn mo">using Microsoft.AspNetCore.Server.Kestrel.Core;<br/><br/>var builder = WebApplication.CreateBuilder(args);<br/><br/>builder.Services.AddGrpc();<br/><br/>builder.WebHost.ConfigureKestrel(options =&gt;<br/>{<br/>    <em class="ly">// Setup a HTTP/2 endpoint without TLS.<br/>    </em>options.ListenLocalhost(7264, o =&gt; o.Protocols =  HttpProtocols.<strong class="mh ir">Http2</strong>);<br/>});<br/><br/>var app = builder.Build();<br/><br/>app.UseGrpcWeb();<br/><br/>app.MapGrpcService&lt;StreamImplService&gt;().EnableGrpcWeb();<br/><br/>app.Run();</span></pre><blockquote class="lv lw lx"><p id="6131" class="jy jz ly ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated">ğŸ’¡ç”Ÿäº§ä¸­ä¸è¦è¿™æ ·ï¼è¿™ä»…ç”¨äºæœ¬åœ°å¼€å‘ç›®çš„ã€‚</p></blockquote><p id="11d5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æˆ‘ä»¬è¿˜éœ€è¦é…ç½®SSLä¿¡ä»»:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="04da" class="kw kx iq mh b gy ml mm l mn mo">dotnet dev-certs https --trust</span></pre><p id="fc0a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æœ€åï¼Œæˆ‘ä»¬å‡†å¤‡å¥½æ¥å—è¯·æ±‚ã€‚</p><h2 id="abff" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated"><strong class="ak">ç”¨Kreyaè°ƒç”¨gRPC API</strong></h2><p id="9ceb" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">å› ä¸ºæˆ‘ä»¬ä¸èƒ½ç”¨Postmanæˆ–å…¶ä»–ä¼ ç»Ÿçš„æ–¹æ³•å‘gRPC APIså‘é€è¯·æ±‚ï¼Œæ‰€ä»¥ä½ å¯èƒ½åœ¨å¯»æ‰¾ä¸€ä¸ªåƒPostmanä¸€æ ·å¯ä»¥å¸®åŠ©ä½ æµ‹è¯•/è°ƒè¯•çš„å·¥å…·ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒKreyaå¯èƒ½æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p><p id="0742" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">é¦–å…ˆä½ éœ€è¦ä»ä¸‹é¢å†™çš„ç½‘å€ä¸‹è½½Kreyaã€‚<br/><a class="ae lu" href="https://kreya.app/downloads/" rel="noopener ugc nofollow" target="_blank">https://kreya.app/downloads/</a></p><p id="bd32" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å®‰è£…åï¼Œç‚¹å‡»åˆ›å»ºé¡¹ç›®æŒ‰é’®</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/9fcaf7cade8367baf9b7b4554d13b319.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rz9LQFWOUTSj2F1Tj1YmBg.png"/></div></div></figure><p id="9b35" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç„¶åä¸ºé¡¹ç›®æ–‡ä»¶é€‰æ‹©ä¸€ä¸ªä½ç½®ï¼Œå¹¶æ ¹æ®éœ€è¦å¡«å†™å…¶ä»–è¾“å…¥ã€‚</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/b72a69caf26b34a7670121c739b6b541.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jf6djgfe_VwMtv1jA8bQfw.png"/></div></div></figure><p id="fdab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å•å‡»é¡¹ç›®/è¿›å£å•†è®¾ç½®ç±»å‹ä¸ºgRPC protoæ–‡ä»¶ï¼Œå¹¶åœ¨ã€‚NETé¡¹ç›®ä½œä¸ºåŸå‹ç›®å½•ã€‚</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/1dc404f75f64b95c468c6381ea920f69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5bIJd0k5tSnbzOwuzoJcjQ.png"/></div></div></figure><p id="8aa5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æ‚¨å¯ä»¥ä»ç›®å½•è®¾ç½®éƒ¨åˆ†è®¾ç½®ç«¯ç‚¹ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨<strong class="ka ir"> gRPC </strong>ä½ åº”è¯¥è®¾ç½®HTTPç«¯å£é…ç½®ä¸ºHTTP2æ”¯æŒï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨<strong class="ka ir"> gRPC-Web </strong>ä½ å¯ä»¥åœ¨Macè®¾å¤‡ä¸Šè®¾ç½®HTTPå’ŒHTTPSç«¯å£ï¼Œå¦åˆ™ä½ åº”è¯¥è®¾ç½®é¡¹ç›®çš„HTTPSç«¯å£ã€‚</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/e55fd4e09f9f45e6df27c9f0a90fd888.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EDT7j3LynTuW63gIn18CWg.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">å¯¹äºgRPC-ç½‘ç»œæ¨¡å¼MAC</figcaption></figure><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/cc762699aabcab53f302a97b6d2aea84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y9IXJxYf1UPykoMgtWNpLg.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">å¯¹äºgRPCæ¨¡å¼MAC</figcaption></figure><p id="ff0f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç„¶åï¼Œæ‚¨å¯ä»¥é€šè¿‡å•å‡»FetchReponseæ ‡ç­¾å‘é€è¯·æ±‚ï¼Œè¯¥æ ‡ç­¾æ¥è‡ªæˆ‘ä»¬çš„åŸå‹æ–‡ä»¶ï¼Œå¹¶ä¸”å¯èƒ½ä¼šå› æ‚¨çš„åŸå‹æ–‡ä»¶è€Œå¼‚ã€‚</p><p id="7ae7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¦‚æ‚¨æ‰€è§ï¼Œå›å¤ä¼šä¸€ç›´æŒç»­åˆ°å–æ¶ˆã€‚</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/3f85b3e4f8f268d8e3f2db71470dfc7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*URRrwD2lJUmNmTfjNXIP-g.png"/></div></div></figure><p id="5994" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¦‚æœä¸å–œæ¬¢Kreyaï¼Œå¯ä»¥çœ‹çœ‹<a class="ae lu" href="https://github.com/fullstorydev/grpcurl" rel="noopener ugc nofollow" target="_blank"> gRPCurl </a>ã€‚</p><h2 id="f1f8" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated"><strong class="ak">ç”¨YARPæ„å»ºgRPC-Webç½‘å…³</strong></h2><p id="14d8" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">æˆ‘ä»¬å°†é¢ä¸´çš„å¦ä¸€ä¸ªæŒ‘æˆ˜æ˜¯ï¼Œå¦‚æœä½ æƒ³å°†gRPC-Webä¸ç½‘å…³ä¸€èµ·ä½¿ç”¨ï¼Œæˆ–è€…å¦‚æœä½ æƒ³åœ¨å·²ç»ä½¿ç”¨ç½‘å…³çš„é¡¹ç›®ä¸­ä½¿ç”¨gRPCï¼Œä½ åº”è¯¥çŸ¥é“Ocelotç›®å‰ä¸æ”¯æŒgRPCã€‚ä½¿ç”¨å¾®è½¯å¼€å‘çš„<a class="ae lu" href="https://microsoft.github.io/reverse-proxy/" rel="noopener ugc nofollow" target="_blank"> YARP </a>ä¼šæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p><p id="d9a5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è®©æˆ‘ä»¬ä»åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®å¹¶å®‰è£…Yarpå¼€å§‹ã€‚ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤åè½¬Proxyã€‚</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="7f82" class="kw kx iq mh b gy ml mm l mn mo">dotnet new web -o gRPC.Web.Gateway<br/>dotnet add gRPC.Web.Gateway.csproj package Yarp.ReverseProxy</span></pre><p id="1560" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">YARPæ˜¯ä½œä¸ºä¸€ä¸ª. NETç»„ä»¶å®ç°çš„ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†ç¤ºä¾‹ä»£ç éƒ½åœ¨Program.csä¸­(ä»¥å‰ç‰ˆæœ¬æ˜¯Startup.cs)ã€‚</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="f48a" class="kw kx iq mh b gy ml mm l mn mo">var builder = WebApplication.CreateBuilder(args);</span><span id="5064" class="kw kx iq mh b gy mp mm l mn mo">// Add the reverse proxy to capability to the server<br/>var proxyBuilder = builder.Services.AddReverseProxy();</span><span id="525e" class="kw kx iq mh b gy mp mm l mn mo">// Initialize the reverse proxy from the "ReverseProxy" section of configuration<br/>proxyBuilder.LoadFromConfig(builder.Configuration.GetSection("ReverseProxy"));</span><span id="10a6" class="kw kx iq mh b gy mp mm l mn mo">var app = builder.Build();</span><span id="454a" class="kw kx iq mh b gy mp mm l mn mo">// Enable endpoint routing, required for the reverse proxy<br/>app.UseRouting();</span><span id="9476" class="kw kx iq mh b gy mp mm l mn mo">// Register the reverse proxy routes<br/>app.MapReverseProxy();</span><span id="c762" class="kw kx iq mh b gy mp mm l mn mo">app.Run();</span></pre><p id="8cc0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç„¶åï¼Œappsettings.jsonæ–‡ä»¶åº”è¯¥å¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="6487" class="kw kx iq mh b gy ml mm l mn mo">{<br/>  "Logging": {<br/>    "LogLevel": {<br/>      "Default": "Information",<br/>      "Microsoft.AspNetCore": "Warning"<br/>    }<br/>  },<br/>  "ReverseProxy": {<br/>    "routes": {<br/>      "grpc-web-service": {<br/>        "clusterId": "grpc-web-service",<br/>        "match": {<br/>          "path": "grpc/grpc-web-service/{**catch-all}"<br/>        },<br/>        "transforms": [<br/>          {<br/>            "pathPattern": "{**catch-all}"<br/>          },<br/>          { "RequestHeadersCopy": "true" },<br/>          { "RequestHeaderOriginalHost": "true" }<br/>        ]<br/>      }<br/>    },<br/>    "clusters": {<br/>      "grpc-web-service": {<br/>        "destinations": {<br/>          "destination1": {<br/>            "address": "<a class="ae lu" href="http://localhost:5019" rel="noopener ugc nofollow" target="_blank">http://localhost:</a>5019"<br/>          }<br/>        }<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="1a77" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¦‚æœä½ æƒ³æ·±å…¥äº†è§£YARPï¼Œå­¦ä¹ é«˜çº§/è¯¦ç»†çš„ç”¨æ³•ï¼Œä½ å¯ä»¥è®¿é—®è¿™ç¯‡æ–‡ç« ã€‚</p><p id="31cd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¦‚æœæ‚¨æƒ³æŸ¥çœ‹å¸¦æœ‰HTTP2çš„gRPCé…ç½®ç¤ºä¾‹ï¼Œè¯·è®¿é—®è¿™ç¯‡æ–‡ç« ã€‚</p><p id="9f3f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿé€šè¿‡ç½‘å…³ç«¯ç‚¹å‘æˆ‘ä»¬çš„gRPCæœåŠ¡å‘é€è¯·æ±‚ã€‚</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/4a96073a1ba9c5fafccf7c91297138de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*451FmpJius4a4WQb9KJ--g.png"/></div></div></figure><h2 id="3313" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated"><strong class="ak">å»ºç­‘ã€‚NET gRPC-Webå®¢æˆ·ç«¯</strong></h2><p id="c07d" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">è®©æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢ç¼–å†™çš„å‘½ä»¤åˆ›å»ºå¦ä¸€ä¸ªé¡¹ç›®ä½œä¸ºgRPCå®¢æˆ·æœºã€‚</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="95f3" class="kw kx iq mh b gy ml mm l mn mo">dotnet new console -o gRPC.Console.Client</span></pre><p id="a09c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç„¶åï¼Œæˆ‘ä»¬åº”è¯¥åˆ›å»ºä¸€ä¸ªåŒ…å«æˆ‘ä»¬çš„åŸå‹æ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œå¹¶å°†åŸå‹æ–‡ä»¶ç§»åŠ¨åˆ°å…¶ä¸­ã€‚</p><p id="fe23" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æˆ‘ä»¬ä¾èµ–è°·æ­Œã€‚Protobufï¼ŒGrpcã€‚Netå®¢æˆ·ç«¯ã€‚Net.Client.Webå’ŒGrpcã€‚ç”¨. NETæ„å»ºå®¢æˆ·ç«¯çš„å·¥å…·åŒ…</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="9efb" class="kw kx iq mh b gy ml mm l mn mo">dotnet add gRPC.Console.Client.csproj package Google.Protobuf<br/>dotnet add gRPC.Console.Client.csproj package Grpc.Tools <br/>dotnet add gRPC.Console.Client.csproj package Grpc.Net.Client<br/>dotnet add gRPC.Console.Client.csproj package Grpc.Net.Client.Web</span></pre><p id="2251" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å®‰è£…å®Œè¿™äº›åŒ…ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬çš„ã€‚csprojæ–‡ä»¶å°†èƒ½å¤Ÿä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç ã€‚è¿™ä¸ªé…ç½®ä¸æˆ‘ä»¬çš„æœåŠ¡å™¨å‡ ä¹ç›¸åŒï¼Œä½†æ˜¯æˆ‘ä»¬è¿™æ¬¡å°†â€œGrpcServicesâ€å€¼è®¾ç½®ä¸ºâ€œClientâ€è€Œä¸æ˜¯â€œserverâ€ã€‚</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="a680" class="kw kx iq mh b gy ml mm l mn mo">&lt;ItemGroup&gt;<br/> &lt;Protobuf Include="Protos\stream.proto" GrpcServices="Client" /&gt;<br/>&lt;/ItemGroup&gt;</span></pre><blockquote class="lv lw lx"><p id="7710" class="jy jz ly ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated">è¿›è¡ŒgRPCè°ƒç”¨æ—¶ï¼Œä¼šå¿½ç•¥gRPCé€šé“åœ°å€çš„è·¯å¾„éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œ<code class="fe mq mr ms mh b">GrpcChannel.ForAddress("https://localhost:5001/ignored_path")</code>åœ¨ä¸ºæœåŠ¡è·¯ç”±gRPCå‘¼å«æ—¶ä¸ä¼šä½¿ç”¨<code class="fe mq mr ms mh b">ignored_path</code>ã€‚</p><p id="acbd" class="jy jz ly ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated">åœ°å€è·¯å¾„è¢«å¿½ç•¥ï¼Œå› ä¸ºgRPCæœ‰ä¸€ä¸ªæ ‡å‡†åŒ–çš„ã€è§„å®šçš„åœ°å€ç»“æ„ã€‚gRPCåœ°å€ç»“åˆäº†åŒ…ã€æœåŠ¡å’Œæ–¹æ³•å:<code class="fe mq mr ms mh b"><a class="ae lu" href="https://localhost:5001/PackageName.ServiceName/MethodName." rel="noopener ugc nofollow" target="_blank">https://localhost:5001/PackageName.ServiceName/MethodName</a></code> <a class="ae lu" href="https://localhost:5001/PackageName.ServiceName/MethodName." rel="noopener ugc nofollow" target="_blank">ã€‚</a></p><p id="7662" class="jy jz ly ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated">åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºéœ€è¦åŒ…å«gRPCè°ƒç”¨çš„è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œå½“ASP.NETæ ¸å¿ƒgRPCåº”ç”¨ç¨‹åºæ‰˜ç®¡åœ¨IISç›®å½•ä¸­ï¼Œå¹¶ä¸”è¯¥ç›®å½•éœ€è¦åŒ…å«åœ¨è¯·æ±‚ä¸­æ—¶ã€‚å½“éœ€è¦ä¸€ä¸ªè·¯å¾„æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„<code class="fe mq mr ms mh b">SubdirectoryHandler</code>å°†å®ƒæ·»åŠ åˆ°gRPCè°ƒç”¨ä¸­</p></blockquote><p id="636d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æ¥æº:<a class="ae lu" href="https://docs.microsoft.com/en-us/aspnet/core/grpc/troubleshoot?view=aspnetcore-6.0#calling-grpc-services-hosted-in-a-sub-directory" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/aspnet/core/grpc/troubleshootï¼Ÿview = aspnetcore-6.0 # calling-grpc-services-hosted-in-a-sub-directory</a></p><p id="cc71" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æ ¹æ®å¾®è½¯çš„è¯´æ³•ï¼Œå¦‚æœæ‚¨æƒ³ä¸ºgRPCè°ƒç”¨ä½¿ç”¨ç½‘å…³æˆ–å…¶ä»–å‰ç¼€ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå­ç›®å½•Handlerï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="b494" class="kw kx iq mh b gy ml mm l mn mo">namespace gRPC.Console.Client.Handlers<br/>{</span><span id="53e2" class="kw kx iq mh b gy mp mm l mn mo">/// &lt;summary&gt;<br/>    /// A delegating handler that adds a subdirectory to the URI of gRPC requests.<br/>    /// &lt;/summary&gt;<br/>    public class SubdirectoryHandler : DelegatingHandler<br/>    {<br/>        private readonly string _subdirectory;</span><span id="a309" class="kw kx iq mh b gy mp mm l mn mo">public SubdirectoryHandler(HttpMessageHandler innerHandler, string subdirectory)<br/>            : base(innerHandler)<br/>        {<br/>            _subdirectory = subdirectory;<br/>        }</span><span id="951c" class="kw kx iq mh b gy mp mm l mn mo">protected override Task&lt;HttpResponseMessage&gt; SendAsync(<br/>            HttpRequestMessage request, CancellationToken cancellationToken)<br/>        {<br/>            var old = request.RequestUri;</span><span id="102e" class="kw kx iq mh b gy mp mm l mn mo">var url = $"{old.Scheme}://{old.Host}:{old.Port}";<br/>            url += $"{_subdirectory}{request.RequestUri.AbsolutePath}";<br/>            request.RequestUri = new Uri(url, UriKind.Absolute);</span><span id="9bd5" class="kw kx iq mh b gy mp mm l mn mo">return base.SendAsync(request, cancellationToken);<br/>        }<br/>    }<br/>}</span></pre><p id="0c27" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æœ€ç»ˆçš„ç»“æ„åº”è¯¥å¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/4188da737aa902460045911693e76446.png" data-original-src="https://miro.medium.com/v2/resize:fit:728/format:webp/1*ATq10EsU9a2g-qrpYoq-Tg.png"/></div></figure><p id="f7f0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬åº”è¯¥å°†æˆ‘ä»¬çš„é€»è¾‘ç¼–å†™åˆ°Program.csä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="mc md me mf gt jr"><div class="bz fp l di"><div class="ng nh l"/></div></figure><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/c1a696424fc3b94a00fe03cf06122698.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*diOZTt6cdfdKJxqj0AGoFw.png"/></div></figure><h2 id="8484" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated"><strong class="ak">æ„å»ºAngular gRPC-Webå®¢æˆ·ç«¯</strong></h2><p id="9bf6" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">æˆ‘ä»¬å¿…é¡»å®‰è£…protocolï¼Œå®ƒæ˜¯ä¸€ä¸ªåè®®ç¼–è¯‘å™¨ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ä»ã€‚ä½œä¸ºç¬¬ä¸€æ­¥çš„åŸå‹æ–‡ä»¶ã€‚</p><blockquote class="lv lw lx"><p id="1dc4" class="jy jz ly ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated"><strong class="ka ir">æœ¬æ–‡æ˜¯ç”¨protobufçš„</strong> <a class="ae lu" href="https://github.com/protocolbuffers/protobuf/releases/tag/v3.19.4" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> v3.19.4ç¼–å†™çš„ã€‚</strong>T13ã€‘</a></p></blockquote><p id="1e78" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æŒ‰ç…§ä»¥ä¸‹URLä¸­çš„è¯´æ˜åœ¨<strong class="ka ir"> Windows </strong>è®¾å¤‡ä¸Šå®‰è£…ã€‚<br/><a class="ae lu" href="https://www.geeksforgeeks.org/how-to-install-protocol-buffers-on-windows/" rel="noopener ugc nofollow" target="_blank">https://www . geeks forgeeks . org/how-to-install-protocol-buffers-on-windows/</a></p><blockquote class="lv lw lx"><p id="b180" class="jy jz ly ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated"><strong class="ka ir">ä¸è¦é€‰æ‹©Javascriptç‰ˆæœ¬ï¼Œå› ä¸ºæˆ‘ä»¬ä¼šä½¿ç”¨TypeScriptã€‚</strong></p></blockquote><p id="c642" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¯¹äº<strong class="ka ir"> Mac </strong>è®¾å¤‡:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="8f23" class="kw kx iq mh b gy ml mm l mn mo">brew install protobuf</span></pre><p id="c151" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è®©æˆ‘ä»¬ç”¨ä¸‹é¢çš„å‘½ä»¤åˆ›å»ºä¸€ä¸ªè§’åº¦é¡¹ç›®ã€‚</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="3ac4" class="kw kx iq mh b gy ml mm l mn mo">ng new gRPC.Angular.Client --routing=false --style=scss</span></pre><p id="a2cc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å› ä¸ºprotocolä¸æ”¯æŒTypeScriptï¼Œæˆ‘ä»¬éœ€è¦å°†ts-protocol-genæ’ä»¶æ·»åŠ åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ã€‚</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="68a5" class="kw kx iq mh b gy ml mm l mn mo">npm install --save ts-protoc-gen</span></pre><p id="76e9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æˆ‘ä»¬è¿˜éœ€è¦å®‰è£…<a class="ae lu" href="https://github.com/improbable-eng/grpc-web" rel="noopener ugc nofollow" target="_blank">ä¸å¯èƒ½çš„gRPC-web </a>åº“å’Œ<a class="ae lu" href="https://www.npmjs.com/package/google-protobuf" rel="noopener ugc nofollow" target="_blank"> google-protobuf </a>åŒ…(+its types<a class="ae lu" href="https://www.npmjs.com/package/@types/google-protobuf" rel="noopener ugc nofollow" target="_blank">@ types/Google-proto buf</a>):</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="f5ac" class="kw kx iq mh b gy ml mm l mn mo">npm install --save google-protobuf</span><span id="a033" class="kw kx iq mh b gy mp mm l mn mo">npm install --save-dev @types/google-protobuf</span><span id="5853" class="kw kx iq mh b gy mp mm l mn mo">npm install --save @improbable-eng/grpc-web</span></pre><p id="4993" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç„¶åï¼Œæˆ‘ä»¬åº”è¯¥åˆ›å»ºä¸€ä¸ªåŒ…å«æˆ‘ä»¬çš„åŸå‹æ–‡ä»¶çš„ç›®å½•ã€‚æˆ‘åˆ›å»ºäº†ä¸€ä¸ªåä¸ºâ€œprotosâ€çš„ç›®å½•ï¼Œå¹¶å°†stream.protoæ–‡ä»¶å¤åˆ¶åˆ°é‚£é‡Œã€‚</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/0008e46abe15cf6fd5968a5591c130d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:580/format:webp/1*EBGmTFJBCym96Ggl8SWotg.png"/></div></figure><p id="9279" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è®©æˆ‘ä»¬å°†ç›®å½•æ›´æ”¹ä¸ºâ€œprotosâ€æ–‡ä»¶å¤¹ï¼Œå¹¶åˆ›å»ºè‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ï¼Œå¦‚å¸¦æœ‰åè®®çš„æœåŠ¡å’Œå®¢æˆ·ç«¯ã€‚</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="993e" class="kw kx iq mh b gy ml mm l mn mo">protoc --plugin=protoc-gen-ts="../../../node_modules/.bin/protoc-gen-ts" --js_out="import_style=commonjs,binary:../generated" --ts_out="service=grpc-web:../generated" stream.proto</span></pre><blockquote class="lv lw lx"><p id="7b9b" class="jy jz ly ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated"><strong class="ka ir">å¯¹äºWindows </strong>è®¾å¤‡ï¼Œprotocol-gen-tsè·¯å¾„åº”è¯¥æ˜¯ç»å¯¹è·¯å¾„ï¼Œè€Œä¸æ˜¯protocol-gen-tsï¼Œæ‚¨åº”è¯¥ä½¿ç”¨protocol-gen-ts . cmdã€‚</p></blockquote><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="ca5c" class="kw kx iq mh b gy ml mm l mn mo">protoc --plugin=protoc-gen-ts="{ABSOLUTEPATH}\node_modules\.bin\protoc-gen-ts.cmd" --js_out="import_style=commonjs,binary:{OUTPUTPATH}" --ts_out="service=grpc-web:{OUTPUTPATH}" {PROTO_FILE_PATH]</span></pre><p id="53bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">åœ¨æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤åï¼Œæˆ‘ä»¬åº”è¯¥ä¼šçœ‹åˆ°4ä¸ªç”Ÿæˆçš„æ–‡ä»¶ã€‚</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/0f5a92a99c8e62ed95d3b8d89db5cdae.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*1rL6QsSCjiezQYTrv5mWoA.png"/></div></figure><p id="c49b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°†grpc-webå®ç°åˆ°app.component.tsä¸­ã€‚</p><figure class="mc md me mf gt jr"><div class="bz fp l di"><div class="ng nh l"/></div></figure><figure class="mc md me mf gt jr"><div class="bz fp l di"><div class="ng nh l"/></div></figure><blockquote class="lv lw lx"><p id="abc1" class="jy jz ly ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated"><strong class="ka ir">ä¸è¦å¿˜è®°æ·»åŠ ä¸€ä¸ªå…è®¸gRPCä½¿ç”¨4200ç«¯å£çš„corsç­–ç•¥ã€‚Web.Serveré¡¹ç›®ã€‚</strong></p></blockquote><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/d0043e9ef13df3d5d2b9171604da0196.png" data-original-src="https://miro.medium.com/v2/resize:fit:726/format:webp/1*SC2KrnVg-UrqbH6ubgyj2Q.png"/></div></figure><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/11ba46c0b6c8bce9df79aeb31b4f5ed0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*PIahBAa5N8l4AjOS5cVd8w.gif"/></div></div></figure><h2 id="1baf" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated"><strong class="ak">ä¸ºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ·»åŠ JWTè®¤è¯</strong></h2><p id="9280" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">æ‚¨å¯èƒ½éœ€è¦åœ¨grpcåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨JWTè®¤è¯ï¼Œè¿™å¾ˆå®¹æ˜“å®ç°ã€‚æ‚¨åªéœ€è¦åœ¨æœåŠ¡å™¨ç«¯æ·»åŠ [Authorize]å±æ€§ã€‚</p><figure class="mc md me mf gt jr"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="1154" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç„¶åï¼Œæ‚¨å¯ä»¥ä»Kreyaçš„å…ƒæ•°æ®éƒ¨åˆ†æ·»åŠ æ‚¨çš„ä»¤ç‰Œã€‚</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/a8606d030e8a1d050daec50359bbfbc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xMm2lcDLopNkwNaVNTaBTQ.png"/></div></div></figure><p id="cd3a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å°†ä»¤ç‰Œæ·»åŠ åˆ°å…ƒæ•°æ®éƒ¨åˆ†å¯¹äºAngularæ¥è¯´å°±è¶³å¤Ÿäº†ã€‚</p><figure class="mc md me mf gt jr"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="adcd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ã€‚ç½‘ç»œå®¢æˆ·ç«¯:</p><figure class="mc md me mf gt jr"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="947e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">GitHubç½‘å€:<a class="ae lu" href="https://github.com/edisnezir/grpc-demo" rel="noopener ugc nofollow" target="_blank">https://github.com/edisnezir/grpc-demo</a></p></div></div>    
</body>
</html>