<html>
<head>
<title>Smaller Docker Images for ASP.NET Core Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ASP.NETæ ¸å¿ƒåº”ç”¨ç¨‹åºçš„è¾ƒå°Dockeræ˜ åƒ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://itnext.io/smaller-docker-images-for-asp-net-core-apps-bee4a8fd1277?source=collection_archive---------0-----------------------#2020-01-09">https://itnext.io/smaller-docker-images-for-asp-net-core-apps-bee4a8fd1277?source=collection_archive---------0-----------------------#2020-01-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9e4e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">å°ºå¯¸ç¼©å‡é«˜è¾¾70%</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7debd0db3a2cf48678e4ffbf8c80e7e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O_YkwXmX6Xz19t8mMXJSzA.jpeg"/></div></div></figure><p id="9c0a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">ä½ æœ‰æ²¡æœ‰é—®è¿‡è‡ªå·±ï¼Œä¸ºä»€ä¹ˆè¦è®©ä½ çš„Dockerå›¾ç‰‡å°½å¯èƒ½çš„å°ï¼Ÿ</p><ol class=""><li id="b558" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">æ›´å¤§çš„å›¾åƒæ„å‘³ç€<strong class="kw iu">æ›´é•¿çš„ä¸‹è½½æ—¶é—´</strong>ã€‚</li><li id="931e" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">æ›´å¤§çš„å›¾åƒæ„å‘³ç€<strong class="kw iu">æ›´å¤šçš„å­˜å‚¨æ¶ˆè€—</strong>ã€‚</li><li id="84ae" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">è¾ƒå¤§çš„å›¾åƒæ„å‘³ç€å›¾åƒä¸­æœ‰<strong class="kw iu">ä¸å¿…è¦çš„ç»„ä»¶</strong>ã€‚</li></ol><p id="b135" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">å› æ­¤ï¼Œå¤§å‹æ˜ åƒä¼šå¯¼è‡´é›†æˆå’Œéƒ¨ç½²å»¶è¿Ÿï¼Œæˆ–è€…å¢åŠ å­˜å‚¨æˆæœ¬ã€‚</p><p id="adb5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†ç‰¢è®°æ•ˆç‡æ¥æè¿°å‡ ç§æ–¹æ³•ã€‚Dockerä¸Šçš„NET Coreéƒ¨ç½²ã€‚</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="aff5" class="ml mm it bd mn mo mp dn mq mr ms dp mt ld mu mv mw lh mx my mz ll na nb nc nd bi translated">1)è„šæ‰‹æ¶å·¥ç¨‹</h2><p id="228d" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">è¦å¼€å§‹åœ¨Dockerä¸Šéƒ¨ç½²ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç¤ºä¾‹é¡¹ç›®ã€‚æˆ‘å°†ä½¿ç”¨é»˜è®¤çš„ASP.NETæ ¸å¿ƒAPIé¡¹ç›®ã€‚æ‚¨å¯ä»¥é€šè¿‡ç»ˆç«¯ä¸­çš„<code class="fe nj nk nl nm b">dotnet new webapi -o MyWebApp</code>å‘½ä»¤åˆ›å»ºé¡¹ç›®ã€‚</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/667d960242e9138ad2a74aeb14284c69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_0MiWDn__SvmjHPHN4d48A.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">è¯¥å‘½ä»¤å°†åˆ›å»ºæ–°çš„ASP.NETæ ¸å¿ƒWeb APIé¡¹ç›®</figcaption></figure><h2 id="a32e" class="ml mm it bd mn mo mp dn mq mr ms dp mt ld mu mv mw lh mx my mz ll na nb nc nd bi translated">2)å°†é¡¹ç›®å‘å¸ƒä¸ºæ¡†æ¶ç›¸å…³çš„åº”ç”¨ç¨‹åº</h2><p id="4806" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">æ‚¨å¯ä»¥å°†åº”ç”¨ç¨‹åºå‘å¸ƒä¸º<a class="ae ns" href="https://docs.microsoft.com/en-us/dotnet/core/deploying/" rel="noopener ugc nofollow" target="_blank">è‡ªåŒ…å«åº”ç”¨ç¨‹åºæˆ–ä¾èµ–äºæ¡†æ¶çš„</a>ã€‚åœ¨æ–‡ç« çš„è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†æŠŠé¡¹ç›®å‘å¸ƒä¸ºæ¡†æ¶ç›¸å…³çš„ã€‚</p><p id="7ed0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">è¦å‘å¸ƒï¼Œè¯·åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤:</p><pre class="kj kk kl km gt nt nm nu nv aw nw bi"><span id="f5f2" class="ml mm it nm b gy nx ny l nz oa">dotnet publish -c Release -o ./publish</span></pre><p id="119f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">ç¡®ä¿ä½ å‘å¸ƒçš„åº”ç”¨å¸¦æœ‰<strong class="kw iu">å‘å¸ƒæ¦‚è¦</strong>æ˜¯å¾ˆé‡è¦çš„ã€‚è¯¥é€‰é¡¹å°†å‘Šè¯‰ã€‚NET publisheråº”è¯¥ä½¿ç”¨å“ªä¸ªé…ç½®æ–‡ä»¶ã€‚</p><h2 id="859a" class="ml mm it bd mn mo mp dn mq mr ms dp mt ld mu mv mw lh mx my mz ll na nb nc nd bi translated">2.1)ä½¿ç”¨ASP.NETæ ¸å¿ƒè¿è¡Œæ—¶åˆ›å»ºdockeræ˜ åƒ</h2><p id="8b92" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">åˆ›å»ºä¸€ä¸ª<code class="fe nj nk nl nm b">Dockerfile</code>ï¼Œå†…å®¹å¦‚ä¸‹:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="16a7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">å»ºç«‹å½¢è±¡:</p><pre class="kj kk kl km gt nt nm nu nv aw nw bi"><span id="a30a" class="ml mm it nm b gy nx ny l nz oa">docker build -t web1 -f Dockerfile .</span></pre><p id="df70" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Dockerå°†æ„å»ºå›¾åƒå¹¶äº§ç”Ÿå¦‚ä¸‹è¾“å‡º:</p><pre class="kj kk kl km gt nt nm nu nv aw nw bi"><span id="8b2b" class="ml mm it nm b gy nx ny l nz oa">Sending build context to Docker daemon  1.807MB<br/>Step 1/6 : FROM mcr.microsoft.com/dotnet/core/aspnet:3.1 AS runtime<br/>3.1: Pulling from dotnet/core/aspnet<br/>8ec398bc0356: Pull complete                                                                                             9584d2ef7ebe: Pull complete                                                                                             62b61706cd9b: Pull complete                                                                                             8f13df7c0cb1: Pull complete                                                                                             9c72d70b702b: Pull complete                                                                                             Digest: sha256:9f0aebb2e83a9f455e4ac123db10bc263e729e1faaf733709db04d0d6df2b77c<br/>Status: Downloaded newer image for mcr.microsoft.com/dotnet/core/aspnet:3.1<br/> ---&gt; a843e0fbe833<br/>Step 2/6 : EXPOSE 80<br/> ---&gt; Running in 870640b52084<br/>Removing intermediate container 870640b52084<br/> ---&gt; f9a31931a780<br/>Step 3/6 : EXPOSE 443<br/> ---&gt; Running in 7e477e68bd5a<br/>Removing intermediate container 7e477e68bd5a<br/> ---&gt; 7522ce7349fa<br/>Step 4/6 : WORKDIR /app<br/> ---&gt; Running in 7c4d3e1490a3<br/>Removing intermediate container 7c4d3e1490a3<br/> ---&gt; 784d7ff4e4bd<br/>Step 5/6 : COPY ./publish ./<br/> ---&gt; 5a7b9b9163c0<br/>Step 6/6 : ENTRYPOINT ["dotnet", "MyWebApp.dll"]<br/> ---&gt; Running in ce7cdd5dd2c4<br/>Removing intermediate container ce7cdd5dd2c4<br/> ---&gt; bc92fbe6e1b2<br/>Successfully built bc92fbe6e1b2<br/>Successfully tagged web1:latest</span></pre><p id="bba9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">ğŸ“”ä¸ºäº†ç¡®ä¿webåº”ç”¨ç¨‹åºå·¥ä½œæ­£å¸¸ï¼Œå°è¯•é€šè¿‡å‘½ä»¤<code class="fe nj nk nl nm b">docker run -p 8080:80 web1</code>è¿è¡Œå›¾åƒã€‚ç„¶åå¯¼èˆªåˆ°<a class="ae ns" href="http://localhost:8080/WeatherForecast" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/Weather</a>æŸ¥çœ‹JSONåˆ—è¡¨ã€‚</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/6cf748ebb885fff124416163abe63e1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vlOZWLZ3UO498sFAFaDZ5Q.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">æŠ½æ ·è¾“å‡º</figcaption></figure><p id="fa27" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">çœ‹èµ·æ¥å›¾åƒè¿è¡Œè‰¯å¥½ï¼Œè®©æˆ‘ä»¬æ¥æµ‹é‡å›¾åƒçš„å¤§å°ã€‚ç”¨<code class="fe nj nk nl nm b">docker images</code>å‘½ä»¤ï¼Œä½ å¯ä»¥å¾—åˆ°å›¾ç‰‡çš„åˆ—è¡¨ã€‚</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/2f1b66e8e7345bb9d76c3db7ff830a4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eN8rUlvmVC29EyGI3ebGPA.png"/></div></div></figure><p id="771f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu"> 207 MB </strong>ç”¨äºASP.NETæ ¸å¿ƒåº”ç”¨åŸºç¡€æ˜ åƒï¼Œ1 MB<strong class="kw iu">ç”¨äºç½‘ç»œåº”ç”¨ã€‚å¯¹äºä¸€ä¸ªç®€å•çš„webåº”ç”¨ç¨‹åºæ¥è¯´<strong class="kw iu"> 208 MB </strong>å¾ˆå¤§ï¼Œ<strong class="kw iu">ä¸æ˜¯å—</strong>ï¼ŸğŸ˜²</strong></p><p id="19b2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">è®©æˆ‘ä»¬æ£€æŸ¥å›¾åƒï¼Œçœ‹çœ‹æ˜¯ä»€ä¹ˆä½¿æˆ‘ä»¬çš„å›¾åƒå¤§å°ä¸º208 MB:</p><pre class="kj kk kl km gt nt nm nu nv aw nw bi"><span id="0e22" class="ml mm it nm b gy nx ny l nz oa">docker history web1:latest</span><span id="1831" class="ml mm it nm b gy of ny l nz oa"># result</span><span id="db8b" class="ml mm it nm b gy of ny l nz oa">CREATED BY                                      SIZE               <br/>/bin/sh -c #(nop)  ENTRYPOINT ["dotnet" "MyWâ€¦   0B<br/>/bin/sh -c #(nop) COPY dir:36b502377fe8f29beâ€¦   289kB<br/>/bin/sh -c #(nop) WORKDIR /app                  0B<br/>/bin/sh -c #(nop)  EXPOSE 443                   0B<br/>/bin/sh -c #(nop)  EXPOSE 80                    0B<br/>/bin/sh -c aspnetcore_version=3.1.0     &amp;&amp; câ€¦   17.8MB<br/>/bin/sh -c dotnet_version=3.1.0     &amp;&amp; curl â€¦   76.7MB<br/>/bin/sh -c apt-get update     &amp;&amp; apt-get insâ€¦   2.28MB<br/>/bin/sh -c #(nop)  ENV ASPNETCORE_URLS=http:â€¦   0B<br/>/bin/sh -c apt-get update     &amp;&amp; apt-get insâ€¦   41.3MB<br/>/bin/sh -c #(nop)  CMD ["bash"]                 0B<br/>/bin/sh -c #(nop) ADD file:04caaf303199c81ffâ€¦   69.2MB</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/19efad3909aca704d531f371cd7a14e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*ifQLSF35UzU3qxYuKbx2UQ.png"/></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">94 MBç”¨äºã€‚NETå’Œ112MBç”¨äºåŸºæœ¬æ˜ åƒå’Œåº“ã€‚</figcaption></figure><h2 id="488d" class="ml mm it bd mn mo mp dn mq mr ms dp mt ld mu mv mw lh mx my mz ll na nb nc nd bi translated">3)å°†é¡¹ç›®å‘å¸ƒä¸ºç‹¬ç«‹çš„</h2><p id="2436" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">åœ¨ç¬¬2èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†é¡¹ç›®å‘å¸ƒä¸ºæ¡†æ¶ç›¸å…³çš„ï¼Œæˆ‘ä»¬çœ‹åˆ°å›¾åƒå¤§å°çº¦ä¸º208 MBã€‚</p><p id="17a7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">é€šè¿‡è‡ªåŒ…å«éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥éƒ¨ç½²åº”ç”¨ç¨‹åºå’Œä»»ä½•å¿…éœ€çš„ç¬¬ä¸‰æ–¹ä¾èµ–é¡¹ä»¥åŠçš„ç‰ˆæœ¬ã€‚NET Coreæ¥æ„å»ºåº”ç”¨ç¨‹åºã€‚è¦å‘å¸ƒä¸ºç‹¬ç«‹çš„ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤:</p><pre class="kj kk kl km gt nt nm nu nv aw nw bi"><span id="90bb" class="ml mm it nm b gy nx ny l nz oa">dotnet publish --runtime alpine-x64 -c Release --self-contained true -o ./publish</span></pre><p id="603d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">è¯¥åº”ç”¨ç¨‹åºå°†åœ¨Linux dockerä¸Šè¿è¡Œï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©äº†<code class="fe nj nk nl nm b">linux-x64</code> runtimeè¿›è¡Œéƒ¨ç½²ã€‚è¦æŸ¥çœ‹publishå‘½ä»¤æ”¯æŒçš„å…¶ä»–è¿è¡Œæ—¶ï¼Œè¯·é˜…è¯»æœ¬æ–‡æ¡£ã€‚</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/ab435ac5de63532b34184c4f6cfb06ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_KDMw1wtsLF9Z3h5tYwPdQ.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">324ä¸ªæ–‡ä»¶å’Œ93.2 MB</figcaption></figure><p id="8235" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">å®ƒå°†ç”ŸæˆåŒ…å«ç¨‹åºé›†ç­‰çš„<strong class="kw iu"> 324ä¸ªæ–‡ä»¶(93.2 MB) </strong>ã€‚ä¸ºäº†åœ¨dockerä¸Šè¿è¡Œå®ƒï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªLinuxåŸºç¡€æ˜ åƒã€‚æœ‰Ubuntuï¼ŒCentOSï¼ŒOpenSuseï¼ŒAlpineç­‰ä¸åŒçš„åŸºç¡€é•œåƒã€‚</p><p id="5477" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">è§„æ¨¡ã€å®‰å…¨ã€æ•ˆç‡ã€ç¤¾åŒºæ˜¯å†³å®šä½ éœ€è¦å“ªä¸€ä¸ªçš„é‡è¦ä»·å€¼ã€‚</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/8305707bab094eaac725e2f70df82569.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wiYYkxlxY-R141mi.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">æ¥æº:<a class="ae ns" href="https://brianchristner.io/docker-image-base-os-size-comparison/" rel="noopener ugc nofollow" target="_blank"> Dockerå›¾ç‰‡å°ºå¯¸å¯¹æ¯”</a>ä½œè€…<a class="ae ns" href="https://brianchristner.io/author/brian/" rel="noopener ugc nofollow" target="_blank">å¸ƒè±æ©Â·å…‹é‡Œæ–¯ç‰¹çº³</a></figcaption></figure><p id="bf7c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒAlpine Linuxæ˜¯æœ€è½»çš„dockeråŸºç¡€æ˜ åƒã€‚å®ƒæä¾›äº†å®‰å…¨æ€§ã€ç®€å•æ€§å’Œèµ„æºæ•ˆç‡ï¼</p><blockquote class="oj ok ol"><p id="ea38" class="ku kv om kw b kx ky ju kz la lb jx lc on le lf lg oo li lj lk op lm ln lo lp im bi translated">Alpine Linuxæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ã€éå•†ä¸šçš„ã€é€šç”¨çš„Linuxå‘è¡Œç‰ˆï¼Œä¸“ä¸ºé‡è§†å®‰å…¨æ€§ã€ç®€å•æ€§å’Œèµ„æºæ•ˆç‡çš„é«˜çº§ç”¨æˆ·è€Œè®¾è®¡ã€‚<br/>T10ã€‘https://alpinelinux.org/about/</p></blockquote><h2 id="0831" class="ml mm it bd mn mo mp dn mq mr ms dp mt ld mu mv mw lh mx my mz ll na nb nc nd bi translated">3.1)ä½¿ç”¨Alpine baseæ˜ åƒåˆ›å»ºdockeræ˜ åƒ</h2><p id="a856" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">åˆ›å»ºä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„Dockeræ–‡ä»¶:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="e8be" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">æˆ‘ä½¿ç”¨alpine:3.9.4ä½œä¸ºdockerçš„åŸºç¡€æ˜ åƒï¼Œåœ¨Dockeræ–‡ä»¶ä¸­å®‰è£…äº†ä¸€äº›åº“åŒ…ã€‚ç°åœ¨ï¼Œå¦‚æœä½ å»ºç«‹å›¾åƒ:</p><pre class="kj kk kl km gt nt nm nu nv aw nw bi"><span id="8d34" class="ml mm it nm b gy nx ny l nz oa">docker build -t web2 -f Dockerfile .</span></pre><p id="a647" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Dockerå°†æ„å»ºå›¾åƒå¹¶äº§ç”Ÿå¦‚ä¸‹è¾“å‡º:</p><pre class="kj kk kl km gt nt nm nu nv aw nw bi"><span id="948e" class="ml mm it nm b gy nx ny l nz oa">Sending build context to Docker daemon  296.2MB<br/>Step 1/8 : FROM alpine:3.9.4<br/>3.9.4: Pulling from library/alpine<br/>e7c96db7181b: Pull complete                                                                                                               Digest: sha256:7746df395af22f04212cd25a92c1d6dbc5a06a0ca9579a229ef43008d4d1302a<br/>Status: Downloaded newer image for alpine:3.9.4<br/> ---&gt; 055936d39205<br/>Step 2/8 : RUN apk add --no-cache     openssh libunwind     nghttp2-libs libidn krb5-libs libuuid lttng-ust zlib     libstdc++ libintl     icu<br/> ---&gt; Running in 9471cd447603<br/>fetch <a class="ae ns" href="http://dl-cdn.alpinelinux.org/alpine/v3.9/main/x86_64/APKINDEX.tar.gz" rel="noopener ugc nofollow" target="_blank">http://dl-cdn.alpinelinux.org/alpine/v3.9/main/x86_64/APKINDEX.tar.gz</a><br/>fetch <a class="ae ns" href="http://dl-cdn.alpinelinux.org/alpine/v3.9/community/x86_64/APKINDEX.tar.gz" rel="noopener ugc nofollow" target="_blank">http://dl-cdn.alpinelinux.org/alpine/v3.9/community/x86_64/APKINDEX.tar.gz</a><br/>(1/26) Installing libgcc (8.3.0-r0)<br/>(2/26) Installing libstdc++ (8.3.0-r0)<br/>(3/26) Installing icu-libs (62.1-r0)<br/>(4/26) Installing icu (62.1-r0)<br/>(5/26) Installing krb5-conf (1.0-r1)<br/>(6/26) Installing libcom_err (1.44.5-r1)<br/>(7/26) Installing keyutils-libs (1.6-r0)<br/>(8/26) Installing libverto (0.3.0-r1)<br/>(9/26) Installing krb5-libs (1.15.5-r0)<br/>(10/26) Installing libidn (1.35-r0)<br/>(11/26) Installing libintl (0.19.8.1-r4)<br/>(12/26) Installing libunwind (1.2.1-r3)<br/>(13/26) Installing libuuid (2.33-r0)<br/>(14/26) Installing userspace-rcu (0.10.1-r0)<br/>(15/26) Installing lttng-ust (2.10.1-r0)<br/>(16/26) Installing nghttp2-libs (1.35.1-r1)<br/>(17/26) Installing openssh-keygen (7.9_p1-r6)<br/>(18/26) Installing ncurses-terminfo-base (6.1_p20190105-r0)<br/>(19/26) Installing ncurses-terminfo (6.1_p20190105-r0)<br/>(20/26) Installing ncurses-libs (6.1_p20190105-r0)<br/>(21/26) Installing libedit (20181209.3.1-r0)<br/>(22/26) Installing openssh-client (7.9_p1-r6)<br/>(23/26) Installing openssh-sftp-server (7.9_p1-r6)<br/>(24/26) Installing openssh-server-common (7.9_p1-r6)<br/>(25/26) Installing openssh-server (7.9_p1-r6)<br/>(26/26) Installing openssh (7.9_p1-r6)<br/>Executing busybox-1.29.3-r10.trigger<br/>OK: 53 MiB in 40 packages<br/>Removing intermediate container 9471cd447603<br/> ---&gt; 13d705c0f17d<br/>Step 3/8 : EXPOSE 80<br/> ---&gt; Running in 1e9629765f45<br/>Removing intermediate container 1e9629765f45<br/> ---&gt; 3e9b13c5f712<br/>Step 4/8 : EXPOSE 443<br/> ---&gt; Running in d203c44684f4<br/>Removing intermediate container d203c44684f4<br/> ---&gt; d28ff936ef66<br/>Step 5/8 : WORKDIR /app<br/> ---&gt; Running in c0e330d7f71e<br/>Removing intermediate container c0e330d7f71e<br/> ---&gt; 914a79994c12<br/>Step 6/8 : COPY ./publish ./<br/> ---&gt; f264c40e2341<br/>Step 7/8 : RUN ["chmod", "+x", "MyWebApp"]<br/> ---&gt; Running in a66b965fda5b<br/>Removing intermediate container a66b965fda5b<br/> ---&gt; 94e004ed94a7<br/>Step 8/8 : ENTRYPOINT ["./MyWebApp", "--urls", "<a class="ae ns" href="http://0.0.0.0:80" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:80</a>"]<br/> ---&gt; Running in ded6415d0e8b<br/>Removing intermediate container ded6415d0e8b<br/> ---&gt; 2686bfb52f0f<br/>Successfully built 2686bfb52f0f<br/>Successfully tagged web2:latest</span></pre><p id="8497" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">è¯¥æ—¥å¿—æ¯”å‰ä¸€ä¸ªæ—¥å¿—ç¨é•¿ï¼›å› ä¸ºå®ƒå°†ä¸ºAlpineå®‰è£…ä¸€äº›æ‰€éœ€çš„åº“ã€‚ç½‘èŠ¯ã€‚è®©æˆ‘ä»¬æ¥æµ‹é‡å›¾åƒå¤§å°:</p><pre class="kj kk kl km gt nt nm nu nv aw nw bi"><span id="d9a2" class="ml mm it nm b gy nx ny l nz oa">docker images</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/7b8ee02f2520400e103388120c2d5d67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zLIL4pSdjuNoVIcyoi2kBA.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">å°ºå¯¸ç¼©å°äº†29%</figcaption></figure><p id="58ad" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">å›¾åƒå¤§å°ä¸º<strong class="kw iu"> 147 MBï¼Œæ¯”ä¸Šä¸€å¼ å°‘äº†61 MB </strong>ã€‚è®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹å›¾åƒå±‚ï¼Œçœ‹çœ‹147 MBæ˜¯ç”±ä»€ä¹ˆç»„æˆçš„:</p><pre class="kj kk kl km gt nt nm nu nv aw nw bi"><span id="6974" class="ml mm it nm b gy nx ny l nz oa">docker history web2:latest</span></pre><p id="eb70" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">æ€»ç»“åçš„ç»“æœåº”è¯¥æ˜¯è¿™æ ·çš„:</p><pre class="kj kk kl km gt nt nm nu nv aw nw bi"><span id="4668" class="ml mm it nm b gy nx ny l nz oa">CREATED BY                                      SIZE                <br/>/bin/sh -c #(nop)  ENTRYPOINT ["./MyWebApp" â€¦   0B<br/>/bin/sh -c #(nop) COPY dir:eec964e257409b648â€¦   97.8MB<br/>/bin/sh -c #(nop) WORKDIR /app                  0B<br/>/bin/sh -c #(nop)  EXPOSE 443                   0B<br/>/bin/sh -c #(nop)  EXPOSE 80                    0B<br/>/bin/sh -c apk add --no-cache     openssh liâ€¦   43.8MB<br/>/bin/sh -c #(nop)  CMD ["/bin/sh"]              0B<br/>/bin/sh -c #(nop) ADD file:a86aea1f3a7d68f6aâ€¦   5.53MB</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/3a41f62dbec26f34edb3bd67e214ecf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*m_I7bxz9s1TKcADX5JBRnQ.png"/></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">49.33 MBç”¨äºåŸºæœ¬æ˜ åƒå’Œåº“ï¼Œ97.8 MBç”¨äºåº”ç”¨ç¨‹åº</figcaption></figure><p id="f049" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">ä¸ä¹‹å‰çš„ç›¸æ¯”ï¼Œæˆ‘ä»¬é€šè¿‡ä½¿ç”¨ä¸€ä¸ªè½»é‡çº§çš„Linuxæ˜ åƒæ¥ç¼©å°æ˜ åƒçš„å¤§å°ã€‚çš„ã€‚NET runtimeåŠ å…¥è‡ªå¸¦appï¼Œèƒ½ä¸èƒ½åšå°ä¸€ç‚¹ï¼Ÿ</p><h2 id="4f7a" class="ml mm it bd mn mo mp dn mq mr ms dp mt ld mu mv mw lh mx my mz ll na nb nc nd bi translated">4)ç»„åˆç‹¬ç«‹å’ŒIL-æ¥å¤´</h2><p id="f5fb" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">IL-Linkeræ˜¯ä»€ä¹ˆï¼Ÿ</p><blockquote class="oj ok ol"><p id="9663" class="ku kv om kw b kx ky ju kz la lb jx lc on le lf lg oo li lj lk op lm ln lo lp im bi translated">ILé“¾æ¥å™¨æ˜¯ä¸€ç§å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥åªä¼ é€ä¸€ç»„ç¨‹åºè¿è¡Œå¯èƒ½éœ€è¦çš„æœ€å°‘ILä»£ç å’Œå…ƒæ•°æ®ï¼Œè€Œä¸æ˜¯å®Œæ•´çš„åº“ã€‚</p><p id="9e51" class="ku kv om kw b kx ky ju kz la lb jx lc on le lf lg oo li lj lk op lm ln lo lp im bi translated">å„ç§Xamarinäº§å“ä½¿ç”¨å®ƒæ¥æå–åœ¨Androidã€iOSå’Œå…¶ä»–å¹³å°ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€çš„ä»£ç ã€‚</p><p id="41bc" class="ku kv om kw b kx ky ju kz la lb jx lc on le lf lg oo li lj lk op lm ln lo lp im bi translated">â€”<a class="ae ns" href="https://github.com/mono/linker" rel="noopener ugc nofollow" target="_blank">https://github.com/mono/linker</a></p></blockquote><p id="b526" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">IL-Linkerå·²ç»åŒ…å«åœ¨ä¸­ã€‚NET SDKï¼Œå› ä¸º<a class="ae ns" href="https://github.com/dotnet/core/blob/master/samples/linker-instructions.md" rel="noopener ugc nofollow" target="_blank">å®ƒè¯´</a>å®ƒå¯ä»¥å‡å°‘ã€‚å‡€æ ¸å¿ƒåº”ç”¨è¾¾åˆ°50%ã€‚</p><p id="56d8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">è¦ä½¿ç”¨il-linkerï¼Œåªéœ€å°†<code class="fe nj nk nl nm b">/p:PublishTrimmed=true</code>æ ‡å¿—ä¼ é€’ç»™publishå‘½ä»¤ã€‚</p><pre class="kj kk kl km gt nt nm nu nv aw nw bi"><span id="1b3c" class="ml mm it nm b gy nx ny l nz oa">dotnet publish -c Release -r alpine-x64 --self-contained true /p:PublishTrimmed=true -o ./publish</span></pre><p id="9385" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">ç”±äºILé“¾æ¥å™¨è¿›ç¨‹çš„åŸå› ï¼Œè¿™éœ€è¦æ›´é•¿çš„æ—¶é—´ã€‚ç»“æœéåŒå‡¡å“ï¼</p><p id="071e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="om"> 226ä¸ªæ–‡ä»¶å’Œ</em> <strong class="kw iu"> <em class="om"> 53.3 MB </em> </strong> <em class="om">ï¼Œç®€ç›´æ˜¯</em><strong class="kw iu"><em class="om">45%</em></strong><em class="om"/><strong class="kw iu">âœŒ</strong></p><h2 id="3e4d" class="ml mm it bd mn mo mp dn mq mr ms dp mt ld mu mv mw lh mx my mz ll na nb nc nd bi translated">4â€“1)ä½¿ç”¨ä¹‹å‰çš„æ–‡æ¡£å¯¹å…¶è¿›è¡Œå½’æ¡£</h2><pre class="kj kk kl km gt nt nm nu nv aw nw bi"><span id="6903" class="ml mm it nm b gy nx ny l nz oa">docker build -t web3 -f Dockerfile .</span></pre><p id="d824" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">æµ‹é‡å›¾åƒå°ºå¯¸:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/839a41ea30e87f316249c3745c6cf9b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gB438IhgqMJuPDvo9EsHSg.png"/></div></div></figure><pre class="kj kk kl km gt nt nm nu nv aw nw bi"><span id="3dee" class="ml mm it nm b gy nx ny l nz oa">docker history web3:latest</span><span id="249a" class="ml mm it nm b gy of ny l nz oa"># result</span><span id="8393" class="ml mm it nm b gy of ny l nz oa">/bin/sh -c #(nop)  ENTRYPOINT ["./MyWebApp" â€¦   0B<br/>/bin/sh -c #(nop) COPY dir:80b91cb154520a076â€¦   55.9MB<br/>/bin/sh -c #(nop) WORKDIR /app                  0B<br/>/bin/sh -c #(nop)  EXPOSE 443                   0B<br/>/bin/sh -c #(nop)  EXPOSE 80                    0B<br/>/bin/sh -c apk add --no-cache     openssh liâ€¦   43.8MB<br/>/bin/sh -c #(nop)  CMD ["/bin/sh"]              0B<br/>/bin/sh -c #(nop) ADD file:a86aea1f3a7d68f6aâ€¦   5.53MB</span></pre><p id="84d8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">è‡ªå¸¦55.9MBï¼ŒAlpineå’Œlibs 49.33 MBã€‚<strong class="kw iu">æ¯”é»˜è®¤å›¾åƒå°49.52%ã€‚</strong></p><h2 id="d4ae" class="ml mm it bd mn mo mp dn mq mr ms dp mt ld mu mv mw lh mx my mz ll na nb nc nd bi translated">5)ç§»é™¤é˜¿å°”å‘æ–¯å±±çš„libå’ŒåŒ…è£…</h2><p id="40bf" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">æˆ‘ä»¬ä¸ºAlpineå®‰è£…äº†æ‰€éœ€çš„åº“ã€‚ç½‘èŠ¯ã€‚å¾®è½¯çš„è¿™ä¸ªæ–‡æ¡£è¯´è¿™äº›æ–‡æ¡£åªæ˜¯RHEL6éœ€è¦çš„ã€‚æ—¢ç„¶æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯Alpineï¼Œé‚£ä¹ˆè®©æˆ‘ä»¬è¯•ç€ç§»é™¤å®ƒä»¬ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><pre class="kj kk kl km gt nt nm nu nv aw nw bi"><span id="2a1b" class="ml mm it nm b gy nx ny l nz oa"># RUN apk add --no-cache \ <br/>#     openssh libunwind \<br/>#     nghttp2-libs libidn krb5-libs libuuid lttng-ust zlib \<br/>#     libstdc++ libintl \<br/>#     icu</span></pre><p id="2a5f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">ç¬¬ä¸€æ¬¡å°è¯•:</strong></p><pre class="kj kk kl km gt nt nm nu nv aw nw bi"><span id="211d" class="ml mm it nm b gy nx ny l nz oa">Error loading shared library libstdc++.so.6: No such file or directory (needed by ./MyWebApp)<br/>Error loading shared library libgcc_s.so.1: No such file or directory (needed by ./MyWebApp)</span></pre><p id="5e31" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">éœ€è¦âœ” <a class="ae ns" href="https://pkgs.alpinelinux.org/package/edge/main/x86_64/libstdc++" rel="noopener ugc nofollow" target="_blank"> libstdc++ </a>åŒ…ã€‚</p><p id="9292" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">å®‰è£…äº†libstdc++ libçš„ç¬¬äºŒæ¬¡å°è¯•:</strong></p><pre class="kj kk kl km gt nt nm nu nv aw nw bi"><span id="c36f" class="ml mm it nm b gy nx ny l nz oa">Failed to load ï¿½a)ï¿½V, error: Error loading shared library libintl.so.8: No such file or directory (needed by /app/libcoreclr.so)<br/>Failed to bind to CoreCLR at '/app/'<br/>Failed to create CoreCLR, HRESULT: 0x80008088</span></pre><p id="3d29" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">âœ” <a class="ae ns" href="https://pkgs.alpinelinux.org/package/edge/main/x86/libintl" rel="noopener ugc nofollow" target="_blank"> libintl </a>åŒ…ä¹Ÿæ˜¯éœ€è¦çš„ã€‚</p><p id="d8cb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">å®‰è£…äº†libstdc++å’Œlibintlåå†å°è¯•:</strong></p><pre class="kj kk kl km gt nt nm nu nv aw nw bi"><span id="4e00" class="ml mm it nm b gy nx ny l nz oa">Process terminated. Couldn't find a valid ICU package installed on the system. Set the configuration flag ystem.Globalization.Invariant to true if you want to run with no globalization support.</span></pre><p id="a8a4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">çœ‹æ¥éœ€è¦<a class="ae ns" href="https://pkgs.alpinelinux.org/package/edge/main/x86/icu" rel="noopener ugc nofollow" target="_blank"> icu </a>åŒ…ã€‚ä½ å¯ä»¥åšä¸¤ä»¶äº‹:</p><ol class=""><li id="7753" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">æ²¿ç€<strong class="kw iu"> libstdc++ </strong>å’Œ<strong class="kw iu"> libintlå®‰è£…<strong class="kw iu"> icu </strong>åŒ…ã€‚</strong></li><li id="8a8c" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">å°†åº”ç”¨ç¨‹åºé…ç½®ä¸ºå¯¹åŒºåŸŸæ€§ä¸å˜ã€‚(å½“ç„¶ï¼Œå¦‚æœå…¨çƒåŒ–ä¸æ˜¯æ‚¨çš„åº”ç”¨ç¨‹åºçš„é€‰é¡¹)</li></ol><p id="526c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">ä¸icuåŒ…ä¸€èµ·çš„è¿˜æœ‰é‚£ä¸¤ä¸ª:</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="2ea6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">å¸¦<strong class="kw iu">æ‰€éœ€</strong>åº“çš„å›¾åƒå¤§å°:94.8MB <strong class="kw iu"> <em class="om">ã€‚</em> </strong> <strong class="kw iu">æ¯”ä¸Šä¸€æ¬¾å°10.2 MB </strong>ã€‚</p><p id="9c8c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">å°†åº”ç”¨ç¨‹åºé…ç½®ä¸ºè¿è¡Œå›ºå®šæ–‡åŒ–æ¨¡å¼æ€ä¹ˆæ ·ï¼Ÿ</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/956ae9d35ab28f7b52297a91f3c8fe9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Un8xa5QL6QUG94Lpw1lcQ.png"/></div></div></figure><p id="1194" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">å›¾åƒå¤§å°å°†ä¸º<strong class="kw iu"> 63MB </strong>(å¯èƒ½çš„æœ€å°å°ºå¯¸ğŸ˜‰).ç°åœ¨æ‚¨éœ€è¦å°†ä¸€ä¸ªç¯å¢ƒå˜é‡ä¼ é€’ç»™ã€‚NET for CultureInvarienté€‰é¡¹ã€‚</p><p id="a8aa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">ç¯å¢ƒå˜é‡:<strong class="kw iu">dot net _ SYSTEM _ GLOBALIZATION _ INVARIANT = 1</strong></p><pre class="kj kk kl km gt nt nm nu nv aw nw bi"><span id="e0cd" class="ml mm it nm b gy nx ny l nz oa">docker run <strong class="nm iu">-e DOTNET_SYSTEM_GLOBALIZATION_INVARIANT=1</strong> -p 8080:80 web5</span><span id="bc4e" class="ml mm it nm b gy of ny l nz oa">#result</span><span id="b7e0" class="ml mm it nm b gy of ny l nz oa">&gt; docker run -e DOTNET_SYSTEM_GLOBALIZATION_INVARIANT=1 -p 8080:80 web5</span><span id="746b" class="ml mm it nm b gy of ny l nz oa">info: Microsoft.Hosting.Lifetime[0]<br/>      Now listening on: <a class="ae ns" href="http://0.0.0.0:80" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:80</a><br/>info: Microsoft.Hosting.Lifetime[0]<br/>      Application started. Press Ctrl+C to shut down.<br/>info: Microsoft.Hosting.Lifetime[0]<br/>      Hosting environment: Production<br/>info: Microsoft.Hosting.Lifetime[0]<br/>      Content root path: /app</span></pre><p id="33d4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">å·¥ä½œæ­£å¸¸ï¼Œå°ºå¯¸ç¼©å°äº†70%å·¦å³çš„âœŒ ï¼</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="a38d" class="ml mm it bd mn mo mp dn mq mr ms dp mt ld mu mv mw lh mx my mz ll na nb nc nd bi translated">ç»“è®º</h2><p id="bd68" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">æˆ‘å–œæ¬¢Alpine Linuxå› ä¸ºå®ƒçœŸçš„å¾ˆè½»ï¼Œè€Œä¸”éƒ¨ç½²é€Ÿåº¦æ›´å¿«ã€‚</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/76ea6d594334f3d592a6020745a60101.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4LkaC-Cqm46uHaib8QtW_Q.png"/></div></div></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="d552" class="ml mm it bd mn mo mp dn mq mr ms dp mt ld mu mv mw lh mx my mz ll na nb nc nd bi translated">ä½ æƒ³è¦æ›´å¤šå—ï¼Ÿ</h2><p id="b0ee" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">è‡ªåŒ…å«éƒ¨ç½²å°†ç”Ÿæˆå¤§é‡æ–‡ä»¶(+200ä¸ªæ–‡ä»¶)ã€‚æˆ‘å¹¶ä¸è®¤ä¸ºè¿™æ˜¯ä¸€ä»¶çœŸæ­£æ•´æ´çš„äº‹æƒ…ï¼Œå¦ä¸€æ–¹é¢ï¼ŒDocker copyå‘½ä»¤éœ€è¦ä¸€ç‚¹æ—¶é—´æ¥å¤åˆ¶2-300ä¸ªæ–‡ä»¶ã€‚</p><p id="7270" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">publishå‘½ä»¤æ”¯æŒå•æ–‡ä»¶éƒ¨ç½²ï¼Œè¿™æ„å‘³ç€å®ƒå°†ä¸ºæ•´ä¸ªåº”ç”¨ç¨‹åºç”Ÿæˆä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p><p id="8b13" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">ä½¿ç”¨<code class="fe nj nk nl nm b">/p:PublishSingleFile=true</code>æ ‡å¿—ï¼Œå‘å¸ƒè€…å°†åªå‘å¸ƒä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p><pre class="kj kk kl km gt nt nm nu nv aw nw bi"><span id="4258" class="ml mm it nm b gy nx ny l nz oa">dotnet publish --runtime alpine-x64 -c Release --self-contained true -o ./publish <em class="om">/p:PublishSingleFile=true </em>/p:PublishTrimmed=true</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/6840fec810dbe6e99608458e8e430dfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2HTzghKC27qtg_-wXE1Jew.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶+é…ç½®æ–‡ä»¶</figcaption></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="98c4" class="ml mm it bd mn mo mp dn mq mr ms dp mt ld mu mv mw lh mx my mz ll na nb nc nd bi translated">é‡è¦è¯´æ˜</h2><p id="5939" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">å¦‚æœä½ ä½¿ç”¨åƒ<code class="fe nj nk nl nm b">Assymbly.Load('System.Security')</code>è¿™æ ·çš„åŠ¨æ€ç¨‹åºé›†åŠ è½½ï¼Œä¸è¦å¿˜è®°é…ç½®IL-Linkerï¼Œä¹Ÿä¸è¦ä¿®æ”¹é‚£äº›ç¨‹åºé›†ã€‚</p><p id="b740" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯ç¼–è¾‘<strong class="kw iu"> csproj </strong>æ–‡ä»¶å¹¶æ·»åŠ :</p><pre class="kj kk kl km gt nt nm nu nv aw nw bi"><span id="baef" class="ml mm it nm b gy nx ny l nz oa">&lt;ItemGroup&gt;<br/>  &lt;TrimmerRootAssembly Include="System.Security" /&gt;<br/>&lt;/ItemGroup&gt;</span></pre></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="568a" class="ml mm it bd mn mo mp dn mq mr ms dp mt ld mu mv mw lh mx my mz ll na nb nc nd bi translated">æ›´æ–°1:</h2><p id="96ab" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">æœ‰äººæåˆ°æˆ‘ï¼Œå¾®è½¯å·²ç»ä¸ºSDKå’Œã€‚åŸºäºAlpineçš„ç½‘èŠ¯ã€‚ä¸ºä»€ä¹ˆæˆ‘æ²¡æœ‰ç”¨å®ƒä»¬ï¼Ÿ</p><p id="e027" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">ä¾‹å¦‚ï¼Œè¿™æ˜¯åŸºäºAlpineçš„ASPNETæ ¸å¿ƒè¿è¡Œæ—¶çš„<a class="ae ns" href="https://github.com/dotnet/dotnet-docker/blob/d4a9e799d047f3e86cd2730f48b689c371d38480/3.1/aspnet/alpine3.10/amd64/Dockerfile" rel="noopener ugc nofollow" target="_blank"> dockeræ–‡ä»¶</a>:</p><pre class="kj kk kl km gt nt nm nu nv aw nw bi"><span id="9052" class="ml mm it nm b gy nx ny l nz oa">ARG REPO=mcr.microsoft.com/dotnet/core/runtime<br/>FROM $REPO:3.1-alpine3.10</span><span id="bef8" class="ml mm it nm b gy of ny l nz oa"># Install ASP.NET Core<br/>RUN aspnetcore_version=3.1.0 \<br/>    &amp;&amp; wget -O aspnetcore.tar.gz <a class="ae ns" href="https://dotnetcli.azureedge.net/dotnet/aspnetcore/Runtime/$aspnetcore_version/aspnetcore-runtime-$aspnetcore_version-linux-musl-x64.tar.gz" rel="noopener ugc nofollow" target="_blank">https://dotnetcli.azureedge.net/dotnet/aspnetcore/Runtime/$aspnetcore_version/aspnetcore-runtime-$aspnetcore_version-linux-musl-x64.tar.gz</a> \<br/>    &amp;&amp; aspnetcore_sha512='fa5e4ae71134a8a6db4ad6a247d3e31406673e03f0a64f7faaad3d84cfb3b70d2cf69e9d9abc1f8688138907d4ddd37cd908669999d85a87892e164053c63847' \<br/>    &amp;&amp; echo "$aspnetcore_sha512  aspnetcore.tar.gz" | sha512sum -c - \<br/>    &amp;&amp; tar -ozxf aspnetcore.tar.gz -C /usr/share/dotnet ./shared/Microsoft.AspNetCore.App \<br/>    &amp;&amp; rm aspnetcore.tar.gz</span><span id="403c" class="ml mm it nm b gy of ny l nz oa">EXPOSE 80<br/>EXPOSE 443</span><span id="858f" class="ml mm it nm b gy of ny l nz oa"># Copy <br/>WORKDIR /app<br/>COPY ./publish ./</span><span id="41c4" class="ml mm it nm b gy of ny l nz oa">ENTRYPOINT ["dotnet", "MyWebApp.dll"]</span></pre><p id="dd9f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">å¦‚æœæˆ‘æ„å»ºé¡¹ç›®æ¡†æ¶ä¾èµ–å¹¶æ„å»ºè¿™ä¸ªdockeræ˜ åƒï¼Œé‚£ä¹ˆæ˜ åƒå¤§å°å°†ä¸º<strong class="kw iu"> 105MB </strong>ã€‚</p><pre class="kj kk kl km gt nt nm nu nv aw nw bi"><span id="e7ba" class="ml mm it nm b gy nx ny l nz oa">docker history alp-1</span><span id="ab61" class="ml mm it nm b gy of ny l nz oa">CREATED BY                                      SIZE     <br/>/bin/sh -c #(nop)  ENTRYPOINT ["dotnet" "MyWâ€¦   0B<br/>/bin/sh -c #(nop) COPY dir:36b502377fe8f29beâ€¦   289kB<br/>/bin/sh -c #(nop) WORKDIR /app                  0B<br/>/bin/sh -c #(nop)  EXPOSE 443                   0B<br/>/bin/sh -c #(nop)  EXPOSE 80                    0B<br/>/bin/sh -c aspnetcore_version=3.1.0     &amp;&amp; wâ€¦   17.8MB<br/>/bin/sh -c dotnet_version=3.1.0     &amp;&amp; wget â€¦   77.2MB<br/>/bin/sh -c #(nop)  ENV ASPNETCORE_URLS=http:â€¦   0B<br/>/bin/sh -c apk add --no-cache     ca-certifiâ€¦   4.08MB<br/>/bin/sh -c #(nop)  CMD ["/bin/sh"]              0B<br/>/bin/sh -c #(nop) ADD file:fe1f09249227e2da2â€¦   5.55MB</span></pre><p id="ff24" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">å¦‚æ‚¨æ‰€è§ï¼Œ<strong class="kw iu"> 95MBçš„ã€‚NETå’ŒASPNETæ ¸å¿ƒï¼Œ<strong class="kw iu"> 4.08MB </strong>ç”¨äºlibsï¼Œ<strong class="kw iu"> 5.55MB </strong>ç”¨äºAlpineæœ¬èº«ã€‚åœ¨æˆ‘çš„è§£å†³æ–¹æ¡ˆä¸­ï¼Œæˆ‘åªéƒ¨ç½²äº†éƒ¨åˆ†ä»£ç ã€‚NETæ˜¯appæ‰€éœ€è¦çš„ï¼Œå› ä¸ºIL-Linkerå»æ‰äº†ä¸å¿…è¦/ä¸ç”¨çš„éƒ¨åˆ†ã€‚ä¸<strong class="kw iu"> 105MB </strong>ç›¸æ¯”ï¼Œ<strong class="kw iu"> 94MB </strong>æˆ–<strong class="kw iu"> 63MB </strong>æ›´å°ã€‚</strong></p><p id="e9b7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">å½“ç„¶ï¼ŒåŸºäºMicrosoft Alpineçš„docker imageå¯¹äºéƒ¨ç½²æ¥è¯´æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œä½†æ˜¯ä¸ºæ‚¨çš„é¡¹ç›®é€‰æ‹©ä»€ä¹ˆå§‹ç»ˆå–å†³äºæ‚¨è‡ªå·±ã€‚</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="f11e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">ç¥æ‚¨å¥½è¿ğŸ˜‰</p></div></div>    
</body>
</html>