# å¦‚ä½•ä½¿ç”¨ Webpack æ„å»ºå’Œå‘å¸ƒ NPM åŒ…

> åŸæ–‡ï¼š<https://itnext.io/how-to-build-and-publish-npm-packages-with-webpack-dea19bb14627?source=collection_archive---------0----------------------->

![](img/02bb08c9bb6422bba56c22720f1a4655.png)

ç…§ç‰‡ç”±[æ½˜å¡æ°Â·å¸•ç‰¹å°”](https://unsplash.com/@pankajpatel?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)åœ¨ [Unsplash](https://unsplash.com/s/photos/npm?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) æ‹æ‘„

# åº

æœ€è¿‘æˆ‘å‘è¡¨äº†æˆ‘çš„ç¬¬ä¸€ä¸ª NPM åŒ…ğŸ˜Šè¿™äº›æ˜¯æˆ‘é‡åˆ°çš„é—®é¢˜ï¼Œæˆ‘æ˜¯è¿™æ ·è§£å†³çš„ã€‚

æˆ‘çš„åº“æ˜¯æ»‘åŠ¨äº‹ä»¶çš„äº‹ä»¶ç›‘å¬å™¨çš„åº•å±‚å®ç°ã€‚å‡ å¹´å‰æˆ‘ç¬¬ä¸€æ¬¡ç¼–å†™ä»£ç ï¼Œå³ä½¿ä»Šå¤©æœ‰å…¶ä»–è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•ï¼Œæˆ‘ä»ç„¶æƒ³å¯¹å®ƒè¿›è¡Œä¸€ç‚¹æ”¹è¿›å¹¶å°†å…¶å…¬å¼€ã€‚è¿™æ ·ï¼Œæˆ‘ä¹Ÿä¸ºå¼€æºç¤¾åŒºå¸¦æ¥æˆ‘çš„ä¸€ç‚¹ç‚¹è´¡çŒ®ã€‚

å°½ç®¡é¢å¤–çš„ç‰¹æ€§å’ŒåŒ…è£…å¹¶æ²¡æœ‰è®©æˆ‘èŠ±å¾ˆé•¿æ—¶é—´å»å®ç°å®ƒä»¬ï¼Œä½†æ˜¯ï¼Œæˆ‘èŠ±äº†åŒæ ·é•¿çš„æ—¶é—´æ‰å¼„æ˜ç™½å¦‚ä½•æ­£ç¡®åœ°éƒ¨ç½²å®ƒã€‚

æˆ‘çš„è½¯ä»¶åŒ…çš„å½“å‰ç‰ˆæœ¬æ˜¯ **1.0.3** ï¼Œè¿™åªæ˜¯å› ä¸º **1.0.0** ã€ **1.0.1** å’Œ **1.0.2** åªæ˜¯å¤±è´¥çš„ç‰ˆæœ¬â€¦

æˆ‘èŠ±äº†ä¸€æ®µæ—¶é—´æ‰å¼„æ˜ç™½å¦‚ä½•å¯¼å‡ºæˆ‘çš„åº“ï¼Œå¹¶ä½¿å®ƒæ—¢å¯ä»¥åœ¨å…¨å±€èŒƒå›´(çª—å£)å†…ä½¿ç”¨ï¼Œåˆå¯ä»¥ä½œä¸ºä¸€ä¸ªæ¨¡å—å¯¼å…¥ã€‚æ›´ä¸ç”¨è¯´ NPM çº²é¢†çš„ç‰¹æ®Šæ€§äº†ã€‚

å› æ­¤ï¼Œæ²¡æœ‰ä»»ä½•è¿›ä¸€æ­¥çš„è®¨è®ºï¼Œè¿™é‡Œæ˜¯æˆ‘çš„æ•´ä¸ªå·¥ä½œæµç¨‹ï¼Œä½ æ€ä¹ˆèƒ½åšåˆ°è¿™ä¸€ç‚¹ã€‚

# é£Ÿè°±

## ä¸€.é¡¹ç›®è®¾ç½®

æˆ‘çš„å‰ç«¯å †æ ˆå¯¹äº web åº”ç”¨ç¨‹åºæ¥è¯´æ˜¯æœ‰è§’åº¦çš„â€”â€”*æˆ‘è®¤ä¸º web åº”ç”¨ç¨‹åºæ˜¯åŒ…å«ç”¨æˆ·ç”Ÿæˆå†…å®¹çš„ç½‘ç«™*â€”â€”å¯¹äºæ‰€æœ‰å…¶ä»–çš„ï¼Œå°è„šæœ¬æˆ–ç®€å•çš„é™æ€å†…å®¹ç½‘ç«™ï¼Œå°±åƒæˆ‘çš„ä¸ªäººç½‘ç«™ [georgianstan.ro](https://georgianstan.ro) ä¸€æ ·ï¼Œæˆ‘ä½¿ç”¨ TypeScriptã€SCSS å’Œ PUG ä»¥åŠ Webpackã€‚

æˆ‘æ›´å–œæ¬¢è¿™ä¸€å ï¼Œå› ä¸ºå®ƒä¸ä»…èƒ½è®©ä½ å¿«é€Ÿç§»åŠ¨ï¼Œè¿˜èƒ½å¸®åŠ©ä½ æ»¡è¶³ä¸€ä¸ªå¥½çš„ NPM å¥—é¤çš„æ‰€æœ‰è¦æ±‚ã€‚

*   å¦‚æœä»£ç ä½¿ç”¨`<script src=".."></script>`æ ‡ç­¾é“¾æ¥ï¼Œåˆ™åœ¨å…¨å±€èŒƒå›´å†…å¯ç”¨
*   å¦‚æœä»£ç æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œä½¿ç”¨`import`æˆ–`require`å¯ç”¨
*   å®ƒæ”¯æŒç±»å‹è„šæœ¬

è¿™æ˜¯ä¸€ä¸ªçº¯ç²¹çš„ä¸ªäººé—®é¢˜:

*   å¦‚æœæœ‰ä»»ä½•æ ·å¼ä»£ç (CSS)ï¼Œé‚£ä¹ˆå®ƒç”± JavaScript æ–‡ä»¶åŒ…å«å’Œç®¡ç†ï¼›è¿™æ ·ï¼Œæˆ‘åªéœ€è¦åœ¨æˆ‘çš„é¡¹ç›®ä¸­å¯¼å…¥ä¸€ä¸ªæ–‡ä»¶

ä¸ºäº†ä¸è®©è¿™ç¯‡æ–‡ç« æ¯«æ— ç†ç”±åœ°å˜å¾—å†—é•¿ï¼Œæˆ‘å†³å®šå°†æ‰€æœ‰ä»£ç æ‰“åŒ…åˆ°ä¸€ä¸ª GitHub é¡¹ç›®ä¸­ï¼Œè¿™ä¸ªé¡¹ç›®æ˜¯æˆ‘ä»¬è¯•å›¾å®Œæˆçš„å·¥ä½œçš„æ ·æ¿/æ¡†æ¶ï¼ŒåŸºäºå®ƒï¼Œæˆ‘å°†è§£é‡Šé‡è¦çš„éƒ¨åˆ†ğŸ˜Šã€‚

ç»§ç»­å¹¶[ä¸‹è½½](https://github.com/GeoPablo/framework-for-building-libraries)è¯¥åº“æˆ–æŸ¥çœ‹è¿™é‡Œçš„ä»£ç ç¤ºä¾‹ã€‚

![](img/d8e4e6b10afbc360906b76ce58a79f7f.png)

é¡¹ç›®ç»“æ„

æ–‡ä»¶å’Œæ–‡ä»¶å¤¹è¯´æ˜:

*   **dist â€”** æˆ‘ä»¬ä»£ç çš„åˆ†å‘
*   **src â€”** è¿™é‡Œæˆ‘ä»¬å°†ä¸ºæˆ‘ä»¬çš„åº“ç¼–å†™ä»£ç 
*   **æµ‹è¯•â€”** æˆ‘ä»¬ä»£ç çš„æµ‹è¯•æ–‡ä»¶å¤¹
*   **ã€‚npmignore â€”** åŒ**ã€‚gitignoreï¼Œ**ä½†æ˜¯å¯¹äº npm å½“æˆ‘ä»¬å‘å¸ƒæˆ‘ä»¬çš„åŒ…æ—¶è¦å¿½ç•¥å“ªäº›æ–‡ä»¶
*   **index.htmlâ€”**å¦‚æœä½ æƒ³åœ¨æµè§ˆå™¨ä¸Šæ‰‹åŠ¨æµ‹è¯•ä½ çš„ä»£ç 
*   **postcss.config.js â€”** è‡ªåŠ¨åŒ–å¸¸è§„ css æ“ä½œï¼›é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒè¢«é…ç½®ä¸ºå¯¹ CSS ä½¿ç”¨[è‡ªåŠ¨ä¿®å¤ç¨‹åº](https://autoprefixer.github.io/)
*   **jest.config.js** å’Œ**setup Jest . tsâ€”**Jest çš„é…ç½®è§„åˆ™ï¼Œç”¨äºæµ‹è¯•
*   **ts config . JSONâ€”**TypeScript çš„é…ç½®è§„åˆ™
*   **webpack.config.js â€”** æˆ‘ä»¬çš„ä»£ç æ†ç»‘å™¨çš„é…ç½®è§„åˆ™

å…¶ä»–çš„:

*   **.eslintrc.js** ï¼Œ**ã€‚æ—æŒºå’Œä»£ç æ ¼å¼çš„è§„åˆ™**

## äºŒã€‚NPM é…ç½®

è¦æ„å»ºä¸€ä¸ªæœ‰æ•ˆçš„ NPM åŒ…ï¼Œéœ€è¦åœ¨ **package.json** ä¸­æ·»åŠ ä»¥ä¸‹å±æ€§:

```
"main": "./dist/my-library.js",
"types": "./dist/my-library.d.ts",
"files": [
    "dist"
],
```

è¿™äº›å±æ€§è¡¨ç¤ºä¸»æ–‡ä»¶çš„è·¯å¾„åŠå…¶æ•°æ®ç±»å‹(å¦‚æœæœ‰çš„è¯)ã€‚

## ä¸‰ã€‚ç±»å‹è„šæœ¬é…ç½®

æˆ‘ä»¬çŸ¥é“ **tsconfig.json** ç”¨äºé…ç½® TypeScriptã€‚ä¸ºäº†ä¸ºæ‚¨çš„ä»£ç å‘å‡ºç±»å‹ï¼Œæ‚¨éœ€è¦åšçš„å°±æ˜¯åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­çš„**compile options**å±æ€§å†…æ·»åŠ ä»¥ä¸‹å±æ€§ã€‚

```
â€œdeclarationâ€: true
```

## å››ã€‚Webpack é…ç½®

å¯¹äº Webpackï¼Œæœ€é‡è¦çš„é…ç½®ç”±ä»¥ä¸‹é€‰é¡¹è¡¨ç¤º:

![](img/489dd2cde05bd3de0a45d3377ad9f9f4.png)

[æ­¤å¤„ä»£ç ](https://carbon.now.sh/?bg=rgba(171%2C%20184%2C%20195%2C%201)&t=seti&wt=none&l=javascript&ds=true&dsyoff=20px&dsblur=68px&wc=true&wa=true&pv=56px&ph=56px&ln=false&fl=1&fm=Hack&fs=14px&lh=133%25&si=false&es=2x&wm=false&code=%2520%2520target%253A%2520%27web%27%252C%250A%2520%2520entry%253A%2520%257B%250A%2520%2520%2520%2520index%253A%2520%27.%252Fsrc%252Fmy-library.ts%27%252C%250A%2520%2520%257D%252C%250A%2520%2520output%253A%2520%257B%250A%2520%2520%2520%2520path%253A%2520path.resolve(__dirname%252C%2520%27.%252Fdist%27)%252C%250A%2520%2520%2520%2520filename%253A%2520%27my-library.js%27%252C%250A%2520%2520%2520%2520library%253A%2520%27MyLibrary%27%252C%250A%2520%2520%2520%2520libraryTarget%253A%2520%27umd%27%252C%250A%2520%2520%2520%2520globalObject%253A%2520%27this%27%252C%250A%2520%2520%2520%2520umdNamedDefine%253A%2520true%252C%250A%2520%2520%257D%252C)

*   **ç›®æ ‡â€”** æ ¹æ®æ‚¨çš„ä»£ç å°†è¢«ä½¿ç”¨çš„ç¯å¢ƒï¼Œä½¿ç”¨`web`æˆ–`node`
*   **å…¥å£â€”** æˆ‘ä»¬å›¾ä¹¦é¦†çš„å…¥å£ç‚¹
*   **output.filename â€”** åˆ†å‘ä»£ç çš„æ–‡ä»¶å
*   **output.library â€”** è¿™å°†æ˜¯è¦å¯¼å‡ºçš„å¯¹è±¡çš„åç§°

å±æ€§ **libraryTarget** ç”¨äºæŒ‡ç¤ºå°†ä½¿ç”¨ä»€ä¹ˆå…¨å±€å¯¹è±¡æ¥æŒ‚è½½åº“ã€‚ä¸ºäº†ä½¿åº“æ„å»ºåœ¨æµè§ˆå™¨å’Œ Node.js ä¸Šéƒ½å¯ç”¨ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† **output.globalObject** é€‰é¡¹æ¥é€‰æ‹©`'this'`ã€‚`'this'`è¡¨ç¤ºç¯å¢ƒçš„å…¨å±€å¯¹è±¡ï¼Œåœ¨ç½‘ç»œæµè§ˆå™¨çš„æƒ…å†µä¸‹`'this'`å°†æ˜¯å¯¹è±¡`window`ã€‚

ç®€å•åœ°è¯´ï¼Œå¦‚æœæˆ‘ä»¬çš„åº“ä»£ç çœ‹èµ·æ¥åƒè¿™æ ·:

![](img/33a749858aa9fa54527bbaa1f72e3d68.png)

[æ­¤å¤„ä»£ç ](https://carbon.now.sh/?bg=rgba(171%2C%20184%2C%20195%2C%201)&t=seti&wt=none&l=javascript&ds=true&dsyoff=20px&dsblur=68px&wc=true&wa=true&pv=56px&ph=56px&ln=false&fl=1&fm=Hack&fs=14px&lh=133%25&si=false&es=2x&wm=false&code=enum%2520ErrorMessages%2520%257B%250A%2520%2520INVALID_NUMBER%2520%253D%2520%27Number%2520must%2520be%2520greater%2520then%25201%27%252C%250A%257D%250A%250A%252F%252F%2520*%2520A%2520prime%2520number%2520is%2520a%2520natural%2520number%2520greater%2520than%25201%2520that%2520is%2520not%2520a%2520product%2520of%2520two%2520smaller%2520natural%2520numbers.%250Aconst%2520isPrimeNumber%2520%253D%2520(num%253A%2520number)%253A%2520boolean%2520%257C%2520never%2520%253D%253E%2520%257B%250A%2520%2520let%2520isPrime%2520%253D%2520true%253B%250A%250A%2520%2520if%2520(num%2520%253C%253D%25201)%2520%257B%250A%2520%2520%2520%2520throw%2520new%2520Error(ErrorMessages.INVALID_NUMBER)%253B%250A%2520%2520%257D%250A%250A%2520%2520if%2520(num%2520%253D%253D%253D%25202)%2520%257B%250A%2520%2520%2520%2520return%2520isPrime%253B%250A%2520%2520%257D%250A%250A%2520%2520for%2520(let%2520i%2520%253D%25202%253B%2520i%2520%253C%253D%2520num%2520%252F%25202%253B%2520i%252B%252B)%2520%257B%250A%2520%2520%2520%2520if%2520(num%2520%2525%2520i%2520%253D%253D%253D%25200)%2520%257B%250A%2520%2520%2520%2520%2520%2520isPrime%2520%253D%2520false%253B%250A%2520%2520%2520%2520%257D%250A%2520%2520%257D%250A%250A%2520%2520return%2520isPrime%253B%250A%257D%253B%250A%250Aexport%2520%257B%2520isPrimeNumber%252C%2520ErrorMessages%2520%257D%253B%250A)

é‚£ä¹ˆå‰é¢çš„è§„åˆ™å°†å…è®¸æˆ‘ä»¬è¿™æ ·åš

**ã€‚html** æ–‡ä»¶

```
<script src="./dist/my-library.js"></script><script>
   const { isPrimeNumber } = window.MyLibrary;
</script>
```

ä½†æ˜¯è¿˜æœ‰è¿™ä¸ª

**ã€‚js** æˆ–**ã€‚ts** æ–‡ä»¶

```
import { isPrimeNumber } from 'npm-package-name *or* path-to-the-file';
```

ä½ å¯ä»¥åœ¨ä»–ä»¬çš„[å®˜æ–¹æ–‡æ¡£é¡µé¢](https://webpack.js.org/configuration/output/#outputlibrarytarget)ä¸Šäº†è§£æ›´å¤šã€‚

## åŠ¨è¯ ï¼ˆverb çš„ç¼©å†™ï¼‰å‘å¸ƒä»£ç 

è¦å‘å¸ƒä»£ç ï¼Œè¯·æ‰“å¼€ç»ˆç«¯å¹¶å¯¼èˆªåˆ°é¡¹ç›®çš„æ ¹æ–‡ä»¶å¤¹ã€‚

ç¬¬ä¸€æ­¥æ˜¯ç™»å½• npm

```
npm login
```

æ­¤åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æäº¤æ‚¨çš„åŒ…:

```
npm publish
```

åœ¨æ­¤ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨å·²ç»æ„å»ºäº†ä»£ç ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å€¼åœ¨ **package.json** ä¸­æ·»åŠ ä¸€ä¸ª*è„šæœ¬*:

```
"prepublishOnly": "webpack --mode=production",
```

è¯¥å‘½ä»¤å°†åœ¨è¿è¡Œ`npm publish`æ—¶æ‰§è¡Œï¼Œä½†åœ¨å‘å¸ƒä»£ç ä¹‹å‰ã€‚

# é¢å¤–æç¤º

1.  å¦‚æœè¦ä» npm ä¸­åˆ é™¤æ‚¨çš„è½¯ä»¶åŒ…ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤:

```
npm unpublish [package_name]
```

2.æ¯æ¬¡éƒ¨ç½²åº“çš„æ–°ç‰ˆæœ¬æ—¶ï¼Œè¯·ç¡®ä¿ä» **package.json** æ›´æ–°ç‰ˆæœ¬

```
"version": "1.0.0", -> "version":"1.0.1"
```

è¿™ä¸ªä¸‰ä½æ•°ç‰ˆæœ¬ç³»ç»Ÿ[çš„è¯¦ç»†æè¿°å¯ä»¥åœ¨è¿™é‡Œ](https://angular.io/guide/releases)æ‰¾åˆ°ã€‚

3.æœ¬åœ°æµ‹è¯•

æ‚¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤åœ¨æœ¬åœ°æµ‹è¯•æ‚¨çš„åŒ…:

```
npm link
```

ä¾‹å¦‚

![](img/c3a5a70c87cba26173b049be88ddddfd.png)

[ç”Ÿ](https://carbon.now.sh/?bg=rgba(171%2C%20184%2C%20195%2C%201)&t=seti&wt=none&l=application%2Fx-sh&ds=true&dsyoff=20px&dsblur=68px&wc=true&wa=true&pv=56px&ph=56px&ln=false&fl=1&fm=Hack&fs=14px&lh=133%25&si=false&es=2x&wm=false&code=cd%2520~%252Fprojects%252Fmy-library%2520%2520%2520%2520%2523%2520go%2520into%2520the%2520package%2520directory%250Anpm%2520link%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2523%2520creates%2520global%2520link%250Acd%2520~%252Fprojects%252Fdemo-project%2520%2520%2523%2520go%2520into%2520some%2520other%2520package%2520directory.%250Anpm%2520link%2520my-library%2520%2520%2520%2520%2520%2520%2520%2520%2520%2523%2520link-install%2520the%2520package%252C%2520note%2520that%2520here%2520you%2520must%2520use%2520the%2520name%250A%2509%2509%2509%2509%2509%2509%2509%2523%2520that%2520you%2520supplied%2520in%2520package.json%2520under%2520%27name%27%2520property)

æ€»ä¹‹ï¼Œæˆ‘å¸Œæœ›è¿™äº›ä¿¡æ¯å¯¹ä½ æœ‰ç”¨ã€‚æˆ‘çŸ¥é“å¦‚æœä½ æ˜¯ Webpack å’Œä»£ç æ†ç»‘çš„åˆå­¦è€…ï¼Œä½ å¯èƒ½ä¼šè§‰å¾—è¿™ç¯‡æ–‡ç« å¾ˆæ¾æ•£ã€‚

ä¸ºæ­¤ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹[å†™çš„æ–‡æ¡£](https://github.com/GeoPablo/framework-for-building-libraries#readme)ï¼Œè¿™é‡Œä»¥ä¸€ç§æ›´å‹ç¼©çš„æ–¹å¼å‘ˆç°äº†ä¸€ç³»åˆ—ä½ å¯ä»¥éµå¾ªçš„æ­¥éª¤ã€‚

> æˆ–è€…ï¼Œå¦‚æœä½ æœ‰ä¸€äº›æ›´å‡†ç¡®çš„é—®é¢˜ï¼Œå…³äºä¸€äº›ä¸æ¸…æ¥šçš„äº‹æƒ…ï¼Œä½ å¯ä»¥éšæ—¶åœ¨ twitter ä¸Šç»™æˆ‘ç•™è¨€ğŸ˜Šã€‚